var E3=Object.defineProperty;var A3=(n,e,t)=>e in n?E3(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var Mt=(n,e,t)=>A3(n,typeof e!="symbol"?e+"":e,t);function j3(n,e){for(var t=0;t<e.length;t++){const s=e[t];if(typeof s!="string"&&!Array.isArray(s)){for(const r in s)if(r!=="default"&&!(r in n)){const i=Object.getOwnPropertyDescriptor(s,r);i&&Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:()=>s[r]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function t(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(r){if(r.ep)return;r.ep=!0;const i=t(r);fetch(r.href,i)}})();function tb(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function R3(n){if(Object.prototype.hasOwnProperty.call(n,"__esModule"))return n;var e=n.default;if(typeof e=="function"){var t=function s(){return this instanceof s?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(s){var r=Object.getOwnPropertyDescriptor(n,s);Object.defineProperty(t,s,r.get?r:{enumerable:!0,get:function(){return n[s]}})}),t}var e0={exports:{}},Nu={},t0={exports:{}},xt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _2;function D3(){if(_2)return xt;_2=1;var n=Symbol.for("react.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),i=Symbol.for("react.provider"),o=Symbol.for("react.context"),a=Symbol.for("react.forward_ref"),l=Symbol.for("react.suspense"),u=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),f=Symbol.iterator;function p(z){return z===null||typeof z!="object"?null:(z=f&&z[f]||z["@@iterator"],typeof z=="function"?z:null)}var g={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},x=Object.assign,y={};function b(z,K,Y){this.props=z,this.context=K,this.refs=y,this.updater=Y||g}b.prototype.isReactComponent={},b.prototype.setState=function(z,K){if(typeof z!="object"&&typeof z!="function"&&z!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,z,K,"setState")},b.prototype.forceUpdate=function(z){this.updater.enqueueForceUpdate(this,z,"forceUpdate")};function k(){}k.prototype=b.prototype;function w(z,K,Y){this.props=z,this.context=K,this.refs=y,this.updater=Y||g}var N=w.prototype=new k;N.constructor=w,x(N,b.prototype),N.isPureReactComponent=!0;var C=Array.isArray,S=Object.prototype.hasOwnProperty,T={current:null},A={key:!0,ref:!0,__self:!0,__source:!0};function E(z,K,Y){var B,J={},ae=null,pe=null;if(K!=null)for(B in K.ref!==void 0&&(pe=K.ref),K.key!==void 0&&(ae=""+K.key),K)S.call(K,B)&&!A.hasOwnProperty(B)&&(J[B]=K[B]);var ge=arguments.length-2;if(ge===1)J.children=Y;else if(1<ge){for(var he=Array(ge),we=0;we<ge;we++)he[we]=arguments[we+2];J.children=he}if(z&&z.defaultProps)for(B in ge=z.defaultProps,ge)J[B]===void 0&&(J[B]=ge[B]);return{$$typeof:n,type:z,key:ae,ref:pe,props:J,_owner:T.current}}function M(z,K){return{$$typeof:n,type:z.type,key:K,ref:z.ref,props:z.props,_owner:z._owner}}function P(z){return typeof z=="object"&&z!==null&&z.$$typeof===n}function R(z){var K={"=":"=0",":":"=2"};return"$"+z.replace(/[=:]/g,function(Y){return K[Y]})}var L=/\/+/g;function _(z,K){return typeof z=="object"&&z!==null&&z.key!=null?R(""+z.key):K.toString(36)}function O(z,K,Y,B,J){var ae=typeof z;(ae==="undefined"||ae==="boolean")&&(z=null);var pe=!1;if(z===null)pe=!0;else switch(ae){case"string":case"number":pe=!0;break;case"object":switch(z.$$typeof){case n:case e:pe=!0}}if(pe)return pe=z,J=J(pe),z=B===""?"."+_(pe,0):B,C(J)?(Y="",z!=null&&(Y=z.replace(L,"$&/")+"/"),O(J,K,Y,"",function(we){return we})):J!=null&&(P(J)&&(J=M(J,Y+(!J.key||pe&&pe.key===J.key?"":(""+J.key).replace(L,"$&/")+"/")+z)),K.push(J)),1;if(pe=0,B=B===""?".":B+":",C(z))for(var ge=0;ge<z.length;ge++){ae=z[ge];var he=B+_(ae,ge);pe+=O(ae,K,Y,he,J)}else if(he=p(z),typeof he=="function")for(z=he.call(z),ge=0;!(ae=z.next()).done;)ae=ae.value,he=B+_(ae,ge++),pe+=O(ae,K,Y,he,J);else if(ae==="object")throw K=String(z),Error("Objects are not valid as a React child (found: "+(K==="[object Object]"?"object with keys {"+Object.keys(z).join(", ")+"}":K)+"). If you meant to render a collection of children, use an array instead.");return pe}function U(z,K,Y){if(z==null)return z;var B=[],J=0;return O(z,B,"","",function(ae){return K.call(Y,ae,J++)}),B}function W(z){if(z._status===-1){var K=z._result;K=K(),K.then(function(Y){(z._status===0||z._status===-1)&&(z._status=1,z._result=Y)},function(Y){(z._status===0||z._status===-1)&&(z._status=2,z._result=Y)}),z._status===-1&&(z._status=0,z._result=K)}if(z._status===1)return z._result.default;throw z._result}var H={current:null},G={transition:null},q={ReactCurrentDispatcher:H,ReactCurrentBatchConfig:G,ReactCurrentOwner:T};function Q(){throw Error("act(...) is not supported in production builds of React.")}return xt.Children={map:U,forEach:function(z,K,Y){U(z,function(){K.apply(this,arguments)},Y)},count:function(z){var K=0;return U(z,function(){K++}),K},toArray:function(z){return U(z,function(K){return K})||[]},only:function(z){if(!P(z))throw Error("React.Children.only expected to receive a single React element child.");return z}},xt.Component=b,xt.Fragment=t,xt.Profiler=r,xt.PureComponent=w,xt.StrictMode=s,xt.Suspense=l,xt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=q,xt.act=Q,xt.cloneElement=function(z,K,Y){if(z==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+z+".");var B=x({},z.props),J=z.key,ae=z.ref,pe=z._owner;if(K!=null){if(K.ref!==void 0&&(ae=K.ref,pe=T.current),K.key!==void 0&&(J=""+K.key),z.type&&z.type.defaultProps)var ge=z.type.defaultProps;for(he in K)S.call(K,he)&&!A.hasOwnProperty(he)&&(B[he]=K[he]===void 0&&ge!==void 0?ge[he]:K[he])}var he=arguments.length-2;if(he===1)B.children=Y;else if(1<he){ge=Array(he);for(var we=0;we<he;we++)ge[we]=arguments[we+2];B.children=ge}return{$$typeof:n,type:z.type,key:J,ref:ae,props:B,_owner:pe}},xt.createContext=function(z){return z={$$typeof:o,_currentValue:z,_currentValue2:z,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},z.Provider={$$typeof:i,_context:z},z.Consumer=z},xt.createElement=E,xt.createFactory=function(z){var K=E.bind(null,z);return K.type=z,K},xt.createRef=function(){return{current:null}},xt.forwardRef=function(z){return{$$typeof:a,render:z}},xt.isValidElement=P,xt.lazy=function(z){return{$$typeof:d,_payload:{_status:-1,_result:z},_init:W}},xt.memo=function(z,K){return{$$typeof:u,type:z,compare:K===void 0?null:K}},xt.startTransition=function(z){var K=G.transition;G.transition={};try{z()}finally{G.transition=K}},xt.unstable_act=Q,xt.useCallback=function(z,K){return H.current.useCallback(z,K)},xt.useContext=function(z){return H.current.useContext(z)},xt.useDebugValue=function(){},xt.useDeferredValue=function(z){return H.current.useDeferredValue(z)},xt.useEffect=function(z,K){return H.current.useEffect(z,K)},xt.useId=function(){return H.current.useId()},xt.useImperativeHandle=function(z,K,Y){return H.current.useImperativeHandle(z,K,Y)},xt.useInsertionEffect=function(z,K){return H.current.useInsertionEffect(z,K)},xt.useLayoutEffect=function(z,K){return H.current.useLayoutEffect(z,K)},xt.useMemo=function(z,K){return H.current.useMemo(z,K)},xt.useReducer=function(z,K,Y){return H.current.useReducer(z,K,Y)},xt.useRef=function(z){return H.current.useRef(z)},xt.useState=function(z){return H.current.useState(z)},xt.useSyncExternalStore=function(z,K,Y){return H.current.useSyncExternalStore(z,K,Y)},xt.useTransition=function(){return H.current.useTransition()},xt.version="18.3.1",xt}var z2;function nb(){return z2||(z2=1,t0.exports=D3()),t0.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var B2;function P3(){if(B2)return Nu;B2=1;var n=nb(),e=Symbol.for("react.element"),t=Symbol.for("react.fragment"),s=Object.prototype.hasOwnProperty,r=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,i={key:!0,ref:!0,__self:!0,__source:!0};function o(a,l,u){var d,f={},p=null,g=null;u!==void 0&&(p=""+u),l.key!==void 0&&(p=""+l.key),l.ref!==void 0&&(g=l.ref);for(d in l)s.call(l,d)&&!i.hasOwnProperty(d)&&(f[d]=l[d]);if(a&&a.defaultProps)for(d in l=a.defaultProps,l)f[d]===void 0&&(f[d]=l[d]);return{$$typeof:e,type:a,key:p,ref:g,props:f,_owner:r.current}}return Nu.Fragment=t,Nu.jsx=o,Nu.jsxs=o,Nu}var W2;function M3(){return W2||(W2=1,e0.exports=P3()),e0.exports}var c=M3(),j=nb();const gt=tb(j);var Hf={},n0={exports:{}},Us={},s0={exports:{}},r0={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var V2;function L3(){return V2||(V2=1,(function(n){function e(G,q){var Q=G.length;G.push(q);e:for(;0<Q;){var z=Q-1>>>1,K=G[z];if(0<r(K,q))G[z]=q,G[Q]=K,Q=z;else break e}}function t(G){return G.length===0?null:G[0]}function s(G){if(G.length===0)return null;var q=G[0],Q=G.pop();if(Q!==q){G[0]=Q;e:for(var z=0,K=G.length,Y=K>>>1;z<Y;){var B=2*(z+1)-1,J=G[B],ae=B+1,pe=G[ae];if(0>r(J,Q))ae<K&&0>r(pe,J)?(G[z]=pe,G[ae]=Q,z=ae):(G[z]=J,G[B]=Q,z=B);else if(ae<K&&0>r(pe,Q))G[z]=pe,G[ae]=Q,z=ae;else break e}}return q}function r(G,q){var Q=G.sortIndex-q.sortIndex;return Q!==0?Q:G.id-q.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;n.unstable_now=function(){return i.now()}}else{var o=Date,a=o.now();n.unstable_now=function(){return o.now()-a}}var l=[],u=[],d=1,f=null,p=3,g=!1,x=!1,y=!1,b=typeof setTimeout=="function"?setTimeout:null,k=typeof clearTimeout=="function"?clearTimeout:null,w=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function N(G){for(var q=t(u);q!==null;){if(q.callback===null)s(u);else if(q.startTime<=G)s(u),q.sortIndex=q.expirationTime,e(l,q);else break;q=t(u)}}function C(G){if(y=!1,N(G),!x)if(t(l)!==null)x=!0,W(S);else{var q=t(u);q!==null&&H(C,q.startTime-G)}}function S(G,q){x=!1,y&&(y=!1,k(E),E=-1),g=!0;var Q=p;try{for(N(q),f=t(l);f!==null&&(!(f.expirationTime>q)||G&&!R());){var z=f.callback;if(typeof z=="function"){f.callback=null,p=f.priorityLevel;var K=z(f.expirationTime<=q);q=n.unstable_now(),typeof K=="function"?f.callback=K:f===t(l)&&s(l),N(q)}else s(l);f=t(l)}if(f!==null)var Y=!0;else{var B=t(u);B!==null&&H(C,B.startTime-q),Y=!1}return Y}finally{f=null,p=Q,g=!1}}var T=!1,A=null,E=-1,M=5,P=-1;function R(){return!(n.unstable_now()-P<M)}function L(){if(A!==null){var G=n.unstable_now();P=G;var q=!0;try{q=A(!0,G)}finally{q?_():(T=!1,A=null)}}else T=!1}var _;if(typeof w=="function")_=function(){w(L)};else if(typeof MessageChannel<"u"){var O=new MessageChannel,U=O.port2;O.port1.onmessage=L,_=function(){U.postMessage(null)}}else _=function(){b(L,0)};function W(G){A=G,T||(T=!0,_())}function H(G,q){E=b(function(){G(n.unstable_now())},q)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(G){G.callback=null},n.unstable_continueExecution=function(){x||g||(x=!0,W(S))},n.unstable_forceFrameRate=function(G){0>G||125<G?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):M=0<G?Math.floor(1e3/G):5},n.unstable_getCurrentPriorityLevel=function(){return p},n.unstable_getFirstCallbackNode=function(){return t(l)},n.unstable_next=function(G){switch(p){case 1:case 2:case 3:var q=3;break;default:q=p}var Q=p;p=q;try{return G()}finally{p=Q}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(G,q){switch(G){case 1:case 2:case 3:case 4:case 5:break;default:G=3}var Q=p;p=G;try{return q()}finally{p=Q}},n.unstable_scheduleCallback=function(G,q,Q){var z=n.unstable_now();switch(typeof Q=="object"&&Q!==null?(Q=Q.delay,Q=typeof Q=="number"&&0<Q?z+Q:z):Q=z,G){case 1:var K=-1;break;case 2:K=250;break;case 5:K=1073741823;break;case 4:K=1e4;break;default:K=5e3}return K=Q+K,G={id:d++,callback:q,priorityLevel:G,startTime:Q,expirationTime:K,sortIndex:-1},Q>z?(G.sortIndex=Q,e(u,G),t(l)===null&&G===t(u)&&(y?(k(E),E=-1):y=!0,H(C,Q-z))):(G.sortIndex=K,e(l,G),x||g||(x=!0,W(S))),G},n.unstable_shouldYield=R,n.unstable_wrapCallback=function(G){var q=p;return function(){var Q=p;p=q;try{return G.apply(this,arguments)}finally{p=Q}}}})(r0)),r0}var U2;function F3(){return U2||(U2=1,s0.exports=L3()),s0.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var G2;function O3(){if(G2)return Us;G2=1;var n=nb(),e=F3();function t(h){for(var m="https://reactjs.org/docs/error-decoder.html?invariant="+h,v=1;v<arguments.length;v++)m+="&args[]="+encodeURIComponent(arguments[v]);return"Minified React error #"+h+"; visit "+m+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var s=new Set,r={};function i(h,m){o(h,m),o(h+"Capture",m)}function o(h,m){for(r[h]=m,h=0;h<m.length;h++)s.add(m[h])}var a=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),l=Object.prototype.hasOwnProperty,u=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,d={},f={};function p(h){return l.call(f,h)?!0:l.call(d,h)?!1:u.test(h)?f[h]=!0:(d[h]=!0,!1)}function g(h,m,v,I){if(v!==null&&v.type===0)return!1;switch(typeof m){case"function":case"symbol":return!0;case"boolean":return I?!1:v!==null?!v.acceptsBooleans:(h=h.toLowerCase().slice(0,5),h!=="data-"&&h!=="aria-");default:return!1}}function x(h,m,v,I){if(m===null||typeof m>"u"||g(h,m,v,I))return!0;if(I)return!1;if(v!==null)switch(v.type){case 3:return!m;case 4:return m===!1;case 5:return isNaN(m);case 6:return isNaN(m)||1>m}return!1}function y(h,m,v,I,$,D,F){this.acceptsBooleans=m===2||m===3||m===4,this.attributeName=I,this.attributeNamespace=$,this.mustUseProperty=v,this.propertyName=h,this.type=m,this.sanitizeURL=D,this.removeEmptyString=F}var b={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(h){b[h]=new y(h,0,!1,h,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(h){var m=h[0];b[m]=new y(m,1,!1,h[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(h){b[h]=new y(h,2,!1,h.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(h){b[h]=new y(h,2,!1,h,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(h){b[h]=new y(h,3,!1,h.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(h){b[h]=new y(h,3,!0,h,null,!1,!1)}),["capture","download"].forEach(function(h){b[h]=new y(h,4,!1,h,null,!1,!1)}),["cols","rows","size","span"].forEach(function(h){b[h]=new y(h,6,!1,h,null,!1,!1)}),["rowSpan","start"].forEach(function(h){b[h]=new y(h,5,!1,h.toLowerCase(),null,!1,!1)});var k=/[\-:]([a-z])/g;function w(h){return h[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(h){var m=h.replace(k,w);b[m]=new y(m,1,!1,h,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(h){var m=h.replace(k,w);b[m]=new y(m,1,!1,h,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(h){var m=h.replace(k,w);b[m]=new y(m,1,!1,h,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(h){b[h]=new y(h,1,!1,h.toLowerCase(),null,!1,!1)}),b.xlinkHref=new y("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(h){b[h]=new y(h,1,!1,h.toLowerCase(),null,!0,!0)});function N(h,m,v,I){var $=b.hasOwnProperty(m)?b[m]:null;($!==null?$.type!==0:I||!(2<m.length)||m[0]!=="o"&&m[0]!=="O"||m[1]!=="n"&&m[1]!=="N")&&(x(m,v,$,I)&&(v=null),I||$===null?p(m)&&(v===null?h.removeAttribute(m):h.setAttribute(m,""+v)):$.mustUseProperty?h[$.propertyName]=v===null?$.type===3?!1:"":v:(m=$.attributeName,I=$.attributeNamespace,v===null?h.removeAttribute(m):($=$.type,v=$===3||$===4&&v===!0?"":""+v,I?h.setAttributeNS(I,m,v):h.setAttribute(m,v))))}var C=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,S=Symbol.for("react.element"),T=Symbol.for("react.portal"),A=Symbol.for("react.fragment"),E=Symbol.for("react.strict_mode"),M=Symbol.for("react.profiler"),P=Symbol.for("react.provider"),R=Symbol.for("react.context"),L=Symbol.for("react.forward_ref"),_=Symbol.for("react.suspense"),O=Symbol.for("react.suspense_list"),U=Symbol.for("react.memo"),W=Symbol.for("react.lazy"),H=Symbol.for("react.offscreen"),G=Symbol.iterator;function q(h){return h===null||typeof h!="object"?null:(h=G&&h[G]||h["@@iterator"],typeof h=="function"?h:null)}var Q=Object.assign,z;function K(h){if(z===void 0)try{throw Error()}catch(v){var m=v.stack.trim().match(/\n( *(at )?)/);z=m&&m[1]||""}return`
`+z+h}var Y=!1;function B(h,m){if(!h||Y)return"";Y=!0;var v=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(m)if(m=function(){throw Error()},Object.defineProperty(m.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(m,[])}catch(xe){var I=xe}Reflect.construct(h,[],m)}else{try{m.call()}catch(xe){I=xe}h.call(m.prototype)}else{try{throw Error()}catch(xe){I=xe}h()}}catch(xe){if(xe&&I&&typeof xe.stack=="string"){for(var $=xe.stack.split(`
`),D=I.stack.split(`
`),F=$.length-1,X=D.length-1;1<=F&&0<=X&&$[F]!==D[X];)X--;for(;1<=F&&0<=X;F--,X--)if($[F]!==D[X]){if(F!==1||X!==1)do if(F--,X--,0>X||$[F]!==D[X]){var ee=`
`+$[F].replace(" at new "," at ");return h.displayName&&ee.includes("<anonymous>")&&(ee=ee.replace("<anonymous>",h.displayName)),ee}while(1<=F&&0<=X);break}}}finally{Y=!1,Error.prepareStackTrace=v}return(h=h?h.displayName||h.name:"")?K(h):""}function J(h){switch(h.tag){case 5:return K(h.type);case 16:return K("Lazy");case 13:return K("Suspense");case 19:return K("SuspenseList");case 0:case 2:case 15:return h=B(h.type,!1),h;case 11:return h=B(h.type.render,!1),h;case 1:return h=B(h.type,!0),h;default:return""}}function ae(h){if(h==null)return null;if(typeof h=="function")return h.displayName||h.name||null;if(typeof h=="string")return h;switch(h){case A:return"Fragment";case T:return"Portal";case M:return"Profiler";case E:return"StrictMode";case _:return"Suspense";case O:return"SuspenseList"}if(typeof h=="object")switch(h.$$typeof){case R:return(h.displayName||"Context")+".Consumer";case P:return(h._context.displayName||"Context")+".Provider";case L:var m=h.render;return h=h.displayName,h||(h=m.displayName||m.name||"",h=h!==""?"ForwardRef("+h+")":"ForwardRef"),h;case U:return m=h.displayName||null,m!==null?m:ae(h.type)||"Memo";case W:m=h._payload,h=h._init;try{return ae(h(m))}catch{}}return null}function pe(h){var m=h.type;switch(h.tag){case 24:return"Cache";case 9:return(m.displayName||"Context")+".Consumer";case 10:return(m._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return h=m.render,h=h.displayName||h.name||"",m.displayName||(h!==""?"ForwardRef("+h+")":"ForwardRef");case 7:return"Fragment";case 5:return m;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return ae(m);case 8:return m===E?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof m=="function")return m.displayName||m.name||null;if(typeof m=="string")return m}return null}function ge(h){switch(typeof h){case"boolean":case"number":case"string":case"undefined":return h;case"object":return h;default:return""}}function he(h){var m=h.type;return(h=h.nodeName)&&h.toLowerCase()==="input"&&(m==="checkbox"||m==="radio")}function we(h){var m=he(h)?"checked":"value",v=Object.getOwnPropertyDescriptor(h.constructor.prototype,m),I=""+h[m];if(!h.hasOwnProperty(m)&&typeof v<"u"&&typeof v.get=="function"&&typeof v.set=="function"){var $=v.get,D=v.set;return Object.defineProperty(h,m,{configurable:!0,get:function(){return $.call(this)},set:function(F){I=""+F,D.call(this,F)}}),Object.defineProperty(h,m,{enumerable:v.enumerable}),{getValue:function(){return I},setValue:function(F){I=""+F},stopTracking:function(){h._valueTracker=null,delete h[m]}}}}function Pe(h){h._valueTracker||(h._valueTracker=we(h))}function ue(h){if(!h)return!1;var m=h._valueTracker;if(!m)return!0;var v=m.getValue(),I="";return h&&(I=he(h)?h.checked?"true":"false":h.value),h=I,h!==v?(m.setValue(h),!0):!1}function Te(h){if(h=h||(typeof document<"u"?document:void 0),typeof h>"u")return null;try{return h.activeElement||h.body}catch{return h.body}}function ke(h,m){var v=m.checked;return Q({},m,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:v??h._wrapperState.initialChecked})}function ye(h,m){var v=m.defaultValue==null?"":m.defaultValue,I=m.checked!=null?m.checked:m.defaultChecked;v=ge(m.value!=null?m.value:v),h._wrapperState={initialChecked:I,initialValue:v,controlled:m.type==="checkbox"||m.type==="radio"?m.checked!=null:m.value!=null}}function Ce(h,m){m=m.checked,m!=null&&N(h,"checked",m,!1)}function Ae(h,m){Ce(h,m);var v=ge(m.value),I=m.type;if(v!=null)I==="number"?(v===0&&h.value===""||h.value!=v)&&(h.value=""+v):h.value!==""+v&&(h.value=""+v);else if(I==="submit"||I==="reset"){h.removeAttribute("value");return}m.hasOwnProperty("value")?mt(h,m.type,v):m.hasOwnProperty("defaultValue")&&mt(h,m.type,ge(m.defaultValue)),m.checked==null&&m.defaultChecked!=null&&(h.defaultChecked=!!m.defaultChecked)}function Be(h,m,v){if(m.hasOwnProperty("value")||m.hasOwnProperty("defaultValue")){var I=m.type;if(!(I!=="submit"&&I!=="reset"||m.value!==void 0&&m.value!==null))return;m=""+h._wrapperState.initialValue,v||m===h.value||(h.value=m),h.defaultValue=m}v=h.name,v!==""&&(h.name=""),h.defaultChecked=!!h._wrapperState.initialChecked,v!==""&&(h.name=v)}function mt(h,m,v){(m!=="number"||Te(h.ownerDocument)!==h)&&(v==null?h.defaultValue=""+h._wrapperState.initialValue:h.defaultValue!==""+v&&(h.defaultValue=""+v))}var le=Array.isArray;function je(h,m,v,I){if(h=h.options,m){m={};for(var $=0;$<v.length;$++)m["$"+v[$]]=!0;for(v=0;v<h.length;v++)$=m.hasOwnProperty("$"+h[v].value),h[v].selected!==$&&(h[v].selected=$),$&&I&&(h[v].defaultSelected=!0)}else{for(v=""+ge(v),m=null,$=0;$<h.length;$++){if(h[$].value===v){h[$].selected=!0,I&&(h[$].defaultSelected=!0);return}m!==null||h[$].disabled||(m=h[$])}m!==null&&(m.selected=!0)}}function De(h,m){if(m.dangerouslySetInnerHTML!=null)throw Error(t(91));return Q({},m,{value:void 0,defaultValue:void 0,children:""+h._wrapperState.initialValue})}function _e(h,m){var v=m.value;if(v==null){if(v=m.children,m=m.defaultValue,v!=null){if(m!=null)throw Error(t(92));if(le(v)){if(1<v.length)throw Error(t(93));v=v[0]}m=v}m==null&&(m=""),v=m}h._wrapperState={initialValue:ge(v)}}function it(h,m){var v=ge(m.value),I=ge(m.defaultValue);v!=null&&(v=""+v,v!==h.value&&(h.value=v),m.defaultValue==null&&h.defaultValue!==v&&(h.defaultValue=v)),I!=null&&(h.defaultValue=""+I)}function St(h){var m=h.textContent;m===h._wrapperState.initialValue&&m!==""&&m!==null&&(h.value=m)}function cn(h){switch(h){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Ut(h,m){return h==null||h==="http://www.w3.org/1999/xhtml"?cn(m):h==="http://www.w3.org/2000/svg"&&m==="foreignObject"?"http://www.w3.org/1999/xhtml":h}var ut,yn=(function(h){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(m,v,I,$){MSApp.execUnsafeLocalFunction(function(){return h(m,v,I,$)})}:h})(function(h,m){if(h.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in h)h.innerHTML=m;else{for(ut=ut||document.createElement("div"),ut.innerHTML="<svg>"+m.valueOf().toString()+"</svg>",m=ut.firstChild;h.firstChild;)h.removeChild(h.firstChild);for(;m.firstChild;)h.appendChild(m.firstChild)}});function Zn(h,m){if(m){var v=h.firstChild;if(v&&v===h.lastChild&&v.nodeType===3){v.nodeValue=m;return}}h.textContent=m}var Yt={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Dr=["Webkit","ms","Moz","O"];Object.keys(Yt).forEach(function(h){Dr.forEach(function(m){m=m+h.charAt(0).toUpperCase()+h.substring(1),Yt[m]=Yt[h]})});function ur(h,m,v){return m==null||typeof m=="boolean"||m===""?"":v||typeof m!="number"||m===0||Yt.hasOwnProperty(h)&&Yt[h]?(""+m).trim():m+"px"}function Di(h,m){h=h.style;for(var v in m)if(m.hasOwnProperty(v)){var I=v.indexOf("--")===0,$=ur(v,m[v],I);v==="float"&&(v="cssFloat"),I?h.setProperty(v,$):h[v]=$}}var Xe=Q({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function yt(h,m){if(m){if(Xe[h]&&(m.children!=null||m.dangerouslySetInnerHTML!=null))throw Error(t(137,h));if(m.dangerouslySetInnerHTML!=null){if(m.children!=null)throw Error(t(60));if(typeof m.dangerouslySetInnerHTML!="object"||!("__html"in m.dangerouslySetInnerHTML))throw Error(t(61))}if(m.style!=null&&typeof m.style!="object")throw Error(t(62))}}function Gt(h,m){if(h.indexOf("-")===-1)return typeof m.is=="string";switch(h){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Cs=null;function Vc(h){return h=h.target||h.srcElement||window,h.correspondingUseElement&&(h=h.correspondingUseElement),h.nodeType===3?h.parentNode:h}var Uc=null,ho=null,nn=null;function as(h){if(h=uu(h)){if(typeof Uc!="function")throw Error(t(280));var m=h.stateNode;m&&(m=af(m),Uc(h.stateNode,h.type,m))}}function ls(h){ho?nn?nn.push(h):nn=[h]:ho=h}function Pr(){if(ho){var h=ho,m=nn;if(nn=ho=null,as(h),m)for(h=0;h<m.length;h++)as(m[h])}}function Ss(h,m){return h(m)}function cs(){}var Os=!1;function Pi(h,m,v){if(Os)return h(m,v);Os=!0;try{return Ss(h,m,v)}finally{Os=!1,(ho!==null||nn!==null)&&(cs(),Pr())}}function sn(h,m){var v=h.stateNode;if(v===null)return null;var I=af(v);if(I===null)return null;v=I[m];e:switch(m){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(I=!I.disabled)||(h=h.type,I=!(h==="button"||h==="input"||h==="select"||h==="textarea")),h=!I;break e;default:h=!1}if(h)return null;if(v&&typeof v!="function")throw Error(t(231,m,typeof v));return v}var dr=!1;if(a)try{var us={};Object.defineProperty(us,"passive",{get:function(){dr=!0}}),window.addEventListener("test",us,us),window.removeEventListener("test",us,us)}catch{dr=!1}function Mr(h,m,v,I,$,D,F,X,ee){var xe=Array.prototype.slice.call(arguments,3);try{m.apply(v,xe)}catch(Ie){this.onError(Ie)}}var Lr=!1,ai=null,Ys=!1,Mi=null,Gc={onError:function(h){Lr=!0,ai=h}};function FM(h,m,v,I,$,D,F,X,ee){Lr=!1,ai=null,Mr.apply(Gc,arguments)}function OM(h,m,v,I,$,D,F,X,ee){if(FM.apply(this,arguments),Lr){if(Lr){var xe=ai;Lr=!1,ai=null}else throw Error(t(198));Ys||(Ys=!0,Mi=xe)}}function ca(h){var m=h,v=h;if(h.alternate)for(;m.return;)m=m.return;else{h=m;do m=h,(m.flags&4098)!==0&&(v=m.return),h=m.return;while(h)}return m.tag===3?v:null}function lk(h){if(h.tag===13){var m=h.memoizedState;if(m===null&&(h=h.alternate,h!==null&&(m=h.memoizedState)),m!==null)return m.dehydrated}return null}function ck(h){if(ca(h)!==h)throw Error(t(188))}function _M(h){var m=h.alternate;if(!m){if(m=ca(h),m===null)throw Error(t(188));return m!==h?null:h}for(var v=h,I=m;;){var $=v.return;if($===null)break;var D=$.alternate;if(D===null){if(I=$.return,I!==null){v=I;continue}break}if($.child===D.child){for(D=$.child;D;){if(D===v)return ck($),h;if(D===I)return ck($),m;D=D.sibling}throw Error(t(188))}if(v.return!==I.return)v=$,I=D;else{for(var F=!1,X=$.child;X;){if(X===v){F=!0,v=$,I=D;break}if(X===I){F=!0,I=$,v=D;break}X=X.sibling}if(!F){for(X=D.child;X;){if(X===v){F=!0,v=D,I=$;break}if(X===I){F=!0,I=D,v=$;break}X=X.sibling}if(!F)throw Error(t(189))}}if(v.alternate!==I)throw Error(t(190))}if(v.tag!==3)throw Error(t(188));return v.stateNode.current===v?h:m}function uk(h){return h=_M(h),h!==null?dk(h):null}function dk(h){if(h.tag===5||h.tag===6)return h;for(h=h.child;h!==null;){var m=dk(h);if(m!==null)return m;h=h.sibling}return null}var hk=e.unstable_scheduleCallback,fk=e.unstable_cancelCallback,zM=e.unstable_shouldYield,BM=e.unstable_requestPaint,vn=e.unstable_now,WM=e.unstable_getCurrentPriorityLevel,bx=e.unstable_ImmediatePriority,pk=e.unstable_UserBlockingPriority,zh=e.unstable_NormalPriority,VM=e.unstable_LowPriority,mk=e.unstable_IdlePriority,Bh=null,li=null;function UM(h){if(li&&typeof li.onCommitFiberRoot=="function")try{li.onCommitFiberRoot(Bh,h,void 0,(h.current.flags&128)===128)}catch{}}var Fr=Math.clz32?Math.clz32:qM,GM=Math.log,HM=Math.LN2;function qM(h){return h>>>=0,h===0?32:31-(GM(h)/HM|0)|0}var Wh=64,Vh=4194304;function Hc(h){switch(h&-h){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return h&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return h&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return h}}function Uh(h,m){var v=h.pendingLanes;if(v===0)return 0;var I=0,$=h.suspendedLanes,D=h.pingedLanes,F=v&268435455;if(F!==0){var X=F&~$;X!==0?I=Hc(X):(D&=F,D!==0&&(I=Hc(D)))}else F=v&~$,F!==0?I=Hc(F):D!==0&&(I=Hc(D));if(I===0)return 0;if(m!==0&&m!==I&&(m&$)===0&&($=I&-I,D=m&-m,$>=D||$===16&&(D&4194240)!==0))return m;if((I&4)!==0&&(I|=v&16),m=h.entangledLanes,m!==0)for(h=h.entanglements,m&=I;0<m;)v=31-Fr(m),$=1<<v,I|=h[v],m&=~$;return I}function KM(h,m){switch(h){case 1:case 2:case 4:return m+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return m+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function QM(h,m){for(var v=h.suspendedLanes,I=h.pingedLanes,$=h.expirationTimes,D=h.pendingLanes;0<D;){var F=31-Fr(D),X=1<<F,ee=$[F];ee===-1?((X&v)===0||(X&I)!==0)&&($[F]=KM(X,m)):ee<=m&&(h.expiredLanes|=X),D&=~X}}function wx(h){return h=h.pendingLanes&-1073741825,h!==0?h:h&1073741824?1073741824:0}function gk(){var h=Wh;return Wh<<=1,(Wh&4194240)===0&&(Wh=64),h}function kx(h){for(var m=[],v=0;31>v;v++)m.push(h);return m}function qc(h,m,v){h.pendingLanes|=m,m!==536870912&&(h.suspendedLanes=0,h.pingedLanes=0),h=h.eventTimes,m=31-Fr(m),h[m]=v}function XM(h,m){var v=h.pendingLanes&~m;h.pendingLanes=m,h.suspendedLanes=0,h.pingedLanes=0,h.expiredLanes&=m,h.mutableReadLanes&=m,h.entangledLanes&=m,m=h.entanglements;var I=h.eventTimes;for(h=h.expirationTimes;0<v;){var $=31-Fr(v),D=1<<$;m[$]=0,I[$]=-1,h[$]=-1,v&=~D}}function Cx(h,m){var v=h.entangledLanes|=m;for(h=h.entanglements;v;){var I=31-Fr(v),$=1<<I;$&m|h[I]&m&&(h[I]|=m),v&=~$}}var Dt=0;function xk(h){return h&=-h,1<h?4<h?(h&268435455)!==0?16:536870912:4:1}var yk,Sx,vk,bk,wk,Nx=!1,Gh=[],fo=null,po=null,mo=null,Kc=new Map,Qc=new Map,go=[],YM="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function kk(h,m){switch(h){case"focusin":case"focusout":fo=null;break;case"dragenter":case"dragleave":po=null;break;case"mouseover":case"mouseout":mo=null;break;case"pointerover":case"pointerout":Kc.delete(m.pointerId);break;case"gotpointercapture":case"lostpointercapture":Qc.delete(m.pointerId)}}function Xc(h,m,v,I,$,D){return h===null||h.nativeEvent!==D?(h={blockedOn:m,domEventName:v,eventSystemFlags:I,nativeEvent:D,targetContainers:[$]},m!==null&&(m=uu(m),m!==null&&Sx(m)),h):(h.eventSystemFlags|=I,m=h.targetContainers,$!==null&&m.indexOf($)===-1&&m.push($),h)}function ZM(h,m,v,I,$){switch(m){case"focusin":return fo=Xc(fo,h,m,v,I,$),!0;case"dragenter":return po=Xc(po,h,m,v,I,$),!0;case"mouseover":return mo=Xc(mo,h,m,v,I,$),!0;case"pointerover":var D=$.pointerId;return Kc.set(D,Xc(Kc.get(D)||null,h,m,v,I,$)),!0;case"gotpointercapture":return D=$.pointerId,Qc.set(D,Xc(Qc.get(D)||null,h,m,v,I,$)),!0}return!1}function Ck(h){var m=ua(h.target);if(m!==null){var v=ca(m);if(v!==null){if(m=v.tag,m===13){if(m=lk(v),m!==null){h.blockedOn=m,wk(h.priority,function(){vk(v)});return}}else if(m===3&&v.stateNode.current.memoizedState.isDehydrated){h.blockedOn=v.tag===3?v.stateNode.containerInfo:null;return}}}h.blockedOn=null}function Hh(h){if(h.blockedOn!==null)return!1;for(var m=h.targetContainers;0<m.length;){var v=Tx(h.domEventName,h.eventSystemFlags,m[0],h.nativeEvent);if(v===null){v=h.nativeEvent;var I=new v.constructor(v.type,v);Cs=I,v.target.dispatchEvent(I),Cs=null}else return m=uu(v),m!==null&&Sx(m),h.blockedOn=v,!1;m.shift()}return!0}function Sk(h,m,v){Hh(h)&&v.delete(m)}function JM(){Nx=!1,fo!==null&&Hh(fo)&&(fo=null),po!==null&&Hh(po)&&(po=null),mo!==null&&Hh(mo)&&(mo=null),Kc.forEach(Sk),Qc.forEach(Sk)}function Yc(h,m){h.blockedOn===m&&(h.blockedOn=null,Nx||(Nx=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,JM)))}function Zc(h){function m($){return Yc($,h)}if(0<Gh.length){Yc(Gh[0],h);for(var v=1;v<Gh.length;v++){var I=Gh[v];I.blockedOn===h&&(I.blockedOn=null)}}for(fo!==null&&Yc(fo,h),po!==null&&Yc(po,h),mo!==null&&Yc(mo,h),Kc.forEach(m),Qc.forEach(m),v=0;v<go.length;v++)I=go[v],I.blockedOn===h&&(I.blockedOn=null);for(;0<go.length&&(v=go[0],v.blockedOn===null);)Ck(v),v.blockedOn===null&&go.shift()}var hl=C.ReactCurrentBatchConfig,qh=!0;function eL(h,m,v,I){var $=Dt,D=hl.transition;hl.transition=null;try{Dt=1,Ix(h,m,v,I)}finally{Dt=$,hl.transition=D}}function tL(h,m,v,I){var $=Dt,D=hl.transition;hl.transition=null;try{Dt=4,Ix(h,m,v,I)}finally{Dt=$,hl.transition=D}}function Ix(h,m,v,I){if(qh){var $=Tx(h,m,v,I);if($===null)Ux(h,m,I,Kh,v),kk(h,I);else if(ZM($,h,m,v,I))I.stopPropagation();else if(kk(h,I),m&4&&-1<YM.indexOf(h)){for(;$!==null;){var D=uu($);if(D!==null&&yk(D),D=Tx(h,m,v,I),D===null&&Ux(h,m,I,Kh,v),D===$)break;$=D}$!==null&&I.stopPropagation()}else Ux(h,m,I,null,v)}}var Kh=null;function Tx(h,m,v,I){if(Kh=null,h=Vc(I),h=ua(h),h!==null)if(m=ca(h),m===null)h=null;else if(v=m.tag,v===13){if(h=lk(m),h!==null)return h;h=null}else if(v===3){if(m.stateNode.current.memoizedState.isDehydrated)return m.tag===3?m.stateNode.containerInfo:null;h=null}else m!==h&&(h=null);return Kh=h,null}function Nk(h){switch(h){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(WM()){case bx:return 1;case pk:return 4;case zh:case VM:return 16;case mk:return 536870912;default:return 16}default:return 16}}var xo=null,$x=null,Qh=null;function Ik(){if(Qh)return Qh;var h,m=$x,v=m.length,I,$="value"in xo?xo.value:xo.textContent,D=$.length;for(h=0;h<v&&m[h]===$[h];h++);var F=v-h;for(I=1;I<=F&&m[v-I]===$[D-I];I++);return Qh=$.slice(h,1<I?1-I:void 0)}function Xh(h){var m=h.keyCode;return"charCode"in h?(h=h.charCode,h===0&&m===13&&(h=13)):h=m,h===10&&(h=13),32<=h||h===13?h:0}function Yh(){return!0}function Tk(){return!1}function Zs(h){function m(v,I,$,D,F){this._reactName=v,this._targetInst=$,this.type=I,this.nativeEvent=D,this.target=F,this.currentTarget=null;for(var X in h)h.hasOwnProperty(X)&&(v=h[X],this[X]=v?v(D):D[X]);return this.isDefaultPrevented=(D.defaultPrevented!=null?D.defaultPrevented:D.returnValue===!1)?Yh:Tk,this.isPropagationStopped=Tk,this}return Q(m.prototype,{preventDefault:function(){this.defaultPrevented=!0;var v=this.nativeEvent;v&&(v.preventDefault?v.preventDefault():typeof v.returnValue!="unknown"&&(v.returnValue=!1),this.isDefaultPrevented=Yh)},stopPropagation:function(){var v=this.nativeEvent;v&&(v.stopPropagation?v.stopPropagation():typeof v.cancelBubble!="unknown"&&(v.cancelBubble=!0),this.isPropagationStopped=Yh)},persist:function(){},isPersistent:Yh}),m}var fl={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(h){return h.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Ex=Zs(fl),Jc=Q({},fl,{view:0,detail:0}),nL=Zs(Jc),Ax,jx,eu,Zh=Q({},Jc,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Dx,button:0,buttons:0,relatedTarget:function(h){return h.relatedTarget===void 0?h.fromElement===h.srcElement?h.toElement:h.fromElement:h.relatedTarget},movementX:function(h){return"movementX"in h?h.movementX:(h!==eu&&(eu&&h.type==="mousemove"?(Ax=h.screenX-eu.screenX,jx=h.screenY-eu.screenY):jx=Ax=0,eu=h),Ax)},movementY:function(h){return"movementY"in h?h.movementY:jx}}),$k=Zs(Zh),sL=Q({},Zh,{dataTransfer:0}),rL=Zs(sL),iL=Q({},Jc,{relatedTarget:0}),Rx=Zs(iL),oL=Q({},fl,{animationName:0,elapsedTime:0,pseudoElement:0}),aL=Zs(oL),lL=Q({},fl,{clipboardData:function(h){return"clipboardData"in h?h.clipboardData:window.clipboardData}}),cL=Zs(lL),uL=Q({},fl,{data:0}),Ek=Zs(uL),dL={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},hL={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},fL={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function pL(h){var m=this.nativeEvent;return m.getModifierState?m.getModifierState(h):(h=fL[h])?!!m[h]:!1}function Dx(){return pL}var mL=Q({},Jc,{key:function(h){if(h.key){var m=dL[h.key]||h.key;if(m!=="Unidentified")return m}return h.type==="keypress"?(h=Xh(h),h===13?"Enter":String.fromCharCode(h)):h.type==="keydown"||h.type==="keyup"?hL[h.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Dx,charCode:function(h){return h.type==="keypress"?Xh(h):0},keyCode:function(h){return h.type==="keydown"||h.type==="keyup"?h.keyCode:0},which:function(h){return h.type==="keypress"?Xh(h):h.type==="keydown"||h.type==="keyup"?h.keyCode:0}}),gL=Zs(mL),xL=Q({},Zh,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Ak=Zs(xL),yL=Q({},Jc,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Dx}),vL=Zs(yL),bL=Q({},fl,{propertyName:0,elapsedTime:0,pseudoElement:0}),wL=Zs(bL),kL=Q({},Zh,{deltaX:function(h){return"deltaX"in h?h.deltaX:"wheelDeltaX"in h?-h.wheelDeltaX:0},deltaY:function(h){return"deltaY"in h?h.deltaY:"wheelDeltaY"in h?-h.wheelDeltaY:"wheelDelta"in h?-h.wheelDelta:0},deltaZ:0,deltaMode:0}),CL=Zs(kL),SL=[9,13,27,32],Px=a&&"CompositionEvent"in window,tu=null;a&&"documentMode"in document&&(tu=document.documentMode);var NL=a&&"TextEvent"in window&&!tu,jk=a&&(!Px||tu&&8<tu&&11>=tu),Rk=" ",Dk=!1;function Pk(h,m){switch(h){case"keyup":return SL.indexOf(m.keyCode)!==-1;case"keydown":return m.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Mk(h){return h=h.detail,typeof h=="object"&&"data"in h?h.data:null}var pl=!1;function IL(h,m){switch(h){case"compositionend":return Mk(m);case"keypress":return m.which!==32?null:(Dk=!0,Rk);case"textInput":return h=m.data,h===Rk&&Dk?null:h;default:return null}}function TL(h,m){if(pl)return h==="compositionend"||!Px&&Pk(h,m)?(h=Ik(),Qh=$x=xo=null,pl=!1,h):null;switch(h){case"paste":return null;case"keypress":if(!(m.ctrlKey||m.altKey||m.metaKey)||m.ctrlKey&&m.altKey){if(m.char&&1<m.char.length)return m.char;if(m.which)return String.fromCharCode(m.which)}return null;case"compositionend":return jk&&m.locale!=="ko"?null:m.data;default:return null}}var $L={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Lk(h){var m=h&&h.nodeName&&h.nodeName.toLowerCase();return m==="input"?!!$L[h.type]:m==="textarea"}function Fk(h,m,v,I){ls(I),m=sf(m,"onChange"),0<m.length&&(v=new Ex("onChange","change",null,v,I),h.push({event:v,listeners:m}))}var nu=null,su=null;function EL(h){tC(h,0)}function Jh(h){var m=vl(h);if(ue(m))return h}function AL(h,m){if(h==="change")return m}var Ok=!1;if(a){var Mx;if(a){var Lx="oninput"in document;if(!Lx){var _k=document.createElement("div");_k.setAttribute("oninput","return;"),Lx=typeof _k.oninput=="function"}Mx=Lx}else Mx=!1;Ok=Mx&&(!document.documentMode||9<document.documentMode)}function zk(){nu&&(nu.detachEvent("onpropertychange",Bk),su=nu=null)}function Bk(h){if(h.propertyName==="value"&&Jh(su)){var m=[];Fk(m,su,h,Vc(h)),Pi(EL,m)}}function jL(h,m,v){h==="focusin"?(zk(),nu=m,su=v,nu.attachEvent("onpropertychange",Bk)):h==="focusout"&&zk()}function RL(h){if(h==="selectionchange"||h==="keyup"||h==="keydown")return Jh(su)}function DL(h,m){if(h==="click")return Jh(m)}function PL(h,m){if(h==="input"||h==="change")return Jh(m)}function ML(h,m){return h===m&&(h!==0||1/h===1/m)||h!==h&&m!==m}var Or=typeof Object.is=="function"?Object.is:ML;function ru(h,m){if(Or(h,m))return!0;if(typeof h!="object"||h===null||typeof m!="object"||m===null)return!1;var v=Object.keys(h),I=Object.keys(m);if(v.length!==I.length)return!1;for(I=0;I<v.length;I++){var $=v[I];if(!l.call(m,$)||!Or(h[$],m[$]))return!1}return!0}function Wk(h){for(;h&&h.firstChild;)h=h.firstChild;return h}function Vk(h,m){var v=Wk(h);h=0;for(var I;v;){if(v.nodeType===3){if(I=h+v.textContent.length,h<=m&&I>=m)return{node:v,offset:m-h};h=I}e:{for(;v;){if(v.nextSibling){v=v.nextSibling;break e}v=v.parentNode}v=void 0}v=Wk(v)}}function Uk(h,m){return h&&m?h===m?!0:h&&h.nodeType===3?!1:m&&m.nodeType===3?Uk(h,m.parentNode):"contains"in h?h.contains(m):h.compareDocumentPosition?!!(h.compareDocumentPosition(m)&16):!1:!1}function Gk(){for(var h=window,m=Te();m instanceof h.HTMLIFrameElement;){try{var v=typeof m.contentWindow.location.href=="string"}catch{v=!1}if(v)h=m.contentWindow;else break;m=Te(h.document)}return m}function Fx(h){var m=h&&h.nodeName&&h.nodeName.toLowerCase();return m&&(m==="input"&&(h.type==="text"||h.type==="search"||h.type==="tel"||h.type==="url"||h.type==="password")||m==="textarea"||h.contentEditable==="true")}function LL(h){var m=Gk(),v=h.focusedElem,I=h.selectionRange;if(m!==v&&v&&v.ownerDocument&&Uk(v.ownerDocument.documentElement,v)){if(I!==null&&Fx(v)){if(m=I.start,h=I.end,h===void 0&&(h=m),"selectionStart"in v)v.selectionStart=m,v.selectionEnd=Math.min(h,v.value.length);else if(h=(m=v.ownerDocument||document)&&m.defaultView||window,h.getSelection){h=h.getSelection();var $=v.textContent.length,D=Math.min(I.start,$);I=I.end===void 0?D:Math.min(I.end,$),!h.extend&&D>I&&($=I,I=D,D=$),$=Vk(v,D);var F=Vk(v,I);$&&F&&(h.rangeCount!==1||h.anchorNode!==$.node||h.anchorOffset!==$.offset||h.focusNode!==F.node||h.focusOffset!==F.offset)&&(m=m.createRange(),m.setStart($.node,$.offset),h.removeAllRanges(),D>I?(h.addRange(m),h.extend(F.node,F.offset)):(m.setEnd(F.node,F.offset),h.addRange(m)))}}for(m=[],h=v;h=h.parentNode;)h.nodeType===1&&m.push({element:h,left:h.scrollLeft,top:h.scrollTop});for(typeof v.focus=="function"&&v.focus(),v=0;v<m.length;v++)h=m[v],h.element.scrollLeft=h.left,h.element.scrollTop=h.top}}var FL=a&&"documentMode"in document&&11>=document.documentMode,ml=null,Ox=null,iu=null,_x=!1;function Hk(h,m,v){var I=v.window===v?v.document:v.nodeType===9?v:v.ownerDocument;_x||ml==null||ml!==Te(I)||(I=ml,"selectionStart"in I&&Fx(I)?I={start:I.selectionStart,end:I.selectionEnd}:(I=(I.ownerDocument&&I.ownerDocument.defaultView||window).getSelection(),I={anchorNode:I.anchorNode,anchorOffset:I.anchorOffset,focusNode:I.focusNode,focusOffset:I.focusOffset}),iu&&ru(iu,I)||(iu=I,I=sf(Ox,"onSelect"),0<I.length&&(m=new Ex("onSelect","select",null,m,v),h.push({event:m,listeners:I}),m.target=ml)))}function ef(h,m){var v={};return v[h.toLowerCase()]=m.toLowerCase(),v["Webkit"+h]="webkit"+m,v["Moz"+h]="moz"+m,v}var gl={animationend:ef("Animation","AnimationEnd"),animationiteration:ef("Animation","AnimationIteration"),animationstart:ef("Animation","AnimationStart"),transitionend:ef("Transition","TransitionEnd")},zx={},qk={};a&&(qk=document.createElement("div").style,"AnimationEvent"in window||(delete gl.animationend.animation,delete gl.animationiteration.animation,delete gl.animationstart.animation),"TransitionEvent"in window||delete gl.transitionend.transition);function tf(h){if(zx[h])return zx[h];if(!gl[h])return h;var m=gl[h],v;for(v in m)if(m.hasOwnProperty(v)&&v in qk)return zx[h]=m[v];return h}var Kk=tf("animationend"),Qk=tf("animationiteration"),Xk=tf("animationstart"),Yk=tf("transitionend"),Zk=new Map,Jk="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function yo(h,m){Zk.set(h,m),i(m,[h])}for(var Bx=0;Bx<Jk.length;Bx++){var Wx=Jk[Bx],OL=Wx.toLowerCase(),_L=Wx[0].toUpperCase()+Wx.slice(1);yo(OL,"on"+_L)}yo(Kk,"onAnimationEnd"),yo(Qk,"onAnimationIteration"),yo(Xk,"onAnimationStart"),yo("dblclick","onDoubleClick"),yo("focusin","onFocus"),yo("focusout","onBlur"),yo(Yk,"onTransitionEnd"),o("onMouseEnter",["mouseout","mouseover"]),o("onMouseLeave",["mouseout","mouseover"]),o("onPointerEnter",["pointerout","pointerover"]),o("onPointerLeave",["pointerout","pointerover"]),i("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),i("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),i("onBeforeInput",["compositionend","keypress","textInput","paste"]),i("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),i("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),i("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ou="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),zL=new Set("cancel close invalid load scroll toggle".split(" ").concat(ou));function eC(h,m,v){var I=h.type||"unknown-event";h.currentTarget=v,OM(I,m,void 0,h),h.currentTarget=null}function tC(h,m){m=(m&4)!==0;for(var v=0;v<h.length;v++){var I=h[v],$=I.event;I=I.listeners;e:{var D=void 0;if(m)for(var F=I.length-1;0<=F;F--){var X=I[F],ee=X.instance,xe=X.currentTarget;if(X=X.listener,ee!==D&&$.isPropagationStopped())break e;eC($,X,xe),D=ee}else for(F=0;F<I.length;F++){if(X=I[F],ee=X.instance,xe=X.currentTarget,X=X.listener,ee!==D&&$.isPropagationStopped())break e;eC($,X,xe),D=ee}}}if(Ys)throw h=Mi,Ys=!1,Mi=null,h}function Ht(h,m){var v=m[Xx];v===void 0&&(v=m[Xx]=new Set);var I=h+"__bubble";v.has(I)||(nC(m,h,2,!1),v.add(I))}function Vx(h,m,v){var I=0;m&&(I|=4),nC(v,h,I,m)}var nf="_reactListening"+Math.random().toString(36).slice(2);function au(h){if(!h[nf]){h[nf]=!0,s.forEach(function(v){v!=="selectionchange"&&(zL.has(v)||Vx(v,!1,h),Vx(v,!0,h))});var m=h.nodeType===9?h:h.ownerDocument;m===null||m[nf]||(m[nf]=!0,Vx("selectionchange",!1,m))}}function nC(h,m,v,I){switch(Nk(m)){case 1:var $=eL;break;case 4:$=tL;break;default:$=Ix}v=$.bind(null,m,v,h),$=void 0,!dr||m!=="touchstart"&&m!=="touchmove"&&m!=="wheel"||($=!0),I?$!==void 0?h.addEventListener(m,v,{capture:!0,passive:$}):h.addEventListener(m,v,!0):$!==void 0?h.addEventListener(m,v,{passive:$}):h.addEventListener(m,v,!1)}function Ux(h,m,v,I,$){var D=I;if((m&1)===0&&(m&2)===0&&I!==null)e:for(;;){if(I===null)return;var F=I.tag;if(F===3||F===4){var X=I.stateNode.containerInfo;if(X===$||X.nodeType===8&&X.parentNode===$)break;if(F===4)for(F=I.return;F!==null;){var ee=F.tag;if((ee===3||ee===4)&&(ee=F.stateNode.containerInfo,ee===$||ee.nodeType===8&&ee.parentNode===$))return;F=F.return}for(;X!==null;){if(F=ua(X),F===null)return;if(ee=F.tag,ee===5||ee===6){I=D=F;continue e}X=X.parentNode}}I=I.return}Pi(function(){var xe=D,Ie=Vc(v),Ee=[];e:{var Ne=Zk.get(h);if(Ne!==void 0){var Oe=Ex,Ve=h;switch(h){case"keypress":if(Xh(v)===0)break e;case"keydown":case"keyup":Oe=gL;break;case"focusin":Ve="focus",Oe=Rx;break;case"focusout":Ve="blur",Oe=Rx;break;case"beforeblur":case"afterblur":Oe=Rx;break;case"click":if(v.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Oe=$k;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Oe=rL;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Oe=vL;break;case Kk:case Qk:case Xk:Oe=aL;break;case Yk:Oe=wL;break;case"scroll":Oe=nL;break;case"wheel":Oe=CL;break;case"copy":case"cut":case"paste":Oe=cL;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Oe=Ak}var Ge=(m&4)!==0,bn=!Ge&&h==="scroll",ce=Ge?Ne!==null?Ne+"Capture":null:Ne;Ge=[];for(var se=xe,fe;se!==null;){fe=se;var Re=fe.stateNode;if(fe.tag===5&&Re!==null&&(fe=Re,ce!==null&&(Re=sn(se,ce),Re!=null&&Ge.push(lu(se,Re,fe)))),bn)break;se=se.return}0<Ge.length&&(Ne=new Oe(Ne,Ve,null,v,Ie),Ee.push({event:Ne,listeners:Ge}))}}if((m&7)===0){e:{if(Ne=h==="mouseover"||h==="pointerover",Oe=h==="mouseout"||h==="pointerout",Ne&&v!==Cs&&(Ve=v.relatedTarget||v.fromElement)&&(ua(Ve)||Ve[Li]))break e;if((Oe||Ne)&&(Ne=Ie.window===Ie?Ie:(Ne=Ie.ownerDocument)?Ne.defaultView||Ne.parentWindow:window,Oe?(Ve=v.relatedTarget||v.toElement,Oe=xe,Ve=Ve?ua(Ve):null,Ve!==null&&(bn=ca(Ve),Ve!==bn||Ve.tag!==5&&Ve.tag!==6)&&(Ve=null)):(Oe=null,Ve=xe),Oe!==Ve)){if(Ge=$k,Re="onMouseLeave",ce="onMouseEnter",se="mouse",(h==="pointerout"||h==="pointerover")&&(Ge=Ak,Re="onPointerLeave",ce="onPointerEnter",se="pointer"),bn=Oe==null?Ne:vl(Oe),fe=Ve==null?Ne:vl(Ve),Ne=new Ge(Re,se+"leave",Oe,v,Ie),Ne.target=bn,Ne.relatedTarget=fe,Re=null,ua(Ie)===xe&&(Ge=new Ge(ce,se+"enter",Ve,v,Ie),Ge.target=fe,Ge.relatedTarget=bn,Re=Ge),bn=Re,Oe&&Ve)t:{for(Ge=Oe,ce=Ve,se=0,fe=Ge;fe;fe=xl(fe))se++;for(fe=0,Re=ce;Re;Re=xl(Re))fe++;for(;0<se-fe;)Ge=xl(Ge),se--;for(;0<fe-se;)ce=xl(ce),fe--;for(;se--;){if(Ge===ce||ce!==null&&Ge===ce.alternate)break t;Ge=xl(Ge),ce=xl(ce)}Ge=null}else Ge=null;Oe!==null&&sC(Ee,Ne,Oe,Ge,!1),Ve!==null&&bn!==null&&sC(Ee,bn,Ve,Ge,!0)}}e:{if(Ne=xe?vl(xe):window,Oe=Ne.nodeName&&Ne.nodeName.toLowerCase(),Oe==="select"||Oe==="input"&&Ne.type==="file")var He=AL;else if(Lk(Ne))if(Ok)He=PL;else{He=RL;var Je=jL}else(Oe=Ne.nodeName)&&Oe.toLowerCase()==="input"&&(Ne.type==="checkbox"||Ne.type==="radio")&&(He=DL);if(He&&(He=He(h,xe))){Fk(Ee,He,v,Ie);break e}Je&&Je(h,Ne,xe),h==="focusout"&&(Je=Ne._wrapperState)&&Je.controlled&&Ne.type==="number"&&mt(Ne,"number",Ne.value)}switch(Je=xe?vl(xe):window,h){case"focusin":(Lk(Je)||Je.contentEditable==="true")&&(ml=Je,Ox=xe,iu=null);break;case"focusout":iu=Ox=ml=null;break;case"mousedown":_x=!0;break;case"contextmenu":case"mouseup":case"dragend":_x=!1,Hk(Ee,v,Ie);break;case"selectionchange":if(FL)break;case"keydown":case"keyup":Hk(Ee,v,Ie)}var et;if(Px)e:{switch(h){case"compositionstart":var rt="onCompositionStart";break e;case"compositionend":rt="onCompositionEnd";break e;case"compositionupdate":rt="onCompositionUpdate";break e}rt=void 0}else pl?Pk(h,v)&&(rt="onCompositionEnd"):h==="keydown"&&v.keyCode===229&&(rt="onCompositionStart");rt&&(jk&&v.locale!=="ko"&&(pl||rt!=="onCompositionStart"?rt==="onCompositionEnd"&&pl&&(et=Ik()):(xo=Ie,$x="value"in xo?xo.value:xo.textContent,pl=!0)),Je=sf(xe,rt),0<Je.length&&(rt=new Ek(rt,h,null,v,Ie),Ee.push({event:rt,listeners:Je}),et?rt.data=et:(et=Mk(v),et!==null&&(rt.data=et)))),(et=NL?IL(h,v):TL(h,v))&&(xe=sf(xe,"onBeforeInput"),0<xe.length&&(Ie=new Ek("onBeforeInput","beforeinput",null,v,Ie),Ee.push({event:Ie,listeners:xe}),Ie.data=et))}tC(Ee,m)})}function lu(h,m,v){return{instance:h,listener:m,currentTarget:v}}function sf(h,m){for(var v=m+"Capture",I=[];h!==null;){var $=h,D=$.stateNode;$.tag===5&&D!==null&&($=D,D=sn(h,v),D!=null&&I.unshift(lu(h,D,$)),D=sn(h,m),D!=null&&I.push(lu(h,D,$))),h=h.return}return I}function xl(h){if(h===null)return null;do h=h.return;while(h&&h.tag!==5);return h||null}function sC(h,m,v,I,$){for(var D=m._reactName,F=[];v!==null&&v!==I;){var X=v,ee=X.alternate,xe=X.stateNode;if(ee!==null&&ee===I)break;X.tag===5&&xe!==null&&(X=xe,$?(ee=sn(v,D),ee!=null&&F.unshift(lu(v,ee,X))):$||(ee=sn(v,D),ee!=null&&F.push(lu(v,ee,X)))),v=v.return}F.length!==0&&h.push({event:m,listeners:F})}var BL=/\r\n?/g,WL=/\u0000|\uFFFD/g;function rC(h){return(typeof h=="string"?h:""+h).replace(BL,`
`).replace(WL,"")}function rf(h,m,v){if(m=rC(m),rC(h)!==m&&v)throw Error(t(425))}function of(){}var Gx=null,Hx=null;function qx(h,m){return h==="textarea"||h==="noscript"||typeof m.children=="string"||typeof m.children=="number"||typeof m.dangerouslySetInnerHTML=="object"&&m.dangerouslySetInnerHTML!==null&&m.dangerouslySetInnerHTML.__html!=null}var Kx=typeof setTimeout=="function"?setTimeout:void 0,VL=typeof clearTimeout=="function"?clearTimeout:void 0,iC=typeof Promise=="function"?Promise:void 0,UL=typeof queueMicrotask=="function"?queueMicrotask:typeof iC<"u"?function(h){return iC.resolve(null).then(h).catch(GL)}:Kx;function GL(h){setTimeout(function(){throw h})}function Qx(h,m){var v=m,I=0;do{var $=v.nextSibling;if(h.removeChild(v),$&&$.nodeType===8)if(v=$.data,v==="/$"){if(I===0){h.removeChild($),Zc(m);return}I--}else v!=="$"&&v!=="$?"&&v!=="$!"||I++;v=$}while(v);Zc(m)}function vo(h){for(;h!=null;h=h.nextSibling){var m=h.nodeType;if(m===1||m===3)break;if(m===8){if(m=h.data,m==="$"||m==="$!"||m==="$?")break;if(m==="/$")return null}}return h}function oC(h){h=h.previousSibling;for(var m=0;h;){if(h.nodeType===8){var v=h.data;if(v==="$"||v==="$!"||v==="$?"){if(m===0)return h;m--}else v==="/$"&&m++}h=h.previousSibling}return null}var yl=Math.random().toString(36).slice(2),ci="__reactFiber$"+yl,cu="__reactProps$"+yl,Li="__reactContainer$"+yl,Xx="__reactEvents$"+yl,HL="__reactListeners$"+yl,qL="__reactHandles$"+yl;function ua(h){var m=h[ci];if(m)return m;for(var v=h.parentNode;v;){if(m=v[Li]||v[ci]){if(v=m.alternate,m.child!==null||v!==null&&v.child!==null)for(h=oC(h);h!==null;){if(v=h[ci])return v;h=oC(h)}return m}h=v,v=h.parentNode}return null}function uu(h){return h=h[ci]||h[Li],!h||h.tag!==5&&h.tag!==6&&h.tag!==13&&h.tag!==3?null:h}function vl(h){if(h.tag===5||h.tag===6)return h.stateNode;throw Error(t(33))}function af(h){return h[cu]||null}var Yx=[],bl=-1;function bo(h){return{current:h}}function qt(h){0>bl||(h.current=Yx[bl],Yx[bl]=null,bl--)}function zt(h,m){bl++,Yx[bl]=h.current,h.current=m}var wo={},ds=bo(wo),_s=bo(!1),da=wo;function wl(h,m){var v=h.type.contextTypes;if(!v)return wo;var I=h.stateNode;if(I&&I.__reactInternalMemoizedUnmaskedChildContext===m)return I.__reactInternalMemoizedMaskedChildContext;var $={},D;for(D in v)$[D]=m[D];return I&&(h=h.stateNode,h.__reactInternalMemoizedUnmaskedChildContext=m,h.__reactInternalMemoizedMaskedChildContext=$),$}function zs(h){return h=h.childContextTypes,h!=null}function lf(){qt(_s),qt(ds)}function aC(h,m,v){if(ds.current!==wo)throw Error(t(168));zt(ds,m),zt(_s,v)}function lC(h,m,v){var I=h.stateNode;if(m=m.childContextTypes,typeof I.getChildContext!="function")return v;I=I.getChildContext();for(var $ in I)if(!($ in m))throw Error(t(108,pe(h)||"Unknown",$));return Q({},v,I)}function cf(h){return h=(h=h.stateNode)&&h.__reactInternalMemoizedMergedChildContext||wo,da=ds.current,zt(ds,h),zt(_s,_s.current),!0}function cC(h,m,v){var I=h.stateNode;if(!I)throw Error(t(169));v?(h=lC(h,m,da),I.__reactInternalMemoizedMergedChildContext=h,qt(_s),qt(ds),zt(ds,h)):qt(_s),zt(_s,v)}var Fi=null,uf=!1,Zx=!1;function uC(h){Fi===null?Fi=[h]:Fi.push(h)}function KL(h){uf=!0,uC(h)}function ko(){if(!Zx&&Fi!==null){Zx=!0;var h=0,m=Dt;try{var v=Fi;for(Dt=1;h<v.length;h++){var I=v[h];do I=I(!0);while(I!==null)}Fi=null,uf=!1}catch($){throw Fi!==null&&(Fi=Fi.slice(h+1)),hk(bx,ko),$}finally{Dt=m,Zx=!1}}return null}var kl=[],Cl=0,df=null,hf=0,hr=[],fr=0,ha=null,Oi=1,_i="";function fa(h,m){kl[Cl++]=hf,kl[Cl++]=df,df=h,hf=m}function dC(h,m,v){hr[fr++]=Oi,hr[fr++]=_i,hr[fr++]=ha,ha=h;var I=Oi;h=_i;var $=32-Fr(I)-1;I&=~(1<<$),v+=1;var D=32-Fr(m)+$;if(30<D){var F=$-$%5;D=(I&(1<<F)-1).toString(32),I>>=F,$-=F,Oi=1<<32-Fr(m)+$|v<<$|I,_i=D+h}else Oi=1<<D|v<<$|I,_i=h}function Jx(h){h.return!==null&&(fa(h,1),dC(h,1,0))}function ey(h){for(;h===df;)df=kl[--Cl],kl[Cl]=null,hf=kl[--Cl],kl[Cl]=null;for(;h===ha;)ha=hr[--fr],hr[fr]=null,_i=hr[--fr],hr[fr]=null,Oi=hr[--fr],hr[fr]=null}var Js=null,er=null,Zt=!1,_r=null;function hC(h,m){var v=xr(5,null,null,0);v.elementType="DELETED",v.stateNode=m,v.return=h,m=h.deletions,m===null?(h.deletions=[v],h.flags|=16):m.push(v)}function fC(h,m){switch(h.tag){case 5:var v=h.type;return m=m.nodeType!==1||v.toLowerCase()!==m.nodeName.toLowerCase()?null:m,m!==null?(h.stateNode=m,Js=h,er=vo(m.firstChild),!0):!1;case 6:return m=h.pendingProps===""||m.nodeType!==3?null:m,m!==null?(h.stateNode=m,Js=h,er=null,!0):!1;case 13:return m=m.nodeType!==8?null:m,m!==null?(v=ha!==null?{id:Oi,overflow:_i}:null,h.memoizedState={dehydrated:m,treeContext:v,retryLane:1073741824},v=xr(18,null,null,0),v.stateNode=m,v.return=h,h.child=v,Js=h,er=null,!0):!1;default:return!1}}function ty(h){return(h.mode&1)!==0&&(h.flags&128)===0}function ny(h){if(Zt){var m=er;if(m){var v=m;if(!fC(h,m)){if(ty(h))throw Error(t(418));m=vo(v.nextSibling);var I=Js;m&&fC(h,m)?hC(I,v):(h.flags=h.flags&-4097|2,Zt=!1,Js=h)}}else{if(ty(h))throw Error(t(418));h.flags=h.flags&-4097|2,Zt=!1,Js=h}}}function pC(h){for(h=h.return;h!==null&&h.tag!==5&&h.tag!==3&&h.tag!==13;)h=h.return;Js=h}function ff(h){if(h!==Js)return!1;if(!Zt)return pC(h),Zt=!0,!1;var m;if((m=h.tag!==3)&&!(m=h.tag!==5)&&(m=h.type,m=m!=="head"&&m!=="body"&&!qx(h.type,h.memoizedProps)),m&&(m=er)){if(ty(h))throw mC(),Error(t(418));for(;m;)hC(h,m),m=vo(m.nextSibling)}if(pC(h),h.tag===13){if(h=h.memoizedState,h=h!==null?h.dehydrated:null,!h)throw Error(t(317));e:{for(h=h.nextSibling,m=0;h;){if(h.nodeType===8){var v=h.data;if(v==="/$"){if(m===0){er=vo(h.nextSibling);break e}m--}else v!=="$"&&v!=="$!"&&v!=="$?"||m++}h=h.nextSibling}er=null}}else er=Js?vo(h.stateNode.nextSibling):null;return!0}function mC(){for(var h=er;h;)h=vo(h.nextSibling)}function Sl(){er=Js=null,Zt=!1}function sy(h){_r===null?_r=[h]:_r.push(h)}var QL=C.ReactCurrentBatchConfig;function du(h,m,v){if(h=v.ref,h!==null&&typeof h!="function"&&typeof h!="object"){if(v._owner){if(v=v._owner,v){if(v.tag!==1)throw Error(t(309));var I=v.stateNode}if(!I)throw Error(t(147,h));var $=I,D=""+h;return m!==null&&m.ref!==null&&typeof m.ref=="function"&&m.ref._stringRef===D?m.ref:(m=function(F){var X=$.refs;F===null?delete X[D]:X[D]=F},m._stringRef=D,m)}if(typeof h!="string")throw Error(t(284));if(!v._owner)throw Error(t(290,h))}return h}function pf(h,m){throw h=Object.prototype.toString.call(m),Error(t(31,h==="[object Object]"?"object with keys {"+Object.keys(m).join(", ")+"}":h))}function gC(h){var m=h._init;return m(h._payload)}function xC(h){function m(ce,se){if(h){var fe=ce.deletions;fe===null?(ce.deletions=[se],ce.flags|=16):fe.push(se)}}function v(ce,se){if(!h)return null;for(;se!==null;)m(ce,se),se=se.sibling;return null}function I(ce,se){for(ce=new Map;se!==null;)se.key!==null?ce.set(se.key,se):ce.set(se.index,se),se=se.sibling;return ce}function $(ce,se){return ce=Ao(ce,se),ce.index=0,ce.sibling=null,ce}function D(ce,se,fe){return ce.index=fe,h?(fe=ce.alternate,fe!==null?(fe=fe.index,fe<se?(ce.flags|=2,se):fe):(ce.flags|=2,se)):(ce.flags|=1048576,se)}function F(ce){return h&&ce.alternate===null&&(ce.flags|=2),ce}function X(ce,se,fe,Re){return se===null||se.tag!==6?(se=Ky(fe,ce.mode,Re),se.return=ce,se):(se=$(se,fe),se.return=ce,se)}function ee(ce,se,fe,Re){var He=fe.type;return He===A?Ie(ce,se,fe.props.children,Re,fe.key):se!==null&&(se.elementType===He||typeof He=="object"&&He!==null&&He.$$typeof===W&&gC(He)===se.type)?(Re=$(se,fe.props),Re.ref=du(ce,se,fe),Re.return=ce,Re):(Re=Of(fe.type,fe.key,fe.props,null,ce.mode,Re),Re.ref=du(ce,se,fe),Re.return=ce,Re)}function xe(ce,se,fe,Re){return se===null||se.tag!==4||se.stateNode.containerInfo!==fe.containerInfo||se.stateNode.implementation!==fe.implementation?(se=Qy(fe,ce.mode,Re),se.return=ce,se):(se=$(se,fe.children||[]),se.return=ce,se)}function Ie(ce,se,fe,Re,He){return se===null||se.tag!==7?(se=wa(fe,ce.mode,Re,He),se.return=ce,se):(se=$(se,fe),se.return=ce,se)}function Ee(ce,se,fe){if(typeof se=="string"&&se!==""||typeof se=="number")return se=Ky(""+se,ce.mode,fe),se.return=ce,se;if(typeof se=="object"&&se!==null){switch(se.$$typeof){case S:return fe=Of(se.type,se.key,se.props,null,ce.mode,fe),fe.ref=du(ce,null,se),fe.return=ce,fe;case T:return se=Qy(se,ce.mode,fe),se.return=ce,se;case W:var Re=se._init;return Ee(ce,Re(se._payload),fe)}if(le(se)||q(se))return se=wa(se,ce.mode,fe,null),se.return=ce,se;pf(ce,se)}return null}function Ne(ce,se,fe,Re){var He=se!==null?se.key:null;if(typeof fe=="string"&&fe!==""||typeof fe=="number")return He!==null?null:X(ce,se,""+fe,Re);if(typeof fe=="object"&&fe!==null){switch(fe.$$typeof){case S:return fe.key===He?ee(ce,se,fe,Re):null;case T:return fe.key===He?xe(ce,se,fe,Re):null;case W:return He=fe._init,Ne(ce,se,He(fe._payload),Re)}if(le(fe)||q(fe))return He!==null?null:Ie(ce,se,fe,Re,null);pf(ce,fe)}return null}function Oe(ce,se,fe,Re,He){if(typeof Re=="string"&&Re!==""||typeof Re=="number")return ce=ce.get(fe)||null,X(se,ce,""+Re,He);if(typeof Re=="object"&&Re!==null){switch(Re.$$typeof){case S:return ce=ce.get(Re.key===null?fe:Re.key)||null,ee(se,ce,Re,He);case T:return ce=ce.get(Re.key===null?fe:Re.key)||null,xe(se,ce,Re,He);case W:var Je=Re._init;return Oe(ce,se,fe,Je(Re._payload),He)}if(le(Re)||q(Re))return ce=ce.get(fe)||null,Ie(se,ce,Re,He,null);pf(se,Re)}return null}function Ve(ce,se,fe,Re){for(var He=null,Je=null,et=se,rt=se=0,Vn=null;et!==null&&rt<fe.length;rt++){et.index>rt?(Vn=et,et=null):Vn=et.sibling;var It=Ne(ce,et,fe[rt],Re);if(It===null){et===null&&(et=Vn);break}h&&et&&It.alternate===null&&m(ce,et),se=D(It,se,rt),Je===null?He=It:Je.sibling=It,Je=It,et=Vn}if(rt===fe.length)return v(ce,et),Zt&&fa(ce,rt),He;if(et===null){for(;rt<fe.length;rt++)et=Ee(ce,fe[rt],Re),et!==null&&(se=D(et,se,rt),Je===null?He=et:Je.sibling=et,Je=et);return Zt&&fa(ce,rt),He}for(et=I(ce,et);rt<fe.length;rt++)Vn=Oe(et,ce,rt,fe[rt],Re),Vn!==null&&(h&&Vn.alternate!==null&&et.delete(Vn.key===null?rt:Vn.key),se=D(Vn,se,rt),Je===null?He=Vn:Je.sibling=Vn,Je=Vn);return h&&et.forEach(function(jo){return m(ce,jo)}),Zt&&fa(ce,rt),He}function Ge(ce,se,fe,Re){var He=q(fe);if(typeof He!="function")throw Error(t(150));if(fe=He.call(fe),fe==null)throw Error(t(151));for(var Je=He=null,et=se,rt=se=0,Vn=null,It=fe.next();et!==null&&!It.done;rt++,It=fe.next()){et.index>rt?(Vn=et,et=null):Vn=et.sibling;var jo=Ne(ce,et,It.value,Re);if(jo===null){et===null&&(et=Vn);break}h&&et&&jo.alternate===null&&m(ce,et),se=D(jo,se,rt),Je===null?He=jo:Je.sibling=jo,Je=jo,et=Vn}if(It.done)return v(ce,et),Zt&&fa(ce,rt),He;if(et===null){for(;!It.done;rt++,It=fe.next())It=Ee(ce,It.value,Re),It!==null&&(se=D(It,se,rt),Je===null?He=It:Je.sibling=It,Je=It);return Zt&&fa(ce,rt),He}for(et=I(ce,et);!It.done;rt++,It=fe.next())It=Oe(et,ce,rt,It.value,Re),It!==null&&(h&&It.alternate!==null&&et.delete(It.key===null?rt:It.key),se=D(It,se,rt),Je===null?He=It:Je.sibling=It,Je=It);return h&&et.forEach(function($3){return m(ce,$3)}),Zt&&fa(ce,rt),He}function bn(ce,se,fe,Re){if(typeof fe=="object"&&fe!==null&&fe.type===A&&fe.key===null&&(fe=fe.props.children),typeof fe=="object"&&fe!==null){switch(fe.$$typeof){case S:e:{for(var He=fe.key,Je=se;Je!==null;){if(Je.key===He){if(He=fe.type,He===A){if(Je.tag===7){v(ce,Je.sibling),se=$(Je,fe.props.children),se.return=ce,ce=se;break e}}else if(Je.elementType===He||typeof He=="object"&&He!==null&&He.$$typeof===W&&gC(He)===Je.type){v(ce,Je.sibling),se=$(Je,fe.props),se.ref=du(ce,Je,fe),se.return=ce,ce=se;break e}v(ce,Je);break}else m(ce,Je);Je=Je.sibling}fe.type===A?(se=wa(fe.props.children,ce.mode,Re,fe.key),se.return=ce,ce=se):(Re=Of(fe.type,fe.key,fe.props,null,ce.mode,Re),Re.ref=du(ce,se,fe),Re.return=ce,ce=Re)}return F(ce);case T:e:{for(Je=fe.key;se!==null;){if(se.key===Je)if(se.tag===4&&se.stateNode.containerInfo===fe.containerInfo&&se.stateNode.implementation===fe.implementation){v(ce,se.sibling),se=$(se,fe.children||[]),se.return=ce,ce=se;break e}else{v(ce,se);break}else m(ce,se);se=se.sibling}se=Qy(fe,ce.mode,Re),se.return=ce,ce=se}return F(ce);case W:return Je=fe._init,bn(ce,se,Je(fe._payload),Re)}if(le(fe))return Ve(ce,se,fe,Re);if(q(fe))return Ge(ce,se,fe,Re);pf(ce,fe)}return typeof fe=="string"&&fe!==""||typeof fe=="number"?(fe=""+fe,se!==null&&se.tag===6?(v(ce,se.sibling),se=$(se,fe),se.return=ce,ce=se):(v(ce,se),se=Ky(fe,ce.mode,Re),se.return=ce,ce=se),F(ce)):v(ce,se)}return bn}var Nl=xC(!0),yC=xC(!1),mf=bo(null),gf=null,Il=null,ry=null;function iy(){ry=Il=gf=null}function oy(h){var m=mf.current;qt(mf),h._currentValue=m}function ay(h,m,v){for(;h!==null;){var I=h.alternate;if((h.childLanes&m)!==m?(h.childLanes|=m,I!==null&&(I.childLanes|=m)):I!==null&&(I.childLanes&m)!==m&&(I.childLanes|=m),h===v)break;h=h.return}}function Tl(h,m){gf=h,ry=Il=null,h=h.dependencies,h!==null&&h.firstContext!==null&&((h.lanes&m)!==0&&(Bs=!0),h.firstContext=null)}function pr(h){var m=h._currentValue;if(ry!==h)if(h={context:h,memoizedValue:m,next:null},Il===null){if(gf===null)throw Error(t(308));Il=h,gf.dependencies={lanes:0,firstContext:h}}else Il=Il.next=h;return m}var pa=null;function ly(h){pa===null?pa=[h]:pa.push(h)}function vC(h,m,v,I){var $=m.interleaved;return $===null?(v.next=v,ly(m)):(v.next=$.next,$.next=v),m.interleaved=v,zi(h,I)}function zi(h,m){h.lanes|=m;var v=h.alternate;for(v!==null&&(v.lanes|=m),v=h,h=h.return;h!==null;)h.childLanes|=m,v=h.alternate,v!==null&&(v.childLanes|=m),v=h,h=h.return;return v.tag===3?v.stateNode:null}var Co=!1;function cy(h){h.updateQueue={baseState:h.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function bC(h,m){h=h.updateQueue,m.updateQueue===h&&(m.updateQueue={baseState:h.baseState,firstBaseUpdate:h.firstBaseUpdate,lastBaseUpdate:h.lastBaseUpdate,shared:h.shared,effects:h.effects})}function Bi(h,m){return{eventTime:h,lane:m,tag:0,payload:null,callback:null,next:null}}function So(h,m,v){var I=h.updateQueue;if(I===null)return null;if(I=I.shared,(Nt&2)!==0){var $=I.pending;return $===null?m.next=m:(m.next=$.next,$.next=m),I.pending=m,zi(h,v)}return $=I.interleaved,$===null?(m.next=m,ly(I)):(m.next=$.next,$.next=m),I.interleaved=m,zi(h,v)}function xf(h,m,v){if(m=m.updateQueue,m!==null&&(m=m.shared,(v&4194240)!==0)){var I=m.lanes;I&=h.pendingLanes,v|=I,m.lanes=v,Cx(h,v)}}function wC(h,m){var v=h.updateQueue,I=h.alternate;if(I!==null&&(I=I.updateQueue,v===I)){var $=null,D=null;if(v=v.firstBaseUpdate,v!==null){do{var F={eventTime:v.eventTime,lane:v.lane,tag:v.tag,payload:v.payload,callback:v.callback,next:null};D===null?$=D=F:D=D.next=F,v=v.next}while(v!==null);D===null?$=D=m:D=D.next=m}else $=D=m;v={baseState:I.baseState,firstBaseUpdate:$,lastBaseUpdate:D,shared:I.shared,effects:I.effects},h.updateQueue=v;return}h=v.lastBaseUpdate,h===null?v.firstBaseUpdate=m:h.next=m,v.lastBaseUpdate=m}function yf(h,m,v,I){var $=h.updateQueue;Co=!1;var D=$.firstBaseUpdate,F=$.lastBaseUpdate,X=$.shared.pending;if(X!==null){$.shared.pending=null;var ee=X,xe=ee.next;ee.next=null,F===null?D=xe:F.next=xe,F=ee;var Ie=h.alternate;Ie!==null&&(Ie=Ie.updateQueue,X=Ie.lastBaseUpdate,X!==F&&(X===null?Ie.firstBaseUpdate=xe:X.next=xe,Ie.lastBaseUpdate=ee))}if(D!==null){var Ee=$.baseState;F=0,Ie=xe=ee=null,X=D;do{var Ne=X.lane,Oe=X.eventTime;if((I&Ne)===Ne){Ie!==null&&(Ie=Ie.next={eventTime:Oe,lane:0,tag:X.tag,payload:X.payload,callback:X.callback,next:null});e:{var Ve=h,Ge=X;switch(Ne=m,Oe=v,Ge.tag){case 1:if(Ve=Ge.payload,typeof Ve=="function"){Ee=Ve.call(Oe,Ee,Ne);break e}Ee=Ve;break e;case 3:Ve.flags=Ve.flags&-65537|128;case 0:if(Ve=Ge.payload,Ne=typeof Ve=="function"?Ve.call(Oe,Ee,Ne):Ve,Ne==null)break e;Ee=Q({},Ee,Ne);break e;case 2:Co=!0}}X.callback!==null&&X.lane!==0&&(h.flags|=64,Ne=$.effects,Ne===null?$.effects=[X]:Ne.push(X))}else Oe={eventTime:Oe,lane:Ne,tag:X.tag,payload:X.payload,callback:X.callback,next:null},Ie===null?(xe=Ie=Oe,ee=Ee):Ie=Ie.next=Oe,F|=Ne;if(X=X.next,X===null){if(X=$.shared.pending,X===null)break;Ne=X,X=Ne.next,Ne.next=null,$.lastBaseUpdate=Ne,$.shared.pending=null}}while(!0);if(Ie===null&&(ee=Ee),$.baseState=ee,$.firstBaseUpdate=xe,$.lastBaseUpdate=Ie,m=$.shared.interleaved,m!==null){$=m;do F|=$.lane,$=$.next;while($!==m)}else D===null&&($.shared.lanes=0);xa|=F,h.lanes=F,h.memoizedState=Ee}}function kC(h,m,v){if(h=m.effects,m.effects=null,h!==null)for(m=0;m<h.length;m++){var I=h[m],$=I.callback;if($!==null){if(I.callback=null,I=v,typeof $!="function")throw Error(t(191,$));$.call(I)}}}var hu={},ui=bo(hu),fu=bo(hu),pu=bo(hu);function ma(h){if(h===hu)throw Error(t(174));return h}function uy(h,m){switch(zt(pu,m),zt(fu,h),zt(ui,hu),h=m.nodeType,h){case 9:case 11:m=(m=m.documentElement)?m.namespaceURI:Ut(null,"");break;default:h=h===8?m.parentNode:m,m=h.namespaceURI||null,h=h.tagName,m=Ut(m,h)}qt(ui),zt(ui,m)}function $l(){qt(ui),qt(fu),qt(pu)}function CC(h){ma(pu.current);var m=ma(ui.current),v=Ut(m,h.type);m!==v&&(zt(fu,h),zt(ui,v))}function dy(h){fu.current===h&&(qt(ui),qt(fu))}var rn=bo(0);function vf(h){for(var m=h;m!==null;){if(m.tag===13){var v=m.memoizedState;if(v!==null&&(v=v.dehydrated,v===null||v.data==="$?"||v.data==="$!"))return m}else if(m.tag===19&&m.memoizedProps.revealOrder!==void 0){if((m.flags&128)!==0)return m}else if(m.child!==null){m.child.return=m,m=m.child;continue}if(m===h)break;for(;m.sibling===null;){if(m.return===null||m.return===h)return null;m=m.return}m.sibling.return=m.return,m=m.sibling}return null}var hy=[];function fy(){for(var h=0;h<hy.length;h++)hy[h]._workInProgressVersionPrimary=null;hy.length=0}var bf=C.ReactCurrentDispatcher,py=C.ReactCurrentBatchConfig,ga=0,on=null,Rn=null,Bn=null,wf=!1,mu=!1,gu=0,XL=0;function hs(){throw Error(t(321))}function my(h,m){if(m===null)return!1;for(var v=0;v<m.length&&v<h.length;v++)if(!Or(h[v],m[v]))return!1;return!0}function gy(h,m,v,I,$,D){if(ga=D,on=m,m.memoizedState=null,m.updateQueue=null,m.lanes=0,bf.current=h===null||h.memoizedState===null?e3:t3,h=v(I,$),mu){D=0;do{if(mu=!1,gu=0,25<=D)throw Error(t(301));D+=1,Bn=Rn=null,m.updateQueue=null,bf.current=n3,h=v(I,$)}while(mu)}if(bf.current=Sf,m=Rn!==null&&Rn.next!==null,ga=0,Bn=Rn=on=null,wf=!1,m)throw Error(t(300));return h}function xy(){var h=gu!==0;return gu=0,h}function di(){var h={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Bn===null?on.memoizedState=Bn=h:Bn=Bn.next=h,Bn}function mr(){if(Rn===null){var h=on.alternate;h=h!==null?h.memoizedState:null}else h=Rn.next;var m=Bn===null?on.memoizedState:Bn.next;if(m!==null)Bn=m,Rn=h;else{if(h===null)throw Error(t(310));Rn=h,h={memoizedState:Rn.memoizedState,baseState:Rn.baseState,baseQueue:Rn.baseQueue,queue:Rn.queue,next:null},Bn===null?on.memoizedState=Bn=h:Bn=Bn.next=h}return Bn}function xu(h,m){return typeof m=="function"?m(h):m}function yy(h){var m=mr(),v=m.queue;if(v===null)throw Error(t(311));v.lastRenderedReducer=h;var I=Rn,$=I.baseQueue,D=v.pending;if(D!==null){if($!==null){var F=$.next;$.next=D.next,D.next=F}I.baseQueue=$=D,v.pending=null}if($!==null){D=$.next,I=I.baseState;var X=F=null,ee=null,xe=D;do{var Ie=xe.lane;if((ga&Ie)===Ie)ee!==null&&(ee=ee.next={lane:0,action:xe.action,hasEagerState:xe.hasEagerState,eagerState:xe.eagerState,next:null}),I=xe.hasEagerState?xe.eagerState:h(I,xe.action);else{var Ee={lane:Ie,action:xe.action,hasEagerState:xe.hasEagerState,eagerState:xe.eagerState,next:null};ee===null?(X=ee=Ee,F=I):ee=ee.next=Ee,on.lanes|=Ie,xa|=Ie}xe=xe.next}while(xe!==null&&xe!==D);ee===null?F=I:ee.next=X,Or(I,m.memoizedState)||(Bs=!0),m.memoizedState=I,m.baseState=F,m.baseQueue=ee,v.lastRenderedState=I}if(h=v.interleaved,h!==null){$=h;do D=$.lane,on.lanes|=D,xa|=D,$=$.next;while($!==h)}else $===null&&(v.lanes=0);return[m.memoizedState,v.dispatch]}function vy(h){var m=mr(),v=m.queue;if(v===null)throw Error(t(311));v.lastRenderedReducer=h;var I=v.dispatch,$=v.pending,D=m.memoizedState;if($!==null){v.pending=null;var F=$=$.next;do D=h(D,F.action),F=F.next;while(F!==$);Or(D,m.memoizedState)||(Bs=!0),m.memoizedState=D,m.baseQueue===null&&(m.baseState=D),v.lastRenderedState=D}return[D,I]}function SC(){}function NC(h,m){var v=on,I=mr(),$=m(),D=!Or(I.memoizedState,$);if(D&&(I.memoizedState=$,Bs=!0),I=I.queue,by($C.bind(null,v,I,h),[h]),I.getSnapshot!==m||D||Bn!==null&&Bn.memoizedState.tag&1){if(v.flags|=2048,yu(9,TC.bind(null,v,I,$,m),void 0,null),Wn===null)throw Error(t(349));(ga&30)!==0||IC(v,m,$)}return $}function IC(h,m,v){h.flags|=16384,h={getSnapshot:m,value:v},m=on.updateQueue,m===null?(m={lastEffect:null,stores:null},on.updateQueue=m,m.stores=[h]):(v=m.stores,v===null?m.stores=[h]:v.push(h))}function TC(h,m,v,I){m.value=v,m.getSnapshot=I,EC(m)&&AC(h)}function $C(h,m,v){return v(function(){EC(m)&&AC(h)})}function EC(h){var m=h.getSnapshot;h=h.value;try{var v=m();return!Or(h,v)}catch{return!0}}function AC(h){var m=zi(h,1);m!==null&&Vr(m,h,1,-1)}function jC(h){var m=di();return typeof h=="function"&&(h=h()),m.memoizedState=m.baseState=h,h={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:xu,lastRenderedState:h},m.queue=h,h=h.dispatch=JL.bind(null,on,h),[m.memoizedState,h]}function yu(h,m,v,I){return h={tag:h,create:m,destroy:v,deps:I,next:null},m=on.updateQueue,m===null?(m={lastEffect:null,stores:null},on.updateQueue=m,m.lastEffect=h.next=h):(v=m.lastEffect,v===null?m.lastEffect=h.next=h:(I=v.next,v.next=h,h.next=I,m.lastEffect=h)),h}function RC(){return mr().memoizedState}function kf(h,m,v,I){var $=di();on.flags|=h,$.memoizedState=yu(1|m,v,void 0,I===void 0?null:I)}function Cf(h,m,v,I){var $=mr();I=I===void 0?null:I;var D=void 0;if(Rn!==null){var F=Rn.memoizedState;if(D=F.destroy,I!==null&&my(I,F.deps)){$.memoizedState=yu(m,v,D,I);return}}on.flags|=h,$.memoizedState=yu(1|m,v,D,I)}function DC(h,m){return kf(8390656,8,h,m)}function by(h,m){return Cf(2048,8,h,m)}function PC(h,m){return Cf(4,2,h,m)}function MC(h,m){return Cf(4,4,h,m)}function LC(h,m){if(typeof m=="function")return h=h(),m(h),function(){m(null)};if(m!=null)return h=h(),m.current=h,function(){m.current=null}}function FC(h,m,v){return v=v!=null?v.concat([h]):null,Cf(4,4,LC.bind(null,m,h),v)}function wy(){}function OC(h,m){var v=mr();m=m===void 0?null:m;var I=v.memoizedState;return I!==null&&m!==null&&my(m,I[1])?I[0]:(v.memoizedState=[h,m],h)}function _C(h,m){var v=mr();m=m===void 0?null:m;var I=v.memoizedState;return I!==null&&m!==null&&my(m,I[1])?I[0]:(h=h(),v.memoizedState=[h,m],h)}function zC(h,m,v){return(ga&21)===0?(h.baseState&&(h.baseState=!1,Bs=!0),h.memoizedState=v):(Or(v,m)||(v=gk(),on.lanes|=v,xa|=v,h.baseState=!0),m)}function YL(h,m){var v=Dt;Dt=v!==0&&4>v?v:4,h(!0);var I=py.transition;py.transition={};try{h(!1),m()}finally{Dt=v,py.transition=I}}function BC(){return mr().memoizedState}function ZL(h,m,v){var I=$o(h);if(v={lane:I,action:v,hasEagerState:!1,eagerState:null,next:null},WC(h))VC(m,v);else if(v=vC(h,m,v,I),v!==null){var $=Is();Vr(v,h,I,$),UC(v,m,I)}}function JL(h,m,v){var I=$o(h),$={lane:I,action:v,hasEagerState:!1,eagerState:null,next:null};if(WC(h))VC(m,$);else{var D=h.alternate;if(h.lanes===0&&(D===null||D.lanes===0)&&(D=m.lastRenderedReducer,D!==null))try{var F=m.lastRenderedState,X=D(F,v);if($.hasEagerState=!0,$.eagerState=X,Or(X,F)){var ee=m.interleaved;ee===null?($.next=$,ly(m)):($.next=ee.next,ee.next=$),m.interleaved=$;return}}catch{}finally{}v=vC(h,m,$,I),v!==null&&($=Is(),Vr(v,h,I,$),UC(v,m,I))}}function WC(h){var m=h.alternate;return h===on||m!==null&&m===on}function VC(h,m){mu=wf=!0;var v=h.pending;v===null?m.next=m:(m.next=v.next,v.next=m),h.pending=m}function UC(h,m,v){if((v&4194240)!==0){var I=m.lanes;I&=h.pendingLanes,v|=I,m.lanes=v,Cx(h,v)}}var Sf={readContext:pr,useCallback:hs,useContext:hs,useEffect:hs,useImperativeHandle:hs,useInsertionEffect:hs,useLayoutEffect:hs,useMemo:hs,useReducer:hs,useRef:hs,useState:hs,useDebugValue:hs,useDeferredValue:hs,useTransition:hs,useMutableSource:hs,useSyncExternalStore:hs,useId:hs,unstable_isNewReconciler:!1},e3={readContext:pr,useCallback:function(h,m){return di().memoizedState=[h,m===void 0?null:m],h},useContext:pr,useEffect:DC,useImperativeHandle:function(h,m,v){return v=v!=null?v.concat([h]):null,kf(4194308,4,LC.bind(null,m,h),v)},useLayoutEffect:function(h,m){return kf(4194308,4,h,m)},useInsertionEffect:function(h,m){return kf(4,2,h,m)},useMemo:function(h,m){var v=di();return m=m===void 0?null:m,h=h(),v.memoizedState=[h,m],h},useReducer:function(h,m,v){var I=di();return m=v!==void 0?v(m):m,I.memoizedState=I.baseState=m,h={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:h,lastRenderedState:m},I.queue=h,h=h.dispatch=ZL.bind(null,on,h),[I.memoizedState,h]},useRef:function(h){var m=di();return h={current:h},m.memoizedState=h},useState:jC,useDebugValue:wy,useDeferredValue:function(h){return di().memoizedState=h},useTransition:function(){var h=jC(!1),m=h[0];return h=YL.bind(null,h[1]),di().memoizedState=h,[m,h]},useMutableSource:function(){},useSyncExternalStore:function(h,m,v){var I=on,$=di();if(Zt){if(v===void 0)throw Error(t(407));v=v()}else{if(v=m(),Wn===null)throw Error(t(349));(ga&30)!==0||IC(I,m,v)}$.memoizedState=v;var D={value:v,getSnapshot:m};return $.queue=D,DC($C.bind(null,I,D,h),[h]),I.flags|=2048,yu(9,TC.bind(null,I,D,v,m),void 0,null),v},useId:function(){var h=di(),m=Wn.identifierPrefix;if(Zt){var v=_i,I=Oi;v=(I&~(1<<32-Fr(I)-1)).toString(32)+v,m=":"+m+"R"+v,v=gu++,0<v&&(m+="H"+v.toString(32)),m+=":"}else v=XL++,m=":"+m+"r"+v.toString(32)+":";return h.memoizedState=m},unstable_isNewReconciler:!1},t3={readContext:pr,useCallback:OC,useContext:pr,useEffect:by,useImperativeHandle:FC,useInsertionEffect:PC,useLayoutEffect:MC,useMemo:_C,useReducer:yy,useRef:RC,useState:function(){return yy(xu)},useDebugValue:wy,useDeferredValue:function(h){var m=mr();return zC(m,Rn.memoizedState,h)},useTransition:function(){var h=yy(xu)[0],m=mr().memoizedState;return[h,m]},useMutableSource:SC,useSyncExternalStore:NC,useId:BC,unstable_isNewReconciler:!1},n3={readContext:pr,useCallback:OC,useContext:pr,useEffect:by,useImperativeHandle:FC,useInsertionEffect:PC,useLayoutEffect:MC,useMemo:_C,useReducer:vy,useRef:RC,useState:function(){return vy(xu)},useDebugValue:wy,useDeferredValue:function(h){var m=mr();return Rn===null?m.memoizedState=h:zC(m,Rn.memoizedState,h)},useTransition:function(){var h=vy(xu)[0],m=mr().memoizedState;return[h,m]},useMutableSource:SC,useSyncExternalStore:NC,useId:BC,unstable_isNewReconciler:!1};function zr(h,m){if(h&&h.defaultProps){m=Q({},m),h=h.defaultProps;for(var v in h)m[v]===void 0&&(m[v]=h[v]);return m}return m}function ky(h,m,v,I){m=h.memoizedState,v=v(I,m),v=v==null?m:Q({},m,v),h.memoizedState=v,h.lanes===0&&(h.updateQueue.baseState=v)}var Nf={isMounted:function(h){return(h=h._reactInternals)?ca(h)===h:!1},enqueueSetState:function(h,m,v){h=h._reactInternals;var I=Is(),$=$o(h),D=Bi(I,$);D.payload=m,v!=null&&(D.callback=v),m=So(h,D,$),m!==null&&(Vr(m,h,$,I),xf(m,h,$))},enqueueReplaceState:function(h,m,v){h=h._reactInternals;var I=Is(),$=$o(h),D=Bi(I,$);D.tag=1,D.payload=m,v!=null&&(D.callback=v),m=So(h,D,$),m!==null&&(Vr(m,h,$,I),xf(m,h,$))},enqueueForceUpdate:function(h,m){h=h._reactInternals;var v=Is(),I=$o(h),$=Bi(v,I);$.tag=2,m!=null&&($.callback=m),m=So(h,$,I),m!==null&&(Vr(m,h,I,v),xf(m,h,I))}};function GC(h,m,v,I,$,D,F){return h=h.stateNode,typeof h.shouldComponentUpdate=="function"?h.shouldComponentUpdate(I,D,F):m.prototype&&m.prototype.isPureReactComponent?!ru(v,I)||!ru($,D):!0}function HC(h,m,v){var I=!1,$=wo,D=m.contextType;return typeof D=="object"&&D!==null?D=pr(D):($=zs(m)?da:ds.current,I=m.contextTypes,D=(I=I!=null)?wl(h,$):wo),m=new m(v,D),h.memoizedState=m.state!==null&&m.state!==void 0?m.state:null,m.updater=Nf,h.stateNode=m,m._reactInternals=h,I&&(h=h.stateNode,h.__reactInternalMemoizedUnmaskedChildContext=$,h.__reactInternalMemoizedMaskedChildContext=D),m}function qC(h,m,v,I){h=m.state,typeof m.componentWillReceiveProps=="function"&&m.componentWillReceiveProps(v,I),typeof m.UNSAFE_componentWillReceiveProps=="function"&&m.UNSAFE_componentWillReceiveProps(v,I),m.state!==h&&Nf.enqueueReplaceState(m,m.state,null)}function Cy(h,m,v,I){var $=h.stateNode;$.props=v,$.state=h.memoizedState,$.refs={},cy(h);var D=m.contextType;typeof D=="object"&&D!==null?$.context=pr(D):(D=zs(m)?da:ds.current,$.context=wl(h,D)),$.state=h.memoizedState,D=m.getDerivedStateFromProps,typeof D=="function"&&(ky(h,m,D,v),$.state=h.memoizedState),typeof m.getDerivedStateFromProps=="function"||typeof $.getSnapshotBeforeUpdate=="function"||typeof $.UNSAFE_componentWillMount!="function"&&typeof $.componentWillMount!="function"||(m=$.state,typeof $.componentWillMount=="function"&&$.componentWillMount(),typeof $.UNSAFE_componentWillMount=="function"&&$.UNSAFE_componentWillMount(),m!==$.state&&Nf.enqueueReplaceState($,$.state,null),yf(h,v,$,I),$.state=h.memoizedState),typeof $.componentDidMount=="function"&&(h.flags|=4194308)}function El(h,m){try{var v="",I=m;do v+=J(I),I=I.return;while(I);var $=v}catch(D){$=`
Error generating stack: `+D.message+`
`+D.stack}return{value:h,source:m,stack:$,digest:null}}function Sy(h,m,v){return{value:h,source:null,stack:v??null,digest:m??null}}function Ny(h,m){try{console.error(m.value)}catch(v){setTimeout(function(){throw v})}}var s3=typeof WeakMap=="function"?WeakMap:Map;function KC(h,m,v){v=Bi(-1,v),v.tag=3,v.payload={element:null};var I=m.value;return v.callback=function(){Rf||(Rf=!0,zy=I),Ny(h,m)},v}function QC(h,m,v){v=Bi(-1,v),v.tag=3;var I=h.type.getDerivedStateFromError;if(typeof I=="function"){var $=m.value;v.payload=function(){return I($)},v.callback=function(){Ny(h,m)}}var D=h.stateNode;return D!==null&&typeof D.componentDidCatch=="function"&&(v.callback=function(){Ny(h,m),typeof I!="function"&&(Io===null?Io=new Set([this]):Io.add(this));var F=m.stack;this.componentDidCatch(m.value,{componentStack:F!==null?F:""})}),v}function XC(h,m,v){var I=h.pingCache;if(I===null){I=h.pingCache=new s3;var $=new Set;I.set(m,$)}else $=I.get(m),$===void 0&&($=new Set,I.set(m,$));$.has(v)||($.add(v),h=x3.bind(null,h,m,v),m.then(h,h))}function YC(h){do{var m;if((m=h.tag===13)&&(m=h.memoizedState,m=m!==null?m.dehydrated!==null:!0),m)return h;h=h.return}while(h!==null);return null}function ZC(h,m,v,I,$){return(h.mode&1)===0?(h===m?h.flags|=65536:(h.flags|=128,v.flags|=131072,v.flags&=-52805,v.tag===1&&(v.alternate===null?v.tag=17:(m=Bi(-1,1),m.tag=2,So(v,m,1))),v.lanes|=1),h):(h.flags|=65536,h.lanes=$,h)}var r3=C.ReactCurrentOwner,Bs=!1;function Ns(h,m,v,I){m.child=h===null?yC(m,null,v,I):Nl(m,h.child,v,I)}function JC(h,m,v,I,$){v=v.render;var D=m.ref;return Tl(m,$),I=gy(h,m,v,I,D,$),v=xy(),h!==null&&!Bs?(m.updateQueue=h.updateQueue,m.flags&=-2053,h.lanes&=~$,Wi(h,m,$)):(Zt&&v&&Jx(m),m.flags|=1,Ns(h,m,I,$),m.child)}function e2(h,m,v,I,$){if(h===null){var D=v.type;return typeof D=="function"&&!qy(D)&&D.defaultProps===void 0&&v.compare===null&&v.defaultProps===void 0?(m.tag=15,m.type=D,t2(h,m,D,I,$)):(h=Of(v.type,null,I,m,m.mode,$),h.ref=m.ref,h.return=m,m.child=h)}if(D=h.child,(h.lanes&$)===0){var F=D.memoizedProps;if(v=v.compare,v=v!==null?v:ru,v(F,I)&&h.ref===m.ref)return Wi(h,m,$)}return m.flags|=1,h=Ao(D,I),h.ref=m.ref,h.return=m,m.child=h}function t2(h,m,v,I,$){if(h!==null){var D=h.memoizedProps;if(ru(D,I)&&h.ref===m.ref)if(Bs=!1,m.pendingProps=I=D,(h.lanes&$)!==0)(h.flags&131072)!==0&&(Bs=!0);else return m.lanes=h.lanes,Wi(h,m,$)}return Iy(h,m,v,I,$)}function n2(h,m,v){var I=m.pendingProps,$=I.children,D=h!==null?h.memoizedState:null;if(I.mode==="hidden")if((m.mode&1)===0)m.memoizedState={baseLanes:0,cachePool:null,transitions:null},zt(jl,tr),tr|=v;else{if((v&1073741824)===0)return h=D!==null?D.baseLanes|v:v,m.lanes=m.childLanes=1073741824,m.memoizedState={baseLanes:h,cachePool:null,transitions:null},m.updateQueue=null,zt(jl,tr),tr|=h,null;m.memoizedState={baseLanes:0,cachePool:null,transitions:null},I=D!==null?D.baseLanes:v,zt(jl,tr),tr|=I}else D!==null?(I=D.baseLanes|v,m.memoizedState=null):I=v,zt(jl,tr),tr|=I;return Ns(h,m,$,v),m.child}function s2(h,m){var v=m.ref;(h===null&&v!==null||h!==null&&h.ref!==v)&&(m.flags|=512,m.flags|=2097152)}function Iy(h,m,v,I,$){var D=zs(v)?da:ds.current;return D=wl(m,D),Tl(m,$),v=gy(h,m,v,I,D,$),I=xy(),h!==null&&!Bs?(m.updateQueue=h.updateQueue,m.flags&=-2053,h.lanes&=~$,Wi(h,m,$)):(Zt&&I&&Jx(m),m.flags|=1,Ns(h,m,v,$),m.child)}function r2(h,m,v,I,$){if(zs(v)){var D=!0;cf(m)}else D=!1;if(Tl(m,$),m.stateNode===null)Tf(h,m),HC(m,v,I),Cy(m,v,I,$),I=!0;else if(h===null){var F=m.stateNode,X=m.memoizedProps;F.props=X;var ee=F.context,xe=v.contextType;typeof xe=="object"&&xe!==null?xe=pr(xe):(xe=zs(v)?da:ds.current,xe=wl(m,xe));var Ie=v.getDerivedStateFromProps,Ee=typeof Ie=="function"||typeof F.getSnapshotBeforeUpdate=="function";Ee||typeof F.UNSAFE_componentWillReceiveProps!="function"&&typeof F.componentWillReceiveProps!="function"||(X!==I||ee!==xe)&&qC(m,F,I,xe),Co=!1;var Ne=m.memoizedState;F.state=Ne,yf(m,I,F,$),ee=m.memoizedState,X!==I||Ne!==ee||_s.current||Co?(typeof Ie=="function"&&(ky(m,v,Ie,I),ee=m.memoizedState),(X=Co||GC(m,v,X,I,Ne,ee,xe))?(Ee||typeof F.UNSAFE_componentWillMount!="function"&&typeof F.componentWillMount!="function"||(typeof F.componentWillMount=="function"&&F.componentWillMount(),typeof F.UNSAFE_componentWillMount=="function"&&F.UNSAFE_componentWillMount()),typeof F.componentDidMount=="function"&&(m.flags|=4194308)):(typeof F.componentDidMount=="function"&&(m.flags|=4194308),m.memoizedProps=I,m.memoizedState=ee),F.props=I,F.state=ee,F.context=xe,I=X):(typeof F.componentDidMount=="function"&&(m.flags|=4194308),I=!1)}else{F=m.stateNode,bC(h,m),X=m.memoizedProps,xe=m.type===m.elementType?X:zr(m.type,X),F.props=xe,Ee=m.pendingProps,Ne=F.context,ee=v.contextType,typeof ee=="object"&&ee!==null?ee=pr(ee):(ee=zs(v)?da:ds.current,ee=wl(m,ee));var Oe=v.getDerivedStateFromProps;(Ie=typeof Oe=="function"||typeof F.getSnapshotBeforeUpdate=="function")||typeof F.UNSAFE_componentWillReceiveProps!="function"&&typeof F.componentWillReceiveProps!="function"||(X!==Ee||Ne!==ee)&&qC(m,F,I,ee),Co=!1,Ne=m.memoizedState,F.state=Ne,yf(m,I,F,$);var Ve=m.memoizedState;X!==Ee||Ne!==Ve||_s.current||Co?(typeof Oe=="function"&&(ky(m,v,Oe,I),Ve=m.memoizedState),(xe=Co||GC(m,v,xe,I,Ne,Ve,ee)||!1)?(Ie||typeof F.UNSAFE_componentWillUpdate!="function"&&typeof F.componentWillUpdate!="function"||(typeof F.componentWillUpdate=="function"&&F.componentWillUpdate(I,Ve,ee),typeof F.UNSAFE_componentWillUpdate=="function"&&F.UNSAFE_componentWillUpdate(I,Ve,ee)),typeof F.componentDidUpdate=="function"&&(m.flags|=4),typeof F.getSnapshotBeforeUpdate=="function"&&(m.flags|=1024)):(typeof F.componentDidUpdate!="function"||X===h.memoizedProps&&Ne===h.memoizedState||(m.flags|=4),typeof F.getSnapshotBeforeUpdate!="function"||X===h.memoizedProps&&Ne===h.memoizedState||(m.flags|=1024),m.memoizedProps=I,m.memoizedState=Ve),F.props=I,F.state=Ve,F.context=ee,I=xe):(typeof F.componentDidUpdate!="function"||X===h.memoizedProps&&Ne===h.memoizedState||(m.flags|=4),typeof F.getSnapshotBeforeUpdate!="function"||X===h.memoizedProps&&Ne===h.memoizedState||(m.flags|=1024),I=!1)}return Ty(h,m,v,I,D,$)}function Ty(h,m,v,I,$,D){s2(h,m);var F=(m.flags&128)!==0;if(!I&&!F)return $&&cC(m,v,!1),Wi(h,m,D);I=m.stateNode,r3.current=m;var X=F&&typeof v.getDerivedStateFromError!="function"?null:I.render();return m.flags|=1,h!==null&&F?(m.child=Nl(m,h.child,null,D),m.child=Nl(m,null,X,D)):Ns(h,m,X,D),m.memoizedState=I.state,$&&cC(m,v,!0),m.child}function i2(h){var m=h.stateNode;m.pendingContext?aC(h,m.pendingContext,m.pendingContext!==m.context):m.context&&aC(h,m.context,!1),uy(h,m.containerInfo)}function o2(h,m,v,I,$){return Sl(),sy($),m.flags|=256,Ns(h,m,v,I),m.child}var $y={dehydrated:null,treeContext:null,retryLane:0};function Ey(h){return{baseLanes:h,cachePool:null,transitions:null}}function a2(h,m,v){var I=m.pendingProps,$=rn.current,D=!1,F=(m.flags&128)!==0,X;if((X=F)||(X=h!==null&&h.memoizedState===null?!1:($&2)!==0),X?(D=!0,m.flags&=-129):(h===null||h.memoizedState!==null)&&($|=1),zt(rn,$&1),h===null)return ny(m),h=m.memoizedState,h!==null&&(h=h.dehydrated,h!==null)?((m.mode&1)===0?m.lanes=1:h.data==="$!"?m.lanes=8:m.lanes=1073741824,null):(F=I.children,h=I.fallback,D?(I=m.mode,D=m.child,F={mode:"hidden",children:F},(I&1)===0&&D!==null?(D.childLanes=0,D.pendingProps=F):D=_f(F,I,0,null),h=wa(h,I,v,null),D.return=m,h.return=m,D.sibling=h,m.child=D,m.child.memoizedState=Ey(v),m.memoizedState=$y,h):Ay(m,F));if($=h.memoizedState,$!==null&&(X=$.dehydrated,X!==null))return i3(h,m,F,I,X,$,v);if(D){D=I.fallback,F=m.mode,$=h.child,X=$.sibling;var ee={mode:"hidden",children:I.children};return(F&1)===0&&m.child!==$?(I=m.child,I.childLanes=0,I.pendingProps=ee,m.deletions=null):(I=Ao($,ee),I.subtreeFlags=$.subtreeFlags&14680064),X!==null?D=Ao(X,D):(D=wa(D,F,v,null),D.flags|=2),D.return=m,I.return=m,I.sibling=D,m.child=I,I=D,D=m.child,F=h.child.memoizedState,F=F===null?Ey(v):{baseLanes:F.baseLanes|v,cachePool:null,transitions:F.transitions},D.memoizedState=F,D.childLanes=h.childLanes&~v,m.memoizedState=$y,I}return D=h.child,h=D.sibling,I=Ao(D,{mode:"visible",children:I.children}),(m.mode&1)===0&&(I.lanes=v),I.return=m,I.sibling=null,h!==null&&(v=m.deletions,v===null?(m.deletions=[h],m.flags|=16):v.push(h)),m.child=I,m.memoizedState=null,I}function Ay(h,m){return m=_f({mode:"visible",children:m},h.mode,0,null),m.return=h,h.child=m}function If(h,m,v,I){return I!==null&&sy(I),Nl(m,h.child,null,v),h=Ay(m,m.pendingProps.children),h.flags|=2,m.memoizedState=null,h}function i3(h,m,v,I,$,D,F){if(v)return m.flags&256?(m.flags&=-257,I=Sy(Error(t(422))),If(h,m,F,I)):m.memoizedState!==null?(m.child=h.child,m.flags|=128,null):(D=I.fallback,$=m.mode,I=_f({mode:"visible",children:I.children},$,0,null),D=wa(D,$,F,null),D.flags|=2,I.return=m,D.return=m,I.sibling=D,m.child=I,(m.mode&1)!==0&&Nl(m,h.child,null,F),m.child.memoizedState=Ey(F),m.memoizedState=$y,D);if((m.mode&1)===0)return If(h,m,F,null);if($.data==="$!"){if(I=$.nextSibling&&$.nextSibling.dataset,I)var X=I.dgst;return I=X,D=Error(t(419)),I=Sy(D,I,void 0),If(h,m,F,I)}if(X=(F&h.childLanes)!==0,Bs||X){if(I=Wn,I!==null){switch(F&-F){case 4:$=2;break;case 16:$=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:$=32;break;case 536870912:$=268435456;break;default:$=0}$=($&(I.suspendedLanes|F))!==0?0:$,$!==0&&$!==D.retryLane&&(D.retryLane=$,zi(h,$),Vr(I,h,$,-1))}return Hy(),I=Sy(Error(t(421))),If(h,m,F,I)}return $.data==="$?"?(m.flags|=128,m.child=h.child,m=y3.bind(null,h),$._reactRetry=m,null):(h=D.treeContext,er=vo($.nextSibling),Js=m,Zt=!0,_r=null,h!==null&&(hr[fr++]=Oi,hr[fr++]=_i,hr[fr++]=ha,Oi=h.id,_i=h.overflow,ha=m),m=Ay(m,I.children),m.flags|=4096,m)}function l2(h,m,v){h.lanes|=m;var I=h.alternate;I!==null&&(I.lanes|=m),ay(h.return,m,v)}function jy(h,m,v,I,$){var D=h.memoizedState;D===null?h.memoizedState={isBackwards:m,rendering:null,renderingStartTime:0,last:I,tail:v,tailMode:$}:(D.isBackwards=m,D.rendering=null,D.renderingStartTime=0,D.last=I,D.tail=v,D.tailMode=$)}function c2(h,m,v){var I=m.pendingProps,$=I.revealOrder,D=I.tail;if(Ns(h,m,I.children,v),I=rn.current,(I&2)!==0)I=I&1|2,m.flags|=128;else{if(h!==null&&(h.flags&128)!==0)e:for(h=m.child;h!==null;){if(h.tag===13)h.memoizedState!==null&&l2(h,v,m);else if(h.tag===19)l2(h,v,m);else if(h.child!==null){h.child.return=h,h=h.child;continue}if(h===m)break e;for(;h.sibling===null;){if(h.return===null||h.return===m)break e;h=h.return}h.sibling.return=h.return,h=h.sibling}I&=1}if(zt(rn,I),(m.mode&1)===0)m.memoizedState=null;else switch($){case"forwards":for(v=m.child,$=null;v!==null;)h=v.alternate,h!==null&&vf(h)===null&&($=v),v=v.sibling;v=$,v===null?($=m.child,m.child=null):($=v.sibling,v.sibling=null),jy(m,!1,$,v,D);break;case"backwards":for(v=null,$=m.child,m.child=null;$!==null;){if(h=$.alternate,h!==null&&vf(h)===null){m.child=$;break}h=$.sibling,$.sibling=v,v=$,$=h}jy(m,!0,v,null,D);break;case"together":jy(m,!1,null,null,void 0);break;default:m.memoizedState=null}return m.child}function Tf(h,m){(m.mode&1)===0&&h!==null&&(h.alternate=null,m.alternate=null,m.flags|=2)}function Wi(h,m,v){if(h!==null&&(m.dependencies=h.dependencies),xa|=m.lanes,(v&m.childLanes)===0)return null;if(h!==null&&m.child!==h.child)throw Error(t(153));if(m.child!==null){for(h=m.child,v=Ao(h,h.pendingProps),m.child=v,v.return=m;h.sibling!==null;)h=h.sibling,v=v.sibling=Ao(h,h.pendingProps),v.return=m;v.sibling=null}return m.child}function o3(h,m,v){switch(m.tag){case 3:i2(m),Sl();break;case 5:CC(m);break;case 1:zs(m.type)&&cf(m);break;case 4:uy(m,m.stateNode.containerInfo);break;case 10:var I=m.type._context,$=m.memoizedProps.value;zt(mf,I._currentValue),I._currentValue=$;break;case 13:if(I=m.memoizedState,I!==null)return I.dehydrated!==null?(zt(rn,rn.current&1),m.flags|=128,null):(v&m.child.childLanes)!==0?a2(h,m,v):(zt(rn,rn.current&1),h=Wi(h,m,v),h!==null?h.sibling:null);zt(rn,rn.current&1);break;case 19:if(I=(v&m.childLanes)!==0,(h.flags&128)!==0){if(I)return c2(h,m,v);m.flags|=128}if($=m.memoizedState,$!==null&&($.rendering=null,$.tail=null,$.lastEffect=null),zt(rn,rn.current),I)break;return null;case 22:case 23:return m.lanes=0,n2(h,m,v)}return Wi(h,m,v)}var u2,Ry,d2,h2;u2=function(h,m){for(var v=m.child;v!==null;){if(v.tag===5||v.tag===6)h.appendChild(v.stateNode);else if(v.tag!==4&&v.child!==null){v.child.return=v,v=v.child;continue}if(v===m)break;for(;v.sibling===null;){if(v.return===null||v.return===m)return;v=v.return}v.sibling.return=v.return,v=v.sibling}},Ry=function(){},d2=function(h,m,v,I){var $=h.memoizedProps;if($!==I){h=m.stateNode,ma(ui.current);var D=null;switch(v){case"input":$=ke(h,$),I=ke(h,I),D=[];break;case"select":$=Q({},$,{value:void 0}),I=Q({},I,{value:void 0}),D=[];break;case"textarea":$=De(h,$),I=De(h,I),D=[];break;default:typeof $.onClick!="function"&&typeof I.onClick=="function"&&(h.onclick=of)}yt(v,I);var F;v=null;for(xe in $)if(!I.hasOwnProperty(xe)&&$.hasOwnProperty(xe)&&$[xe]!=null)if(xe==="style"){var X=$[xe];for(F in X)X.hasOwnProperty(F)&&(v||(v={}),v[F]="")}else xe!=="dangerouslySetInnerHTML"&&xe!=="children"&&xe!=="suppressContentEditableWarning"&&xe!=="suppressHydrationWarning"&&xe!=="autoFocus"&&(r.hasOwnProperty(xe)?D||(D=[]):(D=D||[]).push(xe,null));for(xe in I){var ee=I[xe];if(X=$!=null?$[xe]:void 0,I.hasOwnProperty(xe)&&ee!==X&&(ee!=null||X!=null))if(xe==="style")if(X){for(F in X)!X.hasOwnProperty(F)||ee&&ee.hasOwnProperty(F)||(v||(v={}),v[F]="");for(F in ee)ee.hasOwnProperty(F)&&X[F]!==ee[F]&&(v||(v={}),v[F]=ee[F])}else v||(D||(D=[]),D.push(xe,v)),v=ee;else xe==="dangerouslySetInnerHTML"?(ee=ee?ee.__html:void 0,X=X?X.__html:void 0,ee!=null&&X!==ee&&(D=D||[]).push(xe,ee)):xe==="children"?typeof ee!="string"&&typeof ee!="number"||(D=D||[]).push(xe,""+ee):xe!=="suppressContentEditableWarning"&&xe!=="suppressHydrationWarning"&&(r.hasOwnProperty(xe)?(ee!=null&&xe==="onScroll"&&Ht("scroll",h),D||X===ee||(D=[])):(D=D||[]).push(xe,ee))}v&&(D=D||[]).push("style",v);var xe=D;(m.updateQueue=xe)&&(m.flags|=4)}},h2=function(h,m,v,I){v!==I&&(m.flags|=4)};function vu(h,m){if(!Zt)switch(h.tailMode){case"hidden":m=h.tail;for(var v=null;m!==null;)m.alternate!==null&&(v=m),m=m.sibling;v===null?h.tail=null:v.sibling=null;break;case"collapsed":v=h.tail;for(var I=null;v!==null;)v.alternate!==null&&(I=v),v=v.sibling;I===null?m||h.tail===null?h.tail=null:h.tail.sibling=null:I.sibling=null}}function fs(h){var m=h.alternate!==null&&h.alternate.child===h.child,v=0,I=0;if(m)for(var $=h.child;$!==null;)v|=$.lanes|$.childLanes,I|=$.subtreeFlags&14680064,I|=$.flags&14680064,$.return=h,$=$.sibling;else for($=h.child;$!==null;)v|=$.lanes|$.childLanes,I|=$.subtreeFlags,I|=$.flags,$.return=h,$=$.sibling;return h.subtreeFlags|=I,h.childLanes=v,m}function a3(h,m,v){var I=m.pendingProps;switch(ey(m),m.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return fs(m),null;case 1:return zs(m.type)&&lf(),fs(m),null;case 3:return I=m.stateNode,$l(),qt(_s),qt(ds),fy(),I.pendingContext&&(I.context=I.pendingContext,I.pendingContext=null),(h===null||h.child===null)&&(ff(m)?m.flags|=4:h===null||h.memoizedState.isDehydrated&&(m.flags&256)===0||(m.flags|=1024,_r!==null&&(Vy(_r),_r=null))),Ry(h,m),fs(m),null;case 5:dy(m);var $=ma(pu.current);if(v=m.type,h!==null&&m.stateNode!=null)d2(h,m,v,I,$),h.ref!==m.ref&&(m.flags|=512,m.flags|=2097152);else{if(!I){if(m.stateNode===null)throw Error(t(166));return fs(m),null}if(h=ma(ui.current),ff(m)){I=m.stateNode,v=m.type;var D=m.memoizedProps;switch(I[ci]=m,I[cu]=D,h=(m.mode&1)!==0,v){case"dialog":Ht("cancel",I),Ht("close",I);break;case"iframe":case"object":case"embed":Ht("load",I);break;case"video":case"audio":for($=0;$<ou.length;$++)Ht(ou[$],I);break;case"source":Ht("error",I);break;case"img":case"image":case"link":Ht("error",I),Ht("load",I);break;case"details":Ht("toggle",I);break;case"input":ye(I,D),Ht("invalid",I);break;case"select":I._wrapperState={wasMultiple:!!D.multiple},Ht("invalid",I);break;case"textarea":_e(I,D),Ht("invalid",I)}yt(v,D),$=null;for(var F in D)if(D.hasOwnProperty(F)){var X=D[F];F==="children"?typeof X=="string"?I.textContent!==X&&(D.suppressHydrationWarning!==!0&&rf(I.textContent,X,h),$=["children",X]):typeof X=="number"&&I.textContent!==""+X&&(D.suppressHydrationWarning!==!0&&rf(I.textContent,X,h),$=["children",""+X]):r.hasOwnProperty(F)&&X!=null&&F==="onScroll"&&Ht("scroll",I)}switch(v){case"input":Pe(I),Be(I,D,!0);break;case"textarea":Pe(I),St(I);break;case"select":case"option":break;default:typeof D.onClick=="function"&&(I.onclick=of)}I=$,m.updateQueue=I,I!==null&&(m.flags|=4)}else{F=$.nodeType===9?$:$.ownerDocument,h==="http://www.w3.org/1999/xhtml"&&(h=cn(v)),h==="http://www.w3.org/1999/xhtml"?v==="script"?(h=F.createElement("div"),h.innerHTML="<script><\/script>",h=h.removeChild(h.firstChild)):typeof I.is=="string"?h=F.createElement(v,{is:I.is}):(h=F.createElement(v),v==="select"&&(F=h,I.multiple?F.multiple=!0:I.size&&(F.size=I.size))):h=F.createElementNS(h,v),h[ci]=m,h[cu]=I,u2(h,m,!1,!1),m.stateNode=h;e:{switch(F=Gt(v,I),v){case"dialog":Ht("cancel",h),Ht("close",h),$=I;break;case"iframe":case"object":case"embed":Ht("load",h),$=I;break;case"video":case"audio":for($=0;$<ou.length;$++)Ht(ou[$],h);$=I;break;case"source":Ht("error",h),$=I;break;case"img":case"image":case"link":Ht("error",h),Ht("load",h),$=I;break;case"details":Ht("toggle",h),$=I;break;case"input":ye(h,I),$=ke(h,I),Ht("invalid",h);break;case"option":$=I;break;case"select":h._wrapperState={wasMultiple:!!I.multiple},$=Q({},I,{value:void 0}),Ht("invalid",h);break;case"textarea":_e(h,I),$=De(h,I),Ht("invalid",h);break;default:$=I}yt(v,$),X=$;for(D in X)if(X.hasOwnProperty(D)){var ee=X[D];D==="style"?Di(h,ee):D==="dangerouslySetInnerHTML"?(ee=ee?ee.__html:void 0,ee!=null&&yn(h,ee)):D==="children"?typeof ee=="string"?(v!=="textarea"||ee!=="")&&Zn(h,ee):typeof ee=="number"&&Zn(h,""+ee):D!=="suppressContentEditableWarning"&&D!=="suppressHydrationWarning"&&D!=="autoFocus"&&(r.hasOwnProperty(D)?ee!=null&&D==="onScroll"&&Ht("scroll",h):ee!=null&&N(h,D,ee,F))}switch(v){case"input":Pe(h),Be(h,I,!1);break;case"textarea":Pe(h),St(h);break;case"option":I.value!=null&&h.setAttribute("value",""+ge(I.value));break;case"select":h.multiple=!!I.multiple,D=I.value,D!=null?je(h,!!I.multiple,D,!1):I.defaultValue!=null&&je(h,!!I.multiple,I.defaultValue,!0);break;default:typeof $.onClick=="function"&&(h.onclick=of)}switch(v){case"button":case"input":case"select":case"textarea":I=!!I.autoFocus;break e;case"img":I=!0;break e;default:I=!1}}I&&(m.flags|=4)}m.ref!==null&&(m.flags|=512,m.flags|=2097152)}return fs(m),null;case 6:if(h&&m.stateNode!=null)h2(h,m,h.memoizedProps,I);else{if(typeof I!="string"&&m.stateNode===null)throw Error(t(166));if(v=ma(pu.current),ma(ui.current),ff(m)){if(I=m.stateNode,v=m.memoizedProps,I[ci]=m,(D=I.nodeValue!==v)&&(h=Js,h!==null))switch(h.tag){case 3:rf(I.nodeValue,v,(h.mode&1)!==0);break;case 5:h.memoizedProps.suppressHydrationWarning!==!0&&rf(I.nodeValue,v,(h.mode&1)!==0)}D&&(m.flags|=4)}else I=(v.nodeType===9?v:v.ownerDocument).createTextNode(I),I[ci]=m,m.stateNode=I}return fs(m),null;case 13:if(qt(rn),I=m.memoizedState,h===null||h.memoizedState!==null&&h.memoizedState.dehydrated!==null){if(Zt&&er!==null&&(m.mode&1)!==0&&(m.flags&128)===0)mC(),Sl(),m.flags|=98560,D=!1;else if(D=ff(m),I!==null&&I.dehydrated!==null){if(h===null){if(!D)throw Error(t(318));if(D=m.memoizedState,D=D!==null?D.dehydrated:null,!D)throw Error(t(317));D[ci]=m}else Sl(),(m.flags&128)===0&&(m.memoizedState=null),m.flags|=4;fs(m),D=!1}else _r!==null&&(Vy(_r),_r=null),D=!0;if(!D)return m.flags&65536?m:null}return(m.flags&128)!==0?(m.lanes=v,m):(I=I!==null,I!==(h!==null&&h.memoizedState!==null)&&I&&(m.child.flags|=8192,(m.mode&1)!==0&&(h===null||(rn.current&1)!==0?Dn===0&&(Dn=3):Hy())),m.updateQueue!==null&&(m.flags|=4),fs(m),null);case 4:return $l(),Ry(h,m),h===null&&au(m.stateNode.containerInfo),fs(m),null;case 10:return oy(m.type._context),fs(m),null;case 17:return zs(m.type)&&lf(),fs(m),null;case 19:if(qt(rn),D=m.memoizedState,D===null)return fs(m),null;if(I=(m.flags&128)!==0,F=D.rendering,F===null)if(I)vu(D,!1);else{if(Dn!==0||h!==null&&(h.flags&128)!==0)for(h=m.child;h!==null;){if(F=vf(h),F!==null){for(m.flags|=128,vu(D,!1),I=F.updateQueue,I!==null&&(m.updateQueue=I,m.flags|=4),m.subtreeFlags=0,I=v,v=m.child;v!==null;)D=v,h=I,D.flags&=14680066,F=D.alternate,F===null?(D.childLanes=0,D.lanes=h,D.child=null,D.subtreeFlags=0,D.memoizedProps=null,D.memoizedState=null,D.updateQueue=null,D.dependencies=null,D.stateNode=null):(D.childLanes=F.childLanes,D.lanes=F.lanes,D.child=F.child,D.subtreeFlags=0,D.deletions=null,D.memoizedProps=F.memoizedProps,D.memoizedState=F.memoizedState,D.updateQueue=F.updateQueue,D.type=F.type,h=F.dependencies,D.dependencies=h===null?null:{lanes:h.lanes,firstContext:h.firstContext}),v=v.sibling;return zt(rn,rn.current&1|2),m.child}h=h.sibling}D.tail!==null&&vn()>Rl&&(m.flags|=128,I=!0,vu(D,!1),m.lanes=4194304)}else{if(!I)if(h=vf(F),h!==null){if(m.flags|=128,I=!0,v=h.updateQueue,v!==null&&(m.updateQueue=v,m.flags|=4),vu(D,!0),D.tail===null&&D.tailMode==="hidden"&&!F.alternate&&!Zt)return fs(m),null}else 2*vn()-D.renderingStartTime>Rl&&v!==1073741824&&(m.flags|=128,I=!0,vu(D,!1),m.lanes=4194304);D.isBackwards?(F.sibling=m.child,m.child=F):(v=D.last,v!==null?v.sibling=F:m.child=F,D.last=F)}return D.tail!==null?(m=D.tail,D.rendering=m,D.tail=m.sibling,D.renderingStartTime=vn(),m.sibling=null,v=rn.current,zt(rn,I?v&1|2:v&1),m):(fs(m),null);case 22:case 23:return Gy(),I=m.memoizedState!==null,h!==null&&h.memoizedState!==null!==I&&(m.flags|=8192),I&&(m.mode&1)!==0?(tr&1073741824)!==0&&(fs(m),m.subtreeFlags&6&&(m.flags|=8192)):fs(m),null;case 24:return null;case 25:return null}throw Error(t(156,m.tag))}function l3(h,m){switch(ey(m),m.tag){case 1:return zs(m.type)&&lf(),h=m.flags,h&65536?(m.flags=h&-65537|128,m):null;case 3:return $l(),qt(_s),qt(ds),fy(),h=m.flags,(h&65536)!==0&&(h&128)===0?(m.flags=h&-65537|128,m):null;case 5:return dy(m),null;case 13:if(qt(rn),h=m.memoizedState,h!==null&&h.dehydrated!==null){if(m.alternate===null)throw Error(t(340));Sl()}return h=m.flags,h&65536?(m.flags=h&-65537|128,m):null;case 19:return qt(rn),null;case 4:return $l(),null;case 10:return oy(m.type._context),null;case 22:case 23:return Gy(),null;case 24:return null;default:return null}}var $f=!1,ps=!1,c3=typeof WeakSet=="function"?WeakSet:Set,ze=null;function Al(h,m){var v=h.ref;if(v!==null)if(typeof v=="function")try{v(null)}catch(I){un(h,m,I)}else v.current=null}function Dy(h,m,v){try{v()}catch(I){un(h,m,I)}}var f2=!1;function u3(h,m){if(Gx=qh,h=Gk(),Fx(h)){if("selectionStart"in h)var v={start:h.selectionStart,end:h.selectionEnd};else e:{v=(v=h.ownerDocument)&&v.defaultView||window;var I=v.getSelection&&v.getSelection();if(I&&I.rangeCount!==0){v=I.anchorNode;var $=I.anchorOffset,D=I.focusNode;I=I.focusOffset;try{v.nodeType,D.nodeType}catch{v=null;break e}var F=0,X=-1,ee=-1,xe=0,Ie=0,Ee=h,Ne=null;t:for(;;){for(var Oe;Ee!==v||$!==0&&Ee.nodeType!==3||(X=F+$),Ee!==D||I!==0&&Ee.nodeType!==3||(ee=F+I),Ee.nodeType===3&&(F+=Ee.nodeValue.length),(Oe=Ee.firstChild)!==null;)Ne=Ee,Ee=Oe;for(;;){if(Ee===h)break t;if(Ne===v&&++xe===$&&(X=F),Ne===D&&++Ie===I&&(ee=F),(Oe=Ee.nextSibling)!==null)break;Ee=Ne,Ne=Ee.parentNode}Ee=Oe}v=X===-1||ee===-1?null:{start:X,end:ee}}else v=null}v=v||{start:0,end:0}}else v=null;for(Hx={focusedElem:h,selectionRange:v},qh=!1,ze=m;ze!==null;)if(m=ze,h=m.child,(m.subtreeFlags&1028)!==0&&h!==null)h.return=m,ze=h;else for(;ze!==null;){m=ze;try{var Ve=m.alternate;if((m.flags&1024)!==0)switch(m.tag){case 0:case 11:case 15:break;case 1:if(Ve!==null){var Ge=Ve.memoizedProps,bn=Ve.memoizedState,ce=m.stateNode,se=ce.getSnapshotBeforeUpdate(m.elementType===m.type?Ge:zr(m.type,Ge),bn);ce.__reactInternalSnapshotBeforeUpdate=se}break;case 3:var fe=m.stateNode.containerInfo;fe.nodeType===1?fe.textContent="":fe.nodeType===9&&fe.documentElement&&fe.removeChild(fe.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(t(163))}}catch(Re){un(m,m.return,Re)}if(h=m.sibling,h!==null){h.return=m.return,ze=h;break}ze=m.return}return Ve=f2,f2=!1,Ve}function bu(h,m,v){var I=m.updateQueue;if(I=I!==null?I.lastEffect:null,I!==null){var $=I=I.next;do{if(($.tag&h)===h){var D=$.destroy;$.destroy=void 0,D!==void 0&&Dy(m,v,D)}$=$.next}while($!==I)}}function Ef(h,m){if(m=m.updateQueue,m=m!==null?m.lastEffect:null,m!==null){var v=m=m.next;do{if((v.tag&h)===h){var I=v.create;v.destroy=I()}v=v.next}while(v!==m)}}function Py(h){var m=h.ref;if(m!==null){var v=h.stateNode;switch(h.tag){case 5:h=v;break;default:h=v}typeof m=="function"?m(h):m.current=h}}function p2(h){var m=h.alternate;m!==null&&(h.alternate=null,p2(m)),h.child=null,h.deletions=null,h.sibling=null,h.tag===5&&(m=h.stateNode,m!==null&&(delete m[ci],delete m[cu],delete m[Xx],delete m[HL],delete m[qL])),h.stateNode=null,h.return=null,h.dependencies=null,h.memoizedProps=null,h.memoizedState=null,h.pendingProps=null,h.stateNode=null,h.updateQueue=null}function m2(h){return h.tag===5||h.tag===3||h.tag===4}function g2(h){e:for(;;){for(;h.sibling===null;){if(h.return===null||m2(h.return))return null;h=h.return}for(h.sibling.return=h.return,h=h.sibling;h.tag!==5&&h.tag!==6&&h.tag!==18;){if(h.flags&2||h.child===null||h.tag===4)continue e;h.child.return=h,h=h.child}if(!(h.flags&2))return h.stateNode}}function My(h,m,v){var I=h.tag;if(I===5||I===6)h=h.stateNode,m?v.nodeType===8?v.parentNode.insertBefore(h,m):v.insertBefore(h,m):(v.nodeType===8?(m=v.parentNode,m.insertBefore(h,v)):(m=v,m.appendChild(h)),v=v._reactRootContainer,v!=null||m.onclick!==null||(m.onclick=of));else if(I!==4&&(h=h.child,h!==null))for(My(h,m,v),h=h.sibling;h!==null;)My(h,m,v),h=h.sibling}function Ly(h,m,v){var I=h.tag;if(I===5||I===6)h=h.stateNode,m?v.insertBefore(h,m):v.appendChild(h);else if(I!==4&&(h=h.child,h!==null))for(Ly(h,m,v),h=h.sibling;h!==null;)Ly(h,m,v),h=h.sibling}var Jn=null,Br=!1;function No(h,m,v){for(v=v.child;v!==null;)x2(h,m,v),v=v.sibling}function x2(h,m,v){if(li&&typeof li.onCommitFiberUnmount=="function")try{li.onCommitFiberUnmount(Bh,v)}catch{}switch(v.tag){case 5:ps||Al(v,m);case 6:var I=Jn,$=Br;Jn=null,No(h,m,v),Jn=I,Br=$,Jn!==null&&(Br?(h=Jn,v=v.stateNode,h.nodeType===8?h.parentNode.removeChild(v):h.removeChild(v)):Jn.removeChild(v.stateNode));break;case 18:Jn!==null&&(Br?(h=Jn,v=v.stateNode,h.nodeType===8?Qx(h.parentNode,v):h.nodeType===1&&Qx(h,v),Zc(h)):Qx(Jn,v.stateNode));break;case 4:I=Jn,$=Br,Jn=v.stateNode.containerInfo,Br=!0,No(h,m,v),Jn=I,Br=$;break;case 0:case 11:case 14:case 15:if(!ps&&(I=v.updateQueue,I!==null&&(I=I.lastEffect,I!==null))){$=I=I.next;do{var D=$,F=D.destroy;D=D.tag,F!==void 0&&((D&2)!==0||(D&4)!==0)&&Dy(v,m,F),$=$.next}while($!==I)}No(h,m,v);break;case 1:if(!ps&&(Al(v,m),I=v.stateNode,typeof I.componentWillUnmount=="function"))try{I.props=v.memoizedProps,I.state=v.memoizedState,I.componentWillUnmount()}catch(X){un(v,m,X)}No(h,m,v);break;case 21:No(h,m,v);break;case 22:v.mode&1?(ps=(I=ps)||v.memoizedState!==null,No(h,m,v),ps=I):No(h,m,v);break;default:No(h,m,v)}}function y2(h){var m=h.updateQueue;if(m!==null){h.updateQueue=null;var v=h.stateNode;v===null&&(v=h.stateNode=new c3),m.forEach(function(I){var $=v3.bind(null,h,I);v.has(I)||(v.add(I),I.then($,$))})}}function Wr(h,m){var v=m.deletions;if(v!==null)for(var I=0;I<v.length;I++){var $=v[I];try{var D=h,F=m,X=F;e:for(;X!==null;){switch(X.tag){case 5:Jn=X.stateNode,Br=!1;break e;case 3:Jn=X.stateNode.containerInfo,Br=!0;break e;case 4:Jn=X.stateNode.containerInfo,Br=!0;break e}X=X.return}if(Jn===null)throw Error(t(160));x2(D,F,$),Jn=null,Br=!1;var ee=$.alternate;ee!==null&&(ee.return=null),$.return=null}catch(xe){un($,m,xe)}}if(m.subtreeFlags&12854)for(m=m.child;m!==null;)v2(m,h),m=m.sibling}function v2(h,m){var v=h.alternate,I=h.flags;switch(h.tag){case 0:case 11:case 14:case 15:if(Wr(m,h),hi(h),I&4){try{bu(3,h,h.return),Ef(3,h)}catch(Ge){un(h,h.return,Ge)}try{bu(5,h,h.return)}catch(Ge){un(h,h.return,Ge)}}break;case 1:Wr(m,h),hi(h),I&512&&v!==null&&Al(v,v.return);break;case 5:if(Wr(m,h),hi(h),I&512&&v!==null&&Al(v,v.return),h.flags&32){var $=h.stateNode;try{Zn($,"")}catch(Ge){un(h,h.return,Ge)}}if(I&4&&($=h.stateNode,$!=null)){var D=h.memoizedProps,F=v!==null?v.memoizedProps:D,X=h.type,ee=h.updateQueue;if(h.updateQueue=null,ee!==null)try{X==="input"&&D.type==="radio"&&D.name!=null&&Ce($,D),Gt(X,F);var xe=Gt(X,D);for(F=0;F<ee.length;F+=2){var Ie=ee[F],Ee=ee[F+1];Ie==="style"?Di($,Ee):Ie==="dangerouslySetInnerHTML"?yn($,Ee):Ie==="children"?Zn($,Ee):N($,Ie,Ee,xe)}switch(X){case"input":Ae($,D);break;case"textarea":it($,D);break;case"select":var Ne=$._wrapperState.wasMultiple;$._wrapperState.wasMultiple=!!D.multiple;var Oe=D.value;Oe!=null?je($,!!D.multiple,Oe,!1):Ne!==!!D.multiple&&(D.defaultValue!=null?je($,!!D.multiple,D.defaultValue,!0):je($,!!D.multiple,D.multiple?[]:"",!1))}$[cu]=D}catch(Ge){un(h,h.return,Ge)}}break;case 6:if(Wr(m,h),hi(h),I&4){if(h.stateNode===null)throw Error(t(162));$=h.stateNode,D=h.memoizedProps;try{$.nodeValue=D}catch(Ge){un(h,h.return,Ge)}}break;case 3:if(Wr(m,h),hi(h),I&4&&v!==null&&v.memoizedState.isDehydrated)try{Zc(m.containerInfo)}catch(Ge){un(h,h.return,Ge)}break;case 4:Wr(m,h),hi(h);break;case 13:Wr(m,h),hi(h),$=h.child,$.flags&8192&&(D=$.memoizedState!==null,$.stateNode.isHidden=D,!D||$.alternate!==null&&$.alternate.memoizedState!==null||(_y=vn())),I&4&&y2(h);break;case 22:if(Ie=v!==null&&v.memoizedState!==null,h.mode&1?(ps=(xe=ps)||Ie,Wr(m,h),ps=xe):Wr(m,h),hi(h),I&8192){if(xe=h.memoizedState!==null,(h.stateNode.isHidden=xe)&&!Ie&&(h.mode&1)!==0)for(ze=h,Ie=h.child;Ie!==null;){for(Ee=ze=Ie;ze!==null;){switch(Ne=ze,Oe=Ne.child,Ne.tag){case 0:case 11:case 14:case 15:bu(4,Ne,Ne.return);break;case 1:Al(Ne,Ne.return);var Ve=Ne.stateNode;if(typeof Ve.componentWillUnmount=="function"){I=Ne,v=Ne.return;try{m=I,Ve.props=m.memoizedProps,Ve.state=m.memoizedState,Ve.componentWillUnmount()}catch(Ge){un(I,v,Ge)}}break;case 5:Al(Ne,Ne.return);break;case 22:if(Ne.memoizedState!==null){k2(Ee);continue}}Oe!==null?(Oe.return=Ne,ze=Oe):k2(Ee)}Ie=Ie.sibling}e:for(Ie=null,Ee=h;;){if(Ee.tag===5){if(Ie===null){Ie=Ee;try{$=Ee.stateNode,xe?(D=$.style,typeof D.setProperty=="function"?D.setProperty("display","none","important"):D.display="none"):(X=Ee.stateNode,ee=Ee.memoizedProps.style,F=ee!=null&&ee.hasOwnProperty("display")?ee.display:null,X.style.display=ur("display",F))}catch(Ge){un(h,h.return,Ge)}}}else if(Ee.tag===6){if(Ie===null)try{Ee.stateNode.nodeValue=xe?"":Ee.memoizedProps}catch(Ge){un(h,h.return,Ge)}}else if((Ee.tag!==22&&Ee.tag!==23||Ee.memoizedState===null||Ee===h)&&Ee.child!==null){Ee.child.return=Ee,Ee=Ee.child;continue}if(Ee===h)break e;for(;Ee.sibling===null;){if(Ee.return===null||Ee.return===h)break e;Ie===Ee&&(Ie=null),Ee=Ee.return}Ie===Ee&&(Ie=null),Ee.sibling.return=Ee.return,Ee=Ee.sibling}}break;case 19:Wr(m,h),hi(h),I&4&&y2(h);break;case 21:break;default:Wr(m,h),hi(h)}}function hi(h){var m=h.flags;if(m&2){try{e:{for(var v=h.return;v!==null;){if(m2(v)){var I=v;break e}v=v.return}throw Error(t(160))}switch(I.tag){case 5:var $=I.stateNode;I.flags&32&&(Zn($,""),I.flags&=-33);var D=g2(h);Ly(h,D,$);break;case 3:case 4:var F=I.stateNode.containerInfo,X=g2(h);My(h,X,F);break;default:throw Error(t(161))}}catch(ee){un(h,h.return,ee)}h.flags&=-3}m&4096&&(h.flags&=-4097)}function d3(h,m,v){ze=h,b2(h)}function b2(h,m,v){for(var I=(h.mode&1)!==0;ze!==null;){var $=ze,D=$.child;if($.tag===22&&I){var F=$.memoizedState!==null||$f;if(!F){var X=$.alternate,ee=X!==null&&X.memoizedState!==null||ps;X=$f;var xe=ps;if($f=F,(ps=ee)&&!xe)for(ze=$;ze!==null;)F=ze,ee=F.child,F.tag===22&&F.memoizedState!==null?C2($):ee!==null?(ee.return=F,ze=ee):C2($);for(;D!==null;)ze=D,b2(D),D=D.sibling;ze=$,$f=X,ps=xe}w2(h)}else($.subtreeFlags&8772)!==0&&D!==null?(D.return=$,ze=D):w2(h)}}function w2(h){for(;ze!==null;){var m=ze;if((m.flags&8772)!==0){var v=m.alternate;try{if((m.flags&8772)!==0)switch(m.tag){case 0:case 11:case 15:ps||Ef(5,m);break;case 1:var I=m.stateNode;if(m.flags&4&&!ps)if(v===null)I.componentDidMount();else{var $=m.elementType===m.type?v.memoizedProps:zr(m.type,v.memoizedProps);I.componentDidUpdate($,v.memoizedState,I.__reactInternalSnapshotBeforeUpdate)}var D=m.updateQueue;D!==null&&kC(m,D,I);break;case 3:var F=m.updateQueue;if(F!==null){if(v=null,m.child!==null)switch(m.child.tag){case 5:v=m.child.stateNode;break;case 1:v=m.child.stateNode}kC(m,F,v)}break;case 5:var X=m.stateNode;if(v===null&&m.flags&4){v=X;var ee=m.memoizedProps;switch(m.type){case"button":case"input":case"select":case"textarea":ee.autoFocus&&v.focus();break;case"img":ee.src&&(v.src=ee.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(m.memoizedState===null){var xe=m.alternate;if(xe!==null){var Ie=xe.memoizedState;if(Ie!==null){var Ee=Ie.dehydrated;Ee!==null&&Zc(Ee)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(t(163))}ps||m.flags&512&&Py(m)}catch(Ne){un(m,m.return,Ne)}}if(m===h){ze=null;break}if(v=m.sibling,v!==null){v.return=m.return,ze=v;break}ze=m.return}}function k2(h){for(;ze!==null;){var m=ze;if(m===h){ze=null;break}var v=m.sibling;if(v!==null){v.return=m.return,ze=v;break}ze=m.return}}function C2(h){for(;ze!==null;){var m=ze;try{switch(m.tag){case 0:case 11:case 15:var v=m.return;try{Ef(4,m)}catch(ee){un(m,v,ee)}break;case 1:var I=m.stateNode;if(typeof I.componentDidMount=="function"){var $=m.return;try{I.componentDidMount()}catch(ee){un(m,$,ee)}}var D=m.return;try{Py(m)}catch(ee){un(m,D,ee)}break;case 5:var F=m.return;try{Py(m)}catch(ee){un(m,F,ee)}}}catch(ee){un(m,m.return,ee)}if(m===h){ze=null;break}var X=m.sibling;if(X!==null){X.return=m.return,ze=X;break}ze=m.return}}var h3=Math.ceil,Af=C.ReactCurrentDispatcher,Fy=C.ReactCurrentOwner,gr=C.ReactCurrentBatchConfig,Nt=0,Wn=null,Cn=null,es=0,tr=0,jl=bo(0),Dn=0,wu=null,xa=0,jf=0,Oy=0,ku=null,Ws=null,_y=0,Rl=1/0,Vi=null,Rf=!1,zy=null,Io=null,Df=!1,To=null,Pf=0,Cu=0,By=null,Mf=-1,Lf=0;function Is(){return(Nt&6)!==0?vn():Mf!==-1?Mf:Mf=vn()}function $o(h){return(h.mode&1)===0?1:(Nt&2)!==0&&es!==0?es&-es:QL.transition!==null?(Lf===0&&(Lf=gk()),Lf):(h=Dt,h!==0||(h=window.event,h=h===void 0?16:Nk(h.type)),h)}function Vr(h,m,v,I){if(50<Cu)throw Cu=0,By=null,Error(t(185));qc(h,v,I),((Nt&2)===0||h!==Wn)&&(h===Wn&&((Nt&2)===0&&(jf|=v),Dn===4&&Eo(h,es)),Vs(h,I),v===1&&Nt===0&&(m.mode&1)===0&&(Rl=vn()+500,uf&&ko()))}function Vs(h,m){var v=h.callbackNode;QM(h,m);var I=Uh(h,h===Wn?es:0);if(I===0)v!==null&&fk(v),h.callbackNode=null,h.callbackPriority=0;else if(m=I&-I,h.callbackPriority!==m){if(v!=null&&fk(v),m===1)h.tag===0?KL(N2.bind(null,h)):uC(N2.bind(null,h)),UL(function(){(Nt&6)===0&&ko()}),v=null;else{switch(xk(I)){case 1:v=bx;break;case 4:v=pk;break;case 16:v=zh;break;case 536870912:v=mk;break;default:v=zh}v=D2(v,S2.bind(null,h))}h.callbackPriority=m,h.callbackNode=v}}function S2(h,m){if(Mf=-1,Lf=0,(Nt&6)!==0)throw Error(t(327));var v=h.callbackNode;if(Dl()&&h.callbackNode!==v)return null;var I=Uh(h,h===Wn?es:0);if(I===0)return null;if((I&30)!==0||(I&h.expiredLanes)!==0||m)m=Ff(h,I);else{m=I;var $=Nt;Nt|=2;var D=T2();(Wn!==h||es!==m)&&(Vi=null,Rl=vn()+500,va(h,m));do try{m3();break}catch(X){I2(h,X)}while(!0);iy(),Af.current=D,Nt=$,Cn!==null?m=0:(Wn=null,es=0,m=Dn)}if(m!==0){if(m===2&&($=wx(h),$!==0&&(I=$,m=Wy(h,$))),m===1)throw v=wu,va(h,0),Eo(h,I),Vs(h,vn()),v;if(m===6)Eo(h,I);else{if($=h.current.alternate,(I&30)===0&&!f3($)&&(m=Ff(h,I),m===2&&(D=wx(h),D!==0&&(I=D,m=Wy(h,D))),m===1))throw v=wu,va(h,0),Eo(h,I),Vs(h,vn()),v;switch(h.finishedWork=$,h.finishedLanes=I,m){case 0:case 1:throw Error(t(345));case 2:ba(h,Ws,Vi);break;case 3:if(Eo(h,I),(I&130023424)===I&&(m=_y+500-vn(),10<m)){if(Uh(h,0)!==0)break;if($=h.suspendedLanes,($&I)!==I){Is(),h.pingedLanes|=h.suspendedLanes&$;break}h.timeoutHandle=Kx(ba.bind(null,h,Ws,Vi),m);break}ba(h,Ws,Vi);break;case 4:if(Eo(h,I),(I&4194240)===I)break;for(m=h.eventTimes,$=-1;0<I;){var F=31-Fr(I);D=1<<F,F=m[F],F>$&&($=F),I&=~D}if(I=$,I=vn()-I,I=(120>I?120:480>I?480:1080>I?1080:1920>I?1920:3e3>I?3e3:4320>I?4320:1960*h3(I/1960))-I,10<I){h.timeoutHandle=Kx(ba.bind(null,h,Ws,Vi),I);break}ba(h,Ws,Vi);break;case 5:ba(h,Ws,Vi);break;default:throw Error(t(329))}}}return Vs(h,vn()),h.callbackNode===v?S2.bind(null,h):null}function Wy(h,m){var v=ku;return h.current.memoizedState.isDehydrated&&(va(h,m).flags|=256),h=Ff(h,m),h!==2&&(m=Ws,Ws=v,m!==null&&Vy(m)),h}function Vy(h){Ws===null?Ws=h:Ws.push.apply(Ws,h)}function f3(h){for(var m=h;;){if(m.flags&16384){var v=m.updateQueue;if(v!==null&&(v=v.stores,v!==null))for(var I=0;I<v.length;I++){var $=v[I],D=$.getSnapshot;$=$.value;try{if(!Or(D(),$))return!1}catch{return!1}}}if(v=m.child,m.subtreeFlags&16384&&v!==null)v.return=m,m=v;else{if(m===h)break;for(;m.sibling===null;){if(m.return===null||m.return===h)return!0;m=m.return}m.sibling.return=m.return,m=m.sibling}}return!0}function Eo(h,m){for(m&=~Oy,m&=~jf,h.suspendedLanes|=m,h.pingedLanes&=~m,h=h.expirationTimes;0<m;){var v=31-Fr(m),I=1<<v;h[v]=-1,m&=~I}}function N2(h){if((Nt&6)!==0)throw Error(t(327));Dl();var m=Uh(h,0);if((m&1)===0)return Vs(h,vn()),null;var v=Ff(h,m);if(h.tag!==0&&v===2){var I=wx(h);I!==0&&(m=I,v=Wy(h,I))}if(v===1)throw v=wu,va(h,0),Eo(h,m),Vs(h,vn()),v;if(v===6)throw Error(t(345));return h.finishedWork=h.current.alternate,h.finishedLanes=m,ba(h,Ws,Vi),Vs(h,vn()),null}function Uy(h,m){var v=Nt;Nt|=1;try{return h(m)}finally{Nt=v,Nt===0&&(Rl=vn()+500,uf&&ko())}}function ya(h){To!==null&&To.tag===0&&(Nt&6)===0&&Dl();var m=Nt;Nt|=1;var v=gr.transition,I=Dt;try{if(gr.transition=null,Dt=1,h)return h()}finally{Dt=I,gr.transition=v,Nt=m,(Nt&6)===0&&ko()}}function Gy(){tr=jl.current,qt(jl)}function va(h,m){h.finishedWork=null,h.finishedLanes=0;var v=h.timeoutHandle;if(v!==-1&&(h.timeoutHandle=-1,VL(v)),Cn!==null)for(v=Cn.return;v!==null;){var I=v;switch(ey(I),I.tag){case 1:I=I.type.childContextTypes,I!=null&&lf();break;case 3:$l(),qt(_s),qt(ds),fy();break;case 5:dy(I);break;case 4:$l();break;case 13:qt(rn);break;case 19:qt(rn);break;case 10:oy(I.type._context);break;case 22:case 23:Gy()}v=v.return}if(Wn=h,Cn=h=Ao(h.current,null),es=tr=m,Dn=0,wu=null,Oy=jf=xa=0,Ws=ku=null,pa!==null){for(m=0;m<pa.length;m++)if(v=pa[m],I=v.interleaved,I!==null){v.interleaved=null;var $=I.next,D=v.pending;if(D!==null){var F=D.next;D.next=$,I.next=F}v.pending=I}pa=null}return h}function I2(h,m){do{var v=Cn;try{if(iy(),bf.current=Sf,wf){for(var I=on.memoizedState;I!==null;){var $=I.queue;$!==null&&($.pending=null),I=I.next}wf=!1}if(ga=0,Bn=Rn=on=null,mu=!1,gu=0,Fy.current=null,v===null||v.return===null){Dn=1,wu=m,Cn=null;break}e:{var D=h,F=v.return,X=v,ee=m;if(m=es,X.flags|=32768,ee!==null&&typeof ee=="object"&&typeof ee.then=="function"){var xe=ee,Ie=X,Ee=Ie.tag;if((Ie.mode&1)===0&&(Ee===0||Ee===11||Ee===15)){var Ne=Ie.alternate;Ne?(Ie.updateQueue=Ne.updateQueue,Ie.memoizedState=Ne.memoizedState,Ie.lanes=Ne.lanes):(Ie.updateQueue=null,Ie.memoizedState=null)}var Oe=YC(F);if(Oe!==null){Oe.flags&=-257,ZC(Oe,F,X,D,m),Oe.mode&1&&XC(D,xe,m),m=Oe,ee=xe;var Ve=m.updateQueue;if(Ve===null){var Ge=new Set;Ge.add(ee),m.updateQueue=Ge}else Ve.add(ee);break e}else{if((m&1)===0){XC(D,xe,m),Hy();break e}ee=Error(t(426))}}else if(Zt&&X.mode&1){var bn=YC(F);if(bn!==null){(bn.flags&65536)===0&&(bn.flags|=256),ZC(bn,F,X,D,m),sy(El(ee,X));break e}}D=ee=El(ee,X),Dn!==4&&(Dn=2),ku===null?ku=[D]:ku.push(D),D=F;do{switch(D.tag){case 3:D.flags|=65536,m&=-m,D.lanes|=m;var ce=KC(D,ee,m);wC(D,ce);break e;case 1:X=ee;var se=D.type,fe=D.stateNode;if((D.flags&128)===0&&(typeof se.getDerivedStateFromError=="function"||fe!==null&&typeof fe.componentDidCatch=="function"&&(Io===null||!Io.has(fe)))){D.flags|=65536,m&=-m,D.lanes|=m;var Re=QC(D,X,m);wC(D,Re);break e}}D=D.return}while(D!==null)}E2(v)}catch(He){m=He,Cn===v&&v!==null&&(Cn=v=v.return);continue}break}while(!0)}function T2(){var h=Af.current;return Af.current=Sf,h===null?Sf:h}function Hy(){(Dn===0||Dn===3||Dn===2)&&(Dn=4),Wn===null||(xa&268435455)===0&&(jf&268435455)===0||Eo(Wn,es)}function Ff(h,m){var v=Nt;Nt|=2;var I=T2();(Wn!==h||es!==m)&&(Vi=null,va(h,m));do try{p3();break}catch($){I2(h,$)}while(!0);if(iy(),Nt=v,Af.current=I,Cn!==null)throw Error(t(261));return Wn=null,es=0,Dn}function p3(){for(;Cn!==null;)$2(Cn)}function m3(){for(;Cn!==null&&!zM();)$2(Cn)}function $2(h){var m=R2(h.alternate,h,tr);h.memoizedProps=h.pendingProps,m===null?E2(h):Cn=m,Fy.current=null}function E2(h){var m=h;do{var v=m.alternate;if(h=m.return,(m.flags&32768)===0){if(v=a3(v,m,tr),v!==null){Cn=v;return}}else{if(v=l3(v,m),v!==null){v.flags&=32767,Cn=v;return}if(h!==null)h.flags|=32768,h.subtreeFlags=0,h.deletions=null;else{Dn=6,Cn=null;return}}if(m=m.sibling,m!==null){Cn=m;return}Cn=m=h}while(m!==null);Dn===0&&(Dn=5)}function ba(h,m,v){var I=Dt,$=gr.transition;try{gr.transition=null,Dt=1,g3(h,m,v,I)}finally{gr.transition=$,Dt=I}return null}function g3(h,m,v,I){do Dl();while(To!==null);if((Nt&6)!==0)throw Error(t(327));v=h.finishedWork;var $=h.finishedLanes;if(v===null)return null;if(h.finishedWork=null,h.finishedLanes=0,v===h.current)throw Error(t(177));h.callbackNode=null,h.callbackPriority=0;var D=v.lanes|v.childLanes;if(XM(h,D),h===Wn&&(Cn=Wn=null,es=0),(v.subtreeFlags&2064)===0&&(v.flags&2064)===0||Df||(Df=!0,D2(zh,function(){return Dl(),null})),D=(v.flags&15990)!==0,(v.subtreeFlags&15990)!==0||D){D=gr.transition,gr.transition=null;var F=Dt;Dt=1;var X=Nt;Nt|=4,Fy.current=null,u3(h,v),v2(v,h),LL(Hx),qh=!!Gx,Hx=Gx=null,h.current=v,d3(v),BM(),Nt=X,Dt=F,gr.transition=D}else h.current=v;if(Df&&(Df=!1,To=h,Pf=$),D=h.pendingLanes,D===0&&(Io=null),UM(v.stateNode),Vs(h,vn()),m!==null)for(I=h.onRecoverableError,v=0;v<m.length;v++)$=m[v],I($.value,{componentStack:$.stack,digest:$.digest});if(Rf)throw Rf=!1,h=zy,zy=null,h;return(Pf&1)!==0&&h.tag!==0&&Dl(),D=h.pendingLanes,(D&1)!==0?h===By?Cu++:(Cu=0,By=h):Cu=0,ko(),null}function Dl(){if(To!==null){var h=xk(Pf),m=gr.transition,v=Dt;try{if(gr.transition=null,Dt=16>h?16:h,To===null)var I=!1;else{if(h=To,To=null,Pf=0,(Nt&6)!==0)throw Error(t(331));var $=Nt;for(Nt|=4,ze=h.current;ze!==null;){var D=ze,F=D.child;if((ze.flags&16)!==0){var X=D.deletions;if(X!==null){for(var ee=0;ee<X.length;ee++){var xe=X[ee];for(ze=xe;ze!==null;){var Ie=ze;switch(Ie.tag){case 0:case 11:case 15:bu(8,Ie,D)}var Ee=Ie.child;if(Ee!==null)Ee.return=Ie,ze=Ee;else for(;ze!==null;){Ie=ze;var Ne=Ie.sibling,Oe=Ie.return;if(p2(Ie),Ie===xe){ze=null;break}if(Ne!==null){Ne.return=Oe,ze=Ne;break}ze=Oe}}}var Ve=D.alternate;if(Ve!==null){var Ge=Ve.child;if(Ge!==null){Ve.child=null;do{var bn=Ge.sibling;Ge.sibling=null,Ge=bn}while(Ge!==null)}}ze=D}}if((D.subtreeFlags&2064)!==0&&F!==null)F.return=D,ze=F;else e:for(;ze!==null;){if(D=ze,(D.flags&2048)!==0)switch(D.tag){case 0:case 11:case 15:bu(9,D,D.return)}var ce=D.sibling;if(ce!==null){ce.return=D.return,ze=ce;break e}ze=D.return}}var se=h.current;for(ze=se;ze!==null;){F=ze;var fe=F.child;if((F.subtreeFlags&2064)!==0&&fe!==null)fe.return=F,ze=fe;else e:for(F=se;ze!==null;){if(X=ze,(X.flags&2048)!==0)try{switch(X.tag){case 0:case 11:case 15:Ef(9,X)}}catch(He){un(X,X.return,He)}if(X===F){ze=null;break e}var Re=X.sibling;if(Re!==null){Re.return=X.return,ze=Re;break e}ze=X.return}}if(Nt=$,ko(),li&&typeof li.onPostCommitFiberRoot=="function")try{li.onPostCommitFiberRoot(Bh,h)}catch{}I=!0}return I}finally{Dt=v,gr.transition=m}}return!1}function A2(h,m,v){m=El(v,m),m=KC(h,m,1),h=So(h,m,1),m=Is(),h!==null&&(qc(h,1,m),Vs(h,m))}function un(h,m,v){if(h.tag===3)A2(h,h,v);else for(;m!==null;){if(m.tag===3){A2(m,h,v);break}else if(m.tag===1){var I=m.stateNode;if(typeof m.type.getDerivedStateFromError=="function"||typeof I.componentDidCatch=="function"&&(Io===null||!Io.has(I))){h=El(v,h),h=QC(m,h,1),m=So(m,h,1),h=Is(),m!==null&&(qc(m,1,h),Vs(m,h));break}}m=m.return}}function x3(h,m,v){var I=h.pingCache;I!==null&&I.delete(m),m=Is(),h.pingedLanes|=h.suspendedLanes&v,Wn===h&&(es&v)===v&&(Dn===4||Dn===3&&(es&130023424)===es&&500>vn()-_y?va(h,0):Oy|=v),Vs(h,m)}function j2(h,m){m===0&&((h.mode&1)===0?m=1:(m=Vh,Vh<<=1,(Vh&130023424)===0&&(Vh=4194304)));var v=Is();h=zi(h,m),h!==null&&(qc(h,m,v),Vs(h,v))}function y3(h){var m=h.memoizedState,v=0;m!==null&&(v=m.retryLane),j2(h,v)}function v3(h,m){var v=0;switch(h.tag){case 13:var I=h.stateNode,$=h.memoizedState;$!==null&&(v=$.retryLane);break;case 19:I=h.stateNode;break;default:throw Error(t(314))}I!==null&&I.delete(m),j2(h,v)}var R2;R2=function(h,m,v){if(h!==null)if(h.memoizedProps!==m.pendingProps||_s.current)Bs=!0;else{if((h.lanes&v)===0&&(m.flags&128)===0)return Bs=!1,o3(h,m,v);Bs=(h.flags&131072)!==0}else Bs=!1,Zt&&(m.flags&1048576)!==0&&dC(m,hf,m.index);switch(m.lanes=0,m.tag){case 2:var I=m.type;Tf(h,m),h=m.pendingProps;var $=wl(m,ds.current);Tl(m,v),$=gy(null,m,I,h,$,v);var D=xy();return m.flags|=1,typeof $=="object"&&$!==null&&typeof $.render=="function"&&$.$$typeof===void 0?(m.tag=1,m.memoizedState=null,m.updateQueue=null,zs(I)?(D=!0,cf(m)):D=!1,m.memoizedState=$.state!==null&&$.state!==void 0?$.state:null,cy(m),$.updater=Nf,m.stateNode=$,$._reactInternals=m,Cy(m,I,h,v),m=Ty(null,m,I,!0,D,v)):(m.tag=0,Zt&&D&&Jx(m),Ns(null,m,$,v),m=m.child),m;case 16:I=m.elementType;e:{switch(Tf(h,m),h=m.pendingProps,$=I._init,I=$(I._payload),m.type=I,$=m.tag=w3(I),h=zr(I,h),$){case 0:m=Iy(null,m,I,h,v);break e;case 1:m=r2(null,m,I,h,v);break e;case 11:m=JC(null,m,I,h,v);break e;case 14:m=e2(null,m,I,zr(I.type,h),v);break e}throw Error(t(306,I,""))}return m;case 0:return I=m.type,$=m.pendingProps,$=m.elementType===I?$:zr(I,$),Iy(h,m,I,$,v);case 1:return I=m.type,$=m.pendingProps,$=m.elementType===I?$:zr(I,$),r2(h,m,I,$,v);case 3:e:{if(i2(m),h===null)throw Error(t(387));I=m.pendingProps,D=m.memoizedState,$=D.element,bC(h,m),yf(m,I,null,v);var F=m.memoizedState;if(I=F.element,D.isDehydrated)if(D={element:I,isDehydrated:!1,cache:F.cache,pendingSuspenseBoundaries:F.pendingSuspenseBoundaries,transitions:F.transitions},m.updateQueue.baseState=D,m.memoizedState=D,m.flags&256){$=El(Error(t(423)),m),m=o2(h,m,I,v,$);break e}else if(I!==$){$=El(Error(t(424)),m),m=o2(h,m,I,v,$);break e}else for(er=vo(m.stateNode.containerInfo.firstChild),Js=m,Zt=!0,_r=null,v=yC(m,null,I,v),m.child=v;v;)v.flags=v.flags&-3|4096,v=v.sibling;else{if(Sl(),I===$){m=Wi(h,m,v);break e}Ns(h,m,I,v)}m=m.child}return m;case 5:return CC(m),h===null&&ny(m),I=m.type,$=m.pendingProps,D=h!==null?h.memoizedProps:null,F=$.children,qx(I,$)?F=null:D!==null&&qx(I,D)&&(m.flags|=32),s2(h,m),Ns(h,m,F,v),m.child;case 6:return h===null&&ny(m),null;case 13:return a2(h,m,v);case 4:return uy(m,m.stateNode.containerInfo),I=m.pendingProps,h===null?m.child=Nl(m,null,I,v):Ns(h,m,I,v),m.child;case 11:return I=m.type,$=m.pendingProps,$=m.elementType===I?$:zr(I,$),JC(h,m,I,$,v);case 7:return Ns(h,m,m.pendingProps,v),m.child;case 8:return Ns(h,m,m.pendingProps.children,v),m.child;case 12:return Ns(h,m,m.pendingProps.children,v),m.child;case 10:e:{if(I=m.type._context,$=m.pendingProps,D=m.memoizedProps,F=$.value,zt(mf,I._currentValue),I._currentValue=F,D!==null)if(Or(D.value,F)){if(D.children===$.children&&!_s.current){m=Wi(h,m,v);break e}}else for(D=m.child,D!==null&&(D.return=m);D!==null;){var X=D.dependencies;if(X!==null){F=D.child;for(var ee=X.firstContext;ee!==null;){if(ee.context===I){if(D.tag===1){ee=Bi(-1,v&-v),ee.tag=2;var xe=D.updateQueue;if(xe!==null){xe=xe.shared;var Ie=xe.pending;Ie===null?ee.next=ee:(ee.next=Ie.next,Ie.next=ee),xe.pending=ee}}D.lanes|=v,ee=D.alternate,ee!==null&&(ee.lanes|=v),ay(D.return,v,m),X.lanes|=v;break}ee=ee.next}}else if(D.tag===10)F=D.type===m.type?null:D.child;else if(D.tag===18){if(F=D.return,F===null)throw Error(t(341));F.lanes|=v,X=F.alternate,X!==null&&(X.lanes|=v),ay(F,v,m),F=D.sibling}else F=D.child;if(F!==null)F.return=D;else for(F=D;F!==null;){if(F===m){F=null;break}if(D=F.sibling,D!==null){D.return=F.return,F=D;break}F=F.return}D=F}Ns(h,m,$.children,v),m=m.child}return m;case 9:return $=m.type,I=m.pendingProps.children,Tl(m,v),$=pr($),I=I($),m.flags|=1,Ns(h,m,I,v),m.child;case 14:return I=m.type,$=zr(I,m.pendingProps),$=zr(I.type,$),e2(h,m,I,$,v);case 15:return t2(h,m,m.type,m.pendingProps,v);case 17:return I=m.type,$=m.pendingProps,$=m.elementType===I?$:zr(I,$),Tf(h,m),m.tag=1,zs(I)?(h=!0,cf(m)):h=!1,Tl(m,v),HC(m,I,$),Cy(m,I,$,v),Ty(null,m,I,!0,h,v);case 19:return c2(h,m,v);case 22:return n2(h,m,v)}throw Error(t(156,m.tag))};function D2(h,m){return hk(h,m)}function b3(h,m,v,I){this.tag=h,this.key=v,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=m,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=I,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function xr(h,m,v,I){return new b3(h,m,v,I)}function qy(h){return h=h.prototype,!(!h||!h.isReactComponent)}function w3(h){if(typeof h=="function")return qy(h)?1:0;if(h!=null){if(h=h.$$typeof,h===L)return 11;if(h===U)return 14}return 2}function Ao(h,m){var v=h.alternate;return v===null?(v=xr(h.tag,m,h.key,h.mode),v.elementType=h.elementType,v.type=h.type,v.stateNode=h.stateNode,v.alternate=h,h.alternate=v):(v.pendingProps=m,v.type=h.type,v.flags=0,v.subtreeFlags=0,v.deletions=null),v.flags=h.flags&14680064,v.childLanes=h.childLanes,v.lanes=h.lanes,v.child=h.child,v.memoizedProps=h.memoizedProps,v.memoizedState=h.memoizedState,v.updateQueue=h.updateQueue,m=h.dependencies,v.dependencies=m===null?null:{lanes:m.lanes,firstContext:m.firstContext},v.sibling=h.sibling,v.index=h.index,v.ref=h.ref,v}function Of(h,m,v,I,$,D){var F=2;if(I=h,typeof h=="function")qy(h)&&(F=1);else if(typeof h=="string")F=5;else e:switch(h){case A:return wa(v.children,$,D,m);case E:F=8,$|=8;break;case M:return h=xr(12,v,m,$|2),h.elementType=M,h.lanes=D,h;case _:return h=xr(13,v,m,$),h.elementType=_,h.lanes=D,h;case O:return h=xr(19,v,m,$),h.elementType=O,h.lanes=D,h;case H:return _f(v,$,D,m);default:if(typeof h=="object"&&h!==null)switch(h.$$typeof){case P:F=10;break e;case R:F=9;break e;case L:F=11;break e;case U:F=14;break e;case W:F=16,I=null;break e}throw Error(t(130,h==null?h:typeof h,""))}return m=xr(F,v,m,$),m.elementType=h,m.type=I,m.lanes=D,m}function wa(h,m,v,I){return h=xr(7,h,I,m),h.lanes=v,h}function _f(h,m,v,I){return h=xr(22,h,I,m),h.elementType=H,h.lanes=v,h.stateNode={isHidden:!1},h}function Ky(h,m,v){return h=xr(6,h,null,m),h.lanes=v,h}function Qy(h,m,v){return m=xr(4,h.children!==null?h.children:[],h.key,m),m.lanes=v,m.stateNode={containerInfo:h.containerInfo,pendingChildren:null,implementation:h.implementation},m}function k3(h,m,v,I,$){this.tag=m,this.containerInfo=h,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=kx(0),this.expirationTimes=kx(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=kx(0),this.identifierPrefix=I,this.onRecoverableError=$,this.mutableSourceEagerHydrationData=null}function Xy(h,m,v,I,$,D,F,X,ee){return h=new k3(h,m,v,X,ee),m===1?(m=1,D===!0&&(m|=8)):m=0,D=xr(3,null,null,m),h.current=D,D.stateNode=h,D.memoizedState={element:I,isDehydrated:v,cache:null,transitions:null,pendingSuspenseBoundaries:null},cy(D),h}function C3(h,m,v){var I=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:T,key:I==null?null:""+I,children:h,containerInfo:m,implementation:v}}function P2(h){if(!h)return wo;h=h._reactInternals;e:{if(ca(h)!==h||h.tag!==1)throw Error(t(170));var m=h;do{switch(m.tag){case 3:m=m.stateNode.context;break e;case 1:if(zs(m.type)){m=m.stateNode.__reactInternalMemoizedMergedChildContext;break e}}m=m.return}while(m!==null);throw Error(t(171))}if(h.tag===1){var v=h.type;if(zs(v))return lC(h,v,m)}return m}function M2(h,m,v,I,$,D,F,X,ee){return h=Xy(v,I,!0,h,$,D,F,X,ee),h.context=P2(null),v=h.current,I=Is(),$=$o(v),D=Bi(I,$),D.callback=m??null,So(v,D,$),h.current.lanes=$,qc(h,$,I),Vs(h,I),h}function zf(h,m,v,I){var $=m.current,D=Is(),F=$o($);return v=P2(v),m.context===null?m.context=v:m.pendingContext=v,m=Bi(D,F),m.payload={element:h},I=I===void 0?null:I,I!==null&&(m.callback=I),h=So($,m,F),h!==null&&(Vr(h,$,F,D),xf(h,$,F)),F}function Bf(h){if(h=h.current,!h.child)return null;switch(h.child.tag){case 5:return h.child.stateNode;default:return h.child.stateNode}}function L2(h,m){if(h=h.memoizedState,h!==null&&h.dehydrated!==null){var v=h.retryLane;h.retryLane=v!==0&&v<m?v:m}}function Yy(h,m){L2(h,m),(h=h.alternate)&&L2(h,m)}function S3(){return null}var F2=typeof reportError=="function"?reportError:function(h){console.error(h)};function Zy(h){this._internalRoot=h}Wf.prototype.render=Zy.prototype.render=function(h){var m=this._internalRoot;if(m===null)throw Error(t(409));zf(h,m,null,null)},Wf.prototype.unmount=Zy.prototype.unmount=function(){var h=this._internalRoot;if(h!==null){this._internalRoot=null;var m=h.containerInfo;ya(function(){zf(null,h,null,null)}),m[Li]=null}};function Wf(h){this._internalRoot=h}Wf.prototype.unstable_scheduleHydration=function(h){if(h){var m=bk();h={blockedOn:null,target:h,priority:m};for(var v=0;v<go.length&&m!==0&&m<go[v].priority;v++);go.splice(v,0,h),v===0&&Ck(h)}};function Jy(h){return!(!h||h.nodeType!==1&&h.nodeType!==9&&h.nodeType!==11)}function Vf(h){return!(!h||h.nodeType!==1&&h.nodeType!==9&&h.nodeType!==11&&(h.nodeType!==8||h.nodeValue!==" react-mount-point-unstable "))}function O2(){}function N3(h,m,v,I,$){if($){if(typeof I=="function"){var D=I;I=function(){var xe=Bf(F);D.call(xe)}}var F=M2(m,I,h,0,null,!1,!1,"",O2);return h._reactRootContainer=F,h[Li]=F.current,au(h.nodeType===8?h.parentNode:h),ya(),F}for(;$=h.lastChild;)h.removeChild($);if(typeof I=="function"){var X=I;I=function(){var xe=Bf(ee);X.call(xe)}}var ee=Xy(h,0,!1,null,null,!1,!1,"",O2);return h._reactRootContainer=ee,h[Li]=ee.current,au(h.nodeType===8?h.parentNode:h),ya(function(){zf(m,ee,v,I)}),ee}function Uf(h,m,v,I,$){var D=v._reactRootContainer;if(D){var F=D;if(typeof $=="function"){var X=$;$=function(){var ee=Bf(F);X.call(ee)}}zf(m,F,h,$)}else F=N3(v,m,h,$,I);return Bf(F)}yk=function(h){switch(h.tag){case 3:var m=h.stateNode;if(m.current.memoizedState.isDehydrated){var v=Hc(m.pendingLanes);v!==0&&(Cx(m,v|1),Vs(m,vn()),(Nt&6)===0&&(Rl=vn()+500,ko()))}break;case 13:ya(function(){var I=zi(h,1);if(I!==null){var $=Is();Vr(I,h,1,$)}}),Yy(h,1)}},Sx=function(h){if(h.tag===13){var m=zi(h,134217728);if(m!==null){var v=Is();Vr(m,h,134217728,v)}Yy(h,134217728)}},vk=function(h){if(h.tag===13){var m=$o(h),v=zi(h,m);if(v!==null){var I=Is();Vr(v,h,m,I)}Yy(h,m)}},bk=function(){return Dt},wk=function(h,m){var v=Dt;try{return Dt=h,m()}finally{Dt=v}},Uc=function(h,m,v){switch(m){case"input":if(Ae(h,v),m=v.name,v.type==="radio"&&m!=null){for(v=h;v.parentNode;)v=v.parentNode;for(v=v.querySelectorAll("input[name="+JSON.stringify(""+m)+'][type="radio"]'),m=0;m<v.length;m++){var I=v[m];if(I!==h&&I.form===h.form){var $=af(I);if(!$)throw Error(t(90));ue(I),Ae(I,$)}}}break;case"textarea":it(h,v);break;case"select":m=v.value,m!=null&&je(h,!!v.multiple,m,!1)}},Ss=Uy,cs=ya;var I3={usingClientEntryPoint:!1,Events:[uu,vl,af,ls,Pr,Uy]},Su={findFiberByHostInstance:ua,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},T3={bundleType:Su.bundleType,version:Su.version,rendererPackageName:Su.rendererPackageName,rendererConfig:Su.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:C.ReactCurrentDispatcher,findHostInstanceByFiber:function(h){return h=uk(h),h===null?null:h.stateNode},findFiberByHostInstance:Su.findFiberByHostInstance||S3,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Gf=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Gf.isDisabled&&Gf.supportsFiber)try{Bh=Gf.inject(T3),li=Gf}catch{}}return Us.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=I3,Us.createPortal=function(h,m){var v=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Jy(m))throw Error(t(200));return C3(h,m,null,v)},Us.createRoot=function(h,m){if(!Jy(h))throw Error(t(299));var v=!1,I="",$=F2;return m!=null&&(m.unstable_strictMode===!0&&(v=!0),m.identifierPrefix!==void 0&&(I=m.identifierPrefix),m.onRecoverableError!==void 0&&($=m.onRecoverableError)),m=Xy(h,1,!1,null,null,v,!1,I,$),h[Li]=m.current,au(h.nodeType===8?h.parentNode:h),new Zy(m)},Us.findDOMNode=function(h){if(h==null)return null;if(h.nodeType===1)return h;var m=h._reactInternals;if(m===void 0)throw typeof h.render=="function"?Error(t(188)):(h=Object.keys(h).join(","),Error(t(268,h)));return h=uk(m),h=h===null?null:h.stateNode,h},Us.flushSync=function(h){return ya(h)},Us.hydrate=function(h,m,v){if(!Vf(m))throw Error(t(200));return Uf(null,h,m,!0,v)},Us.hydrateRoot=function(h,m,v){if(!Jy(h))throw Error(t(405));var I=v!=null&&v.hydratedSources||null,$=!1,D="",F=F2;if(v!=null&&(v.unstable_strictMode===!0&&($=!0),v.identifierPrefix!==void 0&&(D=v.identifierPrefix),v.onRecoverableError!==void 0&&(F=v.onRecoverableError)),m=M2(m,null,h,1,v??null,$,!1,D,F),h[Li]=m.current,au(h),I)for(h=0;h<I.length;h++)v=I[h],$=v._getVersion,$=$(v._source),m.mutableSourceEagerHydrationData==null?m.mutableSourceEagerHydrationData=[v,$]:m.mutableSourceEagerHydrationData.push(v,$);return new Wf(m)},Us.render=function(h,m,v){if(!Vf(m))throw Error(t(200));return Uf(null,h,m,!1,v)},Us.unmountComponentAtNode=function(h){if(!Vf(h))throw Error(t(40));return h._reactRootContainer?(ya(function(){Uf(null,null,h,!1,function(){h._reactRootContainer=null,h[Li]=null})}),!0):!1},Us.unstable_batchedUpdates=Uy,Us.unstable_renderSubtreeIntoContainer=function(h,m,v,I){if(!Vf(v))throw Error(t(200));if(h==null||h._reactInternals===void 0)throw Error(t(38));return Uf(h,m,v,!1,I)},Us.version="18.3.1-next-f1338f8080-20240426",Us}var H2;function vT(){if(H2)return n0.exports;H2=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),n0.exports=O3(),n0.exports}var q2;function _3(){if(q2)return Hf;q2=1;var n=vT();return Hf.createRoot=n.createRoot,Hf.hydrateRoot=n.hydrateRoot,Hf}var z3=_3();const B3=tb(z3),W3=()=>{const[n,e]=j.useState(!1),[t,s]=j.useState("win32");j.useEffect(()=>(window.api.windowIsMaximized().then(e),window.api.getPlatform().then(s),window.api.onWindowMaximizedChange(e)),[]);const r=()=>{window.api.windowMinimize()},i=()=>{window.api.windowMaximize()},o=()=>{window.api.windowClose()};return t==="darwin"?c.jsx("div",{className:"title-bar title-bar--macos",children:c.jsx("div",{className:"title-bar__drag-region"})}):c.jsxs("div",{className:"title-bar",children:[c.jsx("div",{className:"title-bar__drag-region"}),c.jsxs("div",{className:"title-bar__controls",children:[c.jsx("button",{className:"title-bar__button title-bar__button--minimize",onClick:r,"aria-label":"Minimize",children:c.jsx("svg",{width:"10",height:"1",viewBox:"0 0 10 1",children:c.jsx("rect",{width:"10",height:"1",fill:"currentColor"})})}),c.jsx("button",{className:"title-bar__button title-bar__button--maximize",onClick:i,"aria-label":n?"Restore":"Maximize",children:n?c.jsx("svg",{width:"10",height:"10",viewBox:"0 0 10 10",children:c.jsx("path",{fill:"none",stroke:"currentColor",strokeWidth:"1",d:"M2 3v6h6V3H2zm1-2h6v6"})}):c.jsx("svg",{width:"10",height:"10",viewBox:"0 0 10 10",children:c.jsx("rect",{x:"0.5",y:"0.5",width:"9",height:"9",fill:"none",stroke:"currentColor",strokeWidth:"1"})})}),c.jsx("button",{className:"title-bar__button title-bar__button--close",onClick:o,"aria-label":"Close",children:c.jsx("svg",{width:"10",height:"10",viewBox:"0 0 10 10",children:c.jsx("path",{fill:"currentColor",d:"M1.41 0L5 3.59 8.59 0 10 1.41 6.41 5 10 8.59 8.59 10 5 6.41 1.41 10 0 8.59 3.59 5 0 1.41z"})})})]})]})};var Ul=vT();function V3(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];return j.useMemo(()=>s=>{e.forEach(r=>r(s))},e)}const Im=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function bc(n){const e=Object.prototype.toString.call(n);return e==="[object Window]"||e==="[object global]"}function sb(n){return"nodeType"in n}function Ms(n){var e,t;return n?bc(n)?n:sb(n)&&(e=(t=n.ownerDocument)==null?void 0:t.defaultView)!=null?e:window:window}function rb(n){const{Document:e}=Ms(n);return n instanceof e}function ud(n){return bc(n)?!1:n instanceof Ms(n).HTMLElement}function bT(n){return n instanceof Ms(n).SVGElement}function wc(n){return n?bc(n)?n.document:sb(n)?rb(n)?n:ud(n)||bT(n)?n.ownerDocument:document:document:document}const Jr=Im?j.useLayoutEffect:j.useEffect;function Tm(n){const e=j.useRef(n);return Jr(()=>{e.current=n}),j.useCallback(function(){for(var t=arguments.length,s=new Array(t),r=0;r<t;r++)s[r]=arguments[r];return e.current==null?void 0:e.current(...s)},[])}function U3(){const n=j.useRef(null),e=j.useCallback((s,r)=>{n.current=setInterval(s,r)},[]),t=j.useCallback(()=>{n.current!==null&&(clearInterval(n.current),n.current=null)},[]);return[e,t]}function qu(n,e){e===void 0&&(e=[n]);const t=j.useRef(n);return Jr(()=>{t.current!==n&&(t.current=n)},e),t}function dd(n,e){const t=j.useRef();return j.useMemo(()=>{const s=n(t.current);return t.current=s,s},[...e])}function Mp(n){const e=Tm(n),t=j.useRef(null),s=j.useCallback(r=>{r!==t.current&&(e==null||e(r,t.current)),t.current=r},[]);return[t,s]}function Lp(n){const e=j.useRef();return j.useEffect(()=>{e.current=n},[n]),e.current}let i0={};function hd(n,e){return j.useMemo(()=>{if(e)return e;const t=i0[n]==null?0:i0[n]+1;return i0[n]=t,n+"-"+t},[n,e])}function wT(n){return function(e){for(var t=arguments.length,s=new Array(t>1?t-1:0),r=1;r<t;r++)s[r-1]=arguments[r];return s.reduce((i,o)=>{const a=Object.entries(o);for(const[l,u]of a){const d=i[l];d!=null&&(i[l]=d+n*u)}return i},{...e})}}const Hl=wT(1),Ku=wT(-1);function G3(n){return"clientX"in n&&"clientY"in n}function $m(n){if(!n)return!1;const{KeyboardEvent:e}=Ms(n.target);return e&&n instanceof e}function H3(n){if(!n)return!1;const{TouchEvent:e}=Ms(n.target);return e&&n instanceof e}function Fp(n){if(H3(n)){if(n.touches&&n.touches.length){const{clientX:e,clientY:t}=n.touches[0];return{x:e,y:t}}else if(n.changedTouches&&n.changedTouches.length){const{clientX:e,clientY:t}=n.changedTouches[0];return{x:e,y:t}}}return G3(n)?{x:n.clientX,y:n.clientY}:null}const ei=Object.freeze({Translate:{toString(n){if(!n)return;const{x:e,y:t}=n;return"translate3d("+(e?Math.round(e):0)+"px, "+(t?Math.round(t):0)+"px, 0)"}},Scale:{toString(n){if(!n)return;const{scaleX:e,scaleY:t}=n;return"scaleX("+e+") scaleY("+t+")"}},Transform:{toString(n){if(n)return[ei.Translate.toString(n),ei.Scale.toString(n)].join(" ")}},Transition:{toString(n){let{property:e,duration:t,easing:s}=n;return e+" "+t+"ms "+s}}}),K2="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function q3(n){return n.matches(K2)?n:n.querySelector(K2)}const K3={display:"none"};function Q3(n){let{id:e,value:t}=n;return gt.createElement("div",{id:e,style:K3},t)}function X3(n){let{id:e,announcement:t,ariaLiveType:s="assertive"}=n;const r={position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"};return gt.createElement("div",{id:e,style:r,role:"status","aria-live":s,"aria-atomic":!0},t)}function Y3(){const[n,e]=j.useState("");return{announce:j.useCallback(s=>{s!=null&&e(s)},[]),announcement:n}}const kT=j.createContext(null);function Z3(n){const e=j.useContext(kT);j.useEffect(()=>{if(!e)throw new Error("useDndMonitor must be used within a children of <DndContext>");return e(n)},[n,e])}function J3(){const[n]=j.useState(()=>new Set),e=j.useCallback(s=>(n.add(s),()=>n.delete(s)),[n]);return[j.useCallback(s=>{let{type:r,event:i}=s;n.forEach(o=>{var a;return(a=o[r])==null?void 0:a.call(o,i)})},[n]),e]}const eF={draggable:`
    To pick up a draggable item, press the space bar.
    While dragging, use the arrow keys to move the item.
    Press space again to drop the item in its new position, or press escape to cancel.
  `},tF={onDragStart(n){let{active:e}=n;return"Picked up draggable item "+e.id+"."},onDragOver(n){let{active:e,over:t}=n;return t?"Draggable item "+e.id+" was moved over droppable area "+t.id+".":"Draggable item "+e.id+" is no longer over a droppable area."},onDragEnd(n){let{active:e,over:t}=n;return t?"Draggable item "+e.id+" was dropped over droppable area "+t.id:"Draggable item "+e.id+" was dropped."},onDragCancel(n){let{active:e}=n;return"Dragging was cancelled. Draggable item "+e.id+" was dropped."}};function nF(n){let{announcements:e=tF,container:t,hiddenTextDescribedById:s,screenReaderInstructions:r=eF}=n;const{announce:i,announcement:o}=Y3(),a=hd("DndLiveRegion"),[l,u]=j.useState(!1);if(j.useEffect(()=>{u(!0)},[]),Z3(j.useMemo(()=>({onDragStart(f){let{active:p}=f;i(e.onDragStart({active:p}))},onDragMove(f){let{active:p,over:g}=f;e.onDragMove&&i(e.onDragMove({active:p,over:g}))},onDragOver(f){let{active:p,over:g}=f;i(e.onDragOver({active:p,over:g}))},onDragEnd(f){let{active:p,over:g}=f;i(e.onDragEnd({active:p,over:g}))},onDragCancel(f){let{active:p,over:g}=f;i(e.onDragCancel({active:p,over:g}))}}),[i,e])),!l)return null;const d=gt.createElement(gt.Fragment,null,gt.createElement(Q3,{id:s,value:r.draggable}),gt.createElement(X3,{id:a,announcement:o}));return t?Ul.createPortal(d,t):d}var Ln;(function(n){n.DragStart="dragStart",n.DragMove="dragMove",n.DragEnd="dragEnd",n.DragCancel="dragCancel",n.DragOver="dragOver",n.RegisterDroppable="registerDroppable",n.SetDroppableDisabled="setDroppableDisabled",n.UnregisterDroppable="unregisterDroppable"})(Ln||(Ln={}));function Op(){}function sc(n,e){return j.useMemo(()=>({sensor:n,options:e??{}}),[n,e])}function ib(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];return j.useMemo(()=>[...e].filter(s=>s!=null),[...e])}const ti=Object.freeze({x:0,y:0});function CT(n,e){return Math.sqrt(Math.pow(n.x-e.x,2)+Math.pow(n.y-e.y,2))}function sF(n,e){const t=Fp(n);if(!t)return"0 0";const s={x:(t.x-e.left)/e.width*100,y:(t.y-e.top)/e.height*100};return s.x+"% "+s.y+"%"}function ST(n,e){let{data:{value:t}}=n,{data:{value:s}}=e;return t-s}function rF(n,e){let{data:{value:t}}=n,{data:{value:s}}=e;return s-t}function Q2(n){let{left:e,top:t,height:s,width:r}=n;return[{x:e,y:t},{x:e+r,y:t},{x:e,y:t+s},{x:e+r,y:t+s}]}function NT(n,e){if(!n||n.length===0)return null;const[t]=n;return t[e]}function X2(n,e,t){return e===void 0&&(e=n.left),t===void 0&&(t=n.top),{x:e+n.width*.5,y:t+n.height*.5}}const ob=n=>{let{collisionRect:e,droppableRects:t,droppableContainers:s}=n;const r=X2(e,e.left,e.top),i=[];for(const o of s){const{id:a}=o,l=t.get(a);if(l){const u=CT(X2(l),r);i.push({id:a,data:{droppableContainer:o,value:u}})}}return i.sort(ST)},iF=n=>{let{collisionRect:e,droppableRects:t,droppableContainers:s}=n;const r=Q2(e),i=[];for(const o of s){const{id:a}=o,l=t.get(a);if(l){const u=Q2(l),d=r.reduce((p,g,x)=>p+CT(u[x],g),0),f=Number((d/4).toFixed(4));i.push({id:a,data:{droppableContainer:o,value:f}})}}return i.sort(ST)};function oF(n,e){const t=Math.max(e.top,n.top),s=Math.max(e.left,n.left),r=Math.min(e.left+e.width,n.left+n.width),i=Math.min(e.top+e.height,n.top+n.height),o=r-s,a=i-t;if(s<r&&t<i){const l=e.width*e.height,u=n.width*n.height,d=o*a,f=d/(l+u-d);return Number(f.toFixed(4))}return 0}const aF=n=>{let{collisionRect:e,droppableRects:t,droppableContainers:s}=n;const r=[];for(const i of s){const{id:o}=i,a=t.get(o);if(a){const l=oF(a,e);l>0&&r.push({id:o,data:{droppableContainer:i,value:l}})}}return r.sort(rF)};function lF(n,e,t){return{...n,scaleX:e&&t?e.width/t.width:1,scaleY:e&&t?e.height/t.height:1}}function IT(n,e){return n&&e?{x:n.left-e.left,y:n.top-e.top}:ti}function cF(n){return function(t){for(var s=arguments.length,r=new Array(s>1?s-1:0),i=1;i<s;i++)r[i-1]=arguments[i];return r.reduce((o,a)=>({...o,top:o.top+n*a.y,bottom:o.bottom+n*a.y,left:o.left+n*a.x,right:o.right+n*a.x}),{...t})}}const uF=cF(1);function TT(n){if(n.startsWith("matrix3d(")){const e=n.slice(9,-1).split(/, /);return{x:+e[12],y:+e[13],scaleX:+e[0],scaleY:+e[5]}}else if(n.startsWith("matrix(")){const e=n.slice(7,-1).split(/, /);return{x:+e[4],y:+e[5],scaleX:+e[0],scaleY:+e[3]}}return null}function dF(n,e,t){const s=TT(e);if(!s)return n;const{scaleX:r,scaleY:i,x:o,y:a}=s,l=n.left-o-(1-r)*parseFloat(t),u=n.top-a-(1-i)*parseFloat(t.slice(t.indexOf(" ")+1)),d=r?n.width/r:n.width,f=i?n.height/i:n.height;return{width:d,height:f,top:u,right:l+d,bottom:u+f,left:l}}const hF={ignoreTransform:!1};function kc(n,e){e===void 0&&(e=hF);let t=n.getBoundingClientRect();if(e.ignoreTransform){const{transform:u,transformOrigin:d}=Ms(n).getComputedStyle(n);u&&(t=dF(t,u,d))}const{top:s,left:r,width:i,height:o,bottom:a,right:l}=t;return{top:s,left:r,width:i,height:o,bottom:a,right:l}}function Y2(n){return kc(n,{ignoreTransform:!0})}function fF(n){const e=n.innerWidth,t=n.innerHeight;return{top:0,left:0,right:e,bottom:t,width:e,height:t}}function pF(n,e){return e===void 0&&(e=Ms(n).getComputedStyle(n)),e.position==="fixed"}function mF(n,e){e===void 0&&(e=Ms(n).getComputedStyle(n));const t=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(r=>{const i=e[r];return typeof i=="string"?t.test(i):!1})}function Em(n,e){const t=[];function s(r){if(e!=null&&t.length>=e||!r)return t;if(rb(r)&&r.scrollingElement!=null&&!t.includes(r.scrollingElement))return t.push(r.scrollingElement),t;if(!ud(r)||bT(r)||t.includes(r))return t;const i=Ms(n).getComputedStyle(r);return r!==n&&mF(r,i)&&t.push(r),pF(r,i)?t:s(r.parentNode)}return n?s(n):t}function $T(n){const[e]=Em(n,1);return e??null}function o0(n){return!Im||!n?null:bc(n)?n:sb(n)?rb(n)||n===wc(n).scrollingElement?window:ud(n)?n:null:null}function ET(n){return bc(n)?n.scrollX:n.scrollLeft}function AT(n){return bc(n)?n.scrollY:n.scrollTop}function Y0(n){return{x:ET(n),y:AT(n)}}var Hn;(function(n){n[n.Forward=1]="Forward",n[n.Backward=-1]="Backward"})(Hn||(Hn={}));function jT(n){return!Im||!n?!1:n===document.scrollingElement}function RT(n){const e={x:0,y:0},t=jT(n)?{height:window.innerHeight,width:window.innerWidth}:{height:n.clientHeight,width:n.clientWidth},s={x:n.scrollWidth-t.width,y:n.scrollHeight-t.height},r=n.scrollTop<=e.y,i=n.scrollLeft<=e.x,o=n.scrollTop>=s.y,a=n.scrollLeft>=s.x;return{isTop:r,isLeft:i,isBottom:o,isRight:a,maxScroll:s,minScroll:e}}const gF={x:.2,y:.2};function xF(n,e,t,s,r){let{top:i,left:o,right:a,bottom:l}=t;s===void 0&&(s=10),r===void 0&&(r=gF);const{isTop:u,isBottom:d,isLeft:f,isRight:p}=RT(n),g={x:0,y:0},x={x:0,y:0},y={height:e.height*r.y,width:e.width*r.x};return!u&&i<=e.top+y.height?(g.y=Hn.Backward,x.y=s*Math.abs((e.top+y.height-i)/y.height)):!d&&l>=e.bottom-y.height&&(g.y=Hn.Forward,x.y=s*Math.abs((e.bottom-y.height-l)/y.height)),!p&&a>=e.right-y.width?(g.x=Hn.Forward,x.x=s*Math.abs((e.right-y.width-a)/y.width)):!f&&o<=e.left+y.width&&(g.x=Hn.Backward,x.x=s*Math.abs((e.left+y.width-o)/y.width)),{direction:g,speed:x}}function yF(n){if(n===document.scrollingElement){const{innerWidth:i,innerHeight:o}=window;return{top:0,left:0,right:i,bottom:o,width:i,height:o}}const{top:e,left:t,right:s,bottom:r}=n.getBoundingClientRect();return{top:e,left:t,right:s,bottom:r,width:n.clientWidth,height:n.clientHeight}}function DT(n){return n.reduce((e,t)=>Hl(e,Y0(t)),ti)}function vF(n){return n.reduce((e,t)=>e+ET(t),0)}function bF(n){return n.reduce((e,t)=>e+AT(t),0)}function PT(n,e){if(e===void 0&&(e=kc),!n)return;const{top:t,left:s,bottom:r,right:i}=e(n);$T(n)&&(r<=0||i<=0||t>=window.innerHeight||s>=window.innerWidth)&&n.scrollIntoView({block:"center",inline:"center"})}const wF=[["x",["left","right"],vF],["y",["top","bottom"],bF]];class ab{constructor(e,t){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const s=Em(t),r=DT(s);this.rect={...e},this.width=e.width,this.height=e.height;for(const[i,o,a]of wF)for(const l of o)Object.defineProperty(this,l,{get:()=>{const u=a(s),d=r[i]-u;return this.rect[l]+d},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class Bu{constructor(e){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(t=>{var s;return(s=this.target)==null?void 0:s.removeEventListener(...t)})},this.target=e}add(e,t,s){var r;(r=this.target)==null||r.addEventListener(e,t,s),this.listeners.push([e,t,s])}}function kF(n){const{EventTarget:e}=Ms(n);return n instanceof e?n:wc(n)}function a0(n,e){const t=Math.abs(n.x),s=Math.abs(n.y);return typeof e=="number"?Math.sqrt(t**2+s**2)>e:"x"in e&&"y"in e?t>e.x&&s>e.y:"x"in e?t>e.x:"y"in e?s>e.y:!1}var kr;(function(n){n.Click="click",n.DragStart="dragstart",n.Keydown="keydown",n.ContextMenu="contextmenu",n.Resize="resize",n.SelectionChange="selectionchange",n.VisibilityChange="visibilitychange"})(kr||(kr={}));function Z2(n){n.preventDefault()}function CF(n){n.stopPropagation()}var vt;(function(n){n.Space="Space",n.Down="ArrowDown",n.Right="ArrowRight",n.Left="ArrowLeft",n.Up="ArrowUp",n.Esc="Escape",n.Enter="Enter",n.Tab="Tab"})(vt||(vt={}));const MT={start:[vt.Space,vt.Enter],cancel:[vt.Esc],end:[vt.Space,vt.Enter,vt.Tab]},SF=(n,e)=>{let{currentCoordinates:t}=e;switch(n.code){case vt.Right:return{...t,x:t.x+25};case vt.Left:return{...t,x:t.x-25};case vt.Down:return{...t,y:t.y+25};case vt.Up:return{...t,y:t.y-25}}};class fd{constructor(e){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=e;const{event:{target:t}}=e;this.props=e,this.listeners=new Bu(wc(t)),this.windowListeners=new Bu(Ms(t)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(kr.Resize,this.handleCancel),this.windowListeners.add(kr.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(kr.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:e,onStart:t}=this.props,s=e.node.current;s&&PT(s),t(ti)}handleKeyDown(e){if($m(e)){const{active:t,context:s,options:r}=this.props,{keyboardCodes:i=MT,coordinateGetter:o=SF,scrollBehavior:a="smooth"}=r,{code:l}=e;if(i.end.includes(l)){this.handleEnd(e);return}if(i.cancel.includes(l)){this.handleCancel(e);return}const{collisionRect:u}=s.current,d=u?{x:u.left,y:u.top}:ti;this.referenceCoordinates||(this.referenceCoordinates=d);const f=o(e,{active:t,context:s.current,currentCoordinates:d});if(f){const p=Ku(f,d),g={x:0,y:0},{scrollableAncestors:x}=s.current;for(const y of x){const b=e.code,{isTop:k,isRight:w,isLeft:N,isBottom:C,maxScroll:S,minScroll:T}=RT(y),A=yF(y),E={x:Math.min(b===vt.Right?A.right-A.width/2:A.right,Math.max(b===vt.Right?A.left:A.left+A.width/2,f.x)),y:Math.min(b===vt.Down?A.bottom-A.height/2:A.bottom,Math.max(b===vt.Down?A.top:A.top+A.height/2,f.y))},M=b===vt.Right&&!w||b===vt.Left&&!N,P=b===vt.Down&&!C||b===vt.Up&&!k;if(M&&E.x!==f.x){const R=y.scrollLeft+p.x,L=b===vt.Right&&R<=S.x||b===vt.Left&&R>=T.x;if(L&&!p.y){y.scrollTo({left:R,behavior:a});return}L?g.x=y.scrollLeft-R:g.x=b===vt.Right?y.scrollLeft-S.x:y.scrollLeft-T.x,g.x&&y.scrollBy({left:-g.x,behavior:a});break}else if(P&&E.y!==f.y){const R=y.scrollTop+p.y,L=b===vt.Down&&R<=S.y||b===vt.Up&&R>=T.y;if(L&&!p.x){y.scrollTo({top:R,behavior:a});return}L?g.y=y.scrollTop-R:g.y=b===vt.Down?y.scrollTop-S.y:y.scrollTop-T.y,g.y&&y.scrollBy({top:-g.y,behavior:a});break}}this.handleMove(e,Hl(Ku(f,this.referenceCoordinates),g))}}}handleMove(e,t){const{onMove:s}=this.props;e.preventDefault(),s(t)}handleEnd(e){const{onEnd:t}=this.props;e.preventDefault(),this.detach(),t()}handleCancel(e){const{onCancel:t}=this.props;e.preventDefault(),this.detach(),t()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}fd.activators=[{eventName:"onKeyDown",handler:(n,e,t)=>{let{keyboardCodes:s=MT,onActivation:r}=e,{active:i}=t;const{code:o}=n.nativeEvent;if(s.start.includes(o)){const a=i.activatorNode.current;return a&&n.target!==a?!1:(n.preventDefault(),r==null||r({event:n.nativeEvent}),!0)}return!1}}];function J2(n){return!!(n&&"distance"in n)}function eS(n){return!!(n&&"delay"in n)}class lb{constructor(e,t,s){var r;s===void 0&&(s=kF(e.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=e,this.events=t;const{event:i}=e,{target:o}=i;this.props=e,this.events=t,this.document=wc(o),this.documentListeners=new Bu(this.document),this.listeners=new Bu(s),this.windowListeners=new Bu(Ms(o)),this.initialCoordinates=(r=Fp(i))!=null?r:ti,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:e,props:{options:{activationConstraint:t,bypassActivationConstraint:s}}}=this;if(this.listeners.add(e.move.name,this.handleMove,{passive:!1}),this.listeners.add(e.end.name,this.handleEnd),e.cancel&&this.listeners.add(e.cancel.name,this.handleCancel),this.windowListeners.add(kr.Resize,this.handleCancel),this.windowListeners.add(kr.DragStart,Z2),this.windowListeners.add(kr.VisibilityChange,this.handleCancel),this.windowListeners.add(kr.ContextMenu,Z2),this.documentListeners.add(kr.Keydown,this.handleKeydown),t){if(s!=null&&s({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(eS(t)){this.timeoutId=setTimeout(this.handleStart,t.delay),this.handlePending(t);return}if(J2(t)){this.handlePending(t);return}}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),this.timeoutId!==null&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(e,t){const{active:s,onPending:r}=this.props;r(s,e,this.initialCoordinates,t)}handleStart(){const{initialCoordinates:e}=this,{onStart:t}=this.props;e&&(this.activated=!0,this.documentListeners.add(kr.Click,CF,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(kr.SelectionChange,this.removeTextSelection),t(e))}handleMove(e){var t;const{activated:s,initialCoordinates:r,props:i}=this,{onMove:o,options:{activationConstraint:a}}=i;if(!r)return;const l=(t=Fp(e))!=null?t:ti,u=Ku(r,l);if(!s&&a){if(J2(a)){if(a.tolerance!=null&&a0(u,a.tolerance))return this.handleCancel();if(a0(u,a.distance))return this.handleStart()}if(eS(a)&&a0(u,a.tolerance))return this.handleCancel();this.handlePending(a,u);return}e.cancelable&&e.preventDefault(),o(l)}handleEnd(){const{onAbort:e,onEnd:t}=this.props;this.detach(),this.activated||e(this.props.active),t()}handleCancel(){const{onAbort:e,onCancel:t}=this.props;this.detach(),this.activated||e(this.props.active),t()}handleKeydown(e){e.code===vt.Esc&&this.handleCancel()}removeTextSelection(){var e;(e=this.document.getSelection())==null||e.removeAllRanges()}}const NF={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class pd extends lb{constructor(e){const{event:t}=e,s=wc(t.target);super(e,NF,s)}}pd.activators=[{eventName:"onPointerDown",handler:(n,e)=>{let{nativeEvent:t}=n,{onActivation:s}=e;return!t.isPrimary||t.button!==0?!1:(s==null||s({event:t}),!0)}}];const IF={move:{name:"mousemove"},end:{name:"mouseup"}};var Z0;(function(n){n[n.RightClick=2]="RightClick"})(Z0||(Z0={}));class TF extends lb{constructor(e){super(e,IF,wc(e.event.target))}}TF.activators=[{eventName:"onMouseDown",handler:(n,e)=>{let{nativeEvent:t}=n,{onActivation:s}=e;return t.button===Z0.RightClick?!1:(s==null||s({event:t}),!0)}}];const l0={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};class $F extends lb{constructor(e){super(e,l0)}static setup(){return window.addEventListener(l0.move.name,e,{capture:!1,passive:!1}),function(){window.removeEventListener(l0.move.name,e)};function e(){}}}$F.activators=[{eventName:"onTouchStart",handler:(n,e)=>{let{nativeEvent:t}=n,{onActivation:s}=e;const{touches:r}=t;return r.length>1?!1:(s==null||s({event:t}),!0)}}];var Wu;(function(n){n[n.Pointer=0]="Pointer",n[n.DraggableRect=1]="DraggableRect"})(Wu||(Wu={}));var _p;(function(n){n[n.TreeOrder=0]="TreeOrder",n[n.ReversedTreeOrder=1]="ReversedTreeOrder"})(_p||(_p={}));function EF(n){let{acceleration:e,activator:t=Wu.Pointer,canScroll:s,draggingRect:r,enabled:i,interval:o=5,order:a=_p.TreeOrder,pointerCoordinates:l,scrollableAncestors:u,scrollableAncestorRects:d,delta:f,threshold:p}=n;const g=jF({delta:f,disabled:!i}),[x,y]=U3(),b=j.useRef({x:0,y:0}),k=j.useRef({x:0,y:0}),w=j.useMemo(()=>{switch(t){case Wu.Pointer:return l?{top:l.y,bottom:l.y,left:l.x,right:l.x}:null;case Wu.DraggableRect:return r}},[t,r,l]),N=j.useRef(null),C=j.useCallback(()=>{const T=N.current;if(!T)return;const A=b.current.x*k.current.x,E=b.current.y*k.current.y;T.scrollBy(A,E)},[]),S=j.useMemo(()=>a===_p.TreeOrder?[...u].reverse():u,[a,u]);j.useEffect(()=>{if(!i||!u.length||!w){y();return}for(const T of S){if((s==null?void 0:s(T))===!1)continue;const A=u.indexOf(T),E=d[A];if(!E)continue;const{direction:M,speed:P}=xF(T,E,w,e,p);for(const R of["x","y"])g[R][M[R]]||(P[R]=0,M[R]=0);if(P.x>0||P.y>0){y(),N.current=T,x(C,o),b.current=P,k.current=M;return}}b.current={x:0,y:0},k.current={x:0,y:0},y()},[e,C,s,y,i,o,JSON.stringify(w),JSON.stringify(g),x,u,S,d,JSON.stringify(p)])}const AF={x:{[Hn.Backward]:!1,[Hn.Forward]:!1},y:{[Hn.Backward]:!1,[Hn.Forward]:!1}};function jF(n){let{delta:e,disabled:t}=n;const s=Lp(e);return dd(r=>{if(t||!s||!r)return AF;const i={x:Math.sign(e.x-s.x),y:Math.sign(e.y-s.y)};return{x:{[Hn.Backward]:r.x[Hn.Backward]||i.x===-1,[Hn.Forward]:r.x[Hn.Forward]||i.x===1},y:{[Hn.Backward]:r.y[Hn.Backward]||i.y===-1,[Hn.Forward]:r.y[Hn.Forward]||i.y===1}}},[t,e,s])}function RF(n,e){const t=e!=null?n.get(e):void 0,s=t?t.node.current:null;return dd(r=>{var i;return e==null?null:(i=s??r)!=null?i:null},[s,e])}function DF(n,e){return j.useMemo(()=>n.reduce((t,s)=>{const{sensor:r}=s,i=r.activators.map(o=>({eventName:o.eventName,handler:e(o.handler,s)}));return[...t,...i]},[]),[n,e])}var Qu;(function(n){n[n.Always=0]="Always",n[n.BeforeDragging=1]="BeforeDragging",n[n.WhileDragging=2]="WhileDragging"})(Qu||(Qu={}));var J0;(function(n){n.Optimized="optimized"})(J0||(J0={}));const tS=new Map;function PF(n,e){let{dragging:t,dependencies:s,config:r}=e;const[i,o]=j.useState(null),{frequency:a,measure:l,strategy:u}=r,d=j.useRef(n),f=b(),p=qu(f),g=j.useCallback(function(k){k===void 0&&(k=[]),!p.current&&o(w=>w===null?k:w.concat(k.filter(N=>!w.includes(N))))},[p]),x=j.useRef(null),y=dd(k=>{if(f&&!t)return tS;if(!k||k===tS||d.current!==n||i!=null){const w=new Map;for(let N of n){if(!N)continue;if(i&&i.length>0&&!i.includes(N.id)&&N.rect.current){w.set(N.id,N.rect.current);continue}const C=N.node.current,S=C?new ab(l(C),C):null;N.rect.current=S,S&&w.set(N.id,S)}return w}return k},[n,i,t,f,l]);return j.useEffect(()=>{d.current=n},[n]),j.useEffect(()=>{f||g()},[t,f]),j.useEffect(()=>{i&&i.length>0&&o(null)},[JSON.stringify(i)]),j.useEffect(()=>{f||typeof a!="number"||x.current!==null||(x.current=setTimeout(()=>{g(),x.current=null},a))},[a,f,g,...s]),{droppableRects:y,measureDroppableContainers:g,measuringScheduled:i!=null};function b(){switch(u){case Qu.Always:return!1;case Qu.BeforeDragging:return t;default:return!t}}}function cb(n,e){return dd(t=>n?t||(typeof e=="function"?e(n):n):null,[e,n])}function MF(n,e){return cb(n,e)}function LF(n){let{callback:e,disabled:t}=n;const s=Tm(e),r=j.useMemo(()=>{if(t||typeof window>"u"||typeof window.MutationObserver>"u")return;const{MutationObserver:i}=window;return new i(s)},[s,t]);return j.useEffect(()=>()=>r==null?void 0:r.disconnect(),[r]),r}function Am(n){let{callback:e,disabled:t}=n;const s=Tm(e),r=j.useMemo(()=>{if(t||typeof window>"u"||typeof window.ResizeObserver>"u")return;const{ResizeObserver:i}=window;return new i(s)},[t]);return j.useEffect(()=>()=>r==null?void 0:r.disconnect(),[r]),r}function FF(n){return new ab(kc(n),n)}function nS(n,e,t){e===void 0&&(e=FF);const[s,r]=j.useState(null);function i(){r(l=>{if(!n)return null;if(n.isConnected===!1){var u;return(u=l??t)!=null?u:null}const d=e(n);return JSON.stringify(l)===JSON.stringify(d)?l:d})}const o=LF({callback(l){if(n)for(const u of l){const{type:d,target:f}=u;if(d==="childList"&&f instanceof HTMLElement&&f.contains(n)){i();break}}}}),a=Am({callback:i});return Jr(()=>{i(),n?(a==null||a.observe(n),o==null||o.observe(document.body,{childList:!0,subtree:!0})):(a==null||a.disconnect(),o==null||o.disconnect())},[n]),s}function OF(n){const e=cb(n);return IT(n,e)}const sS=[];function _F(n){const e=j.useRef(n),t=dd(s=>n?s&&s!==sS&&n&&e.current&&n.parentNode===e.current.parentNode?s:Em(n):sS,[n]);return j.useEffect(()=>{e.current=n},[n]),t}function zF(n){const[e,t]=j.useState(null),s=j.useRef(n),r=j.useCallback(i=>{const o=o0(i.target);o&&t(a=>a?(a.set(o,Y0(o)),new Map(a)):null)},[]);return j.useEffect(()=>{const i=s.current;if(n!==i){o(i);const a=n.map(l=>{const u=o0(l);return u?(u.addEventListener("scroll",r,{passive:!0}),[u,Y0(u)]):null}).filter(l=>l!=null);t(a.length?new Map(a):null),s.current=n}return()=>{o(n),o(i)};function o(a){a.forEach(l=>{const u=o0(l);u==null||u.removeEventListener("scroll",r)})}},[r,n]),j.useMemo(()=>n.length?e?Array.from(e.values()).reduce((i,o)=>Hl(i,o),ti):DT(n):ti,[n,e])}function rS(n,e){e===void 0&&(e=[]);const t=j.useRef(null);return j.useEffect(()=>{t.current=null},e),j.useEffect(()=>{const s=n!==ti;s&&!t.current&&(t.current=n),!s&&t.current&&(t.current=null)},[n]),t.current?Ku(n,t.current):ti}function BF(n){j.useEffect(()=>{if(!Im)return;const e=n.map(t=>{let{sensor:s}=t;return s.setup==null?void 0:s.setup()});return()=>{for(const t of e)t==null||t()}},n.map(e=>{let{sensor:t}=e;return t}))}function WF(n,e){return j.useMemo(()=>n.reduce((t,s)=>{let{eventName:r,handler:i}=s;return t[r]=o=>{i(o,e)},t},{}),[n,e])}function LT(n){return j.useMemo(()=>n?fF(n):null,[n])}const iS=[];function VF(n,e){e===void 0&&(e=kc);const[t]=n,s=LT(t?Ms(t):null),[r,i]=j.useState(iS);function o(){i(()=>n.length?n.map(l=>jT(l)?s:new ab(e(l),l)):iS)}const a=Am({callback:o});return Jr(()=>{a==null||a.disconnect(),o(),n.forEach(l=>a==null?void 0:a.observe(l))},[n]),r}function FT(n){if(!n)return null;if(n.children.length>1)return n;const e=n.children[0];return ud(e)?e:n}function UF(n){let{measure:e}=n;const[t,s]=j.useState(null),r=j.useCallback(u=>{for(const{target:d}of u)if(ud(d)){s(f=>{const p=e(d);return f?{...f,width:p.width,height:p.height}:p});break}},[e]),i=Am({callback:r}),o=j.useCallback(u=>{const d=FT(u);i==null||i.disconnect(),d&&(i==null||i.observe(d)),s(d?e(d):null)},[e,i]),[a,l]=Mp(o);return j.useMemo(()=>({nodeRef:a,rect:t,setRef:l}),[t,a,l])}const GF=[{sensor:pd,options:{}},{sensor:fd,options:{}}],HF={current:{}},vp={draggable:{measure:Y2},droppable:{measure:Y2,strategy:Qu.WhileDragging,frequency:J0.Optimized},dragOverlay:{measure:kc}};class Vu extends Map{get(e){var t;return e!=null&&(t=super.get(e))!=null?t:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(e=>{let{disabled:t}=e;return!t})}getNodeFor(e){var t,s;return(t=(s=this.get(e))==null?void 0:s.node.current)!=null?t:void 0}}const qF={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new Vu,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:Op},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:vp,measureDroppableContainers:Op,windowRect:null,measuringScheduled:!1},OT={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:Op,draggableNodes:new Map,over:null,measureDroppableContainers:Op},md=j.createContext(OT),_T=j.createContext(qF);function KF(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new Vu}}}function QF(n,e){switch(e.type){case Ln.DragStart:return{...n,draggable:{...n.draggable,initialCoordinates:e.initialCoordinates,active:e.active}};case Ln.DragMove:return n.draggable.active==null?n:{...n,draggable:{...n.draggable,translate:{x:e.coordinates.x-n.draggable.initialCoordinates.x,y:e.coordinates.y-n.draggable.initialCoordinates.y}}};case Ln.DragEnd:case Ln.DragCancel:return{...n,draggable:{...n.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case Ln.RegisterDroppable:{const{element:t}=e,{id:s}=t,r=new Vu(n.droppable.containers);return r.set(s,t),{...n,droppable:{...n.droppable,containers:r}}}case Ln.SetDroppableDisabled:{const{id:t,key:s,disabled:r}=e,i=n.droppable.containers.get(t);if(!i||s!==i.key)return n;const o=new Vu(n.droppable.containers);return o.set(t,{...i,disabled:r}),{...n,droppable:{...n.droppable,containers:o}}}case Ln.UnregisterDroppable:{const{id:t,key:s}=e,r=n.droppable.containers.get(t);if(!r||s!==r.key)return n;const i=new Vu(n.droppable.containers);return i.delete(t),{...n,droppable:{...n.droppable,containers:i}}}default:return n}}function XF(n){let{disabled:e}=n;const{active:t,activatorEvent:s,draggableNodes:r}=j.useContext(md),i=Lp(s),o=Lp(t==null?void 0:t.id);return j.useEffect(()=>{if(!e&&!s&&i&&o!=null){if(!$m(i)||document.activeElement===i.target)return;const a=r.get(o);if(!a)return;const{activatorNode:l,node:u}=a;if(!l.current&&!u.current)return;requestAnimationFrame(()=>{for(const d of[l.current,u.current]){if(!d)continue;const f=q3(d);if(f){f.focus();break}}})}},[s,e,r,o,i]),null}function zT(n,e){let{transform:t,...s}=e;return n!=null&&n.length?n.reduce((r,i)=>i({transform:r,...s}),t):t}function YF(n){return j.useMemo(()=>({draggable:{...vp.draggable,...n==null?void 0:n.draggable},droppable:{...vp.droppable,...n==null?void 0:n.droppable},dragOverlay:{...vp.dragOverlay,...n==null?void 0:n.dragOverlay}}),[n==null?void 0:n.draggable,n==null?void 0:n.droppable,n==null?void 0:n.dragOverlay])}function ZF(n){let{activeNode:e,measure:t,initialRect:s,config:r=!0}=n;const i=j.useRef(!1),{x:o,y:a}=typeof r=="boolean"?{x:r,y:r}:r;Jr(()=>{if(!o&&!a||!e){i.current=!1;return}if(i.current||!s)return;const u=e==null?void 0:e.node.current;if(!u||u.isConnected===!1)return;const d=t(u),f=IT(d,s);if(o||(f.x=0),a||(f.y=0),i.current=!0,Math.abs(f.x)>0||Math.abs(f.y)>0){const p=$T(u);p&&p.scrollBy({top:f.y,left:f.x})}},[e,o,a,s,t])}const jm=j.createContext({...ti,scaleX:1,scaleY:1});var Ro;(function(n){n[n.Uninitialized=0]="Uninitialized",n[n.Initializing=1]="Initializing",n[n.Initialized=2]="Initialized"})(Ro||(Ro={}));const ub=j.memo(function(e){var t,s,r,i;let{id:o,accessibility:a,autoScroll:l=!0,children:u,sensors:d=GF,collisionDetection:f=aF,measuring:p,modifiers:g,...x}=e;const y=j.useReducer(QF,void 0,KF),[b,k]=y,[w,N]=J3(),[C,S]=j.useState(Ro.Uninitialized),T=C===Ro.Initialized,{draggable:{active:A,nodes:E,translate:M},droppable:{containers:P}}=b,R=A!=null?E.get(A):null,L=j.useRef({initial:null,translated:null}),_=j.useMemo(()=>{var nn;return A!=null?{id:A,data:(nn=R==null?void 0:R.data)!=null?nn:HF,rect:L}:null},[A,R]),O=j.useRef(null),[U,W]=j.useState(null),[H,G]=j.useState(null),q=qu(x,Object.values(x)),Q=hd("DndDescribedBy",o),z=j.useMemo(()=>P.getEnabled(),[P]),K=YF(p),{droppableRects:Y,measureDroppableContainers:B,measuringScheduled:J}=PF(z,{dragging:T,dependencies:[M.x,M.y],config:K.droppable}),ae=RF(E,A),pe=j.useMemo(()=>H?Fp(H):null,[H]),ge=ho(),he=MF(ae,K.draggable.measure);ZF({activeNode:A!=null?E.get(A):null,config:ge.layoutShiftCompensation,initialRect:he,measure:K.draggable.measure});const we=nS(ae,K.draggable.measure,he),Pe=nS(ae?ae.parentElement:null),ue=j.useRef({activatorEvent:null,active:null,activeNode:ae,collisionRect:null,collisions:null,droppableRects:Y,draggableNodes:E,draggingNode:null,draggingNodeRect:null,droppableContainers:P,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),Te=P.getNodeFor((t=ue.current.over)==null?void 0:t.id),ke=UF({measure:K.dragOverlay.measure}),ye=(s=ke.nodeRef.current)!=null?s:ae,Ce=T?(r=ke.rect)!=null?r:we:null,Ae=!!(ke.nodeRef.current&&ke.rect),Be=OF(Ae?null:we),mt=LT(ye?Ms(ye):null),le=_F(T?Te??ae:null),je=VF(le),De=zT(g,{transform:{x:M.x-Be.x,y:M.y-Be.y,scaleX:1,scaleY:1},activatorEvent:H,active:_,activeNodeRect:we,containerNodeRect:Pe,draggingNodeRect:Ce,over:ue.current.over,overlayNodeRect:ke.rect,scrollableAncestors:le,scrollableAncestorRects:je,windowRect:mt}),_e=pe?Hl(pe,M):null,it=zF(le),St=rS(it),cn=rS(it,[we]),Ut=Hl(De,St),ut=Ce?uF(Ce,De):null,yn=_&&ut?f({active:_,collisionRect:ut,droppableRects:Y,droppableContainers:z,pointerCoordinates:_e}):null,Zn=NT(yn,"id"),[Yt,Dr]=j.useState(null),ur=Ae?De:Hl(De,cn),Di=lF(ur,(i=Yt==null?void 0:Yt.rect)!=null?i:null,we),Xe=j.useRef(null),yt=j.useCallback((nn,as)=>{let{sensor:ls,options:Pr}=as;if(O.current==null)return;const Ss=E.get(O.current);if(!Ss)return;const cs=nn.nativeEvent,Os=new ls({active:O.current,activeNode:Ss,event:cs,options:Pr,context:ue,onAbort(sn){if(!E.get(sn))return;const{onDragAbort:us}=q.current,Mr={id:sn};us==null||us(Mr),w({type:"onDragAbort",event:Mr})},onPending(sn,dr,us,Mr){if(!E.get(sn))return;const{onDragPending:ai}=q.current,Ys={id:sn,constraint:dr,initialCoordinates:us,offset:Mr};ai==null||ai(Ys),w({type:"onDragPending",event:Ys})},onStart(sn){const dr=O.current;if(dr==null)return;const us=E.get(dr);if(!us)return;const{onDragStart:Mr}=q.current,Lr={activatorEvent:cs,active:{id:dr,data:us.data,rect:L}};Ul.unstable_batchedUpdates(()=>{Mr==null||Mr(Lr),S(Ro.Initializing),k({type:Ln.DragStart,initialCoordinates:sn,active:dr}),w({type:"onDragStart",event:Lr}),W(Xe.current),G(cs)})},onMove(sn){k({type:Ln.DragMove,coordinates:sn})},onEnd:Pi(Ln.DragEnd),onCancel:Pi(Ln.DragCancel)});Xe.current=Os;function Pi(sn){return async function(){const{active:us,collisions:Mr,over:Lr,scrollAdjustedTranslate:ai}=ue.current;let Ys=null;if(us&&ai){const{cancelDrop:Mi}=q.current;Ys={activatorEvent:cs,active:us,collisions:Mr,delta:ai,over:Lr},sn===Ln.DragEnd&&typeof Mi=="function"&&await Promise.resolve(Mi(Ys))&&(sn=Ln.DragCancel)}O.current=null,Ul.unstable_batchedUpdates(()=>{k({type:sn}),S(Ro.Uninitialized),Dr(null),W(null),G(null),Xe.current=null;const Mi=sn===Ln.DragEnd?"onDragEnd":"onDragCancel";if(Ys){const Gc=q.current[Mi];Gc==null||Gc(Ys),w({type:Mi,event:Ys})}})}}},[E]),Gt=j.useCallback((nn,as)=>(ls,Pr)=>{const Ss=ls.nativeEvent,cs=E.get(Pr);if(O.current!==null||!cs||Ss.dndKit||Ss.defaultPrevented)return;const Os={active:cs};nn(ls,as.options,Os)===!0&&(Ss.dndKit={capturedBy:as.sensor},O.current=Pr,yt(ls,as))},[E,yt]),Cs=DF(d,Gt);BF(d),Jr(()=>{we&&C===Ro.Initializing&&S(Ro.Initialized)},[we,C]),j.useEffect(()=>{const{onDragMove:nn}=q.current,{active:as,activatorEvent:ls,collisions:Pr,over:Ss}=ue.current;if(!as||!ls)return;const cs={active:as,activatorEvent:ls,collisions:Pr,delta:{x:Ut.x,y:Ut.y},over:Ss};Ul.unstable_batchedUpdates(()=>{nn==null||nn(cs),w({type:"onDragMove",event:cs})})},[Ut.x,Ut.y]),j.useEffect(()=>{const{active:nn,activatorEvent:as,collisions:ls,droppableContainers:Pr,scrollAdjustedTranslate:Ss}=ue.current;if(!nn||O.current==null||!as||!Ss)return;const{onDragOver:cs}=q.current,Os=Pr.get(Zn),Pi=Os&&Os.rect.current?{id:Os.id,rect:Os.rect.current,data:Os.data,disabled:Os.disabled}:null,sn={active:nn,activatorEvent:as,collisions:ls,delta:{x:Ss.x,y:Ss.y},over:Pi};Ul.unstable_batchedUpdates(()=>{Dr(Pi),cs==null||cs(sn),w({type:"onDragOver",event:sn})})},[Zn]),Jr(()=>{ue.current={activatorEvent:H,active:_,activeNode:ae,collisionRect:ut,collisions:yn,droppableRects:Y,draggableNodes:E,draggingNode:ye,draggingNodeRect:Ce,droppableContainers:P,over:Yt,scrollableAncestors:le,scrollAdjustedTranslate:Ut},L.current={initial:Ce,translated:ut}},[_,ae,yn,ut,E,ye,Ce,Y,P,Yt,le,Ut]),EF({...ge,delta:M,draggingRect:ut,pointerCoordinates:_e,scrollableAncestors:le,scrollableAncestorRects:je});const Vc=j.useMemo(()=>({active:_,activeNode:ae,activeNodeRect:we,activatorEvent:H,collisions:yn,containerNodeRect:Pe,dragOverlay:ke,draggableNodes:E,droppableContainers:P,droppableRects:Y,over:Yt,measureDroppableContainers:B,scrollableAncestors:le,scrollableAncestorRects:je,measuringConfiguration:K,measuringScheduled:J,windowRect:mt}),[_,ae,we,H,yn,Pe,ke,E,P,Y,Yt,B,le,je,K,J,mt]),Uc=j.useMemo(()=>({activatorEvent:H,activators:Cs,active:_,activeNodeRect:we,ariaDescribedById:{draggable:Q},dispatch:k,draggableNodes:E,over:Yt,measureDroppableContainers:B}),[H,Cs,_,we,k,Q,E,Yt,B]);return gt.createElement(kT.Provider,{value:N},gt.createElement(md.Provider,{value:Uc},gt.createElement(_T.Provider,{value:Vc},gt.createElement(jm.Provider,{value:Di},u)),gt.createElement(XF,{disabled:(a==null?void 0:a.restoreFocus)===!1})),gt.createElement(nF,{...a,hiddenTextDescribedById:Q}));function ho(){const nn=(U==null?void 0:U.autoScrollEnabled)===!1,as=typeof l=="object"?l.enabled===!1:l===!1,ls=T&&!nn&&!as;return typeof l=="object"?{...l,enabled:ls}:{enabled:ls}}}),JF=j.createContext(null),oS="button",e4="Draggable";function t4(n){let{id:e,data:t,disabled:s=!1,attributes:r}=n;const i=hd(e4),{activators:o,activatorEvent:a,active:l,activeNodeRect:u,ariaDescribedById:d,draggableNodes:f,over:p}=j.useContext(md),{role:g=oS,roleDescription:x="draggable",tabIndex:y=0}=r??{},b=(l==null?void 0:l.id)===e,k=j.useContext(b?jm:JF),[w,N]=Mp(),[C,S]=Mp(),T=WF(o,e),A=qu(t);Jr(()=>(f.set(e,{id:e,key:i,node:w,activatorNode:C,data:A}),()=>{const M=f.get(e);M&&M.key===i&&f.delete(e)}),[f,e]);const E=j.useMemo(()=>({role:g,tabIndex:y,"aria-disabled":s,"aria-pressed":b&&g===oS?!0:void 0,"aria-roledescription":x,"aria-describedby":d.draggable}),[s,g,y,b,x,d.draggable]);return{active:l,activatorEvent:a,activeNodeRect:u,attributes:E,isDragging:b,listeners:s?void 0:T,node:w,over:p,setNodeRef:N,setActivatorNodeRef:S,transform:k}}function BT(){return j.useContext(_T)}const n4="Droppable",s4={timeout:25};function r4(n){let{data:e,disabled:t=!1,id:s,resizeObserverConfig:r}=n;const i=hd(n4),{active:o,dispatch:a,over:l,measureDroppableContainers:u}=j.useContext(md),d=j.useRef({disabled:t}),f=j.useRef(!1),p=j.useRef(null),g=j.useRef(null),{disabled:x,updateMeasurementsFor:y,timeout:b}={...s4,...r},k=qu(y??s),w=j.useCallback(()=>{if(!f.current){f.current=!0;return}g.current!=null&&clearTimeout(g.current),g.current=setTimeout(()=>{u(Array.isArray(k.current)?k.current:[k.current]),g.current=null},b)},[b]),N=Am({callback:w,disabled:x||!o}),C=j.useCallback((E,M)=>{N&&(M&&(N.unobserve(M),f.current=!1),E&&N.observe(E))},[N]),[S,T]=Mp(C),A=qu(e);return j.useEffect(()=>{!N||!S.current||(N.disconnect(),f.current=!1,N.observe(S.current))},[S,N]),j.useEffect(()=>(a({type:Ln.RegisterDroppable,element:{id:s,key:i,disabled:t,node:S,rect:p,data:A}}),()=>a({type:Ln.UnregisterDroppable,key:i,id:s})),[s]),j.useEffect(()=>{t!==d.current.disabled&&(a({type:Ln.SetDroppableDisabled,id:s,key:i,disabled:t}),d.current.disabled=t)},[s,i,t,a]),{active:o,rect:p,isOver:(l==null?void 0:l.id)===s,node:S,over:l,setNodeRef:T}}function i4(n){let{animation:e,children:t}=n;const[s,r]=j.useState(null),[i,o]=j.useState(null),a=Lp(t);return!t&&!s&&a&&r(a),Jr(()=>{if(!i)return;const l=s==null?void 0:s.key,u=s==null?void 0:s.props.id;if(l==null||u==null){r(null);return}Promise.resolve(e(u,i)).then(()=>{r(null)})},[e,s,i]),gt.createElement(gt.Fragment,null,t,s?j.cloneElement(s,{ref:o}):null)}const o4={x:0,y:0,scaleX:1,scaleY:1};function a4(n){let{children:e}=n;return gt.createElement(md.Provider,{value:OT},gt.createElement(jm.Provider,{value:o4},e))}const l4={position:"fixed",touchAction:"none"},c4=n=>$m(n)?"transform 250ms ease":void 0,u4=j.forwardRef((n,e)=>{let{as:t,activatorEvent:s,adjustScale:r,children:i,className:o,rect:a,style:l,transform:u,transition:d=c4}=n;if(!a)return null;const f=r?u:{...u,scaleX:1,scaleY:1},p={...l4,width:a.width,height:a.height,top:a.top,left:a.left,transform:ei.Transform.toString(f),transformOrigin:r&&s?sF(s,a):void 0,transition:typeof d=="function"?d(s):d,...l};return gt.createElement(t,{className:o,style:p,ref:e},i)}),d4=n=>e=>{let{active:t,dragOverlay:s}=e;const r={},{styles:i,className:o}=n;if(i!=null&&i.active)for(const[a,l]of Object.entries(i.active))l!==void 0&&(r[a]=t.node.style.getPropertyValue(a),t.node.style.setProperty(a,l));if(i!=null&&i.dragOverlay)for(const[a,l]of Object.entries(i.dragOverlay))l!==void 0&&s.node.style.setProperty(a,l);return o!=null&&o.active&&t.node.classList.add(o.active),o!=null&&o.dragOverlay&&s.node.classList.add(o.dragOverlay),function(){for(const[l,u]of Object.entries(r))t.node.style.setProperty(l,u);o!=null&&o.active&&t.node.classList.remove(o.active)}},h4=n=>{let{transform:{initial:e,final:t}}=n;return[{transform:ei.Transform.toString(e)},{transform:ei.Transform.toString(t)}]},f4={duration:250,easing:"ease",keyframes:h4,sideEffects:d4({styles:{active:{opacity:"0"}}})};function p4(n){let{config:e,draggableNodes:t,droppableContainers:s,measuringConfiguration:r}=n;return Tm((i,o)=>{if(e===null)return;const a=t.get(i);if(!a)return;const l=a.node.current;if(!l)return;const u=FT(o);if(!u)return;const{transform:d}=Ms(o).getComputedStyle(o),f=TT(d);if(!f)return;const p=typeof e=="function"?e:m4(e);return PT(l,r.draggable.measure),p({active:{id:i,data:a.data,node:l,rect:r.draggable.measure(l)},draggableNodes:t,dragOverlay:{node:o,rect:r.dragOverlay.measure(u)},droppableContainers:s,measuringConfiguration:r,transform:f})})}function m4(n){const{duration:e,easing:t,sideEffects:s,keyframes:r}={...f4,...n};return i=>{let{active:o,dragOverlay:a,transform:l,...u}=i;if(!e)return;const d={x:a.rect.left-o.rect.left,y:a.rect.top-o.rect.top},f={scaleX:l.scaleX!==1?o.rect.width*l.scaleX/a.rect.width:1,scaleY:l.scaleY!==1?o.rect.height*l.scaleY/a.rect.height:1},p={x:l.x-d.x,y:l.y-d.y,...f},g=r({...u,active:o,dragOverlay:a,transform:{initial:l,final:p}}),[x]=g,y=g[g.length-1];if(JSON.stringify(x)===JSON.stringify(y))return;const b=s==null?void 0:s({active:o,dragOverlay:a,...u}),k=a.node.animate(g,{duration:e,easing:t,fill:"forwards"});return new Promise(w=>{k.onfinish=()=>{b==null||b(),w()}})}}let aS=0;function g4(n){return j.useMemo(()=>{if(n!=null)return aS++,aS},[n])}const x4=gt.memo(n=>{let{adjustScale:e=!1,children:t,dropAnimation:s,style:r,transition:i,modifiers:o,wrapperElement:a="div",className:l,zIndex:u=999}=n;const{activatorEvent:d,active:f,activeNodeRect:p,containerNodeRect:g,draggableNodes:x,droppableContainers:y,dragOverlay:b,over:k,measuringConfiguration:w,scrollableAncestors:N,scrollableAncestorRects:C,windowRect:S}=BT(),T=j.useContext(jm),A=g4(f==null?void 0:f.id),E=zT(o,{activatorEvent:d,active:f,activeNodeRect:p,containerNodeRect:g,draggingNodeRect:b.rect,over:k,overlayNodeRect:b.rect,scrollableAncestors:N,scrollableAncestorRects:C,transform:T,windowRect:S}),M=cb(p),P=p4({config:s,draggableNodes:x,droppableContainers:y,measuringConfiguration:w}),R=M?b.setRef:void 0;return gt.createElement(a4,null,gt.createElement(i4,{animation:P},f&&A?gt.createElement(u4,{key:A,id:f.id,ref:R,as:a,activatorEvent:d,adjustScale:e,className:l,transition:i,rect:M,style:{zIndex:u,...r},transform:E},t):null))});function db(n,e,t){const s=n.slice();return s.splice(t<0?s.length+t:t,0,s.splice(e,1)[0]),s}function y4(n,e){return n.reduce((t,s,r)=>{const i=e.get(s);return i&&(t[r]=i),t},Array(n.length))}function qf(n){return n!==null&&n>=0}function v4(n,e){if(n===e)return!0;if(n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function b4(n){return typeof n=="boolean"?{draggable:n,droppable:n}:n}const WT=n=>{let{rects:e,activeIndex:t,overIndex:s,index:r}=n;const i=db(e,s,t),o=e[r],a=i[r];return!a||!o?null:{x:a.left-o.left,y:a.top-o.top,scaleX:a.width/o.width,scaleY:a.height/o.height}},Kf={scaleX:1,scaleY:1},hb=n=>{var e;let{activeIndex:t,activeNodeRect:s,index:r,rects:i,overIndex:o}=n;const a=(e=i[t])!=null?e:s;if(!a)return null;if(r===t){const u=i[o];return u?{x:0,y:t<o?u.top+u.height-(a.top+a.height):u.top-a.top,...Kf}:null}const l=w4(i,r,t);return r>t&&r<=o?{x:0,y:-a.height-l,...Kf}:r<t&&r>=o?{x:0,y:a.height+l,...Kf}:{x:0,y:0,...Kf}};function w4(n,e,t){const s=n[e],r=n[e-1],i=n[e+1];return s?t<e?r?s.top-(r.top+r.height):i?i.top-(s.top+s.height):0:i?i.top-(s.top+s.height):r?s.top-(r.top+r.height):0:0}const VT="Sortable",UT=gt.createContext({activeIndex:-1,containerId:VT,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:WT,disabled:{draggable:!1,droppable:!1}});function fb(n){let{children:e,id:t,items:s,strategy:r=WT,disabled:i=!1}=n;const{active:o,dragOverlay:a,droppableRects:l,over:u,measureDroppableContainers:d}=BT(),f=hd(VT,t),p=a.rect!==null,g=j.useMemo(()=>s.map(T=>typeof T=="object"&&"id"in T?T.id:T),[s]),x=o!=null,y=o?g.indexOf(o.id):-1,b=u?g.indexOf(u.id):-1,k=j.useRef(g),w=!v4(g,k.current),N=b!==-1&&y===-1||w,C=b4(i);Jr(()=>{w&&x&&d(g)},[w,g,x,d]),j.useEffect(()=>{k.current=g},[g]);const S=j.useMemo(()=>({activeIndex:y,containerId:f,disabled:C,disableTransforms:N,items:g,overIndex:b,useDragOverlay:p,sortedRects:y4(g,l),strategy:r}),[y,f,C.draggable,C.droppable,N,g,b,l,p,r]);return gt.createElement(UT.Provider,{value:S},e)}const k4=n=>{let{id:e,items:t,activeIndex:s,overIndex:r}=n;return db(t,s,r).indexOf(e)},C4=n=>{let{containerId:e,isSorting:t,wasDragging:s,index:r,items:i,newIndex:o,previousItems:a,previousContainerId:l,transition:u}=n;return!u||!s||a!==i&&r===o?!1:t?!0:o!==r&&e===l},S4={duration:200,easing:"ease"},GT="transform",N4=ei.Transition.toString({property:GT,duration:0,easing:"linear"}),I4={roleDescription:"sortable"};function T4(n){let{disabled:e,index:t,node:s,rect:r}=n;const[i,o]=j.useState(null),a=j.useRef(t);return Jr(()=>{if(!e&&t!==a.current&&s.current){const l=r.current;if(l){const u=kc(s.current,{ignoreTransform:!0}),d={x:l.left-u.left,y:l.top-u.top,scaleX:l.width/u.width,scaleY:l.height/u.height};(d.x||d.y)&&o(d)}}t!==a.current&&(a.current=t)},[e,t,s,r]),j.useEffect(()=>{i&&o(null)},[i]),i}function Rm(n){let{animateLayoutChanges:e=C4,attributes:t,disabled:s,data:r,getNewIndex:i=k4,id:o,strategy:a,resizeObserverConfig:l,transition:u=S4}=n;const{items:d,containerId:f,activeIndex:p,disabled:g,disableTransforms:x,sortedRects:y,overIndex:b,useDragOverlay:k,strategy:w}=j.useContext(UT),N=$4(s,g),C=d.indexOf(o),S=j.useMemo(()=>({sortable:{containerId:f,index:C,items:d},...r}),[f,r,C,d]),T=j.useMemo(()=>d.slice(d.indexOf(o)),[d,o]),{rect:A,node:E,isOver:M,setNodeRef:P}=r4({id:o,data:S,disabled:N.droppable,resizeObserverConfig:{updateMeasurementsFor:T,...l}}),{active:R,activatorEvent:L,activeNodeRect:_,attributes:O,setNodeRef:U,listeners:W,isDragging:H,over:G,setActivatorNodeRef:q,transform:Q}=t4({id:o,data:S,attributes:{...I4,...t},disabled:N.draggable}),z=V3(P,U),K=!!R,Y=K&&!x&&qf(p)&&qf(b),B=!k&&H,J=B&&Y?Q:null,pe=Y?J??(a??w)({rects:y,activeNodeRect:_,activeIndex:p,overIndex:b,index:C}):null,ge=qf(p)&&qf(b)?i({id:o,items:d,activeIndex:p,overIndex:b}):C,he=R==null?void 0:R.id,we=j.useRef({activeId:he,items:d,newIndex:ge,containerId:f}),Pe=d!==we.current.items,ue=e({active:R,containerId:f,isDragging:H,isSorting:K,id:o,index:C,items:d,newIndex:we.current.newIndex,previousItems:we.current.items,previousContainerId:we.current.containerId,transition:u,wasDragging:we.current.activeId!=null}),Te=T4({disabled:!ue,index:C,node:E,rect:A});return j.useEffect(()=>{K&&we.current.newIndex!==ge&&(we.current.newIndex=ge),f!==we.current.containerId&&(we.current.containerId=f),d!==we.current.items&&(we.current.items=d)},[K,ge,f,d]),j.useEffect(()=>{if(he===we.current.activeId)return;if(he&&!we.current.activeId){we.current.activeId=he;return}const ye=setTimeout(()=>{we.current.activeId=he},50);return()=>clearTimeout(ye)},[he]),{active:R,activeIndex:p,attributes:O,data:S,rect:A,index:C,newIndex:ge,items:d,isOver:M,isSorting:K,isDragging:H,listeners:W,node:E,overIndex:b,over:G,setNodeRef:z,setActivatorNodeRef:q,setDroppableNodeRef:P,setDraggableNodeRef:U,transform:Te??pe,transition:ke()};function ke(){if(Te||Pe&&we.current.newIndex===C)return N4;if(!(B&&!$m(L)||!u)&&(K||ue))return ei.Transition.toString({...u,property:GT})}}function $4(n,e){var t,s;return typeof n=="boolean"?{draggable:n,droppable:!1}:{draggable:(t=n==null?void 0:n.draggable)!=null?t:e.draggable,droppable:(s=n==null?void 0:n.droppable)!=null?s:e.droppable}}function zp(n){if(!n)return!1;const e=n.data.current;return!!(e&&"sortable"in e&&typeof e.sortable=="object"&&"containerId"in e.sortable&&"items"in e.sortable&&"index"in e.sortable)}const E4=[vt.Down,vt.Right,vt.Up,vt.Left],pb=(n,e)=>{let{context:{active:t,collisionRect:s,droppableRects:r,droppableContainers:i,over:o,scrollableAncestors:a}}=e;if(E4.includes(n.code)){if(n.preventDefault(),!t||!s)return;const l=[];i.getEnabled().forEach(f=>{if(!f||f!=null&&f.disabled)return;const p=r.get(f.id);if(p)switch(n.code){case vt.Down:s.top<p.top&&l.push(f);break;case vt.Up:s.top>p.top&&l.push(f);break;case vt.Left:s.left>p.left&&l.push(f);break;case vt.Right:s.left<p.left&&l.push(f);break}});const u=iF({collisionRect:s,droppableRects:r,droppableContainers:l});let d=NT(u,"id");if(d===(o==null?void 0:o.id)&&u.length>1&&(d=u[1].id),d!=null){const f=i.get(t.id),p=i.get(d),g=p?r.get(p.id):null,x=p==null?void 0:p.node.current;if(x&&g&&f&&p){const b=Em(x).some((T,A)=>a[A]!==T),k=HT(f,p),w=A4(f,p),N=b||!k?{x:0,y:0}:{x:w?s.width-g.width:0,y:w?s.height-g.height:0},C={x:g.left,y:g.top};return N.x&&N.y?C:Ku(C,N)}}}};function HT(n,e){return!zp(n)||!zp(e)?!1:n.data.current.sortable.containerId===e.data.current.sortable.containerId}function A4(n,e){return!zp(n)||!zp(e)||!HT(n,e)?!1:n.data.current.sortable.index<e.data.current.sortable.index}const lS=n=>{let e;const t=new Set,s=(u,d)=>{const f=typeof u=="function"?u(e):u;if(!Object.is(f,e)){const p=e;e=d??(typeof f!="object"||f===null)?f:Object.assign({},e,f),t.forEach(g=>g(e,p))}},r=()=>e,a={setState:s,getState:r,getInitialState:()=>l,subscribe:u=>(t.add(u),()=>t.delete(u))},l=e=n(s,r,a);return a},j4=(n=>n?lS(n):lS),R4=n=>n;function D4(n,e=R4){const t=gt.useSyncExternalStore(n.subscribe,gt.useCallback(()=>e(n.getState()),[n,e]),gt.useCallback(()=>e(n.getInitialState()),[n,e]));return gt.useDebugValue(t),t}const cS=n=>{const e=j4(n),t=s=>D4(e,s);return Object.assign(t,e),t},An=(n=>n?cS(n):cS),Wt=An((n,e)=>({currentView:"home",selectedPlaylistId:null,selectedPluginId:null,selectedArtistId:null,selectedAlbumId:null,selectedSectionData:null,selectedArtistData:null,selectedAlbumData:null,searchQuery:"",isSearchActive:!1,navigate:t=>{n({currentView:t,selectedPlaylistId:null,selectedPluginId:null,selectedArtistId:null,selectedAlbumId:null,selectedSectionData:null,selectedArtistData:null,selectedAlbumData:null})},openPlaylist:t=>{n({currentView:"playlist-detail",selectedPlaylistId:t})},openPlugin:t=>{n({currentView:"plugin-detail",selectedPluginId:t})},openArtist:(t,s)=>{n({currentView:"artist-detail",selectedArtistId:t,selectedArtistData:s||null})},openAlbum:(t,s)=>{n({currentView:"album-detail",selectedAlbumId:t,selectedAlbumData:s||null})},openSectionDetail:t=>{n({currentView:"section-detail",selectedSectionData:t})},setSearchQuery:t=>{n({searchQuery:t,isSearchActive:t.length>0})},setSearchActive:t=>{n({isSearchActive:t})},clearSearch:()=>{n({searchQuery:"",isSearchActive:!1})},goBack:()=>{const{currentView:t}=e(),s={searchQuery:"",isSearchActive:!1};t==="playlist-detail"?n({...s,currentView:"playlists",selectedPlaylistId:null}):t==="plugin-detail"?n({...s,currentView:"plugins",selectedPluginId:null}):t==="artist-detail"?n({...s,currentView:"home",selectedArtistId:null,selectedArtistData:null}):t==="album-detail"?n({...s,currentView:"home",selectedAlbumId:null,selectedAlbumData:null}):t==="section-detail"?n({...s,currentView:"home",selectedSectionData:null}):t==="stats"?n({...s,currentView:"home"}):t.startsWith("plugin-view-")?n({...s,currentView:"home"}):n({...s,currentView:"home"})},navigateTo:(t,s)=>{s!=null&&s.playlistId&&t==="playlist-detail"?n({currentView:t,selectedPlaylistId:s.playlistId}):s!=null&&s.pluginId&&t==="plugin-detail"?n({currentView:t,selectedPluginId:s.pluginId}):s!=null&&s.artistId&&t==="artist-detail"?n({currentView:t,selectedArtistId:s.artistId}):s!=null&&s.albumId&&t==="album-detail"?n({currentView:t,selectedAlbumId:s.albumId}):n({currentView:t,selectedPlaylistId:null,selectedPluginId:null,selectedArtistId:null,selectedAlbumId:null})}}));function P4(n,e){let t;try{t=n()}catch{return}return{getItem:r=>{var i;const o=l=>l===null?null:JSON.parse(l,void 0),a=(i=t.getItem(r))!=null?i:null;return a instanceof Promise?a.then(o):o(a)},setItem:(r,i)=>t.setItem(r,JSON.stringify(i,void 0)),removeItem:r=>t.removeItem(r)}}const ev=n=>e=>{try{const t=n(e);return t instanceof Promise?t:{then(s){return ev(s)(t)},catch(s){return this}}}catch(t){return{then(s){return this},catch(s){return ev(s)(t)}}}},M4=(n,e)=>(t,s,r)=>{let i={storage:P4(()=>localStorage),partialize:y=>y,version:0,merge:(y,b)=>({...b,...y}),...e},o=!1;const a=new Set,l=new Set;let u=i.storage;if(!u)return n((...y)=>{console.warn(`[zustand persist middleware] Unable to update item '${i.name}', the given storage is currently unavailable.`),t(...y)},s,r);const d=()=>{const y=i.partialize({...s()});return u.setItem(i.name,{state:y,version:i.version})},f=r.setState;r.setState=(y,b)=>(f(y,b),d());const p=n((...y)=>(t(...y),d()),s,r);r.getInitialState=()=>p;let g;const x=()=>{var y,b;if(!u)return;o=!1,a.forEach(w=>{var N;return w((N=s())!=null?N:p)});const k=((b=i.onRehydrateStorage)==null?void 0:b.call(i,(y=s())!=null?y:p))||void 0;return ev(u.getItem.bind(u))(i.name).then(w=>{if(w)if(typeof w.version=="number"&&w.version!==i.version){if(i.migrate){const N=i.migrate(w.state,w.version);return N instanceof Promise?N.then(C=>[!0,C]):[!0,N]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,w.state];return[!1,void 0]}).then(w=>{var N;const[C,S]=w;if(g=i.merge(S,(N=s())!=null?N:p),t(g,!0),C)return d()}).then(()=>{k==null||k(g,void 0),g=s(),o=!0,l.forEach(w=>w(g))}).catch(w=>{k==null||k(void 0,w)})};return r.persist={setOptions:y=>{i={...i,...y},y.storage&&(u=y.storage)},clearStorage:()=>{u==null||u.removeItem(i.name)},getOptions:()=>i,rehydrate:()=>x(),hasHydrated:()=>o,onHydrate:y=>(a.add(y),()=>{a.delete(y)}),onFinishHydration:y=>(l.add(y),()=>{l.delete(y)})},i.skipHydration||x(),g||p},Er=M4,Xt=An()(Er((n,e)=>({likedTracks:[],dislikedTracks:[],playlists:[],folders:[],downloads:[],likeTrack:t=>{n(s=>s.likedTracks.some(i=>i.track.id===t.id)?s:{likedTracks:[{track:t,addedAt:Date.now()},...s.likedTracks]})},unlikeTrack:t=>{n(s=>({likedTracks:s.likedTracks.filter(r=>r.track.id!==t)}))},isLiked:t=>e().likedTracks.some(s=>s.track.id===t),toggleLike:t=>{const{isLiked:s,likeTrack:r,unlikeTrack:i}=e();s(t.id)?i(t.id):r(t)},dislikeTrack:t=>{n(s=>s.dislikedTracks.some(i=>i.track.id===t.id)?s:{dislikedTracks:[{track:t,addedAt:Date.now()},...s.dislikedTracks]})},undislikeTrack:t=>{n(s=>({dislikedTracks:s.dislikedTracks.filter(r=>r.track.id!==t)}))},isDisliked:t=>e().dislikedTracks.some(s=>s.track.id===t),toggleDislike:t=>{const{isDisliked:s,dislikeTrack:r,undislikeTrack:i}=e();s(t.id)?i(t.id):r(t)},createPlaylist:(t,s,r=null)=>{const{playlists:i}=e(),a=i.filter(u=>u.folderId===r).reduce((u,d)=>Math.max(u,d.order),-1),l={id:crypto.randomUUID(),name:t,description:s,tracks:[],folderId:r,order:a+1,createdAt:new Date,updatedAt:new Date};return n(u=>({playlists:[l,...u.playlists]})),l},deletePlaylist:t=>{n(s=>({playlists:s.playlists.filter(r=>r.id!==t)}))},renamePlaylist:(t,s)=>{n(r=>({playlists:r.playlists.map(i=>i.id===t?{...i,name:s,updatedAt:new Date}:i)}))},addToPlaylist:(t,s)=>{n(r=>({playlists:r.playlists.map(i=>i.id!==t||i.tracks.some(o=>o.id===s.id)?i:{...i,tracks:[...i.tracks,s],updatedAt:new Date})}))},removeFromPlaylist:(t,s)=>{n(r=>({playlists:r.playlists.map(i=>i.id===t?{...i,tracks:i.tracks.filter(o=>o.id!==s),updatedAt:new Date}:i)}))},reorderPlaylist:(t,s,r)=>{n(i=>({playlists:i.playlists.map(o=>{if(o.id!==t)return o;const a=[...o.tracks],[l]=a.splice(s,1);return l&&a.splice(r,0,l),{...o,tracks:a,updatedAt:new Date}})}))},movePlaylistToFolder:(t,s)=>{const{playlists:r}=e(),o=r.filter(a=>a.folderId===s&&a.id!==t).reduce((a,l)=>Math.max(a,l.order),-1);n(a=>({playlists:a.playlists.map(l=>l.id===t?{...l,folderId:s,order:o+1,updatedAt:new Date}:l)}))},getOrCreateLocalFolderPlaylist:(t,s)=>{const{playlists:r}=e(),i=r.find(u=>u.localFolderId===t);if(i)return i;const a=r.filter(u=>u.folderId===null).reduce((u,d)=>Math.max(u,d.order),-1),l={id:crypto.randomUUID(),name:`Local: ${s}`,description:`Music from ${s}`,tracks:[],folderId:null,order:a+1,createdAt:new Date,updatedAt:new Date,localFolderId:t};return n(u=>({playlists:[l,...u.playlists]})),l},setLocalFolderPlaylistTracks:(t,s,r)=>{const{playlists:i}=e();let o=i.find(a=>a.localFolderId===t);o||(o=e().getOrCreateLocalFolderPlaylist(t,s)),n(a=>({playlists:a.playlists.map(l=>l.localFolderId===t?{...l,tracks:r,updatedAt:new Date}:l)}))},deleteLocalFolderPlaylist:t=>{n(s=>({playlists:s.playlists.filter(r=>r.localFolderId!==t)}))},createFolder:(t,s=null)=>{const{folders:r}=e(),o=r.filter(l=>l.parentId===s).reduce((l,u)=>Math.max(l,u.order),-1),a={id:crypto.randomUUID(),name:t,parentId:s,order:o+1,isExpanded:!0,createdAt:new Date,updatedAt:new Date};return n(l=>({folders:[...l.folders,a]})),a},deleteFolder:t=>{const s=(a,l)=>{const u=l.filter(d=>d.parentId===a);return[a,...u.flatMap(d=>s(d.id,l))]},{folders:r,playlists:i}=e(),o=s(t,r);n({folders:r.filter(a=>!o.includes(a.id)),playlists:i.map(a=>o.includes(a.folderId??"")?{...a,folderId:null,updatedAt:new Date}:a)})},renameFolder:(t,s)=>{n(r=>({folders:r.folders.map(i=>i.id===t?{...i,name:s,updatedAt:new Date}:i)}))},toggleFolderExpanded:t=>{n(s=>({folders:s.folders.map(r=>r.id===t?{...r,isExpanded:!r.isExpanded}:r)}))},moveFolderToFolder:(t,s)=>{const r=(u,d)=>{const f=d.filter(p=>p.parentId===u);return[u,...f.flatMap(p=>r(p.id,d))]},{folders:i}=e(),o=r(t,i);if(s&&o.includes(s))return;const l=i.filter(u=>u.parentId===s&&u.id!==t).reduce((u,d)=>Math.max(u,d.order),-1);n(u=>({folders:u.folders.map(d=>d.id===t?{...d,parentId:s,order:l+1,updatedAt:new Date}:d)}))},reorderSidebarItems:t=>{n(s=>{const r=new Map(t.filter(o=>o.type==="playlist").map(o=>[o.id,{order:o.order,folderId:o.parentId}])),i=new Map(t.filter(o=>o.type==="folder").map(o=>[o.id,{order:o.order,parentId:o.parentId}]));return{playlists:s.playlists.map(o=>{const a=r.get(o.id);return a?{...o,order:a.order,folderId:a.folderId,updatedAt:new Date}:o}),folders:s.folders.map(o=>{const a=i.get(o.id);return a?{...o,order:a.order,parentId:a.parentId,updatedAt:new Date}:o})}})},startDownload:t=>{var s;n(r=>r.downloads.some(o=>o.track.id===t.id)?r:{downloads:[{track:t,status:"pending",progress:0,startedAt:new Date},...r.downloads]}),(s=window.api)!=null&&s.downloadTrack&&window.api.downloadTrack(t)},updateDownloadProgress:(t,s)=>{n(r=>({downloads:r.downloads.map(i=>i.track.id===t?{...i,status:"downloading",progress:s}:i)}))},completeDownload:(t,s)=>{n(r=>({downloads:r.downloads.map(i=>i.track.id===t?{...i,status:"completed",progress:100,filePath:s,completedAt:new Date}:i)}))},failDownload:(t,s)=>{n(r=>({downloads:r.downloads.map(i=>i.track.id===t?{...i,status:"failed",error:s}:i)}))},removeDownload:t=>{n(s=>({downloads:s.downloads.filter(r=>r.track.id!==t)}))},retryDownload:t=>{var r;const s=e().downloads.find(i=>i.track.id===t);s&&(n(i=>({downloads:i.downloads.map(o=>o.track.id===t?{...o,status:"pending",progress:0,error:void 0}:o)})),(r=window.api)!=null&&r.downloadTrack&&window.api.downloadTrack(s.track))},getDownload:t=>e().downloads.find(s=>s.track.id===t)}),{name:"audiio-library",version:3,migrate:(n,e)=>{let t=n;if(e<2){const s=(t.playlists||[]).map((r,i)=>({...r,folderId:r.folderId??null,order:r.order??i}));t={...t,playlists:s,folders:[]}}if(e<3){const s=r=>Array.isArray(r)?r.map((i,o)=>i&&typeof i=="object"&&"track"in i&&"addedAt"in i?i:{track:i,addedAt:Date.now()-(r.length-o)*1e3}):[];t={...t,likedTracks:s(t.likedTracks),dislikedTracks:s(t.dislikedTracks)}}return t},partialize:n=>({likedTracks:n.likedTracks,dislikedTracks:n.dislikedTracks,playlists:n.playlists,folders:n.folders,downloads:n.downloads.filter(e=>e.status==="completed")})})),L4={"metadata-provider":"metadata","stream-provider":"streaming","lyrics-provider":"lyrics",scrobbler:"scrobbling","audio-processor":"audio",tool:"tool"},Qf=async(n,e)=>{var t;if((t=window.api)!=null&&t.setAddonEnabled)try{await window.api.setAddonEnabled(n,e),console.log(`[PluginStore] Plugin ${n} ${e?"enabled":"disabled"}`)}catch(s){console.error(`[PluginStore] Failed to ${e?"enable":"disable"} plugin ${n}:`,s)}},c0=async n=>{var e;if((e=window.api)!=null&&e.setAddonOrder)try{await window.api.setAddonOrder(n),console.log("[PluginStore] Plugin order updated")}catch(t){console.error("[PluginStore] Failed to update plugin order:",t)}},F4=async(n,e)=>{var t;if((t=window.api)!=null&&t.updateAddonSettings)try{await window.api.updateAddonSettings(n,e),console.log(`[PluginStore] Plugin ${n} settings updated`)}catch(s){console.error(`[PluginStore] Failed to update plugin ${n} settings:`,s)}},O4=n=>{if(!n||n.length===0)return"other";const e=n[0];return L4[e]||"other"},ii=An()(Er((n,e)=>({plugins:[],pluginOrder:[],pluginSettings:{},pluginEnabledStates:{},syncFromBackend:async()=>{var t;if(!((t=window.api)!=null&&t.getLoadedPlugins)){console.log("[PluginStore] API not available");return}try{const s=await window.api.getLoadedPlugins();console.log("[PluginStore] Loaded plugins from backend:",s.map(d=>d.id));const{pluginSettings:r,pluginEnabledStates:i}=e(),o=s.map(d=>({id:d.id,name:d.name||d.id,description:d.description||"",version:d.version||"1.0.0",author:d.author||"Unknown",icon:d.icon,category:O4(d.roles||[]),roles:d.roles||[],enabled:i[d.id]??!0,installed:!0,homepage:d.homepage,repository:d.repository,privacyAccess:d.privacyAccess,settingsDefinitions:d.settingsDefinitions,settings:r[d.id]||d.settings||{}})),a=e().pluginOrder,l=o.map(d=>d.id).filter(d=>!a.includes(d)),u=[...a.filter(d=>o.some(f=>f.id===d)),...l];n({plugins:o,pluginOrder:u});for(const d of o)await Qf(d.id,d.enabled);u.length>0&&await c0(u)}catch(s){console.error("[PluginStore] Failed to sync from backend:",s)}},togglePlugin:t=>{const s=e().plugins.find(i=>i.id===t),r=s?!s.enabled:!1;n(i=>({plugins:i.plugins.map(o=>o.id===t?{...o,enabled:r}:o),pluginEnabledStates:{...i.pluginEnabledStates,[t]:r}})),Qf(t,r)},enablePlugin:t=>{n(s=>({plugins:s.plugins.map(r=>r.id===t?{...r,enabled:!0}:r),pluginEnabledStates:{...s.pluginEnabledStates,[t]:!0}})),Qf(t,!0)},disablePlugin:t=>{n(s=>({plugins:s.plugins.map(r=>r.id===t?{...r,enabled:!1}:r),pluginEnabledStates:{...s.pluginEnabledStates,[t]:!1}})),Qf(t,!1)},getPlugin:t=>e().plugins.find(s=>s.id===t),getPluginsByRole:t=>e().plugins.filter(s=>s.roles.includes(t)&&s.enabled&&s.installed),getInstalledPlugins:()=>e().plugins.filter(t=>t.installed),hasCapability:t=>e().plugins.some(s=>s.roles.includes(t)&&s.enabled&&s.installed),updatePluginSetting:(t,s,r)=>{n(o=>{const a={...o.pluginSettings[t],[s]:r};return{plugins:o.plugins.map(l=>l.id===t?{...l,settings:{...l.settings,[s]:r}}:l),pluginSettings:{...o.pluginSettings,[t]:a}}});const i=e().pluginSettings[t];i&&F4(t,i)},getPluginSettings:t=>{var s;return e().pluginSettings[t]||((s=e().plugins.find(r=>r.id===t))==null?void 0:s.settings)},removePlugin:async t=>{var s,r;try{if((r=(s=window.api)==null?void 0:s.repositories)!=null&&r.uninstallPlugin){const i=await window.api.repositories.uninstallPlugin(t);if(!i.success)throw new Error(i.error||"Uninstall failed");console.log(`[PluginStore] Plugin ${t} uninstalled`)}else throw console.warn("[PluginStore] No uninstall API available"),new Error("Uninstall API not available");n(i=>({plugins:i.plugins.filter(o=>o.id!==t),pluginOrder:i.pluginOrder.filter(o=>o!==t)}))}catch(i){throw console.error(`[PluginStore] Failed to uninstall plugin ${t}:`,i),i}},reorderPlugins:(t,s)=>{n(r=>{const i=[...r.pluginOrder],[o]=i.splice(t,1);return o&&i.splice(s,0,o),c0(i),{pluginOrder:i}})},getOrderedPlugins:()=>{const{plugins:t,pluginOrder:s}=e();return[...t].sort((r,i)=>{const o=s.indexOf(r.id),a=s.indexOf(i.id);return o===-1&&a===-1?0:o===-1?1:a===-1?-1:o-a})},setPluginOrder:t=>{n({pluginOrder:t}),c0(t)}}),{name:"audiio-plugins",partialize:n=>({pluginOrder:n.pluginOrder,pluginSettings:n.pluginSettings,pluginEnabledStates:n.pluginEnabledStates}),onRehydrateStorage:()=>n=>{n&&setTimeout(()=>{n.syncFromBackend()},100)}})),el=An()(Er((n,e)=>({playerMode:"mini",isQueueOpen:!1,isLyricsVisible:!1,isLyricsPanelOpen:!1,isLyricsPanelExpanded:!1,queueAnchorRect:null,dislikeModalTrack:null,isSidebarCollapsed:!1,sidebarWidth:260,isPlaylistsExpanded:!0,isCreatePlaylistModalOpen:!1,isCreateFolderModalOpen:!1,expandPlayer:()=>{n({playerMode:"full",isQueueOpen:!1,isLyricsPanelOpen:!1})},collapsePlayer:()=>{n({playerMode:"mini"})},togglePlayer:()=>{const{playerMode:t}=e();n(t==="mini"?{playerMode:"full",isQueueOpen:!1,isLyricsPanelOpen:!1}:{playerMode:"mini"})},openQueue:t=>{n({isQueueOpen:!0,queueAnchorRect:t,isLyricsPanelOpen:!1})},closeQueue:()=>{n({isQueueOpen:!1,queueAnchorRect:null})},toggleQueue:t=>{const{isQueueOpen:s}=e();s?n({isQueueOpen:!1,queueAnchorRect:null}):t&&n({isQueueOpen:!0,queueAnchorRect:t,isLyricsPanelOpen:!1})},toggleLyrics:()=>{n(t=>({isLyricsVisible:!t.isLyricsVisible}))},setLyricsVisible:t=>{n({isLyricsVisible:t})},toggleLyricsPanel:()=>{const{isLyricsPanelOpen:t}=e();n({isLyricsPanelOpen:!t,isQueueOpen:!1})},openLyricsPanel:()=>{n({isLyricsPanelOpen:!0,isQueueOpen:!1})},closeLyricsPanel:()=>{n({isLyricsPanelOpen:!1,isLyricsPanelExpanded:!1})},toggleLyricsPanelExpanded:()=>{n(t=>({isLyricsPanelExpanded:!t.isLyricsPanelExpanded}))},openDislikeModal:t=>{n({dislikeModalTrack:t})},closeDislikeModal:()=>{n({dislikeModalTrack:null})},openCreatePlaylistModal:()=>{n({isCreatePlaylistModalOpen:!0})},closeCreatePlaylistModal:()=>{n({isCreatePlaylistModalOpen:!1})},openCreateFolderModal:()=>{n({isCreateFolderModalOpen:!0})},closeCreateFolderModal:()=>{n({isCreateFolderModalOpen:!1})},toggleSidebar:()=>{n(t=>({isSidebarCollapsed:!t.isSidebarCollapsed}))},collapseSidebar:()=>{n({isSidebarCollapsed:!0})},expandSidebar:()=>{n({isSidebarCollapsed:!1})},setSidebarWidth:t=>{n({sidebarWidth:Math.max(200,Math.min(400,t))})},togglePlaylistsExpanded:()=>{n(t=>({isPlaylistsExpanded:!t.isPlaylistsExpanded}))}}),{name:"audiio-ui",partialize:n=>({sidebarWidth:n.sidebarWidth,isSidebarCollapsed:n.isSidebarCollapsed,isPlaylistsExpanded:n.isPlaylistsExpanded})}));class _4{constructor(){Mt(this,"navItems",new Map);Mt(this,"views",new Map);Mt(this,"settingsPanels",new Map);Mt(this,"modals",new Map);Mt(this,"listeners",new Set)}register(e){const{pluginId:t,navItems:s,views:r,settingsPanels:i,modals:o}=e;s==null||s.forEach(a=>{this.navItems.set(`${t}:${a.viewId}`,{...a,pluginId:t})}),r==null||r.forEach(a=>{this.views.set(a.viewId,{...a,pluginId:t})}),i==null||i.forEach(a=>{this.settingsPanels.set(t,{...a,pluginId:t})}),o==null||o.forEach(a=>{this.modals.set(a.modalId,{...a,pluginId:t})}),console.log(`[PluginUIRegistry] Registered UI for plugin: ${t}`),this.notifyListeners()}unregister(e){for(const[t,s]of this.navItems)s.pluginId===e&&this.navItems.delete(t);for(const[t,s]of this.views)s.pluginId===e&&this.views.delete(t);this.settingsPanels.delete(e);for(const[t,s]of this.modals)s.pluginId===e&&this.modals.delete(t);console.log(`[PluginUIRegistry] Unregistered UI for plugin: ${e}`),this.notifyListeners()}getNavItems(){return Array.from(this.navItems.values()).sort((t,s)=>{const r={library:0,tools:1,settings:2},i=r[t.section||"tools"]??1,o=r[s.section||"tools"]??1;return i!==o?i-o:(t.order??0)-(s.order??0)})}getNavItemsBySection(e){return this.getNavItems().filter(t=>(t.section||"tools")===e)}getView(e){return this.views.get(e)}getAllViews(){return Array.from(this.views.values())}getSettingsPanel(e){return this.settingsPanels.get(e)}getModal(e){return this.modals.get(e)}hasView(e){return this.views.has(e)}subscribe(e){return this.listeners.add(e),()=>{this.listeners.delete(e)}}notifyListeners(){this.listeners.forEach(e=>e())}}const uS=new _4;function qT(){const[,n]=gt.useReducer(e=>e+1,0);return gt.useEffect(()=>uS.subscribe(n),[]),uS}function z4(){var n,e,t;console.log("[PluginUI] Initializing plugin UI system..."),typeof window<"u"&&((n=window.api)!=null&&n.plugins)&&((t=(e=window.api.plugins).onPluginUIRegistered)==null||t.call(e,s=>{console.log(`[PluginUI] Received registration for: ${s.pluginId}`)})),console.log("[PluginUI] Plugin UI system initialized")}const B4=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,...t,children:[c.jsx("rect",{x:"2",y:"9",width:"2.5",height:"6",rx:"1.25"}),c.jsx("rect",{x:"6",y:"6",width:"2.5",height:"12",rx:"1.25"}),c.jsx("rect",{x:"10",y:"4",width:"2.5",height:"16",rx:"1.25"}),c.jsx("rect",{x:"14",y:"6",width:"2.5",height:"12",rx:"1.25"}),c.jsx("rect",{x:"18",y:"9",width:"2.5",height:"6",rx:"1.25"})]}),Et=({size:n=24,className:e,...t})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,...t,children:c.jsx("path",{d:"M8 6.82v10.36c0 .79.87 1.27 1.54.84l8.14-5.18a1 1 0 0 0 0-1.68L9.54 5.98A1 1 0 0 0 8 6.82Z"})}),gd=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,...t,children:[c.jsx("rect",{x:"6",y:"4",width:"4",height:"16",rx:"1"}),c.jsx("rect",{x:"14",y:"4",width:"4",height:"16",rx:"1"})]}),Dm=({size:n=24,className:e,...t})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,...t,children:c.jsx("path",{d:"M6 6.82v10.36c0 .79.87 1.27 1.54.84l6.46-4.11V17a1 1 0 0 0 1 1h1a1 1 0 0 0 1-1V7a1 1 0 0 0-1-1h-1a1 1 0 0 0-1 1v3.09L7.54 5.98A1 1 0 0 0 6 6.82Z"})}),mb=({size:n=24,className:e,...t})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,...t,children:c.jsx("path",{d:"M18 6.82v10.36c0 .79-.87 1.27-1.54.84L10 13.91V17a1 1 0 0 1-1 1H8a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1h1a1 1 0 0 1 1 1v3.09l6.46-4.11A1 1 0 0 1 18 6.82Z"})}),oo=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("path",{d:"M16 3h5v5"}),c.jsx("path",{d:"M4 20 21 3"}),c.jsx("path",{d:"M21 16v5h-5"}),c.jsx("path",{d:"M15 15 21 21"}),c.jsx("path",{d:"M4 4l5 5"})]}),KT=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("path",{d:"M17 2l4 4-4 4"}),c.jsx("path",{d:"M3 11v-1a4 4 0 0 1 4-4h14"}),c.jsx("path",{d:"M7 22l-4-4 4-4"}),c.jsx("path",{d:"M21 13v1a4 4 0 0 1-4 4H3"})]}),QT=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("path",{d:"M17 2l4 4-4 4"}),c.jsx("path",{d:"M3 11v-1a4 4 0 0 1 4-4h14"}),c.jsx("path",{d:"M7 22l-4-4 4-4"}),c.jsx("path",{d:"M21 13v1a4 4 0 0 1-4 4H3"}),c.jsx("text",{x:"11",y:"15",fontSize:"8",fill:"currentColor",fontWeight:"bold",stroke:"none",children:"1"})]}),Bp=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("line",{x1:"3",y1:"6",x2:"17",y2:"6"}),c.jsx("line",{x1:"3",y1:"12",x2:"13",y2:"12"}),c.jsx("line",{x1:"3",y1:"18",x2:"10",y2:"18"}),c.jsx("polygon",{points:"16 13 21 16 16 19",fill:"currentColor",stroke:"none"})]}),Xu=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("circle",{cx:"11",cy:"11",r:"8"}),c.jsx("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})]}),tv=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("circle",{cx:"12",cy:"12",r:"10"}),c.jsx("polygon",{points:"16.24 7.76 14.12 14.12 7.76 16.24 9.88 9.88 16.24 7.76",fill:"currentColor"})]}),Pm=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("circle",{cx:"12",cy:"12",r:"3"}),c.jsx("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1Z"})]}),Fa=({size:n=24,className:e,...t})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:c.jsx("polyline",{points:"6 9 12 15 18 9"})}),XT=({size:n=24,className:e,...t})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:c.jsx("polyline",{points:"18 15 12 9 6 15"})}),gb=({size:n=24,className:e,...t})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:c.jsx("polyline",{points:"15 18 9 12 15 6"})}),Yi=({size:n=24,className:e,...t})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:c.jsx("polyline",{points:"9 18 15 12 9 6"})}),Cc=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("line",{x1:"19",y1:"12",x2:"5",y2:"12"}),c.jsx("polyline",{points:"12 19 5 12 12 5"})]}),qe=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("path",{d:"M9 18V5l12-2v13"}),c.jsx("circle",{cx:"6",cy:"18",r:"3"}),c.jsx("circle",{cx:"18",cy:"16",r:"3"})]}),xb=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("path",{d:"M4 6h16"}),c.jsx("path",{d:"M4 10h12"}),c.jsx("path",{d:"M4 14h8"}),c.jsx("path",{d:"M4 18h10"}),c.jsx("circle",{cx:"18",cy:"16",r:"3"}),c.jsx("path",{d:"M21 13v6"})]}),yi=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("rect",{x:"3",y:"4",width:"2",height:"2",rx:"0.5",fill:"currentColor",stroke:"none"}),c.jsx("line",{x1:"8",y1:"5",x2:"21",y2:"5"}),c.jsx("rect",{x:"3",y:"9",width:"2",height:"2",rx:"0.5",fill:"currentColor",stroke:"none"}),c.jsx("line",{x1:"8",y1:"10",x2:"21",y2:"10"}),c.jsx("rect",{x:"3",y:"14",width:"2",height:"2",rx:"0.5",fill:"currentColor",stroke:"none"}),c.jsx("line",{x1:"8",y1:"15",x2:"21",y2:"15"}),c.jsx("rect",{x:"3",y:"19",width:"2",height:"2",rx:"0.5",fill:"currentColor",stroke:"none"}),c.jsx("line",{x1:"8",y1:"20",x2:"17",y2:"20"})]}),W4=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("circle",{cx:"12",cy:"7",r:"4"}),c.jsx("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"})]}),Wp=W4,rc=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("circle",{cx:"12",cy:"12",r:"2"}),c.jsx("path",{d:"M16.24 7.76a6 6 0 0 1 0 8.49m-8.48-.01a6 6 0 0 1 0-8.49m11.31-2.82a10 10 0 0 1 0 14.14m-14.14 0a10 10 0 0 1 0-14.14"})]}),V4=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",fill:"currentColor",stroke:"none"}),c.jsx("path",{d:"M15.54 8.46a5 5 0 0 1 0 7.07"}),c.jsx("path",{d:"M19.07 4.93a10 10 0 0 1 0 14.14"})]}),U4=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",fill:"currentColor",stroke:"none"}),c.jsx("path",{d:"M15.54 8.46a5 5 0 0 1 0 7.07"})]}),G4=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",fill:"currentColor",stroke:"none"}),c.jsx("line",{x1:"23",y1:"9",x2:"17",y2:"15"}),c.jsx("line",{x1:"17",y1:"9",x2:"23",y2:"15"})]}),dS=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("path",{d:"M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"}),c.jsx("path",{d:"M19 10v2a7 7 0 0 1-14 0v-2"}),c.jsx("line",{x1:"12",y1:"19",x2:"12",y2:"23"}),c.jsx("path",{d:"M16 22h-8"}),c.jsx("path",{d:"M3 6l2 2 2-2"}),c.jsx("path",{d:"M19 6l2 2 2-2"})]}),nv=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("path",{d:"M4 7h16"}),c.jsx("path",{d:"M4 12h12"}),c.jsx("path",{d:"M4 17h8"}),c.jsx("circle",{cx:"19",cy:"12",r:"3",fill:"currentColor",stroke:"none"}),c.jsx("path",{d:"M19 7v2",strokeWidth:"2.5",strokeLinecap:"round"}),c.jsx("path",{d:"M19 15v2",strokeWidth:"1.5",strokeLinecap:"round",opacity:"0.5"})]}),H4=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("path",{d:"M5 8l6 6"}),c.jsx("path",{d:"M4 14l6-6 2-3"}),c.jsx("path",{d:"M2 5h12"}),c.jsx("path",{d:"M7 2v3"}),c.jsx("path",{d:"M22 22l-5-10-5 10"}),c.jsx("path",{d:"M14 18h6"})]}),Sc=({size:n=24,className:e,...t})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,...t,children:c.jsx("path",{d:"M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78Z"})}),ic=({size:n=24,className:e,...t})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:c.jsx("path",{d:"M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78Z"})}),ql=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,...t,children:[c.jsx("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09L12 5.5V12l-3 3 3 4.5v1.85z"}),c.jsx("path",{d:"M12 5.5l.01-.41C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35V17l3-4.5-3-3V5.5z",opacity:"0.5"})]}),Zi=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),c.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]}),q4=Zi,K4=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,...t,children:[c.jsx("circle",{cx:"12",cy:"5",r:"2"}),c.jsx("circle",{cx:"12",cy:"12",r:"2"}),c.jsx("circle",{cx:"12",cy:"19",r:"2"})]}),YT=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("polyline",{points:"3 6 5 6 21 6"}),c.jsx("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}),c.jsx("line",{x1:"10",y1:"11",x2:"10",y2:"17"}),c.jsx("line",{x1:"14",y1:"11",x2:"14",y2:"17"})]}),xd=YT,Ir=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),c.jsx("polyline",{points:"7 10 12 15 17 10"}),c.jsx("line",{x1:"12",y1:"15",x2:"12",y2:"3"})]}),Q4=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),c.jsx("polyline",{points:"17 8 12 3 7 8"}),c.jsx("line",{x1:"12",y1:"3",x2:"12",y2:"15"})]}),ZT=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),c.jsx("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]}),sr=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("polyline",{points:"23 4 23 10 17 10"}),c.jsx("polyline",{points:"1 20 1 14 7 14"}),c.jsx("path",{d:"M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"})]}),JT=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("circle",{cx:"12",cy:"12",r:"10"}),c.jsx("line",{x1:"4.93",y1:"4.93",x2:"19.07",y2:"19.07"})]}),an=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),c.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]}),hS=an,Ji=({size:n=24,className:e,...t})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:c.jsx("polyline",{points:"20 6 9 17 4 12"})}),X4=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}),c.jsx("polyline",{points:"22 4 12 14.01 9 11.01"})]}),Y4=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("circle",{cx:"12",cy:"12",r:"10"}),c.jsx("line",{x1:"12",y1:"16",x2:"12",y2:"12"}),c.jsx("line",{x1:"12",y1:"8",x2:"12.01",y2:"8"})]}),e$=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("path",{d:"M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0Z"}),c.jsx("line",{x1:"12",y1:"9",x2:"12",y2:"13"}),c.jsx("line",{x1:"12",y1:"17",x2:"12.01",y2:"17"})]}),fS=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("line",{x1:"12",y1:"2",x2:"12",y2:"6"}),c.jsx("line",{x1:"12",y1:"18",x2:"12",y2:"22"}),c.jsx("line",{x1:"4.93",y1:"4.93",x2:"7.76",y2:"7.76"}),c.jsx("line",{x1:"16.24",y1:"16.24",x2:"19.07",y2:"19.07"}),c.jsx("line",{x1:"2",y1:"12",x2:"6",y2:"12"}),c.jsx("line",{x1:"18",y1:"12",x2:"22",y2:"12"}),c.jsx("line",{x1:"4.93",y1:"19.07",x2:"7.76",y2:"16.24"}),c.jsx("line",{x1:"16.24",y1:"7.76",x2:"19.07",y2:"4.93"})]}),Z4=({size:n=24,className:e,...t})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:c.jsx("path",{d:"M21 12a9 9 0 1 1-6.219-8.56"})}),J4=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("polyline",{points:"15 3 21 3 21 9"}),c.jsx("polyline",{points:"9 21 3 21 3 15"}),c.jsx("line",{x1:"21",y1:"3",x2:"14",y2:"10"}),c.jsx("line",{x1:"3",y1:"21",x2:"10",y2:"14"})]}),eO=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("polyline",{points:"4 14 10 14 10 20"}),c.jsx("polyline",{points:"20 10 14 10 14 4"}),c.jsx("line",{x1:"14",y1:"10",x2:"21",y2:"3"}),c.jsx("line",{x1:"3",y1:"21",x2:"10",y2:"14"})]}),Mm=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,...t,children:[c.jsx("circle",{cx:"9",cy:"6",r:"1.5"}),c.jsx("circle",{cx:"15",cy:"6",r:"1.5"}),c.jsx("circle",{cx:"9",cy:"12",r:"1.5"}),c.jsx("circle",{cx:"15",cy:"12",r:"1.5"}),c.jsx("circle",{cx:"9",cy:"18",r:"1.5"}),c.jsx("circle",{cx:"15",cy:"18",r:"1.5"})]}),eo=({size:n=24,className:e,...t})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:c.jsx("path",{d:"M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2Z"})}),tO=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("path",{d:"M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2Z"}),c.jsx("line",{x1:"12",y1:"11",x2:"12",y2:"17"}),c.jsx("line",{x1:"9",y1:"14",x2:"15",y2:"14"})]}),nO=({size:n=24,className:e,...t})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:c.jsx("path",{d:"M18.178 8c5.096 0 5.096 8 0 8-5.095 0-7.133-8-12.739-8-4.585 0-4.585 8 0 8 5.606 0 7.644-8 12.739-8z"})}),sO=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("line",{x1:"18",y1:"20",x2:"18",y2:"10"}),c.jsx("line",{x1:"12",y1:"20",x2:"12",y2:"4"}),c.jsx("line",{x1:"6",y1:"20",x2:"6",y2:"14"})]}),rO=({size:n=24,className:e,...t})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:c.jsx("polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"})}),iO=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("line",{x1:"4",y1:"6",x2:"16",y2:"6"}),c.jsx("line",{x1:"4",y1:"12",x2:"13",y2:"12"}),c.jsx("line",{x1:"4",y1:"18",x2:"10",y2:"18"}),c.jsx("polyline",{points:"17 9 20 12 17 15"})]}),oO=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("rect",{x:"2",y:"3",width:"20",height:"14",rx:"2",ry:"2"}),c.jsx("line",{x1:"8",y1:"21",x2:"16",y2:"21"}),c.jsx("line",{x1:"12",y1:"17",x2:"12",y2:"21"})]}),aO=oO,pS=({size:n=24,className:e,...t})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:c.jsx("path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10Z"})}),lO=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("ellipse",{cx:"12",cy:"5",rx:"9",ry:"3"}),c.jsx("path",{d:"M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"}),c.jsx("path",{d:"M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"})]}),cO=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("circle",{cx:"12",cy:"12",r:"10"}),c.jsx("line",{x1:"2",y1:"12",x2:"22",y2:"12"}),c.jsx("path",{d:"M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10Z"})]}),t$=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("circle",{cx:"12",cy:"12",r:"5"}),c.jsx("line",{x1:"12",y1:"1",x2:"12",y2:"3"}),c.jsx("line",{x1:"12",y1:"21",x2:"12",y2:"23"}),c.jsx("line",{x1:"4.22",y1:"4.22",x2:"5.64",y2:"5.64"}),c.jsx("line",{x1:"18.36",y1:"18.36",x2:"19.78",y2:"19.78"}),c.jsx("line",{x1:"1",y1:"12",x2:"3",y2:"12"}),c.jsx("line",{x1:"21",y1:"12",x2:"23",y2:"12"}),c.jsx("line",{x1:"4.22",y1:"19.78",x2:"5.64",y2:"18.36"}),c.jsx("line",{x1:"18.36",y1:"5.64",x2:"19.78",y2:"4.22"})]}),n$=({size:n=24,className:e,...t})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:c.jsx("path",{d:"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79Z"})}),mS=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("circle",{cx:"13.5",cy:"6.5",r:"1.5"}),c.jsx("circle",{cx:"17.5",cy:"10.5",r:"1.5"}),c.jsx("circle",{cx:"8.5",cy:"7.5",r:"1.5"}),c.jsx("circle",{cx:"6.5",cy:"12.5",r:"1.5"}),c.jsx("path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.555C21.965 6.012 17.461 2 12 2Z"})]}),Qi=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("path",{d:"M12 2v4"}),c.jsx("path",{d:"M12 18v4"}),c.jsx("path",{d:"M4.93 4.93l2.83 2.83"}),c.jsx("path",{d:"M16.24 16.24l2.83 2.83"}),c.jsx("path",{d:"M2 12h4"}),c.jsx("path",{d:"M18 12h4"}),c.jsx("path",{d:"M4.93 19.07l2.83-2.83"}),c.jsx("path",{d:"M16.24 7.76l2.83-2.83"})]}),s$=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("rect",{x:"2",y:"3",width:"20",height:"14",rx:"2",ry:"2"}),c.jsx("line",{x1:"8",y1:"21",x2:"16",y2:"21"}),c.jsx("line",{x1:"12",y1:"17",x2:"12",y2:"21"})]}),uO=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("path",{d:"M4 19.5A2.5 2.5 0 0 1 6.5 17H20"}),c.jsx("path",{d:"M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2Z"}),c.jsx("circle",{cx:"12",cy:"10",r:"2"}),c.jsx("path",{d:"M12 12v3"})]}),dO=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("circle",{cx:"12",cy:"12",r:"10"}),c.jsx("polygon",{points:"10 8 16 12 10 16 10 8",fill:"currentColor"})]}),u0=({size:n=24,className:e,...t})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,...t,children:c.jsx("path",{d:"M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z"})});function hO(n=""){const e=["linear-gradient(135deg, #667eea 0%, #764ba2 100%)","linear-gradient(135deg, #f093fb 0%, #f5576c 100%)","linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)","linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)","linear-gradient(135deg, #fa709a 0%, #fee140 100%)","linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)","linear-gradient(135deg, #5ee7df 0%, #b490ca 100%)","linear-gradient(135deg, #d299c2 0%, #fef9d7 100%)","linear-gradient(135deg, #f5af19 0%, #f12711 100%)","linear-gradient(135deg, #667eea 0%, #764ba2 100%)"];let t=0;for(let s=0;s<n.length;s++)t=n.charCodeAt(s)+((t<<5)-t);return e[Math.abs(t)%e.length]}function fO(n,e=4){var r,i,o;const t=new Set,s=[];for(const a of n){const l=((r=a.artwork)==null?void 0:r.medium)??((o=(i=a.album)==null?void 0:i.artwork)==null?void 0:o.medium);if(l!==void 0&&!t.has(l)&&(t.add(l),s.push(l),s.length>=e))break}return s}const pO={xs:"playlist-cover-xs",sm:"playlist-cover-sm",md:"playlist-cover-md",lg:"playlist-cover-lg",xl:"playlist-cover-xl"},r$=({tracks:n,name:e="",size:t="md",className:s=""})=>{const r=j.useMemo(()=>fO(n,4),[n]),i=j.useMemo(()=>hO(e),[e]),a=`playlist-cover ${pO[t]} ${s}`;if(r.length===0){const l=t==="xs"?12:t==="sm"?24:t==="md"?32:t==="lg"?48:64;return c.jsx("div",{className:`${a} playlist-cover-gradient`,style:{background:i},children:c.jsx(qe,{size:l})})}return r.length===1?c.jsx("div",{className:`${a} playlist-cover-single`,children:c.jsx("img",{src:r[0],alt:e,loading:"lazy"})}):r.length===2?c.jsxs("div",{className:`${a} playlist-cover-duo`,children:[c.jsx("img",{src:r[0],alt:"",loading:"lazy"}),c.jsx("img",{src:r[1],alt:"",loading:"lazy"})]}):r.length===3?c.jsxs("div",{className:`${a} playlist-cover-trio`,children:[c.jsx("img",{src:r[0],alt:"",loading:"lazy",className:"playlist-cover-main"}),c.jsxs("div",{className:"playlist-cover-side",children:[c.jsx("img",{src:r[1],alt:"",loading:"lazy"}),c.jsx("img",{src:r[2],alt:"",loading:"lazy"})]})]}):c.jsx("div",{className:`${a} playlist-cover-mosaic`,children:r.map((l,u)=>c.jsx("img",{src:l,alt:"",loading:"lazy"},u))})},sv=({title:n,placeholder:e="Enter name...",submitLabel:t="Create",initialValue:s="",onSubmit:r,onClose:i,icon:o})=>{const[a,l]=j.useState(s),u=j.useRef(null),d=j.useRef(null);j.useEffect(()=>{var g;(g=u.current)==null||g.focus()},[]),j.useEffect(()=>{const g=y=>{y.key==="Escape"&&i()},x=y=>{d.current&&!d.current.contains(y.target)&&i()};return document.addEventListener("keydown",g),document.addEventListener("mousedown",x),()=>{document.removeEventListener("keydown",g),document.removeEventListener("mousedown",x)}},[i]);const f=()=>{a.trim()&&(r(a.trim()),i())},p=g=>{g.key==="Enter"&&a.trim()&&f()};return c.jsx("div",{className:"modal-overlay",children:c.jsxs("div",{className:"modal modal-small",ref:d,children:[c.jsxs("header",{className:"modal-header",children:[o&&c.jsx("span",{className:"modal-header-icon",children:o}),c.jsx("h2",{children:n}),c.jsx("button",{className:"modal-close",onClick:i,children:c.jsx(an,{size:20})})]}),c.jsxs("div",{className:"modal-content",children:[c.jsx("input",{ref:u,type:"text",className:"modal-input",placeholder:e,value:a,onChange:g=>l(g.target.value),onKeyDown:p}),c.jsxs("div",{className:"modal-actions",children:[c.jsx("button",{className:"modal-button secondary",onClick:i,children:"Cancel"}),c.jsx("button",{className:"modal-button primary",onClick:f,disabled:!a.trim(),children:t})]})]})]})})},Ui=({icon:n,label:e,isActive:t,onClick:s,badge:r,isCollapsed:i})=>c.jsxs("button",{className:`sidebar-nav-item ${t?"active":""}`,onClick:s,title:i?e:void 0,children:[c.jsx("span",{className:"sidebar-nav-icon",children:n}),!i&&c.jsx("span",{className:"sidebar-nav-label",children:e}),!i&&r!==void 0&&r>0&&c.jsx("span",{className:"sidebar-nav-badge",children:r>99?"99+":r}),i&&r!==void 0&&r>0&&c.jsx("span",{className:"sidebar-nav-badge-dot"})]}),gS=({playlist:n,isActive:e,isCollapsed:t,isDragOverlay:s=!1})=>{const{attributes:r,listeners:i,setNodeRef:o,transform:a,transition:l,isDragging:u}=Rm({id:`playlist-${n.id}`,data:{type:"playlist",item:n}}),d={transform:ei.Transform.toString(a),transition:l,opacity:u&&!s?.3:1},f=()=>{Wt.getState().openPlaylist(n.id)};return c.jsx("div",{ref:o,style:d,...r,children:c.jsxs("button",{className:`sidebar-playlist-item ${e?"active":""} ${u?"dragging":""}`,onClick:f,title:t?n.name:void 0,children:[!t&&c.jsx("span",{className:"sidebar-drag-handle",...i,children:c.jsx(Mm,{size:12})}),c.jsx(r$,{tracks:n.tracks,name:n.name,size:"xs",className:"sidebar-playlist-cover"}),!t&&c.jsxs(c.Fragment,{children:[c.jsx("span",{className:"sidebar-playlist-name",children:n.name}),c.jsx("span",{className:"sidebar-playlist-count",children:n.tracks.length})]})]})})},mO=({folder:n,children:e,isCollapsed:t,isOver:s=!1})=>{const{toggleFolderExpanded:r}=Xt(),{attributes:i,listeners:o,setNodeRef:a,transform:l,transition:u,isDragging:d}=Rm({id:`folder-${n.id}`,data:{type:"folder",item:n}}),f={transform:ei.Transform.toString(l),transition:u,opacity:d?.3:1};return c.jsxs("div",{ref:a,style:f,...i,children:[c.jsxs("div",{className:`sidebar-folder ${s?"drop-target":""} ${d?"dragging":""}`,children:[!t&&c.jsx("span",{className:"sidebar-drag-handle",...o,children:c.jsx(Mm,{size:12})}),c.jsx("button",{className:`sidebar-folder-toggle ${n.isExpanded?"expanded":""}`,onClick:p=>{p.stopPropagation(),r(n.id)},title:n.isExpanded?"Collapse folder":"Expand folder",children:c.jsx(Yi,{size:14})}),c.jsx("span",{className:"sidebar-folder-icon",children:c.jsx(eo,{size:16})}),!t&&c.jsx("span",{className:"sidebar-folder-name",children:n.name})]}),n.isExpanded&&c.jsx("div",{className:"sidebar-folder-children",children:e})]})};function i$(n,e,t=null){const s=[],r=n.filter(o=>o.parentId===t).sort((o,a)=>o.order-a.order),i=e.filter(o=>o.folderId===t).sort((o,a)=>o.order-a.order);for(const o of r)s.push({id:`folder-${o.id}`,type:"folder",data:o,children:i$(n,e,o.id)});for(const o of i)s.push({id:`playlist-${o.id}`,type:"playlist",data:o});return s}function o$(n){const e=[];for(const t of n)e.push(t.id),t.children&&e.push(...o$(t.children));return e}const gO=()=>{const{currentView:n,navigate:e,selectedPlaylistId:t}=Wt(),{likedTracks:s,dislikedTracks:r,playlists:i,folders:o,downloads:a,createPlaylist:l,createFolder:u,movePlaylistToFolder:d,moveFolderToFolder:f,reorderSidebarItems:p}=Xt(),{plugins:g}=ii(),{isSidebarCollapsed:x,toggleSidebar:y,sidebarWidth:b,setSidebarWidth:k,isPlaylistsExpanded:w,togglePlaylistsExpanded:N,isCreatePlaylistModalOpen:C,isCreateFolderModalOpen:S,openCreatePlaylistModal:T,closeCreatePlaylistModal:A,openCreateFolderModal:E,closeCreateFolderModal:M}=el(),P=qT(),[R,L]=j.useState(null),[_,O]=j.useState(null),U=j.useRef({isDragging:!1,startX:0,startWidth:260}),[W,H]=j.useState(!1),G=a.filter(ue=>ue.status!=="completed").length,q=g.filter(ue=>ue.enabled).length,Q=P.getNavItemsBySection("tools"),z=j.useMemo(()=>i$(o,i),[o,i]),K=j.useMemo(()=>o$(z),[z]),Y=ib(sc(pd,{activationConstraint:{distance:8}}),sc(fd,{coordinateGetter:pb})),B=j.useCallback(ue=>{L(ue.active.id)},[]),J=j.useCallback(ue=>{const Te=ue.over;O(Te?Te.id:null)},[]),ae=j.useCallback(ue=>{const{active:Te,over:ke}=ue;if(L(null),O(null),!ke||Te.id===ke.id)return;const ye=Te.data.current,Ce=ke.data.current;if(!ye||!Ce)return;const Ae=ye.type,Be=Ce.type;if(Be==="folder"){const mt=Ce.item.id;if(Ae==="playlist"){const le=ye.item.id;d(le,mt)}else if(Ae==="folder"){const le=ye.item.id;le!==mt&&f(le,mt)}}else{const mt=Ce.item;let le=null;Be==="playlist"?le=mt.folderId:le=mt.parentId;const je=o.filter(ut=>ut.parentId===le),De=i.filter(ut=>ut.folderId===le),_e=[...je.map(ut=>({id:ut.id,type:"folder",order:ut.order})),...De.map(ut=>({id:ut.id,type:"playlist",order:ut.order}))].sort((ut,yn)=>ut.order-yn.order),it=ye.item.id,St=Ce.item.id,cn=_e.findIndex(ut=>ut.id===it),Ut=_e.findIndex(ut=>ut.id===St);if(cn!==-1&&Ut!==-1&&cn!==Ut){const yn=_e.splice(cn,1)[0];if(!yn)return;_e.splice(Ut,0,yn);const Zn=_e.map((Yt,Dr)=>({id:Yt.id,type:Yt.type,order:Dr,parentId:le}));p(Zn)}}},[o,i,d,f,p]),pe=j.useCallback(ue=>{if(x)return;ue.preventDefault(),U.current={isDragging:!0,startX:ue.clientX,startWidth:b},H(!0);const Te=ye=>{if(!U.current.isDragging)return;const Ce=ye.clientX-U.current.startX,Ae=U.current.startWidth+Ce;k(Ae)},ke=()=>{U.current.isDragging=!1,H(!1),document.removeEventListener("mousemove",Te),document.removeEventListener("mouseup",ke),document.body.style.cursor="",document.body.style.userSelect=""};document.addEventListener("mousemove",Te),document.addEventListener("mouseup",ke),document.body.style.cursor="col-resize",document.body.style.userSelect="none"},[x,b,k]),ge=j.useCallback(ue=>{l(ue)},[l]),he=j.useCallback(ue=>{u(ue)},[u]),we=j.useCallback(ue=>ue.map(Te=>{if(Te.type==="folder"){const ke=Te.data;return c.jsx(mO,{folder:ke,isCollapsed:x,isOver:_===Te.id,children:Te.children&&we(Te.children)},Te.id)}else{const ke=Te.data,ye=n==="playlist-detail"&&t===ke.id;return c.jsx(gS,{playlist:ke,isActive:ye,isCollapsed:x},Te.id)}}),[n,t,x,_]),Pe=j.useMemo(()=>{if(!R)return null;const ue=Te=>{for(const ke of Te){if(ke.id===R)return ke;if(ke.children){const ye=ue(ke.children);if(ye)return ye}}return null};return ue(z)},[R,z]);return c.jsxs("aside",{className:`sidebar ${x?"collapsed":""}`,style:x?void 0:{width:b},children:[c.jsxs("div",{className:"sidebar-logo",children:[c.jsx("span",{className:"sidebar-logo-icon",children:c.jsx(B4,{size:20})}),!x&&c.jsx("span",{className:"sidebar-logo-text",children:"audiio"}),c.jsx("button",{className:"sidebar-collapse-btn",onClick:y,title:x?"Expand sidebar":"Collapse sidebar",children:x?c.jsx(Yi,{size:16}):c.jsx(gb,{size:16})})]}),c.jsxs("nav",{className:"sidebar-nav",children:[c.jsx("div",{className:"sidebar-section",children:c.jsx(Ui,{icon:c.jsx(tv,{size:20}),label:"Discover",view:"home",isActive:n==="home",onClick:()=>e("home"),isCollapsed:x})}),c.jsxs("div",{className:"sidebar-section",children:[!x&&c.jsx("div",{className:"sidebar-section-header",children:"Your Library"}),c.jsx(Ui,{icon:c.jsx(Sc,{size:20}),label:"Liked Songs",view:"likes",isActive:n==="likes",onClick:()=>e("likes"),badge:s.length,isCollapsed:x}),c.jsx(Ui,{icon:c.jsx(ql,{size:20}),label:"Disliked Songs",view:"dislikes",isActive:n==="dislikes",onClick:()=>e("dislikes"),badge:r.length,isCollapsed:x}),c.jsx(Ui,{icon:c.jsx(yi,{size:20}),label:"Playlists",view:"playlists",isActive:n==="playlists"||n==="playlist-detail",onClick:()=>e("playlists"),badge:i.length,isCollapsed:x}),c.jsx(Ui,{icon:c.jsx(Ir,{size:20}),label:"Downloads",view:"downloads",isActive:n==="downloads",onClick:()=>e("downloads"),badge:G,isCollapsed:x}),c.jsx(Ui,{icon:c.jsx(sO,{size:20}),label:"Stats",view:"stats",isActive:n==="stats",onClick:()=>e("stats"),isCollapsed:x})]}),Q.length>0&&c.jsxs("div",{className:"sidebar-section",children:[!x&&c.jsx("div",{className:"sidebar-section-header",children:"Tools"}),Q.map(ue=>{const Te=ue.icon,ke=`plugin-view-${ue.viewId}`;return c.jsx(Ui,{icon:c.jsx(Te,{size:20}),label:ue.label,view:ke,isActive:n===ke,onClick:()=>e(ke),isCollapsed:x},ue.viewId)})]}),c.jsxs("div",{className:"sidebar-section",children:[!x&&c.jsx("div",{className:"sidebar-section-header",children:"Settings"}),c.jsx(Ui,{icon:c.jsx(Qi,{size:20}),label:"Plugins",view:"plugins",isActive:n==="plugins"||n==="plugin-detail",onClick:()=>e("plugins"),badge:q,isCollapsed:x}),c.jsx(Ui,{icon:c.jsx(Pm,{size:20}),label:"Settings",view:"settings",isActive:n==="settings",onClick:()=>e("settings"),isCollapsed:x})]})]}),c.jsxs("div",{className:`sidebar-playlists ${w?"expanded":"collapsed"}`,children:[!x&&c.jsxs("div",{className:"sidebar-playlists-header",children:[c.jsxs("button",{className:"sidebar-playlists-toggle",onClick:N,title:w?"Collapse playlists":"Expand playlists",children:[w?c.jsx(Fa,{size:16}):c.jsx(Yi,{size:16}),c.jsx("span",{children:"Playlists"}),c.jsx("span",{className:"sidebar-playlists-count",children:i.length})]}),c.jsx("button",{className:"sidebar-add-button",onClick:T,title:"Create Playlist",children:c.jsx(Zi,{size:18})})]}),w&&c.jsxs(c.Fragment,{children:[c.jsxs(ub,{sensors:Y,collisionDetection:ob,onDragStart:B,onDragOver:J,onDragEnd:ae,children:[c.jsx(fb,{items:K,strategy:hb,children:c.jsx("div",{className:"sidebar-playlist-list",children:z.length===0&&!x?c.jsx("div",{className:"sidebar-empty",children:"No playlists yet"}):we(z)})}),c.jsx(x4,{children:Pe&&Pe.type==="playlist"&&c.jsx(gS,{playlist:Pe.data,isActive:!1,isCollapsed:x,isDragOverlay:!0})})]}),!x&&c.jsxs("button",{className:"sidebar-add-folder-button",onClick:E,title:"Create Folder",children:[c.jsx(tO,{size:14}),c.jsx("span",{children:"New Folder"})]})]})]}),C&&c.jsx(sv,{title:"Create Playlist",placeholder:"Playlist name",submitLabel:"Create",onSubmit:ge,onClose:A,icon:c.jsx(yi,{size:20})}),S&&c.jsx(sv,{title:"Create Folder",placeholder:"Folder name",submitLabel:"Create",onSubmit:he,onClose:M,icon:c.jsx(eo,{size:20})}),!x&&c.jsx("div",{className:`sidebar-resize-handle ${W?"dragging":""}`,onMouseDown:pe})]})},xO={week:10080*60*1e3,month:720*60*60*1e3,year:365*24*60*60*1e3,all:1/0};function yO(n,e){const t=Date.now(),s=e==="all"?0:t-xO[e],r=n.filter(P=>P.timestamp>=s),i=new Map;for(const P of r){const R=i.get(P.artistId);R?(R.playCount++,R.totalDuration+=P.duration,R.lastPlayed=Math.max(R.lastPlayed,P.timestamp)):i.set(P.artistId,{artistId:P.artistId,artistName:P.artistName,playCount:1,totalDuration:P.duration,lastPlayed:P.timestamp})}const o=new Map;for(const P of r){if(!P.genre)continue;const R=o.get(P.genre);R?(R.playCount++,R.totalDuration+=P.duration):o.set(P.genre,{genre:P.genre,playCount:1,totalDuration:P.duration})}const a=new Map,l=new Map,u=new Map;for(const P of r){const R=new Date(P.timestamp).toISOString().split("T")[0],L=a.get(R);l.has(R)||l.set(R,new Set),u.has(R)||u.set(R,new Set),l.get(R).add(P.trackId),u.get(R).add(P.artistId),L?(L.playCount++,L.totalDuration+=P.duration,L.uniqueTracks=l.get(R).size,L.uniqueArtists=u.get(R).size):a.set(R,{date:R,playCount:1,totalDuration:P.duration,uniqueTracks:1,uniqueArtists:1})}const d=Array.from({length:24},(P,R)=>({hour:R,playCount:0}));for(const P of r){const R=new Date(P.timestamp).getHours();d[R].playCount++}const f=Array.from({length:7},(P,R)=>({day:R,playCount:0}));for(const P of r){const R=new Date(P.timestamp).getDay();f[R].playCount++}const p=Array.from(a.keys()).sort();let g=0,x=0,y=0;const b=new Date().toISOString().split("T")[0],k=new Date(Date.now()-1440*60*1e3).toISOString().split("T")[0],w=p[p.length-1],N=w===b||w===k;for(let P=0;P<p.length;P++){if(P===0)y=1;else{const R=new Date(p[P-1]),L=new Date(p[P]);Math.round((L.getTime()-R.getTime())/(1440*60*1e3))===1?y++:y=1}x=Math.max(x,y),p[P]===w&&N&&(g=y)}const C=new Set(r.map(P=>P.trackId)).size,S=i.size,T=r.reduce((P,R)=>P+R.duration,0),A=Array.from(i.values()).sort((P,R)=>R.playCount-P.playCount).slice(0,10),E=Array.from(o.values()).sort((P,R)=>R.playCount-P.playCount).slice(0,10),M=Array.from(a.values()).sort((P,R)=>P.date.localeCompare(R.date)).slice(-30);return{period:e,totalListenTime:T,totalTracks:r.length,uniqueTracks:C,uniqueArtists:S,topArtists:A,topGenres:E,dailyStats:M,hourlyDistribution:d,dayOfWeekDistribution:f,currentStreak:g,longestStreak:x}}const a$=An()(Er((n,e)=>({listenHistory:[],cachedStats:{},cacheTimestamp:0,recordListen:(t,s,r)=>{var o,a;const i={trackId:t.id,artistId:((o=t.artists[0])==null?void 0:o.id)||"unknown",artistName:((a=t.artists[0])==null?void 0:a.name)||"Unknown Artist",genre:t.genre||"Unknown",duration:s,timestamp:Date.now(),completed:r};n(l=>({listenHistory:[...l.listenHistory,i].slice(-5e3),cachedStats:{},cacheTimestamp:0}))},getStats:t=>{const s=e();if(Date.now()-s.cacheTimestamp<300*1e3&&s.cachedStats[t])return s.cachedStats[t];const i=yO(s.listenHistory,t);return n(o=>({cachedStats:{...o.cachedStats,[t]:i},cacheTimestamp:Date.now()})),i},clearHistory:()=>{n({listenHistory:[],cachedStats:{},cacheTimestamp:0})}}),{name:"audiio-stats",partialize:n=>({listenHistory:n.listenHistory})}));function l$(n){const e=Math.floor(n/3600),t=Math.floor(n%3600/60);return e>0?`${e}h ${t}m`:`${t}m`}const rv=[{value:"not_my_taste",label:"Not my taste"},{value:"heard_too_much",label:"Heard it too much"},{value:"bad_audio_quality",label:"Bad audio quality"},{value:"wrong_mood",label:"Wrong mood/vibe"},{value:"dont_like_artist",label:"Don't like this artist"},{value:"too_long",label:"Too long"},{value:"too_short",label:"Too short"},{value:"explicit_content",label:"Explicit content"},{value:"other",label:"Other reason"}],vO={ambient:10,sleep:5,meditation:5,"new age":15,classical:20,drone:10,lofi:25,"lo-fi":25,chill:30,jazz:35,acoustic:30,folk:35,soul:40,"r&b":40,blues:35,ballad:25,pop:55,indie:50,alternative:50,rock:55,country:45,reggae:45,funk:55,disco:60,"hip hop":65,"hip-hop":65,rap:70,electronic:70,dance:75,house:70,techno:75,punk:75,metal:80,edm:85,dubstep:85,"drum and bass":90,dnb:90,hardcore:95,hardstyle:95,workout:90,party:85},ms={COMPLETED_LISTEN:10,DISLIKE_BASE:-20,DISLIKE_REASON_MULTIPLIERS:{not_my_taste:1.5,heard_too_much:.5,bad_audio_quality:.3,wrong_mood:.3,dont_like_artist:2,too_long:.5,too_short:.5,explicit_content:1,other:1},SKIP:-5,ARTIST_SIMILARITY:40,GENRE_SIMILARITY:30,DURATION_SIMILARITY:10,TEMPORAL_MATCH:20,MIN_LISTENS_FOR_PATTERN:5};function ka(n){return Math.max(-100,Math.min(100,n))}function d0(){return new Date().getHours()}function bO(n){return(Date.now()-n)/(1e3*60*60*24)}function wO(n,e,t){return n*Math.pow(t,e)}function Pl(n){return n.genres&&n.genres.length>0?n.genres:[]}function Xf(n){return!n.artists||!Array.isArray(n.artists)?[]:n.artists.filter(e=>e&&e.name).map(e=>({id:e.id||e.name.toLowerCase().replace(/\s+/g,"-"),name:e.name}))}function iv(n){const e=n.genres||[];let t=50,s=0;for(const l of e){const u=l.toLowerCase();for(const[d,f]of Object.entries(vO))if(u.includes(d)||d.includes(u)){t+=f,s++;break}}const r=s>0?Math.round(t/(s+1)):50;let i;r<=20?i="very-low":r<=40?i="low":r<=60?i="medium":r<=80?i="high":i="very-high";let o;r<=15?o="calm":r<=35?o="chill":r<=55?o="neutral":r<=75?o="upbeat":r<=90?o="energetic":o="intense";const a=r>50?Math.min(r+10,100):Math.max(r-10,0);return{energy:r,energyLevel:i,mood:o,valence:a}}const xS={artistPreferences:{},genrePreferences:{},timePatterns:Array.from({length:24},(n,e)=>({hour:e,genres:{},energy:"medium"})),avgSessionLength:0,preferredDuration:{min:12e4,max:3e5},totalListens:0,totalListenTime:0,uniqueArtists:0,uniqueTracks:0},dn=An()(Er((n,e)=>({listenHistory:[],dislikedTracks:{},userProfile:xS,lastUpdated:Date.now(),recordListen:(t,s,r,i)=>{const o={trackId:t.id,timestamp:Date.now(),duration:s,totalDuration:t.duration,completed:r,skipped:i};a$.getState().recordListen(t,Math.round(s/1e3),r),n(a=>{const l=[o,...a.listenHistory].slice(0,1e3),u={...a.userProfile.artistPreferences};for(const x of Xf(t)){const y=u[x.id]||{artistId:x.id,artistName:x.name,score:0,playCount:0,totalListenTime:0,likeCount:0,dislikeCount:0};let b=0;r&&(b+=ms.COMPLETED_LISTEN),i&&(b+=ms.SKIP),u[x.id]={...y,score:ka(y.score+b),playCount:y.playCount+1,totalListenTime:y.totalListenTime+s}}const d={...a.userProfile.genrePreferences};for(const x of Pl(t)){const y=d[x]||{genre:x,score:0,playCount:0,likeCount:0,dislikeCount:0};let b=0;r&&(b+=ms.COMPLETED_LISTEN*.5),i&&(b+=ms.SKIP*.5),d[x]={...y,score:ka(y.score+b),playCount:y.playCount+1}}const f=d0(),p=[...a.userProfile.timePatterns],g=p[f];for(const x of Pl(t))g.genres[x]=(g.genres[x]||0)+1;return{listenHistory:l,userProfile:{...a.userProfile,artistPreferences:u,genrePreferences:d,timePatterns:p,totalListens:a.userProfile.totalListens+1,totalListenTime:a.userProfile.totalListenTime+s},lastUpdated:Date.now()}})},recordDislike:(t,s)=>{n(r=>{const i={trackId:t.id,reasons:s,timestamp:Date.now(),track:t,trackData:{title:t.title,artists:t.artists.map(u=>u.name),genres:Pl(t)}},o={...r.userProfile.artistPreferences},a=s.includes("dont_like_artist");for(const u of Xf(t)){const d=o[u.id]||{artistId:u.id,artistName:u.name,score:0,playCount:0,totalListenTime:0,likeCount:0,dislikeCount:0};let f=ms.DISLIKE_BASE;for(const p of s)f*=ms.DISLIKE_REASON_MULTIPLIERS[p]||1;a&&(f*=1.5),o[u.id]={...d,score:ka(d.score+f),dislikeCount:d.dislikeCount+1}}const l={...r.userProfile.genrePreferences};for(const u of Pl(t)){const d=l[u]||{genre:u,score:0,playCount:0,likeCount:0,dislikeCount:0};l[u]={...d,score:ka(d.score+ms.DISLIKE_BASE*.3),dislikeCount:d.dislikeCount+1}}return{dislikedTracks:{...r.dislikedTracks,[t.id]:i},userProfile:{...r.userProfile,artistPreferences:o,genrePreferences:l},lastUpdated:Date.now()}})},recordSkip:(t,s)=>{const r=s.earlySkip?ms.SKIP*1.5:ms.SKIP;n(i=>({listenHistory:[{trackId:t,timestamp:Date.now(),duration:s.skipPosition*1e3,totalDuration:s.skipPosition/s.skipPercentage*1e3,completed:!1,skipped:!0},...i.listenHistory].slice(0,1e3),lastUpdated:Date.now()})),console.debug("[RecommendationStore] Recorded skip:",{trackId:t,skipPercentage:`${(s.skipPercentage*100).toFixed(1)}%`,earlySkip:s.earlySkip,penalty:r})},recordReorder:(t,s,r)=>{const i=s-r,o=i>0,a=Math.min(Math.abs(i)*2,15);n(l=>{const u={...l.userProfile.artistPreferences},d={...l.userProfile.genrePreferences};for(const f of Xf(t)){const p=u[f.id]||{artistId:f.id,artistName:f.name,score:0,playCount:0,totalListenTime:0,likeCount:0,dislikeCount:0},g=o?a:-a*.3;u[f.id]={...p,score:ka(p.score+g)}}for(const f of Pl(t)){const p=d[f]||{genre:f,score:0,playCount:0,likeCount:0,dislikeCount:0},g=o?a*.5:-a*.15;d[f]={...p,score:ka(p.score+g)}}return{userProfile:{...l.userProfile,artistPreferences:u,genrePreferences:d},lastUpdated:Date.now()}})},removeDislike:t=>{n(s=>{const{[t]:r,...i}=s.dislikedTracks;return{dislikedTracks:i}})},isDisliked:t=>t in e().dislikedTracks,getDislikeReasons:t=>{const s=e().dislikedTracks[t];return s?s.reasons:null},calculateTrackScore:(t,s={})=>{const r=e(),{userProfile:i,dislikedTracks:o,listenHistory:a}=r,l=s.hour??d0();if(o[t.id]){const y=o[t.id];let b=ms.DISLIKE_BASE;for(const w of y.reasons)b*=ms.DISLIKE_REASON_MULTIPLIERS[w]||1;const k=bO(y.timestamp);return b=wO(b,k,.99),b}let u=50;const d=Xf(t);for(const y of d){const b=i.artistPreferences[y.id];b&&(u+=b.score/100*ms.ARTIST_SIMILARITY)}const f=Pl(t);for(const y of f){const b=i.genrePreferences[y];b&&(u+=b.score/100*ms.GENRE_SIMILARITY)}const p=i.timePatterns[l];if(p&&Object.keys(p.genres).length>0){const y=Object.values(p.genres).reduce((b,k)=>b+k,0);for(const b of f){const w=(p.genres[b]||0)/y;u+=w*ms.TEMPORAL_MATCH}}const{preferredDuration:g}=i;t.duration>=g.min&&t.duration<=g.max&&(u+=ms.DURATION_SIMILARITY);const x=a.filter(y=>y.trackId===t.id).slice(0,5);for(const y of x){const b=(Date.now()-y.timestamp)/36e5;b<1?u-=20:b<24?u-=10:b<72&&(u-=5)}return x.length===0&&(u+=5),ka(u)},getRecommendedTracks:(t,s=20,r={})=>{const i=e(),{calculateTrackScore:o,dislikedTracks:a}=i,u=t.filter(d=>!a[d.id]).map(d=>({track:d,score:o(d,r)}));return u.sort((d,f)=>f.score-d.score),u.slice(0,s).map(d=>d.track)},getMLEnhancedRecommendations:(t,s=20,r={})=>{const{useMLStore:i}=require("./ml-store");return i.getState().getHybridRecommendations(t,s,r.hour)},getTopGenres:(t=5)=>{const{genrePreferences:s}=e().userProfile;return Object.values(s).filter(r=>r.playCount>0).sort((r,i)=>i.score-r.score).slice(0,t).map(r=>r.genre)},getTopArtists:(t=5)=>{const{artistPreferences:s}=e().userProfile;return Object.values(s).filter(r=>r.playCount>0).sort((r,i)=>i.score-r.score).slice(0,t).map(r=>r.artistName)},getPersonalizedQueries:()=>{const t=e(),s=t.getTopGenres(3),r=t.getTopArtists(3),i=d0(),o=[];let a="",l="";return i>=6&&i<12?(a="upbeat energizing",l="Morning Energy"):i>=12&&i<18?(a="popular trending",l="Afternoon Vibes"):i>=18&&i<22?(a="chill relaxing",l="Evening Wind Down"):(a="ambient calm lofi",l="Night Mode"),o.push({id:"mood-time",title:l,query:`${a} ${s[0]||"music"}`}),s.length>0&&o.push({id:"top-genre",title:`More ${s[0]}`,query:`${s[0]} best 2024`}),r.length>0&&(o.push({id:"top-artist",title:`Because you like ${r[0]}`,query:`${r[0]} similar artists`}),o.push({id:"artist-mix",title:`${r[0]} Radio`,query:`${r[0]}`})),s.length>=2&&o.push({id:"genre-mix",title:`${s[0]} x ${s[1]}`,query:`${s[0]} ${s[1]}`}),r.length>=2&&o.push({id:"discover-artist",title:`Discover: ${r[1]}`,query:`${r[1]} discography`}),o.length<4&&o.push({id:"trending",title:"Trending Now",query:"top hits 2024"},{id:"chill",title:"Chill Vibes",query:"chill lofi beats"}),o.slice(0,6)},sortTracksByEnergy:(t,s="asc")=>[...t].sort((r,i)=>{const o=iv(r),a=iv(i);return s==="asc"?o.energy-a.energy:a.energy-o.energy}),updateUserProfile:()=>{const t=e(),{listenHistory:s,userProfile:r}=t,i=s.filter(o=>o.completed).map(o=>o.totalDuration);if(i.length>=ms.MIN_LISTENS_FOR_PATTERN){i.sort((l,u)=>l-u);const o=i[Math.floor(i.length*.25)]||12e4,a=i[Math.floor(i.length*.75)]||3e5;n({userProfile:{...r,preferredDuration:{min:o,max:a},uniqueTracks:new Set(s.map(l=>l.trackId)).size}})}},clearHistory:()=>{n({listenHistory:[],dislikedTracks:{},userProfile:xS,lastUpdated:Date.now()})},exportData:()=>{const t=e();return{listenHistory:t.listenHistory,dislikedTracks:t.dislikedTracks,userProfile:t.userProfile,exportedAt:new Date().toISOString()}},getArtistHistory:()=>{const t=e(),s=new Set;return Object.keys(t.userProfile.artistPreferences).forEach(r=>{s.add(r.toLowerCase())}),t.listenHistory.forEach(r=>{r.artistId&&s.add(r.artistId.toLowerCase())}),s},getGenreHistory:()=>{const t=e(),s=new Set;return Object.keys(t.userProfile.genrePreferences).forEach(r=>{s.add(r.toLowerCase())}),t.userProfile.timePatterns.forEach(r=>{Object.keys(r.genres).forEach(i=>{s.add(i.toLowerCase())})}),s},getTimePatternsForScoring:()=>{const t=e(),s=new Map;for(let r=0;r<24;r++)s.set(r,{genres:{},energy:.5});return t.userProfile.timePatterns.forEach(r=>{const i={low:.3,medium:.5,high:.75};s.set(r.hour,{genres:r.genres,energy:i[r.energy]||.5})}),t.listenHistory.slice(0,200).forEach(r=>{const i=new Date(r.timestamp).getHours(),o=s.get(i);if(r.genres)for(const a of r.genres){const l=a.toLowerCase();o.genres[l]=(o.genres[l]||0)+1}}),s},getPlayCounts:()=>{const t=e(),s=new Map;return t.listenHistory.forEach(r=>{s.set(r.trackId,(s.get(r.trackId)||0)+1)}),s}}),{name:"audiio-recommendations",partialize:n=>({listenHistory:n.listenHistory.slice(0,500),dislikedTracks:n.dislikedTracks,userProfile:n.userProfile,lastUpdated:n.lastUpdated})})),kO=12,ov=5;class CO{constructor(){Mt(this,"sections",new Map);Mt(this,"disabledSections",new Set)}register(e){this.sections.has(e.type)&&console.warn(`[SectionRegistry] Overwriting existing section: ${e.type}`),this.sections.set(e.type,e)}unregister(e){this.sections.delete(e),this.disabledSections.delete(e)}setEnabled(e,t){t?this.disabledSections.delete(e):this.disabledSections.add(e)}get(e){if(!this.disabledSections.has(e))return this.sections.get(e)}getAll(){return Array.from(this.sections.values())}getEnabled(){return Array.from(this.sections.values()).filter(e=>!this.disabledSections.has(e.type))}meetsRequirements(e,t){return!0}meetsConstraints(e,t,s){var i;const{constraints:r}=e;if(r.maxPerPage!==void 0&&t.filter(a=>a.type===e.type).length>=r.maxPerPage)return!1;if(r.cooldownSections!==void 0&&t.length>0){const o=t.length-1;for(let a=o;a>=Math.max(0,o-r.cooldownSections);a--)if(((i=t[a])==null?void 0:i.type)===e.type)return!1}if(r.incompatibleWith){for(const o of r.incompatibleWith)if(s.has(o))return!1}return!(r.minSectionsBefore!==void 0&&t.length<r.minSectionsBefore)}calculateWeight(e,t){const{weights:s}=e;let r=s.base;return!t.isNewUser&&s.personalizedBoost&&(r+=s.personalizedBoost),t.isNewUser&&s.newUserBoost&&(r+=s.newUserBoost),s.timeRelevance&&(r+=s.timeRelevance(t.hour)),s.dayRelevance&&(r+=s.dayRelevance(t.dayOfWeek)),t.recentSections.includes(e.type)&&(r*=.5),r}createSectionConfig(e,t,s){var i;const r=((i=e.generateConfig)==null?void 0:i.call(e,t))??{};return{id:`${e.type}-${Date.now()}-${Math.random().toString(36).slice(2,7)}`,type:e.type,title:r.title??e.displayName,subtitle:r.subtitle,query:r.query,structuredQuery:r.structuredQuery,isPersonalized:!t.isNewUser&&(r.isPersonalized??!1),whyExplanation:r.whyExplanation,priority:s}}getAllSectionConfigs(e){const t={...e,isNewUser:e.userProfile.totalListens<ov},s=this.getEnabled(),r=s.filter(u=>u.constraints.preferredPosition==="top"),i=s.filter(u=>u.constraints.preferredPosition==="bottom"),o=s.filter(u=>!u.constraints.preferredPosition||u.constraints.preferredPosition==="middle"),a=[];let l=0;for(const u of r)a.push(this.createSectionConfig(u,t,l++));for(const u of o)a.push(this.createSectionConfig(u,t,l++));for(const u of i)a.push(this.createSectionConfig(u,t,l++));return a}selectSections(e,t=kO){const s={...e,isNewUser:e.userProfile.totalListens<ov},i=this.getEnabled().filter(p=>this.meetsRequirements(p,s)).map(p=>({def:p,weight:this.calculateWeight(p,s)}));i.sort((p,g)=>{const x=(Math.random()-.5)*15;return g.weight+x-(p.weight+x)});const o=[],a=new Set;let l=0;const u=i.filter(p=>p.def.constraints.preferredPosition==="top"),d=i.filter(p=>p.def.constraints.preferredPosition==="bottom"),f=i.filter(p=>!p.def.constraints.preferredPosition||p.def.constraints.preferredPosition==="middle");for(const{def:p}of u){if(o.length>=t)break;this.meetsConstraints(p,o,a)&&(o.push(this.createSectionConfig(p,s,l++)),a.add(p.type))}for(const{def:p}of f){if(o.length>=t-d.length)break;this.meetsConstraints(p,o,a)&&(o.push(this.createSectionConfig(p,s,l++)),a.add(p.type))}for(const{def:p}of d){if(o.length>=t)break;this.meetsConstraints(p,o,a)&&(o.push(this.createSectionConfig(p,s,l++)),a.add(p.type))}return o}}const lt=new CO;function SO(n){const e=new Date;return{...n,hour:e.getHours(),dayOfWeek:e.getDay(),recentSections:n.recentSections??[],isNewUser:n.userProfile.totalListens<ov}}function yb(n,e,t){return{strategy:"embedding",embedding:{method:"mood",mood:n,exploration:(t==null?void 0:t.exploration)??.3,includeCollaborative:(t==null?void 0:t.includeCollaborative)??!0,contextHour:t==null?void 0:t.contextHour,contextDayOfWeek:t==null?void 0:t.contextDayOfWeek,energy:t==null?void 0:t.energy,excludeTrackIds:t==null?void 0:t.excludeTrackIds,excludeArtistIds:t==null?void 0:t.excludeArtistIds},title:e,subtitle:t==null?void 0:t.subtitle,sectionType:(t==null?void 0:t.sectionType)??"mood",limit:(t==null?void 0:t.limit)??50}}function NO(n,e,t){return{strategy:"embedding",embedding:{method:"genre",genre:n,exploration:(t==null?void 0:t.exploration)??.4,includeCollaborative:(t==null?void 0:t.includeCollaborative)??!0,contextHour:t==null?void 0:t.contextHour,contextDayOfWeek:t==null?void 0:t.contextDayOfWeek,excludeTrackIds:t==null?void 0:t.excludeTrackIds,excludeArtistIds:t==null?void 0:t.excludeArtistIds},title:e,subtitle:t==null?void 0:t.subtitle,sectionType:(t==null?void 0:t.sectionType)??"genre",limit:(t==null?void 0:t.limit)??50}}function c$(n,e,t,s){return{strategy:"embedding",embedding:{method:"artist-radio",seedArtistId:n,artistName:e,exploration:(s==null?void 0:s.exploration)??.3,includeCollaborative:(s==null?void 0:s.includeCollaborative)??!0,contextHour:s==null?void 0:s.contextHour,contextDayOfWeek:s==null?void 0:s.contextDayOfWeek,excludeTrackIds:s==null?void 0:s.excludeTrackIds,excludeArtistIds:s==null?void 0:s.excludeArtistIds},title:t,subtitle:(s==null?void 0:s.subtitle)??`Tracks similar to ${e}`,sectionType:(s==null?void 0:s.sectionType)??"artist-radio",limit:(s==null?void 0:s.limit)??50}}function Lm(n,e){return{strategy:"embedding",embedding:{method:"discovery",exploration:(e==null?void 0:e.exploration)??.8,includeCollaborative:(e==null?void 0:e.includeCollaborative)??!0,contextHour:e==null?void 0:e.contextHour,contextDayOfWeek:e==null?void 0:e.contextDayOfWeek,excludeTrackIds:e==null?void 0:e.excludeTrackIds,excludeArtistIds:e==null?void 0:e.excludeArtistIds},title:n,subtitle:(e==null?void 0:e.subtitle)??"Expand your horizons",sectionType:(e==null?void 0:e.sectionType)??"discovery",limit:(e==null?void 0:e.limit)??50}}function u$(n,e){return{strategy:"embedding",embedding:{method:"personalized",exploration:(e==null?void 0:e.exploration)??.2,includeCollaborative:(e==null?void 0:e.includeCollaborative)??!0,contextHour:e==null?void 0:e.contextHour,contextDayOfWeek:e==null?void 0:e.contextDayOfWeek,excludeTrackIds:e==null?void 0:e.excludeTrackIds,excludeArtistIds:e==null?void 0:e.excludeArtistIds},title:n,subtitle:(e==null?void 0:e.subtitle)??"Based on your taste",sectionType:(e==null?void 0:e.sectionType)??"personalized",limit:(e==null?void 0:e.limit)??50}}const IO={providerTimeout:5e3,transformerTimeout:2e3,continueOnError:!0,maxProviderResults:50};class TO{constructor(){Mt(this,"transformers",new Map);Mt(this,"providers",new Map);Mt(this,"enhancers",new Map);Mt(this,"disabledTransformers",new Set);Mt(this,"listeners",new Set);Mt(this,"config",IO)}setConfig(e){this.config={...this.config,...e},this.notifyListeners()}getConfig(){return{...this.config}}registerTransformer(e,t){if(this.transformers.has(e.id)&&!(t!=null&&t.replace)){console.warn(`[PipelineRegistry] Transformer "${e.id}" already exists. Use replace: true to override.`);return}this.transformers.set(e.id,e),e.enabledByDefault||this.disabledTransformers.add(e.id),console.log(`[PipelineRegistry] Registered transformer: ${e.name}`),this.notifyListeners()}unregisterTransformer(e){const t=this.transformers.delete(e);return this.disabledTransformers.delete(e),t&&this.notifyListeners(),t}setTransformerEnabled(e,t){this.transformers.has(e)&&(t?this.disabledTransformers.delete(e):this.disabledTransformers.add(e),this.notifyListeners())}isTransformerEnabled(e){return this.transformers.has(e)&&!this.disabledTransformers.has(e)}getTransformers(){return Array.from(this.transformers.values())}getEnabledTransformers(){return Array.from(this.transformers.values()).filter(e=>!this.disabledTransformers.has(e.id)).sort((e,t)=>t.priority-e.priority)}registerProvider(e,t){if(this.providers.has(e.id)&&!(t!=null&&t.replace)){console.warn(`[PipelineRegistry] Provider "${e.id}" already exists. Use replace: true to override.`);return}this.providers.set(e.id,e),console.log(`[PipelineRegistry] Registered provider: ${e.name}`),this.notifyListeners()}unregisterProvider(e){const t=this.providers.delete(e);return t&&this.notifyListeners(),t}getProviders(){return Array.from(this.providers.values())}getProvidersByPriority(){return Array.from(this.providers.values()).sort((e,t)=>t.priority-e.priority)}registerEnhancer(e,t){if(this.enhancers.has(e.id)&&!(t!=null&&t.replace)){console.warn(`[PipelineRegistry] Enhancer "${e.id}" already exists. Use replace: true to override.`);return}this.enhancers.set(e.id,e),console.log(`[PipelineRegistry] Registered enhancer: ${e.name}`),this.notifyListeners()}unregisterEnhancer(e){const t=this.enhancers.delete(e);return t&&this.notifyListeners(),t}getEnhancers(){return Array.from(this.enhancers.values())}getEnhancersByPriority(){return Array.from(this.enhancers.values()).sort((e,t)=>t.priority-e.priority)}unregisterPlugin(e){let t=0;for(const[s,r]of this.transformers)r.pluginId===e&&(this.transformers.delete(s),this.disabledTransformers.delete(s),t++);for(const[s,r]of this.providers)r.pluginId===e&&(this.providers.delete(s),t++);for(const[s,r]of this.enhancers)r.pluginId===e&&(this.enhancers.delete(s),t++);t>0&&(console.log(`[PipelineRegistry] Unregistered ${t} hooks from plugin: ${e}`),this.notifyListeners())}enhanceQuery(e,t){const s=[];let r=e;for(const i of this.getEnhancersByPriority())try{i.canEnhance(r)&&(r=i.enhance(r,t),s.push(i.id))}catch(o){if(console.error(`[PipelineRegistry] Enhancer "${i.id}" failed:`,o),!this.config.continueOnError)throw o}return{query:r,appliedEnhancers:s}}async runProviders(e){const t=[],s=[],r=this.getProvidersByPriority().filter(u=>u.canProvide(e.query));if(r.length===0)return{tracks:[],contributingProviders:[]};const i=r.map(async u=>{try{const d=new Promise((p,g)=>{setTimeout(()=>g(new Error("Provider timeout")),this.config.providerTimeout)}),f=await Promise.race([u.provide(e),d]);return{providerId:u.id,tracks:f}}catch(d){return console.error(`[PipelineRegistry] Provider "${u.id}" failed:`,d),{providerId:u.id,tracks:[]}}}),o=await Promise.all(i);for(const u of o)u.tracks.length>0&&(s.push(...u.tracks),t.push(u.providerId));const a=new Set,l=[];for(const u of s)!a.has(u.id)&&l.length<this.config.maxProviderResults&&(a.add(u.id),l.push(u));return{tracks:l,contributingProviders:t}}async runTransformers(e,t){const s=[];let r=e;const i=this.getEnabledTransformers().filter(o=>o.canTransform(t.query));for(const o of i)try{const a=new Promise((l,u)=>{setTimeout(()=>u(new Error("Transformer timeout")),this.config.transformerTimeout)});r=await Promise.race([o.transform(r,{...t,currentResults:r}),a]),s.push(o.id)}catch(a){if(console.error(`[PipelineRegistry] Transformer "${o.id}" failed:`,a),!this.config.continueOnError)throw a}return{tracks:r,appliedTransformers:s}}async executePipeline(e,t,s){const r=performance.now(),{query:i,appliedEnhancers:o}=this.enhanceQuery(t,{...s,query:t}),{tracks:a,contributingProviders:l}=await this.runProviders({...s,query:i,currentResults:e}),u=this.mergeResults(e,a),{tracks:d,appliedTransformers:f}=await this.runTransformers(u,{...s,query:i,currentResults:u}),p=performance.now()-r;return{tracks:d,appliedTransformers:f,contributingProviders:l,appliedEnhancers:o,executionTime:p}}mergeResults(e,t){const s=new Set(e.map(i=>i.id)),r=[...e];for(const i of t)s.has(i.id)||(s.add(i.id),r.push(i));return r}subscribe(e){return this.listeners.add(e),()=>this.listeners.delete(e)}notifyListeners(){this.listeners.forEach(e=>{try{e()}catch(t){console.error("[PipelineRegistry] Listener error:",t)}})}getStats(){return{transformers:this.transformers.size,enabledTransformers:this.transformers.size-this.disabledTransformers.size,providers:this.providers.size,enhancers:this.enhancers.size}}}const Oa=new TO,yS=n=>Symbol.iterator in n,vS=n=>"entries"in n,bS=(n,e)=>{const t=n instanceof Map?n:new Map(n.entries()),s=e instanceof Map?e:new Map(e.entries());if(t.size!==s.size)return!1;for(const[r,i]of t)if(!s.has(r)||!Object.is(i,s.get(r)))return!1;return!0},$O=(n,e)=>{const t=n[Symbol.iterator](),s=e[Symbol.iterator]();let r=t.next(),i=s.next();for(;!r.done&&!i.done;){if(!Object.is(r.value,i.value))return!1;r=t.next(),i=s.next()}return!!r.done&&!!i.done};function EO(n,e){return Object.is(n,e)?!0:typeof n!="object"||n===null||typeof e!="object"||e===null||Object.getPrototypeOf(n)!==Object.getPrototypeOf(e)?!1:yS(n)&&yS(e)?vS(n)&&vS(e)?bS(n,e):$O(n,e):bS({entries:()=>Object.entries(n)},{entries:()=>Object.entries(e)})}function d$(n){const e=gt.useRef(void 0);return t=>{const s=n(t);return EO(e.current,s)?e.current:e.current=s}}const Yf=["pop","rock","hip-hop","electronic","r&b","jazz","classical","other"],AO=18,jO=4,RO=AO+jO;function DO(n){const e=new Array(Yf.length).fill(0);for(const t of n){const s=t.toLowerCase(),r=Yf.findIndex(i=>i==="hip-hop"?s.includes("hip")||s.includes("rap"):i==="r&b"?s.includes("r&b")||s.includes("rnb")||s.includes("soul"):i==="electronic"?s.includes("electro")||s.includes("edm")||s.includes("house")||s.includes("techno")||s.includes("dance"):s.includes(i)||i.includes(s));r!==-1?e[r]=1:e[Yf.length-1]=1}return e.every(t=>t===0)&&(e[Yf.length-1]=1),e}function wS(n,e,t){return t===e?.5:Math.max(0,Math.min(1,(n-e)/(t-e)))}function PO(n){return n.length===0?.5:n.filter(t=>t.skipped).length/n.length}function MO(n){return n.length===0?.5:n.filter(t=>t.completed).length/n.length}function LO(n){if(n.length===0)return 0;const e=Math.max(...n.map(s=>s.timestamp)),t=(Date.now()-e)/(1e3*60*60);return Math.exp(-t/48)}function FO(n,e){let t=0;for(const s of n.artists){const r=s.id||s.name.toLowerCase().replace(/\s+/g,"-"),i=e.artistPreferences[r];if(i){const o=(i.score+100)/200;t=Math.max(t,o)}}return t}function OO(n,e,t,s){const r=DO(n.genres||[]),i=iv(n),o=i.energy/100,a=i.valence/100,l=wS(n.duration,s.duration.min,s.duration.max),u=n.explicit?1:0,d=n.releaseDate?new Date(n.releaseDate).getFullYear():2020,f=wS(d,s.releaseYear.min,s.releaseYear.max),p=t.filter(N=>N.trackId===n.id),g=Math.log1p(p.length)/Math.log1p(100),x=PO(p),y=MO(p),b=LO(p),k=FO(n,e),w=[...r,o,a,l,u,f,g,x,y,b,k];return{raw:w,normalized:w}}function h$(n){const e=n??new Date().getHours(),t=new Date().getDay(),s=Math.sin(e*2*Math.PI/24),r=Math.cos(e*2*Math.PI/24),i=Math.sin(t*2*Math.PI/7),o=Math.cos(t*2*Math.PI/7);return[s,r,i,o]}function Vp(n,e,t,s,r){const i=OO(n,e,t,s),o=h$(r);return{trackFeatures:i.normalized,contextFeatures:o,combined:[...i.normalized,...o]}}function _O(n){if(n.length===0)return 1;const e=n.reduce((r,i)=>r+i,0)/n.length,s=n.map(r=>Math.pow(r-e,2)).reduce((r,i)=>r+i,0)/n.length;return Math.sqrt(s)||1}function kS(n){const e=n.map(r=>r.duration).filter(r=>r>0),t=n.map(r=>r.releaseDate?new Date(r.releaseDate).getFullYear():null).filter(r=>r!==null&&r>1900&&r<=new Date().getFullYear()+1),s=e.length>0?e.reduce((r,i)=>r+i,0)/e.length:18e4;return{duration:{min:Math.min(...e,3e4),max:Math.max(...e,6e5),mean:s,std:_O(e)},playCount:{min:0,max:100},releaseYear:{min:Math.min(...t,1950),max:Math.max(...t,new Date().getFullYear())}}}function bp(){return{duration:{min:3e4,max:6e5,mean:18e4,std:6e4},playCount:{min:0,max:100},releaseYear:{min:1950,max:new Date().getFullYear()}}}const zO={not_my_taste:.95,dont_like_artist:.9,explicit_content:.85,heard_too_much:.4,bad_audio_quality:.3,wrong_mood:.35,too_long:.5,too_short:.5,other:.6};function BO(n){return n.completed?1:n.skipped?0:n.totalDuration>0?Math.min(1,n.duration/n.totalDuration):.5}function WO(n){if(n.length===0)return .1;let e=0,t=0;for(const r of n){const i=zO[r]||.6;e+=1,t+=i}const s=t/e;return Math.max(0,.2*(1-s))}function VO(n,e,t,s,r){const i=[],o=[];for(const a of e){const l=n.get(a.trackId);if(!l||r&&r[a.trackId])continue;const u=new Date(a.timestamp).getHours(),d=Vp(l,t,e,s,u);i.push(d.combined),o.push(BO(a))}if(r)for(const[a,l]of Object.entries(r)){let u=n.get(a);if(!u&&l.trackData&&(u={id:a,title:l.trackData.title,artists:l.trackData.artists.map(g=>({name:g,id:g})),genres:l.trackData.genres,duration:0,streamSources:[],_meta:{metadataProvider:"dislike-data",matchConfidence:1,externalIds:{},lastUpdated:new Date}}),!u)continue;const d=new Date(l.timestamp).getHours(),f=Vp(u,t,e,s,d),p=WO(l.reasons);i.push(f.combined),o.push(p),console.log(`[MLTraining] Added disliked track "${l.trackData.title}" with label ${p.toFixed(3)} (reasons: ${l.reasons.join(", ")})`)}return{inputs:i,labels:o}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UO=1e-7,GO=1e-4;class f${constructor(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}get(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}set(e,t){this.dataIdsCount++,this.data.set(e,t)}has(e){return this.data.has(e)}delete(e){return this.dataIdsCount--,this.data.delete(e)}numDataIds(){return this.dataIdsCount}}class vb{refCount(e){return Gs("refCount")}incRef(e){return Gs("incRef")}timerAvailable(){return!0}time(e){return Gs("time")}read(e){return Gs("read")}readSync(e){return Gs("readSync")}readToGPU(e,t){return Gs("readToGPU")}numDataIds(){return Gs("numDataIds")}disposeData(e,t){return Gs("disposeData")}write(e,t,s){return Gs("write")}move(e,t,s,r,i){return Gs("move")}createTensorFromGPUData(e,t,s){return Gs("createTensorFromGPUData")}memory(){return Gs("memory")}floatPrecision(){return Gs("floatPrecision")}epsilon(){return this.floatPrecision()===32?UO:GO}dispose(){return Gs("dispose")}}function Gs(n){throw new Error(`'${n}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HO(n){let e=n.length,t=0;for(;e>0;)t=Math.random()*e|0,e--,zl(n,e,t)}function _a(n,e,t){return Math.max(n,Math.min(e,t))}function bb(n){return n%2===0?n:n+1}function zl(n,e,t){const s=n[e];n[e]=n[t],n[t]=s}function qO(n){let e=0;for(let t=0;t<n.length;t++)e+=n[t];return e}function V(n,e){if(!n)throw new Error(typeof e=="string"?e:e())}function wb(n,e,t=""){V(At(n,e),()=>t+` Shapes ${n} and ${e} must match`)}function p$(n){V(n!=null,()=>"The input to the tensor constructor must be a non-null value.")}function be(n){if(n.length===0)return 1;let e=n[0];for(let t=1;t<n.length;t++)e*=n[t];return e}function At(n,e){if(n===e)return!0;if(n==null||e==null||n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function oc(n){return n%1===0}function av(n){const e=Math.ceil(Math.sqrt(n));return[e,Math.ceil(n/e)]}function Kl(n,e){return e<=n.length?n:n+" ".repeat(e-n.length)}function CS(n,e=r=>0,t,s){return new Promise((r,i)=>{let o=0;const a=()=>{if(n()){r();return}o++;const l=e(o);if(t!=null&&o>=t){i();return}s!=null?s(a,l):setTimeout(a,l)};a()})}function m$(n,e){let t=1,s=-1;for(let i=0;i<n.length;++i)if(n[i]>=0)t*=n[i];else if(n[i]===-1){if(s!==-1)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${s} and dim ${i}`);s=i}else if(n[i]<0)throw Error(`Shapes can not be < 0. Found ${n[i]} at dim ${i}`);if(s===-1){if(e>0&&e!==t)throw Error(`Size(${e}) must match the product of shape ${n}`);return n}if(t===0)throw Error(`Cannot infer the missing size in [${n}] when there are 0 elements`);if(e%t!==0)throw Error(`The implicit shape can't be a fractional number. Got ${e} / ${t}`);const r=n.slice();return r[s]=e/t,r}function ht(n,e){const t=e.length;return n=n==null?e.map((s,r)=>r):[].concat(n),V(n.every(s=>s>=-t&&s<t),()=>`All values in axis param must be in range [-${t}, ${t}) but got axis ${n}`),V(n.every(s=>oc(s)),()=>`All values in axis param must be integers but got axis ${n}`),n.map(s=>s<0?t+s:s)}function Xo(n,e){const t=[],s=[],r=e!=null&&Array.isArray(e)&&e.length===0,i=e==null||r?null:ht(e,n).sort();let o=0;for(let a=0;a<n.length;++a){if(i!=null){if(i[o]===a&&n[a]!==1)throw new Error(`Can't squeeze axis ${a} since its dim '${n[a]}' is not 1`);(i[o]==null||i[o]>a)&&n[a]===1&&(t.push(n[a]),s.push(a)),i[o]<=a&&o++}n[a]!==1&&(t.push(n[a]),s.push(a))}return{newShape:t,keptDims:s}}function ts(n,e){return hn(n,e)}function hn(n,e){let t=null;if(n==null||n==="float32")t=new Float32Array(e);else if(n==="int32")t=new Int32Array(e);else if(n==="bool")t=new Uint8Array(e);else if(n==="string")t=new Array(e);else throw new Error(`Unknown data type ${n}`);return t}function KO(n,e){for(let t=0;t<n.length;t++){const s=n[t];if(isNaN(s)||!isFinite(s))throw Error(`A tensor of type ${e} being uploaded contains ${s}.`)}}function QO(n){return n==="bool"||n==="complex64"||n==="float32"||n==="int32"||n==="string"}function g$(n,e){return!(e==="complex64"||e==="float32"&&n!=="complex64"||e==="int32"&&n!=="float32"&&n!=="complex64"||e==="bool"&&n==="bool")}function Up(n){if(n==="float32"||n==="int32")return 4;if(n==="complex64")return 8;if(n==="bool")return 1;throw new Error(`Unknown dtype ${n}`)}function XO(n){if(n==null)return 0;let e=0;return n.forEach(t=>e+=t.length),e}function yd(n){return typeof n=="string"||n instanceof String}function YO(n){return typeof n=="boolean"}function lv(n){return typeof n=="number"}function Nc(n){return Array.isArray(n)?Nc(n[0]):n instanceof Float32Array?"float32":n instanceof Int32Array||n instanceof Uint8Array||n instanceof Uint8ClampedArray?"int32":lv(n)?"float32":yd(n)?"string":YO(n)?"bool":"float32"}function cv(n){return!!(n&&n.constructor&&n.call&&n.apply)}function uv(n,e){for(let t=e;t<n;++t)if(n%t===0)return t;return n}function Qe(n){const e=n.length;if(e<2)return[];const t=new Array(e-1);t[e-2]=n[e-1];for(let s=e-3;s>=0;--s)t[s]=t[s+1]*n[s+1];return t}function x$(n,e,t,s=!1){const r=new Array;if(e.length===1){const i=e[0]*(s?2:1);for(let o=0;o<i;o++)r[o]=t[n+o]}else{const i=e[0],o=e.slice(1),a=o.reduce((l,u)=>l*u)*(s?2:1);for(let l=0;l<i;l++)r[l]=x$(n+l*a,o,t,s)}return r}function Xr(n,e,t=!1){if(n.length===0)return e[0];const s=n.reduce((r,i)=>r*i)*(t?2:1);if(s===0)return[];if(s!==e.length)throw new Error(`[${n}] does not match the input size ${e.length}${t?" for a complex tensor":""}.`);return x$(0,n,e,t)}function ZO(n,e){if(Array.isArray(n))return n;if(e==="float32")return n instanceof Float32Array?n:new Float32Array(n);if(e==="int32")return n instanceof Int32Array?n:new Int32Array(n);if(e==="bool"||e==="string")return Uint8Array.from(new Int32Array(n));throw new Error(`Unknown dtype ${e}`)}function kb(n,e){const t=ns(n,e);for(let s=0;s<t.length;s++)t[s]=1;return t}function ns(n,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool")return new Uint8Array(n);throw new Error(`Unknown data type ${e}`)}function y$(n,e){const t=n.reduce((s,r)=>s*r,1);if(e==null||e==="float32")return Xr(n,new Float32Array(t));if(e==="int32")return Xr(n,new Int32Array(t));if(e==="bool")return Xr(n,new Uint8Array(t));throw new Error(`Unknown data type ${e}`)}function ao(n){n.forEach(e=>{V(Number.isInteger(e)&&e>=0,()=>`Tensor must have a shape comprised of positive integers but got shape [${n}].`)})}function wi(n,e,t){if(e===0)return 0;if(e===1)return n[0];let s=n[n.length-1];for(let r=0;r<n.length-1;++r)s+=t[r]*n[r];return s}function Ic(n,e,t){if(e===0)return[];if(e===1)return[n];const s=new Array(e);for(let r=0;r<s.length-1;++r)s[r]=Math.floor(n/t[r]),n-=s[r]*t[r];return s[s.length-1]=n,s}function Cb(n){return n&&n.then&&typeof n.then=="function"}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SS="tfjsflags";class JO{constructor(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=e_,this.populateURLFlags()}setPlatform(e,t){this.platform!=null&&(me().getBool("IS_TEST")||me().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${e}.`)),this.platformName=e,this.platform=t}registerFlag(e,t,s){if(this.flagRegistry[e]={evaluationFn:t,setHook:s},this.urlFlags[e]!=null){const r=this.urlFlags[e];me().getBool("IS_TEST")||me().getBool("PROD")||console.warn(`Setting feature override from URL ${e}: ${r}.`),this.set(e,r)}}async getAsync(e){return e in this.flags?this.flags[e]:(this.flags[e]=await this.evaluateFlag(e),this.flags[e])}get(e){if(e in this.flags)return this.flags[e];const t=this.evaluateFlag(e);if(Cb(t))throw new Error(`Flag ${e} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[e]=t,this.flags[e]}getNumber(e){return this.get(e)}getBool(e){return this.get(e)}getString(e){return this.get(e)}getFlags(){return this.flags}get features(){return this.flags}set(e,t){if(this.flagRegistry[e]==null)throw new Error(`Cannot set flag ${e} as it has not been registered.`);this.flags[e]=t,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(t)}evaluateFlag(e){if(this.flagRegistry[e]==null)throw new Error(`Cannot evaluate flag '${e}': no evaluation function found.`);return this.flagRegistry[e].evaluationFn()}setFlags(e){this.flags=Object.assign({},e)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")return;const e=this.getQueryParams(this.global.location.search);SS in e&&e[SS].split(",").forEach(s=>{const[r,i]=s.split(":");this.urlFlags[r]=n_(r,i)})}}function e_(n){const e={};return n.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(t,...s)=>(t_(e,s[0],s[1]),s.join("="))),e}function t_(n,e,t){n[decodeURIComponent(e)]=decodeURIComponent(t||"")}function n_(n,e){const t=e.toLowerCase();return t==="true"||t==="false"?t==="true":`${+t}`===t?+t:e}function me(){return v$}let v$=null;function s_(n){v$=n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let h0;function b$(){if(h0==null){let n;if(typeof window<"u")n=window;else if(typeof global<"u")n=global;else if(typeof process<"u")n=process;else if(typeof self<"u")n=self;else throw new Error("Could not find a global object");h0=n}return h0}function r_(){const n=b$();return n._tfGlobals==null&&(n._tfGlobals=new Map),n._tfGlobals}function Sb(n,e){const t=r_();if(t.has(n))return t.get(n);{const s=e();return t.set(n,s),t.get(n)}}const Fm="Abs",vd="Acos",bd="Acosh",Tc="Add",Nb="AddN",Ib="All",Tb="Any",Om="ArgMax",_m="ArgMin",wd="Asin",kd="Asinh",Cd="Atan",Sd="Atanh",Nd="Atan2",zm="AvgPool",$b="AvgPoolGrad",Bm="AvgPool3D",Eb="AvgPool3DGrad",Wm="BatchMatMul",Vm="BatchToSpaceND",Ab="Bincount",jb="BitwiseAnd",i_="BroadcastTo",w$="BroadcastArgs",Id="Cast",Td="Ceil",$d="ClipByValue",Rb="Complex",Um="ComplexAbs",Gm="Concat",Hm="Conv2D",Db="Conv2DBackpropFilter",qm="Conv2DBackpropInput",Km="Conv3D",Pb="Conv3DBackpropFilterV2",Mb="Conv3DBackpropInputV2",Ed="Cos",Ad="Cosh",Lb="Cumprod",Qm="Cumsum",Fb="CropAndResize",Ob="DenseBincount",_b="DepthToSpace",Xm="DepthwiseConv2dNative",zb="DepthwiseConv2dNativeBackpropFilter",Bb="DepthwiseConv2dNativeBackpropInput",k$="Diag",Ym="Dilation2D",dv="Dilation2DBackpropInput",hv="Dilation2DBackpropFilter",o_="Draw",jd="RealDiv",Wb="Einsum",Rd="Elu",Vb="EluGrad",Dd="Erf",Zm="Equal",Pd="Exp",Jm="ExpandDims",Md="Expm1",Ub="FFT",Gb="Fill",Hb="FlipLeftRight",Ld="Floor",Fd="FloorDiv",eg="FusedBatchNorm",tg="GatherV2",C$="GatherNd",ng="Greater",Od="GreaterEqual",_d="Identity",qb="IFFT",Kb="Imag",zd="IsFinite",Bd="IsInf",Wd="IsNan",sg="LeakyRelu",rg="Less",ig="LessEqual",S$="LinSpace",Vd="Log",Ud="Log1p",og="LogicalAnd",ag="LogicalNot",lg="LogicalOr",a_="LogSoftmax",cg="LRN",Qb="LRNGrad",ug="Max",Gd="Maximum",dg="MaxPool",Xb="MaxPoolGrad",hg="MaxPool3D",Yb="MaxPool3DGrad",N$="MaxPoolWithArgmax",fg="Mean",pg="Min",Hd="Minimum",mg="MirrorPad",qd="Mod",I$="Multinomial",Kd="Multiply",gg="Neg",xg="NotEqual",Zb="NonMaxSuppressionV3",Jb="NonMaxSuppressionV4",e1="NonMaxSuppressionV5",yg="OnesLike",vg="OneHot",bg="Pack",wg="PadV2",Qd="Pow",kg="Prelu",Cg="Prod",T$="RaggedGather",$$="RaggedRange",E$="RaggedTensorToTensor",t1="Range",n1="Real",Xd="Reciprocal",Yd="Relu",Sg="Reshape",Ng="ResizeNearestNeighbor",s1="ResizeNearestNeighborGrad",Ig="ResizeBilinear",r1="ResizeBilinearGrad",Zd="Relu6",Tg="Reverse",Jd="Round",eh="Rsqrt",A$="ScatterNd",j$="TensorScatterUpdate",R$="SearchSorted",$g="Select",th="Selu",Eg="Slice",nh="Sin",sh="Sinh",rh="Sign",ih="Sigmoid",oh="Softplus",ah="Sqrt",Ag="Sum",jg="SpaceToBatchND",Rg="SplitV",Dg="Softmax",D$="SparseFillEmptyRows",P$="SparseReshape",M$="SparseSegmentMean",L$="SparseSegmentSum",F$="SparseToDense",lh="SquaredDifference",i1="Square",o1="StaticRegexReplace",a1="StridedSlice",O$="StringNGrams",_$="StringSplit",z$="StringToHashBucketFast",ch="Sub",uh="Tan",dh="Tanh",hh="Tile",l1="TopK",c1="Transform",Ql="Transpose",u1="Unique",Pg="Unpack",Mg="UnsortedSegmentSum",Lg="ZerosLike",fh="Step",l_="FromPixels",d1="RotateWithOffset",Gp="_FusedMatMul",Hp="FusedConv2D",B$="FusedDepthwiseConv2D";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rr(...n){me().getBool("IS_TEST")||me().getBool("PROD")||console.warn(...n)}function c_(...n){me().getBool("IS_TEST")||me().getBool("PROD")||console.log(...n)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qp=Sb("kernelRegistry",()=>new Map),fv=Sb("gradRegistry",()=>new Map);function NS(n,e){const t=V$(n,e);return qp.get(t)}function IS(n){return fv.get(n)}function TS(n){const e=qp.entries(),t=[];for(;;){const{done:s,value:r}=e.next();if(s)break;const[i,o]=r,[a]=i.split("_");a===n&&t.push(o)}return t}function W$(n){const{kernelName:e,backendName:t}=n,s=V$(e,t);qp.has(s)&&rr(`The kernel '${e}' for backend '${t}' is already registered`),qp.set(s,n)}function u_(n){const{kernelName:e}=n;fv.has(e)&&me().getBool("DEBUG")&&rr(`Overriding the gradient for '${e}'`),fv.set(e,n)}function V$(n,e){return`${e}_${n}`}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U$(n){return n instanceof Float32Array||n instanceof Int32Array||n instanceof Uint8Array||n instanceof Uint8ClampedArray}var f0,$S;function d_(){if($S)return f0;$S=1,f0=e;var n=null;try{n=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function e(P,R,L){this.low=P|0,this.high=R|0,this.unsigned=!!L}e.prototype.__isLong__,Object.defineProperty(e.prototype,"__isLong__",{value:!0});function t(P){return(P&&P.__isLong__)===!0}e.isLong=t;var s={},r={};function i(P,R){var L,_,O;return R?(P>>>=0,(O=0<=P&&P<256)&&(_=r[P],_)?_:(L=a(P,(P|0)<0?-1:0,!0),O&&(r[P]=L),L)):(P|=0,(O=-128<=P&&P<128)&&(_=s[P],_)?_:(L=a(P,P<0?-1:0,!1),O&&(s[P]=L),L))}e.fromInt=i;function o(P,R){if(isNaN(P))return R?w:k;if(R){if(P<0)return w;if(P>=x)return A}else{if(P<=-y)return E;if(P+1>=y)return T}return P<0?o(-P,R).neg():a(P%g|0,P/g|0,R)}e.fromNumber=o;function a(P,R,L){return new e(P,R,L)}e.fromBits=a;var l=Math.pow;function u(P,R,L){if(P.length===0)throw Error("empty string");if(P==="NaN"||P==="Infinity"||P==="+Infinity"||P==="-Infinity")return k;if(typeof R=="number"?(L=R,R=!1):R=!!R,L=L||10,L<2||36<L)throw RangeError("radix");var _;if((_=P.indexOf("-"))>0)throw Error("interior hyphen");if(_===0)return u(P.substring(1),R,L).neg();for(var O=o(l(L,8)),U=k,W=0;W<P.length;W+=8){var H=Math.min(8,P.length-W),G=parseInt(P.substring(W,W+H),L);if(H<8){var q=o(l(L,H));U=U.mul(q).add(o(G))}else U=U.mul(O),U=U.add(o(G))}return U.unsigned=R,U}e.fromString=u;function d(P,R){return typeof P=="number"?o(P,R):typeof P=="string"?u(P,R):a(P.low,P.high,typeof R=="boolean"?R:P.unsigned)}e.fromValue=d;var f=65536,p=1<<24,g=f*f,x=g*g,y=x/2,b=i(p),k=i(0);e.ZERO=k;var w=i(0,!0);e.UZERO=w;var N=i(1);e.ONE=N;var C=i(1,!0);e.UONE=C;var S=i(-1);e.NEG_ONE=S;var T=a(-1,2147483647,!1);e.MAX_VALUE=T;var A=a(-1,-1,!0);e.MAX_UNSIGNED_VALUE=A;var E=a(0,-2147483648,!1);e.MIN_VALUE=E;var M=e.prototype;return M.toInt=function(){return this.unsigned?this.low>>>0:this.low},M.toNumber=function(){return this.unsigned?(this.high>>>0)*g+(this.low>>>0):this.high*g+(this.low>>>0)},M.toString=function(R){if(R=R||10,R<2||36<R)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(E)){var L=o(R),_=this.div(L),O=_.mul(L).sub(this);return _.toString(R)+O.toInt().toString(R)}else return"-"+this.neg().toString(R);for(var U=o(l(R,6),this.unsigned),W=this,H="";;){var G=W.div(U),q=W.sub(G.mul(U)).toInt()>>>0,Q=q.toString(R);if(W=G,W.isZero())return Q+H;for(;Q.length<6;)Q="0"+Q;H=""+Q+H}},M.getHighBits=function(){return this.high},M.getHighBitsUnsigned=function(){return this.high>>>0},M.getLowBits=function(){return this.low},M.getLowBitsUnsigned=function(){return this.low>>>0},M.getNumBitsAbs=function(){if(this.isNegative())return this.eq(E)?64:this.neg().getNumBitsAbs();for(var R=this.high!=0?this.high:this.low,L=31;L>0&&(R&1<<L)==0;L--);return this.high!=0?L+33:L+1},M.isZero=function(){return this.high===0&&this.low===0},M.eqz=M.isZero,M.isNegative=function(){return!this.unsigned&&this.high<0},M.isPositive=function(){return this.unsigned||this.high>=0},M.isOdd=function(){return(this.low&1)===1},M.isEven=function(){return(this.low&1)===0},M.equals=function(R){return t(R)||(R=d(R)),this.unsigned!==R.unsigned&&this.high>>>31===1&&R.high>>>31===1?!1:this.high===R.high&&this.low===R.low},M.eq=M.equals,M.notEquals=function(R){return!this.eq(R)},M.neq=M.notEquals,M.ne=M.notEquals,M.lessThan=function(R){return this.comp(R)<0},M.lt=M.lessThan,M.lessThanOrEqual=function(R){return this.comp(R)<=0},M.lte=M.lessThanOrEqual,M.le=M.lessThanOrEqual,M.greaterThan=function(R){return this.comp(R)>0},M.gt=M.greaterThan,M.greaterThanOrEqual=function(R){return this.comp(R)>=0},M.gte=M.greaterThanOrEqual,M.ge=M.greaterThanOrEqual,M.compare=function(R){if(t(R)||(R=d(R)),this.eq(R))return 0;var L=this.isNegative(),_=R.isNegative();return L&&!_?-1:!L&&_?1:this.unsigned?R.high>>>0>this.high>>>0||R.high===this.high&&R.low>>>0>this.low>>>0?-1:1:this.sub(R).isNegative()?-1:1},M.comp=M.compare,M.negate=function(){return!this.unsigned&&this.eq(E)?E:this.not().add(N)},M.neg=M.negate,M.add=function(R){t(R)||(R=d(R));var L=this.high>>>16,_=this.high&65535,O=this.low>>>16,U=this.low&65535,W=R.high>>>16,H=R.high&65535,G=R.low>>>16,q=R.low&65535,Q=0,z=0,K=0,Y=0;return Y+=U+q,K+=Y>>>16,Y&=65535,K+=O+G,z+=K>>>16,K&=65535,z+=_+H,Q+=z>>>16,z&=65535,Q+=L+W,Q&=65535,a(K<<16|Y,Q<<16|z,this.unsigned)},M.subtract=function(R){return t(R)||(R=d(R)),this.add(R.neg())},M.sub=M.subtract,M.multiply=function(R){if(this.isZero())return k;if(t(R)||(R=d(R)),n){var L=n.mul(this.low,this.high,R.low,R.high);return a(L,n.get_high(),this.unsigned)}if(R.isZero())return k;if(this.eq(E))return R.isOdd()?E:k;if(R.eq(E))return this.isOdd()?E:k;if(this.isNegative())return R.isNegative()?this.neg().mul(R.neg()):this.neg().mul(R).neg();if(R.isNegative())return this.mul(R.neg()).neg();if(this.lt(b)&&R.lt(b))return o(this.toNumber()*R.toNumber(),this.unsigned);var _=this.high>>>16,O=this.high&65535,U=this.low>>>16,W=this.low&65535,H=R.high>>>16,G=R.high&65535,q=R.low>>>16,Q=R.low&65535,z=0,K=0,Y=0,B=0;return B+=W*Q,Y+=B>>>16,B&=65535,Y+=U*Q,K+=Y>>>16,Y&=65535,Y+=W*q,K+=Y>>>16,Y&=65535,K+=O*Q,z+=K>>>16,K&=65535,K+=U*q,z+=K>>>16,K&=65535,K+=W*G,z+=K>>>16,K&=65535,z+=_*Q+O*q+U*G+W*H,z&=65535,a(Y<<16|B,z<<16|K,this.unsigned)},M.mul=M.multiply,M.divide=function(R){if(t(R)||(R=d(R)),R.isZero())throw Error("division by zero");if(n){if(!this.unsigned&&this.high===-2147483648&&R.low===-1&&R.high===-1)return this;var L=(this.unsigned?n.div_u:n.div_s)(this.low,this.high,R.low,R.high);return a(L,n.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?w:k;var _,O,U;if(this.unsigned){if(R.unsigned||(R=R.toUnsigned()),R.gt(this))return w;if(R.gt(this.shru(1)))return C;U=w}else{if(this.eq(E)){if(R.eq(N)||R.eq(S))return E;if(R.eq(E))return N;var W=this.shr(1);return _=W.div(R).shl(1),_.eq(k)?R.isNegative()?N:S:(O=this.sub(R.mul(_)),U=_.add(O.div(R)),U)}else if(R.eq(E))return this.unsigned?w:k;if(this.isNegative())return R.isNegative()?this.neg().div(R.neg()):this.neg().div(R).neg();if(R.isNegative())return this.div(R.neg()).neg();U=k}for(O=this;O.gte(R);){_=Math.max(1,Math.floor(O.toNumber()/R.toNumber()));for(var H=Math.ceil(Math.log(_)/Math.LN2),G=H<=48?1:l(2,H-48),q=o(_),Q=q.mul(R);Q.isNegative()||Q.gt(O);)_-=G,q=o(_,this.unsigned),Q=q.mul(R);q.isZero()&&(q=N),U=U.add(q),O=O.sub(Q)}return U},M.div=M.divide,M.modulo=function(R){if(t(R)||(R=d(R)),n){var L=(this.unsigned?n.rem_u:n.rem_s)(this.low,this.high,R.low,R.high);return a(L,n.get_high(),this.unsigned)}return this.sub(this.div(R).mul(R))},M.mod=M.modulo,M.rem=M.modulo,M.not=function(){return a(~this.low,~this.high,this.unsigned)},M.and=function(R){return t(R)||(R=d(R)),a(this.low&R.low,this.high&R.high,this.unsigned)},M.or=function(R){return t(R)||(R=d(R)),a(this.low|R.low,this.high|R.high,this.unsigned)},M.xor=function(R){return t(R)||(R=d(R)),a(this.low^R.low,this.high^R.high,this.unsigned)},M.shiftLeft=function(R){return t(R)&&(R=R.toInt()),(R&=63)===0?this:R<32?a(this.low<<R,this.high<<R|this.low>>>32-R,this.unsigned):a(0,this.low<<R-32,this.unsigned)},M.shl=M.shiftLeft,M.shiftRight=function(R){return t(R)&&(R=R.toInt()),(R&=63)===0?this:R<32?a(this.low>>>R|this.high<<32-R,this.high>>R,this.unsigned):a(this.high>>R-32,this.high>=0?0:-1,this.unsigned)},M.shr=M.shiftRight,M.shiftRightUnsigned=function(R){if(t(R)&&(R=R.toInt()),R&=63,R===0)return this;var L=this.high;if(R<32){var _=this.low;return a(_>>>R|L<<32-R,L>>>R,this.unsigned)}else return R===32?a(L,0,this.unsigned):a(L>>>R-32,0,this.unsigned)},M.shru=M.shiftRightUnsigned,M.shr_u=M.shiftRightUnsigned,M.toSigned=function(){return this.unsigned?a(this.low,this.high,!1):this},M.toUnsigned=function(){return this.unsigned?this:a(this.low,this.high,!0)},M.toBytes=function(R){return R?this.toBytesLE():this.toBytesBE()},M.toBytesLE=function(){var R=this.high,L=this.low;return[L&255,L>>>8&255,L>>>16&255,L>>>24,R&255,R>>>8&255,R>>>16&255,R>>>24]},M.toBytesBE=function(){var R=this.high,L=this.low;return[R>>>24,R>>>16&255,R>>>8&255,R&255,L>>>24,L>>>16&255,L>>>8&255,L&255]},e.fromBytes=function(R,L,_){return _?e.fromBytesLE(R,L):e.fromBytesBE(R,L)},e.fromBytesLE=function(R,L){return new e(R[0]|R[1]<<8|R[2]<<16|R[3]<<24,R[4]|R[5]<<8|R[6]<<16|R[7]<<24,L)},e.fromBytesBE=function(R,L){return new e(R[4]<<24|R[5]<<16|R[6]<<8|R[7],R[0]<<24|R[1]<<16|R[2]<<8|R[3],L)},f0}var G$=d_();const H$=tb(G$),h_=j3({__proto__:null,default:H$},[G$]);/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ta=H$||h_;function Fg(n){return Ta.fromString(n,!0,16)}const q$=Fg("c3a5c85c97cb3127"),Na=Fg("b492b66fbe98f273"),ys=Fg("9ae16a3b2f90404f");function pv(n){return n.xor(n.shru(47))}function K$(n,e,t){const s=n.slice(e,e+t);return Ta.fromBytes(Array.from(s),!0,!0)}function Ft(n,e){return K$(n,e,8)}function ES(n,e){return K$(n,e,4)}function Fn(n,e){return e===0?n:n.shru(e).or(n.shl(64-e))}function _o(n,e,t=Fg("9ddfea08eb382d69")){let s=n.xor(e).mul(t);s=s.xor(s.shru(47));let r=e.xor(s).mul(t);return r=r.xor(r.shru(47)),r=r.mul(t),r}function f_(n,e,t,s,r,i){r=r.add(n),i=Fn(i.add(r).add(s),21);const o=r;return r=r.add(e),r=r.add(t),i=i.add(Fn(r,44)),[r.add(s),i.add(o)]}function Zf(n,e,t,s){return f_(Ft(n,e),Ft(n,e+8),Ft(n,e+16),Ft(n,e+24),t,s)}function p_(n,e=n.length){if(e>=8){const t=ys.add(e*2),s=Ft(n,0).add(ys),r=Ft(n,e-8),i=Fn(r,37).mul(t).add(s),o=Fn(s,25).add(r).mul(t);return _o(i,o,t)}if(e>=4){const t=ys.add(e*2),s=ES(n,0);return _o(s.shl(3).add(e),ES(n,e-4),t)}if(e>0){const t=n[0],s=n[e>>1],r=n[e-1],i=t+(s<<8),o=e+(r<<2);return pv(ys.mul(i).xor(q$.mul(o))).mul(ys)}return ys}function m_(n,e=n.length){const t=ys.add(e*2),s=Ft(n,0).mul(Na),r=Ft(n,8),i=Ft(n,e-8).mul(t),o=Ft(n,e-16).mul(ys);return _o(Fn(s.add(r),43).add(Fn(i,30)).add(o),s.add(Fn(r.add(ys),18)).add(i),t)}function g_(n,e=n.length){const t=ys.add(e*2),s=Ft(n,0).mul(ys),r=Ft(n,8),i=Ft(n,e-8).mul(t),o=Ft(n,e-16).mul(ys),a=Fn(s.add(r),43).add(Fn(i,30)).add(o),l=_o(a,s.add(Fn(r.add(ys),18)).add(i),t),u=Ft(n,16).mul(t),d=Ft(n,24),f=a.add(Ft(n,e-32)).mul(t),p=l.add(Ft(n,e-24)).mul(t);return _o(Fn(u.add(d),43).add(Fn(f,30)).add(p),u.add(Fn(d.add(s),18)).add(f),t)}function x_(n,e=n.length){const t=Ta.fromNumber(81,!0);if(e<=32)return e<=16?p_(n,e):m_(n,e);if(e<=64)return g_(n,e);let s=t,r=t.mul(Na).add(113),i=pv(r.mul(ys).add(113)).mul(ys),o=[Ta.UZERO,Ta.UZERO],a=[Ta.UZERO,Ta.UZERO];s=s.mul(ys).add(Ft(n,0));let l=0;const u=(e-1>>6)*64,d=u+(e-1&63)-63;do s=Fn(s.add(r).add(o[0]).add(Ft(n,l+8)),37).mul(Na),r=Fn(r.add(o[1]).add(Ft(n,l+48)),42).mul(Na),s=s.xor(a[1]),r=r.add(o[0]).add(Ft(n,l+40)),i=Fn(i.add(a[0]),33).mul(Na),o=Zf(n,l,o[1].mul(Na),s.add(a[0])),a=Zf(n,l+32,i.add(a[1]),r.add(Ft(n,l+16))),[i,s]=[s,i],l+=64;while(l!==u);const f=Na.add(i.and(255).shl(1));return l=d,a[0]=a[0].add(e-1&63),o[0]=o[0].add(a[0]),a[0]=a[0].add(o[0]),s=Fn(s.add(r).add(o[0]).add(Ft(n,l+8)),37).mul(f),r=Fn(r.add(o[1]).add(Ft(n,l+48)),42).mul(f),s=s.xor(a[1].mul(9)),r=r.add(o[0].mul(9).add(Ft(n,l+40))),i=Fn(i.add(a[0]),33).mul(f),o=Zf(n,l,o[1].mul(f),s.add(a[0])),a=Zf(n,l+32,i.add(a[1]),r.add(Ft(n,l+16))),[i,s]=[s,i],_o(_o(o[0],a[0],f).add(pv(r).mul(q$)).add(i),_o(o[1],a[1],f).add(s),f)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yo(n,e){return e==="string"?zo(n):tl([n],e)}function y_(n,e){return n instanceof Float32Array&&e==="float32"||n instanceof Int32Array&&e==="int32"||n instanceof Uint8Array&&e==="bool"}function tl(n,e){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(n)&&(n=za(n)),me().getBool("DEBUG")&&KO(n,e),y_(n,e))return n;if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool"){const t=new Uint8Array(n.length);for(let s=0;s<t.length;++s)Math.round(n[s])!==0&&(t[s]=1);return t}else throw new Error(`Unknown data type ${e}`)}function $s(){return me().platform.now()}function zo(n,e="utf-8"){return e=e||"utf-8",me().platform.encode(n,e)}function Uo(n,e="utf-8"){return e=e||"utf-8",me().platform.decode(n,e)}function Tr(n){return me().platform.isTypedArray!=null?me().platform.isTypedArray(n):U$(n)}function za(n,e=[],t=!1){if(e==null&&(e=[]),typeof n=="boolean"||typeof n=="number"||typeof n=="string"||Cb(n)||n==null||Tr(n)&&t)e.push(n);else if(Array.isArray(n)||Tr(n))for(let s=0;s<n.length;++s)za(n[s],e,t);else{let s=-1;for(const r of Object.keys(n))/^([1-9]+[0-9]*|0)$/.test(r)&&(s=Math.max(s,Number(r)));for(let r=0;r<=s;r++)za(n[r],e,t)}return e}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class v_{constructor(e,t){this.backendTimer=e,this.logger=t,t==null&&(this.logger=new w_)}profileKernel(e,t,s){let r;const i=()=>{r=s()};let o;const a=$s();if(this.backendTimer.timerAvailable())o=this.backendTimer.time(i);else{i();for(const u of r)u.dataSync();o=Promise.resolve({kernelMs:$s()-a})}if(me().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let u=0;u<r.length;u++){const d=r[u];d.data().then(f=>{b_(f,d.dtype,e)})}return{kernelName:e,outputs:r,inputs:t,timeMs:o.then(u=>u.kernelMs),extraInfo:o.then(u=>u.getExtraProfileInfo!=null?u.getExtraProfileInfo():"")}}logKernelProfile(e){const{kernelName:t,outputs:s,timeMs:r,inputs:i,extraInfo:o}=e;s.forEach(a=>{Promise.all([a.data(),r,o]).then(l=>{this.logger.logKernelProfile(t,a,l[0],l[1],i,l[2])})})}}function b_(n,e,t){if(e!=="float32")return!1;for(let s=0;s<n.length;s++){const r=n[s];if(isNaN(r)||!isFinite(r))return console.warn(`Found ${r} in the result of '${t}'`),!0}return!1}class w_{logKernelProfile(e,t,s,r,i,o){const a=typeof r=="number"?Kl(`${r}ms`,9):r.error,l=Kl(e,25),u=t.rank,d=t.size,f=Kl(t.shape.toString(),14);let p="";for(const g in i){const x=i[g];if(x!=null){const y=x.shape||t.shape,b=y.length;p+=`${g}: ${b}D ${b>0?y:""} `}}console.log(`%c${l}	%c${a}	%c${u}D ${f}	%c${d}	%c${p}	%c${o}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function k_(n,e,t){const s={},r={};for(let l=0;l<e.length;l++)s[e[l].id]=!0;for(let l=0;l<n.length;l++){const u=n[l],d=u.inputs;for(const f in d){const p=d[f];let g=!1;for(let x=0;x<e.length;x++)if(s[p.id]){u.outputs.forEach(y=>s[y.id]=!0),g=!0,r[u.id]=!0;break}if(g)break}}const i={};i[t.id]=!0;const o={};for(let l=n.length-1;l>=0;l--){const u=n[l],d=u.inputs;for(let f=0;f<u.outputs.length;f++)if(i[u.outputs[f].id]){for(const p in d)i[d[p].id]=!0,o[u.id]=!0;break}}const a=[];for(let l=0;l<n.length;l++){const u=n[l];if(r[u.id]&&o[u.id]){const d={};for(const p in u.inputs){const g=u.inputs[p];s[g.id]&&(d[p]=g)}const f=Object.assign({},u);f.inputs=d,f.outputs=u.outputs,a.push(f)}}return a}function C_(n,e,t,s){for(let r=e.length-1;r>=0;r--){const i=e[r],o=[];if(i.outputs.forEach(l=>{const u=n[l.id];u!=null?o.push(u):o.push(null)}),i.gradient==null)throw new Error(`Cannot compute gradient: gradient function not found for ${i.kernelName}.`);const a=i.gradient(o);for(const l in i.inputs){if(!(l in a))throw new Error(`Cannot backprop through input ${l}. Available gradients found: ${Object.keys(a)}.`);const u=t(()=>a[l]());if(u.dtype!=="float32")throw new Error(`Error in gradient for op ${i.kernelName}. The gradient of input ${l} must have 'float32' dtype, but has '${u.dtype}'`);const d=i.inputs[l];if(!At(u.shape,d.shape))throw new Error(`Error in gradient for op ${i.kernelName}. The gradient of input '${l}' has shape '${u.shape}', which does not match the shape of the input '${d.shape}'`);if(n[d.id]==null)n[d.id]=u;else{const f=n[d.id];n[d.id]=s(f,u),f.dispose()}}}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AS=20,Iu=3,p0=7;function S_(n,e,t,s){const r=Qe(e),i=N_(n,e,t,r),o=e.length,a=wp(n,e,t,r,i),l=["Tensor"];return s&&(l.push(`  dtype: ${t}`),l.push(`  rank: ${o}`),l.push(`  shape: [${e}]`),l.push("  values:")),l.push(a.map(u=>"    "+u).join(`
`)),l.join(`
`)}function N_(n,e,t,s){const r=be(e),i=s[s.length-1],o=new Array(i).fill(0),a=e.length,l=t==="complex64"?Lu(n):n;if(a>1)for(let u=0;u<r/i;u++){const d=u*i;for(let f=0;f<i;f++)o[f]=Math.max(o[f],Mu(l[d+f],0,t).length)}return o}function Mu(n,e,t){let s;return Array.isArray(n)?s=`${parseFloat(n[0].toFixed(p0))} + ${parseFloat(n[1].toFixed(p0))}j`:yd(n)?s=`'${n}'`:t==="bool"?s=Q$(n):s=parseFloat(n.toFixed(p0)).toString(),Kl(s,e)}function Q$(n){return n===0?"false":"true"}function wp(n,e,t,s,r,i=!0){const o=t==="complex64"?2:1,a=e[0],l=e.length;if(l===0){if(t==="complex64"){const y=Lu(n);return[Mu(y[0],0,t)]}return t==="bool"?[Q$(n[0])]:[n[0].toString()]}if(l===1){if(a>AS){const b=Iu*o;let k=Array.from(n.slice(0,b)),w=Array.from(n.slice((a-Iu)*o,a*o));return t==="complex64"&&(k=Lu(k),w=Lu(w)),["["+k.map((N,C)=>Mu(N,r[C],t)).join(", ")+", ..., "+w.map((N,C)=>Mu(N,r[a-Iu+C],t)).join(", ")+"]"]}return["["+(t==="complex64"?Lu(n):Array.from(n)).map((b,k)=>Mu(b,r[k],t)).join(", ")+"]"]}const u=e.slice(1),d=s.slice(1),f=s[0]*o,p=[];if(a>AS){for(let y=0;y<Iu;y++){const b=y*f,k=b+f;p.push(...wp(n.slice(b,k),u,t,d,r,!1))}p.push("...");for(let y=a-Iu;y<a;y++){const b=y*f,k=b+f;p.push(...wp(n.slice(b,k),u,t,d,r,y===a-1))}}else for(let y=0;y<a;y++){const b=y*f,k=b+f;p.push(...wp(n.slice(b,k),u,t,d,r,y===a-1))}const g=l===2?",":"";p[0]="["+(a>0?p[0]+g:"");for(let y=1;y<p.length-1;y++)p[y]=" "+p[y]+g;let x=`,
`;for(let y=2;y<l;y++)x+=`
`;return p[p.length-1]=" "+p[p.length-1]+"]"+(i?"":x),p}function Lu(n){const e=[];for(let t=0;t<n.length;t+=2)e.push([n[t],n[t+1]]);return e}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Kn{constructor(e,t,s){if(this.dtype=t,this.shape=e.slice(),this.size=be(e),s!=null){const r=s.length;V(r===this.size,()=>`Length of values '${r}' does not match the size inferred by the shape '${this.size}'.`)}if(t==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=s||hn(t,this.size),this.strides=Qe(e)}set(e,...t){t.length===0&&(t=[0]),V(t.length===this.rank,()=>`The number of provided coordinates (${t.length}) must match the rank (${this.rank})`);const s=this.locToIndex(t);this.values[s]=e}get(...e){e.length===0&&(e=[0]);let t=0;for(const r of e){if(r<0||r>=this.shape[t]){const i=`Requested out of range element at ${e}.   Buffer shape=${this.shape}`;throw new Error(i)}t++}let s=e[e.length-1];for(let r=0;r<e.length-1;++r)s+=this.strides[r]*e[r];return this.values[s]}locToIndex(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];let t=e[e.length-1];for(let s=0;s<e.length-1;++s)t+=this.strides[s]*e[s];return t}indexToLoc(e){if(this.rank===0)return[];if(this.rank===1)return[e];const t=new Array(this.shape.length);for(let s=0;s<t.length-1;++s)t[s]=Math.floor(e/this.strides[s]),e-=t[s]*this.strides[s];return t[t.length-1]=e,t}get rank(){return this.shape.length}toTensor(){return qr().makeTensor(this.values,this.shape,this.dtype)}}let qr=null,Bl=null;function I_(n){qr=n}function T_(n){Bl=n}class Sn{constructor(e,t,s,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=be(e),this.strides=Qe(e),this.dataId=s,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const e=await this.data();return Bl.buffer(this.shape,this.dtype,e)}bufferSync(){return Bl.buffer(this.shape,this.dtype,this.dataSync())}async array(){const e=await this.data();return Xr(this.shape,e,this.dtype==="complex64")}arraySync(){return Xr(this.shape,this.dataSync(),this.dtype==="complex64")}async data(){this.throwIfDisposed();const e=qr().read(this.dataId);if(this.dtype==="string"){const t=await e;try{return t.map(s=>Uo(s))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return e}dataToGPU(e){return this.throwIfDisposed(),qr().readToGPU(this.dataId,e)}dataSync(){this.throwIfDisposed();const e=qr().readSync(this.dataId);if(this.dtype==="string")try{return e.map(t=>Uo(t))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}async bytes(){this.throwIfDisposed();const e=await qr().read(this.dataId);return this.dtype==="string"?e:new Uint8Array(e.buffer)}dispose(){this.isDisposed||(this.kerasMask&&this.kerasMask.dispose(),qr().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(e=!1){return Bl.print(this,e)}clone(){return this.throwIfDisposed(),Bl.clone(this)}toString(e=!1){const t=this.dataSync();return S_(t,this.shape,this.dtype,e)}cast(e){return this.throwIfDisposed(),Bl.cast(this,e)}variable(e=!0,t,s){return this.throwIfDisposed(),qr().makeVariable(this,e,t,s)}}Object.defineProperty(Sn,Symbol.hasInstance,{value:n=>!!n&&n.data!=null&&n.dataSync!=null&&n.throwIfDisposed!=null});function ve(){return Sb("Tensor",()=>Sn)}ve();class Kp extends Sn{constructor(e,t,s,r){super(e.shape,e.dtype,e.dataId,r),this.trainable=t,this.name=s}assign(e){if(e.dtype!==this.dtype)throw new Error(`dtype of the new value (${e.dtype}) and previous value (${this.dtype}) must match`);if(!At(e.shape,this.shape))throw new Error(`shape of the new value (${e.shape}) and previous value (${this.shape}) must match`);qr().disposeTensor(this),this.dataId=e.dataId,qr().incRef(this,null)}dispose(){qr().disposeVariable(this),this.isDisposedInternal=!0}}Object.defineProperty(Kp,Symbol.hasInstance,{value:n=>n instanceof Sn&&n.assign!=null&&n.assign instanceof Function});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var jS;(function(n){n.R0="R0",n.R1="R1",n.R2="R2",n.R3="R3",n.R4="R4",n.R5="R5",n.R6="R6"})(jS||(jS={}));var mv;(function(n){n.float32="float32",n.int32="int32",n.bool="int32",n.complex64="complex64"})(mv||(mv={}));var gv;(function(n){n.float32="float32",n.int32="int32",n.bool="bool",n.complex64="complex64"})(gv||(gv={}));var xv;(function(n){n.float32="float32",n.int32="float32",n.bool="float32",n.complex64="complex64"})(xv||(xv={}));var yv;(function(n){n.float32="complex64",n.int32="complex64",n.bool="complex64",n.complex64="complex64"})(yv||(yv={}));const $_={float32:xv,int32:mv,bool:gv,complex64:yv};function Ks(n,e){if(n==="string"||e==="string"){if(n==="string"&&e==="string")return"string";throw new Error(`Can not upcast ${n} with ${e}`)}return $_[n][e]}function h1(n){return Ks(n,"int32")}function X$(n){return n!=null&&typeof n=="object"&&"texture"in n&&n.texture instanceof WebGLTexture}function Y$(n){return typeof GPUBuffer<"u"&&n!=null&&typeof n=="object"&&"buffer"in n&&n.buffer instanceof GPUBuffer}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pn(n,e){if(n.dtype===e.dtype)return[n,e];const t=Ks(n.dtype,e.dtype);return[n.cast(t),e.cast(t)]}function Z$(n){const e=[];return J$(n,e,new Set),e}function J$(n,e,t){if(n==null)return;if(n instanceof Sn){e.push(n);return}if(!E_(n))return;const s=n;for(const r in s){const i=s[r];t.has(i)||(t.add(i),J$(i,e,t))}}function E_(n){return Array.isArray(n)||typeof n=="object"}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function m0(n){return n.kernelName!=null}class RS{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(e=>e.name)))}}}dispose(){for(const e in this.registeredVariables)this.registeredVariables[e].dispose()}}class ac{constructor(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new RS}async ready(){if(this.pendingBackendInit!=null)return this.pendingBackendInit.then(()=>{});if(this.backendInstance!=null)return;const e=this.getSortedBackends();for(let t=0;t<e.length;t++){const s=e[t];if(await this.initializeBackend(s).success){await this.setBackend(s);return}}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(this.pendingBackendInit!=null)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(this.backendInstance==null){const{name:e,asyncInit:t}=this.initializeBackendsAndReturnBest();if(t)throw new Error(`The highest priority backend '${e}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(e)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(e){if(!(e in this.registry))if(e in this.registryFactory){const{asyncInit:t}=this.initializeBackend(e);if(t)return null}else return null;return this.registry[e]}findBackendFactory(e){return e in this.registryFactory?this.registryFactory[e].factory:null}registerBackend(e,t,s=1){return e in this.registryFactory?(rr(`${e} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[e]={factory:t,priority:s},!0)}async setBackend(e){if(this.registryFactory[e]==null)throw new Error(`Backend name '${e}' not found in registry`);if(this.backendName=e,this.registry[e]==null){this.backendInstance=null;const{success:t,asyncInit:s}=this.initializeBackend(e);if(!(s?await t:t))return!1}return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new v_(this.backendInstance),!0}setupRegisteredKernels(){TS(this.backendName).forEach(t=>{t.setupFunc!=null&&t.setupFunc(this.backendInstance)})}disposeRegisteredKernels(e){TS(e).forEach(s=>{s.disposeFunc!=null&&s.disposeFunc(this.registry[e])})}initializeBackend(e){const t=this.registryFactory[e];if(t==null)throw new Error(`Cannot initialize backend ${e}, no registration found.`);try{const s=t.factory();if(s&&!(s instanceof vb)&&typeof s.then=="function"){const r=++this.pendingBackendInitId,i=s.then(o=>r<this.pendingBackendInitId?!1:(this.registry[e]=o,this.pendingBackendInit=null,!0)).catch(o=>(r<this.pendingBackendInitId||(this.pendingBackendInit=null,rr(`Initialization of backend ${e} failed`),rr(o.stack||o.message)),!1));return this.pendingBackendInit=i,{success:i,asyncInit:!0}}else return this.registry[e]=s,{success:!0,asyncInit:!1}}catch(s){return rr(`Initialization of backend ${e} failed`),rr(s.stack||s.message),{success:!1,asyncInit:!1}}}removeBackend(e){if(!(e in this.registryFactory))throw new Error(`${e} backend not found in registry`);this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((e,t)=>this.registryFactory[t].priority-this.registryFactory[e].priority)}initializeBackendsAndReturnBest(){const e=this.getSortedBackends();for(let t=0;t<e.length;t++){const s=e[t],{success:r,asyncInit:i}=this.initializeBackend(s);if(i||r)return{name:s,asyncInit:i}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(e,t){const s=this.state.tensorInfo.get(t),r=s.backend,i=this.readSync(t),o=r.refCount(t);r.disposeData(t,!0),s.backend=e,e.move(t,i,s.shape,s.dtype,o),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(e,t){let s=null;if(t==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");t=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof t!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");s=e}let r;return this.scopedRun(()=>this.startScope(s),()=>this.endScope(r),()=>(r=t(),r instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),r))}scopedRun(e,t,s){e();try{const r=s();return t(),r}catch(r){throw t(),r}}nextTensorId(){return ac.nextTensorId++}nextVariableId(){return ac.nextVariableId++}clone(e){const t=re.runKernel(_d,{x:e}),s={x:e},r=o=>({x:()=>{const a="float32",l={x:o},u={dtype:a};return re.runKernel(Id,l,u)}}),i=[];return this.addTapeNode(this.state.activeScope.name,s,[t],r,i,{}),t}runKernel(e,t,s){if(this.backendName==null&&this.backend,!(NS(e,this.backendName)!=null))throw new Error(`Kernel '${e}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:e,inputs:t,attrs:s})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(e,t,s){const r=this.backend.numDataIds();let i=0;s.forEach(l=>{i+=l.dtype==="complex64"?3:1});const o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],a=r-t-i-o;if(a>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${a} data ids) after running '${e}'`)}runKernelFunc(e){let t,s=[];const r=this.isTapeOn(),i=this.state.numBytes,o=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);let a;this.backendName==null&&this.backend;let l;const u=m0(e)?e.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(m0(e)){const{kernelName:x,inputs:y,attrs:b}=e;this.backendName==null&&this.backend;const k=NS(x,this.backendName);V(k!=null,()=>`Cannot find registered kernel '${x}' for backend '${this.backendName}'`),a=()=>{const w=this.backend.numDataIds();l=k.kernelFunc({inputs:y,attrs:b,backend:this.backend});const N=Array.isArray(l)?l:[l];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(x,w,N);const C=N.map(S=>S.rank!=null?S:this.makeTensorFromTensorInfo(S));if(r){const S=this.getTensorsForGradient(x,y,C);s=this.saveTensorsForBackwardMode(S)}return C}}else{const{forwardFunc:x}=e,y=b=>{r&&(s=b.map(k=>this.keep(this.clone(k))))};a=()=>{const b=this.backend.numDataIds();l=this.tidy(()=>x(this.backend,y));const k=Array.isArray(l)?l:[l];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(u,b,k),k}}const{inputs:d,attrs:f}=e,p=m0(e)?null:e.backwardsFunc;let g;return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{!this.ENV.getBool("DEBUG")&&!this.state.profiling?t=a():(g=this.profiler.profileKernel(u,d,()=>a()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(g),t=g.outputs)}),r&&this.addTapeNode(u,d,t,p,s,f),this.state.profiling&&this.state.activeProfile.kernels.push({name:u,bytesAdded:this.state.numBytes-i,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-o,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(d).map(x=>d[x]!=null?d[x].shape:null),outputShapes:t.map(x=>x.shape),kernelTimeMs:g.timeMs,extraInfo:g.extraInfo}),Array.isArray(l)?t:t[0]}saveTensorsForBackwardMode(e){return e.map(s=>this.keep(this.clone(s)))}getTensorsForGradient(e,t,s){const r=IS(e);if(r!=null){const i=r.inputsToSave||[],o=r.outputsToSave||[];let a;r.saveAllInputs?(V(Array.isArray(t),()=>"saveAllInputs is true, expected inputs to be an array."),a=Object.keys(t).map(u=>t[u])):a=i.map(u=>t[u]);const l=s.filter((u,d)=>o[d]);return a.concat(l)}return[]}makeTensor(e,t,s,r){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");s=s||"float32",r=r||this.backend;let i=e;s==="string"&&yd(e[0])&&(i=e.map(l=>zo(l)));const o=r.write(i,t,s),a=new Sn(t,s,o,this.nextTensorId());if(this.trackTensor(a,r),s==="string"){const l=this.state.tensorInfo.get(o),u=XO(i);this.state.numBytes+=u-l.bytes,l.bytes=u}return a}makeTensorFromDataId(e,t,s,r){s=s||"float32";const i={dataId:e,shape:t,dtype:s};return this.makeTensorFromTensorInfo(i,r)}makeTensorFromTensorInfo(e,t){const{dataId:s,shape:r,dtype:i}=e,o=new Sn(r,i,s,this.nextTensorId());return this.trackTensor(o,t),o}makeVariable(e,t=!0,s,r){s=s||this.nextVariableId().toString(),r!=null&&r!==e.dtype&&(e=e.cast(r));const i=new Kp(e,t,s,this.nextTensorId());if(this.state.registeredVariables[i.name]!=null)throw new Error(`Variable with name ${i.name} was already registered`);return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i}trackTensor(e,t){this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++;let s=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(s=e.size*Up(e.dtype)),this.state.numBytes+=s,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:s})),e instanceof Kp||this.track(e)}incRef(e,t){this.trackTensor(e,t),this.backend.incRef(e.dataId)}removeDataId(e,t){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===t&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}disposeTensor(e){if(!this.state.tensorInfo.has(e.dataId))return;const t=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,e.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=t.bytes),e.dtype!=="complex64"&&e.dtype!=="string"){const s=e.size*Up(e.dtype);this.state.numBytes-=s}t.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,t.backend)}disposeVariables(){for(const e in this.state.registeredVariables){const t=this.state.registeredVariables[e];this.disposeVariable(t)}}disposeVariable(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]}memory(){const e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}async profile(e){this.state.profiling=!0;const t=this.state.numBytes,s=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(r=>r.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-s;for(const r of this.state.activeProfile.kernels)r.kernelTimeMs=await r.kernelTimeMs,r.extraInfo=await r.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&this.state.kernelDepth===0}addTapeNode(e,t,s,r,i,o){const a={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:s,saved:i},l=IS(e);l!=null&&(r=l.gradFunc),r!=null&&(a.gradient=u=>(u=u.map((d,f)=>{if(d==null){const p=s[f],g=ns(p.size,p.dtype);return this.makeTensor(g,p.shape,p.dtype)}return d}),r(u.length>1?u:u[0],i,o))),this.state.activeTape.push(a)}keep(e){return e.kept=!0,e}startTape(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(e){const t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t}endScope(e){const t=Z$(e),s=new Set(t.map(i=>i.id));for(let i=0;i<this.state.activeScope.track.length;i++){const o=this.state.activeScope.track[i];!o.kept&&!s.has(o.id)&&o.dispose()}const r=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],t.forEach(i=>{!i.kept&&i.scopeId===r.id&&this.track(i)})}gradients(e,t,s,r=!1){if(V(t.length>0,()=>"gradients() received an empty list of xs."),s!=null&&s.dtype!=="float32")throw new Error(`dy must have 'float32' dtype, but has '${s.dtype}'`);const i=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",e));V(i instanceof Sn,()=>"The result y returned by f() must be a tensor.");const o=k_(this.state.activeTape,t,i);if(!r&&o.length===0&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{const a={};a[i.id]=s??A_(i.shape),C_(a,o,u=>this.tidy(u),j_);const l=t.map(u=>a[u.id]);return this.state.gradientDepth===0&&(this.state.activeTape.forEach(u=>{for(const d of u.saved)d.dispose()}),this.state.activeTape=null),{value:i,grads:l}})}customGrad(e){return V(cv(e),()=>"The f passed in customGrad(f) must be a function."),(...t)=>{V(t.every(a=>a instanceof Sn),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");let s;const r={};t.forEach((a,l)=>{r[l]=a});const i=(a,l)=>(s=e(...t,l),V(s.value instanceof Sn,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),V(cv(s.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),s.value),o=(a,l)=>{const u=s.gradFunc(a,l),d=Array.isArray(u)?u:[u];V(d.length===t.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),V(d.every(p=>p instanceof Sn),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");const f={};return d.forEach((p,g)=>{f[g]=()=>p}),f};return this.runKernelFunc({forwardFunc:i,backwardsFunc:o,inputs:r})}}readSync(e){return this.state.tensorInfo.get(e).backend.readSync(e)}read(e){return this.state.tensorInfo.get(e).backend.read(e)}readToGPU(e,t){return this.state.tensorInfo.get(e).backend.readToGPU(e,t)}async time(e){const t=$s(),s=await this.backend.time(e);return s.wallMs=$s()-t,s}track(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new RS;for(const e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}ac.nextTensorId=0;ac.nextVariableId=0;function A_(n){const e=kb(be(n),"float32");return re.makeTensor(e,n,"float32")}function eE(){const n=b$();if(n._tfengine==null){const e=new JO(n);n._tfengine=new ac(e)}return s_(n._tfengine.ENV),I_(()=>n._tfengine),n._tfengine}const re=eE();function j_(n,e){const t={a:n,b:e};return re.runKernel(Tc,t)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function R_(){return typeof navigator<"u"&&navigator!=null}function tE(n){if(n||R_()){if(n||(n=navigator),n.product==="ReactNative")return!0;const e=n.userAgent||n.vendor||(typeof window<"u"?window.opera:"");if(!e){const t=n;return t.userAgentData&&t.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}return!1}function nE(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ds=me();Ds.registerFlag("DEBUG",()=>!1,n=>{n&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});Ds.registerFlag("IS_BROWSER",()=>nE());Ds.registerFlag("IS_NODE",()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u");Ds.registerFlag("IS_CHROME",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor));Ds.registerFlag("IS_SAFARI",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor));Ds.registerFlag("PROD",()=>!1);Ds.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>Ds.getBool("DEBUG"));Ds.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0);Ds.registerFlag("IS_TEST",()=>!1);Ds.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",()=>Ds.getBool("DEBUG"));Ds.registerFlag("WRAP_TO_IMAGEBITMAP",()=>!1);Ds.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",()=>!1);Ds.registerFlag("USE_SETTIMEOUTCUSTOM",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Og(n,e){let t=n;if(Tr(n))return e==="string"?[]:[n.length];if(X$(n)){const r=n.channels||"RGBA";return[n.height,n.width*r.length]}else if(Y$(n))return[n.buffer.size/(e==null?4:Up(e))];if(!Array.isArray(n))return[];const s=[];for(;Array.isArray(t)||Tr(t)&&e!=="string";)s.push(t.length),t=t[0];return Array.isArray(n)&&me().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&sE(n,s,[]),s}function sE(n,e,t){if(t=t||[],!Array.isArray(n)&&!Tr(n)){V(e.length===0,()=>`Element arr[${t.join("][")}] is a primitive, but should be an array/TypedArray of ${e[0]} elements`);return}V(e.length>0,()=>`Element arr[${t.join("][")}] should be a primitive, but is an array of ${n.length} elements`),V(n.length===e[0],()=>`Element arr[${t.join("][")}] should have ${e[0]} elements, but has ${n.length} elements`);const s=e.slice(1);for(let r=0;r<n.length;++r)sE(n[r],s,t.concat(r))}function DS(n,e,t,s){if(n!=="string_or_numeric"){if(n==null)throw new Error("Expected dtype cannot be null.");if(n!=="numeric"&&n!==e||n==="numeric"&&e==="string")throw new Error(`Argument '${t}' passed to '${s}' must be ${n} tensor, but got ${e} tensor`)}}function Z(n,e,t,s="numeric"){if(n instanceof ve())return DS(s,n.dtype,e,t),n;let r=Nc(n);if(r!=="string"&&["bool","int32","float32"].indexOf(s)>=0&&(r=s),DS(s,r,e,t),n==null||!Tr(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string"){const l=n==null?"null":n.constructor.name;throw new Error(`Argument '${e}' passed to '${t}' must be a Tensor or TensorLike, but got '${l}'`)}const i=Og(n,r);!Tr(n)&&!Array.isArray(n)&&(n=[n]);const a=r!=="string"?tl(n,r):za(n,[],!0);return re.makeTensor(a,i,r)}function rE(n,e,t,s="numeric"){if(!Array.isArray(n))throw new Error(`Argument ${e} passed to ${t} must be a \`Tensor[]\` or \`TensorLike[]\``);return n.map((i,o)=>Z(i,`${e}[${o}]`,t,s))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const D_="__op";function oe(n){const e=Object.keys(n);if(e.length!==1)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${e.length} keys.`);let t=e[0];const s=n[t];t.endsWith("_")&&(t=t.substring(0,t.length-1)),t=t+D_;const r=(...i)=>{re.startScope(t);try{const o=s(...i);return Cb(o)&&console.error("Cannot return a Promise inside of tidy."),re.endScope(o),o}catch(o){throw re.endScope(null),o}};return Object.defineProperty(r,"name",{value:t,configurable:!0}),r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function P_(n,e){const t=Z(n,"real","complex"),s=Z(e,"imag","complex");wb(t.shape,s.shape,`real and imag shapes, ${t.shape} and ${s.shape}, must match in call to tf.complex().`);const r={real:t,imag:s};return re.runKernel(Rb,r)}const Ba=oe({complex_:P_});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _g(n,e,t,s){if(s==null)s=Nc(n);else if(s==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(Y$(n)||X$(n)){if(s!=="float32"&&s!=="int32")throw new Error(`Creating tensor from GPU data only supports 'float32'|'int32' dtype, while the dtype is ${s}.`);return re.backend.createTensorFromGPUData(n,e||t,s)}if(!Tr(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){ao(e);const r=be(e),i=be(t);V(r===i,()=>`Based on the provided shape, [${e}], the tensor should have ${r} values but has ${i}`);for(let o=0;o<t.length;++o){const a=t[o],l=o===t.length-1?a!==be(e.slice(o)):!0;V(t[o]===e[o]||!l,()=>`Error creating a new Tensor. Inferred shape (${t}) does not match the provided shape (${e}). `)}}return!Tr(n)&&!Array.isArray(n)&&(n=[n]),e=e||t,n=s!=="string"?tl(n,s):za(n,[],!0),re.makeTensor(n,e,s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uu(n,e,t){const s=Og(n,t);return _g(n,e,s,t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qp={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8};class Zo{static join(e){return new Zo(e).slice()}constructor(e){if(this.shards=[],this.previousShardIndex=0,e==null||(e instanceof Array||(e=[e]),e=e.map(s=>Tr(s)?s.buffer:s),e.length===0))return;this.bufferUniformSize=e[0].byteLength;let t=0;for(let s=0;s<e.length;s++){const r=e[s];s!==e.length-1&&r.byteLength!==this.bufferUniformSize&&(this.bufferUniformSize=void 0);const i=t+r.byteLength;this.shards.push({buffer:r,start:t,end:i}),t=i}this.shards.length===0&&(this.byteLength=0),this.byteLength=this.shards[this.shards.length-1].end}slice(e=0,t=this.byteLength){if(this.shards.length===0)return new ArrayBuffer(0);if(e=isNaN(Number(e))?0:e,t=isNaN(Number(t))?0:t,e=Math.max(0,e),t=Math.min(this.byteLength,t),t<=e)return new ArrayBuffer(0);const s=this.findShardForByte(e);if(s===-1)throw new Error(`Could not find start shard for byte ${e}`);const r=t-e,i=new ArrayBuffer(r),o=new Uint8Array(i);let a=0;for(let l=s;l<this.shards.length;l++){const u=this.shards[l],f=e+a-u.start,p=a,x=Math.min(t,u.end)-u.start,y=new Uint8Array(u.buffer,f,x-f);if(o.set(y,p),a+=y.length,t<u.end)break}return i}findShardForByte(e){if(this.shards.length===0||e<0||e>=this.byteLength)return-1;if(this.bufferUniformSize!=null)return this.previousShardIndex=Math.floor(e/this.bufferUniformSize),this.previousShardIndex;function t(r){return e<r.start?-1:e>=r.end?1:0}if(t(this.shards[this.previousShardIndex])===0)return this.previousShardIndex;const s=M_(this.shards,t);return s===-1?-1:(this.previousShardIndex=s,this.previousShardIndex)}}function M_(n,e){let t=0,s=n.length;for(;t<=s;){const r=Math.floor((s-t)/2)+t,i=e(n[r]);if(i===0)return r;i<0?s=r:t=r+1}return-1}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pi(){return re}function PS(){return re.memory()}function de(n,e){return re.tidy(n,e)}function ct(n){Z$(n).forEach(t=>t.dispose())}function ki(n){return re.keep(n)}function iE(n,e,t=1){return re.registerBackend(n,e,t)}function L_(){return re.backend}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lc=4;async function MS(n,e){const t=[],s=[],r=Array.isArray(n)?n.map(o=>o.name):Object.keys(n);for(let o=0;o<r.length;++o){const a=r[o],l=Array.isArray(n)?n[o].tensor:n[a];if(l.dtype!=="float32"&&l.dtype!=="int32"&&l.dtype!=="bool"&&l.dtype!=="string"&&l.dtype!=="complex64")throw new Error(`Unsupported dtype in weight '${a}': ${l.dtype}`);const u={name:a,shape:l.shape,dtype:l.dtype};if(l.dtype==="string"){const d=new Promise(async f=>{const p=await l.bytes(),g=p.reduce((b,k)=>b+k.length,0)+lc*p.length,x=new Uint8Array(g);let y=0;for(let b=0;b<p.length;b++){const k=p[b],w=new Uint8Array(new Uint32Array([k.length]).buffer);x.set(w,y),y+=lc,x.set(k,y),y+=k.length}f(x)});s.push(d)}else s.push(l.data());e!=null&&(u.group=e),t.push(u)}const i=await Promise.all(s);return{data:z_(i),specs:t}}function F_(n,e){const t=new Zo(n),s={};let r=0;for(const i of e){const o=O_(i,(a,l)=>t.slice(r+a,r+l));s[i.name]=__(i,t.slice(r,r+o)),r+=o}return s}function O_(n,e){const t=be(n.shape);let s;if("quantization"in n){const r=n.quantization;s=Qp[r.dtype]}else if(n.dtype==="string"){let r=0;for(let i=0;i<t;i++)r+=lc+new Uint32Array(e(r,r+lc))[0];return r}else s=Qp[n.dtype];return t*s}function __(n,e){const t=n.name,s=n.dtype,r=n.shape,i=be(r);let o,a=0;if("quantization"in n){const l=n.quantization;if(l.dtype==="uint8"||l.dtype==="uint16"){if(!("min"in l&&"scale"in l))throw new Error(`Weight ${n.name} with quantization ${l.dtype} doesn't have corresponding metadata min and scale.`)}else if(l.dtype==="float16"){if(s!=="float32")throw new Error(`Weight ${n.name} is quantized with ${l.dtype} which only supports weights of type float32 not ${s}.`)}else throw new Error(`Weight ${n.name} has unknown quantization dtype ${l.dtype}. Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.`);const u=Qp[l.dtype],d=l.dtype==="uint8"?new Uint8Array(e):new Uint16Array(e);if(s==="float32")if(l.dtype==="uint8"||l.dtype==="uint16"){o=new Float32Array(d.length);for(let f=0;f<d.length;f++){const p=d[f];o[f]=p*l.scale+l.min}}else if(l.dtype==="float16")o=X_()(d);else throw new Error(`Unsupported quantization type ${l.dtype} for weight type float32.`);else if(s==="int32"){if(l.dtype!=="uint8"&&l.dtype!=="uint16")throw new Error(`Unsupported quantization type ${l.dtype} for weight type int32.`);o=new Int32Array(d.length);for(let f=0;f<d.length;f++){const p=d[f];o[f]=Math.round(p*l.scale+l.min)}}else throw new Error(`Unsupported dtype in weight '${t}': ${s}`);a+=i*u}else if(s==="string"){const l=be(n.shape);o=[];for(let u=0;u<l;u++){const d=new Uint32Array(e.slice(a,a+lc))[0];a+=lc;const f=new Uint8Array(e.slice(a,a+d));o.push(f),a+=d}}else{const l=Qp[s];if(s==="float32")o=new Float32Array(e);else if(s==="int32")o=new Int32Array(e);else if(s==="bool")o=new Uint8Array(e);else if(s==="complex64"){o=new Float32Array(e);const u=new Float32Array(o.length/2),d=new Float32Array(o.length/2);for(let x=0;x<u.length;x++)u[x]=o[x*2],d[x]=o[x*2+1];const f=Uu(u,r,"float32"),p=Uu(d,r,"float32"),g=Ba(f,p);return f.dispose(),p.dispose(),g}else throw new Error(`Unsupported dtype in weight '${t}': ${s}`);a+=i*l}return Uu(o,r,s)}function z_(n){if(n===null)throw new Error(`Invalid input value: ${JSON.stringify(n)}`);let e=0;const t=[];n.forEach(i=>{if(e+=i.byteLength,t.push(i.byteLength===i.buffer.byteLength?i:new i.constructor(i)),!(i instanceof Float32Array||i instanceof Int32Array||i instanceof Uint8Array))throw new Error(`Unsupported TypedArray subtype: ${i.constructor.name}`)});const s=new Uint8Array(e);let r=0;return t.forEach(i=>{s.set(new Uint8Array(i.buffer),r),r+=i.byteLength}),s.buffer}const f1=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function LS(n){return f1?Buffer.byteLength(n,"utf8"):new Blob([n]).size}function B_(n){if(f1)return Buffer.from(n).toString("base64");const e=new Uint8Array(n);let t="";for(let s=0,r=e.length;s<r;s++)t+=String.fromCharCode(e[s]);return btoa(t)}function W_(n){if(f1){const s=Buffer.from(n,"base64");return s.buffer.slice(s.byteOffset,s.byteOffset+s.byteLength)}const e=atob(n),t=new Uint8Array(e.length);for(let s=0;s<e.length;++s)t.set([e.charCodeAt(s)],s);return t.buffer}function V_(n){return Zo.join(n)}function U_(n,e){const t={modelTopology:n.modelTopology,format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy,weightsManifest:e};return n.signature!=null&&(t.signature=n.signature),n.userDefinedMetadata!=null&&(t.userDefinedMetadata=n.userDefinedMetadata),n.modelInitializer!=null&&(t.modelInitializer=n.modelInitializer),n.initializerSignature!=null&&(t.initializerSignature=n.initializerSignature),n.trainingConfig!=null&&(t.trainingConfig=n.trainingConfig),t}function G_(n,e,t){const s={modelTopology:n.modelTopology,format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy};if(n.trainingConfig!=null&&(s.trainingConfig=n.trainingConfig),n.weightsManifest!=null){if(!e)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!t)throw new Error("modelJSON has weightsManifest but weightData is null");s.weightSpecs=e,s.weightData=t}return n.signature!=null&&(s.signature=n.signature),n.userDefinedMetadata!=null&&(s.userDefinedMetadata=n.userDefinedMetadata),n.modelInitializer!=null&&(s.modelInitializer=n.modelInitializer),n.initializerSignature!=null&&(s.initializerSignature=n.initializerSignature),s}async function H_(n,e){let t,s;return n.weightsManifest!=null&&([t,s]=await e(n.weightsManifest)),G_(n,t,s)}function p1(n){if(n.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:n.modelTopology==null?0:LS(JSON.stringify(n.modelTopology)),weightSpecsBytes:n.weightSpecs==null?0:LS(JSON.stringify(n.weightSpecs)),weightDataBytes:n.weightData==null?0:new Zo(n.weightData).byteLength}}function FS(n){const e=[];for(const t of n)e.push(...t.weights);return e}function q_(){const n=t=>{let s=t<<13,r=0;for(;(s&8388608)===0;)r-=8388608,s<<=1;return s&=-8388609,r+=947912704,s|r},e=new Uint32Array(2048);e[0]=0;for(let t=1;t<1024;t++)e[t]=n(t);for(let t=1024;t<2048;t++)e[t]=939524096+(t-1024<<13);return e}function K_(){const n=new Uint32Array(64);n[0]=0,n[31]=1199570944,n[32]=2147483648,n[63]=3347054592;for(let e=1;e<31;e++)n[e]=e<<23;for(let e=33;e<63;e++)n[e]=2147483648+(e-32<<23);return n}function Q_(){const n=new Uint32Array(64);for(let e=0;e<64;e++)n[e]=1024;return n[0]=n[32]=0,n}function X_(){const n=q_(),e=K_(),t=Q_();return s=>{const r=new ArrayBuffer(4*s.length),i=new Uint32Array(r);for(let o=0;o<s.length;o++){const a=s[o],l=n[t[a>>10]+(a&1023)]+e[a>>10];i[o]=l}return new Float32Array(r)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Mn{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return Mn.instance==null&&(Mn.instance=new Mn),Mn.instance}static registerSaveRouter(e){Mn.getInstance().saveRouters.push(e)}static registerLoadRouter(e){Mn.getInstance().loadRouters.push(e)}static getSaveHandlers(e){return Mn.getHandlers(e,"save")}static getLoadHandlers(e,t){return Mn.getHandlers(e,"load",t)}static getHandlers(e,t,s){const r=[];return(t==="load"?Mn.getInstance().loadRouters:Mn.getInstance().saveRouters).forEach(o=>{const a=o(e,s);a!==null&&r.push(a)}),r}}const Y_=n=>Mn.getSaveHandlers(n),Z_=(n,e)=>Mn.getLoadHandlers(n,e);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vv="tensorflowjs",bv=1,ja="models_store",Mo="model_info_store";function oE(){if(!me().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");const n=typeof window>"u"?self:window,e=n.indexedDB||n.mozIndexedDB||n.webkitIndexedDB||n.msIndexedDB||n.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function wv(n){const e=n.result;e.createObjectStore(ja,{keyPath:"modelPath"}),e.createObjectStore(Mo,{keyPath:"modelPath"})}class Wa{constructor(e){if(this.indexedDB=oE(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,e)}async load(){return this.databaseAction(this.modelPath)}databaseAction(e,t){return new Promise((s,r)=>{const i=this.indexedDB.open(vv,bv);i.onupgradeneeded=()=>wv(i),i.onsuccess=()=>{const o=i.result;if(t==null){const a=o.transaction(ja,"readonly"),u=a.objectStore(ja).get(this.modelPath);u.onsuccess=()=>{if(u.result==null)return o.close(),r(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));s(u.result.modelArtifacts)},u.onerror=d=>(o.close(),r(u.error)),a.oncomplete=()=>o.close()}else{t.weightData=Zo.join(t.weightData);const a=p1(t),l=o.transaction(Mo,"readwrite");let u=l.objectStore(Mo),d;try{d=u.put({modelPath:this.modelPath,modelArtifactsInfo:a})}catch(p){return r(p)}let f;d.onsuccess=()=>{f=o.transaction(ja,"readwrite");const p=f.objectStore(ja);let g;try{g=p.put({modelPath:this.modelPath,modelArtifacts:t,modelArtifactsInfo:a})}catch(x){return r(x)}g.onsuccess=()=>s({modelArtifactsInfo:a}),g.onerror=x=>{u=l.objectStore(Mo);const y=u.delete(this.modelPath);y.onsuccess=()=>(o.close(),r(g.error)),y.onerror=b=>(o.close(),r(g.error))}},d.onerror=p=>(o.close(),r(d.error)),l.oncomplete=()=>{f==null?o.close():f.oncomplete=()=>o.close()}}},i.onerror=o=>r(i.error)})}}Wa.URL_SCHEME="indexeddb://";const aE=n=>me().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(Wa.URL_SCHEME)?J_(n.slice(Wa.URL_SCHEME.length)):null;Mn.registerSaveRouter(aE);Mn.registerLoadRouter(aE);function J_(n){return new Wa(n)}function ez(n){return n.startsWith(Wa.URL_SCHEME)?n.slice(Wa.URL_SCHEME.length):n}class tz{constructor(){this.indexedDB=oE()}async listModels(){return new Promise((e,t)=>{const s=this.indexedDB.open(vv,bv);s.onupgradeneeded=()=>wv(s),s.onsuccess=()=>{const r=s.result,i=r.transaction(Mo,"readonly"),a=i.objectStore(Mo).getAll();a.onsuccess=()=>{const l={};for(const u of a.result)l[u.modelPath]=u.modelArtifactsInfo;e(l)},a.onerror=l=>(r.close(),t(a.error)),i.oncomplete=()=>r.close()},s.onerror=r=>t(s.error)})}async removeModel(e){return e=ez(e),new Promise((t,s)=>{const r=this.indexedDB.open(vv,bv);r.onupgradeneeded=()=>wv(r),r.onsuccess=()=>{const i=r.result,o=i.transaction(Mo,"readwrite"),a=o.objectStore(Mo),l=a.get(e);let u;l.onsuccess=()=>{if(l.result==null)return i.close(),s(new Error(`Cannot find model with path '${e}' in IndexedDB.`));{const d=a.delete(e),f=()=>{u=i.transaction(ja,"readwrite");const g=u.objectStore(ja).delete(e);g.onsuccess=()=>t(l.result.modelArtifactsInfo),g.onerror=x=>s(l.error)};d.onsuccess=f,d.onerror=p=>(f(),i.close(),s(l.error))}},l.onerror=d=>(i.close(),s(l.error)),o.oncomplete=()=>{u==null?i.close():u.oncomplete=()=>i.close()}},r.onerror=i=>s(r.error)})}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ki="/",Wl="tensorflowjs_models",lE="info",nz="model_topology",sz="weight_specs",rz="weight_data",iz="model_metadata";function cE(n){return{info:[Wl,n,lE].join(Ki),topology:[Wl,n,nz].join(Ki),weightSpecs:[Wl,n,sz].join(Ki),weightData:[Wl,n,rz].join(Ki),modelMetadata:[Wl,n,iz].join(Ki)}}function uE(n){for(const e of Object.values(n))window.localStorage.removeItem(e)}function oz(n){const e=n.split(Ki);if(e.length<3)throw new Error(`Invalid key format: ${n}`);return e.slice(1,e.length-1).join(Ki)}function az(n){return n.startsWith(Va.URL_SCHEME)?n.slice(Va.URL_SCHEME.length):n}class Va{constructor(e){if(!me().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=cE(this.modelPath)}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{const t=JSON.stringify(e.modelTopology),s=JSON.stringify(e.weightSpecs),r=p1(e),i=Zo.join(e.weightData);try{this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,s),this.LS.setItem(this.keys.weightData,B_(i));const o={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:e.signature!=null?e.signature:void 0,userDefinedMetadata:e.userDefinedMetadata!=null?e.userDefinedMetadata:void 0,modelInitializer:e.modelInitializer!=null?e.modelInitializer:void 0,initializerSignature:e.initializerSignature!=null?e.initializerSignature:void 0,trainingConfig:e.trainingConfig!=null?e.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(o)),{modelArtifactsInfo:r}}catch{throw uE(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${r.modelTopologyBytes}, weightSpecsBytes=${r.weightSpecsBytes}, weightDataBytes=${r.weightDataBytes}.`)}}}async load(){const e=JSON.parse(this.LS.getItem(this.keys.info));if(e==null)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");const t={},s=JSON.parse(this.LS.getItem(this.keys.topology));if(s==null)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);t.modelTopology=s;const r=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(r==null)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);t.weightSpecs=r;const i=this.LS.getItem(this.keys.modelMetadata);if(i!=null){const a=JSON.parse(i);t.format=a.format,t.generatedBy=a.generatedBy,t.convertedBy=a.convertedBy,a.signature!=null&&(t.signature=a.signature),a.userDefinedMetadata!=null&&(t.userDefinedMetadata=a.userDefinedMetadata),a.modelInitializer!=null&&(t.modelInitializer=a.modelInitializer),a.initializerSignature!=null&&(t.initializerSignature=a.initializerSignature),a.trainingConfig!=null&&(t.trainingConfig=a.trainingConfig)}const o=this.LS.getItem(this.keys.weightData);if(o==null)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return t.weightData=W_(o),t}}Va.URL_SCHEME="localstorage://";const dE=n=>me().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(Va.URL_SCHEME)?lz(n.slice(Va.URL_SCHEME.length)):null;Mn.registerSaveRouter(dE);Mn.registerLoadRouter(dE);function lz(n){return new Va(n)}class cz{constructor(){V(me().getBool("IS_BROWSER"),()=>"Current environment is not a web browser"),V(typeof window>"u"||typeof window.localStorage<"u",()=>"Current browser does not appear to support localStorage"),this.LS=window.localStorage}async listModels(){const e={},t=Wl+Ki,s=Ki+lE;for(let r=0;r<this.LS.length;++r){const i=this.LS.key(r);if(i.startsWith(t)&&i.endsWith(s)){const o=oz(i);e[o]=JSON.parse(this.LS.getItem(i))}}return e}async removeModel(e){e=az(e);const t=cE(e);if(this.LS.getItem(t.info)==null)throw new Error(`Cannot find model at path '${e}'`);const s=JSON.parse(this.LS.getItem(t.info));return uE(t),s}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xl="://";class Hs{constructor(){this.managers={}}static getInstance(){return Hs.instance==null&&(Hs.instance=new Hs),Hs.instance}static registerManager(e,t){V(e!=null,()=>"scheme must not be undefined or null."),e.endsWith(Xl)&&(e=e.slice(0,e.indexOf(Xl))),V(e.length>0,()=>"scheme must not be an empty string.");const s=Hs.getInstance();V(s.managers[e]==null,()=>`A model store manager is already registered for scheme '${e}'.`),s.managers[e]=t}static getManager(e){const t=Hs.getInstance().managers[e];if(t==null)throw new Error(`Cannot find model manager for scheme '${e}'`);return t}static getSchemes(){return Object.keys(Hs.getInstance().managers)}}function uz(n){if(n.indexOf(Xl)===-1)throw new Error(`The url string provided does not contain a scheme. Supported schemes are: ${Hs.getSchemes().join(",")}`);return{scheme:n.split(Xl)[0],path:n.split(Xl)[1]}}async function dz(){const n=Hs.getSchemes(),e={};for(const t of n){const s=await Hs.getManager(t).listModels();for(const r in s){const i=t+Xl+r;e[i]=s[r]}}return e}async function hz(n){const e=uz(n);return Hs.getManager(e.scheme).removeModel(e.path)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class fz{constructor(){this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}fetch(e,t){return fetch(e,t)}now(){return performance.now()}encode(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error(`Browser's encoder only supports utf-8, but got ${t}`);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}decode(e,t){return new TextDecoder(t).decode(e)}setTimeoutCustom(e,t){if(typeof window>"u"||!me().getBool("USE_SETTIMEOUTCUSTOM")){setTimeout(e,t);return}this.functionRefs.push(e),setTimeout(()=>{window.postMessage({name:this.messageName,index:this.functionRefs.length-1},"*")},t),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",s=>{if(s.source===window&&s.data.name===this.messageName){s.stopPropagation();const r=this.functionRefs[s.data.index];r(),this.handledMessageCount++,this.handledMessageCount===this.functionRefs.length&&(this.functionRefs=[],this.handledMessageCount=0)}},!0))}isTypedArray(e){return U$(e)}}if(me().get("IS_BROWSER")){me().setPlatform("browser",new fz);try{Hs.registerManager(Va.URL_SCHEME,new cz)}catch{}try{Hs.registerManager(Wa.URL_SCHEME,new tz)}catch{}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pz={importFetch:()=>require("node-fetch")};let g0;class mz{constructor(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}fetch(e,t){return me().global.fetch!=null?me().global.fetch(e,t):(g0==null&&(g0=pz.importFetch()),g0(e,t))}now(){const e=process.hrtime();return e[0]*1e3+e[1]/1e6}encode(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error(`Node built-in encoder only supports utf-8, but got ${t}`);return this.textEncoder.encode(e)}decode(e,t){return e.length===0?"":new this.util.TextDecoder(t).decode(e)}isTypedArray(e){return this.util.types.isFloat32Array(e)||this.util.types.isInt32Array(e)||this.util.types.isUint8Array(e)||this.util.types.isUint8ClampedArray(e)}}me().get("IS_NODE")&&!me().get("IS_BROWSER")&&me().setPlatform("node",new mz);/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dt(n,e="float32",t){return e=e||"float32",ao(n),new Kn(n,e,t)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gz(n,e){const t=Z(n,"x","cast");if(!QO(e))throw new Error(`Failed to cast to unknown dtype ${e}`);if(e==="string"&&t.dtype!=="string"||e!=="string"&&t.dtype==="string")throw new Error("Only strings can be casted to strings");const s={x:t},r={dtype:e};return re.runKernel(Id,s,r)}const Fe=oe({cast_:gz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xz(n){const t={x:Z(n,"x","clone","string_or_numeric")};return re.runKernel(_d,t)}const Pa=oe({clone_:xz});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yz(n,e=!1){console.log(n.toString(e))}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */eE();const vz={buffer:dt,cast:Fe,clone:Pa,print:yz};T_(vz);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bz(n,e){let t=Z(n,"a","add"),s=Z(e,"b","add");[t,s]=pn(t,s);const r={a:t,b:s};return re.runKernel(Tc,r)}const $e=oe({add_:bz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wz(n,e){let t=Z(n,"a","floorDiv"),s=Z(e,"b","floorDiv");[t,s]=pn(t,s);const r={a:t,b:s};return re.runKernel(Fd,r)}const hE=oe({floorDiv_:wz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kz(n,e){let t=Z(n,"a","div"),s=Z(e,"b","div");if([t,s]=pn(t,s),t.dtype==="int32"&&s.dtype==="int32")return hE(t,s);const r={a:t,b:s},i={};return re.runKernel(jd,r,i)}const Ze=oe({div_:kz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cz(n,e){let t=Z(n,"a","mul"),s=Z(e,"b","mul");[t,s]=pn(t,s);const r={a:t,b:s};return re.runKernel(Kd,r)}const ne=oe({mul_:Cz});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sz(n){const e=Z(n,"x","abs");if(e.dtype==="complex64"){const t={x:e};return re.runKernel(Um,t)}else{const t={x:e};return re.runKernel(Fm,t)}}const xs=oe({abs_:Sz});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nz(n){const t={x:Z(n,"x","acos")};return re.runKernel(vd,t)}const Iz=oe({acos_:Nz});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tz(n){const t={x:Z(n,"x","acosh")};return re.runKernel(bd,t)}const $z=oe({acosh_:Tz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ez(n,e=null,t=!1){const r={x:Z(n,"x","all","bool")},i={axis:e,keepDims:t};return re.runKernel(Ib,r,i)}const fE=oe({all_:Ez});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Az(n,e=null,t=!1){const r={x:Z(n,"x","any","bool")},i={axis:e,keepDims:t};return re.runKernel(Tb,r,i)}const kv=oe({any_:Az});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jz(n,e=0){const s={x:Z(n,"x","argMax")},r={axis:e};return re.runKernel(Om,s,r)}const Yu=oe({argMax_:jz});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rz(n,e=0){const s={x:Z(n,"x","argMin")},r={axis:e};return re.runKernel(_m,s,r)}const Dz=oe({argMin_:Rz});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pz(n){const t={x:Z(n,"x","asin")};return re.runKernel(wd,t)}const Mz=oe({asin_:Pz});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lz(n){const t={x:Z(n,"x","asinh")};return re.runKernel(kd,t)}const Fz=oe({asinh_:Lz});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Oz(n){const t={x:Z(n,"x","atan")};return re.runKernel(Cd,t)}const _z=oe({atan_:Oz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zz(n,e){let t=Z(n,"a","atan2"),s=Z(e,"b","atan2");[t,s]=pn(t,s);const r={a:t,b:s};return re.runKernel(Nd,r)}const Bz=oe({atan2_:zz});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wz(n){const t={x:Z(n,"x","atanh")};return re.runKernel(Sd,t)}const Vz=oe({atanh_:Wz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ph(n,e,t,s,r="NHWC",i){const o=n[3],a=[...e,o],l=co(r);return Qn(n,a,t,i,s,null,null,l)}function Ar(n,e,t,s,r,i,o="channelsLast"){const[a,l]=Zu(e);let u;if(o==="channelsLast")u=[a,l,n[3],n[3]];else if(o==="channelsFirst")u=[a,l,n[1],n[1]];else throw new Error(`Unknown dataFormat ${o}`);return Qn(n,u,t,s,r,i,!1,o)}function lo(n,e,t,s,r,i,o="NDHWC"){const[a,l,u]=Cv(e);let d,f;if(o==="NDHWC")f="channelsLast",d=[a,l,u,n[4],n[4]];else if(o==="NCDHW")f="channelsFirst",d=[a,l,u,n[1],n[1]];else throw new Error(`Unknown dataFormat ${o}`);return Jo(n,d,t,s,r,!1,f,i)}function Qn(n,e,t,s,r,i,o=!1,a="channelsLast"){let[l,u,d,f]=[-1,-1,-1,-1];if(a==="channelsLast")[l,u,d,f]=n;else if(a==="channelsFirst")[l,f,u,d]=n;else throw new Error(`Unknown dataFormat ${a}`);const[p,g,,x]=e,[y,b]=Zu(t),[k,w]=Zu(s),N=Yl(p,k),C=Yl(g,w),{padInfo:S,outHeight:T,outWidth:A}=Hz(r,u,d,y,b,N,C,i,a),E=o?x*f:x;let M;return a==="channelsFirst"?M=[l,E,T,A]:a==="channelsLast"&&(M=[l,T,A,E]),{batchSize:l,dataFormat:a,inHeight:u,inWidth:d,inChannels:f,outHeight:T,outWidth:A,outChannels:E,padInfo:S,strideHeight:y,strideWidth:b,filterHeight:p,filterWidth:g,effectiveFilterHeight:N,effectiveFilterWidth:C,dilationHeight:k,dilationWidth:w,inShape:n,outShape:M,filterShape:e}}function Jo(n,e,t,s,r,i=!1,o="channelsLast",a){let[l,u,d,f,p]=[-1,-1,-1,-1,-1];if(o==="channelsLast")[l,u,d,f,p]=n;else if(o==="channelsFirst")[l,p,u,d,f]=n;else throw new Error(`Unknown dataFormat ${o}`);const[g,x,y,,b]=e,[k,w,N]=Cv(t),[C,S,T]=Cv(s),A=Yl(g,C),E=Yl(x,S),M=Yl(y,T),{padInfo:P,outDepth:R,outHeight:L,outWidth:_}=qz(r,u,d,f,k,w,N,A,E,M,a),O=i?b*p:b;let U;return o==="channelsFirst"?U=[l,O,R,L,_]:o==="channelsLast"&&(U=[l,R,L,_,O]),{batchSize:l,dataFormat:o,inDepth:u,inHeight:d,inWidth:f,inChannels:p,outDepth:R,outHeight:L,outWidth:_,outChannels:O,padInfo:P,strideDepth:k,strideHeight:w,strideWidth:N,filterDepth:g,filterHeight:x,filterWidth:y,effectiveFilterDepth:A,effectiveFilterHeight:E,effectiveFilterWidth:M,dilationDepth:C,dilationHeight:S,dilationWidth:T,inShape:n,outShape:U,filterShape:e}}function Uz(n,e,t,s,r){s==null&&(s=m1(n,e,t));const i=n[0],o=n[1],a=Ju((i-e+2*s)/t+1,r),l=Ju((o-e+2*s)/t+1,r);return[a,l]}function Gz(n,e,t,s,r,i){r==null&&(r=m1(n,e[0],s[0]));const o=[0,0,0,t];for(let a=0;a<3;a++)n[a]+2*r>=e[a]&&(o[a]=Ju((n[a]-e[a]+2*r)/s[a]+1,i));return o}function m1(n,e,t,s=1){const r=Yl(e,s);return Math.floor((n[0]*(t-1)-t+r)/2)}function Zu(n){return typeof n=="number"?[n,n,n]:n.length===2?[n[0],n[1],1]:n}function Cv(n){return typeof n=="number"?[n,n,n]:n}function Yl(n,e){return e<=1?n:n+(n-1)*(e-1)}function Hz(n,e,t,s,r,i,o,a,l){let u,d,f;if(typeof n=="number"){u={top:n,bottom:n,left:n,right:n,type:n===0?"VALID":"NUMBER"};const g=Uz([e,t],i,s,n,a);d=g[0],f=g[1]}else if(n==="same"){d=Math.ceil(e/s),f=Math.ceil(t/r);const p=Math.max(0,(d-1)*s+i-e),g=Math.max(0,(f-1)*r+o-t),x=Math.floor(p/2),y=p-x,b=Math.floor(g/2),k=g-b;u={top:x,bottom:y,left:b,right:k,type:"SAME"}}else if(n==="valid")u={top:0,bottom:0,left:0,right:0,type:"VALID"},d=Math.ceil((e-i+1)/s),f=Math.ceil((t-o+1)/r);else if(typeof n=="object"){const p=l==="channelsLast"?n[1][0]:n[2][0],g=l==="channelsLast"?n[1][1]:n[2][1],x=l==="channelsLast"?n[2][0]:n[3][0],y=l==="channelsLast"?n[2][1]:n[3][1];u={top:p,bottom:g,left:x,right:y,type:p===0&&g===0&&x===0&&y===0?"VALID":"EXPLICIT"},d=Ju((e-i+p+g)/s+1,a),f=Ju((t-o+x+y)/r+1,a)}else throw Error(`Unknown padding parameter: ${n}`);return{padInfo:u,outHeight:d,outWidth:f}}function qz(n,e,t,s,r,i,o,a,l,u,d){let f,p,g,x;if(n==="valid"&&(n=0),typeof n=="number"){f={top:n,bottom:n,left:n,right:n,front:n,back:n,type:n===0?"VALID":"NUMBER"};const b=Gz([e,t,s,1],[a,l,u],1,[r,i,o],n,d);p=b[0],g=b[1],x=b[2]}else if(n==="same"){p=Math.ceil(e/r),g=Math.ceil(t/i),x=Math.ceil(s/o);const y=(p-1)*r+a-e,b=(g-1)*i+l-t,k=(x-1)*o+u-s,w=Math.floor(y/2),N=y-w,C=Math.floor(b/2),S=b-C,T=Math.floor(k/2),A=k-T;f={top:C,bottom:S,left:T,right:A,front:w,back:N,type:"SAME"}}else throw Error(`Unknown padding parameter: ${n}`);return{padInfo:f,outDepth:p,outHeight:g,outWidth:x}}function Ju(n,e){if(!e)return Math.trunc(n);switch(e){case"round":return Math.round(n);case"ceil":return Math.ceil(n);case"floor":return Math.floor(n);default:throw new Error(`Unknown roundingMode ${e}`)}}function Ua(n){const[e,t,s]=Zu(n);return e===1&&t===1&&s===1}function rs(n,e){return Ua(n)||Ua(e)}function Ga(n){return Zu(n).every(e=>e>0)}function co(n){if(n==="NHWC")return"channelsLast";if(n==="NCHW")return"channelsFirst";throw new Error(`Unknown dataFormat ${n}`)}function Ls(n,e,t){if(t!=null){if(typeof e=="string")throw Error(`Error in ${n}: pad must be an integer when using dimRoundingMode ${t} but got pad ${e}.`);if(typeof e=="number")V(oc(e),()=>`Error in ${n}: pad must be an integer when using dimRoundingMode ${t} but got pad ${e}.`);else if(typeof e=="object")e.forEach(s=>{s.forEach(r=>{V(oc(r),()=>`Error in ${n}: pad must be an integer when using dimRoundingMode ${t} but got pad ${r}.`)})});else throw Error(`Error in ${n}: Unknown padding parameter: ${e}`)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kz(n,e){const s={x:Z(n,"x","reshape","string_or_numeric")},r={shape:e};return re.runKernel(Sg,s,r)}const ie=oe({reshape_:Kz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qz(n,e,t,s,r){const i=Z(n,"x","avgPool","float32"),o=1;V(rs(t,o),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${t} and dilations '${o}'`);let a=i,l=!1;i.rank===3&&(l=!0,a=ie(i,[1,i.shape[0],i.shape[1],i.shape[2]])),V(a.rank===4,()=>`Error in avgPool: x must be rank 4 but got rank ${a.rank}.`),Ls("avgPool",s,r);const u={x:a},d={filterSize:e,strides:t,pad:s,dimRoundingMode:r};let f=re.runKernel(zm,u,d);return f=Fe(f,i.dtype),l?ie(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const g1=oe({avgPool_:Qz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xz(n,e,t,s,r,i="NDHWC"){const o=Z(n,"x","avgPool3d","float32");let a=o,l=!1;o.rank===4&&(l=!0,a=ie(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),V(a.rank===5,()=>`Error in avgPool3d: x must be rank 5 but got rank ${a.rank}.`),V(i==="NDHWC",()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${i}`),V(typeof t=="number"&&t>0||Array.isArray(t)&&t[0]>0&&t[1]>0&&t[2]>0,()=>`Error in avgPool3d: Stride must be > 0, but got '${t}'`),Ls("avgPool3d",s,r);const u={x:a},d={filterSize:e,strides:t,pad:s,dimRoundingMode:r,dataFormat:i};let f=re.runKernel(Bm,u,d);return f=Fe(f,a.dtype),l?ie(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}const Yz=oe({avgPool3d_:Xz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zz(n,e=0){V(n.length>=1,()=>"Pass at least one tensor to concat");const t=rE(n,"tensors","concat","string_or_numeric");if(t[0].dtype==="complex64"&&t.forEach(i=>{if(i.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype ${i.dtype}. `)}),t.length===1)return Pa(t[0]);const s=t,r={axis:e};return re.runKernel(Gm,s,r)}const Rs=oe({concat_:Zz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jz(n,e,t=!1,s=!1){let r=Z(n,"a","matMul"),i=Z(e,"b","matMul");[r,i]=pn(r,i);const o={a:r,b:i},a={transposeA:t,transposeB:s};return re.runKernel(Wm,o,a)}const Tt=oe({matMul_:Jz});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function e5(n){const t={x:Z(n,"x","sigmoid","float32")};return re.runKernel(ih,t)}const $c=oe({sigmoid_:e5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function t5(n,e,t){const s=Z(n,"x","slice","string_or_numeric");if(s.rank===0)throw new Error("Slicing scalar is not possible");const r={x:s},i={begin:e,size:t};return re.runKernel(Eg,r,i)}const Ot=oe({slice_:t5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function n5(n){const t={x:Z(n,"x","tanh","float32")};return re.runKernel(dh,t)}const zg=oe({tanh_:n5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function s5(n,e,t){const s=Z(n,"x","batchToSpaceND"),r=e.reduce((a,l)=>a*l);V(s.rank>=1+e.length,()=>`input rank is ${s.rank} but should be > than blockShape.length ${e.length}`),V(t.length===e.length,()=>`crops.length is ${t.length} but should be equal to blockShape.length  ${e.length}`),V(s.shape[0]%r===0,()=>`input tensor batch is ${s.shape[0]} but is not divisible by the product of the elements of blockShape ${e.join(" * ")} === ${r}`);const i={x:s},o={blockShape:e,crops:t};return re.runKernel(Vm,i,o)}const x1=oe({batchToSpaceND_:s5});function r5(n){let e;return n.rank===0||n.rank===1?e=ie(n,[1,1,1,n.size]):n.rank===2?e=ie(n,[1,1,n.shape[0],n.shape[1]]):n.rank===3?e=ie(n,[1,n.shape[0],n.shape[1],n.shape[2]]):e=n,e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function i5(n,e,t,s,r,i){i==null&&(i=.001);const o=Z(n,"x","batchNorm"),a=Z(e,"mean","batchNorm"),l=Z(t,"variance","batchNorm");let u;r!=null&&(u=Z(r,"scale","batchNorm"));let d;s!=null&&(d=Z(s,"offset","batchNorm")),V(a.rank===l.rank,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),V(d==null||a.rank===d.rank,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),V(u==null||a.rank===u.rank,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");const p={x:r5(o),scale:u,offset:d,mean:a,variance:l},g={varianceEpsilon:i},x=re.runKernel(eg,p,g);return ie(x,o.shape)}const Bg=oe({batchNorm_:i5});function o5(n,e,t,s,r,i){const o=Z(n,"x","batchNorm"),a=Z(e,"mean","batchNorm"),l=Z(t,"variance","batchNorm");let u;r!=null&&(u=Z(r,"scale","batchNorm"));let d;return s!=null&&(d=Z(s,"offset","batchNorm")),V(o.rank===2,()=>`Error in batchNorm2D: x must be rank 2 but got rank ${o.rank}.`),V(a.rank===2||a.rank===1,()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${a.rank}.`),V(l.rank===2||l.rank===1,()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${l.rank}.`),u!=null&&V(u.rank===2||u.rank===1,()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${u.rank}.`),d!=null&&V(d.rank===2||d.rank===1,()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${d.rank}.`),Bg(o,a,l,d,u,i)}const a5=oe({batchNorm2d_:o5});function l5(n,e,t,s,r,i){const o=Z(n,"x","batchNorm"),a=Z(e,"mean","batchNorm"),l=Z(t,"variance","batchNorm");let u;r!=null&&(u=Z(r,"scale","batchNorm"));let d;return s!=null&&(d=Z(s,"offset","batchNorm")),V(o.rank===3,()=>`Error in batchNorm3D: x must be rank 3 but got rank ${o.rank}.`),V(a.rank===3||a.rank===1,()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${a.rank}.`),V(l.rank===3||l.rank===1,()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${l.rank}.`),u!=null&&V(u.rank===3||u.rank===1,()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${u.rank}.`),d!=null&&V(d.rank===3||d.rank===1,()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${d.rank}.`),Bg(o,a,l,d,u,i)}const c5=oe({batchNorm3d_:l5});function u5(n,e,t,s,r,i){const o=Z(n,"x","batchNorm"),a=Z(e,"mean","batchNorm"),l=Z(t,"variance","batchNorm");let u;r!=null&&(u=Z(r,"scale","batchNorm"));let d;return s!=null&&(d=Z(s,"offset","batchNorm")),V(o.rank===4,()=>`Error in batchNorm4D: x must be rank 4 but got rank ${o.rank}.`),V(a.rank===4||a.rank===1,()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${a.rank}.`),V(l.rank===4||l.rank===1,()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${l.rank}.`),u!=null&&V(u.rank===4||u.rank===1,()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${u.rank}.`),d!=null&&V(d.rank===4||d.rank===1,()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${d.rank}.`),Bg(o,a,l,d,u,i)}const d5=oe({batchNorm4d_:u5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function h5(n,e,t){const s=Z(n,"x","bincount"),r=Z(e,"weights","bincount");V(s.dtype==="int32",()=>`Error in bincount: input dtype must be int32, but got ${s.dtype}`),V(t>=0,()=>`size must be non-negative, but got ${t}.`),V(r.size===s.size||r.size===0,()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${s.shape}, weights shape: ${r.shape}.`);const i={x:s,weights:r},o={size:t};return re.runKernel(Ab,i,o)}const f5=oe({bincount_:h5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p5(n,e){let t=Z(n,"broadcastTo","x");const s=t.shape;if(ao(e),e.length<t.rank)throw new Error(`broadcastTo(): shape.length=${e.length} < input.rank=${t.rank}.`);if(e.length>t.rank){const u=t.shape.slice();for(;u.length<e.length;)u.unshift(1);t=ie(t,u)}const r=t.shape,i=Array.from(e);for(let u=e.length-1;u>=0;u--)if(r[u]===e[u])i[u]=1;else if(t.shape[u]!==1)throw new Error(`broadcastTo(): [${s}] cannot be broadcast to [${e}].`);if(i.map((u,d)=>u>1?d:-1).filter(u=>u>=0).length===0)return Pa(t);const a={x:t},l={reps:i};return re.runKernel(hh,a,l)}const Gu=oe({broadcastTo_:p5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function m5(n){const t={x:Z(n,"x","ceil","float32")};return re.runKernel(Td,t)}const g5=oe({ceil_:m5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wg(n,e,t){ao(n),t=t||Nc(e);const s={shape:n,value:e,dtype:t};return re.runKernel(Gb,{},s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function x5(n,e,t){const s=Z(n,"x","clipByValue");if(V(e<=t,()=>`Error in clip: min (${e}) must be less than or equal to max (${t}).`),e===t)return Wg(s.shape,e,s.dtype);const r={x:s},i={clipValueMin:e,clipValueMax:t};return re.runKernel($d,r,i)}const ar=oe({clipByValue_:x5});function y5(n){return Rs(n,0)}const v5=oe({concat1d_:y5});function b5(n,e){return Rs(n,e)}const w5=oe({concat2d_:b5});function k5(n,e){return Rs(n,e)}const C5=oe({concat3d_:k5});function S5(n,e){return Rs(n,e)}const N5=oe({concat4d_:S5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function I5(n,e,t,s,r="NHWC",i=[1,1],o){const a=Z(n,"x","conv2d","float32"),l=Z(e,"filter","conv2d","float32");let u=a,d=!1;a.rank===3&&(d=!0,u=ie(a,[1,a.shape[0],a.shape[1],a.shape[2]])),V(u.rank===4,()=>`Error in conv2d: input must be rank 4, but got rank ${u.rank}.`),V(l.rank===4,()=>`Error in conv2d: filter must be rank 4, but got rank ${l.rank}.`),Ls("conv2d",s,o);const f=r==="NHWC"?u.shape[3]:u.shape[1];V(f===l.shape[2],()=>`Error in conv2d: depth of input (${f}) must match input depth for filter ${l.shape[2]}.`),V(rs(t,i),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${t} and dilations '${i}'`),V(Ga(i),()=>"Error in conv2D: Dilated rates should be larger than 0."),V(Ga(t),()=>"Error in conv2D: Strides should be larger than 0.");const p={x:u,filter:l},g={strides:t,pad:s,dataFormat:r,dilations:i,dimRoundingMode:o},x=re.runKernel(Hm,p,g);return d?ie(x,[x.shape[1],x.shape[2],x.shape[3]]):x}const Ha=oe({conv2d_:I5});function T5(n,e,t,s,r="NWC",i=1,o){const a=Z(n,"x","conv1d"),l=Z(e,"filter","conv1d");let u=a,d=!1;a.rank===2&&(d=!0,u=ie(a,[1,a.shape[0],a.shape[1]])),V(u.rank===3,()=>`Error in conv1d: input must be rank 3, but got rank ${u.rank}.`),V(l.rank===3,()=>`Error in conv1d: filter must be rank 3, but got rank ${l.rank}.`),Ls("conv1d",s,o),V(u.shape[2]===l.shape[1],()=>`Error in conv1d: depth of input (${u.shape[2]}) must match input depth for filter ${l.shape[1]}.`),V(rs(t,i),()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${t} and dilation '${i}'`),V(Ga(i),()=>"Error in conv1D: Dilated rates should be larger than 0."),V(Ga(t),()=>"Error in conv1D: Stride should be larger than 0."),V(r==="NWC",()=>`Error in conv1d: got dataFormat of ${r} but only NWC is currently supported.`);const f=ie(l,[1,l.shape[0],l.shape[1],l.shape[2]]),p=ie(u,[u.shape[0],1,u.shape[1],u.shape[2]]),b=Ha(p,f,[1,t],s,"NHWC",[1,i],o);return d?ie(b,[b.shape[2],b.shape[3]]):ie(b,[b.shape[0],b.shape[2],b.shape[3]])}const pE=oe({conv1d_:T5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $5(n,e,t,s,r,i="NHWC",o){V(n.length===e.rank,()=>`Length of inShape (${n.length}) and rank of dy (${e.rank}) must match`);let a=n,l=e,u=!1;e.rank===3&&(u=!0,l=ie(e,[1,e.shape[0],e.shape[1],e.shape[2]]),a=[1,n[0],n[1],n[2]]),V(a.length===4,()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${a.length}.`),V(l.rank===4,()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${l.rank}`),V(t.rank===4,()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${t.rank}`);const d=i==="NHWC"?a[3]:a[1],f=i==="NHWC"?l.shape[3]:l.shape[1];V(d===t.shape[2],()=>`Error in conv2dDerInput: depth of input (${d}) must match input depth for filter ${t.shape[2]}.`),V(f===t.shape[3],()=>`Error in conv2dDerInput: depth of output (${f}) must match output depth for filter ${t.shape[3]}.`),Ls("conv2dDerInput",r,o);const p={dy:l,filter:t},g={strides:s,pad:r,dataFormat:i,dimRoundingMode:o,inputShape:a},x=re.runKernel(qm,p,g);return u?ie(x,[x.shape[1],x.shape[2],x.shape[3]]):x}const y1=oe({conv2DBackpropInput_:$5});function E5(n,e,t,s,r,i){const o=Z(n,"x","conv2dTranspose"),a=Z(e,"filter","conv2dTranspose");return y1(t,o,a,s,r,"NHWC",i)}const mE=oe({conv2dTranspose_:E5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function A5(n,e,t,s,r="NDHWC",i=[1,1,1]){const o=Z(n,"x","conv3d"),a=Z(e,"filter","conv3d");let l=o,u=!1;o.rank===4&&(u=!0,l=ie(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),V(l.rank===5,()=>`Error in conv3d: input must be rank 5, but got rank ${l.rank}.`),V(a.rank===5,()=>`Error in conv3d: filter must be rank 5, but got rank ${a.rank}.`),V(l.shape[4]===a.shape[3],()=>`Error in conv3d: depth of input (${l.shape[4]}) must match input depth for filter ${a.shape[3]}.`),V(rs(t,i),()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${t} and dilations '${i}'`),V(r==="NDHWC",()=>`Error in conv3d: got dataFormat of ${r} but only NDHWC is currently supported.`),V(Ga(i),()=>"Error in conv3D: Dilated rates should be larger than 0."),V(Ga(t),()=>"Error in conv3D: Strides should be larger than 0.");const d={x:l,filter:a},f={strides:t,pad:s,dataFormat:r,dilations:i},p=re.runKernel(Km,d,f);return u?ie(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}const j5=oe({conv3d_:A5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function R5(n,e,t,s,r){V(n.length===e.rank,()=>`Length of inShape (${n.length}) and rank of dy (${e.rank}) must match`);let i=n,o=e,a=!1;e.rank===4&&(a=!0,o=ie(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),i=[1,n[0],n[1],n[2],n[3]]);const l=i[4],u=o.shape[4];V(i.length===5,()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${i.length}.`),V(o.rank===5,()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${o.rank}`),V(t.rank===5,()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${t.rank}`),V(l===t.shape[3],()=>`Error in conv3dDerInput: depth of input (${l}) must match input depth for filter ${t.shape[3]}.`),V(u===t.shape[4],()=>`Error in conv3dDerInput: depth of output (${u}) must match output depth for filter ${t.shape[4]}.`);const d={dy:o,filter:t},f={pad:r,strides:s,inputShape:i},p=re.runKernel(Mb,d,f);return a?ie(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}const gE=oe({conv3DBackpropInput_:R5});function D5(n,e,t,s,r){const i=Z(n,"x","conv3dTranspose"),o=Z(e,"filter","conv3dTranspose");return gE(t,i,o,s,r)}const P5=oe({conv3dTranspose_:D5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function M5(n){const t={x:Z(n,"x","cos","float32")};return re.runKernel(Ed,t)}const v1=oe({cos_:M5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function L5(n){const t={x:Z(n,"x","cosh","float32")};return re.runKernel(Ad,t)}const xE=oe({cosh_:L5});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function F5(n,e=0,t=!1,s=!1){const i={x:Z(n,"x","cumprod")},o={axis:e,exclusive:t,reverse:s};return re.runKernel(Lb,i,o)}const Sv=oe({cumprod_:F5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function O5(n,e=0,t=!1,s=!1){const i={x:Z(n,"x","cumsum")},o={axis:e,exclusive:t,reverse:s};return re.runKernel(Qm,i,o)}const yE=oe({cumsum_:O5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _5(n,e,t,s=!1){const r=Z(n,"x","denseBincount"),i=Z(e,"weights","denseBincount");V(r.dtype==="int32",()=>`Error in denseBincount: input dtype must be int32, but got ${r.dtype}`),V(r.rank<=2,()=>`Error in denseBincount: input must be at most rank 2, but got rank ${r.rank}.`),V(t>=0,()=>`size must be non-negative, but got ${t}.`),V(i.size===r.size||i.size===0,()=>`Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ${r.shape}, weights shape: ${i.shape}.`);const o={x:r,weights:i},a={size:t,binaryOutput:s};return re.runKernel(Ob,o,a)}const OS=oe({denseBincount_:_5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function z5(n,e,t="NHWC"){const s=Z(n,"x","depthToSpace","float32"),r=t==="NHWC"?s.shape[1]:s.shape[2],i=t==="NHWC"?s.shape[2]:s.shape[3],o=t==="NHWC"?s.shape[3]:s.shape[1];V(e>1,()=>`blockSize should be > 1 for depthToSpace, but was: ${e}`),V(r*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${r} and ${e}  for depthToSpace with input shape
    ${s.shape}`),V(i*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${i} and ${e} for depthToSpace with input shape
        ${s.shape}`),V(o%(e*e)===0,()=>`Dimension size must be evenly divisible by ${e*e} but is ${o} for depthToSpace with input shape ${s.shape}`);const a={x:s},l={blockSize:e,dataFormat:t};return re.runKernel(_b,a,l)}const B5=oe({depthToSpace_:z5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function W5(n,e,t,s,r="NHWC",i=[1,1],o){const a=Z(n,"x","depthwiseConv2d","float32"),l=Z(e,"filter","depthwiseConv2d","float32");let u=a,d=!1;a.rank===3&&(d=!0,u=ie(a,[1,a.shape[0],a.shape[1],a.shape[2]])),V(u.rank===4,()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${u.rank}.`),V(l.rank===4,()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${l.rank}.`);const f=r==="NHWC"?u.shape[3]:u.shape[1];V(f===l.shape[2],()=>`Error in depthwiseConv2d: number of input channels (${f}) must match the inChannels dimension in filter ${l.shape[2]}.`),Ls("depthwiseConv2d",s,o);const p={x:u,filter:l},g={strides:t,pad:s,dataFormat:r,dilations:i,dimRoundingMode:o},x=re.runKernel(Xm,p,g);return d?ie(x,[x.shape[1],x.shape[2],x.shape[3]]):x}const b1=oe({depthwiseConv2d_:W5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function V5(n,e,t,s,r=[1,1],i="NHWC"){const o=Z(n,"x","dilation2d"),a=Z(e,"filter","dilation2d");V(o.rank===3||o.rank===4,()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${o.rank}.`),V(a.rank===3,()=>`Error in dilation2d: filter must be rank 3, but got rank ${a.rank}.`),V(i==="NHWC",()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${i}`);let l=o,u=!1;o.rank===3&&(l=ie(o,[1,o.shape[0],o.shape[1],o.shape[2]]),u=!0),V(l.shape[3]===a.shape[2],()=>`Error in dilation2d:  input and filter must have the same depth: ${l.shape[3]} vs ${a.shape[2]}`);const d={x:l,filter:a},f={strides:t,pad:s,dilations:r},p=re.runKernel(Ym,d,f);return u?ie(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const U5=oe({dilation2d_:V5});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cc(n,e){const t=n.length,s=[];for(let r=0;r<t;r++){const i=t-1-r,o=n[i]||1;(e[e.length-1-r]||1)>1&&o===1&&s.unshift(i)}return s}function En(n,e){const t=[];for(let s=0;s<e.length;s++){const r=n[n.length-s-1],i=e.length-s-1,o=e[i];(r==null||r===1&&o>1)&&t.unshift(i)}return t}function ot(n,e){const t=Math.max(n.length,e.length),s=new Array(t);for(let r=0;r<t;r++){let i=n[n.length-r-1];i==null&&(i=1);let o=e[e.length-r-1];if(o==null&&(o=1),i===1)s[t-r-1]=o;else if(o===1)s[t-r-1]=i;else if(i!==o){const a=`Operands could not be broadcast together with shapes ${n} and ${e}.`;throw Error(a)}else s[t-r-1]=i}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function G5(n,e){let t=Z(n,"a","equal","string_or_numeric"),s=Z(e,"b","equal","string_or_numeric");[t,s]=pn(t,s),ot(t.shape,s.shape);const r={a:t,b:s};return re.runKernel(Zm,r)}const Ti=oe({equal_:G5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function H5(n,e,t){const s=Z(e,"a","where"),r=Z(t,"b","where"),i=Z(n,"condition","where","bool"),o=ot(ot(i.shape,s.shape),r.shape),a=Gu(i,o),l=Gu(s,o),u=Gu(r,o),d={condition:a,t:l,e:u};return re.runKernel($g,d)}const bs=oe({where_:H5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function q5(n){const t={x:Z(n,"x","zerosLike")};return re.runKernel(Lg,t)}const wt=oe({zerosLike_:q5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function K5(n,e){let t=Z(n,"a","div"),s=Z(e,"b","div");[t,s]=pn(t,s);const r=Ze(t,s),i=wt(r),o=Ti(s,i);return bs(o,i,r)}const Q5=oe({divNoNan_:K5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function X5(n,e){const t=Z(n,"t1","dot"),s=Z(e,"t2","dot");V((t.rank===1||t.rank===2)&&(s.rank===1||s.rank===2),()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${t.rank} and ${s.rank}.`);const r=t.rank===1?t.size:t.shape[1],i=s.rank===1?s.size:s.shape[0];if(V(r===i,()=>`Error in dot: inner dimensions of inputs must match, but got ${r} and ${i}.`),t.rank===1&&s.rank===1){const o=ie(t,[1,-1]),a=ie(s,[-1,1]),l=Tt(o,a);return ie(l,[])}else if(t.rank===1&&s.rank===2){const o=ie(t,[1,-1]),a=ie(s,[s.shape[0],s.shape[1]]),l=Tt(o,a);return ie(l,[l.size])}else if(t.rank===2&&s.rank===1){const o=ie(s,[-1,1]),a=Tt(t,o);return ie(a,[a.size])}else{const o=ie(s,[s.shape[0],s.shape[1]]);return Tt(t,o)}}const Y5=oe({dot_:X5});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z5(n,...e){const t=e.map((r,i)=>Z(r,`tensors${i}`,"einsum")),s={equation:n};return re.runKernel(Wb,t,s)}const Tu=oe({einsum_:Z5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function J5(n){const t={x:Z(n,"x","elu","float32")};return re.runKernel(Rd,t)}const Vg=oe({elu_:J5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eB(n){let e=Z(n,"x","erf");V(e.dtype==="int32"||e.dtype==="float32",()=>"Input dtype must be `int32` or `float32`."),e.dtype==="int32"&&(e=Fe(e,"float32"));const t={x:e};return re.runKernel(Dd,t)}const vE=oe({erf_:eB});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function w1(n,e){for(let t=0;t<n.length;++t)if(n[n.length-t-1]!==e-1-t)return!1;return!0}function bE(n,e,t){const s=n.length+e.length,r=[];let i=0,o=0;for(let a=0;a<s;a++)t.indexOf(a)===-1?r.push(n[i++]):r.push(e[o++]);return r}function zn(n,e){const t=[],s=n.length;for(let i=0;i<s;i++)e.indexOf(i)===-1&&t.push(n[i]);const r=e.map(i=>n[i]);return[t,r]}function kn(n,e){const t=e.map(s=>1);return bE(n,t,e)}function Xn(n,e,t){V(w1(e,t),()=>`${n} supports only inner-most axes for now. Got axes ${e} and rank-${t} input.`)}function tn(n,e){if(w1(n,e))return null;const t=[];for(let s=0;s<e;++s)n.indexOf(s)===-1&&t.push(s);return n.forEach(s=>t.push(s)),t}function ea(n){return n.map((e,t)=>[t,e]).sort((e,t)=>e[1]-t[1]).map(e=>e[0])}function mn(n,e){const t=[];for(let s=e-n;s<e;++s)t.push(s);return t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tB(n,e=null,t=!1){const r={x:Z(n,"x","max")},i={reductionIndices:e,keepDims:t};return re.runKernel(ug,r,i)}const Yr=oe({max_:tB});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nB(n,e=null,t=!1){const r={x:Z(n,"x","min")},i={axis:e,keepDims:t};return re.runKernel(pg,r,i)}const Xp=oe({min_:nB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sB(n,e){let t=Z(n,"base","pow"),s=Z(e,"exp","pow");[t,s]=pn(t,s);const r={a:t,b:s};return re.runKernel(Qd,r)}const qa=oe({pow_:sB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $t(n,e){if((Tr(n)&&e!=="string"||Array.isArray(n))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&Tr(n)&&!(n instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return _g(n,[],[],e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rB(n){const t={x:Z(n,"x","sqrt","float32")};return re.runKernel(ah,t)}const ss=oe({sqrt_:rB});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iB(n){const e=Z(n,"x","square"),t={};return re.runKernel("Square",{x:e},t)}const Bt=oe({square_:iB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oB(n,e=null,t=!1){let s=Z(n,"x","sum");s.dtype==="bool"&&(s=Fe(s,"int32"));const r={x:s},i={axis:e,keepDims:t};return re.runKernel(Ag,r,i)}const Ye=oe({sum_:oB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aB(n,e="euclidean",t=null,s=!1){n=Z(n,"x","norm");const r=wE(n,e,t);let i=r.shape;if(s){const o=ht(t,n.shape);i=kn(r.shape,o)}return ie(r,i)}function wE(n,e,t=null){if(n.rank===0)return xs(n);if(n.rank!==1&&t===null)return wE(ie(n,[-1]),e,t);if(n.rank===1||typeof t=="number"||Array.isArray(t)&&t.length===1){if(e===1)return Ye(xs(n),t);if(e===1/0)return Yr(xs(n),t);if(e===-1/0)return Xp(xs(n),t);if(e==="euclidean"||e===2)return ss(Ye(qa(xs(n),$t(2,"int32")),t));throw new Error(`Error in norm: invalid ord value: ${e}`)}if(Array.isArray(t)&&t.length===2){if(e===1)return Yr(Ye(xs(n),t[0]),t[1]-1);if(e===1/0)return Yr(Ye(xs(n),t[1]),t[0]);if(e===-1/0)return Xp(Ye(xs(n),t[1]),t[0]);if(e==="fro"||e==="euclidean")return ss(Ye(Bt(n),t));throw new Error(`Error in norm: invalid ord value: ${e}`)}throw new Error(`Error in norm: invalid axis: ${t}`)}const Ug=oe({norm_:aB});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lB(n,e=null,t=!1){return Ug(n,"euclidean",e,t)}const cB=oe({euclideanNorm_:lB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uB(n){const t={x:Z(n,"x","exp")};return re.runKernel(Pd,t)}const $i=oe({exp_:uB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dB(n,e=0){const t=Z(n,"x","expandDims","string_or_numeric");V(e<=t.rank,()=>"Axis must be <= rank of the tensor");const s={input:t},r={dim:e};return re.runKernel(Jm,s,r)}const Es=oe({expandDims_:dB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hB(n){const t={x:Z(n,"x","expm1")};return re.runKernel(Md,t)}const fB=oe({expm1_:hB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pB(n,e){const t=Z(n,"x","tile","string_or_numeric");V(t.rank===e.length,()=>`Error in transpose: rank of input ${t.rank} must match length of reps ${e}.`);const s={x:t},r={reps:e};return re.runKernel(hh,s,r)}const Qr=oe({tile_:pB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mB(n,e,t,s="float32"){e==null&&(e=n);const r=dt([n,e],s),i=n<=e?n:e;for(let a=0;a<i;++a)r.set(1,a,a);const o=ie(r.toTensor(),[n,e]);if(t==null)return o;if(t.length===1)return Qr(Es(o,0),[t[0],1,1]);if(t.length===2)return Qr(Es(Es(o,0),0),[t[0],t[1],1,1]);if(t.length===3)return Qr(Es(Es(Es(o,0),0),0),[t[0],t[1],t[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${t.length}D.`)}const kE=oe({eye_:mB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gB(n){const t={x:Z(n,"x","floor","float32")};return re.runKernel(Ld,t)}const Gg=oe({floor_:gB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xB(n,e,t=0,s=0){const r=Z(n,"x","gather"),i=Z(e,"indices","gather","int32"),o={x:r,indices:i},a={axis:t,batchDims:s};return re.runKernel(tg,o,a)}const k1=oe({gather_:xB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yB(n,e){let t=Z(n,"a","greater","string_or_numeric"),s=Z(e,"b","greater","string_or_numeric");[t,s]=pn(t,s),ot(t.shape,s.shape);const r={a:t,b:s};return re.runKernel(ng,r)}const lr=oe({greater_:yB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vB(n,e){let t=Z(n,"a","greaterEqual","string_or_numeric"),s=Z(e,"b","greaterEqual","string_or_numeric");[t,s]=pn(t,s),ot(t.shape,s.shape);const r={a:t,b:s};return re.runKernel(Od,r)}const nl=oe({greaterEqual_:vB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bB(n){const t={input:Z(n,"input","imag")};return re.runKernel(Kb,t)}const C1=oe({imag_:bB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wB(n){const t={x:Z(n,"x","isFinite")};return re.runKernel(zd,t)}const kB=oe({isFinite_:wB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CB(n){const t={x:Z(n,"x","isInf")};return re.runKernel(Bd,t)}const SB=oe({isInf_:CB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NB(n){const t={x:Z(n,"x","isNaN")};return re.runKernel(Wd,t)}const IB=oe({isNaN_:NB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TB(n,e=.2){const s={x:Z(n,"x","leakyRelu")},r={alpha:e};return re.runKernel(sg,s,r)}const S1=oe({leakyRelu_:TB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $B(n,e){let t=Z(n,"a","less","string_or_numeric"),s=Z(e,"b","less","string_or_numeric");[t,s]=pn(t,s),ot(t.shape,s.shape);const r={a:t,b:s};return re.runKernel(rg,r)}const Yp=oe({less_:$B});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EB(n,e){let t=Z(n,"a","lessEqual","string_or_numeric"),s=Z(e,"b","lessEqual","string_or_numeric");[t,s]=pn(t,s),ot(t.shape,s.shape);const r={a:t,b:s};return re.runKernel(ig,r)}const Ec=oe({lessEqual_:EB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AB(n,e=5,t=1,s=1,r=.5){const i=Z(n,"x","localResponseNormalization");V(i.rank===4||i.rank===3,()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank ${i.rank}.`),V(oc(e),()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${e}.`);let o=i,a=!1;i.rank===3&&(a=!0,o=ie(i,[1,i.shape[0],i.shape[1],i.shape[2]]));const l={x:o},u={depthRadius:e,bias:t,alpha:s,beta:r},d=re.runKernel(cg,l,u);return a?ie(d,[d.shape[1],d.shape[2],d.shape[3]]):d}const jB=oe({localResponseNormalization_:AB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RB(n){const t={x:Z(n,"x","log","float32")};return re.runKernel(Vd,t)}const Ei=oe({log_:RB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DB(n){const t={x:Z(n,"x","log1p")};return re.runKernel(Ud,t)}const CE=oe({log1p_:DB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PB(n,e){V(cv(n),()=>"The f passed in variableGrads(f) must be a function"),V(e==null||Array.isArray(e)&&e.every(u=>u instanceof Kp),()=>"The varList passed in variableGrads(f, varList) must be an array of variables");const t=e!=null;if(!t){e=[];for(const u in re.registeredVariables)e.push(re.registeredVariables[u])}const s=t?e.filter(u=>!u.trainable):null,r=e.length;e=e.filter(u=>u.trainable),V(e.length>0,()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${r} variables is trainable.`);const i=!0,{value:o,grads:a}=re.gradients(n,e,null,i);V(a.some(u=>u!=null),()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),V(o.rank===0,()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${o.rank} tensor`);const l={};return e.forEach((u,d)=>{a[d]!=null&&(l[u.name]=a[d])}),s!=null&&s.forEach(u=>l[u.name]=null),{value:o,grads:l}}function uc(n){return re.customGrad(n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MB(n){const t={x:Z(n,"x","neg")};return re.runKernel(gg,t)}const fn=oe({neg_:MB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LB(n){const t={x:Z(n,"x","softplus")};return re.runKernel(oh,t)}const mh=oe({softplus_:LB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FB(n){const e=Z(n,"x","logSigmoid");return uc(s=>({value:fn(mh(fn(s))),gradFunc:o=>ne(o,$c(fn(s)))}))(e)}const OB=oe({logSigmoid_:FB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _B(n,e){let t=Z(n,"a","sub"),s=Z(e,"b","sub");[t,s]=pn(t,s);const r={a:t,b:s};return re.runKernel(ch,r)}const tt=oe({sub_:_B});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zB(n,e=-1){const t=Z(n,"logits","logSoftmax");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${t.rank} and axis was ${e}`);return uc((r,i)=>{const a=Yr(r,e,!0),l=tt(r,a),u=tt(Fe(l,"float32"),Ei(Ye($i(l),e,!0)));return i([u]),{value:u,gradFunc:(f,p)=>{const[g]=p,x=!0,y=$i(g);return tt(f,ne(Ye(f,e,x),y))}}})(t)}const SE=oe({logSoftmax_:zB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BB(n,e=null,t=!1){const s=Z(n,"x","logSumExp"),r=ht(e,s.shape),i=Yr(s,r,!0),o=tt(s,i),a=$i(o),l=Ye(a,r),u=Ei(l),d=$e(ie(i,u.shape),u);if(t){const f=kn(d.shape,r);return ie(d,f)}return d}const NE=oe({logSumExp_:BB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WB(n,e){const t=Z(n,"a","logicalAnd","bool"),s=Z(e,"b","logicalAnd","bool");ot(t.shape,s.shape);const r={a:t,b:s};return re.runKernel(og,r)}const to=oe({logicalAnd_:WB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VB(n){const t={x:Z(n,"x","logicalNot","bool")};return re.runKernel(ag,t)}const N1=oe({logicalNot_:VB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UB(n,e){const t=Z(n,"a","logicalOr","bool"),s=Z(e,"b","logicalOr","bool");ot(t.shape,s.shape);const r={a:t,b:s};return re.runKernel(lg,r)}const IE=oe({logicalOr_:UB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GB(n,e){const t=Z(n,"a","logicalXor","bool"),s=Z(e,"b","logicalXor","bool");return ot(t.shape,s.shape),to(IE(n,e),N1(to(n,e)))}const HB=oe({logicalXor_:GB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qB(n,e,t,s,r){const i=Z(n,"x","maxPool"),o=1;let a=i,l=!1;i.rank===3&&(l=!0,a=ie(i,[1,i.shape[0],i.shape[1],i.shape[2]])),V(a.rank===4,()=>`Error in maxPool: input must be rank 4 but got rank ${a.rank}.`),V(rs(t,o),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${t} and dilations '${o}'`),Ls("maxPool",s,r);const u={x:a},d={filterSize:e,strides:t,pad:s,dimRoundingMode:r},f=re.runKernel(dg,u,d);return l?ie(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const I1=oe({maxPool_:qB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KB(n,e=[1,1,1],t,s,r,i="NDHWC"){const o=Z(n,"x","maxPool3d");let a=o,l=!1;o.rank===4&&(l=!0,a=ie(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),V(a.rank===5,()=>`Error in maxPool3d: x must be rank 5 but got rank ${a.rank}.`),V(i==="NDHWC",()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${i}`),Ls("maxPool3d",s,r);const u={x:a},d={filterSize:e,strides:t,pad:s,dimRoundingMode:r,dataFormat:i},f=re.runKernel(hg,u,d);return l?ie(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}const QB=oe({maxPool3d_:KB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XB(n,e){let t=Z(n,"a","maximum"),s=Z(e,"b","maximum");[t,s]=pn(t,s),t.dtype==="bool"&&(t=Fe(t,"int32"),s=Fe(s,"int32")),ot(t.shape,s.shape);const r={a:t,b:s};return re.runKernel(Gd,r)}const ta=oe({maximum_:XB});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YB(n,e=null,t=!1){const r={x:Z(n,"x","mean")},i={axis:e,keepDims:t};return re.runKernel(fg,r,i)}const wn=oe({mean_:YB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function On(n,e="float32"){if(ao(n),e==="complex64"){const s=On(n,"float32"),r=On(n,"float32");return Ba(s,r)}const t=ns(be(n),e);return re.makeTensor(t,n,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function na(n,e="float32"){if(ao(n),e==="complex64"){const s=na(n,"float32"),r=On(n,"float32");return Ba(s,r)}const t=kb(be(n),e);return re.makeTensor(t,n,e)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZB(n,e){let t=Z(n,"a","minimum"),s=Z(e,"b","minimum");[t,s]=pn(t,s),t.dtype==="bool"&&(t=Fe(t,"int32"),s=Fe(s,"int32")),ot(t.shape,s.shape);const r={a:t,b:s};return re.runKernel(Hd,r)}const ed=oe({minimum_:ZB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JB(n,e,t){V(t==="reflect"||t==="symmetric",()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${t}.`);const s=Z(n,"x","mirrorPad");if(s.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");V(e.length===s.rank,()=>`Padding doesn't match input. Must be ${s.rank}. Got ${e.length}.`);const r=t==="reflect"?1:0;for(let a=0;a<s.rank;a++)V(e[a].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),V(e[a][0]>=0&&e[a][0]<=s.shape[a]-r&&e[a][1]>=0&&e[a][1]<=s.shape[a]-r,()=>`Padding in dimension ${a} cannot be greater than or equal to ${s.shape[a]-r} or less than 0 for input of shape ${s.shape}`);const i={paddings:e,mode:t},o={x:s};return re.runKernel(mg,o,i)}const eW=oe({mirrorPad_:JB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tW(n,e){let t=Z(n,"a","mod"),s=Z(e,"b","mod");[t,s]=pn(t,s);const r={a:t,b:s};return re.runKernel(qd,r)}const nW=oe({mod_:tW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sW(n,e=null,t=!1){n=Z(n,"x","moments");const s=ht(e,n.shape),r=wn(n,s,t);let i=r.shape;t||(i=kn(r.shape,s));const o=Bt(tt(Fe(n,"float32"),ie(r,i))),a=wn(o,s,t);return{mean:r,variance:a}}const T1=oe({moments_:sW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rW(n,e){let t=Z(n,"a","notEqual","string_or_numeric"),s=Z(e,"b","notEqual","string_or_numeric");[t,s]=pn(t,s),ot(t.shape,s.shape);const r={a:t,b:s};return re.runKernel(xg,r)}const Zp=oe({notEqual_:rW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iW(n,e,t=1,s=0,r="int32"){if(e<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${e}`);const o={indices:Z(n,"indices","oneHot","int32")},a={dtype:r,depth:e,onValue:t,offValue:s};return re.runKernel(vg,o,a)}const TE=oe({oneHot_:iW});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oW(n){const t={x:Z(n,"x","onesLike")};return re.runKernel(yg,t)}const $r=oe({onesLike_:oW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aW(n,e,t=0){const s=Z(n,"x","pad");if(s.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");const r={paddings:e,constantValue:t},i={x:s};return re.runKernel(wg,i,r)}const $1=oe({pad_:aW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lW(n,e,t){const s=Z(n,"x","spaceToBatchND");V(s.rank>=1+e.length,()=>`input rank ${s.rank} should be > than [blockShape] ${e.length}`),V(t.length===e.length,()=>`paddings.shape[0] ${t.length} must be equal to [blockShape] ${e.length}`),V(s.shape.reduce((o,a,l)=>l>0&&l<=e.length?o&&(a+t[l-1][0]+t[l-1][1])%e[l-1]===0:o,!0),()=>`input spatial dimensions ${s.shape.slice(1)} with paddings ${t.toString()} must be divisible by blockShapes ${e.toString()}`);const r={x:s},i={blockShape:e,paddings:t};return re.runKernel(jg,r,i)}const E1=oe({spaceToBatchND_:lW});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cW(n,e,t,s,r,i,o){r==null&&(r=[1,1]),i==null&&(i=1),s===0&&(s="valid");const a=Z(n,"x","maxPool");let l=a,u=!1;a.rank===3&&(u=!0,l=ie(a,[1,a.shape[0],a.shape[1],a.shape[2]])),V(rs(i,r),()=>`Error in pool: Either strides or dilations must be 1. Got strides ${i} and dilations '${r}'`);const d=Ar(l.shape,e,i,r,s),f=[d.dilationHeight,d.dilationWidth];let p;s==="same"?p=dW([d.filterHeight,d.filterWidth],f):p=[[0,0],[0,0]];const g=f[0]===1&&f[1]===1,[x,y]=uW([d.inHeight,d.inWidth],f,p),b=g?s:"valid",k=g?l:E1(l,f,x),N=(t==="avg"?()=>g1(k,e,i,b,o):()=>I1(k,e,i,b,o))(),C=g?N:x1(N,f,y);return u?ie(C,[C.shape[1],C.shape[2],C.shape[3]]):C}function uW(n,e,t){const s=t.map(d=>d[0]),r=t.map(d=>d[1]),i=n.concat(s,r),o=e.map((d,f)=>(d-i[f]%d)%d),a=r.map((d,f)=>d+o[f]),l=e.map((d,f)=>[s[f],a[f]]),u=e.map((d,f)=>[0,o[f]]);return[l,u]}function dW(n,e){const s=n.map((o,a)=>o+(o-1)*(e[a]-1)).map(o=>o-1),r=s.map(o=>Math.floor(o/2)),i=s.map((o,a)=>o-r[a]);return s.map((o,a)=>[r[a],i[a]])}const hW=oe({pool_:cW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fW(n,e){const t=Z(n,"x","prelu"),s=Z(e,"alpha","prelu"),r={x:t,alpha:s};return re.runKernel(kg,r)}const A1=oe({prelu_:fW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pW(n,e=null,t=!1){let s=Z(n,"x","prod");s.dtype==="bool"&&(s=Fe(s,"int32"));const r={x:s},i={axis:e,keepDims:t};return re.runKernel(Cg,r,i)}const mW=oe({prod_:pW});var kp={exports:{}},gW=kp.exports,_S;function xW(){return _S||(_S=1,(function(n){(function(e,t,s){function r(l){var u=this,d=a();u.next=function(){var f=2091639*u.s0+u.c*23283064365386963e-26;return u.s0=u.s1,u.s1=u.s2,u.s2=f-(u.c=f|0)},u.c=1,u.s0=d(" "),u.s1=d(" "),u.s2=d(" "),u.s0-=d(l),u.s0<0&&(u.s0+=1),u.s1-=d(l),u.s1<0&&(u.s1+=1),u.s2-=d(l),u.s2<0&&(u.s2+=1),d=null}function i(l,u){return u.c=l.c,u.s0=l.s0,u.s1=l.s1,u.s2=l.s2,u}function o(l,u){var d=new r(l),f=u&&u.state,p=d.next;return p.int32=function(){return d.next()*4294967296|0},p.double=function(){return p()+(p()*2097152|0)*11102230246251565e-32},p.quick=p,f&&(typeof f=="object"&&i(f,d),p.state=function(){return i(d,{})}),p}function a(){var l=4022871197,u=function(d){d=String(d);for(var f=0;f<d.length;f++){l+=d.charCodeAt(f);var p=.02519603282416938*l;l=p>>>0,p-=l,p*=l,l=p>>>0,p-=l,l+=p*4294967296}return(l>>>0)*23283064365386963e-26};return u}t&&t.exports?t.exports=o:this.alea=o})(gW,n)})(kp)),kp.exports}var Cp={exports:{}},yW=Cp.exports,zS;function vW(){return zS||(zS=1,(function(n){(function(e,t,s){function r(a){var l=this,u="";l.x=0,l.y=0,l.z=0,l.w=0,l.next=function(){var f=l.x^l.x<<11;return l.x=l.y,l.y=l.z,l.z=l.w,l.w^=l.w>>>19^f^f>>>8},a===(a|0)?l.x=a:u+=a;for(var d=0;d<u.length+64;d++)l.x^=u.charCodeAt(d)|0,l.next()}function i(a,l){return l.x=a.x,l.y=a.y,l.z=a.z,l.w=a.w,l}function o(a,l){var u=new r(a),d=l&&l.state,f=function(){return(u.next()>>>0)/4294967296};return f.double=function(){do var p=u.next()>>>11,g=(u.next()>>>0)/4294967296,x=(p+g)/(1<<21);while(x===0);return x},f.int32=u.next,f.quick=f,d&&(typeof d=="object"&&i(d,u),f.state=function(){return i(u,{})}),f}t&&t.exports?t.exports=o:this.xor128=o})(yW,n)})(Cp)),Cp.exports}var Sp={exports:{}},bW=Sp.exports,BS;function wW(){return BS||(BS=1,(function(n){(function(e,t,s){function r(a){var l=this,u="";l.next=function(){var f=l.x^l.x>>>2;return l.x=l.y,l.y=l.z,l.z=l.w,l.w=l.v,(l.d=l.d+362437|0)+(l.v=l.v^l.v<<4^(f^f<<1))|0},l.x=0,l.y=0,l.z=0,l.w=0,l.v=0,a===(a|0)?l.x=a:u+=a;for(var d=0;d<u.length+64;d++)l.x^=u.charCodeAt(d)|0,d==u.length&&(l.d=l.x<<10^l.x>>>4),l.next()}function i(a,l){return l.x=a.x,l.y=a.y,l.z=a.z,l.w=a.w,l.v=a.v,l.d=a.d,l}function o(a,l){var u=new r(a),d=l&&l.state,f=function(){return(u.next()>>>0)/4294967296};return f.double=function(){do var p=u.next()>>>11,g=(u.next()>>>0)/4294967296,x=(p+g)/(1<<21);while(x===0);return x},f.int32=u.next,f.quick=f,d&&(typeof d=="object"&&i(d,u),f.state=function(){return i(u,{})}),f}t&&t.exports?t.exports=o:this.xorwow=o})(bW,n)})(Sp)),Sp.exports}var Np={exports:{}},kW=Np.exports,WS;function CW(){return WS||(WS=1,(function(n){(function(e,t,s){function r(a){var l=this;l.next=function(){var d=l.x,f=l.i,p,g;return p=d[f],p^=p>>>7,g=p^p<<24,p=d[f+1&7],g^=p^p>>>10,p=d[f+3&7],g^=p^p>>>3,p=d[f+4&7],g^=p^p<<7,p=d[f+7&7],p=p^p<<13,g^=p^p<<9,d[f]=g,l.i=f+1&7,g};function u(d,f){var p,g=[];if(f===(f|0))g[0]=f;else for(f=""+f,p=0;p<f.length;++p)g[p&7]=g[p&7]<<15^f.charCodeAt(p)+g[p+1&7]<<13;for(;g.length<8;)g.push(0);for(p=0;p<8&&g[p]===0;++p);for(p==8?g[7]=-1:g[p],d.x=g,d.i=0,p=256;p>0;--p)d.next()}u(l,a)}function i(a,l){return l.x=a.x.slice(),l.i=a.i,l}function o(a,l){a==null&&(a=+new Date);var u=new r(a),d=l&&l.state,f=function(){return(u.next()>>>0)/4294967296};return f.double=function(){do var p=u.next()>>>11,g=(u.next()>>>0)/4294967296,x=(p+g)/(1<<21);while(x===0);return x},f.int32=u.next,f.quick=f,d&&(d.x&&i(d,u),f.state=function(){return i(u,{})}),f}t&&t.exports?t.exports=o:this.xorshift7=o})(kW,n)})(Np)),Np.exports}var Ip={exports:{}},SW=Ip.exports,VS;function NW(){return VS||(VS=1,(function(n){(function(e,t,s){function r(a){var l=this;l.next=function(){var d=l.w,f=l.X,p=l.i,g,x;return l.w=d=d+1640531527|0,x=f[p+34&127],g=f[p=p+1&127],x^=x<<13,g^=g<<17,x^=x>>>15,g^=g>>>12,x=f[p]=x^g,l.i=p,x+(d^d>>>16)|0};function u(d,f){var p,g,x,y,b,k=[],w=128;for(f===(f|0)?(g=f,f=null):(f=f+"\0",g=0,w=Math.max(w,f.length)),x=0,y=-32;y<w;++y)f&&(g^=f.charCodeAt((y+32)%f.length)),y===0&&(b=g),g^=g<<10,g^=g>>>15,g^=g<<4,g^=g>>>13,y>=0&&(b=b+1640531527|0,p=k[y&127]^=g+b,x=p==0?x+1:0);for(x>=128&&(k[(f&&f.length||0)&127]=-1),x=127,y=512;y>0;--y)g=k[x+34&127],p=k[x=x+1&127],g^=g<<13,p^=p<<17,g^=g>>>15,p^=p>>>12,k[x]=g^p;d.w=b,d.X=k,d.i=x}u(l,a)}function i(a,l){return l.i=a.i,l.w=a.w,l.X=a.X.slice(),l}function o(a,l){a==null&&(a=+new Date);var u=new r(a),d=l&&l.state,f=function(){return(u.next()>>>0)/4294967296};return f.double=function(){do var p=u.next()>>>11,g=(u.next()>>>0)/4294967296,x=(p+g)/(1<<21);while(x===0);return x},f.int32=u.next,f.quick=f,d&&(d.X&&i(d,u),f.state=function(){return i(u,{})}),f}t&&t.exports?t.exports=o:this.xor4096=o})(SW,n)})(Ip)),Ip.exports}var Tp={exports:{}},IW=Tp.exports,US;function TW(){return US||(US=1,(function(n){(function(e,t,s){function r(a){var l=this,u="";l.next=function(){var f=l.b,p=l.c,g=l.d,x=l.a;return f=f<<25^f>>>7^p,p=p-g|0,g=g<<24^g>>>8^x,x=x-f|0,l.b=f=f<<20^f>>>12^p,l.c=p=p-g|0,l.d=g<<16^p>>>16^x,l.a=x-f|0},l.a=0,l.b=0,l.c=-1640531527,l.d=1367130551,a===Math.floor(a)?(l.a=a/4294967296|0,l.b=a|0):u+=a;for(var d=0;d<u.length+20;d++)l.b^=u.charCodeAt(d)|0,l.next()}function i(a,l){return l.a=a.a,l.b=a.b,l.c=a.c,l.d=a.d,l}function o(a,l){var u=new r(a),d=l&&l.state,f=function(){return(u.next()>>>0)/4294967296};return f.double=function(){do var p=u.next()>>>11,g=(u.next()>>>0)/4294967296,x=(p+g)/(1<<21);while(x===0);return x},f.int32=u.next,f.quick=f,d&&(typeof d=="object"&&i(d,u),f.state=function(){return i(u,{})}),f}t&&t.exports?t.exports=o:this.tychei=o})(IW,n)})(Tp)),Tp.exports}var $p={exports:{}};const $W={},EW=Object.freeze(Object.defineProperty({__proto__:null,default:$W},Symbol.toStringTag,{value:"Module"})),AW=R3(EW);var jW=$p.exports,GS;function RW(){return GS||(GS=1,(function(n){(function(e,t,s){var r=256,i=6,o=52,a="random",l=s.pow(r,i),u=s.pow(2,o),d=u*2,f=r-1,p;function g(C,S,T){var A=[];S=S==!0?{entropy:!0}:S||{};var E=k(b(S.entropy?[C,N(t)]:C??w(),3),A),M=new x(A),P=function(){for(var R=M.g(i),L=l,_=0;R<u;)R=(R+_)*r,L*=r,_=M.g(1);for(;R>=d;)R/=2,L/=2,_>>>=1;return(R+_)/L};return P.int32=function(){return M.g(4)|0},P.quick=function(){return M.g(4)/4294967296},P.double=P,k(N(M.S),t),(S.pass||T||function(R,L,_,O){return O&&(O.S&&y(O,M),R.state=function(){return y(M,{})}),_?(s[a]=R,L):R})(P,E,"global"in S?S.global:this==s,S.state)}function x(C){var S,T=C.length,A=this,E=0,M=A.i=A.j=0,P=A.S=[];for(T||(C=[T++]);E<r;)P[E]=E++;for(E=0;E<r;E++)P[E]=P[M=f&M+C[E%T]+(S=P[E])],P[M]=S;(A.g=function(R){for(var L,_=0,O=A.i,U=A.j,W=A.S;R--;)L=W[O=f&O+1],_=_*r+W[f&(W[O]=W[U=f&U+L])+(W[U]=L)];return A.i=O,A.j=U,_})(r)}function y(C,S){return S.i=C.i,S.j=C.j,S.S=C.S.slice(),S}function b(C,S){var T=[],A=typeof C,E;if(S&&A=="object")for(E in C)try{T.push(b(C[E],S-1))}catch{}return T.length?T:A=="string"?C:C+"\0"}function k(C,S){for(var T=C+"",A,E=0;E<T.length;)S[f&E]=f&(A^=S[f&E]*19)+T.charCodeAt(E++);return N(S)}function w(){try{var C;return p&&(C=p.randomBytes)?C=C(r):(C=new Uint8Array(r),(e.crypto||e.msCrypto).getRandomValues(C)),N(C)}catch{var S=e.navigator,T=S&&S.plugins;return[+new Date,e,T,e.screen,N(t)]}}function N(C){return String.fromCharCode.apply(0,C)}if(k(s.random(),t),n.exports){n.exports=g;try{p=AW}catch{}}else s["seed"+a]=g})(typeof self<"u"?self:jW,[],Math)})($p)),$p.exports}var x0,HS;function DW(){if(HS)return x0;HS=1;var n=xW(),e=vW(),t=wW(),s=CW(),r=NW(),i=TW(),o=RW();return o.alea=n,o.xor128=e,o.xorwow=t,o.xorshift7=s,o.xor4096=r,o.tychei=i,x0=o,x0}var j1=DW();/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $E{constructor(e,t,s,r,i){this.mean=e,this.stdDev=t,this.dtype=s,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);const o=i||Math.random();this.random=j1.alea(o.toString())}nextValue(){if(!isNaN(this.nextVal)){const r=this.nextVal;return this.nextVal=NaN,r}let e,t,s=!1;for(;!s;){let r,i,o;do r=2*this.random()-1,i=2*this.random()-1,o=r*r+i*i;while(o>=1||o===0);const a=Math.sqrt(-2*Math.log(o)/o);e=this.mean+this.stdDev*r*a,t=this.mean+this.stdDev*i*a,(!this.truncated||this.isValidTruncated(e))&&(s=!0)}return(!this.truncated||this.isValidTruncated(t))&&(this.nextVal=this.convertValue(t)),this.convertValue(e)}convertValue(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)}isValidTruncated(e){return e<=this.upper&&e>=this.lower}}class PW{constructor(e=0,t=1,s,r){if(this.canReturnFloat=()=>this.dtype==null||this.dtype==="float32",this.min=e,this.range=t-e,this.dtype=s,r==null&&(r=Math.random()),typeof r=="number"&&(r=r.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${e} - ${t} <= 1 and dtype is not float`);this.random=j1.alea(r)}convertValue(e){return this.canReturnFloat()?e:Math.round(e)}nextValue(){return this.convertValue(this.min+this.range*this.random())}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MW(n,e=0,t=1,s,r){if(ao(n),s!=null&&s==="bool")throw new Error(`Unsupported data type ${s}`);const i=new $E(e,t,s,!1,r),o=dt(n,s);for(let a=0;a<o.values.length;a++)o.values[a]=i.nextValue();return o.toTensor()}const LW=oe({randomNormal_:MW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FW(n,e=0,t=1,s="float32",r){ao(n);const i=dt(n,s),o=new PW(e,t,null,r);for(let a=0;a<i.values.length;a++)i.values[a]=o.nextValue();return i.toTensor()}const gh=oe({randomUniform_:FW});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function td(n,e,t=1,s="float32"){if(t===0)throw new Error("Cannot have a step of zero");const r={start:n,stop:e,step:t,dtype:s};return re.runKernel(t1,{},r)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OW(n){const t={input:Z(n,"input","real")};return re.runKernel(n1,t)}const Jp=oe({real_:OW});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _W(n){const t={x:Z(n,"x","reciprocal")};return re.runKernel(Xd,t)}const zW=oe({reciprocal_:_W});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BW(n){const t={x:Z(n,"x","relu")};return re.runKernel(Yd,t)}const sl=oe({relu_:BW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WW(n){const t={x:Z(n,"x","relu6")};return re.runKernel(Zd,t)}const EE=oe({relu6_:WW});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VW(n,e){const s={x:Z(n,"x","reverse")},r={dims:e};return re.runKernel(Tg,s,r)}const Ka=oe({reverse_:VW});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UW(n){const t={x:Z(n,"x","round")};return re.runKernel(Jd,t)}const AE=oe({round_:UW});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GW(n){const t={x:Z(n,"x","rsqrt","float32")};return re.runKernel(eh,t)}const jE=oe({rsqrt_:GW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HW(n){const t={x:Z(n,"x","selu")};return re.runKernel(th,t)}const RE=oe({selu_:HW});function qW(n,e,t,s,r,i=[1,1],o="NHWC"){const a=Z(n,"x","separableConv2d"),l=Z(e,"depthwiseFilter","separableConv2d"),u=Z(t,"pointwiseFilter","separableConv2d");let d=a,f=!1;if(a.rank===3&&(f=!0,d=ie(a,[1,a.shape[0],a.shape[1],a.shape[2]])),o==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");V(d.rank===4,()=>`Error in separableConv2d: input must be rank 4, but got rank ${d.rank}.`),V(l.rank===4,()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${l.rank}.`),V(u.rank===4,()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${l.rank}.`),V(u.shape[0]===1,()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${u.shape[0]}.`),V(u.shape[1]===1,()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${u.shape[1]}.`);const p=l.shape[2],g=l.shape[3];V(u.shape[2]===p*g,()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${p*g}, but got ${u.shape[2]}.`);const x=b1(d,l,s,r,o,i),b=Ha(x,u,1,"valid",o);return f?ie(b,[b.shape[1],b.shape[2],b.shape[3]]):b}const DE=oe({separableConv2d_:qW});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KW(n){const t={x:Z(n,"x","sign")};return re.runKernel(rh,t)}const QW=oe({sign_:KW});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XW(n){const t={x:Z(n,"x","sin","float32")};return re.runKernel(nh,t)}const PE=oe({sin_:XW});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YW(n){const t={x:Z(n,"x","sinh")};return re.runKernel(sh,t)}const ME=oe({sinh_:YW});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZW(n,e,t){const s=Z(n,"x","slice1d");return V(s.rank===1,()=>`slice1d expects a rank-1 tensor, but got a rank-${s.rank} tensor`),Ot(s,[e],[t])}const R1=oe({slice1d_:ZW});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JW(n,e,t){const s=Z(n,"x","slice2d");return V(s.rank===2,()=>`slice2d expects a rank-2 tensor, but got a rank-${s.rank} tensor`),Ot(s,e,t)}const LE=oe({slice2d_:JW});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eV(n,e,t){const s=Z(n,"x","slice3d");return V(s.rank===3,()=>`slice3d expects a rank-3 tensor, but got a rank-${s.rank} tensor`),Ot(s,e,t)}const D1=oe({slice3d_:eV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tV(n,e,t){const s=Z(n,"x","slice4d");return V(s.rank===4,()=>`slice4d expects a rank-4 tensor, but got a rank-${s.rank} tensor`),Ot(s,e,t)}const em=oe({slice4d_:tV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nV(n,e=-1){const t=Z(n,"logits","softmax","float32");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${t.rank} and dim was ${e}`);const s={logits:t},r={dim:e};return re.runKernel(Dg,s,r)}const P1=oe({softmax_:nV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sV(n){V(n.dtype==="complex64",()=>`The dtype for tf.spectral.fft() must be complex64 but got ${n.dtype}.`);const e={input:n};return re.runKernel(Ub,e)}const FE=oe({fft_:sV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rV(n){V(n.dtype==="complex64",()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${n.dtype}.`);const e={input:n};return re.runKernel(qb,e)}const Nv=oe({ifft_:rV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iV(n){const e=n.shape[n.shape.length-1],t=n.size/e;let s;if(e<=2){const r=ie(n,[t,e]);s=Nv(r)}else{const r=[t,2*(e-1)],i=ie(Jp(n),[t,e]),o=ie(C1(n),[t,e]),a=Ka(Ot(i,[0,1],[t,e-2]),1),l=ne(Ka(Ot(o,[0,1],[t,e-2]),1),$t(-1)),u=Rs([i,a],1),d=Rs([o,l],1),f=ie(Ba(u,d),[r[0],r[1]]);s=Nv(f)}if(s=Jp(s),n.rank===3&&n.shape[0]!==0){const r=s,i=n.shape[0];s=ie(s,[i,s.shape[0]/i,s.shape[1]]),r.dispose()}return s}const oV=oe({irfft_:iV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aV(n,e,t=0){const r={x:Z(n,"x","split")},i={numOrSizeSplits:e,axis:t};return re.runKernel(Rg,r,i)}const or=oe({split_:aV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lV(n,e){V(n.dtype==="float32",()=>`The dtype for rfft() must be real value but got ${n.dtype}`);let t=n.shape[n.shape.length-1];const s=n.size/t;let r;if(e!=null&&e<t){const x=n.shape.map(b=>0),y=n.shape.map(b=>b);y[n.shape.length-1]=e,r=Ot(n,x,y),t=e}else if(e!=null&&e>t){const x=n.shape.map(y=>y);x[n.shape.length-1]=e-t,r=Rs([n,On(x)],n.shape.length-1),t=e}else r=n;const i=wt(r),o=ie(Ba(r,i),[s,t]),a=FE(o),l=Math.floor(t/2)+1,u=Jp(a),d=C1(a),f=or(u,[l,t-l],u.shape.length-1),p=or(d,[l,t-l],d.shape.length-1),g=r.shape.slice();return g[r.shape.length-1]=l,ie(Ba(f[0],p[0]),g)}const cV=oe({rfft_:lV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uV(n,e){let t=Z(n,"a","squaredDifference"),s=Z(e,"b","squaredDifference");[t,s]=pn(t,s),ot(t.shape,s.shape);const r={a:t,b:s},i={};return re.runKernel(lh,r,i)}const dV=oe({squaredDifference_:uV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hV(n,e){const t=Z(n,"x","squeeze","string_or_numeric");return ie(t,Xo(t.shape,e).newShape)}const xh=oe({squeeze_:hV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fV(n,e=0){const t=rE(n,"tensors","stack","string_or_numeric");V(t.length>=1,()=>"Pass at least one tensor to tf.stack"),t.length>0&&V(e<=t[0].rank,()=>"Axis must be <= rank of the tensor");const s=t,r={axis:e};return re.runKernel(bg,s,r)}const no=oe({stack_:fV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pV(n,e=0){const s={x:Z(n,"x","step")},r={alpha:e};return re.runKernel(fh,s,r)}const yh=oe({step_:pV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mV(n,e,t,s,r=0,i=0,o=0,a=0,l=0){const d={x:Z(n,"x","stridedSlice","string_or_numeric")},f={begin:e,end:t,strides:s,beginMask:r,endMask:i,ellipsisMask:o,newAxisMask:a,shrinkAxisMask:l};return re.runKernel(a1,d,f)}const gV=oe({stridedSlice_:mV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xV(n){const t={x:Z(n,"x","tan","float32")};return re.runKernel(uh,t)}const yV=oe({tan_:xV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function js(n,e){p$(n);const t=Og(n,e);if(t.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return _g(n,null,t,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zl(n,e,t){if(p$(n),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");const s=Og(n,t);if(s.length!==2&&s.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(s.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return _g(n,e,s,t)}function OE(n,e,t){const s=e.rank>1?e.shape[e.rank-1]:1,r=e.rank>1?e.rank-1:1,i=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${t.shape}, indices.shape: ${e.shape}, shape: ${n}, sliceDim: ${s}, and batchDim: ${r}.`;if(t.rank<r)throw new Error(i+` update.rank < ${r}. `);if(n.length<s+(t.rank-r))throw new Error(i+` Output shape length < ${s+(t.rank-r)}`);if(t.rank!==r+n.length-s)throw new Error(i+` update.rank != ${r+n.length-s}`);for(let o=0;o<r;++o)if(t.shape[o]!==e.shape[o])throw new Error(i+` updates.shape[${o}] (${t.shape[o]}) != indices.shape[${o}] (${e.shape[o]}).`);for(let o=0;o<t.rank-r;++o)if(t.shape[o+r]!==n[o+s])throw new Error(i+` updates.shape[${o+r}] (${t.shape[o+r]}) != shape[${o+r}] (${n[o+r]})`)}function vV(n,e,t){if(e.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${e.rank}.`);if(n.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${n.rank}.`);if(e.dtype!=="int32")throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${e.dtype}`);if(t.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${t}`);if(t.length===0){if(e.size===0)throw new Error(`Indices specified for empty output. indices shape: ${e.shape}`);if(n.size===0)throw new Error(`Updates specified for empty output. updates shape: ${n.shape}`)}OE(t,e,n)}function rl(n,e,t){const s=e.shape.length,r=s>1?e.shape[s-1]:1,i=t.length;let o=1;for(let f=r;f<i;++f)o*=t[f];const a=r<1?1:r,l=be(e.shape)/a,u=[...Qe(t.slice(0,r)),1],d=be(t);return{sliceRank:r,numUpdates:l,sliceSize:o,strides:u,outputSize:d}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bV(n,e=1,t=!0){const s=Z(n,"x","topk");if(s.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");const r=s.shape[s.shape.length-1];if(e<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${e}`);if(e>r)throw new Error(`'k' passed to topk() must be <= the last dimension (${r}) but got ${e}`);const i={x:s},o={k:e,sorted:t},[a,l]=re.runKernel(l1,i,o);return{values:a,indices:l}}const wV=oe({topk_:bV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kV(n,e=0,t=1,s,r){if(ao(n),s!=null&&s==="bool")throw new Error("Unsupported data type $ { dtype }");const i=new $E(e,t,s,!0,r),o=dt(n,s);for(let a=0;a<o.values.length;a++)o.values[a]=i.nextValue();return o.toTensor()}const _E=oe({truncatedNormal_:kV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CV(n,e=0){const t=Z(n,"x","unique","string_or_numeric");V(t.rank>0,()=>"The input tensor must be at least 1D");const s={x:t},r={axis:e},[i,o]=re.runKernel(u1,s,r);return{values:i,indices:o}}const SV=oe({unique_:CV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NV(n,e,t){const s=Z(n,"x","unsortedSegmentSum"),r=Z(e,"segmentIds","unsortedSegmentSum","int32");V(oc(t),()=>"numSegments must be of dtype int");const i={x:s,segmentIds:r},o={numSegments:t};return re.runKernel(Mg,i,o)}const zE=oe({unsortedSegmentSum_:NV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IV(n,e=0){const t=Z(n,"x","unstack","string_or_numeric");V(e>=-t.shape.length&&e<t.shape.length,()=>`Axis = ${e} is not in [-${t.shape.length}, ${t.shape.length})`);const s={value:t},r={axis:e};return re.runKernel(Pg,s,r)}const Qa=oe({unstack_:IV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TV(n,e=!0,t,s){return re.makeVariable(n,e,t,s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BE(n,e){const t=[];for(let i=0;i<e.length;i++)e[i]&&t.push(i);const s=dt(n,"int32"),r=dt([t.length,n.length],"int32");for(let i=0;i<t.length;i++){const o=s.indexToLoc(t[i]),a=i*n.length;r.values.set(o,a)}return r.toTensor()}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $V(n,e,t){const s=Z(n,"x","transpose");if(e==null&&(e=s.shape.map((o,a)=>a).reverse()),V(s.rank===e.length,()=>`Error in transpose: rank of input ${s.rank} must match length of perm ${e}.`),e.forEach(o=>{V(o>=0&&o<s.rank,()=>`All entries in 'perm' must be between 0 and ${s.rank-1} but got ${e}`)}),s.rank<=1)return s.clone();const r={x:s},i={perm:e};return s.dtype==="complex64"?de(()=>{let o=Jp(s),a=C1(s);return o=re.runKernel(Ql,{x:o},i),a=re.runKernel(Ql,{x:a},i),t&&(a=fn(a)),Ba(o,a)}):re.runKernel(Ql,r,i)}const bt=oe({transpose_:$V});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EV(n,e){if(e==null)return n.shape.slice();if(At(n.shape,e))return e;if(n.shape.length===e.length){const t=[];for(let s=0;s<n.shape.length;s++)e[s]==null&&n.shape[s]!=null?t.push(n.shape[s]):t.push(e[s]);return t}return e}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AV(n,e,t,s){const r=Z(n,"x","dropout");if(V(r.dtype==="float32",()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${r.dtype} tensor instead.`),V(e>=0&&e<1,()=>`rate must be a float in the range [0, 1), but got ${e}.`),e===0)return n instanceof Sn?r.clone():r;const i=EV(r,t),o=1-e,a=Ze(Gg($e(gh(i,0,1,"float32",s),o)),o);return ne(r,a)}const jV=oe({dropout_:AV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RV(n,e,t,s,r,i="NHWC",o){let a=n;n.rank===3&&(a=ie(n,[1,n.shape[0],n.shape[1],n.shape[2]]));let l=e;l.rank===3&&(l=ie(e,[1,e.shape[0],e.shape[1],e.shape[2]])),V(a.rank===4,()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${a.shape}.`),V(l.rank===4,()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${l.shape}.`),V(t.length===4,()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${t}.`);const u=i==="NHWC"?a.shape[3]:a.shape[1],d=i==="NHWC"?l.shape[3]:l.shape[1];V(u===t[2],()=>`Error in conv2dDerFilter: depth of input ${u}) must match input depth in filter (${t[2]}.`),V(d===t[3],()=>`Error in conv2dDerFilter: depth of dy (${d}) must match output depth for filter (${t[3]}).`),Ls("conv2dDerFilter",r,o);const f={x:a,dy:l},p={strides:s,pad:r,dataFormat:i,dimRoundingMode:o,filterShape:t};return re.runKernel(Db,f,p)}const M1=oe({conv2DBackpropFilter_:RV});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function L1(n,e,t){if(t==null||t==="linear")return n;if(t==="relu")return ne(n,yh(e));throw new Error(`Cannot compute gradient for fused activation ${t}.`)}function F1(n,e){let t=e;const s=En(n.shape,e.shape);return s.length>0&&(t=Ye(t,s)),ie(t,n.shape)}function O1(n,e,t,s){if(e==="linear")return n;if(e==="relu")return sl(n);if(e==="elu")return Vg(n);if(e==="relu6")return EE(n);if(e==="prelu")return A1(n,t);if(e==="leakyrelu")return S1(n,s);if(e==="sigmoid")return $c(n);throw new Error(`Unknown fused activation ${e}.`)}const _1=(n,e)=>!(n>0)||e==="linear";/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DV({x:n,filter:e,strides:t,pad:s,dataFormat:r="NHWC",dilations:i=[1,1],dimRoundingMode:o,bias:a,activation:l="linear",preluActivationWeights:u,leakyreluAlpha:d}){if(l=l||"linear",_1(re.state.gradientDepth,l)===!1){V(r==="NHWC",()=>`Error in fused conv2d: got dataFormat of ${r} but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.`);let T=Ha(n,e,t,s,r,i,o);return a!=null&&(T=$e(T,a)),O1(T,l,u,d)}const f=Z(n,"x","conv2d","float32"),p=Z(e,"filter","conv2d","float32");let g=f,x=!1;f.rank===3&&(x=!0,g=ie(f,[1,f.shape[0],f.shape[1],f.shape[2]])),V(g.rank===4,()=>`Error in fused conv2d: input must be rank 4, but got rank ${g.rank}.`),V(p.rank===4,()=>`Error in fused conv2d: filter must be rank 4, but got rank ${p.rank}.`),Ls("fused conv2d",s,o);const y=r==="NHWC"?g.shape[3]:g.shape[1];V(p.shape[2]===y,()=>`Error in conv2d: depth of input (${y}) must match input depth for filter ${p.shape[2]}.`),V(rs(t,i),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${t} and dilations '${i}'`);const b=Qn(g.shape,p.shape,t,i,s,o);let k;a!=null&&(k=Z(a,"bias","fused conv2d"),[k]=pn(k,f),r==="NHWC"?ot(b.outShape,k.shape):(V(k.shape.length<=1,()=>`Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-${k.shape.length}.`),V(k.shape.length===0||k.shape[0]===b.outChannels||k.shape[0]===1,()=>`Error in fused conv2d: bias shape (${k.shape}) is not compatible with the number of output channels (${b.outChannels})`)));let w;if(u!=null){const T=u.shape;if(V(T.length<=1||T.length===3,()=>`Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-${T.length}.`),T.length===1)V(T[0]===1||T[0]===b.outChannels,()=>`Error in fused conv2d: PReLU activation weights (${T}) is not compatible with the number of output channels (${b.outChannels}).`);else if(T.length===3)try{ot(T,b.outShape)}catch{const E=`Error in fused conv2d: PReLU activation weights (${T}) is not compatible with the output shape of the conv2d (${b.outShape}).`;throw Error(E)}w=Z(u,"prelu weights","fused conv2d")}const N=(T,A)=>{V(r==="NHWC",()=>`Error in gradient of fused conv2D: got dataFormat of ${r} but only NHWC is currently supported.`);const[E,M,P,R]=A,L=L1(T,P,l);V(Ua(i),()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${i}'`);const _=y1(M.shape,L,E,t,s),O=M1(M,L,E.shape,t,s),U=[_,O];if(R!=null){const W=F1(R,L);U.push(W)}return U},C={x:g,filter:p,bias:k,preluActivationWeights:w},S={strides:t,pad:s,dataFormat:r,dilations:i,dimRoundingMode:o,activation:l,leakyreluAlpha:d};return a==null?uc((A,E,M)=>{let P=re.runKernel(Hp,C,S);return M([E,A,P]),x&&(P=ie(P,[P.shape[1],P.shape[2],P.shape[3]])),{value:P,gradFunc:N}})(g,p):uc((A,E,M,P)=>{let R=re.runKernel(Hp,C,S);return P([E,A,R,M]),x&&(R=ie(R,[R.shape[1],R.shape[2],R.shape[3]])),{value:R,gradFunc:N}})(g,p,k)}const PV=oe({fusedConv2d_:DV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MV(n,e,t,s,r,i=[1,1],o){let a=n;n.rank===3&&(a=ie(n,[1,n.shape[0],n.shape[1],n.shape[2]]));let l=e;l.rank===3&&(l=ie(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const u={x:a,dy:l},d={strides:s,pad:r,dimRoundingMode:o,dilations:i,filterShape:t};return re.runKernel(zb,u,d)}const LV=oe({depthwiseConv2dNativeBackpropFilter_:MV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FV(n,e,t,s,r,i=[1,1],o){let a=e,l=!1;e.rank===3&&(l=!0,a=ie(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const u={dy:a,filter:t},d={strides:s,pad:r,dimRoundingMode:o,dilations:i,inputShape:n},f=re.runKernel(Bb,u,d);return l?ie(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const OV=oe({depthwiseConv2dNativeBackpropInput_:FV});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _V({a:n,b:e,transposeA:t=!1,transposeB:s=!1,bias:r,activation:i="linear",preluActivationWeights:o,leakyreluAlpha:a=.2}){if(_1(re.state.gradientDepth,i)===!1){let R=Tt(n,e,t,s);return r!=null&&(R=$e(R,r)),O1(R,i,o,a)}let l=Z(n,"a","fused matMul"),u=Z(e,"b","fused matMul");[l,u]=pn(l,u);const d=t?l.shape[l.rank-2]:l.shape[l.rank-1],f=s?u.shape[u.rank-1]:u.shape[u.rank-2],p=t?l.shape[l.rank-1]:l.shape[l.rank-2],g=s?u.shape[u.rank-2]:u.shape[u.rank-1],x=l.shape.slice(0,-2),y=u.shape.slice(0,-2),b=be(x),k=be(y);V(d===f,()=>`Error in fused matMul: inner shapes (${d}) and (${f}) of Tensors with shapes ${l.shape} and ${u.shape} and transposeA=${t} and transposeB=${s} must match.`);const N=ot(l.shape.slice(0,-2),u.shape.slice(0,-2)).concat([p,g]),C=t?ie(l,[b,d,p]):ie(l,[b,p,d]),S=s?ie(u,[k,g,f]):ie(u,[k,f,g]);let T;r!=null&&(T=Z(r,"bias","fused matMul"),[T]=pn(T,l),ot(N,T.shape));let A;o!=null&&(A=Z(o,"prelu weights","fused matMul"));const E=(R,L)=>{const[_,O,U,W]=L,H=L1(ie(R,U.shape),U,i);let G,q;if(!t&&!s?(G=Tt(H,O,!1,!0),q=Tt(_,H,!0,!1)):!t&&s?(G=Tt(H,O,!1,!1),q=Tt(H,_,!0,!1)):t&&!s?(G=Tt(O,H,!1,!0),q=Tt(_,H,!1,!1)):(G=Tt(O,H,!0,!0),q=Tt(H,_,!0,!0)),r!=null){const Q=F1(W,H);return[G,q,Q]}else return[G,q]},M={a:C,b:S,bias:T,preluActivationWeights:A},P={transposeA:t,transposeB:s,activation:i,leakyreluAlpha:a};return r==null?uc((L,_,O)=>{const U=re.runKernel(Gp,M,P);return O([L,_,U]),{value:ie(U,N),gradFunc:E}})(C,S):uc((L,_,O,U)=>{const W=re.runKernel(Gp,M,P);return U([L,_,W,O]),{value:ie(W,N),gradFunc:E}})(C,S,T)}const qS=oe({fusedMatMul_:_V});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zV(n,e,t,s,r="bilinear",i=0){const o=Z(n,"image","cropAndResize"),a=Z(e,"boxes","cropAndResize","float32"),l=Z(t,"boxInd","cropAndResize","int32"),u=a.shape[0];V(o.rank===4,()=>`Error in cropAndResize: image must be rank 4,but got rank ${o.rank}.`),V(a.rank===2&&a.shape[1]===4,()=>`Error in cropAndResize: boxes must be have size [${u},4] but had shape ${a.shape}.`),V(l.rank===1&&l.shape[0]===u,()=>`Error in cropAndResize: boxInd must be have size [${u}] but had shape ${a.shape}.`),V(s.length===2,()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${s.length}.`),V(s[0]>=1&&s[1]>=1,()=>`cropSize must be atleast [1,1], but was ${s}`),V(r==="bilinear"||r==="nearest",()=>`method must be bilinear or nearest, but was ${r}`);const d={image:o,boxes:a,boxInd:l},f={method:r,extrapolationValue:i,cropSize:s};return re.runKernel(Fb,d,f)}const BV=oe({cropAndResize_:zV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WV(n){const e=Z(n,"image","flipLeftRight","float32");V(e.rank===4,()=>`Error in flipLeftRight: image must be rank 4,but got rank ${e.rank}.`);const t={image:e};return re.runKernel(Hb,t,{})}const VV=oe({flipLeftRight_:WV});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UV(n){const e=Z(n,"image","grayscaleToRGB"),t=e.rank-1,s=e.shape[t];V(e.rank>=2,()=>`Error in grayscaleToRGB: images must be at least rank 2, but got rank ${e.rank}.`),V(s===1,()=>`Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ${s}.`);const r=new Array(e.rank);return r.fill(1,0,t),r[t]=3,Qr(e,r)}const GV=oe({grayscaleToRGB_:UV});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HV(n){const e=Z(n,"image","RGBToGrayscale"),t=e.rank-1,s=e.shape[t];V(e.rank>=2,()=>`Error in RGBToGrayscale: images must be at least rank 2, but got rank ${e.rank}.`),V(s===3,()=>`Error in RGBToGrayscale: last dimension of an RGB image should be size 3, but got size ${s}.`);const r=e.dtype,i=Fe(e,"float32"),o=js([.2989,.587,.114]);let a;switch(e.rank){case 2:a=Tu("ij,j->i",i,o);break;case 3:a=Tu("ijk,k->ij",i,o);break;case 4:a=Tu("ijkl,l->ijk",i,o);break;case 5:a=Tu("ijklm,m->ijkl",i,o);break;case 6:a=Tu("ijklmn,n->ijklm",i,o);break;default:throw new Error("Not a valid tensor rank.")}return a=Es(a,-1),Fe(a,r)}const qV=oe({rgbToGrayscale_:HV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KV(n,e,t=0,s=.5){const r=Z(n,"image","rotateWithOffset","float32");V(r.rank===4,()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${r.rank}.`);const i={image:r},o={radians:e,fillValue:t,center:s};return re.runKernel(d1,i,o)}const QV=oe({rotateWithOffset_:KV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ac(n,e,t,s,r,i){s==null&&(s=.5),r==null&&(r=Number.NEGATIVE_INFINITY),i==null&&(i=0);const o=n.shape[0];return t=Math.min(t,o),V(0<=s&&s<=1,()=>`iouThreshold must be in [0, 1], but was '${s}'`),V(n.rank===2,()=>`boxes must be a 2D tensor, but was of rank '${n.rank}'`),V(n.shape[1]===4,()=>`boxes must have 4 columns, but 2nd dimension was ${n.shape[1]}`),V(e.rank===1,()=>"scores must be a 1D tensor"),V(e.shape[0]===o,()=>`scores has incompatible shape with boxes. Expected ${o}, but was ${e.shape[0]}`),V(0<=i&&i<=1,()=>`softNmsSigma must be in [0, 1], but was '${i}'`),{maxOutputSize:t,iouThreshold:s,scoreThreshold:r,softNmsSigma:i}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XV(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY){const i=Z(n,"boxes","nonMaxSuppression","float32"),o=Z(e,"scores","nonMaxSuppression","float32"),a=Ac(i,o,t,s,r);t=a.maxOutputSize,s=a.iouThreshold,r=a.scoreThreshold;const l={maxOutputSize:t,iouThreshold:s,scoreThreshold:r};return re.runKernel(Zb,{boxes:i,scores:o},l)}const YV=oe({nonMaxSuppression_:XV});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZV(n,e,t){const s=JV(n,e,t),r=s<0?-(s+1):s;n.splice(r,0,e)}function JV(n,e,t){return t6(n,e,t||e6)}function e6(n,e){return n>e?1:n<e?-1:0}function t6(n,e,t){let s=0,r=n.length,i=0,o=!1;for(;s<r;){i=s+(r-s>>>1);const a=t(e,n[i]);a>0?s=i+1:(r=i,o=!a)}return o?s:-s-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function z1(n,e,t,s,r){return V1(n,e,t,s,r,0)}function B1(n,e,t,s,r,i){return V1(n,e,t,s,r,0,!1,i,!0)}function W1(n,e,t,s,r,i){return V1(n,e,t,s,r,i,!0)}function V1(n,e,t,s,r,i,o=!1,a=!1,l=!1){const u=[];for(let b=0;b<e.length;b++)e[b]>r&&u.push({score:e[b],boxIndex:b,suppressBeginIndex:0});u.sort(KS);const d=i>0?-.5/i:0,f=[],p=[];for(;f.length<t&&u.length>0;){const b=u.pop(),{score:k,boxIndex:w,suppressBeginIndex:N}=b;if(k<r)break;let C=!1;for(let S=f.length-1;S>=N;--S){const T=n6(n,w,f[S]);if(T>=s){C=!0;break}if(b.score=b.score*s6(s,d,T),b.score<=r)break}b.suppressBeginIndex=f.length,C||(b.score===k?(f.push(w),p.push(b.score)):b.score>r&&ZV(u,b,KS))}const g=f.length,x=t-g;a&&x>0&&(f.push(...new Array(x).fill(0)),p.push(...new Array(x).fill(0)));const y={selectedIndices:f};return o&&(y.selectedScores=p),l&&(y.validOutputs=g),y}function n6(n,e,t){const s=n.subarray(e*4,e*4+4),r=n.subarray(t*4,t*4+4),i=Math.min(s[0],s[2]),o=Math.min(s[1],s[3]),a=Math.max(s[0],s[2]),l=Math.max(s[1],s[3]),u=Math.min(r[0],r[2]),d=Math.min(r[1],r[3]),f=Math.max(r[0],r[2]),p=Math.max(r[1],r[3]),g=(a-i)*(l-o),x=(f-u)*(p-d);if(g<=0||x<=0)return 0;const y=Math.max(i,u),b=Math.max(o,d),k=Math.min(a,f),w=Math.min(l,p),N=Math.max(k-y,0)*Math.max(w-b,0);return N/(g+x-N)}function s6(n,e,t){const s=Math.exp(e*t*t);return t<=n?s:0}function KS(n,e){return n.score-e.score||n.score===e.score&&e.boxIndex-n.boxIndex}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function r6(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY){const i=Z(n,"boxes","nonMaxSuppressionAsync"),o=Z(e,"scores","nonMaxSuppressionAsync"),a=Ac(i,o,t,s,r);t=a.maxOutputSize,s=a.iouThreshold,r=a.scoreThreshold;const l=await Promise.all([i.data(),o.data()]),u=l[0],d=l[1],{selectedIndices:f}=z1(u,d,t,s,r);return i!==n&&i.dispose(),o!==e&&o.dispose(),js(f,"int32")}const i6=r6;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o6(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY,i=0){const o=Z(n,"boxes","nonMaxSuppression"),a=Z(e,"scores","nonMaxSuppression"),l=Ac(o,a,t,s,r,i);t=l.maxOutputSize,s=l.iouThreshold,r=l.scoreThreshold,i=l.softNmsSigma;const u={boxes:o,scores:a},d={maxOutputSize:t,iouThreshold:s,scoreThreshold:r,softNmsSigma:i},f=re.runKernel(e1,u,d);return{selectedIndices:f[0],selectedScores:f[1]}}const a6=oe({nonMaxSuppressionWithScore_:o6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function l6(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY,i=0){const o=Z(n,"boxes","nonMaxSuppressionAsync"),a=Z(e,"scores","nonMaxSuppressionAsync"),l=Ac(o,a,t,s,r,i);t=l.maxOutputSize,s=l.iouThreshold,r=l.scoreThreshold,i=l.softNmsSigma;const u=await Promise.all([o.data(),a.data()]),d=u[0],f=u[1],{selectedIndices:p,selectedScores:g}=W1(d,f,t,s,r,i);return o!==n&&o.dispose(),a!==e&&a.dispose(),{selectedIndices:js(p,"int32"),selectedScores:js(g)}}const c6=l6;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function u6(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY,i=!1){const o=Z(n,"boxes","nonMaxSuppression"),a=Z(e,"scores","nonMaxSuppression"),l=Ac(o,a,t,s,r,null),u=l.maxOutputSize,d=l.iouThreshold,f=l.scoreThreshold,p={boxes:o,scores:a},g={maxOutputSize:u,iouThreshold:d,scoreThreshold:f,padToMaxOutputSize:i},x=re.runKernel(Jb,p,g);return{selectedIndices:x[0],validOutputs:x[1]}}const d6=oe({nonMaxSuppressionPadded_:u6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function h6(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY,i=!1){const o=Z(n,"boxes","nonMaxSuppressionAsync"),a=Z(e,"scores","nonMaxSuppressionAsync"),l=Ac(o,a,t,s,r,null),u=l.maxOutputSize,d=l.iouThreshold,f=l.scoreThreshold,[p,g]=await Promise.all([o.data(),a.data()]),{selectedIndices:x,validOutputs:y}=B1(p,g,u,d,f,i);return o!==n&&o.dispose(),a!==e&&a.dispose(),{selectedIndices:js(x,"int32"),validOutputs:$t(y,"int32")}}const f6=h6;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p6(n,e,t=!1,s=!1){const r=Z(n,"images","resizeBilinear");V(r.rank===3||r.rank===4,()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${r.rank}.`),V(e.length===2,()=>`Error in resizeBilinear: new shape must 2D, but got shape ${e}.`),V(s===!1||t===!1,()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false.");let i=r,o=!1;r.rank===3&&(o=!0,i=ie(r,[1,r.shape[0],r.shape[1],r.shape[2]]));const a={images:i},l={alignCorners:t,halfPixelCenters:s,size:e},u=re.runKernel(Ig,a,l);return o?ie(u,[u.shape[1],u.shape[2],u.shape[3]]):u}const WE=oe({resizeBilinear_:p6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function m6(n,e,t=!1,s=!1){const r=Z(n,"images","resizeNearestNeighbor");V(r.rank===3||r.rank===4,()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${r.rank}.`),V(e.length===2,()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${e}.`),V(r.dtype==="float32"||r.dtype==="int32",()=>"`images` must have `int32` or `float32` as dtype"),V(s===!1||t===!1,()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false.");let i=r,o=!1;r.rank===3&&(o=!0,i=ie(r,[1,r.shape[0],r.shape[1],r.shape[2]]));const a={images:i},l={alignCorners:t,halfPixelCenters:s,size:e},u=re.runKernel(Ng,a,l);return o?ie(u,[u.shape[1],u.shape[2],u.shape[3]]):u}const VE=oe({resizeNearestNeighbor_:m6});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g6(n,e="binary",t=!1,s=.5){const r=Z(n,"image","threshold"),i=.2989,o=.587,a=.114,l=r.shape[0]*r.shape[1];let u=ne(js([s]),255),d,f,p,g;if(V(r.rank===3,()=>`Error in threshold: image must be rank 3,but got rank ${r.rank}.`),V(r.shape[2]===3||r.shape[2]===1,()=>`Error in threshold: image color channel must be equal to 3 or 1but got ${r.shape[2]}.`),V(r.dtype==="int32"||r.dtype==="float32",()=>`Error in dtype: image dtype must be int32 or float32,but got dtype ${r.dtype}.`),V(e==="otsu"||e==="binary",()=>`Method must be binary or otsu, but was ${e}`),r.shape[2]===3){[d,f,p]=or(r,[1,1,1],-1);const b=ne(d,i),k=ne(f,o),w=ne(p,a);g=$e($e(b,k),w)}else g=n;if(e==="otsu"){const b=f5(Fe(AE(g),"int32"),Uu([]),256);u=x6(b,l)}const x=t?Ec(g,u):lr(g,u);return Fe(ne(x,255),"int32")}function x6(n,e){let t=js([-1]),s=js([0]),r=js([0]),i,o,a,l,u,d;for(let f=0;f<n.size-1;f++){i=Ot(n,0,f+1),o=Ot(n,f+1),u=Ze(Ye(i),e),d=Ze(Ye(o),e);const p=Ye(ne(i,td(0,i.size)));a=Ze(p,Ye(i));const g=Wg(o.shape,i.size),x=$e(td(0,o.size),g),y=ne(o,x);l=Ze(Ye(y),Ye(o));const b=tt(a,l),k=tt(a,l),w=ne(u,d);r=ne(ne(w,b),k);const N=lr(r,s);s=bs(N,r,s),t=bs(N,js([f]),t)}return t}const y6=oe({threshold_:g6});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function v6(n,e,t="nearest",s="constant",r=0,i){const o=Z(n,"image","transform","float32"),a=Z(e,"transforms","transform","float32");V(o.rank===4,()=>`Error in transform: image must be rank 4,but got rank ${o.rank}.`),V(a.rank===2&&(a.shape[0]===o.shape[0]||a.shape[0]===1)&&a.shape[1]===8,()=>"Error in transform: Input transform should be batch x 8 or 1 x 8"),V(i==null||i.length===2,()=>`Error in transform: outputShape must be [height, width] or null, but got ${i}.`);const l={image:o,transforms:a},u={interpolation:t,fillMode:s,fillValue:r,outputShape:i};return re.runKernel(c1,l,u)}const b6=oe({transform_:v6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function w6(n,e,t){const s=Z(n,"a","bandPart");V(s.rank>=2,()=>`bandPart(): Rank must be at least 2, got ${s.rank}.`);const r=s.shape,[i,o]=s.shape.slice(-2);let a,l;typeof e=="number"?(V(e%1===0,()=>`bandPart(): numLower must be an integer, got ${e}.`),V(e<=i,()=>`bandPart(): numLower (${e}) must not be greater than the number of rows (${i}).`),a=Z(e<0?i:e,"numLower","bandPart")):(V(e.dtype==="int32",()=>"bandPart(): numLower's dtype must be an int32."),a=bs(Yp(e,0),i,ed(e,i))),typeof t=="number"?(V(t%1===0,()=>`bandPart(): numUpper must be an integer, got ${t}.`),V(t<=o,()=>`bandPart(): numUpper (${t}) must not be greater than the number of columns (${o}).`),l=Z(t<0?o:t,"numUpper","bandPart")):(V(t.dtype==="int32",()=>"bandPart(): numUpper's dtype must be an int32."),l=bs(Yp(t,0),o,ed(t,o)));const u=ie(td(0,i,1,"int32"),[-1,1]),d=td(0,o,1,"int32"),f=tt(u,d),p=to(Ec(f,a),nl(f,fn(l))),g=On([i,o],s.dtype);return ie(no(Qa(ie(s,[-1,i,o])).map(x=>bs(p,x,g))),r)}const k6=oe({bandPart_:w6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function C6(n){let e;if(Array.isArray(n)){e=!1,V(n!=null&&n.length>0,()=>"Gram-Schmidt process: input must not be null, undefined, or empty");const r=n[0].shape[0];for(let i=1;i<n.length;++i)V(n[i].shape[0]===r,()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${n[i].shape[0]} vs. ${r})`)}else e=!0,n=or(n,n.shape[0],0).map(r=>xh(r,[0]));V(n.length<=n[0].shape[0],()=>`Gram-Schmidt: Number of vectors (${n.length}) exceeds number of dimensions (${n[0].shape[0]}).`);const t=[],s=n;for(let r=0;r<n.length;++r)t.push(re.tidy(()=>{let i=s[r];if(r>0)for(let o=0;o<r;++o){const a=ne(Ye(ne(t[o],i)),t[o]);i=tt(i,a)}return Ze(i,Ug(i,"euclidean"))}));return e?no(t,0):t}const S6=oe({gramSchmidt_:C6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function N6(n,e=!1){if(V(n.rank>=2,()=>`qr() requires input tensor to have a rank >= 2, but got rank ${n.rank}`),n.rank===2)return QS(n,e);{const t=n.shape.slice(0,n.shape.length-2).reduce((l,u)=>l*u),s=Qa(ie(n,[t,n.shape[n.shape.length-2],n.shape[n.shape.length-1]]),0),r=[],i=[];s.forEach(l=>{const[u,d]=QS(l,e);r.push(u),i.push(d)});const o=ie(no(r,0),n.shape),a=ie(no(i,0),n.shape);return[o,a]}}function QS(n,e=!1){return re.tidy(()=>{V(n.shape.length===2,()=>`qr2d() requires a 2D Tensor, but got a ${n.shape.length}D Tensor.`);const t=n.shape[0],s=n.shape[1];let r=kE(t),i=Pa(n);const o=Zl([[1]],[1,1]);let a=Pa(o);const l=t>=s?s:t;for(let u=0;u<l;++u){const d=i,f=a,p=r;[a,i,r]=re.tidy(()=>{const g=Ot(i,[u,u],[t-u,1]),x=Ug(g),y=Ot(i,[u,u],[1,1]),b=bs(lr(y,0),Zl([[-1]]),Zl([[1]])),k=tt(y,ne(b,x)),w=Ze(g,k);w.shape[0]===1?a=Pa(o):a=Rs([o,Ot(w,[1,0],[w.shape[0]-1,w.shape[1]])],0);const N=fn(Ze(Tt(b,k),x)),C=Ot(i,[u,0],[t-u,s]),S=ne(N,a),T=bt(a);if(u===0)i=tt(C,Tt(S,Tt(T,C)));else{const M=tt(C,Tt(S,Tt(T,C)));i=Rs([Ot(i,[0,0],[u,s]),M],0)}const A=bt(S),E=Ot(r,[0,u],[t,r.shape[1]-u]);if(u===0)r=tt(E,Tt(Tt(E,a),A));else{const M=tt(E,Tt(Tt(E,a),A));r=Rs([Ot(r,[0,0],[t,u]),M],1)}return[a,i,r]}),ct([d,f,p])}return!e&&t>s&&(r=Ot(r,[0,0],[t,s]),i=Ot(i,[0,0],[s,s])),[r,i]})}const I6=oe({qr_:N6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xi={flipLeftRight:VV,grayscaleToRGB:GV,resizeNearestNeighbor:VE,resizeBilinear:WE,rgbToGrayscale:qV,rotateWithOffset:QV,cropAndResize:BV,nonMaxSuppression:YV,nonMaxSuppressionAsync:i6,nonMaxSuppressionWithScore:a6,nonMaxSuppressionWithScoreAsync:c6,nonMaxSuppressionPadded:d6,nonMaxSuppressionPaddedAsync:f6,threshold:y6,transform:b6},T6={bandPart:k6,gramSchmidt:S6,qr:I6};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $6=new Map,E6=new Map;class jc{getClassName(){return this.constructor.className}static fromConfig(e,t){return new e(t)}}class Cr{constructor(){this.classNameMap={}}static getMap(){return Cr.instance==null&&(Cr.instance=new Cr),Cr.instance}static register(e){Cr.getMap().classNameMap[e.className]=[e,e.fromConfig]}}function Se(n,e,t){V(n.className!=null,()=>"Class being registered does not have the static className property defined."),V(typeof n.className=="string",()=>"className is required to be a string, but got type "+typeof n.className),V(n.className.length>0,()=>"Class being registered has an empty-string as its className, which is disallowed."),typeof e>"u"&&(e="Custom"),typeof t>"u"&&(t=n.className);const s=t,r=e+">"+s;return Cr.register(n),$6.set(r,n),E6.set(n,r),n}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class sa extends jc{minimize(e,t=!1,s){const{value:r,grads:i}=this.computeGradients(e,s);if(s!=null){const o=s.map(a=>({name:a.name,tensor:i[a.name]}));this.applyGradients(o)}else this.applyGradients(i);return ct(i),t?r:(r.dispose(),null)}get iterations(){return this.iterations_==null&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(e,t){return PB(e,t)}dispose(){this.iterations_!=null&&ct(this.iterations_)}async saveIterations(){return this.iterations_==null&&(this.iterations_=0),{name:"iter",tensor:$t(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(e){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(e){return this.iterations_=(await e[0].tensor.data())[0],e.slice(1)}}Object.defineProperty(sa,Symbol.hasInstance,{value:n=>n.minimize!=null&&n.computeGradients!=null&&n.applyGradients!=null});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class UE extends sa{static get className(){return"Adadelta"}constructor(e,t,s=null){super(),this.learningRate=e,this.rho=t,this.epsilon=s,this.accumulatedGrads=[],this.accumulatedUpdates=[],s==null&&(this.epsilon=re.backend.epsilon())}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const i=re.registeredVariables[s],o=!1;this.accumulatedGrads[r]==null&&(this.accumulatedGrads[r]={originalName:`${s}/accum_grad`,variable:de(()=>wt(i).variable(o))}),this.accumulatedUpdates[r]==null&&(this.accumulatedUpdates[r]={originalName:`${s}/accum_var`,variable:de(()=>wt(i).variable(o))});const a=Array.isArray(e)?e[r].tensor:e[s];if(a==null)return;const l=this.accumulatedGrads[r].variable,u=this.accumulatedUpdates[r].variable;de(()=>{const d=$e(ne(l,this.rho),ne(Bt(a),1-this.rho)),f=ne(Ze(ss($e(u,this.epsilon)),ss($e(l,this.epsilon))),a),p=$e(ne(u,this.rho),ne(Bt(f),1-this.rho));l.assign(d),u.assign(p);const g=$e(ne(f,-this.learningRate),i);i.assign(g)})}),this.incrementIterations()}dispose(){this.accumulatedUpdates!=null&&(ct(this.accumulatedGrads.map(e=>e.variable)),ct(this.accumulatedUpdates.map(e=>e.variable)))}async getWeights(){const e=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=e.length/2,s=!1;this.accumulatedGrads=e.slice(0,t).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedUpdates=e.slice(t,t*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)}))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.rho,t.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class GE extends sa{static get className(){return"Adagrad"}constructor(e,t=.1){super(),this.learningRate=e,this.initialAccumulatorValue=t,this.accumulatedGrads=[]}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const i=re.registeredVariables[s];this.accumulatedGrads[r]==null&&(this.accumulatedGrads[r]={originalName:`${s}/accumulator`,variable:de(()=>Wg(i.shape,this.initialAccumulatorValue).variable(!1))});const o=Array.isArray(e)?e[r].tensor:e[s];if(o==null)return;const a=this.accumulatedGrads[r].variable;de(()=>{const l=$e(a,Bt(o));a.assign(l);const u=$e(ne(Ze(o,ss($e(l,re.backend.epsilon()))),-this.learningRate),i);i.assign(u)})}),this.incrementIterations()}dispose(){this.accumulatedGrads!=null&&ct(this.accumulatedGrads.map(e=>e.variable))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=!1;this.accumulatedGrads=e.map(s=>({originalName:s.name,variable:s.tensor.variable(t)}))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(e,t){return new e(t.learningRate,t.initialAccumulatorValue)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class HE extends sa{static get className(){return"Adam"}constructor(e,t,s,r=null){super(),this.learningRate=e,this.beta1=t,this.beta2=s,this.epsilon=r,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],de(()=>{this.accBeta1=$t(t).variable(),this.accBeta2=$t(s).variable()}),r==null&&(this.epsilon=re.backend.epsilon())}applyGradients(e){const t=Array.isArray(e)?e.map(s=>s.name):Object.keys(e);de(()=>{const s=tt(1,this.accBeta1),r=tt(1,this.accBeta2);t.forEach((i,o)=>{const a=re.registeredVariables[i],l=!1;this.accumulatedFirstMoment[o]==null&&(this.accumulatedFirstMoment[o]={originalName:`${i}/m`,variable:de(()=>wt(a).variable(l))}),this.accumulatedSecondMoment[o]==null&&(this.accumulatedSecondMoment[o]={originalName:`${i}/v`,variable:de(()=>wt(a).variable(l))});const u=Array.isArray(e)?e[o].tensor:e[i];if(u==null)return;const d=this.accumulatedFirstMoment[o].variable,f=this.accumulatedSecondMoment[o].variable,p=$e(ne(d,this.beta1),ne(u,1-this.beta1)),g=$e(ne(f,this.beta2),ne(Bt(u),1-this.beta2)),x=Ze(p,s),y=Ze(g,r);d.assign(p),f.assign(g);const b=$e(ne(Ze(x,$e(ss(y),this.epsilon)),-this.learningRate),a);a.assign(b)}),this.accBeta1.assign(ne(this.accBeta1,this.beta1)),this.accBeta2.assign(ne(this.accBeta2,this.beta2))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&ct(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedSecondMoment!=null&&ct(this.accumulatedSecondMoment.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e),de(()=>{this.accBeta1.assign(qa(this.beta1,this.iterations_+1)),this.accBeta2.assign(qa(this.beta2,this.iterations_+1))});const t=e.length/2,s=!1;this.accumulatedFirstMoment=e.slice(0,t).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedSecondMoment=e.slice(t,t*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)}))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class qE extends sa{static get className(){return"Adamax"}constructor(e,t,s,r=null,i=0){super(),this.learningRate=e,this.beta1=t,this.beta2=s,this.epsilon=r,this.decay=i,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],de(()=>{this.iteration=$t(0).variable(),this.accBeta1=$t(t).variable()}),r==null&&(this.epsilon=re.backend.epsilon())}applyGradients(e){const t=Array.isArray(e)?e.map(s=>s.name):Object.keys(e);de(()=>{const s=tt(1,this.accBeta1),r=Ze(-this.learningRate,$e(ne(this.iteration,this.decay),1));t.forEach((i,o)=>{const a=re.registeredVariables[i],l=!1;this.accumulatedFirstMoment[o]==null&&(this.accumulatedFirstMoment[o]={originalName:`${i}/m`,variable:wt(a).variable(l)}),this.accumulatedWeightedInfNorm[o]==null&&(this.accumulatedWeightedInfNorm[o]={originalName:`${i}/v`,variable:wt(a).variable(l)});const u=Array.isArray(e)?e[o].tensor:e[i];if(u==null)return;const d=this.accumulatedFirstMoment[o].variable,f=this.accumulatedWeightedInfNorm[o].variable,p=$e(ne(d,this.beta1),ne(u,1-this.beta1)),g=ne(f,this.beta2),x=xs(u),y=ta(g,x);d.assign(p),f.assign(y);const b=$e(ne(Ze(r,s),Ze(p,$e(y,this.epsilon))),a);a.assign(b)}),this.iteration.assign($e(this.iteration,1)),this.accBeta1.assign(ne(this.accBeta1,this.beta1))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&ct(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedWeightedInfNorm!=null&&ct(this.accumulatedWeightedInfNorm.map(e=>e.variable))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(e){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon,t.decay)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class U1 extends sa{static get className(){return"SGD"}constructor(e){super(),this.learningRate=e,this.setLearningRate(e)}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const i=Array.isArray(e)?e[r].tensor:e[s];if(i==null)return;const o=re.registeredVariables[s];de(()=>{const a=$e(ne(this.c,i),o);o.assign(a)})}),this.incrementIterations()}setLearningRate(e){this.learningRate=e,this.c!=null&&this.c.dispose(),this.c=ki($t(-e))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(e){if(e=await this.extractIterations(e),e.length!==0)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(e,t){return new e(t.learningRate)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class KE extends U1{static get className(){return"Momentum"}constructor(e,t,s=!1){super(e),this.learningRate=e,this.momentum=t,this.useNesterov=s,this.accumulations=[],this.m=$t(this.momentum)}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const i=re.registeredVariables[s];this.accumulations[r]==null&&(this.accumulations[r]={originalName:`${s}/momentum`,variable:de(()=>wt(i).variable(!1))});const o=this.accumulations[r].variable,a=Array.isArray(e)?e[r].tensor:e[s];a!=null&&de(()=>{let l;const u=$e(ne(this.m,o),a);this.useNesterov?l=$e(ne(this.c,$e(a,ne(u,this.m))),i):l=$e(ne(this.c,u),i),o.assign(u),i.assign(l)})}),this.incrementIterations()}dispose(){this.m.dispose(),this.accumulations!=null&&ct(this.accumulations.map(e=>e.variable))}setMomentum(e){this.momentum=e}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=!1;this.accumulations=e.map(s=>({originalName:s.name,variable:s.tensor.variable(t)}))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(e,t){return new e(t.learningRate,t.momentum,t.useNesterov)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class QE extends sa{static get className(){return"RMSProp"}constructor(e,t=.9,s=0,r=null,i=!1){if(super(),this.learningRate=e,this.decay=t,this.momentum=s,this.epsilon=r,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=i,r==null&&(this.epsilon=re.backend.epsilon()),e==null)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const i=re.registeredVariables[s],o=!1;this.accumulatedMeanSquares[r]==null&&(this.accumulatedMeanSquares[r]={originalName:`${s}/rms`,variable:de(()=>wt(i).variable(o))}),this.accumulatedMoments[r]==null&&(this.accumulatedMoments[r]={originalName:`${s}/momentum`,variable:de(()=>wt(i).variable(o))}),this.accumulatedMeanGrads[r]==null&&this.centered&&(this.accumulatedMeanGrads[r]={originalName:`${s}/mg`,variable:de(()=>wt(i).variable(o))});const a=Array.isArray(e)?e[r].tensor:e[s];if(a==null)return;const l=this.accumulatedMeanSquares[r].variable,u=this.accumulatedMoments[r].variable;de(()=>{const d=$e(ne(l,this.decay),ne(Bt(a),1-this.decay));if(this.centered){const f=this.accumulatedMeanGrads[r].variable,p=$e(ne(f,this.decay),ne(a,1-this.decay)),g=Ze(ne(a,this.learningRate),ss(tt(d,$e(Bt(p),this.epsilon)))),x=$e(ne(u,this.momentum),g);l.assign(d),f.assign(p),u.assign(x);const y=tt(i,x);i.assign(y)}else{const f=$e(ne(l,this.decay),ne(Bt(a),1-this.decay)),p=$e(ne(u,this.momentum),Ze(ne(a,this.learningRate),ss($e(f,this.epsilon))));l.assign(f),u.assign(p);const g=tt(i,p);i.assign(g)}})}),this.incrementIterations()}dispose(){this.accumulatedMeanSquares!=null&&ct(this.accumulatedMeanSquares.map(e=>e.variable)),this.accumulatedMeanGrads!=null&&this.centered&&ct(this.accumulatedMeanGrads.map(e=>e.variable)),this.accumulatedMoments!=null&&ct(this.accumulatedMoments.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&e.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=this.centered?e.length/3:e.length/2,s=!1;this.accumulatedMeanSquares=e.slice(0,t).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedMoments=e.slice(t,t*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.centered&&(this.accumulatedMeanGrads=e.slice(t*2,t*3).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(e,t){return new e(t.learningRate,t.decay,t.momentum,t.epsilon,t.centered)}}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const A6=[UE,GE,HE,qE,KE,QE,U1];function j6(){for(const n of A6)Se(n)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XS(n,e,t,s){o(n),t=t??0,s=s??1,a(t,s);let r=0;const i=l=>(l.then(u=>{const d=t+ ++r/n.length*(s-t);return e(d),u}),l);function o(l){V(l!=null&&Array.isArray(l)&&l.length>0,()=>"promises must be a none empty array")}function a(l,u){V(l>=0&&l<=1,()=>`Progress fraction must be in range [0, 1], but got startFraction ${l}`),V(u>=0&&u<=1,()=>`Progress fraction must be in range [0, 1], but got endFraction ${u}`),V(u>=l,()=>`startFraction must be no more than endFraction, but got startFraction ${l} and endFraction ${u}`)}return Promise.all(n.map(i))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function R6(n,e){e==null&&(e={});const t=e.fetchFunc==null?me().platform.fetch:e.fetchFunc,s=n.map(f=>t(f,e.requestInit,{isBinary:!0})),a=(e.onProgress==null?await Promise.all(s):await XS(s,e.onProgress,0,.5)).map(f=>f.arrayBuffer());return e.onProgress==null?await Promise.all(a):await XS(a,e.onProgress,.5,1)}function D6(n,e){var t;const s=e.fetchFunc==null?me().platform.fetch:e.fetchFunc;let r=0,i;return(t=e.onProgress)===null||t===void 0||t.call(e,0),new ReadableStream({pull:async o=>{for(var a;r<n.length;){i||(i=(await s(n[r],e.requestInit,{isBinary:!0})).body.getReader());const{done:l,value:u}=await i.read();if(l){r++,i=void 0,(a=e.onProgress)===null||a===void 0||a.call(e,r/n.length);continue}o.enqueue(u);return}o.close()}})}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const P6="application/octet-stream",M6="application/json";class G1{constructor(e,t){if(this.DEFAULT_METHOD="POST",t==null&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.weightUrlConverter=t.weightUrlConverter,t.fetchFunc!=null?(V(typeof t.fetchFunc=="function",()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"),this.fetch=t.fetchFunc):this.fetch=me().platform.fetch,V(e!=null&&e.length>0,()=>"URL path for http must not be null, undefined or empty."),Array.isArray(e)&&V(e.length===2,()=>`URL paths for http must have a length of 2, (actual length is ${e.length}).`),this.path=e,t.requestInit!=null&&t.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{},this.loadOptions=t}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");const t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);t.body=new FormData;const s=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],r=U_(e,s);if(t.body.append("model.json",new Blob([JSON.stringify(r)],{type:M6}),"model.json"),e.weightData!=null){const o=Zo.join(e.weightData);t.body.append("model.weights.bin",new Blob([o],{type:P6}),"model.weights.bin")}const i=await this.fetch(this.path,t);if(i.ok)return{modelArtifactsInfo:p1(e),responses:[i]};throw new Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${i.status}.`)}async loadModelJSON(){const e=await this.fetch(this.path,this.requestInit);if(!e.ok)throw new Error(`Request to ${this.path} failed with status code ${e.status}. Please verify this URL points to the model JSON of the model to load.`);let t;try{t=await e.json()}catch{let o=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?o+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":o+=" Please make sure the server is serving valid JSON for this request.",new Error(o)}const s=t.modelTopology,r=t.weightsManifest;if(s==null&&r==null)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);return t}async load(){if(this.loadOptions.streamWeights)return this.loadStream();const e=await this.loadModelJSON();return H_(e,t=>this.loadWeights(t))}async loadStream(){const e=await this.loadModelJSON(),t=await this.getWeightUrls(e.weightsManifest),s=FS(e.weightsManifest),r=()=>D6(t,this.loadOptions);return Object.assign(Object.assign({},e),{weightSpecs:s,getWeightStream:r})}async getWeightUrls(e){const t=Array.isArray(this.path)?this.path[1]:this.path,[s,r]=L6(t),i=this.weightPathPrefix||s,o=[],a=[];for(const l of e)for(const u of l.paths)this.weightUrlConverter!=null?a.push(this.weightUrlConverter(u)):o.push(i+u+r);return this.weightUrlConverter&&o.push(...await Promise.all(a)),o}async loadWeights(e){const t=await this.getWeightUrls(e),s=FS(e),r=await R6(t,this.loadOptions);return[s,r]}}G1.URL_SCHEME_REGEX=/^https?:\/\//;function L6(n){const e=n.lastIndexOf("/"),t=n.lastIndexOf("?"),s=n.substring(0,e),r=t>e?n.substring(t):"";return[s+"/",r]}function YS(n){return n.match(G1.URL_SCHEME_REGEX)!=null}const XE=(n,e)=>{if(typeof fetch>"u"&&(e==null||e.fetchFunc==null))return null;{let t=!0;if(Array.isArray(n)?t=n.every(s=>YS(s)):t=YS(n),t)return YE(n,e)}return null};Mn.registerSaveRouter(XE);Mn.registerLoadRouter(XE);function YE(n,e){return new G1(n,e)}function F6(n,e){return YE(n,e)}function H1(n,e){const t=n.shape.length,s=e.shape.length;if(t<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${t}.`);if(s<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${s}.`);if(e.dtype!=="int32")throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${e.dtype}.`);if(e.shape[s-1]>t)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${e.shape[s-1]} vs. ${t}`);if(be(n.shape)===0)throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${n.shape}.`);const r=e.shape,i=r[r.length-1];let o=1;for(let f=0;f<r.length-1;++f)o*=r[f];const a=n.shape,l=r.slice();l.pop();let u=1;for(let f=i;f<t;++f)u*=a[f],l.push(a[f]);const d=[...Qe(n.shape).map(f=>f/u),1].slice(0,i);return[l,o,u,d]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Iv=-2,O6=-1;function q1(n,e,t){const s=n.shape.length;V(s===e.length,()=>`Error in slice${s}D: Length of begin ${e} must match the rank of the array (${s}).`),V(s===t.length,()=>`Error in slice${s}D: Length of size ${t} must match the rank of the array (${s}).`);for(let r=0;r<s;++r)V(e[r]+t[r]<=n.shape[r],()=>`Error in slice${s}D: begin[${r}] + size[${r}] (${e[r]+t[r]}) would overflow input.shape[${r}] (${n.shape[r]})`)}function _6(n){const e=[];let t=0;for(;n>0;)n&1&&e.push(t),n/=2,t++;return e}function K1(n,e,t){const s=[];for(let r=0;r<n.length;r++)s[r]=Math.ceil((e[r]-n[r])/t[r]);return s}function ZE(n,e,t,s){const r=[...n];for(let i=r.length;i<s.length;i++)r.push(1);for(let i=0;i<t;i++)i===0?r[e]=1:(r.splice(e,0,1),r.pop());return r}function JE(n,e,t){return t<=n?t:t-(e-1)}function eA(n,e){const t=[];for(let s=0;s<n;s++)t.push(e+s);return t}function z6(n,e,t,s,r,i,o,a,l){const u=n.length;let d=new Array(u),f=new Array(u),p=new Array(u);if(e.length&&t>0){const g=e[0],x=t+1;d=tA(o,g,x,s,n),f=nA(a,g,x,r,n),p=ZE(i,g,x,n)}else for(let g=0;g<u;g++)d[g]=rA(o,s,i,n,g,l),f[g]=iA(a,r,i,n,g,l),p[g]=sA(i,g,l);return{begin:d,end:f,strides:p}}function tA(n,e,t,s,r){const i=[...r],o=eA(t,e);for(let a=0;a<i.length;a++)if(o.indexOf(a)>-1)i[a]=0;else{const l=JE(e,t,a);let u=s[l];n&1<<l&&(u=0),i[a]=u}return i}function nA(n,e,t,s,r){const i=[...r],o=eA(t,e);for(let a=0;a<i.length;a++)if(o.indexOf(a)>-1)i[a]=Number.MAX_SAFE_INTEGER;else{const l=JE(e,t,a);let u=s[l];n&1<<l&&(u=Number.MAX_SAFE_INTEGER),i[a]=u}for(let a=0;a<i.length;a++){const l=r[a];i[a]<0&&(i[a]+=l),i[a]=_a(0,i[a],r[a])}return i}function sA(n,e,t){let s=n[e];return(t&1<<e||s==null)&&(s=1),s}function rA(n,e,t,s,r,i){let o=e[r];const a=t[r]||1;(n&1<<r||i&1<<r||o==null)&&(a>0?o=Number.MIN_SAFE_INTEGER:o=Number.MAX_SAFE_INTEGER);const l=s[r];return o<0&&(o+=l),o=_a(0,o,l-1),o}function iA(n,e,t,s,r,i){let o=e[r];const a=t[r]||1;(n&1<<r||i&1<<r||o==null)&&(a>0?o=Number.MAX_SAFE_INTEGER:o=Number.MIN_SAFE_INTEGER);const l=s[r];return o<0&&(o+=l),a>0?o=_a(0,o,l):o=_a(-1,o,l-1),o}function Q1(n,e,t){let s=t.length;for(let r=0;r<t.length;r++)if(t[r]>1){s=r;break}for(let r=s+1;r<t.length;r++)if(e[r]>0||t[r]!==n[r])return!1;return!0}function X1(n,e){let t=n.length>0?n[n.length-1]:1;for(let s=0;s<n.length-1;s++)t+=n[s]*e[s];return t}function Hg(n,e,t){let s;const r=n.shape.length;typeof e=="number"?s=[e,...new Array(r-1).fill(0)]:e.length<r?s=e.concat(new Array(r-e.length).fill(0)):s=e.slice(),s.forEach(o=>{V(o!==-1,()=>"slice() does not support negative begin indexing.")});let i;return t==null?i=new Array(r).fill(-1):typeof t=="number"?i=[t,...new Array(r-1).fill(-1)]:t.length<r?i=t.concat(new Array(r-t.length).fill(-1)):i=t,i=i.map((o,a)=>o>=0?o:(V(o===-1,()=>`Negative size values should be exactly -1 but got ${o} for the slice() size at index ${a}.`),n.shape[a]-s[a])),[s,i]}function Y1(n,e,t,s,r,i,o,a,l){let u;if(s==null?(u=new Array(e.length),u.fill(1)):u=s,o!=null&&(o&o-1)!==0)throw new Error("Multiple ellipses in slice is not allowed.");let d=!1;const f={dims:u.length,numAddAxisAfterEllipsis:0,begin:e.slice(),end:t.slice(),strides:u.slice(),beginMask:r,endMask:i,ellipsisMask:o,newAxisMask:a,shrinkAxisMask:l};for(let N=0;N<f.dims;N++)d&&(1<<N&a)!==0&&f.numAddAxisAfterEllipsis++,1<<N&o&&(d=!0);d||(f.ellipsisMask|=1<<f.dims,f.dims++);const p={dims:n.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};B6(f,p);let g=!0,x=!0,y=!0;const b=[],k=[];for(let N=0;N<n.length;++N){if(p.strides[N]===0)throw Error(`strides[${N}] must be non-zero`);const C=!!(p.shrinkAxisMask&1<<N),S=n[N];if(S===-1){b.push(C?1:-1);continue}const T=[p.beginMask&1<<N,p.endMask&1<<N],A=[p.strides[N]>0?0:-1,p.strides[N]>0?S:S-1];if(C&&p.strides[N]<=0)throw Error("only stride 1 allowed on non-range indexing.");y=y&&p.strides[N]===1;const E=!!(p.beginMask&1<<N&&p.endMask&1<<N);if(p.beginValid&&p.endValid){if(C){const L=p.begin[N]<0?S+p.begin[N]:p.begin[N];if(p.begin[N]=L,p.end[N]=p.begin[N]+1,L<0||L>=S)throw Error(`slice index ${p.begin[N]} of dimension ${N} out of bounds.`)}else p.begin[N]=ZS(p.begin[N],0,p.strides[N],S,T,A),p.end[N]=ZS(p.end[N],1,p.strides[N],S,T,A);const R=p.strides[N]===1&&p.begin[N]===0&&p.end[N]===S;g=g&&R,x=x&&(N===0&&p.strides[N]===1||R)}else g=g&&p.strides[N]===1&&E,x=x&&(N===0&&p.strides[N]===1||E);let M,P=!1;if(p.beginValid&&p.endValid?(M=p.end[N]-p.begin[N],P=!0):C?(M=1,P=!0):E&&S>=0&&(p.strides[N]<0?M=-S:M=S,P=!0),P){let R;M===0||M<0!=p.strides[N]<0?R=0:R=Math.trunc(M/p.strides[N])+(M%p.strides[N]!==0?1:0),b.push(R)}else b.push(-1)}for(let N=0;N<p.finalShapeGatherIndices.length;++N){const C=p.finalShapeGatherIndices[N];C>=0?k.push(b[C]):C===Iv&&k.push(1)}return{finalShapeSparse:k.filter((N,C)=>p.finalShapeGatherIndices[C]!==Iv),finalShape:k,isIdentity:g,sliceDim0:x,isSimpleSlice:y,begin:p.begin,end:p.end,strides:p.strides}}function B6(n,e){e.beginMask=0,e.endMask=0,e.shrinkAxisMask=0;let t=0;e.beginValid=n.begin!=null,e.endValid=n.end!=null,e.begin=new Array(e.dims),e.end=new Array(e.dims),e.strides=new Array(e.dims),e.finalShapeGatherIndices=[],e.finalShapeGatherIndicesSparse=[],e.inputShapeGatherIndicesSparse=new Array(e.dims);for(let s=0;s<n.dims;s++)if(1<<s&n.ellipsisMask){const r=Math.min(e.dims-(n.dims-s)+1+n.numAddAxisAfterEllipsis,e.dims);for(;t<r;t++)e.begin[t]=0,e.end[t]=0,e.strides[t]=1,e.beginMask|=1<<t,e.endMask|=1<<t,e.finalShapeGatherIndices.push(t),e.finalShapeGatherIndicesSparse.push(-1),e.inputShapeGatherIndicesSparse[t]=s}else if(1<<s&n.newAxisMask)e.finalShapeGatherIndices.push(Iv),e.finalShapeGatherIndicesSparse.push(-1);else{if(t===e.begin.length)throw Error(`Index out of range using input dim ${t}; input has only ${e.dims} dims, ${e.begin.length}.`);n.begin!=null&&(e.begin[t]=n.begin[s]),n.end!=null&&(e.end[t]=n.end[s]),e.strides[t]=n.strides[s],n.beginMask&1<<s&&(e.beginMask|=1<<t),n.endMask&1<<s&&(e.endMask|=1<<t),n.shrinkAxisMask&1<<s?(e.finalShapeGatherIndices.push(O6),e.finalShapeGatherIndicesSparse.push(-1),e.shrinkAxisMask|=1<<t):(e.finalShapeGatherIndices.push(t),e.finalShapeGatherIndicesSparse.push(s)),e.inputShapeGatherIndicesSparse[t]=s,t++}}function ZS(n,e,t,s,r,i){if(r[e])return t>0?i[e]:i[e+1&1];{const o=n<0?s+n:n;return o<i[0]?i[0]:o>i[1]?i[1]:o}}const W6=Object.freeze(Object.defineProperty({__proto__:null,assertParamsValid:q1,computeFlatOffset:X1,computeOutShape:K1,getNormalizedAxes:z6,isSliceContinous:Q1,maskToAxes:_6,parseSliceParams:Hg,sliceInfo:Y1,startForAxis:rA,startIndicesWithElidedDims:tA,stopForAxis:iA,stopIndicesWithElidedDims:nA,stridesForAxis:sA,stridesWithElidedDims:ZE},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class V6{static sgd(e){return new U1(e)}static momentum(e,t,s=!1){return new KE(e,t,s)}static rmsprop(e,t=.9,s=0,r=null,i=!1){return new QE(e,t,s,r,i)}static adam(e=.001,t=.9,s=.999,r=null){return new HE(e,t,s,r)}static adadelta(e=.001,t=.95,s=null){return new UE(e,t,s)}static adamax(e=.002,t=.9,s=.999,r=null,i=0){return new qE(e,t,s,r,i)}static adagrad(e,t=.1){return new GE(e,t)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Do=V6;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const U6=typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:n=>n();function oA(){return new Promise(n=>U6(()=>n()))}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z1(n,e){const t=n[0].length;n.forEach((r,i)=>{V(r.length===t,()=>`Error in concat${t}D: rank of tensors[${i}] must be the same as the rank of the rest (${t})`)}),V(e>=0&&e<t,()=>`Error in concat${t}D: axis must be between 0 and ${t-1}.`);const s=n[0];n.forEach((r,i)=>{for(let o=0;o<t;o++)V(o===e||r[o]===s[o],()=>`Error in concat${t}D: Shape of tensors[${i}] (${r}) does not match the shape of the rest (${s}) along the non-concatenated axis ${i}.`)})}function Ci(n,e){const t=n[0].slice();for(let s=1;s<n.length;s++)t[e]+=n[s][e];return t}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Kr;(function(n){n[n.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",n[n.VALUE_ROWIDS=1]="VALUE_ROWIDS",n[n.ROW_LENGTHS=2]="ROW_LENGTHS",n[n.ROW_SPLITS=3]="ROW_SPLITS",n[n.ROW_LIMITS=4]="ROW_LIMITS",n[n.ROW_STARTS=5]="ROW_STARTS"})(Kr||(Kr={}));function aA(n,e,t){let s=new Array;if(t==null&&e==null)return s;if(e==null)for(;s.length<n+t.length;)s.push(-1);else s=e.slice();if(t==null)return s;if(n+t.length!==s.length)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.rank = ${n+t.length}, but shape.rank = ${s.length}`);for(let r=1;r<t.length;++r){const i=t[r],o=s[s.length-t.length+r],a=s[o];if(i>=0)if(a>=0){if(a!==i)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.shape[${r+n}] = ${i} but shape[${r+n}] = ${a}`)}else s[o]=i}return s}function lA(n){const e={FIRST_DIM_SIZE:Kr.FIRST_DIM_SIZE,VALUE_ROWIDS:Kr.VALUE_ROWIDS,ROW_LENGTHS:Kr.ROW_LENGTHS,ROW_SPLITS:Kr.ROW_SPLITS,ROW_LIMITS:Kr.ROW_LIMITS,ROW_STARTS:Kr.ROW_STARTS},t=[];for(const s of n)if(s in e)t.push(e[s]);else break;return t}function cA(n){return n.length===0?0:n[0]===Kr.FIRST_DIM_SIZE?n.length-1:n.length}function uA(n,e){if(n==null||e==null)return;const t=n.length,s=e.length;if(t>=s)throw new Error(`defaultValue.shape=${n} and ragged tensor flatValues.shape=${e}, are incompatible: defaultValue.rank = ${t} must be less than ragged tensor input flatValues.rank = ${s})`);for(let r=0;r<Math.min(t,s-1);++r){const i=n[r],o=e[r+1];if(i>=0&&o>=0&&i!==1&&i!==o)throw new Error(`defaultValue.shape=${n}, and ragged tensor input flatValues.shape=${e} are incompatible: defaultValue.shape[${r-n.length}] = ${i} but ragged tensor input.flatValues.shape[${r-n.length}] = ${o}`)}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const J1=30;function qg(n){return n<=J1?n:uv(n,Math.floor(Math.sqrt(n)))}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ew(n,e,t){const s=t*(typeof n=="number"?n:n[0]),r=e*(typeof n=="number"?n:n[1]);return[s,r]}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vh(n,e,t,s=!0){let r=[];if(s)r=r.concat(e.slice(0)),r.push(n[0]/t),r=r.concat(n.slice(1));else{r=r.concat(n[0]);const i=e.length;for(let o=0;o<i;++o)r=r.concat([n[o+1]/e[o],e[o]]);r=r.concat(n.slice(i+1))}return r}function bh(n,e,t=!0){const s=[];if(t){s.push(e);for(let r=e+1;r<n;++r)r<=2*e?(s.push(r),s.push(r-(e+1))):s.push(r)}else{const r=[],i=[];for(let o=1;o<n;++o)o>=e*2+1||o%2===1?i.push(o):r.push(o);s.push(...r),s.push(0),s.push(...i)}return s}function wh(n,e,t,s=!0){const r=[];s?r.push(n[0]/t):r.push(n[0]*t);for(let i=1;i<n.length;++i)i<=e.length?s?r.push(e[i-1]*n[i]):r.push(n[i]/e[i-1]):r.push(n[i]);return r}function tw(n,e){const t=[0];for(let s=0;s<e;++s)t.push(n[s][0]);return t}function nw(n,e,t){const s=n.slice(0,1);for(let r=0;r<t;++r)s.push(n[r+1]-e[r][0]-e[r][1]);return s}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kg=1.7580993408473768,Qg=1.0507009873554805;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sw=.3275911,rw=.254829592,iw=-.284496736,ow=1.421413741,aw=-1.453152027,lw=1.061405429;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function so(n,e){if(n.length!==e.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${n.length}, imag: ${e.length}.`);const t=new Float32Array(n.length*2);for(let s=0;s<t.length;s+=2)t[s]=n[s/2],t[s+1]=e[s/2];return t}function dA(n){const e=new Float32Array(n.length/2),t=new Float32Array(n.length/2);for(let s=0;s<n.length;s+=2)e[s/2]=n[s],t[s/2]=n[s+1];return{real:e,imag:t}}function hA(n){const e=Math.ceil(n.length/4),t=new Float32Array(e),s=new Float32Array(e);for(let r=0;r<n.length;r+=4)t[Math.floor(r/4)]=n[r],s[Math.floor(r/4)]=n[r+1];return{real:t,imag:s}}function fA(n){const e=Math.floor(n.length/4),t=new Float32Array(e),s=new Float32Array(e);for(let r=2;r<n.length;r+=4)t[Math.floor(r/4)]=n[r],s[Math.floor(r/4)]=n[r+1];return{real:t,imag:s}}function cw(n,e){const t=n[e*2],s=n[e*2+1];return{real:t,imag:s}}function pA(n,e,t,s){n[s*2]=e,n[s*2+1]=t}function mA(n,e){const t=new Float32Array(n/2),s=new Float32Array(n/2);for(let r=0;r<Math.ceil(n/2);r++){const i=(e?2:-2)*Math.PI*(r/n);t[r]=Math.cos(i),s[r]=Math.sin(i)}return{real:t,imag:s}}function gA(n,e,t){const s=(t?2:-2)*Math.PI*(n/e),r=Math.cos(s),i=Math.sin(s);return{real:r,imag:i}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const y0="->",G6=/->/g,JS=",",eN="...";function uw(n,e){n=n.replace(/\s/g,"");const t=(n.length-n.replace(G6,"").length)/y0.length;if(t<1)throw new Error("Equations without an arrow are not supported.");if(t>1)throw new Error(`Equation must contain exactly one arrow ("${y0}").`);const[s,r]=n.split(y0);V(s.indexOf(eN)===-1,()=>`The ellipsis notation ("${eN}") is not supported yet.`);const i=s.split(JS),o=i.length;if(e!==o)throw new Error(`Expected ${o} input tensors, received ${e}`);if(o>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");const a=[];for(let p=0;p<r.length;++p){const g=r[p];if(!i.some(x=>x.indexOf(g)!==-1))throw new Error(`Output subscripts contain the label ${g} not present in the input subscripts.`);a.indexOf(g)===-1&&a.push(g)}for(let p=0;p<s.length;++p){const g=s[p];a.indexOf(g)===-1&&g!==JS&&a.push(g)}const l=new Array(i.length);for(let p=0;p<o;++p){if(new Set(i[p].split("")).size!==i[p].length)throw new Error(`Found duplicate axes in input component ${i[p]}. Support for duplicate axes in input is not implemented yet.`);l[p]=[];for(let g=0;g<i[p].length;++g)l[p].push(a.indexOf(i[p][g]))}const u=a.length,d=r.length,f=[];for(let p=d;p<u;++p)f.push(p);return{allDims:a,summedDims:f,idDims:l}}function dw(n,e){let t=new Array(n);t.fill(-1);for(let r=0;r<e.length;++r)t[e[r]]=r;const s=[];for(let r=0;r<n;++r)t[r]===-1&&s.push(r);return t=t.filter(r=>r!==-1),{permutationIndices:t,expandDims:s}}function hw(n,e,t){const s=new Array(n);for(let r=0;r<t.length;++r){const i=t[r].shape;for(let o=0;o<e[r].length;++o)s[e[r][o]]===void 0?s[e[r][o]]=i[o]:V(s[e[r][o]]===i[o],()=>`Expected dimension ${s[e[r][o]]} at axis ${o} of input shaped ${JSON.stringify(i)}, but got dimension ${i[o]}`)}}function fw(n,e){const t=n,s=[];let r=0;n.length===0&&t.push(-1),r=n.length+1;for(let o=0;o<r;++o)s.push([]);const i=[];for(let o=0;o<t.length;++o){const a=t[o],l=H6(e,a);for(const u of l)i.indexOf(u)===-1&&(s[o].push(u),i.push(u))}return{path:t,steps:s}}function pw(n){return n.every((e,t)=>e===t)}function H6(n,e){const t=[];for(let s=0;s<n.length;++s)(n[s].length===0||n[s].indexOf(e)!==-1||e===-1)&&t.push(s);return t}function mw(n,e,t=0){let s=[];if(typeof e=="number")V(n.shape[t]%e===0,()=>"Number of splits must evenly divide the axis."),s=new Array(e).fill(n.shape[t]/e);else{const r=e.reduce((o,a)=>(a===-1&&(o+=1),o),0);V(r<=1,()=>"There should be only one negative value in split array.");const i=e.indexOf(-1);if(i!==-1){const o=e.reduce((a,l)=>l>0?a+l:a);e[i]=n.shape[t]-o}V(n.shape[t]===e.reduce((o,a)=>o+a),()=>"The sum of sizes must match the size of the axis dimension."),s=e}return s}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xA(n){return`Received SparseTensor with denseShape[0] = 0 but
  indices.shape[0] = ${n}`}function yA(n,e){return`indices(${n}, 0) is invalid: ${e} < 0`}function vA(n,e,t){return`indices(${n}, 0) is invalid: ${e} >= ${t}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bA(n,e){return`only one output dimension may be -1, not both ${n} and ${e}`}function wA(n,e){return`size ${n} must be non-negative, not ${e}`}function kA(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function CA(n,e){const t=be(n),s=be(e);return`Input to reshape is a SparseTensor with ${t}
  dense values, but the requested shape requires a multiple of ${s}. inputShape=${n} outputShape= ${e}`}function SA(n,e){const t=be(n),s=be(e);return`Input to reshape is a tensor with ${t} dense values, but the requested shape has ${s}. inputShape=${n} outputShape=${e}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tv(){return"segment ids must be >= 0"}function NA(){return"segment ids are not increasing"}function IA(n,e){return`Segment id ${n} out of range [0, ${e}), possibly because segmentIds input is not sorted.`}function TA(n,e,t){return`Bad: indices[${n}] == ${e} out of range [0, ${t})`}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $A(n,e){let t=!1,s;for(n<=J1?(s=n,t=!0):s=uv(n,Math.floor(Math.sqrt(n)));!t;)s>e||s===n?t=!0:s=uv(n,s+1);return s}function EA(n,e,t){const s=[],r=n.length;for(let i=0;i<r;i++)i!==e?s.push(n[i]):s.push(t);return s}function gw(n,e,t,s){const r=e.shape.length,i=n.shape.length;if(s!==0&&(s<-r||s>r))throw new Error(`Expect batchDims in the range of [-${r}, ${r}], but got ${s}`);if(s<0&&(s+=r),s>i)throw new Error(`batchDims (${s}) must be less than rank(x) (
    ${i}).`);if(t<s)throw new Error(`batchDims (${s}) must be less than or equal to axis (${t}).`);for(let f=0;f<s;++f)if(n.shape[f]!==e.shape[f])throw new Error(`x.shape[${f}]: ${n.shape[f]} should be equal to indices.shape[${f}]: ${e.shape[f]}.`);const o=n.shape[t],a=[];let l=1,u=1,d=1;for(let f=0;f<s;++f)a.push(n.shape[f]),l*=n.shape[f];for(let f=s;f<t;f++)a.push(n.shape[f]),u*=n.shape[f];for(let f=s;f<r;f++)a.push(e.shape[f]);for(let f=t+1;f<i;f++)a.push(n.shape[f]),d*=n.shape[f];return{batchSize:l,sliceSize:d,outerSize:u,dimSize:o,outputShape:a}}const q6=Object.freeze(Object.defineProperty({__proto__:null,collectGatherOpShapeInfo:gw,computeOutShape:EA,segOpComputeOptimalWindowSize:$A},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ro(n){try{return n.map(e=>Uo(e))}catch(e){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${e}`)}}function AA(n){return n.map(e=>zo(e))}const K6=Object.freeze(Object.defineProperty({__proto__:null,ERF_A1:rw,ERF_A2:iw,ERF_A3:ow,ERF_A4:aw,ERF_A5:lw,ERF_P:sw,PARALLELIZE_THRESHOLD:J1,get RowPartitionType(){return Kr},SELU_SCALE:Qg,SELU_SCALEALPHA:Kg,applyActivation:O1,assertAndGetBroadcastShape:ot,assertAxesAreInnerMostDims:Xn,assertParamsConsistent:Z1,assignToTypedArray:pA,axesAreInnerMostDims:w1,calculateShapes:rl,checkEinsumDimSizes:hw,checkPadOnDimRoundingMode:Ls,combineLocations:bE,combineRaggedTensorToTensorShapes:aA,complexWithEvenIndex:hA,complexWithOddIndex:fA,computeConv2DInfo:Qn,computeConv3DInfo:Jo,computeDefaultPad:m1,computeDilation2DInfo:ph,computeOptimalWindowSize:qg,computeOutAndReduceShapes:zn,computeOutShape:Ci,computePool2DInfo:Ar,computePool3DInfo:lo,convertConv2DDataFormat:co,decodeEinsumEquation:uw,eitherStridesOrDilationsAreOne:rs,expandShapeToKeepDim:kn,exponent:gA,exponents:mA,fromStringArrayToUint8:AA,fromUint8ToStringArray:ro,getAxesPermutation:tn,getBroadcastDims:cc,getComplexWithIndex:cw,getEinsumComputePath:fw,getEinsumPermutation:dw,getFusedBiasGradient:F1,getFusedDyActivation:L1,getImageCenter:ew,getInnerMostAxes:mn,getPermuted:bh,getRaggedRank:cA,getReductionAxes:En,getReshaped:vh,getReshapedPermuted:wh,getRowPartitionTypesHelper:lA,getSliceBeginCoords:tw,getSliceSize:nw,getSparseFillEmptyRowsIndicesDenseShapeMismatch:xA,getSparseFillEmptyRowsNegativeIndexErrorMessage:yA,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:vA,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:kA,getSparseReshapeInputOutputMismatchErrorMessage:SA,getSparseReshapeInputOutputMultipleErrorMessage:CA,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:bA,getSparseReshapeNegativeOutputDimErrorMessage:wA,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:TA,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:Tv,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:NA,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:IA,getUndoAxesPermutation:ea,isIdentityPermutation:pw,log:c_,mergeRealAndImagArrays:so,prepareAndValidate:H1,prepareSplitSize:mw,segment_util:q6,shouldFuse:_1,slice_util:W6,splitRealAndImagArrays:dA,stridesOrDilationsArePositive:Ga,tupleValuesAreOne:Ua,upcastType:Ks,validateDefaultValueShape:uA,validateInput:vV,validateUpdateShape:OE,warn:rr},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j6();/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jA={kernelName:Fm,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ne(n,yh(Fe(t,"float32"),-1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Q6={kernelName:vd,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const s=Bt(Fe(t,"float32")),r=ss(tt($t(1),s));return fn(Ze(n,r))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const X6={kernelName:bd,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const s=ss(tt(Bt(Fe(t,"float32")),1));return Ze(n,s)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Y6={kernelName:Tc,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=ot(t.shape,s.shape);return{a:()=>{let a=n;const l=En(t.shape,r);return l.length>0&&(a=Ye(a,l)),ie(a,t.shape)},b:()=>{let a=n;const l=En(s.shape,r);return l.length>0&&(a=Ye(a,l)),ie(a,s.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Z6={kernelName:Nb,saveAllInputs:!0,gradFunc:(n,e)=>{const t={};return e.forEach((s,r)=>{t[r]=()=>n.clone()}),t}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const J6={kernelName:Om,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>wt(t)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eU={kernelName:_m,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>wt(t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tU={kernelName:wd,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Ze(n,ss(tt($t(1),Bt(Fe(t,"float32")))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nU={kernelName:kd,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const s=ss($e($t(1),Bt(Fe(t,"float32"))));return Ze(n,s)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sU={kernelName:Nd,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=ot(t.shape,s.shape);return{a:()=>{const a=$e(Bt(t),Bt(s));let l=ne(n,Ze(s,a));const u=En(t.shape,r);return u.length>0&&(l=Ye(l,u)),ie(l,t.shape)},b:()=>{const a=$e(Bt(t),Bt(s));let l=fn(ne(n,Ze(t,a)));const u=En(s.shape,r);return u.length>0&&(l=Ye(l,u)),ie(l,s.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rU={kernelName:Cd,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Ze(n,$e(Bt(Fe(t,"float32")),1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iU={kernelName:Sd,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Ze(n,tt($t(1),Bt(Fe(t,"float32"))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oU(n,e,t,s,r,i){const o=Z(n,"dy","avgPool3dGrad"),a=Z(e,"input","avgPool3dGrad");let l=o,u=a,d=!1;a.rank===4&&(d=!0,l=ie(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]]),u=ie(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]])),V(l.rank===5,()=>`Error in avgPool3dGrad: dy must be rank 5 but got rank ${l.rank}.`),V(u.rank===5,()=>`Error in avgPool3dGrad: input must be rank 5 but got rank ${u.rank}.`),Ls("avgPool3dGrad",r,i);const f={dy:l,input:u},p={filterSize:t,strides:s,pad:r,dimRoundingMode:i},g=re.runKernel(Eb,f,p);return d?ie(g,[g.shape[1],g.shape[2],g.shape[3],g.shape[4]]):g}const aU=oe({avgPool3dGrad_:oU});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lU={kernelName:Bm,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{filterSize:r,strides:i,pad:o,dimRoundingMode:a}=t;return{x:()=>aU(n,s,r,i,o,a)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cU(n,e,t,s,r){const i=Z(n,"dy","avgPoolGrad"),o=Z(e,"input","avgPoolGrad");V(o.rank===i.rank,()=>`Rank of input (${o.rank}) does not match rank of dy (${i.rank})`);let a=o,l=i,u=!1;o.rank===3&&(u=!0,a=ie(o,[1,o.shape[0],o.shape[1],o.shape[2]]),l=ie(i,[1,i.shape[0],i.shape[1],i.shape[2]])),V(l.rank===4,()=>`Error in avgPoolGrad: dy must be rank 4 but got rank ${l.rank}.`),V(a.rank===4,()=>`Error in avgPoolGrad: input must be rank 4 but got rank ${a.rank}.`);const d={dy:l,input:a},f={filterSize:t,strides:s,pad:r},p=re.runKernel($b,d,f);return u?ie(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const uU=oe({avgPoolGrad_:cU});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dU={kernelName:zm,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{filterSize:r,strides:i,pad:o}=t;return{x:()=>uU(n,s,r,i,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hU={kernelName:Wm,inputsToSave:["a","b"],gradFunc:(n,e,t)=>{const[s,r]=e,{transposeA:i,transposeB:o}=t;return!i&&!o?{a:()=>Tt(n,r,!1,!0),b:()=>Tt(s,n,!0,!1)}:!i&&o?{a:()=>Tt(n,r,!1,!1),b:()=>Tt(n,s,!0,!1)}:i&&!o?{a:()=>Tt(r,n,!1,!0),b:()=>Tt(s,n,!1,!1)}:{a:()=>Tt(r,n,!0,!0),b:()=>Tt(n,s,!0,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fU={kernelName:Vm,gradFunc:(n,e,t)=>{const{blockShape:s,crops:r}=t;return{x:()=>E1(n,s,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pU={kernelName:i_,gradFunc:(n,e,t)=>{const s=t,r=s.inputShape,i=s.shape,o=Array.from(i);for(let l=r.length-1;l>=0;l--)if(r[l]===i[l])o[l]=1;else if(r[l]!==1)throw new Error(`broadcastTo(): [${r}] cannot be broadcast to [${i}].`);const a=[];for(let l=0;l<o.length;l++)o[l]>1&&a.push(l);return{x:()=>Ye(n,a,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mU={kernelName:Id,gradFunc:n=>({x:()=>n.clone()})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gU={kernelName:Td,gradFunc:n=>({x:()=>wt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xU={kernelName:$d,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{clipValueMin:r,clipValueMax:i}=t;return{x:()=>bs(to(nl(s,r),Ec(s,i)),n,wt(n))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yU={kernelName:Um,inputsToSave:["x"],gradFunc:jA.gradFunc};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vU={kernelName:Gm,saveAllInputs:!0,gradFunc:(n,e,t)=>{const s=e.map(l=>l.shape),{axis:r}=t,i=ht(r,e[0].shape)[0],o=s.map(l=>l[i]);return or(n,o,i).map(l=>()=>l)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bU={kernelName:Hm,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const[s,r]=e,{dilations:i,strides:o,pad:a,dataFormat:l}=t;return V(Ua(i),()=>`Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${i}'`),{x:()=>y1(s.shape,n,r,o,a,l),filter:()=>M1(s,n,r.shape,o,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wU={kernelName:qm,inputsToSave:["dy","filter"],gradFunc:(n,e,t)=>{const[s,r]=e,{strides:i,pad:o,dataFormat:a,dimRoundingMode:l}=t;return{dy:()=>Ha(n,r,i,o,a,1,l),filter:()=>M1(n,s,r.shape,i,o,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kU(n,e,t,s,r){let i=n;n.rank===4&&(i=ie(n,[1,n.shape[0],n.shape[1],n.shape[2],n.shape[3]]));let o=e;o.rank===4&&(o=ie(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]])),V(i.rank===5,()=>`Error in conv3dDerFilter: input must be rank 5, but got shape ${i.shape}.`),V(o.rank===5,()=>`Error in conv3dDerFilter: dy must be rank 5, but got shape ${o.shape}.`),V(t.length===5,()=>`Error in conv3dDerFilter: filterShape must be length 5, but got ${t}.`),V(i.shape[4]===t[3],()=>`Error in conv3dDerFilter: depth of input ${i.shape[4]}) must match input depth in filter (${t[3]}.`),V(o.shape[4]===t[4],()=>`Error in conv3dDerFilter: depth of dy (${o.shape[4]}) must match output depth for filter (${t[4]}).`);const a={x:i,dy:o},l={strides:s,pad:r,filterShape:t};return re.runKernel(Pb,a,l)}const CU=oe({conv3DBackpropFilter_:kU});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SU={kernelName:Km,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const{dilations:s,strides:r,pad:i}=t;V(Ua(s),()=>`Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${s}'`);const[o,a]=e;return{x:()=>gE(o.shape,n,a,r,i),filter:()=>CU(o,n,a.shape,r,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NU={kernelName:Ed,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ne(fn(PE(Fe(t,"float32"))),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IU={kernelName:Ad,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ne(ME(Fe(t,"float32")),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TU={kernelName:Qm,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{axis:r,exclusive:i,reverse:o}=t;return{x:()=>{const a=tn([r],s.rank);let l=yE(n,r,i,!o);return a!=null&&(l=bt(l,a)),l}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $U={kernelName:Xm,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const{dilations:s,strides:r,pad:i,dimRoundingMode:o}=t,a=s??[1,1];V(Ua(a),()=>`Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '${a}'`);const[l,u]=e;return V(l.rank===4,()=>`Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ${l.rank}.`),V(u.rank===4,()=>`Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ${u.rank}.`),V(l.shape[3]===u.shape[2],()=>`Error in gradient of depthwiseConv2d: number of input channels (${l.shape[3]}) must match the inChannels dimension in filter ${u.shape[2]}.`),V(rs(r,a),()=>`Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ${r} and dilations '${a}'.`),Ls("depthwiseConv2d",i,o),{x:()=>OV(l.shape,n,u,r,i,a,o),filter:()=>LV(l,n,u.shape,r,i,a,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EU={kernelName:Ym,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const[s,r]=e,i={x:s,filter:r,dy:n},o={x:s,filter:r,dy:n};return{x:()=>re.runKernel(dv,i,t),filter:()=>re.runKernel(hv,o,t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AU={kernelName:Rd,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e,s={dy:n,y:t};return{x:()=>re.runKernel(Vb,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jU={kernelName:Dd,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e,s=ne($i(fn(Bt(t))),2/Math.sqrt(Math.PI));return{x:()=>ne(n,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RU={kernelName:Pd,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ne(n,t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DU={kernelName:Jm,inputsToSave:["input"],gradFunc:(n,e)=>{const[t]=e;return{input:()=>ie(n,t.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PU={kernelName:Md,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ne(n,$i(t))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MU={kernelName:Ld,gradFunc:n=>({x:()=>wt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LU={kernelName:Fd,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=ot(t.shape,s.shape);return{a:()=>{const a=Ze(n,Fe(s,"float32")),l=En(t.shape,r);return l.length>0?ie(Ye(a,l),t.shape):a},b:()=>{let a=ne(n,Fe(t,"float32"));const l=En(s.shape,r);l.length>0&&(a=ie(Ye(a,l),s.shape));const u=Bt(s);return fn(Ze(a,Fe(u,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FU={kernelName:eg,inputsToSave:["x","mean","variance","scale"],gradFunc:(n,e,t)=>{const{varianceEpsilon:s}=t,[r,i,o,a]=e,l=a??$t(1),u=En(i.shape,r.shape),d=[];if(i.rank===1){for(let C=0;C<r.shape.length-1;++C)d.push(r.shape[C]);d.push(1)}const f=tt(r,i),p=ne(n,l),g=jE($e(o,$t(s))),x=ne(ne(ne(g,g),g),$t(-.5));return{x:()=>i.rank===1?ie(ne(ne(n,Qr(ie(g,[1,1,1,i.shape[0]]),d)),l),r.shape):ie(ne(ne(n,g),l),r.shape),mean:()=>{let C=ne(ne(g,$t(-1)),p);return i.rank===1&&(C=Ye(C,u)),ie(C,i.shape)},variance:()=>{let C=ne(ne(x,f),p);return i.rank===1&&(C=Ye(C,u)),ie(C,i.shape)},scale:()=>{const C=ne(f,g);let S=ne(n,C);return i.rank===1&&(S=Ye(S,u)),ie(S,i.shape)},offset:()=>{let C=n;return i.rank===1&&(C=Ye(C,u)),ie(C,i.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OU={kernelName:tg,inputsToSave:["x","indices"],gradFunc:(n,e,t)=>{const[s,r]=e,{axis:i,batchDims:o}=t,a=ht(i,s.shape)[0],l=(u,d,f)=>()=>{const p=u.shape,g=d.size,x=p.slice(0,a),y=x.length,b=p.slice(i,p.length).slice(1),k=b.length,w=tN(0,y),N=tN(y+1,y+1+k),C=nN([x,[g],b]),S=ie(f,C),T=ie(d,[g]),A=nN([[y],w,N]),E=bt(S,A);let M=zE(E,T,u.shape[a]);const P=ea(A);return M=bt(M,P),M};if(o===1){const u=s.shape[0],d=s.split(u,0);return{x:()=>no(d.map((g,x)=>l(g,r.slice(x,1),n.slice(x,1))())).reshape(s.shape),indices:()=>r}}else return{x:l(s,r,n),indices:()=>r}}};function tN(n,e){const t=[];for(let s=n;s<e;++s)t.push(s);return t}function nN(n){const e=[];for(let t=0;t<n.length;++t)for(let s=0;s<n[t].length;++s)e.push(n[t][s]);return e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _U={kernelName:Od,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e;return{a:()=>wt(t),b:()=>wt(s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zU={kernelName:_d,gradFunc:n=>({x:()=>Fe(n,"float32")})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BU={kernelName:zd,gradFunc:n=>({x:()=>wt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WU={kernelName:Bd,gradFunc:n=>({x:()=>wt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VU={kernelName:Wd,gradFunc:n=>({x:()=>wt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UU={kernelName:sg,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{alpha:r}=t,i=lr(s,0);return{x:()=>bs(i,n,ne(n,r))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GU={kernelName:Ud,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Ze(n,$e(t,1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HU={kernelName:Vd,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Ze(n,Fe(t,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qU={kernelName:a_,inputsToSave:[],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[s]=e,{axis:r}=t;return{logits:()=>{const o=$i(s);return tt(n,ne(Ye(n,r,!0),o))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KU(n,e,t,s=5,r=1,i=1,o=.5){const a={x:n,y:e,dy:t},l={depthRadius:s,bias:r,alpha:i,beta:o};return re.runKernel(Qb,a,l)}const QU=oe({localResponseNormalizationBackprop_:KU});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XU={kernelName:cg,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[s,r]=e,{depthRadius:i,bias:o,alpha:a,beta:l}=t;return{x:()=>QU(s,r,n,i,o,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RA(n,e,t,s){return e.rank<t.rank&&(e=ie(e,kn(e.shape,s))),n.rank<t.rank&&(n=ie(n,kn(n.shape,s))),{x:()=>ne(n,Fe(Ti(t,e),n.dtype))}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sN={kernelName:ug,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const s=t,{reductionIndices:r}=s,i=e[0],o=e[1],a=ht(r,i.shape),l=RA(n,o,i,a);return{x:()=>l.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YU={kernelName:Gd,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e;return{a:()=>ne(n,Fe(nl(t,s),"float32")),b:()=>ne(n,Fe(Yp(t,s),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZU(n,e,t,s,r,i,o){const a=Z(n,"dy","maxPool3dGrad"),l=Z(e,"input","maxPool3dGrad"),u=Z(t,"output","maxPool3dGrad");let d=a,f=l,p=u,g=!1;l.rank===4&&(g=!0,d=ie(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]]),f=ie(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]]),p=ie(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]])),V(d.rank===5,()=>`Error in maxPool3dGrad: dy must be rank 5 but got rank ${d.rank}.`),V(f.rank===5,()=>`Error in maxPool3dGrad: input must be rank 5 but got rank ${f.rank}.`),V(p.rank===5,()=>`Error in maxPool3dGrad: output must be rank 5 but got rank ${p.rank}.`),Ls("maxPool3dGrad",i,o);const x={dy:d,input:f,output:p},y={filterSize:s,strides:r,pad:i,dimRoundingMode:o},b=re.runKernel(Yb,x,y);return g?ie(b,[b.shape[1],b.shape[2],b.shape[3],b.shape[4]]):b}const JU=oe({maxPool3dGrad_:ZU});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eG={kernelName:hg,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[s,r]=e,{filterSize:i,strides:o,pad:a,dimRoundingMode:l}=t;return{x:()=>JU(n,s,r,i,o,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tG(n,e,t,s,r,i,o){const a=Z(n,"dy","maxPoolGrad"),l=Z(e,"input","maxPoolGrad"),u=Z(t,"output","maxPoolGrad");V(l.rank===a.rank,()=>`Rank of input (${l.rank}) does not match rank of dy (${a.rank})`),V(a.rank===4,()=>`Error in maxPoolGrad: dy must be rank 4 but got rank ${a.rank}.`),V(l.rank===4,()=>`Error in maxPoolGrad: input must be rank 4 but got rank ${l.rank}.`),Ls("maxPoolGrad",i,o);const d={dy:a,input:l,output:u},f={filterSize:s,strides:r,pad:i,dimRoundingMode:o};return re.runKernel(Xb,d,f)}const nG=oe({maxPoolGrad_:tG});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sG={kernelName:dg,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[s,r]=e,{filterSize:i,strides:o,pad:a}=t;return{x:()=>nG(n,s,r,i,o,a)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rG={kernelName:fg,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{axis:r}=t,i=ht(r,s.shape),a=zn(s.shape,i)[1],l=be(a);return{x:()=>{const d=s.shape.slice();i.forEach(g=>{d[g]=1});const f=ie(n,d);return Ze(ne(f,na(s.shape,"float32")),l)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iG={kernelName:pg,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const s=t,{axis:r}=s,[i,o]=e,a=ht(r,i.shape),l=RA(n,o,i,a);return{x:()=>l.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oG={kernelName:Hd,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e;return{a:()=>ne(n,Fe(Ec(t,s),"float32")),b:()=>ne(n,Fe(lr(t,s),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aG={kernelName:mg,inputsToSave:["x"],gradFunc:(n,e,t)=>{const s=e[0],{paddings:r}=t,i=r.map(o=>o[0]);return{x:()=>Ot(n,i,s.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lG={kernelName:qd,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=ot(t.shape,s.shape);return{a:()=>{const a=En(t.shape,r);return a.length>0?ie(Ye(n,a),t.shape):n},b:()=>{const a=ne(n,fn(Gg(Ze(t,s)))),l=En(s.shape,r);return l.length>0?ie(Ye(a,l),s.shape):a}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cG={kernelName:Kd,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=ot(t.shape,s.shape);return{a:()=>{const a=ne(n,Fe(s,"float32")),l=En(t.shape,r);return l.length>0?ie(Ye(a,l),t.shape):a},b:()=>{const a=ne(n,Fe(t,"float32")),l=En(s.shape,r);return l.length>0?ie(Ye(a,l),s.shape):a}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uG={kernelName:gg,gradFunc:n=>({x:()=>fn(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dG={kernelName:vg,inputsToSave:["indices"],gradFunc:(n,e)=>{const t=e[0];return{indices:()=>On(t.shape,"float32")}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hG={kernelName:yg,gradFunc:n=>({x:()=>wt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fG={kernelName:bg,saveAllInputs:!0,gradFunc:(n,e,t)=>{const{axis:s}=t;return Qa(n,s).map(i=>()=>i)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rN={kernelName:wg,inputsToSave:["x"],gradFunc:(n,e,t)=>{const s=e[0],{paddings:r}=t,i=r.map(o=>o[0]);return{x:()=>Ot(n,i,s.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pG={kernelName:Qd,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(n,e)=>{const[t,s,r]=e,i=t,o=s,a=ot(i.shape,o.shape);return{a:()=>{const d=Fe(o,"float32");let f=ne(n,ne(d,qa(i,tt(d,$t(1)))));const p=En(i.shape,a);return p.length>0&&(f=Ye(f,p)),ie(f,i.shape)},b:()=>{const d=lr(i,0),f=bs(d,Ei(i),wt(i));let p=ne(n,ne(r,f));const g=En(o.shape,a);return g.length>0&&(p=Ye(p,g)),ie(p,o.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mG={kernelName:kg,inputsToSave:["x","alpha"],gradFunc:(n,e)=>{const[t,s]=e,r=lr(t,0);return{x:()=>bs(r,n,ne(n,s)),alpha:()=>{let i=bs(r,wt(n),ne(n,t));const o=En(s.shape,n.shape);return o.length>0&&(i=Ye(i,o)),ie(i,s.shape)}}}};/**
 * @license
 * Copyright 2022 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gG(n,e,t){const s=n.shape.slice();s[t]=1;const r=ie(e,s),i=Sv(n,t,!0,!1),o=Sv(n,t,!0,!0),a=ne(i,o);return ne(r,a)}function xG(n,e,t){const s=n.shape.length,r=s-t.length,i=tn(t,s);let o=n;i!=null&&(o=bt(n,i));const a=o.shape.slice(),u=a.splice(s-t.length,t.length).reduce((p,g)=>p*g,1);a.push(u);const d=o.reshape(a);let f=gG(d,e,r);if(f=f.reshape(o.shape),i!=null){const p=ea(i);f=bt(f,p)}return f}const yG={kernelName:Cg,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{axis:r}=t;let i=[];return r==null?i=s.shape.map((o,a)=>a):typeof r=="number"?i=[r]:i=r,{x:()=>xG(s,n,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vG={kernelName:jd,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=ot(t.shape,s.shape);return{a:()=>{const a=Ze(n,Fe(s,"float32")),l=En(t.shape,r);return l.length>0?ie(Ye(a,l),t.shape):a},b:()=>{let a=ne(n,Fe(t,"float32"));const l=En(s.shape,r);l.length>0&&(a=ie(Ye(a,l),s.shape));const u=Bt(s);return fn(Ze(a,Fe(u,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bG={kernelName:Xd,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Ze(n,fn(Bt(t)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wG={kernelName:Zd,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e,s=ne(Ec(t,6),yh(t));return{x:()=>ne(n,Fe(s,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kG={kernelName:Yd,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ne(n,Fe(yh(t),"float32"))}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CG={kernelName:Sg,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ie(n,t.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SG={kernelName:Ig,inputsToSave:["images"],gradFunc:(n,e,t)=>{const[s]=e,r={dy:n,images:s};return{images:()=>re.runKernel(r1,r,t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NG={kernelName:Ng,inputsToSave:["images"],gradFunc:(n,e,t)=>{const[s]=e,r={dy:n,images:s};return{images:()=>re.runKernel(s1,r,t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IG={kernelName:Tg,gradFunc:(n,e,t)=>{const{dims:s}=t,r=ht(s,n.shape);return{x:()=>Ka(n,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TG={kernelName:Jd,gradFunc:n=>({x:()=>wt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $G={kernelName:eh,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>fn(Ze(n,ne(qa(t,1.5),2)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EG={kernelName:$g,inputsToSave:["condition"],gradFunc:(n,e)=>{const[t]=e;return{condition:()=>Fe(wt(t),"float32"),t:()=>ne(n,Fe(t,n.dtype)),e:()=>ne(n,Fe(N1(t),n.dtype))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AG={kernelName:th,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const s=lr(t,$t(0)),r=$t(Kg),i=$t(Qg),o=ne(n,i),a=ne(ne(n,r),$i(Fe(t,"float32")));return bs(s,o,a)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jG={kernelName:ih,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ne(n,ne(t,tt($t(1),t)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RG={kernelName:rh,gradFunc:n=>({x:()=>wt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DG={kernelName:nh,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ne(v1(Fe(t,"float32")),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PG={kernelName:sh,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ne(xE(Fe(t,"float32")),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MG={kernelName:Eg,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{begin:r,size:i}=t,o=s.shape,[a,l]=Hg(s,r,i),u=[];for(let d=0;d<n.rank;d++)u.push([a[d],o[d]-a[d]-l[d]]);return{x:()=>$1(n,u)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LG={kernelName:Dg,outputsToSave:[!0],gradFunc:(n,e,t)=>{const[s]=e,{dim:r}=t,i=!0,o=ne(n,s);return{logits:()=>tt(o,ne(Ye(o,[r],i),s))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FG={kernelName:oh,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ne(n,$c(t))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iN={kernelName:jg,gradFunc:(n,e,t)=>{const{blockShape:s,paddings:r}=t;return{x:()=>x1(n,s,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oN={kernelName:Rg,gradFunc:(n,e,t)=>{const{axis:s}=t;return{x:()=>Rs(n,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OG={kernelName:ah,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Ze(n,ne(ss(Fe(t,"float32")),2))}}};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _G={kernelName:i1,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ne(n,ne(Fe(t,"float32"),2))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zG={kernelName:lh,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=$t(2);return{a:()=>ne(n,ne(r,tt(t,s))),b:()=>ne(n,ne(r,tt(s,t)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BG={kernelName:fh,gradFunc:n=>({x:()=>wt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WG={kernelName:ch,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=ot(t.shape,s.shape);return{a:()=>{let a=n;const l=En(t.shape,r);return l.length>0&&(a=Ye(a,l)),ie(a,t.shape)},b:()=>{let a=n;const l=En(s.shape,r);return l.length>0&&(a=Ye(a,l)),ie(fn(a),s.shape)}}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VG={kernelName:Ag,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,r=s.shape.slice(),{axis:i}=t;ht(i,s.shape).forEach(u=>{r[u]=1});const a=ie(n,r),l=ne(a,na(s.shape,"float32"));return{x:()=>l}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UG={kernelName:uh,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Ze(n,Bt(v1(t)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GG={kernelName:dh,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ne(tt($t(1),Bt(t)),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HG={kernelName:hh,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{reps:r}=t;return{x:()=>{let o=wt(s);if(s.rank===1)for(let a=0;a<r[0];++a)o=$e(o,Ot(n,[a*s.shape[0]],[s.shape[0]]));else if(s.rank===2)for(let a=0;a<r[0];++a)for(let l=0;l<r[1];++l)o=$e(o,Ot(n,[a*s.shape[0],l*s.shape[1]],[s.shape[0],s.shape[1]]));else if(s.rank===3)for(let a=0;a<r[0];++a)for(let l=0;l<r[1];++l)for(let u=0;u<r[2];++u)o=$e(o,Ot(n,[a*s.shape[0],l*s.shape[1],u*s.shape[2]],[s.shape[0],s.shape[1],s.shape[2]]));else if(s.rank===4)for(let a=0;a<r[0];++a)for(let l=0;l<r[1];++l)for(let u=0;u<r[2];++u)for(let d=0;d<r[3];++d)o=$e(o,Ot(n,[a*s.shape[0],l*s.shape[1],u*s.shape[2],d*s.shape[3]],[s.shape[0],s.shape[1],s.shape[2],s.shape[3]]));else throw new Error(`Gradient for tile operation is not implemented for rank-${s.rank} tensors yet.`);return o}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qG={kernelName:Ql,gradFunc:(n,e,t)=>{const s=t,{perm:r}=s,i=ea(r);return{x:()=>bt(n,i)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KG={kernelName:Pg,gradFunc:(n,e,t)=>{const s=t,{axis:r}=s;return{value:()=>no(n,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QG={kernelName:Mg,inputsToSave:["segmentIds"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>XG(n,t)}}};function XG(n,e){const t=ta(e,wt(e)),s=k1(n,t);let r=nl(e,$t(0,"int32"));const i=s.rank-r.rank;for(let a=0;a<i;++a)r=Es(r,a+1);r=to(r,na(s.shape,"bool"));const o=wt(s);return bs(r,s,o)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YG={kernelName:Lg,gradFunc:n=>({x:()=>wt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZG=[jA,Q6,X6,Y6,Z6,J6,eU,tU,nU,sU,rU,iU,lU,dU,hU,fU,pU,mU,gU,xU,yU,vU,wU,bU,SU,NU,IU,TU,$U,EU,vG,AU,jU,RU,DU,PU,LU,MU,FU,OU,_U,zU,BU,WU,VU,UU,GU,HU,qU,XU,sN,sN,YU,eG,sG,rG,iG,oG,aG,lG,cG,uG,dG,hG,fG,rN,rN,pG,mG,yG,bG,wG,kG,CG,SG,NG,IG,TG,$G,EG,AG,jG,RG,DG,PG,MG,LG,FG,iN,iN,oN,oN,OG,zG,_G,BG,WG,VG,UG,GG,HG,qG,KG,QG,YG];for(const n of ZG)u_(n);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.abs=function(){return this.throwIfDisposed(),xs(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.acos=function(){return this.throwIfDisposed(),Iz(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.acosh=function(){return this.throwIfDisposed(),$z(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.add=function(n){return this.throwIfDisposed(),$e(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.all=function(n,e){return this.throwIfDisposed(),fE(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.any=function(n,e){return this.throwIfDisposed(),kv(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.argMax=function(n){return this.throwIfDisposed(),Yu(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.argMin=function(n){return this.throwIfDisposed(),Dz(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.asScalar=function(){return this.throwIfDisposed(),V(this.size===1,()=>"The array must have only 1 element."),ie(this,[])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.asType=function(n){return this.throwIfDisposed(),Fe(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.as1D=function(){return this.throwIfDisposed(),ie(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.as2D=function(n,e){return this.throwIfDisposed(),ie(this,[n,e])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.as3D=function(n,e,t){return this.throwIfDisposed(),ie(this,[n,e,t])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.as4D=function(n,e,t,s){return this.throwIfDisposed(),ie(this,[n,e,t,s])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.as5D=function(n,e,t,s,r){return this.throwIfDisposed(),ie(this,[n,e,t,s,r])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.asin=function(){return this.throwIfDisposed(),Mz(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.asinh=function(){return this.throwIfDisposed(),Fz(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.atan=function(){return this.throwIfDisposed(),_z(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.atan2=function(n){return this.throwIfDisposed(),Bz(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.atanh=function(){return this.throwIfDisposed(),Vz(this)};ve().prototype.avgPool=function(n,e,t,s){return this.throwIfDisposed(),g1(this,n,e,t,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.batchToSpaceND=function(n,e){return this.throwIfDisposed(),x1(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.batchNorm=function(n,e,t,s,r){return this.throwIfDisposed(),Bg(this,n,e,t,s,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.broadcastTo=function(n){return this.throwIfDisposed(),Gu(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.cast=function(n){return this.throwIfDisposed(),Fe(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.ceil=function(){return this.throwIfDisposed(),g5(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.clipByValue=function(n,e){return this.throwIfDisposed(),ar(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.concat=function(n,e){return this.throwIfDisposed(),n instanceof Sn&&(n=[n]),Rs([this,...n],e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.conv1d=function(n,e,t,s,r,i){return this.throwIfDisposed(),pE(this,n,e,t,s,r,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.conv2dTranspose=function(n,e,t,s,r){return this.throwIfDisposed(),mE(this,n,e,t,s,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.conv2d=function(n,e,t,s,r,i){return this.throwIfDisposed(),Ha(this,n,e,t,s,r,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.cos=function(){return this.throwIfDisposed(),v1(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.cosh=function(){return this.throwIfDisposed(),xE(this)};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.cumprod=function(n,e,t){return this.throwIfDisposed(),Sv(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.cumsum=function(n,e,t){return this.throwIfDisposed(),yE(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.depthToSpace=function(n,e){return this.throwIfDisposed(),B5(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.depthwiseConv2d=function(n,e,t,s,r,i){return this.throwIfDisposed(),b1(this,n,e,t,s,r,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.dilation2d=function(n,e,t,s,r){return this.throwIfDisposed(),U5(this,n,e,t,s,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.divNoNan=function(n){return this.throwIfDisposed(),Q5(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.div=function(n){return this.throwIfDisposed(),Ze(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.dot=function(n){return this.throwIfDisposed(),Y5(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.elu=function(){return this.throwIfDisposed(),Vg(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.equal=function(n){return this.throwIfDisposed(),Ti(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.erf=function(){return this.throwIfDisposed(),vE(this)};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.euclideanNorm=function(n,e){return this.throwIfDisposed(),cB(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.exp=function(){return this.throwIfDisposed(),$i(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.expandDims=function(n){return this.throwIfDisposed(),Es(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.expm1=function(){return this.throwIfDisposed(),fB(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.fft=function(){return this.throwIfDisposed(),FE(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.flatten=function(){return this.throwIfDisposed(),ie(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.floor=function(){return this.throwIfDisposed(),Gg(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.floorDiv=function(n){return this.throwIfDisposed(),hE(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.gather=function(n,e,t){return this.throwIfDisposed(),k1(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.greaterEqual=function(n){return this.throwIfDisposed(),nl(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.greater=function(n){return this.throwIfDisposed(),lr(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.ifft=function(){return this.throwIfDisposed(),Nv(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.irfft=function(){return this.throwIfDisposed(),oV(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.isFinite=function(){return this.throwIfDisposed(),kB(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.isInf=function(){return this.throwIfDisposed(),SB(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.isNaN=function(){return this.throwIfDisposed(),IB(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.leakyRelu=function(n){return this.throwIfDisposed(),S1(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.lessEqual=function(n){return this.throwIfDisposed(),Ec(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.less=function(n){return this.throwIfDisposed(),Yp(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.localResponseNormalization=function(n,e,t,s){return this.throwIfDisposed(),jB(this,n,e,t,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.logSigmoid=function(){return this.throwIfDisposed(),OB(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.logSoftmax=function(n){return this.throwIfDisposed(),SE(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.logSumExp=function(n,e){return this.throwIfDisposed(),NE(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.log=function(){return this.throwIfDisposed(),Ei(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.log1p=function(){return this.throwIfDisposed(),CE(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.logicalAnd=function(n){return this.throwIfDisposed(),to(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.logicalNot=function(){return this.throwIfDisposed(),N1(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.logicalOr=function(n){return this.throwIfDisposed(),IE(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.logicalXor=function(n){return this.throwIfDisposed(),HB(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.matMul=function(n,e,t){return this.throwIfDisposed(),Tt(this,n,e,t)};ve().prototype.maxPool=function(n,e,t,s){return this.throwIfDisposed(),I1(this,n,e,t,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.max=function(n,e){return this.throwIfDisposed(),Yr(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.maximum=function(n){return this.throwIfDisposed(),ta(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.mean=function(n,e){return this.throwIfDisposed(),wn(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.min=function(n,e){return this.throwIfDisposed(),Xp(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.minimum=function(n){return this.throwIfDisposed(),ed(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.mirrorPad=function(n,e){return this.throwIfDisposed(),eW(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.mod=function(n){return this.throwIfDisposed(),nW(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.mul=function(n){return this.throwIfDisposed(),ne(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.neg=function(){return this.throwIfDisposed(),fn(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.norm=function(n,e,t){return this.throwIfDisposed(),Ug(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.notEqual=function(n){return this.throwIfDisposed(),Zp(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.oneHot=function(n,e=1,t=0){return this.throwIfDisposed(),TE(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.onesLike=function(){return this.throwIfDisposed(),$r(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.pad=function(n,e){return this.throwIfDisposed(),$1(this,n,e)};ve().prototype.pool=function(n,e,t,s,r,i){return this.throwIfDisposed(),hW(this,n,e,t,s,r,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.pow=function(n){return this.throwIfDisposed(),qa(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.prelu=function(n){return this.throwIfDisposed(),A1(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.prod=function(n,e){return this.throwIfDisposed(),mW(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.reciprocal=function(){return this.throwIfDisposed(),zW(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.relu=function(){return this.throwIfDisposed(),sl(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.relu6=function(){return this.throwIfDisposed(),EE(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.reshapeAs=function(n){return this.throwIfDisposed(),ie(this,n.shape)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.reshape=function(n){return this.throwIfDisposed(),ie(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.resizeBilinear=function(n,e,t){return this.throwIfDisposed(),WE(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.resizeNearestNeighbor=function(n,e,t){return this.throwIfDisposed(),VE(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.reverse=function(n){return this.throwIfDisposed(),Ka(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.rfft=function(){return this.throwIfDisposed(),cV(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.round=function(){return this.throwIfDisposed(),AE(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.rsqrt=function(){return this.throwIfDisposed(),jE(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.selu=function(){return this.throwIfDisposed(),RE(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.separableConv2d=function(n,e,t,s,r,i){return this.throwIfDisposed(),DE(this,n,e,t,s,r,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.sigmoid=function(){return this.throwIfDisposed(),$c(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.sign=function(){return this.throwIfDisposed(),QW(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.sin=function(){return this.throwIfDisposed(),PE(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.sinh=function(){return this.throwIfDisposed(),ME(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.slice=function(n,e){return this.throwIfDisposed(),Ot(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.softmax=function(n){return this.throwIfDisposed(),P1(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.softplus=function(){return this.throwIfDisposed(),mh(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.spaceToBatchND=function(n,e){return this.throwIfDisposed(),E1(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.split=function(n,e){return this.throwIfDisposed(),or(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.sqrt=function(){return this.throwIfDisposed(),ss(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.square=function(){return this.throwIfDisposed(),Bt(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.squaredDifference=function(n){return this.throwIfDisposed(),dV(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.squeeze=function(n){return this.throwIfDisposed(),xh(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.stack=function(n,e){this.throwIfDisposed();const t=n instanceof Sn?[this,n]:[this,...n];return no(t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.step=function(n){return this.throwIfDisposed(),yh(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.stridedSlice=function(n,e,t,s,r,i,o,a){return this.throwIfDisposed(),gV(this,n,e,t,s,r,i,o,a)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.sub=function(n){return this.throwIfDisposed(),tt(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.sum=function(n,e){return this.throwIfDisposed(),Ye(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.tan=function(){return this.throwIfDisposed(),yV(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.tanh=function(){return this.throwIfDisposed(),zg(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.tile=function(n){return this.throwIfDisposed(),Qr(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.toBool=function(){return this.throwIfDisposed(),Fe(this,"bool")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.toFloat=function(){return this.throwIfDisposed(),Fe(this,"float32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.toInt=function(){return this.throwIfDisposed(),Fe(this,"int32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.topk=function(n,e){return this.throwIfDisposed(),wV(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.transpose=function(n){return this.throwIfDisposed(),bt(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.unique=function(n){return this.throwIfDisposed(),SV(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.unsortedSegmentSum=function(n,e){return this.throwIfDisposed(),zE(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.unstack=function(n){return this.throwIfDisposed(),Qa(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.where=function(n,e){return this.throwIfDisposed(),bs(n,this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.zerosLike=function(){return this.throwIfDisposed(),wt(this)};/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class mi extends Error{constructor(e){super(e),Object.setPrototypeOf(this,mi.prototype)}}class Sr extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Sr.prototype)}}class te extends Error{constructor(e){super(e),Object.setPrototypeOf(this,te.prototype)}}class at extends Error{constructor(e){super(e),Object.setPrototypeOf(this,at.prototype)}}class xw extends Error{constructor(e){super(e),Object.setPrototypeOf(this,xw.prototype)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class DA{constructor(e){this.maxEntries=e||100,this.cache=new Map}get(e){let t;return this.cache.has(e)&&(t=this.cache.get(e),this.cache.delete(e),this.cache.set(e,t)),t}put(e,t){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxEntries){const s=this.cache.keys().next().value;this.cache.delete(s)}this.cache.set(e,t)}getMaxEntries(){return this.maxEntries}setMaxEntries(e){if(e<0)throw new Error(`The maxEntries of LRU caches must be at least 0, but got ${e}.`);if(this.maxEntries>e)for(let t=0;t<this.maxEntries-e;t++){const s=this.cache.keys().next().value;this.cache.delete(s)}this.maxEntries=e}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Xa(n,e){if(Array.isArray(n)){let t=[];for(let s=0;s<e;s++)t=t.concat(n);return t}else{const t=new Array(e);return t.fill(n),t}}function gi(n,e){if(!n)throw new xw(e)}function aN(n,e){let t=0;for(const s of n)s===e&&t++;return t}function As(n){return n.length===1?n[0]:n}function jt(n){return Array.isArray(n)?n:[n]}function qi(n){const t=n.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return t[0]!=="_"?t:"private"+t}function $a(n){return n.length<=1||n.indexOf("_")===-1?n:n.replace(/[_]+(\w|$)/g,(e,t)=>t.toUpperCase())}let yr={};function yw(n){if(n==null)return null;const e={};return e.className=n.getClassName(),e.config=n.getConfig(),e}function $v(n){if(!(n==null||typeof n!="object"))if(Array.isArray(n))n.forEach(e=>$v(e));else{const e=Object.keys(n);for(const t of e){const s=n[t];s!=null&&typeof s=="object"&&(!Array.isArray(s)&&s.type==="ndarray"&&typeof s.value=="number"?n[t]=s.value:$v(s))}}}function kh(n,e={},t={},s="object",r=!1){if(typeof n=="string"){const i=n;let o;if(i in t)o=t[i];else if(i in yr)o=yr[i];else if(o=e[i],o==null)throw new te(`Unknown ${s}: ${n}. This may be due to one of the following reasons:
1. The ${s} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${s} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);return o}else{const i=n;if(i.className==null||i.config==null)throw new te(`${s}: Improper config format: ${JSON.stringify(i)}.
'className' and 'config' must set.`);const o=i.className;let a,l;if(o in t?[a,l]=t[o]:o in yr?[a,l]=yr.className:o in e&&([a,l]=e[o]),a==null)throw new te(`Unknown ${s}: ${o}. This may be due to one of the following reasons:
1. The ${s} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${s} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);if(l!=null){const u={};for(const g of Object.keys(yr))u[g]=yr[g];for(const g of Object.keys(t))u[g]=t[g];const d=i.config;d.customObjects=u;const f=Object.assign({},yr);for(const g of Object.keys(t))yr[g]=t[g];$v(i.config);const p=l(a,i.config,t,r);return yr=Object.assign({},f),p}else{const u=Object.assign({},yr);for(const f of Object.keys(t))yr[f]=t[f];const d=new a(i.config);return yr=Object.assign({},u),d}}}function JG(n,e){return n<e?-1:n>e?1:0}function Jf(n,e){return-1*JG(n,e)}function Bo(n){if(n==null)return n;const e=[];for(const t of n)e.indexOf(t)===-1&&e.push(t);return e}function e8(n){if(n==null)throw new te(`Invalid value in obj: ${JSON.stringify(n)}`);for(const e in n)if(n.hasOwnProperty(e))return!1;return!0}function il(n,e,t){if(t!=null&&n.indexOf(t)<0)throw new te(`${t} is not a valid ${e}.  Valid values are ${n} or null/undefined.`)}function vw(n,e,t=0,s=1/0){return gi(t>=0),gi(s>=t),Array.isArray(n)&&n.length>=t&&n.length<=s&&n.every(r=>typeof r===e)}function _n(n,e){Array.isArray(n)?(V(n.length>0,()=>`${e} is unexpectedly an empty array.`),n.forEach((t,s)=>_n(t,`element ${s+1} of ${e}`))):V(Number.isInteger(n)&&n>0,()=>`Expected ${e} to be a positive integer, but got ${PA(n)}.`)}function PA(n){return n===null?"null":Array.isArray(n)?"["+n.map(e=>PA(e)).join(",")+"]":typeof n=="string"?`"${n}"`:`${n}`}function t8(n,e,t){let s=t!=null?t():$s(),r;return(...o)=>{const a=t!=null?t():$s();return a-s<e||(s=a,r=n(...o)),r}}function MA(n){return n==="relu"?"relu":n==="linear"?"linear":n==="elu"?"elu":null}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let n8=0;function LA(){return n8++}const ep={};function Xg(n=""){return n in ep||(ep[n]=0),ep[n]+=1,n+ep[n].toString()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const s8=["channelsFirst","channelsLast"],r8=["nearest","bilinear"],i8=["valid","same","causal"],o8=["max","avg"],a8=["sum","mul","concat","ave"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const Ml=new Map;function gn(n){il(s8,"DataFormat",n)}function l8(n){il(r8,"InterpolationFormat",n)}function cr(n){il(i8,"PaddingMode",n)}function FA(n){il(o8,"PoolMode",n)}const Hu=[],lN="/";function Ma(n,e){Hu.push(n);try{const t=e();return Hu.pop(),t}catch(t){throw Hu.pop(),t}}function c8(){return Hu.length===0?"":Hu.join(lN)+lN}function OA(n){if(!zA(n))throw new Error("Not a valid tensor name: '"+n+"'");return c8()+n}function _A(n){if(!zA(n))throw new Error("Not a valid tensor name: '"+n+"'");Ml.has(n)||Ml.set(n,0);const e=Ml.get(n);if(Ml.set(n,Ml.get(n)+1),e>0){const t=`${n}_${e}`;return Ml.set(t,1),t}else return n}const u8=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function zA(n){return!!n.match(u8)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function d8(n){return n===parseInt(n.toString(),10)}function Wo(n,e,t){e==null&&(e=0),t==null&&(t=n.length);let s=1;for(let r=e;r<t;++r)s*=n[r];return s}function dc(n){if(n.length===0)return Number.NaN;let e=Number.POSITIVE_INFINITY;for(let t=0;t<n.length;t++){const s=n[t];s<e&&(e=s)}return e}function Go(n){if(n.length===0)return Number.NaN;let e=Number.NEGATIVE_INFINITY;for(let t=0;t<n.length;t++){const s=n[t];s>e&&(e=s)}return e}function ni(n,e){if(e<n)throw new te(`end (${e}) < begin (${n}) is forbidden.`);const t=[];for(let s=n;s<e;++s)t.push(s);return t}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let v0;function Nn(){return v0==null&&(v0=L_().epsilon()),v0}function si(){return"channelsLast"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Si(n,e){return Fe(n,e)}function Ch(n,e=-1){const t=n.shape.slice();return e<0&&(e=t.length+e+1),t.splice(e,0,1),ie(n,t)}function h8(n,e){return de(()=>{if(n.shape.length!==2)throw new te(`repeat() expects a rank-2 tensor, but received a rank-${n.shape.length} tensor.`);const t=Ch(n,1);return Ev(t,[1,e,1])})}function f8(n){const e=[Wo(n.shape)];return ie(n,e)}function p8(n){if(n.rank<=1)throw new te(`batchFlatten requires a minimum rank of 2. Got rank: ${n.rank}.`);const e=[n.shape[0],Wo(n.shape,1)];return ie(n,e)}function La(n,e,t){return de(()=>{switch(n.rank){case 1:return R1(n,e,t);case 2:return LE(n,[e,0],[t,n.shape[1]]);case 3:return D1(n,[e,0,0],[t,n.shape[1],n.shape[2]]);case 4:return em(n,[e,0,0,0],[t,n.shape[1],n.shape[2],n.shape[3]]);case 5:return Ot(n,[e,0,0,0,0],[t,n.shape[1],n.shape[2],n.shape[3],n.shape[4]]);case 6:return Ot(n,[e,0,0,0,0,0],[t,n.shape[1],n.shape[2],n.shape[3],n.shape[4],n.shape[5]]);default:throw new te(`sliceAlongFirstAxis() received an unsupported tensor rank: ${n.rank}`)}})}function b0(n,e,t){return de(()=>{switch(n.rank){case 1:return R1(n,e,t);case 2:return LE(n,[0,e],[n.shape[0],t]);case 3:return D1(n,[0,0,e],[n.shape[0],n.shape[1],t]);case 4:return em(n,[0,0,0,e],[n.shape[0],n.shape[1],n.shape[2],t]);default:throw new te(`sliceAlongLastAxis() received an unsupported tensor rank: ${n.rank}`)}})}function tp(n,e,t,s){return de(()=>{switch(n.rank){case 1:return R1(n,e,t);case 2:switch(s){case 1:return La(n,e,t);case 2:return b0(n,e,t);default:throw new te(`The axis is not within the rank of the tensor ${s}`)}case 3:switch(s){case 1:return La(n,e,t);case 2:return D1(n,[0,e,0],[n.shape[0],t,n.shape[2]]);case 3:return b0(n,e,t);default:throw new te(`The axis is not within the rank of the tensor ${s}`)}case 4:switch(s){case 1:return La(n,e,t);case 2:return em(n,[0,e,0,0],[n.shape[0],t,n.shape[2],n.shape[3]]);case 3:return em(n,[0,0,e,0],[n.shape[0],n.shape[1],t,n.shape[3]]);case 4:return b0(n,e,t);default:throw new te(`The axis is not within the rank of the tensor ${s}`)}default:throw new te(`sliceAlongLastAxis() received an unsupported tensor rank: ${n.rank}`)}})}function bw(n,e=-1){let t;return e<0&&(t=n[0].rank,t!==0?e=t:e=0),e===n[0].rank&&(e=-1),Rs(n,e)}function cN(n,e){switch(n.rank){case 1:return v5([n,e]);case 2:return w5([n,e],0);case 3:return C5([n,e],0);case 4:return N5([n,e],0);default:throw new te(`concatAlongFirstAxis() received an unsupported tensor rank: ${n.rank}`)}}function Ev(n,e){if(Array.isArray(e)||(e=[e]),n.rank!==e.length)throw new te(`The length of input n (${e.length}) does not match the number of dimensions in input x (${n.rank})`);return Qr(n,e)}function Yg(n,e=0,t=1,s,r){return LW(n,e,t,s,r)}function Ni(n,e,t,s){if(n.rank<2||e.rank<2)throw new at(`dot requires both inputs to be rank >= 2 but got x shape = ${n.shape} and y shape = ${e.shape}`);if(e.rank>=3){const r=n.shape.slice(-1)[0],i=e.shape.slice(-2)[0];if(r!==i)throw new at(`If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = ${n.shape} and  y shape = ${e.shape}`)}if(n.rank===2&&e.rank===2)return qS({a:n,b:e,transposeA:!1,transposeB:!1,bias:s?Av(n.rank,s,si()):null,activation:t});{const r=n.shape.slice(),i=r.pop();n=ie(n,[-1,i]);const o=e.shape.slice(),a=o.pop(),l=o.pop(),u=[...o,a],d=Array.from({length:e.rank},(x,y)=>y===0?e.rank-2:y<=e.rank-2?y-1:y);e=ie(bt(e,d),[l,-1]);const f=[...r,...u];return ie(qS({a:n,b:e,transposeA:!1,transposeB:!1,bias:s?Av(n.rank,s,si()):null,activation:t}),f)}}function BA(n,e,t){return de(()=>(Array.isArray(e)?e=js(e,"int32"):e=Fe(e,"int32"),k1(n,e,t)))}function Sh(n){return ne(n,n)}function Av(n,e,t){const s=e.shape;if(e.rank!==1&&e.rank!==n)throw new te(`Unexpected bias dimensions: ${e.rank}; expected it to be 1 or ${n}`);if(n===5){if(t==="channelsFirst")return s.length===1?ie(e,[1,s[0],1,1,1]):ie(e,[1,s[3],s[0],s[1],s[2]]);if(t==="channelsLast")return s.length===1?ie(e,[1,1,1,1,s[0]]):ie(e,[1].concat(s))}else if(n===4){if(t==="channelsFirst")return s.length===1?ie(e,[1,s[0],1,1]):ie(e,[1,s[2],s[0],s[1]]);if(t==="channelsLast")return s.length===1?ie(e,[1,1,1,s[0]]):ie(e,[1].concat(s))}else if(n===3){if(t==="channelsFirst")return s.length===1?ie(e,[1,s[0],1]):ie(e,[1,s[1],s[0]]);if(t==="channelsLast")return s.length===1?ie(e,[1,1,s[0]]):ie(e,[1].concat(s))}else if(n<3)return e;throw new te(`Unsupported input rank by biasAdd: ${e.rank}`)}function oi(n,e,t){return de(()=>(t==null&&(t=si()),gn(t),$e(n,Av(n.rank,e,t))))}function m8(n,e=1){if(e!==1)throw new at(`Support for alpha values other than 1 (${e}) is not implemented yet.`);return Vg(n)}function g8(n){return de(()=>Ze(n,$e(xs(n),1)))}function WA(n,e,t,s){return de(()=>jV(n,e,t,s))}function x8(n){return de(()=>{const e=$e(.5,ne(.2,n));return ar(e,0,1)})}function Nh(n,e,t=!1){return t?n():e()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const y8=["fanIn","fanOut","fanAvg"],v8=["normal","uniform","truncatedNormal"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function b8(n){il(y8,"FanMode",n)}function w8(n){il(v8,"Distribution",n)}class jr extends jc{fromConfigUsesCustomObjects(){return!1}getConfig(){return{}}}class VA extends jr{apply(e,t){return On(e,t)}}VA.className="Zeros";Se(VA);class ww extends jr{apply(e,t){return na(e,t)}}ww.className="Ones";Se(ww);class UA extends jr{constructor(e){if(super(),typeof e!="object")throw new te(`Expected argument of type ConstantConfig but got ${e}`);if(e.value===void 0)throw new te(`config must have value set but got ${e}`);this.value=e.value}apply(e,t){return de(()=>ne($t(this.value),na(e,t)))}getConfig(){return{value:this.value}}}UA.className="Constant";Se(UA);class GA extends jr{constructor(e){super(),this.DEFAULT_MINVAL=-.05,this.DEFAULT_MAXVAL=.05,this.minval=e.minval||this.DEFAULT_MINVAL,this.maxval=e.maxval||this.DEFAULT_MAXVAL,this.seed=e.seed}apply(e,t){return gh(e,this.minval,this.maxval,t,this.seed)}getConfig(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}GA.className="RandomUniform";Se(GA);class HA extends jr{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,t){if(t=t||"float32",t!=="float32"&&t!=="int32")throw new at(`randomNormal does not support dType ${t}.`);return Yg(e,this.mean,this.stddev,t,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}HA.className="RandomNormal";Se(HA);class qA extends jr{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,t){if(t=t||"float32",t!=="float32"&&t!=="int32")throw new at(`truncatedNormal does not support dType ${t}.`);return _E(e,this.mean,this.stddev,t,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}qA.className="TruncatedNormal";Se(qA);class KA extends jr{constructor(e){super(),this.gain=e.gain!=null?e.gain:1}apply(e,t){return de(()=>{if(e.length!==2||e[0]!==e[1])throw new te("Identity matrix initializer can only be used for 2D square matrices.");return ne(this.gain,kE(e[0]))})}getConfig(){return{gain:this.gain}}}KA.className="Identity";Se(KA);function k8(n,e="channelsLast"){let t,s;if(gn(e),n.length===2)t=n[0],s=n[1];else if([3,4,5].indexOf(n.length)!==-1){if(e==="channelsFirst"){const r=Wo(n,2);t=n[1]*r,s=n[0]*r}else if(e==="channelsLast"){const r=Wo(n,0,n.length-2);t=n[n.length-2]*r,s=n[n.length-1]*r}}else{const r=Wo(n);t=Math.sqrt(r),s=Math.sqrt(r)}return[t,s]}class Qs extends jr{constructor(e){if(super(),e.scale<0)throw new te(`scale must be a positive float. Got: ${e.scale}`);this.scale=e.scale==null?1:e.scale,this.mode=e.mode==null?"fanIn":e.mode,b8(this.mode),this.distribution=e.distribution==null?"normal":e.distribution,w8(this.distribution),this.seed=e.seed}apply(e,t){const s=k8(e),r=s[0],i=s[1];let o=this.scale;if(this.mode==="fanIn"?o/=Math.max(1,r):this.mode==="fanOut"?o/=Math.max(1,i):o/=Math.max(1,(r+i)/2),this.distribution==="normal"){const a=Math.sqrt(o);if(t=t||"float32",t!=="float32"&&t!=="int32")throw new at(`${this.getClassName()} does not support dType ${t}.`);return _E(e,0,a,t,this.seed)}else{const a=Math.sqrt(3*o);return gh(e,-a,a,t,this.seed)}}getConfig(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}Qs.className="VarianceScaling";Se(Qs);class kw extends Qs{constructor(e){super({scale:1,mode:"fanAvg",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return Qs.className}}kw.className="GlorotUniform";Se(kw);class Cw extends Qs{constructor(e){super({scale:1,mode:"fanAvg",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return Qs.className}}Cw.className="GlorotNormal";Se(Cw);class Sw extends Qs{constructor(e){super({scale:2,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return Qs.className}}Sw.className="HeNormal";Se(Sw);class Nw extends Qs{constructor(e){super({scale:2,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return Qs.className}}Nw.className="HeUniform";Se(Nw);class Iw extends Qs{constructor(e){super({scale:1,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return Qs.className}}Iw.className="LeCunNormal";Se(Iw);class Tw extends Qs{constructor(e){super({scale:1,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return Qs.className}}Tw.className="LeCunUniform";Se(Tw);class QA extends jr{constructor(e){super(),this.DEFAULT_GAIN=1,this.ELEMENTS_WARN_SLOW=2e3,this.gain=e.gain==null?this.DEFAULT_GAIN:e.gain,this.seed=e.seed}apply(e,t){return de(()=>{if(e.length<2)throw new at("Shape must be at least 2D.");if(t!=="int32"&&t!=="float32"&&t!==void 0)throw new TypeError(`Unsupported data type ${t}.`);t=t;const s=be(e.slice(0,-1)),r=e[e.length-1],i=s*r;i>this.ELEMENTS_WARN_SLOW&&console.warn(`Orthogonal initializer is being called on a matrix with more than ${this.ELEMENTS_WARN_SLOW} (${i}) elements: Slowness may result.`);const o=[Math.max(r,s),Math.min(r,s)],a=Yg(o,0,1,t,this.seed),l=T6.qr(a,!1);let u=l[0];const f=l[1].flatten().stridedSlice([0],[Math.min(r,s)*Math.min(r,s)],[Math.min(r,s)+1]);return u=ne(u,f.sign()),s<r&&(u=u.transpose()),ne($t(this.gain),u.reshape(e))})}getConfig(){return{gain:this.gain,seed:this.seed}}}QA.className="Orthogonal";Se(QA);const uN={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function dN(n,e={}){return kh(n,Cr.getMap().classNameMap,e,"initializer")}function Jt(n){return yw(n)}function Kt(n){if(typeof n=="string"){const e=n in uN?uN[n]:n;if(e==="GlorotNormal")return new Cw;if(e==="GlorotUniform")return new kw;if(e==="HeNormal")return new Sw;if(e==="HeUniform")return new Nw;if(e==="LeCunNormal")return new Iw;if(e==="LeCunUniform")return new Tw;{const t={};return t.className=e,t.config={},dN(t)}}else return n instanceof jr?n:dN(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function jv(n){return Array.isArray(n)&&Array.isArray(n[0])}function tm(n){return n.length===0?[]:Array.isArray(n[0])?n:[n]}function nt(n){let e;if(Array.isArray(n)){if(n.length!==1)throw new te(`Expected Tensor length to be 1; got ${n.length}`);e=n[0]}else e=n;return e}function Ct(n){if(Array.isArray(n)&&Array.isArray(n[0])){if(n.length===1)return n=n,n[0];throw new te(`Expected exactly 1 Shape; got ${n.length}`)}else return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function nm(n){let e=0;for(const t of n)t.shape.length===0?e+=1:e+=t.shape.reduce((s,r)=>s*r);return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const hN="Variable";class C8{constructor(e,t="float32",s=hN,r=!0,i=null){this.dtype=t??"float32",this.shape=e.shape,this.id=LA(),s=s??hN,this.originalName=OA(s),this.name=_A(this.originalName),this.trainable_=r,this.constraint=i,this.val=TV(e,this.trainable_,this.name,this.dtype)}read(){return this.assertNotDisposed(),this.val}write(e){return this.assertNotDisposed(),S8(this.val,e),this.val.id!==e.id&&(this.val.assign(e),this.constraint!=null&&this.val.assign(this.constraint.apply(this.val))),this}dispose(){this.assertNotDisposed(),this.val.dispose()}assertNotDisposed(){if(this.val.isDisposed)throw new Error(`LayersVariable ${this.name} is already disposed.`)}get trainable(){return this.trainable_}set trainable(e){this.trainable_=e,this.val.trainable=e}}function S8(n,e){if(n.shape.toString()!==e.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(n.shape)+" vs. "+JSON.stringify(e.shape))}function Rv(n){return n.map(e=>e.read())}function $w(n){n.forEach(e=>{e[0].write(e[1])})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class In{constructor(e){this.dtype=e.dtype,this.shape=e.shape,e.shape!=null?this.ndim=e.shape.length:this.ndim=e.ndim,this.maxNDim=e.maxNDim,this.minNDim=e.minNDim,this.axes=e.axes||{}}}class Ai{constructor(e,t,s,r,i,o,a){this.dtype=e,this.shape=t,this.sourceLayer=s,this.inputs=r,this.callArgs=i,this.outputTensorIndex=a,this.id=LA(),o!=null&&(this.originalName=OA(o),this.name=_A(this.originalName)),this.rank=t.length}}let N8=0;class Zg{constructor(e,t){this.callArgs=t,this.id=N8++,this.outboundLayer=e.outboundLayer,this.inboundLayers=e.inboundLayers,this.nodeIndices=e.nodeIndices,this.tensorIndices=e.tensorIndices,this.inputTensors=e.inputTensors,this.outputTensors=e.outputTensors,this.inputMasks=e.inputMasks,this.outputMasks=e.outputMasks,this.inputShapes=e.inputShapes,this.outputShapes=e.outputShapes;for(const s of e.inboundLayers)s!=null&&s.outboundNodes.push(this);e.outboundLayer.inboundNodes.push(this)}getConfig(){const e=[];for(const t of this.inboundLayers)t!=null?e.push(t.name):e.push(null);return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:e,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}}let I8=0;class ft extends jc{constructor(e={}){super(),this._callHook=null,this._addedWeightNames=[],this._stateful=!1,this.id=I8++,this.activityRegularizer=null,this.inputSpec=null,this.supportsMasking=!1,this._trainableWeights=[],this._nonTrainableWeights=[],this._losses=[],this._updates=[],this._built=!1,this.inboundNodes=[],this.outboundNodes=[];let t=e.name;if(!t){const s=this.getClassName();t=qi(s)+"_"+Xg(s)}if(this.name=t,this.trainable_=e.trainable==null?!0:e.trainable,e.inputShape!=null||e.batchInputShape!=null){let s;if(e.batchInputShape!=null)s=e.batchInputShape;else if(e.inputShape!=null){let i=null;e.batchSize!=null&&(i=e.batchSize),s=[i].concat(e.inputShape)}this.batchInputShape=s;let r=e.dtype;r==null&&(r=e.inputDType),r==null&&(r="float32"),this.dtype=r}e.weights!=null?this.initialWeights=e.weights:this.initialWeights=null,this._refCount=null,this.fastWeightInitDuringBuild=!1}static nodeKey(e,t){return e.name+"_ib-"+t.toString()}getNodeAtIndex(e,t){if(this.inboundNodes.length===0)throw new Sr(`The layer has never been called and thus has no defined ${t}.`);if(this.inboundNodes.length<=e)throw new te(`Asked to get ${t} at node ${e}, but the layer has only ${this.inboundNodes.length} inbound nodes.`);return this.inboundNodes[e]}getInputAt(e){return As(this.getNodeAtIndex(e,"input").inputTensors)}getOutputAt(e){return As(this.getNodeAtIndex(e,"output").outputTensors)}get input(){if(this.inboundNodes.length>1)throw new mi(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use \`getInputAt(nodeIndex)\` instead.`);if(this.inboundNodes.length===0)throw new mi(`Layer ${this.name} is not connected, no input to return.`);return As(this.getNodeAtIndex(0,"input").inputTensors)}get output(){if(this.inboundNodes.length===0)throw new mi(`Layer ${this.name} has no inbound nodes.`);if(this.inboundNodes.length>1)throw new mi(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use \`getOutputAt(nodeIndex)\` instead.`);return As(this.getNodeAtIndex(0,"output").outputTensors)}get losses(){return this._losses}calculateLosses(){return this.losses.map(e=>e())}get updates(){return this._updates}get built(){return this._built}set built(e){this._built=e}get trainable(){return this.trainable_}set trainable(e){this._trainableWeights.forEach(t=>t.trainable=e),this.trainable_=e}get trainableWeights(){return this.trainable_?this._trainableWeights.filter(e=>e.trainable):[]}set trainableWeights(e){this._trainableWeights=e}get nonTrainableWeights(){return this.trainable?this._trainableWeights.filter(e=>!e.trainable).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)}set nonTrainableWeights(e){this._nonTrainableWeights=e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}get stateful(){return this._stateful}resetStates(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}assertInputCompatibility(e){const t=jt(e);if(this.inputSpec==null||this.inputSpec.length===0)return;const s=jt(this.inputSpec);if(t.length!==s.length)throw new te(`Layer ${this.name} expects ${s.length} inputs, but it received ${t.length} input tensors. Input received: ${e}`);for(let r=0;r<t.length;r++){const i=t[r],o=s[r];if(o==null)continue;const a=i.rank;if(o.ndim!=null&&a!==o.ndim)throw new te(`Input ${r} is incompatible with layer ${this.name}: expected ndim=${o.ndim}, found ndim=${a}`);if(o.maxNDim!=null&&a>o.maxNDim)throw new te(`Input ${r} is incompatible with layer ${this.name}: expected max_ndim=${o.maxNDim}, found ndim=${a}`);if(o.minNDim!=null&&a<o.minNDim)throw new te(`Input ${r} is incompatible with layer ${this.name}: expected min_ndim=${o.minNDim}, found ndim=${a}.`);if(o.dtype!=null&&i.dtype!==o.dtype)throw new te(`Input ${r} is incompatible with layer ${this.name} : expected dtype=${o.dtype}, found dtype=${i.dtype}.`);if(o.axes){const l=i.shape;for(const u in o.axes){const d=Number(u),f=o.axes[u],p=d>=0?l[d]:l[l.length+d];if(f!=null&&[f,null].indexOf(p)===-1)throw new te(`Input ${r} is incompatible with layer ${this.name}: expected axis ${d} of input shape to have value ${f} but got shape ${l}.`)}}if(o.shape!=null)for(let l=0;l<o.shape.length;++l){const u=o.shape[l],d=i.shape[l];if(u!=null&&d!=null&&u!==d)throw new te(`Input ${r} is incompatible with layer ${this.name}: expected shape=${o.shape}, found shape=${i.shape}.`)}}}call(e,t){return e}invokeCallHook(e,t){this._callHook!=null&&this._callHook(e,t)}setCallHook(e){this._callHook=e}clearCallHook(){this._callHook=null}apply(e,t){t=t||{},this.assertNotDisposed();const s=jt(e),r=E8(e),i=A8(e);if(r===i)throw new te("Arguments to apply() must be all SymbolicTensors or all Tensors");return Ma(this.name,()=>{if(!this.built){this.assertInputCompatibility(e);const o=[];for(const a of jt(e))o.push(a.shape);this.build(As(o)),this.built=!0,this.initialWeights&&this.setWeights(this.initialWeights),this._refCount===null&&i&&(this._refCount=1)}if(this.assertInputCompatibility(e),i){let o=this.call(e,t);this.supportsMasking&&this.setMaskMetadata(e,o);const a=jt(o),l=[];for(let u of a)s.indexOf(u)!==-1&&(u=u.clone()),l.push(u);if(o=As(l),this.activityRegularizer!=null)throw new at("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return o}else{const o=T8(e),a=this.computeOutputShape(o);let l;const u=$8(e);if(this.warnOnIncompatibleInputShape(Array.isArray(e)?o[0]:o),a!=null&&a.length>0&&Array.isArray(a[0])?l=a.map((d,f)=>new Ai(u,d,this,jt(e),t,this.name,f)):l=new Ai(u,a,this,jt(e),t,this.name),this.addInboundNode(e,l,null,null,o,a,t),this._refCount++,this.activityRegularizer!=null)throw new at("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return l}})}warnOnIncompatibleInputShape(e){if(this.batchInputShape!=null)if(e.length!==this.batchInputShape.length)console.warn(`The rank of the input tensor provided (shape: ${JSON.stringify(e)}) does not match that of the batchInputShape (${JSON.stringify(this.batchInputShape)}) of the layer ${this.name}`);else{let t=!1;this.batchInputShape.forEach((s,r)=>{s!=null&&e[r]!=null&&e[r]!==s&&(t=!0)}),t&&console.warn(`The shape of the input tensor (${JSON.stringify(e)}) does not match the expectation of layer ${this.name}: ${JSON.stringify(this.batchInputShape)}`)}}get outputShape(){if(this.inboundNodes==null||this.inboundNodes.length===0)throw new mi(`The layer ${this.name} has never been called and thus has no defined output shape.`);const e=[];for(const t of this.inboundNodes){const s=JSON.stringify(t.outputShapes);e.indexOf(s)===-1&&e.push(s)}if(e.length===1){const t=this.inboundNodes[0].outputShapes;return Array.isArray(t)&&Array.isArray(t[0])&&t.length===1?t[0]:t}else throw new mi(`The layer ${this.name} has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.`)}countParams(){if(!this.built)throw new Sr(`You tried to call countParams() on ${this.name}, but the layer is not built yet. Build it first by calling build(batchInputShape).`);return nm(this.weights)}build(e){this.built=!0}getWeights(e=!1){return Rv(e?this.trainableWeights:this.weights)}setWeights(e){de(()=>{const t=this.weights;if(t.length!==e.length)throw new te(`You called setWeights(weights) on layer "${this.name}" with a weight list of length ${e.length}, but the layer was expecting ${t.length} weights. Provided weights: ${e}...`);if(t.length===0)return;const s=[],r=Rv(t);for(let i=0;i<r.length;++i){const o=r[i],a=t[i],l=e[i];if(!At(o.shape,l.shape))throw new te(`Layer weight shape ${o.shape} not compatible with provided weight shape ${l.shape}`);s.push([a,l])}$w(s)})}addWeight(e,t,s,r,i,o,a,l){if(this._addedWeightNames.indexOf(e)!==-1)throw new te(`Duplicate weight name ${e} for layer ${this.name}`);this._addedWeightNames.push(e),s==null&&(s="float32"),this.fastWeightInitDuringBuild&&(r=l!=null?l():Kt("zeros"));const u=r.apply(t,s),d=new C8(u,s,e,o,a);return u.dispose(),i!=null&&this.addLoss(()=>i.apply(d.read())),o==null&&(o=!0),o?this._trainableWeights.push(d):this._nonTrainableWeights.push(d),d}setFastWeightInitDuringBuild(e){this.fastWeightInitDuringBuild=e}addLoss(e){e==null||Array.isArray(e)&&e.length===0||(e=jt(e),this._losses!==void 0&&this._losses!==null&&this.losses.push(...e))}computeOutputShape(e){return e}computeMask(e,t){if(!this.supportsMasking){if(t!=null)if(Array.isArray(t))t.forEach(s=>{if(s!=null)throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`)});else throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`);return null}return t}setMaskMetadata(e,t,s){if(!this.supportsMasking)return;const r=this.computeMask(e,s),i=jt(t),o=jt(r);if(i.length!==o.length)throw new Error(`${this.name} outputs ${i.length} tensors but ${i.length} masks for those tensors`);for(let a=0;a<i.length;a++)i[a].kerasMask=o[a]}addInboundNode(e,t,s,r,i,o,a=null){const l=jt(e);t=jt(t),s=jt(s),r=jt(r),i=tm(i),o=tm(o);const u=[],d=[],f=[];for(const p of l)u.push(p.sourceLayer),d.push(p.nodeIndex),f.push(p.tensorIndex);new Zg({outboundLayer:this,inboundLayers:u,nodeIndices:d,tensorIndices:f,inputTensors:l,outputTensors:t,inputMasks:s,outputMasks:r,inputShapes:i,outputShapes:o},a);for(let p=0;p<t.length;p++)t[p].sourceLayer=this,t[p].nodeIndex=this.inboundNodes.length-1,t[p].tensorIndex=p}getConfig(){const e={name:this.name,trainable:this.trainable};return this.batchInputShape!=null&&(e.batchInputShape=this.batchInputShape),this.dtype!=null&&(e.dtype=this.dtype),e}disposeWeights(){return this.weights.forEach(e=>e.dispose()),this.weights.length}assertNotDisposed(){if(this._refCount===0)throw new Error(`Layer '${this.name}' is already disposed.`)}dispose(){if(!this.built)throw new Error(`Cannot dispose Layer ${this.name} because it has not been built yet.`);if(this._refCount===null)throw new Error(`Cannot dispose Layer ${this.name} because it has not been used yet.`);this.assertNotDisposed();let e=0;return--this._refCount===0&&(e=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:e}}}function T8(n){n=jt(n);const e=[];for(const t of n)e.push(t.shape);return As(e)}function $8(n){return"float32"}function XA(n,e,t){if((e==null||t!=null&&t>0)&&(e=n.sourceLayer,t=n.nodeIndex),e.inboundNodes.length===0)return[n];{const s=e.inboundNodes[t];if(s.inboundLayers.length===0)return s.inputTensors;{const r=[];for(let i=0;i<s.inboundLayers.length;i++){const o=s.inputTensors[i],a=s.inboundLayers[i],l=s.nodeIndices[i],u=XA(o,a,l);for(const d of u)r.indexOf(d)===-1&&r.push(d)}return r}}}function E8(n){let e=!0;for(const t of jt(n))if(!(t instanceof Ai)){e=!1;break}return e}function A8(n){let e=!0;for(const t of jt(n))if(t instanceof Ai){e=!1;break}return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Ih extends ft{constructor(e){if(super({dtype:e.dtype,name:e.name!=null?e.name:Xg("input").toString()}),e.batchSize==null&&(e.batchSize=null),e.sparse==null&&(e.sparse=!1),this.trainable=!1,this.built=!0,this.sparse=e.sparse,e.inputShape!=null&&e.batchInputShape!=null)throw new te("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");let t=e.batchInputShape;if(t==null){if(e.inputShape==null)throw new te("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");t=[e.batchSize].concat(e.inputShape)}else if(e.batchSize!=null)throw new te("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");const s=e.dtype||"float32";this.batchInputShape=t,this.dtype=s,this.inputSpec=[{shape:t}];const r=new Ai(this.dtype,this.batchInputShape,this,[],{},this.name);r.nodeIndex=0,r.tensorIndex=0,new Zg({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[r],outputTensors:[r],inputMasks:[null],outputMasks:[null],inputShapes:[t],outputShapes:[t]})}apply(e,t){throw new te(`Cannot pass any input to an InputLayer's apply() method. InputLayer name: ${this.name}`)}dispose(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}getConfig(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}Ih.className="InputLayer";Se(Ih);function j8(n){if(n.batchShape==null&&n.shape==null)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(n.batchShape!=null&&n.shape!=null)throw new te("Please provide either a `shape` or `batchShape` argument to Input, but not both.");let e=n.batchShape;n.shape!=null&&e==null&&(e=[null].concat(n.shape));let t=n.dtype;return t==null&&(t="float32"),new Ih({batchInputShape:e,name:n.name,dtype:t,sparse:n.sparse}).inboundNodes[0].outputTensors[0]}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function R8(n,e){if(n.dtype==null||n.dtype===e.dtype)return e;try{return Fe(e,n.dtype)}catch{throw new te(`The dtype of the feed (${e.dtype}) can not be cast to the dtype of the key '${n.name}' (${n.dtype}).`)}}class Lo{constructor(e){if(this.id2Value={},this.id2Mask={},this.name2Id={},e instanceof Lo)for(const t in e.id2Value)this.id2Value[t]=e.id2Value[t],t in e.id2Mask&&(this.id2Mask[t]=e.id2Mask[t]);else{if(e==null)return;for(const t of e)this.add(t.key,t.value)}}add(e,t,s){if(this.id2Value[e.id]==null)this.id2Value[e.id]=R8(e,t),this.name2Id[e.name]=e.id,s!=null&&(this.id2Mask[e.id]=s);else throw new te(`Duplicate key: name=${e.name}, id=${e.id}`);return this}addFeed(e){this.add(e.key,e.value)}hasKey(e){return this.id2Value[e.id]!=null}names(){return Object.keys(this.name2Id)}getValue(e){if(e instanceof Ai){if(this.id2Value[e.id]==null)throw new te(`Nonexistent key: ${e.name}`);return this.id2Value[e.id]}else{const t=this.name2Id[e];if(t==null)throw new te(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Value[t]}}getMask(e){if(e instanceof Ai){if(this.id2Value[e.id]==null)throw new te(`Nonexistent key: ${e.name}`);return this.id2Mask[e.id]}else{const t=this.name2Id[e];if(t==null)throw new te(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Mask[t]}}disposeMasks(){this.id2Mask!=null&&ct(this.id2Mask)}}const sm=new DA,rm=new DA;function D8(n){sm!=null&&sm.setMaxEntries(n),rm!=null&&rm.setMaxEntries(n)}function Fu(n,e,t,s){const r=t==null?!1:t.training,i=Array.isArray(n),o=i?n:[n],a=o.map(x=>x.name),l=[],u=e.names();for(const x of a)u.indexOf(x)!==-1?l.push(e.getValue(x)):l.push(null);const d=a.join(",")+"|"+e.names().sort().join(",");let f=sm.get(d),p;if(f==null){const x=P8(o,e);f=x.sorted,p=x.recipientCounts,sm.put(d,f),rm.put(d,p)}p={},r||Object.assign(p,rm.get(d));const g=new Lo(e);for(let x=0;x<f.length;++x){const y=f[x],b=y.sourceLayer;if(b instanceof Ih)continue;const k=[],w=[],N=[];let C=!1;for(const M of y.inputs){const P=g.getValue(M),R=g.getMask(M);k.push(P),w.push(R),R!=null&&(C=!0),r||(p[M.name]--,p[M.name]===0&&!e.hasKey(M)&&a.indexOf(M.name)===-1&&!P.isDisposed&&M.sourceLayer.stateful!==!0&&N.push(P))}C&&(t=t||{},t.mask=w[0]);const S=jt(b.apply(k,t));let T=null;b.supportsMasking&&(T=b.computeMask(k,w));const A=L8(y),E=Array.isArray(A)?A:[A];for(let M=0;M<E.length;++M){g.hasKey(E[M])||g.add(E[M],S[M],Array.isArray(T)?T[0]:T);const P=a.indexOf(E[M].name);P!==-1&&(l[P]=S[M])}r||ct(N)}return g.disposeMasks(),i?l:l[0]}function P8(n,e){V(n!=null&&n.length>0,()=>"Expected at least one fetch, got none");let t=[],s={};if(n.length===1){const r=fN(n[0],e);t=r.sorted,s=r.recipientMap}else{const r=new Set;for(const i of n){const{sorted:o,recipientMap:a}=fN(i,e);for(const l of o)r.has(l.name)||(t.push(l),r.add(l.name));for(const l in a)s[l]==null&&(s[l]=new Set),a[l].forEach(u=>s[l].add(u))}}return{sorted:t,recipientCounts:M8(s)}}function M8(n){const e={};for(const t in n)e[t]=n[t].size;return e}function fN(n,e){const t=new Set,s=[],r={};for(const a of e.names())t.add(a);const i=[],o=[];for(i.push(n);i.length>0;){const a=i[i.length-1];if(t.has(a.name)){i.pop();continue}const l=o[o.length-1]===i.length-1;if(a.inputs.length===0||l)i.pop(),s.push(a),t.add(a.name),l&&o.pop();else{o.push(i.length-1);for(const u of a.inputs)r[u.name]==null&&(r[u.name]=new Set),r[u.name].add(a.name),!t.has(u.name)&&i.push(u)}}return{sorted:s,recipientMap:r}}function L8(n){let e;if(n.sourceLayer.inboundNodes.length===1)e=n.sourceLayer.output;else{let t=null;for(let s=0;s<n.sourceLayer.inboundNodes.length;++s)for(const r of n.sourceLayer.inboundNodes[s].outputTensors)if(r.id===n.id){t=s;break}e=n.sourceLayer.getOutputAt(t)}return e}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const F8=me();F8.registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",()=>100,D8);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Ew(n,e){return de(()=>ss(Ye(ne(n,n),e,!0)))}class Th extends jc{getConfig(){return{}}}class YA extends Th{constructor(e){super(),this.defaultMaxValue=2,this.defaultAxis=0,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return de(()=>{const t=Ew(e,this.axis),s=ar(t,0,this.maxValue);return ne(e,Ze(s,$e(Nn(),t)))})}getConfig(){return{maxValue:this.maxValue,axis:this.axis}}}YA.className="MaxNorm";Se(YA);class ZA extends Th{constructor(e){super(),this.defaultAxis=0,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return de(()=>Ze(e,$e(Nn(),Ew(e,this.axis))))}getConfig(){return{axis:this.axis}}}ZA.className="UnitNorm";Se(ZA);class JA extends Th{apply(e){return sl(e)}}JA.className="NonNeg";Se(JA);class ej extends Th{constructor(e){super(),this.defaultMinValue=0,this.defaultMaxValue=1,this.defaultRate=1,this.defaultAxis=0,this.minValue=e.minValue!=null?e.minValue:this.defaultMinValue,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.rate=e.rate!=null?e.rate:this.defaultRate,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return de(()=>{const t=Ew(e,this.axis),s=$e(ne(this.rate,ar(t,this.minValue,this.maxValue)),ne(1-this.rate,t));return ne(e,Ze(s,$e(Nn(),t)))})}getConfig(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}ej.className="MinMaxNorm";Se(ej);const pN={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function Tn(n){return yw(n)}function mN(n,e={}){return kh(n,Cr.getMap().classNameMap,e,"constraint")}function $n(n){if(n==null)return null;if(typeof n=="string"){const t={className:n in pN?pN[n]:n,config:{}};return mN(t)}else return n instanceof Th?n:mN(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */async function Ca(n){if(n==null)return;const e=[],t=[],s=[];for(const r in n){const i=n[r];if(typeof i!="number"){const o=i;e.push(o.data()),t.push(r),s.push(o)}}if(e.length>0){const r=await Promise.all(e);for(let i=0;i<r.length;++i)n[t[i]]=r[i][0];ct(s)}}function tj(n){if(n!=null)for(const e in n){const t=n[e];typeof t!="number"&&t.dispose()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var gN;(function(n){n[n.SILENT=0]="SILENT",n[n.VERBOSE=1]="VERBOSE"})(gN||(gN={}));const O8=125;class nd{constructor(){this.validationData=null}setParams(e){this.params=e}async onEpochBegin(e,t){}async onEpochEnd(e,t){}async onBatchBegin(e,t){}async onBatchEnd(e,t){}async onTrainBegin(e){}async onTrainEnd(e){}setModel(e){}}class _8{constructor(e,t=10){e==null&&(e=[]),this.callbacks=e,this.queueLength=t}append(e){this.callbacks.push(e)}setParams(e){for(const t of this.callbacks)t.setParams(e)}setModel(e){for(const t of this.callbacks)t.setModel(e)}async onEpochBegin(e,t){t==null&&(t={});for(const s of this.callbacks)await s.onEpochBegin(e,t)}async onEpochEnd(e,t){t==null&&(t={});for(const s of this.callbacks)await s.onEpochEnd(e,t)}async onBatchBegin(e,t){t==null&&(t={});for(const s of this.callbacks)await s.onBatchBegin(e,t)}async onBatchEnd(e,t){t==null&&(t={});for(const s of this.callbacks)await s.onBatchEnd(e,t)}async onTrainBegin(e){e==null&&(e={});for(const t of this.callbacks)await t.onTrainBegin(e)}async onTrainEnd(e){e==null&&(e={});for(const t of this.callbacks)await t.onTrainEnd(e)}}class z8 extends nd{constructor(){super()}async onEpochBegin(e){this.seen=0,this.totals={}}async onBatchEnd(e,t){t==null&&(t={});const s=t.size==null?0:t.size;this.seen+=s;for(const r in t){const i=t[r];if(typeof i=="number")this.totals.hasOwnProperty(r)||(this.totals[r]=0),this.totals[r]=this.totals[r]+i*s;else{let o;r in this.totals?o=this.totals[r]:this.totals[r]=0;const a=de(()=>$e(this.totals[r],ne(i,s)));this.totals[r]=a,o!=null&&o.dispose()}}}async onEpochEnd(e,t){if(t!=null)for(const s of this.params.metrics)this.totals[s]!=null&&(typeof this.totals[s]=="number"?t[s]=this.totals[s]/this.seen:de(()=>{const r=ne(Ze(1,this.seen),this.totals[s]);t[s]=r,this.totals[s].dispose(),ki(t[s])}))}}class B8 extends nd{async onTrainBegin(e){this.epoch=[],this.history={}}async onEpochEnd(e,t){t==null&&(t={}),this.epoch.push(e);for(const s in t)this.history[s]==null&&(this.history[s]=[]),this.history[s].push(t[s])}async syncData(){const e=[],t=[],s=[];for(const i in this.history){const o=this.history[i];for(let a=0;a<o.length;++a)if(typeof o[a]!="number"){const l=o[a];e.push(l.data()),t.push(i),s.push(a)}}const r=await Promise.all(e);for(let i=0;i<r.length;++i)this.history[t[i]][s[i]].dispose(),this.history[t[i]][s[i]]=r[i][0]}}class W8 extends nd{constructor(e,t){if(super(),this.currentEpoch=0,this.nowFunc=e.nowFunc,this.nextFrameFunc=e.nextFrameFunc||oA,this.yieldEvery=t||"auto",this.yieldEvery==="auto"&&(this.yieldEvery=O8),this.yieldEvery==="never"&&e.onYield!=null)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");lv(this.yieldEvery)&&(this.maybeWait=t8(this.maybeWait.bind(this),this.yieldEvery,this.nowFunc)),this.trainBegin=e.onTrainBegin,this.trainEnd=e.onTrainEnd,this.epochBegin=e.onEpochBegin,this.epochEnd=e.onEpochEnd,this.batchBegin=e.onBatchBegin,this.batchEnd=e.onBatchEnd,this.yield=e.onYield}async maybeWait(e,t,s){const r=[];this.yield!=null&&(await Ca(s),r.push(this.yield(e,t,s))),r.push(this.nextFrameFunc()),await Promise.all(r)}async onEpochBegin(e,t){this.currentEpoch=e,this.epochBegin!=null&&(await Ca(t),await this.epochBegin(e,t))}async onEpochEnd(e,t){const s=[];this.epochEnd!=null&&(await Ca(t),s.push(this.epochEnd(e,t))),this.yieldEvery==="epoch"&&s.push(this.nextFrameFunc()),await Promise.all(s)}async onBatchBegin(e,t){this.batchBegin!=null&&(await Ca(t),await this.batchBegin(e,t))}async onBatchEnd(e,t){const s=[];this.batchEnd!=null&&(await Ca(t),s.push(this.batchEnd(e,t))),this.yieldEvery==="batch"?s.push(this.nextFrameFunc()):lv(this.yieldEvery)&&s.push(this.maybeWait(this.currentEpoch,e,t)),await Promise.all(s)}async onTrainBegin(e){this.trainBegin!=null&&(await Ca(e),await this.trainBegin(e))}async onTrainEnd(e){this.trainEnd!=null&&(await Ca(e),await this.trainEnd(e))}}function nj(n,e){return n==null&&(n={}),n instanceof nd?[n]:Array.isArray(n)&&n[0]instanceof nd?n:jt(n).map(s=>new W8(s,e))}class br{constructor(){}static registerCallbackConstructor(e,t){V(e>=0&&Number.isInteger(e),()=>`Verbosity level is expected to be an integer >= 0, but got ${e}`),br.checkForDuplicate(t),br.constructors[e]==null&&(br.constructors[e]=[]),br.constructors[e].push(t)}static checkForDuplicate(e){for(const t in br.constructors)br.constructors[+t].forEach(r=>{if(r===e)throw new te("Duplicate callback constructor.")})}static clear(){br.constructors={}}static createCallbacks(e){const t=[];for(const s in br.constructors){const r=+s;e>=r&&t.push(...br.constructors[r])}return t.map(s=>new s)}}br.constructors={};function sj(n,e,t,s,r,i,o,a,l){const u=new B8,d=[new z8,...br.createCallbacks(e)];n!=null&&d.push(...n),d.push(u);const f=new _8(d);return f.setParams({epochs:t,initialEpoch:s,samples:r,steps:i,batchSize:o,verbose:e,doValidation:a,metrics:l}),{callbackList:f,history:u}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Ii(n,e={},t=!1){return kh(n,Cr.getMap().classNameMap,e,"layer",t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function im(n,e){return de(()=>{n.dtype!=="float32"&&(n=Fe(n,"float32"));const t=Ye(Sh(n),e,!0),s=Wg(t.shape,Nn()),r=ss(ta(t,s));return Ze(n,r)})}function Jg(n,e){return de(()=>wn(Sh(tt(e,n)),-1))}function Aw(n,e){return de(()=>wn(xs(tt(e,n)),-1))}function jw(n,e){return de(()=>{const t=tt(n,e),s=ar(xs(n),Nn(),Number.MAX_VALUE),r=xs(Ze(t,s));return ne(100,wn(r,-1))})}function V8(n,e){return de(()=>{const t=ar(e,Nn(),Number.MAX_VALUE),s=Ei($e(1,t)),r=ar(n,Nn(),Number.MAX_VALUE),i=Ei($e(1,r));return wn(Sh(tt(s,i)),-1)})}function U8(n,e){return de(()=>{const t=ta(0,tt(1,ne(n,e)));return wn(Sh(t),-1)})}function G8(n,e){return de(()=>{const t=ta(0,tt(1,ne(n,e)));return wn(t,-1)})}function H8(n,e){return de(()=>{const t=Ye(ne(n,e),-1),s=Yr(ne(tt(1,n),e),-1);return ta(0,$e(1,tt(s,t)))})}function q8(n,e){return de(()=>{const t=Math.log(2),s=tt(e,n),r=tt($e(s,mh(ne(-2,s))),t);return wn(r,-1)})}function sd(n,e,t=!1){return de(()=>{if(t)e=P1(e);else{const s=Ye(e,e.shape.length-1,!0);e=Ze(e,s)}return e=ar(e,Nn(),1-Nn()),fn(Ye(ne(Fe(n,"float32"),Ei(e)),e.shape.length-1))})}function om(n,e,t=!1){return de(()=>{const s=Fe(Gg(f8(n)),"int32");e=ar(e,Nn(),1-Nn());const r=e.shape,i=ie(TE(s,r[r.length-1]),r);return sd(i,e,t)})}function K8(n,e){if(!At(n.shape,e.shape))throw new te(`logits and labels must have the same shape, but got shapes ${JSON.stringify(n.shape)} and ${JSON.stringify(e.shape)}`);return de(()=>{const t=sl(e),s=fn(xs(e));return $e(tt(t,ne(e,n)),CE($i(s)))})}function ex(n,e){return de(()=>{let t;return t=ar(e,Nn(),1-Nn()),t=Ei(Ze(t,tt(1,t))),wn(K8(n,t),-1)})}function Q8(n,e){return de(()=>{const t=ar(n,Nn(),1),s=ar(e,Nn(),1);return Ye(ne(n,Ei(Ze(t,s))),-1)})}function X8(n,e){return de(()=>{const t=Ei($e(Nn(),e));return wn(tt(e,ne(n,t)),-1)})}function rj(n,e){return de(()=>{const t=im(n,-1),s=im(e,-1),r=ne(t,s);return fn(Ye(r,-1))})}const am={meanSquaredError:Jg,meanAbsoluteError:Aw,meanAbsolutePercentageError:jw,meanSquaredLogarithmicError:V8,squaredHinge:U8,hinge:G8,categoricalHinge:H8,logcosh:q8,categoricalCrossentropy:sd,sparseCategoricalCrossentropy:om,binaryCrossentropy:ex,kullbackLeiblerDivergence:Q8,poisson:X8,cosineProximity:rj};function w0(n){if(typeof n=="string"){if(n in am)return am[n];let e=`Unknown loss ${n}`;throw n.toLowerCase().includes("softmaxcrossentropy")&&(e=`Unknown loss ${n}. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy`),new te(e)}else return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function ij(n,e){return de(()=>{const t=ne(.5,$r(e)),s=Si(lr(e,t),n.dtype);return wn(Ti(n,s),-1)})}function oj(n,e){return de(()=>Si(Ti(Yu(n,-1),Yu(e,-1)),"float32"))}function Y8(n,e){return de(()=>Fe(Ye(to(Ti(n,1),Ti(e,1))),"float32"))}function Z8(n,e){return de(()=>Fe(Ye(to(Ti(n,0),Ti(e,1))),"float32"))}function J8(n,e){return de(()=>{const t=Y8(n,e),s=Z8(n,e),r=$e(t,s);return Fe(bs(lr(r,0),Ze(t,r),0),"float32")})}function eH(n,e){return ex(n,e)}function tH(n,e){return n.rank===e.rank&&(n=xh(n,[n.rank-1])),e=Yu(e,-1),e.dtype!==n.dtype&&(e=Fe(e,n.dtype)),Fe(Ti(n,e),"float32")}const nH=Jg,sH=Jg,rH=Aw,iH=Aw,oH=jw,aH=jw,aj=sd,lH=rj,lj=om,lm={binaryAccuracy:ij,categoricalAccuracy:oj,precision:J8,categoricalCrossentropy:aj,sparseCategoricalCrossentropy:lj,mse:nH,MSE:sH,mae:rH,MAE:iH,mape:oH,MAPE:aH,cosine:lH};function cH(n){if(typeof n=="string"&&n in lm)return lm[n];if(typeof n!="string"&&n!=null)return n;throw new te(`Unknown metric ${n}`)}function np(n){if(gi(n!==null,`Unknown LossOrMetricFn ${n}`),typeof n=="string")return n;{let e;for(const t of Object.keys(am))if(am[t]===n){e=t;break}if(e!==void 0)return e;for(const t of Object.keys(lm))if(lm[t]===n){e=t;break}return e!==void 0?e:n.name}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function uH(n){const e={Adagrad:()=>Do.adagrad(.01),Adadelta:()=>Do.adadelta(1,.95,Nn()),Adam:()=>Do.adam(.001,.9,.999,Nn()),Adamax:()=>Do.adamax(.002,.9,.999,Nn(),0),RMSProp:()=>Do.rmsprop(.001,.9,0,Nn()),SGD:()=>Do.sgd(.01)};if(e.adagrad=e.Adagrad,e.adadelta=e.Adadelta,e.adam=e.Adam,e.adamax=e.Adamax,e.rmsprop=e.RMSProp,e.sgd=e.SGD,n in e)return e[n]();throw new te(`Unknown Optimizer ${n}`)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const xN=1*1024*1024;function yN(n,e,t=!1){if(n==null||typeof n!="object"||Object.getPrototypeOf(n)!==Object.prototype||!Dv(n))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(t){const s=JSON.stringify(n);s.length>xN&&console.warn(`User-defined metadata of model "${e}" is too large in size (length=${s.length} when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= ${xN}.`)}}function Dv(n){if(n===null)return!0;if(typeof n=="object")if(Object.getPrototypeOf(n)===Object.prototype){const e=Object.keys(n);for(const t of e)if(typeof t!="string"||!Dv(n[t]))return!1;return!0}else if(Array.isArray(n)){for(const e of n)if(!Dv(e))return!1;return!0}else return!1;else{const e=typeof n;return e==="string"||e==="number"||e==="boolean"}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function dH(n,e,t,s=console.log){const r=fH(n),i=["Layer (type)","Input Shape","Output shape","Param #"];r?(e=e||90,t=t||[.32,.61,.89,1]):(e=e||115,t=t||[.24,.48,.7,.8,1]),t[t.length-1]<=1&&(t=t.map(d=>Math.floor(e*d)));let o;if(!r){i.push("Receives inputs"),o=[];for(const d in n.nodesByDepth)o.push(...n.nodesByDepth[d])}s("_".repeat(e)),cm(i,t,s),s("=".repeat(e));const a=n.layers;for(let d=0;d<a.length;++d)r?pH(a[d],t,s):mH(a[d],t,o,s),s((d===a.length-1?"=":"_").repeat(e));n.checkTrainableWeightsConsistency();const l=hH(n),u=nm(n.nonTrainableWeights);s(`Total params: ${l+u}`),s(`Trainable params: ${l}`),s(`Non-trainable params: ${u}`),s("_".repeat(e))}function hH(n){let e;return n.collectedTrainableWeights!=null?e=nm(n.collectedTrainableWeights):e=nm(n.trainableWeights),e}function fH(n){let e=!0;const t=[],s=[];for(const r in n.nodesByDepth)t.push(n.nodesByDepth[r]);for(const r of t){if(r.length>1||r.length===1&&r[0].inboundLayers.length>1){e=!1;break}s.push(...r)}if(e)for(const r of n.layers){let i=!1;for(const o of r.inboundNodes)if(s.indexOf(o)!==-1)if(i){e=!1;break}else i=!0;if(!e)break}return e}function cm(n,e,t=console.log){let s="";for(let r=0;r<n.length;++r)r>0&&(s=s.slice(0,s.length-1)+" "),s+=n[r],s=s.slice(0,e[r]),s+=" ".repeat(e[r]-s.length);t(s)}function pH(n,e,t){let s,r;try{r=n.inboundNodes.map(l=>JSON.stringify(l.inputShapes)).join(",")}catch{r="multiple"}try{s=JSON.stringify(n.outputShape)}catch{s="multiple"}const i=n.name,o=n.getClassName(),a=[`${i} (${o})`,r,s,n.countParams().toString()];cm(a,e,t)}function mH(n,e,t,s){let r,i;try{i=n.inboundNodes.map(f=>JSON.stringify(f.inputShapes)).join(",")}catch{i="multiple"}try{r=JSON.stringify(n.outputShape)}catch{r="multiple"}const o=[];for(const f of n.inboundNodes)if(!(t!=null&&t.length>0&&t.indexOf(f)===-1))for(let p=0;p<f.inboundLayers.length;++p){const g=f.inboundLayers[p].name,x=f.nodeIndices[p],y=f.tensorIndices[p];o.push(`${g}[${x}][${y}]`)}const a=n.name,l=n.getClassName(),u=o.length===0?"":o[0],d=[`${a} (${l})`,i,r,n.countParams().toString(),u];cm(d,e,s);for(let f=1;f<o.length;++f)cm(["","","","",o[f]],e,s)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function cj(n,e,t){return(n==="inboundNodes"||n==="outputLayers"||n==="inputLayers")&&e===0&&typeof t=="string"}function um(n,e){if(n===null)return null;if(typeof n=="string")return $a(n);if(typeof n=="number"||typeof n=="boolean")return n;if(n instanceof Array){const t=[],s=n.length;for(let r=0;r<s;++r){const i=n[r];cj(e,r,i)?t.push(i):t.push(um(i,e))}return t}else{const t={};for(const s of Object.keys(n)){const r=n[s];if(s==="name"&&typeof r=="string")t[s]=r;else{const i=$a(s);t[i]=um(r,i)}}return t}}function Pv(n,e){if(n==null)return null;if(typeof n=="string")return qi(n);if(typeof n=="number"||typeof n=="boolean")return n;if(n instanceof Array){const t=[],s=n.length;for(let r=0;r<s;++r){const i=n[r];cj(e,r,i)?t.push(i):t.push(Pv(i,e))}return t}else{const t={};for(const s of Object.keys(n)){const r=n[s],i=qi(s);(s==="name"||s==="className")&&typeof r=="string"?t[i]=r:t[i]=Pv(r,s)}return t}}/** @license See the LICENSE file. */const uj="4.22.0";/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const gH=n=>{const e=Object.keys(n);if(e.length===0)return!1;const t=e[0].split("/");return!isNaN(parseInt(t[t.length-1],10))};class Hr extends ft{constructor(e){if(super({}),this.containerNodes=new Set,this.name=e.name,this.name==null){const w=this.getClassName().toLowerCase();this.name=Xg(w)}if(this.supportsMasking=!1,this.trainable_=!0,Array.isArray(e.inputs)?this.inputs=e.inputs.slice():this.inputs=[e.inputs],Array.isArray(e.outputs)?this.outputs=e.outputs.slice():this.outputs=[e.outputs],Bo(this.inputs).length!==this.inputs.length)throw new te(`The list of inputs passed to the model is redundant. All inputs should only appear once. Found: ${this.inputs.map(w=>w.name)}`);Bo(this.outputs).length!==this.outputs.length&&console.warn(`The list of outputs passed to the model is redundant. All outputs should only appear once. Found: ${this.outputs.map(w=>w.name)}`),this.inputLayers=[],this.inputLayersNodeIndices=[],this.inputLayersTensorIndices=[],this.outputLayers=[],this.outputLayersNodeIndices=[],this.outputLayersTensorIndices=[],this.layers=[],this.internalContainerRefs=[];for(const w of this.outputs){const N=w.sourceLayer,C=w.nodeIndex,S=w.tensorIndex;this.outputLayers.push(N),this.outputLayersNodeIndices.push(C),this.outputLayersTensorIndices.push(S)}for(const w of this.inputs){const N=w.sourceLayer,C=w.nodeIndex,S=w.tensorIndex;gi(C===0,"input layer has >1 nodes"),gi(S===0,"input layer has >1 tensors"),this.inputLayers.push(N),this.inputLayersNodeIndices.push(C),this.inputLayersTensorIndices.push(S)}this.inputNames=[],this.outputNames=[],this.feedInputShapes=[],this.feedInputNames=[],this.feedOutputNames=[];for(let w=0;w<this.inputLayers.length;w++){const N=this.inputLayers[w];if(!(N instanceof Ih))throw new TypeError(`Input layers to a LayersModel must be InputLayer objects. Received inputs: ${e.inputs}. Input ${w} (0-based) originates from layer type ${N.getClassName()}.`);this.inputNames.push(N.name),this.feedInputShapes.push(N.batchInputShape),this.feedInputNames.push(N.name)}for(const w of this.outputLayers)this.outputNames.push(w.name);this.internalInputShapes=this.inputs.map(w=>w.shape),this.internalOutputShapes=this.outputs.map(w=>w.shape);const t={},s={},r={},i={},o={},a=[],l=(w,N,C,S,T,A)=>{(S==null||T==null||A==null)&&(S=w.sourceLayer,T=w.nodeIndex,A=w.tensorIndex);const E=S.inboundNodes[T];if(C.indexOf(E)!==-1)throw new Sr(`The tensor ${w.name} at layer "${S.name}" is part of a cycle.`);if(N.indexOf(E)!==-1)return;this.containerNodes.add(Hr.nodeKey(S,T)),S.id in o||(o[S.id]=Object.keys(o).length),C.indexOf(E)===-1&&C.push(E);const M=E.inboundLayers.length;for(let P=0;P<M;P++){const R=E.inputTensors[P],L=E.inboundLayers[P],_=E.nodeIndices[P],O=E.tensorIndices[P];l(R,N,C,L,_,O)}for(N.push(E);C.indexOf(E)>=0;)C.splice(C.indexOf(E),1);a.push(E)},u=[],d=[];for(const w of this.outputs)l(w,u,d);const f=a.slice().reverse();for(const w of f){s[w.id]=w,w.id in t||(t[w.id]=0);let N=t[w.id];const C=r[w.outboundLayer.id]==null?0:r[w.outboundLayer.id];N=Math.max(N,C),r[w.outboundLayer.id]=N,i[w.outboundLayer.id]=w.outboundLayer,t[w.id]=N;for(let S=0;S<w.inboundLayers.length;S++){const T=w.inboundLayers[S],A=w.nodeIndices[S],E=T.inboundNodes[A],M=t[E.id]==null?0:t[E.id];t[E.id]=Math.max(N+1,M),s[E.id]=E}}const p={};for(const w in t){const N=t[w];N in p||(p[N]=[]),p[N].push(s[w])}const g={};for(const w in r){const N=r[w];N in g||(g[N]=[]),g[N].push(i[w])}let x=Object.keys(g).map(w=>parseInt(w,10)).sort(Jf);this.layers=[];for(const w of x){const N=g[w];N.sort((C,S)=>{const T=o[C.id],A=o[S.id];return T<A?-1:T>A?1:0});for(const C of N)C instanceof Hr&&this.internalContainerRefs.push(C),this.layers.push(C)}this.layersByDepth=g,x=Object.keys(p).map(w=>parseInt(w,10)).sort(Jf);const y=this.inputs.slice(),b=[];for(const w of x)for(const N of p[w]){const C=N.outboundLayer;if(C!=null){for(const S of N.inputTensors)if(y.indexOf(S)===-1)throw new Sr(`Graph disconnected: cannot obtain value for tensor ${S} at layer "${C.name}". The following previous layers were accessed without issue: ${b}`);for(const S of N.outputTensors)y.push(S);b.push(C.name)}}this.nodesByDepth=p;const k=this.layers.map(w=>w.name);for(const w of k){const N=k.filter(C=>C===w).length;if(N!==1)throw new Sr(`The name "${w}" is used ${N} times in the model. All layer names should be unique. Layer names: `+JSON.stringify(k))}this.outboundNodes=[],this.inboundNodes=[],new Zg({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:this.inputs.map(w=>null),outputMasks:this.outputs.map(w=>null),inputShapes:this.inputs.map(w=>w.shape),outputShapes:this.outputs.map(w=>w.shape)}),this.built=!0,this._refCount=1}assertNotDisposed(){if(this._refCount===0)throw new Error(`Container '${this.name}' is already disposed.`)}dispose(){this.assertNotDisposed();const e={refCountAfterDispose:null,numDisposedVariables:0};if(--this._refCount===0){for(const t of this.layers)e.numDisposedVariables+=t.dispose().numDisposedVariables;for(const t of this.internalContainerRefs)e.numDisposedVariables+=t.dispose().numDisposedVariables}return e.refCountAfterDispose=this._refCount,e}get trainable(){return this.trainable_}set trainable(e){this.layers.forEach(t=>{t._trainableWeights.forEach(s=>s.trainable=e)}),this.trainable_=e}get trainableWeights(){if(this._trainableWeights.length>0)throw new te("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];let e=[];for(const t of this.layers)e=e.concat(t.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const t of this.layers)e.push(...t.nonTrainableWeights);if(!this.trainable){const t=[];for(const s of this.layers)t.push(...s.trainableWeights);return t.concat(e)}return e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}loadWeights(e,t=!0){const s={};let r=0;const i=gH(e);i&&this.parseWeights(e);for(const a of this.layers)for(const[l,u]of a.weights.entries()){const d=i?`${u.name.split("/").slice(0,-1).join("/")+"/"}${l}`:u.originalName;if(s[d]!=null)throw new te(`Duplicate weight name: ${d}`);s[d]=u,r++}const o=[];for(const a in e){let l=a;if(s[a]==null){const u=a.split("/");l=u.slice(0,-2).concat([u[u.length-1]]).join("/")}if(s[l]!=null)o.push([s[l],e[a]]);else if(t)throw new te(`Provided weight data has no target variable: ${a}`);delete s[l]}if(t){const a=[];for(const l in s)a.push(l);if(a.length>0)throw new te(`${a.length} of ${r} weights are not set: ${a}`)}$w(o)}parseWeights(e){for(const t in Object.keys(e)){const s=t.split("/"),r=["vars","layer_checkpoint_dependencies"],i=s.map(o=>o.startsWith("_")?o.slice(1):o).filter(o=>!r.includes(o)).join("/");i!==t&&(e[i]=e[t],delete e[t])}}updatedConfig(){const e=this.getConfig(),t={};return t.className=this.getClassName(),t.config=e,t.kerasVersion=`tfjs-layers ${uj}`,t.backend="TensorFlow.js",t}toJSON(e,t=!0){const s=Pv(this.updatedConfig());return t?JSON.stringify(s):s}call(e,t){return de(()=>{e=jt(e);const s=new Lo;for(let r=0;r<this.inputs.length;++r)s.add(this.inputs[r],e[r]);return Fu(this.outputs,s,t)})}computeMask(e,t){return de(()=>{e=jt(e);let s;return t==null?s=Xa(null,e.length):s=jt(t),this.runInternalGraph(e,s)[1]})}computeOutputShape(e){const t=tm(e);if(t.length!==this.inputLayers.length)throw new te(`Invalid inputShape argument ${e}: model has ${this.inputLayers.length} tensor inputs.`);const s={};for(let a=0;a<t.length;a++){const l=this.inputLayers[a],u=t[a],d=l.name+"_0_0";s[d]=u}const r=Object.keys(this.nodesByDepth).map(a=>parseInt(a,10)).sort(Jf);if(r.length>1)for(const a of r){const l=this.nodesByDepth[a];for(const u of l){const d=u.outboundLayer;if(this.inputLayers.map(y=>y.id).indexOf(d.id)!==-1)continue;const f=[];for(let y=0;y<u.inboundLayers.length;y++){const b=u.inboundLayers[y],k=u.nodeIndices[y],w=u.tensorIndices[y],N=`${b.name}_${k}_${w}`,C=s[N];f.push(C)}const p=d.computeOutputShape(As(f)),g=tm(p),x=d.inboundNodes.indexOf(u);for(let y=0;y<g.length;y++){const b=`${d.name}_${x}_${y}`;s[b]=g[y]}}}const i=[],o=[];for(let a=0;a<this.outputLayers.length;a++){const l=this.outputLayers[a],u=this.outputLayersNodeIndices[a],d=this.outputLayersTensorIndices[a],f=`${l.name}_${u}_${d}`;o.push(f)}for(let a=0;a<o.length;a++){const l=o[a];gi(l in s),i.push(s[l])}return As(i)}runInternalGraph(e,t){t==null&&(t=Xa(null,e.length));const s={};for(let l=0;l<this.inputs.length;++l){const u=this.inputs[l],d=e[l],f=t[l];s[u.id]=[d,f]}const r=Object.keys(this.nodesByDepth).map(l=>parseInt(l,10)).sort(Jf);for(const l of r){const u=this.nodesByDepth[l];for(const d of u){const f=d.outboundLayer,p=d.inputTensors,g=d.outputTensors,x=new Array;for(const y of p)y.id in s&&x.push(s[y.id]);if(x.length===p.length){let y={},b,k,w,N;if(d.callArgs!=null&&(y=d.callArgs),x.length===1){const[C,S]=x[0];y.mask==null&&(y.mask=S),w=jt(f.call(C,y)),N=jt(f.computeMask(C,S)),b=[C],k=[S]}else b=x.map(C=>C[0]),k=x.map(C=>C[1]),y.mask==null&&(y.mask=k),w=jt(f.call(b,y)),N=jt(f.computeMask(b,k));if(f.activityRegularizer)throw new at("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(let C=0;C<g.length;++C){const S=g[C],T=w[C],A=N[C];s[S.id]=[T,A]}}}}const i=[],o=[],a=[];for(const l of this.outputs){gi(l.id in s,`Could not compute output ${l.name} : ${l.id}`);const[u,d]=s[l.id];a.push(u.shape),i.push(u),o.push(d)}return[i,o,a]}buildNodeConversionMap(e){const t={};let s;for(const r of this.layers){s=r instanceof Hr?1:0;for(let i=0;i<r.inboundNodes.length;i++){const o=Hr.nodeKey(r,i);this.containerNodes.has(o)&&(t[o]=s,s+=1)}}return t}getLayer(e,t){if(t!=null)return this.findLayer(t);if(e==null)throw new te("Provide either a layer name or layer index");if(typeof e=="number")return this.findLayer(e);for(const s of this.layers)if(s.name===e)return s;throw new te(`No such layer: ${e}`)}findLayer(e){if(this.layers.length<=e)throw new te(`Was asked to retrieve layer at index ${e}, but model only has ${this.layers.length} layer(s).`);return this.layers[e]}calculateLosses(){return de(()=>{const e=[];for(const t of this.layers)for(let s=0;s<t.inboundNodes.length;++s){const r=Hr.nodeKey(t,s);this.containerNodes.has(r)&&e.push(...t.calculateLosses())}return e})}getConfig(){const e={name:this.name},t=this.buildNodeConversionMap(this.layers),s=[];for(const o of this.layers){const a=o.getClassName(),l=o.getConfig(),u=[];for(let f=0;f<o.inboundNodes.length;f++){const p=o.inboundNodes[f],g=Hr.nodeKey(o,f);let x={};if(this.containerNodes.has(g)){if(p.callArgs)try{JSON.stringify(p.callArgs),x=p.callArgs}catch{console.warn(`Layer ${o.name} was passed non-serializable keyword arguments: ${p.callArgs}. They will not be included in the serialized model (and thus will be missing at deserialization time).`),x={}}if(p.inboundLayers.length>0){const y=[];for(let b=0;b<p.inboundLayers.length;b++){const k=p.inboundLayers[b],w=p.nodeIndices[b],N=p.tensorIndices[b],C=Hr.nodeKey(k,w);let S=t[C];S==null&&(S=0),y.push([k.name,S,N,x])}u.push(y)}}}const d={};d.name=o.name,d.className=a,d.config=l,d.inboundNodes=u,s.push(d)}e.layers=s;const r=[];for(let o=0;o<this.inputLayers.length;o++){const a=this.inputLayers[o],l=this.inputLayersNodeIndices[o],u=Hr.nodeKey(a,l);if(!this.containerNodes.has(u))continue;let d=t[u];d==null&&(d=0);const f=this.inputLayersTensorIndices[o];r.push([a.name,d,f])}e.inputLayers=r;const i=[];for(let o=0;o<this.outputLayers.length;o++){const a=this.outputLayers[o],l=this.outputLayersNodeIndices[o],u=Hr.nodeKey(a,l);if(!this.containerNodes.has(u))continue;let d=t[u];d==null&&(d=0);const f=this.outputLayersTensorIndices[o];i.push([a.name,d,f])}return e.outputLayers=i,e}static fromConfig(e,t,s={},r=!1){const i={},o={};function a(b,k){b.name in o?o[b.name].push(k):o[b.name]=[k]}function l(b,k){const w=[];let N;for(const C of k){const S=C[0],T=C[1],A=C[2];if(N=C[3]==null?{}:C[3],!(S in i)){a(b,k);return}const E=i[S];if(E.inboundNodes.length<=T){a(b,k);return}const M=E.inboundNodes[T];w.push(M.outputTensors[A])}w.length>0&&b.apply(As(w),N)}function u(b){const k=b.name,w=Ii(b,t.customObjects!=null?t.customObjects:{});w.setFastWeightInitDuringBuild(r),i[k]=w,b.inboundNodes.forEach(C=>{if(!(C instanceof Array))throw new te(`Corrupted configuration, expected array for nodeData: ${C}`);a(w,C)})}const d=t.name,f=t.layers;for(const b of f)u(b);for(;!e8(o);)for(const b of f){const k=i[b.name];if(k.name in o){const w=o[k.name];delete o[k.name];for(const N of w)l(k,N)}}const p=[],g=[],x=t.inputLayers;for(const b of x){const k=b[0],w=b[1],N=b[2];gi(k in i);const S=i[k].inboundNodes[w].outputTensors;p.push(S[N])}const y=t.outputLayers;for(const b of y){const k=b[0],w=b[1],N=b[2];gi(k in i);const S=i[k].inboundNodes[w].outputTensors;g.push(S[N])}return new e({inputs:p,outputs:g,name:d})}get stateful(){if(this._stateful)throw new te("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(const e of this.layers)if(e.stateful)return!0;return!1}resetStates(){de(()=>{this.layers.forEach(e=>{e.stateful&&e.resetStates()})})}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function xH(n,e,t){const s=e.length;if(n==null||Array.isArray(n)&&n.length===0)return e.map(r=>null);if(s===1)return Array.isArray(n)&&n.length===1?n:typeof n=="object"&&e[0]in n?[n[e[0]]]:[n];if(Array.isArray(n)){if(n.length!==s)throw new Error(`Provided ${t} is an array of ${n.length} element(s), but the model has ${s} outputs. Make sure a set of weights is provided for each model output.`);return n}else if(typeof n=="object"&&Object.keys(n).length>0&&typeof n[Object.keys(n)[0]]=="object"){const r=[];return e.forEach(i=>{i in n?r.push(n[i]):r.push(null)}),r}else throw new Error(`The model has multiple (${s}) outputs, so ${t} must be either an array with ${s} elements or an object with ${e} keys. Provided ${t} not understood: ${JSON.stringify(n)}`)}function dj(n,e){return xH(n,e,"classWeight")}async function hj(n,e,t,s){if(t!=null){const r=de(()=>{if(n.shape.length===1)return Pa(n);if(n.shape.length===2){if(n.shape[1]>1)return Yu(n,1);if(n.shape[1]===1)return ie(n,[n.shape[0]]);throw new Error(`Encountered unexpected last-dimension size (${n.shape[1]}) during handling of class weights. The size is expected to be >= 1.`)}else throw new Error(`Unexpected rank of target (y) tensor (${n.rank}) during handling of class weights. The rank is expected to be 1 or 2.`)}),i=Array.from(await r.data());ct(r);const o=[];return i.forEach(a=>{if(t[a]==null)throw new Error(`classWeight must contain all classes in the training data. The class ${a} exists in the data but not in classWeight`);o.push(t[a])}),js(o,"float32")}else return null}function yH(n,e){return ne(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const vH=32;function fj(n,e){let t,s;const r=e;t=r.xs,s=r.ys,V(t!=null&&s!=null,()=>`A Dataset iterator for fitDataset() is expected to generate objects of the form \`{xs: xVal, ys: yVal}\`, where the two values may be \`tf.Tensor\`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates ${e}`);const i=vN("input",n.inputNames,t),o=vN("output",n.outputNames,s),a=i[0].shape[0];V(i.length===n.inputs.length,()=>`LayersModel has ${n.inputs.length} inputs, but the dataset provides ${i.length} inputs.  (Expected input keys: ${JSON.stringify(n.inputNames)})`),V(o.length===n.outputs.length,()=>`LayersModel has ${n.outputs.length} outputs, but the dataset provides ${o.length} outputs.  (Expected output keys: ${JSON.stringify(n.outputNames)})`);for(let l=0;l<i.length;l++)V(i[l].shape[0]===a,()=>`Batch size mismatch: input ${n.inputNames[l]} has ${i[l].shape[0]}; expected  ${a} based on input ${n.inputNames[0]}.`);for(let l=0;l<o.length;l++)V(o[l].shape[0]===a,()=>`Batch size mismatch: output ${n.outputNames[l]} has ${o[l].shape[0]}; expected  ${a} based on input ${n.inputNames[0]}.`);return{xs:i,ys:o}}function vN(n,e,t){if(t instanceof Sn)return[t];if(Array.isArray(t))return V(t.length===e.length,()=>`Received an array of ${t.length} Tensors, but expected ${e.length} to match the ${n} keys ${e}.`),t;{const s=[];for(const r of e){if(t[r]==null)throw new te(`The feature data generated by the dataset lacks the required ${n} key '${r}'.`);s.push(t[r])}return s}}function bH(n){if(n.length===3)throw new at("Validation with sample weights is not implemented yet.");return{xs:n[0],ys:n[1]}}async function wH(n,e,t){const s=t.batchesPerEpoch!=null;if(V(n.optimizer!=null,()=>"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."),V(t!=null,()=>"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."),V(t.epochs!=null&&t.epochs>0&&Number.isInteger(t.epochs),()=>`For fitDataset(), config.epochs is expected to be a positive integer, but got ${t.epochs}`),V(!s||t.batchesPerEpoch>0&&Number.isInteger(t.batchesPerEpoch),()=>`For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got ${t.batchesPerEpoch}`),V(t.validationSplit==null,()=>"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."),n.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");n.isTraining=!0;try{const r=t.validationData!=null;let i,o;if(r)if(bN(t.validationData))V(t.validationBatches==null||t.validationBatches>0&&Number.isInteger(t.validationBatches),()=>`For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got ${t.validationBatches}`);else{const b=bH(t.validationData);i=b.xs,o=b.ys}const a=n.makeTrainFunction(),l=n.getDedupedMetricsNames();let u;r?u=l.slice().concat(l.map(b=>"val_"+b)):u=l.slice();const d=nj(t.callbacks,t.yieldEvery),f=t.verbose==null?1:t.verbose,{callbackList:p,history:g}=sj(d,f,t.epochs,null,null,kH(e,t),null,r,u);p.setModel(n),n.history=g,await p.onTrainBegin(),n.stopTraining_=!1;let x=t.initialEpoch==null?0:t.initialEpoch,y=await e.iterator();for(;x<t.epochs;){const b={};await p.onEpochBegin(x);let k=0,w=0;for(s||(y=await e.iterator());!s||k<t.batchesPerEpoch;){const N=await y.next();if(s&&N.done){console.warn(`You provided \`batchesPerEpoch\` as ${t.batchesPerEpoch}, but your dataset iterator ran out of data after ${k} batches; interrupting training. Make sure that your dataset can generate at least \`batchesPerEpoch * epochs\` batches (in this case, ${t.batchesPerEpoch*t.epochs} batches). You may need to use the repeat() function when building your dataset.`);break}if(N.value!=null){const{xs:C,ys:S}=fj(n,N.value),T={};T.batch=w,T.size=C[0].shape[0],await p.onBatchBegin(w,T);const A=[];if(t.classWeight!=null){const P=dj(t.classWeight,n.outputNames);for(let R=0;R<P.length;++R)A.push(await hj(S[R],null,P[R]))}const E=C.concat(S).concat(A),M=a(E);ct(E);for(let P=0;P<l.length;++P){const R=l[P],L=M[P];T[R]=L,ki(L)}await p.onBatchEnd(w,T),tj(T),w++,k++}if(s?k>=t.batchesPerEpoch:N.done){if(r){let C;bN(t.validationData)?C=jt(await n.evaluateDataset(t.validationData,{batches:t.validationBatches})):C=jt(n.evaluate(i,o,{batchSize:t.validationBatchSize==null?vH:t.validationBatchSize,verbose:0}));for(let S=0;S<n.metricsNames.length;++S)b[`val_${n.metricsNames[S]}`]=C[S]}break}if(n.stopTraining_)break}if(await p.onEpochEnd(x,b),x++,n.stopTraining_)break}return await p.onTrainEnd(),await n.history.syncData(),n.history}finally{n.isTraining=!1}}function kH(n,e){let t=null;return e.batchesPerEpoch!=null?t=e.batchesPerEpoch:Number.isFinite(n.size)&&(t=n.size),t}function bN(n){return typeof n.iterator=="function"}function CH(n){return typeof n.next=="function"}async function SH(n,e,t){t=t||{};const s=t.batches!=null,r=n.testFunction;let i=[];if(t.verbose>0)throw new at("Verbose mode is not implemented yet.");V(!s||t.batches>0&&Number.isInteger(t.batches),()=>`Test loop expects \`batches\` to be a positive integer, but received ${JSON.stringify(t.batches)}`);const o=CH(e)?e:await e.iterator();let a=0,l=0;for(;!s||l<t.batches;){const u=await o.next();if(i=de(()=>{if(u.value){const{xs:d,ys:f}=fj(n,u.value),p=d.concat(f),g=de(()=>r(p));if(ct(p),l===0)for(let y=0;y<g.length;++y)i.push($t(0));const x=p[0].shape[0];for(let y=0;y<g.length;++y){const b=g[y],k=i[y];i[y]=de(()=>$e(i[y],ne(x,b))),l>0&&ct(k)}ct(g),a+=x,++l}return i}),u.done){s&&console.warn(`Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least \`batches\` batches (in this case, ${t.batches} batches). You may need to use the repeat() function when building your dataset.`);break}}for(let u=0;u<i.length;++u){const d=i[u];i[u]=Ze(i[u],a),ct(d)}return As(i)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function k0(n){V(n>0&&Number.isInteger(n),()=>`batchSize is required to be a positive integer, but got ${n}`)}function $u(n,e,t){return n==null?[null]:Array.isArray(n)?n.map(s=>La(s,e,t-e)):La(n,e,t-e)}function Mv(n,e){return de(()=>n==null?null:Array.isArray(n)?n.map(t=>Mv(t,e)):BA(n,e.dtype==="int32"?e:Fe(e,"int32")))}function C0(n,e){const t=[];let s=0,r=null;for(;s<n;)r=s+e,r>=n&&(r=n),t.push([s,r]),s=r;return t}function pj(n){const e=[];n instanceof Sn&&(n=[n]);for(let t=0;t<n.length;++t){const s=n[t];if(s.rank===1)e.push(Ch(s,1));else{if(s.rank===0)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");e.push(s)}}return e}function Ur(n,e){if(n==null)return;const t=[];if(e instanceof Sn)t.push(e.id);else if(Array.isArray(e))e.forEach(r=>t.push(r.id));else if(e!=null)for(const r in e){const i=e[r];t.push(i.id)}const s=[];if(n instanceof Sn)t.indexOf(n.id)===-1&&s.push(n);else if(Array.isArray(n))n.forEach(r=>{t.indexOf(r.id)===-1&&s.push(r)});else if(n!=null)for(const r in n){const i=n[r];t.indexOf(i.id)===-1&&s.push(i)}s.forEach(r=>{r.isDisposed||r.dispose()})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function NH(n){return n instanceof Sn}function Lv(n){return Array.isArray(n)}function wN(n){return!NH(n)&&!Lv(n)}function kN(n,e,t,s=!0,r=""){if(e==null||e.length===0){if(n!=null){let o=!1;if(Lv(n)&&n.length>0)o=!0;else if(wN(n)){for(const a in n)if(n.hasOwnProperty(a)){o=!0;break}}else o=!0;if(o)throw new te(`Error when checking model ${r} expected no data, but got ${n}`)}return[]}if(n==null)return e.map(o=>null);let i;if(wN(n)){n=n,i=[];for(const o of e){if(n[o]==null)throw new te(`No data provided for "${o}". Need data for each key in: ${e}`);i.push(n[o])}}else if(Lv(n)){if(n=n,n.length!==e.length)throw new te(`Error when checking model ${r}: the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see ${e.length} Tensor(s), but instead got the following list of Tensor(s): ${n}`);i=n}else{if(n=n,e.length>1)throw new te(`The model ${r} expects ${e.length} Tensor(s), but only received one Tensor. Found: Tensor with shape ${n.shape}`);i=[n]}if(i=pj(i),t!=null)for(let o=0;o<e.length;++o){if(t[o]==null)continue;const a=i[o];if(a.shape.length!==t[o].length)throw new te(`Error when checking ${r}: expected ${e[o]} to have ${t[o].length} dimension(s). but got array with shape ${a.shape}`);for(let l=0;l<t[o].length;++l){if(l===0&&!s)continue;const u=a.shape[l],d=t[o][l];if(d!=null&&d>=0&&u!==d)throw new te(`${r} expected a batch of elements where each example has shape [${t[o].slice(1,t[o].length)}] (i.e.,tensor shape [*,${t[o].slice(1,t[o].length)}]) but the ${r} received an input with ${a.shape[0]} examples, each with shape [${a.shape.slice(1,a.shape.length)}] (tensor shape [${a.shape}])`)}}return i}function IH(n,e,t){const s=Bo(n.map(i=>i.shape[0]));s.sort();const r=Bo(e.map(i=>i.shape[0]));if(r.sort(),s.length>1)throw new te(`All input Tensors (x) should have the same number of samples. Got array shapes: ${JSON.stringify(n.map(i=>i.shape))}`);if(r.length>1)throw new te(`All target Tensors (y) should have the same number of samples. Got array shapes: ${JSON.stringify(e.map(i=>i.shape))}`);if(s.length>0&&r.length>0&&!At(s,r))throw new te(`Input Tensors should have the same number of samples as target Tensors. Found ${s[0]} input sample(s) and ${r[0]} target sample(s).`)}function TH(n,e,t){const s=[Jg,ex,sd];for(let r=0;r<n.length;++r){const i=n[r],o=e[r],a=t[r];if(o!=null){if(o===sd&&i.shape[i.shape.length-1]===1)throw new te(`You are passing a target array of shape ${i.shape} while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].`);if(s.indexOf(o)!==-1){const l=i.shape.slice(1),u=a.slice(1);for(let d=0;d<l.length;++d){const f=l[d],p=u[d];if(p!=null&&f!==p)throw new te(`A target Tensor with shape ${i.shape} was passed for an output of shape ${a}, while using a loss function that expects targets to have the same shape as the output.`)}}}}}function CN(n,e,t,s=!0,r=""){let i;if(Array.isArray(n)){if(n.length!==e.length)throw new te(`Error when checking model ${r}: the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see ${e.length} Tensor(s), but instead got ${n.length} Tensors(s).`);i=n}else{if(e.length>1)throw new te(`The model expects ${e.length} ${r} Tensors, but only received one Tensor. Found: array with shape ${JSON.stringify(n.shape)}.`);i=[n]}if(t!=null)for(let o=0;o<e.length;++o){if(t[o]==null)continue;const a=i[o];if(a.shape.length!==t[o].length)throw new te(`Error when checking ${r}: expected ${e[o]} to have ${t[o].length} dimension(s), but got array with shape ${JSON.stringify(a.shape)}`);for(let l=0;l<t[o].length;++l){if(l===0&&!s)continue;const u=a.shape[l],d=t[o][l];if(d!=null&&d!==u)throw new te(`Error when checking ${r}: expected ${e[o]} to have shape ${JSON.stringify(t[o])} but got array with shape ${JSON.stringify(a.shape)}.`)}}}function $H(n,e){if(n==null||Array.isArray(n)&&n.length===0)return e.map(s=>[]);let t;if(typeof n=="string"||typeof n=="function")t=[n];else if(Array.isArray(n)||typeof n=="object")t=n;else throw new TypeError(`Type of metrics argument not understood. Expected an string,function, Array, or Object, found: ${n}`);if(Array.isArray(t))return e.map(s=>t);{const s=[];for(const r of e){let i=t.hasOwnProperty(r)?t[r]:[];Array.isArray(i)||(i=[i]),s.push(i)}return s}}const EH="layers-model";class Jl extends Hr{constructor(e){super(e),this.isTraining=!1}summary(e,t,s=console.log){if(!this.built)throw new te("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");dH(this,e,t,s)}compile(e){if(e.loss==null&&(e.loss=[]),this.loss=e.loss,typeof e.optimizer=="string")this.optimizer_=uH(e.optimizer),this.isOptimizerOwned=!0;else{if(!(e.optimizer instanceof sa))throw new te("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=e.optimizer,this.isOptimizerOwned=!1}let t=[];if(!Array.isArray(e.loss)&&typeof e.loss!="string"&&typeof e.loss!="function"){e.loss=e.loss;for(const o in e.loss)if(this.outputNames.indexOf(o)===-1)throw new te(`Unknown entry in loss dictionary: "${o}". Only expected the following keys: ${this.outputNames}`);for(const o of this.outputNames)e.loss[o]==null&&console.warn(`Output "${o}" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to ${o} during training`),t.push(w0(e.loss[o]))}else if(Array.isArray(e.loss)){if(e.loss.length!==this.outputs.length)throw new te(`When passing an Array as loss, it should have one entry per model output. The model has ${this.outputs.length} output(s), but you passed loss=${e.loss}.`);t=e.loss.map(a=>w0(a))}else{const o=w0(e.loss);this.outputs.forEach(a=>{t.push(o)})}this.lossFunctions=t,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(let o=0;o<this.outputs.length;++o){const a=this.internalOutputShapes[o],l=this.outputNames[o];this.feedOutputNames.push(l),this.feedOutputShapes.push(a),this.feedLossFns.push(this.lossFunctions[o])}const s=[];this.metrics=e.metrics,this.metricsNames=["loss"],this.metricsTensors=[],Ma("loss",()=>{for(let o=0;o<this.outputs.length;++o){if(s.indexOf(o)!==-1)continue;const a=this.lossFunctions[o];this.outputs.length>1&&(this.metricsTensors.push([a,o]),this.metricsNames.push(this.outputNames[o]+"_loss"))}});const r=$H(e.metrics,this.outputNames),i=(o,a,l)=>{this.outputNames.length>1&&(a=this.outputNames[o]+"_"+a),this.metricsNames.push(a),this.metricsTensors.push([l,o])};Ma("metric",()=>{for(let o=0;o<this.outputs.length;++o){if(s.indexOf(o)!==-1)continue;const a=r[o];(u=>{let f,p,g;for(const x of u){if(typeof x=="string"&&["accuracy","acc","crossentropy","ce"].indexOf(x)!==-1){const b=this.internalOutputShapes[o];b[b.length-1]===1||this.lossFunctions[o]===ex?["accuracy","acc"].indexOf(x)!==-1?p=ij:["crossentropy","ce"].indexOf(x)!==-1&&(p=eH):this.lossFunctions[o]===om?["accuracy","acc"].indexOf(x)!==-1?p=tH:["crossentropy","ce"].indexOf(x)!==-1&&(p=lj):["accuracy","acc"].indexOf(x)!==-1?p=oj:["crossentropy","ce"].indexOf(x)!==-1&&(p=aj);let k;["accuracy","acc"].indexOf(x)!==-1?k="acc":["crossentropy","ce"].indexOf(x)!==-1&&(k="ce"),g=p,f=""+k}else g=cH(x),f=""+np(x);let y;Ma(f,()=>{y=g}),i(o,f,y)}})(a)}}),this.collectedTrainableWeights=this.trainableWeights}checkTrainableWeightsConsistency(){this.collectedTrainableWeights!=null&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}evaluate(e,t,s={}){const r=s.batchSize==null?32:s.batchSize;k0(r);const o=this.standardizeUserDataXY(e,t,!0,r);try{const a=o[0].concat(o[1]);this.makeTestFunction();const l=this.testFunction,u=this.testLoop(l,a,r,s.verbose,s.steps);return As(u)}finally{Ur(o[0],e),Ur(o[1],t)}}async evaluateDataset(e,t){return this.makeTestFunction(),SH(this,e,t)}checkNumSamples(e,t,s,r="steps"){let i;if(s!=null){if(i=null,t!=null)throw new te(`If ${r} is set, batchSize must be null or undefined.Got batchSize = ${t}`)}else if(e!=null)Array.isArray(e)?i=e[0].shape[0]:i=e.shape[0];else throw new te(`Either the input data should have a defined shape, or ${r} shoud be specified.`);return i}execute(e,t){if(Array.isArray(t)&&t.length===0)throw new te("`outputs` is an empty Array, which is not allowed.");const s=Array.isArray(t),r=s?t:[t],i=this.retrieveSymbolicTensors(r),o=new Lo;if(e instanceof Sn&&(e=[e]),Array.isArray(e)){if(e.length!==this.inputs.length)throw new te(`The number of inputs provided (${e.length}) does not match the number of inputs of this model (${this.inputs.length}).`);for(let l=0;l<this.inputs.length;++l)o.add(this.inputs[l],e[l])}else for(const l of this.inputs){const u=e[l.name];if(u==null)throw new te(`No value is provided for the model's input ${l.name}`);o.add(l,u)}const a=Fu(i,o);return s?a:a[0]}retrieveSymbolicTensors(e){const t=Xa(null,e.length);let s=e.length;for(const r of this.layers){const i=Array.isArray(r.output)?r.output:[r.output],o=i.map(a=>a.name);for(let a=0;a<e.length;++a){const l=o.indexOf(e[a]);if(l!==-1&&(t[a]=i[l],s--),s===0)break}if(s===0)break}if(s>0){const r=[];throw t.forEach((i,o)=>{i==null&&r.push(e[o])}),new te(`Cannot find SymbolicTensors for output name(s): ${JSON.stringify(r)}`)}return t}predictLoop(e,t=32,s=!1){return de(()=>{const r=this.checkNumSamples(e);if(s)throw new at("Verbose predictLoop() is not implemented yet.");const i=C0(r,t),o=this.outputs.map(a=>[]);for(let a=0;a<i.length;++a)de(()=>{const u=i[a][0],d=i[a][1],f=$u(e,u,d),p=[];if(Array.isArray(f))for(let x=0;x<f.length;++x)p.push({key:this.inputs[x],value:f[x]});else p.push({key:this.inputs[0],value:f});const g=new Lo(p);return Fu(this.outputs,g)}).forEach((u,d)=>o[d].push(u));return As(o.map(a=>Rs(a,0)))})}predict(e,t={}){const s=pj(e);CN(s,this.inputNames,this.feedInputShapes,!1);try{const r=t.batchSize==null?32:t.batchSize;return k0(r),this.predictLoop(s,r)}finally{Ur(s,e)}}predictOnBatch(e){CN(e,this.inputNames,this.feedInputShapes,!0);const t=(Array.isArray(e)?e[0]:e).shape[0];return this.predictLoop(e,t)}standardizeUserDataXY(e,t,s=!0,r){if(this.optimizer_==null)throw new Sr("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");const i=[];for(let o=0;o<this.feedOutputShapes.length;++o){const a=this.feedOutputShapes[o];this.feedLossFns[o]===om?i.push(a.slice(0,a.length-1).concat([1])):i.push(a)}if(e=kN(e,this.feedInputNames,this.feedInputShapes,!1,"input"),t=kN(t,this.feedOutputNames,i,!1,"target"),IH(e,t),TH(t,this.feedLossFns,this.feedOutputShapes),this.stateful&&r!=null&&r>0&&e[0].shape[0]%r!==0)throw new te(`In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size ${r}. Found: ${e[0].shape[0]} sample(s).`);return[e,t]}async standardizeUserData(e,t,s,r,i=!0,o){const[a,l]=this.standardizeUserDataXY(e,t,i,o);if(s!=null)throw new Error("sample weight is not supported yet.");let u=null;if(r!=null){const d=dj(r,this.outputNames);u=[];for(let f=0;f<d.length;++f)u.push(await hj(l[f],null,d[f]))}return[a,l,u]}testLoop(e,t,s,r=0,i){return de(()=>{const o=this.checkNumSamples(t,s,i,"steps"),a=[];if(r>0)throw new at("Verbose mode is not implemented yet.");if(i!=null)throw new at("steps mode in testLoop() is not implemented yet");{const l=C0(o,s),u=js(ni(0,o));for(let d=0;d<l.length;++d){const f=l[d][0],p=l[d][1],g=La(u,f,p-f),x=Mv(t,g),y=e(x);if(d===0)for(let b=0;b<y.length;++b)a.push($t(0));for(let b=0;b<y.length;++b){const k=y[b];a[b]=$e(a[b],ne(p-f,k))}}for(let d=0;d<a.length;++d)a[d]=Ze(a[d],o)}return a})}getDedupedMetricsNames(){const e=this.metricsNames,t=[];for(let s=0;s<e.length;++s){const r=e[s];let i=r;if(aN(e,r)>1){const o=aN(e.slice(0,s),r);i+=`_${o}`}t.push(i)}return t}makeTrainFunction(){return e=>{const t=[],s=e.slice(0,this.inputs.length),r=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),i=e.slice(this.inputs.length+this.outputs.length,this.inputs.length+this.outputs.length*2),o=[],a=()=>{const f=[];for(let y=0;y<this.inputs.length;++y)f.push({key:this.inputs[y],value:s[y]});const p=new Lo(f),g=Fu(this.outputs,p,{training:!0});let x;for(let y=0;y<this.lossFunctions.length;++y){const b=this.lossFunctions[y];let k=b(r[y],g[y]);i[y]!=null&&(k=yH(k,i[y]));const w=wn(k);t.push(w),y===0?x=k:x=$e(x,k)}for(let y=0;y<this.metricsTensors.length;++y){let b;if(this.outputs.length>1&&y<this.outputs.length)b=t[y];else{const k=this.metricsTensors[y][0],w=this.metricsTensors[y][1];b=wn(k(r[w],g[w]))}ki(b),o.push(b)}return x=wn(x),this.calculateLosses().forEach(y=>{x=$e(x,y)}),x},l=this.collectedTrainableWeights.map(f=>f.read());return[this.optimizer_.minimize(a,!0,l)].concat(o)}}makeTestFunction(){this.testFunction=e=>de(()=>{const t=[];let s;const r=e.slice(0,this.inputs.length),i=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),o=[];for(let u=0;u<this.inputs.length;++u)o.push({key:this.inputs[u],value:r[u]});const a=new Lo(o),l=Fu(this.outputs,a);for(let u=0;u<this.lossFunctions.length;++u){const d=this.lossFunctions[u],f=wn(d(i[u],l[u]));u===0?s=f:s=$e(s,f),t.push(s)}for(let u=0;u<this.metricsTensors.length;++u){const d=this.metricsTensors[u][0],f=this.metricsTensors[u][1],p=wn(d(i[f],l[f]));t.push(p)}return t})}async fit(e,t,s={}){if(this.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");this.isTraining=!0;let r,i,o,a,l,u,d,f,p;try{const g=s.batchSize==null?32:s.batchSize;k0(g);const y=await this.standardizeUserData(e,t,s.sampleWeight,s.classWeight,!1,g);r=y[0],i=y[1],p=y[2];let b=!1,k;if(s.validationData!=null&&s.validationData.length>0){if(b=!0,s.validationData.length===2)l=s.validationData[0],u=s.validationData[1];else throw s.validationData.length===3?new at("validationData including sample weights is not supported yet."):new te(`When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; ${s.validationData} is invalid.`);const P=await this.standardizeUserData(l,u,null,null,!0,g);d=P[0],f=P[1],k=d.concat(f)}else if(s.validationSplit!=null&&s.validationSplit>0&&s.validationSplit<1){b=!0;const M=Math.floor(r[0].shape[0]*(1-s.validationSplit)),P=r[0].shape[0];d=$u(r,M,P),o=r,r=$u(r,0,M),f=$u(i,M,P),a=i,i=$u(i,0,M),k=d.concat(f)}else s.validationSteps!=null&&(b=!0);const w=r.concat(i).concat(p);this.checkTrainableWeightsConsistency();const N=this.makeTrainFunction(),C=this.getDedupedMetricsNames();let S,T;b?(this.makeTestFunction(),S=this.testFunction,T=C.slice().concat(C.map(M=>"val_"+M))):(S=null,k=[],T=C.slice());const A=nj(s.callbacks,s.yieldEvery);return await this.fitLoop(N,w,C,g,s.epochs,s.verbose,A,S,k,s.shuffle,T,s.initialEpoch,null,null)}finally{this.isTraining=!1,Ur(r,e),Ur(i,t),Ur(o,e),Ur(a,t),Ur(d,l),Ur(f,u),p!=null&&ct(p)}}async fitLoop(e,t,s,r,i,o,a,l,u,d,f,p,g,x){r==null&&(r=32),i==null&&(i=1),d==null&&(d=!0),p==null&&(p=0);let y=!1;if(l!=null&&u!=null&&(y=!0),x!=null&&(y=!0,g==null))throw new te("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");const b=this.checkNumSamples(t,r,g,"steps_per_epoch");let k;b!=null&&(k=ni(0,b)),o==null&&(o=1);const{callbackList:w,history:N}=sj(a,o,i,p,b,g,r,y,f);w.setModel(this),this.history=N,await w.onTrainBegin(),this.stopTraining_=!1;for(let C=p;C<i;++C){await w.onEpochBegin(C);const S={};if(g!=null)throw new at("stepsPerEpoch mode is not implemented yet.");{if(d==="batch")throw new at("batch shuffling is not implemneted yet");d&&HO(k);const T=js(k),A=C0(b,r);for(let E=0;E<A.length;++E){const M={};if(await w.onBatchBegin(E,M),de(()=>{const P=A[E][0],R=A[E][1],L=La(T,P,R-P);M.batch=E,M.size=R-P;const _=Mv(t,L),O=e(_);for(let U=0;U<s.length;++U){const W=s[U],H=O[U];M[W]=H,ki(H)}if(E===A.length-1&&y){const U=this.testLoop(l,u,r);for(let W=0;W<s.length;++W){const H=s[W],G=U[W];ki(G),S["val_"+H]=G}}}),await w.onBatchEnd(E,M),tj(M),this.stopTraining_)break}T.dispose()}if(await w.onEpochEnd(C,S),this.stopTraining_)break}return await w.onTrainEnd(),await this.history.syncData(),this.history}async fitDataset(e,t){return wH(this,e,t)}async trainOnBatch(e,t){const s=await this.standardizeUserData(e,t),r=s[0],i=s[1],a=this.makeTrainFunction()(r.concat(i)),l=[];for(const u of a){const d=await u.data();l.push(d[0])}return ct(a),Ur(s[0],e),Ur(s[1],t),As(l)}getNamedWeights(e){const t=[],s=e!=null&&e.trainableOnly,r=s?this.trainableWeights:this.weights,i=this.getWeights(s);for(let o=0;o<r.length;++o)s&&!r[o].trainable||t.push({name:r[o].originalName,tensor:i[o]});return t}set stopTraining(e){this.stopTraining_=e}get stopTraining(){return this.stopTraining_}get optimizer(){return this.optimizer_}set optimizer(e){this.optimizer_!==e&&(this.optimizer_=e,this.isOptimizerOwned=!1)}dispose(){const e=super.dispose();if(e.refCountAfterDispose===0&&this.optimizer!=null&&this.isOptimizerOwned){const t=PS().numTensors;this.optimizer_.dispose(),e.numDisposedVariables+=t-PS().numTensors}return e}getLossIdentifiers(){let e;if(typeof this.loss=="string")e=qi(this.loss);else if(Array.isArray(this.loss)){for(const t of this.loss)if(typeof t!="string")throw new Error("Serialization of non-string loss is not supported.");e=this.loss.map(t=>qi(t))}else{const t=Object.keys(this.loss);e={};const s=this.loss;for(const r of t)if(typeof s[r]=="string")e[r]=qi(s[r]);else throw new Error("Serialization of non-string loss is not supported.")}return e}getMetricIdentifiers(){if(typeof this.metrics=="string"||typeof this.metrics=="function")return[qi(np(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(e=>qi(np(e)));{const e={};for(const t in this.metrics)e[t]=qi(np(this.metrics[t]));return e}}getTrainingConfig(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}loadTrainingConfig(e){if(e.weighted_metrics!=null)throw new Error("Loading weight_metrics is not supported yet.");if(e.loss_weights!=null)throw new Error("Loading loss_weights is not supported yet.");if(e.sample_weight_mode!=null)throw new Error("Loading sample_weight_mode is not supported yet.");const t=um(e.optimizer_config),s=Ii(t);let r;if(typeof e.loss=="string")r=$a(e.loss);else if(Array.isArray(e.loss))r=e.loss.map(o=>$a(o));else if(e.loss!=null){r={};for(const o in e.loss)r[o]=$a(e.loss[o])}let i;if(Array.isArray(e.metrics))i=e.metrics.map(o=>$a(o));else if(e.metrics!=null){i={};for(const o in e.metrics)i[o]=$a(e.metrics[o])}this.compile({loss:r,metrics:i,optimizer:s})}async save(e,t){if(typeof e=="string"){const u=Y_(e);if(u.length===0)throw new te(`Cannot find any save handlers for URL '${e}'`);if(u.length>1)throw new te(`Found more than one (${u.length}) save handlers for URL '${e}'`);e=u[0]}if(e.save==null)throw new te("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");const s=await MS(this.getNamedWeights(t)),a={modelTopology:this.toJSON(null,!1),format:EH,generatedBy:`TensorFlow.js tfjs-layers v${uj}`,convertedBy:null};if((t==null?!1:t.includeOptimizer)&&this.optimizer!=null){a.trainingConfig=this.getTrainingConfig();const u="optimizer",{data:d,specs:f}=await MS(await this.optimizer.getWeights(),u);s.specs.push(...f),s.data=V_([s.data,d])}return this.userDefinedMetadata!=null&&(yN(this.userDefinedMetadata,this.name,!0),a.userDefinedMetadata=this.userDefinedMetadata),a.weightData=s.data,a.weightSpecs=s.specs,e.save(a)}setUserDefinedMetadata(e){yN(e,this.name),this.userDefinedMetadata=e}getUserDefinedMetadata(){return this.userDefinedMetadata}}Jl.className="Model";Se(Jl);class mj extends Jl{}mj.className="Functional";Se(mj);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */async function AH(n,e){if(e==null&&(e={}),typeof n=="string"){const t=Z_(n,e);if(t.length===0)t.push(F6(n,e));else if(t.length>1)throw new te(`Found more than one (${t.length}) load handlers for URL '${n}'`);n=t[0]}return jH(n,void 0,e)}async function jH(n,e,t){if(t==null&&(t={}),n.load==null)throw new te("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");const s=await n.load();let r=s.modelTopology;r.model_config!=null&&(r=r.model_config);const i=t.strict==null?!0:t.strict,o=s.weightData!=null&&s.weightSpecs!=null&&i,a=Ii(um(r),e,o),l=s.trainingConfig;if(l!=null&&a.loadTrainingConfig(l),s.userDefinedMetadata!=null&&a.setUserDefinedMetadata(s.userDefinedMetadata),s.weightData!=null){if(s.weightSpecs==null)throw new te("LayersModel artifacts contains weight data, but not weight specs. Therefore loading of weights cannot proceed.");const{modelWeights:u,optimizerWeights:d}=RH(s.weightData,s.weightSpecs);a.loadWeights(u,i),a.optimizer!=null&&d.length>0&&await a.optimizer.setWeights(d),ct(u),ct(d.map(f=>f.tensor))}return a}function RH(n,e){const t=F_(n,e),s={},r=[];return e.forEach(i=>{i.group==="optimizer"?r.push({name:i.name,tensor:t[i.name]}):s[i.name]=t[i.name]}),{modelWeights:s,optimizerWeights:r}}class hc extends Jl{constructor(e){if(super({inputs:[],outputs:[]}),e=e||{},this.trainable=!0,this.built=!1,this.name=e.name!=null?e.name:Xg("sequential_"),e.layers!=null)for(const t of e.layers)this.add(t)}checkShape(e){if(e.inboundNodes[0].outputTensors[0].shape.some(s=>s<0))throw new te(`Negative dimension size caused by adding layer ${e.name} with input shape [${e.inboundNodes[0].inputTensors[0].shape}]`)}add(e){const t=e instanceof hc||e instanceof Jl;let s;if(t){if(s=e,s.outputs.length!==1)throw new te("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(s.inputs.length!==1)throw new te("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(this.outputs.length===0){if(e.inboundNodes.length===0){if(e.batchInputShape==null)throw new te("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");const r=j8({batchShape:e.batchInputShape,dtype:e.dtype,name:e.name+"_input"});e.apply(r)}if(t)this.outputs=s.outputs,this.inputs=s.inputs;else{if(e.inboundNodes.length!==1)throw new te(`A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer ${e.name} which has ${e.inboundNodes.length} pre-existing inbound connections.`);if(e.inboundNodes[0].outputTensors.length!==1)throw new te("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[e.inboundNodes[0].outputTensors[0]],this.inputs=XA(this.outputs[0])}this.inboundNodes=[],new Zg({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:Xa(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(r=>r.shape),outputShapes:this.outputs[0].shape})}else{const r=e.apply(this.outputs[0]);if(Array.isArray(r))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[r],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(e),this.built=!1}pop(){if(this.layers.length===0)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),this.layers.length===0)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{const e=this.layers.length-1;this.layers[e].outboundNodes=[],this.outputs=[this.layers[e].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}call(e,t){return this.model==null&&this.build(),this.model.call(e,t)}build(e){if(Ct(e),this.inputs.length===0||this.outputs.length===0)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new Jl({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}countParams(){return this.built||this.build(),super.countParams()}summary(e,t,s=console.log){this.built||this.build(),super.summary(e,t,s)}setWeights(e){this.model==null&&this.build(),this.model.setWeights(e)}evaluate(e,t,s={}){if(!this.built)throw new Sr("The model needs to be compiled before being used.");return this.model.evaluate(e,t,s)}async evaluateDataset(e,t){if(!this.built)throw new Sr("The model needs to be compiled before being used.");return this.model.evaluateDataset(e,t)}predict(e,t={}){return this.model==null&&this.build(),this.model.predict(e,t)}predictOnBatch(e){return this.model==null&&this.build(),this.model.predictOnBatch(e)}compile(e){this.build(),this.model.compile(e),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}get optimizer(){return this.model==null?void 0:this.model.optimizer}set optimizer(e){this.model.optimizer=e}async fit(e,t,s={}){if(!this.built)throw new Sr("The model needs to be compiled before being used.");return this.model.fit(e,t,s)}async fitDataset(e,t){if(!this.built)throw new Sr("The model needs to be compiled before being used.");return this.model.fitDataset(e,t)}async trainOnBatch(e,t){return this.model.trainOnBatch(e,t)}static fromConfig(e,t,s={},r=!1){let i,o={};if(t instanceof Array){if(t[0].className==null||t[0].className==="Merge")throw new te("Legacy serialization format not supported yet.");i=t}else V(t.layers!=null,()=>"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."),i=t.layers,delete t.layers,o=t;const a=new e(o);if(!(a instanceof hc))throw new at(`Sequential.fromConfig called on non-Sequential input: ${a}`);for(const l of i){const d=Ii(l,void 0,r);r&&d.setFastWeightInitDuringBuild(!0),a.add(d)}return a}set stopTraining(e){if(this.model==null)throw new te("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=e}get stopTraining(){if(this.model==null)throw new te("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}getConfig(){const e=[];for(const t of this.layers){const s={};s.className=t.getClassName(),s.config=t.getConfig(),e.push(s)}return{name:this.name,layers:e}}}hc.className="Sequential";Se(hc);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function DH(n){return new hc(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let is=class extends jc{getConfig(){return{}}};class gj extends is{apply(e,t=1){return m8(e,t)}}gj.className="elu";Se(gj);class xj extends is{apply(e){return RE(e)}}xj.className="selu";Se(xj);class yj extends is{apply(e){return sl(e)}}yj.className="relu";Se(yj);class vj extends is{apply(e){return de(()=>ed(6,sl(e)))}}vj.className="relu6";Se(vj);class bj extends is{apply(e){return e}}bj.className="linear";Se(bj);class wj extends is{apply(e){return $c(e)}}wj.className="sigmoid";Se(wj);class kj extends is{apply(e){return x8(e)}}kj.className="hardSigmoid";Se(kj);class Cj extends is{apply(e){return mh(e)}}Cj.className="softplus";Se(Cj);class Sj extends is{apply(e){return g8(e)}}Sj.className="softsign";Se(Sj);class Nj extends is{apply(e){return zg(e)}}Nj.className="tanh";Se(Nj);let Rw=class extends is{apply(e,t=-1){return P1(e,t)}};Rw.className="softmax";Se(Rw);class Ij extends is{apply(e,t=-1){return SE(e,t)}}Ij.className="logSoftmax";Se(Ij);class Tj extends is{apply(e){return de(()=>de(()=>{const t=Math.sqrt(2),s=ne(.5,$e(1,vE(Ze(e,t))));return ne(e,s)}))}}Tj.className="gelu";Se(Tj);class $j extends is{apply(e){return de(()=>ne(.5,ne(e,$e(1,zg(ne(ss(Ze(2,Math.PI)),$e(e,ne(.044715,qa(e,3)))))))))}}$j.className="gelu_new";Se($j);class Ej extends is{apply(e){return de(()=>ne(e,zg(mh(e))))}}Ej.className="mish";Se(Ej);class Aj extends is{apply(e,t=1){return de(()=>ne($c(ne(e,t)),e))}}Aj.className="swish";Se(Aj);function Ho(n){return n.getClassName()}function S0(n,e={}){return kh(n,Cr.getMap().classNameMap,e,"activation")}function qo(n){if(n==null){const e={};return e.className="linear",e.config={},S0(e)}if(typeof n=="string"){const e={};return e.className=n,e.config={},S0(e)}else return n instanceof is?n:S0(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function PH(n){if(n!=null&&typeof n!="object")throw new Error(`Argument to L1L2 regularizer's constructor is expected to be an object, but received: ${n}`)}class jj extends jc{}class Rj extends jj{constructor(e){super(),PH(e),this.l1=e==null||e.l1==null?.01:e.l1,this.l2=e==null||e.l2==null?.01:e.l2,this.hasL1=this.l1!==0,this.hasL2=this.l2!==0}apply(e){return de(()=>{let t=On([1]);return this.hasL1&&(t=$e(t,Ye(ne(this.l1,xs(e))))),this.hasL2&&(t=$e(t,Ye(ne(this.l2,Sh(e))))),ie(t,[])})}getConfig(){return{l1:this.l1,l2:this.l2}}static fromConfig(e,t){return new e({l1:t.l1,l2:t.l2})}}Rj.className="L1L2";Se(Rj);const SN={l1l2:"L1L2"};function Lt(n){return yw(n)}function NN(n,e={}){return kh(n,Cr.getMap().classNameMap,e,"regularizer")}function Qt(n){if(n==null)return null;if(typeof n=="string"){const t={className:n in SN?SN[n]:n,config:{}};return NN(t)}else return n instanceof jj?n:NN(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Dj extends ft{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null&&(this.maxValue=e.maxValue)}call(e,t){e=nt(e);let s=sl(e);return this.maxValue!=null&&(s=ar(s,0,this.maxValue)),s}computeOutputShape(e){return e}getConfig(){const e={maxValue:this.maxValue},t=super.getConfig();return Object.assign(e,t),e}}Dj.className="ReLU";Se(Dj);class Pj extends ft{constructor(e){super(e??{}),this.DEFAULT_ALPHA=.3,e==null&&(e={}),this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,t){const s=nt(e);return S1(s,this.alpha)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},t=super.getConfig();return Object.assign(e,t),e}}Pj.className="LeakyReLU";Se(Pj);class Mj extends ft{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA_INITIALIZER="zeros",e==null&&(e={}),this.supportsMasking=!0,this.alphaInitializer=Kt(e.alphaInitializer||this.DEFAULT_ALPHA_INITIALIZER),this.alphaRegularizer=Qt(e.alphaRegularizer),this.alphaConstraint=$n(e.alphaConstraint),e.sharedAxes==null)this.sharedAxes=null;else if(Array.isArray(e.sharedAxes))this.sharedAxes=e.sharedAxes;else if(typeof e.sharedAxes=="number")this.sharedAxes=[e.sharedAxes];else throw new te(`Expected sharedAxes to be a number or an array of numbers, but got ${e.sharedAxes}`)}build(e){e=Ct(e);const t=e.slice(1);if(this.sharedAxes!=null)for(const r of this.sharedAxes)t[r-1]=1;this.alpha=this.addWeight("alpha",t,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);const s={};if(this.sharedAxes!=null)for(let r=1;r<e.length;++r)s[r]=e[r];this.inputSpec=[new In({ndim:e.length,axes:s})],this.built=!0}call(e,t){return e=nt(e),A1(e,this.alpha.read())}getConfig(){const e={alphaInitializer:Jt(this.alphaInitializer),alphaRegularizer:Lt(this.alphaRegularizer),alphaConstraint:Tn(this.alphaConstraint),sharedAxes:this.sharedAxes},t=super.getConfig();return Object.assign(e,t),e}}Mj.className="PReLU";Se(Mj);let Lj=class extends ft{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA=1,e==null&&(e={}),e.alpha!=null&&e.alpha!==this.DEFAULT_ALPHA)throw new at(`Non-default alpha value (${e.alpha}) is not supported by the ELU layer yet.`);this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,t){const s=nt(e);return Vg(s)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},t=super.getConfig();return Object.assign(e,t),e}};Lj.className="ELU";Se(Lj);class Fj extends ft{constructor(e){super(e??{}),this.DEFAULT_THETA=1,e==null&&(e={}),this.theta=e.theta==null?this.DEFAULT_THETA:e.theta}call(e,t){const s=nt(e);return ne(s,Fe(lr(s,this.theta),"float32"))}computeOutputShape(e){return e}getConfig(){const e={theta:this.theta},t=super.getConfig();return Object.assign(e,t),e}}Fj.className="ThresholdedReLU";Se(Fj);class Oj extends ft{constructor(e){super(e??{}),this.DEFAULT_AXIS=1,e==null&&(e={}),this.softmax=new Rw().apply,this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis}call(e,t){return de(()=>{let s=nt(e);const r=t.mask;if(r!=null){const i=ne(tt(na(s.shape),Fe(r,s.dtype)),$t(-1e9));s=$e(s,i)}return this.axis instanceof Array?this.axis.length>1?$i(tt(s,NE(s,this.axis,!0))):this.softmax(s,this.axis[0]):this.softmax(s,this.axis)})}computeOutputShape(e){return e}getConfig(){const e={axis:this.axis},t=super.getConfig();return Object.assign(e,t),e}}Oj.className="Softmax";Se(Oj);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function ec(n,e,t){if(typeof n=="number")return Xa(n,e);if(n.length!==e)throw new te(`The ${t} argument must be an integer or tuple of ${e} integers. Received: ${n.length} elements.`);for(let s=0;s<e;++s){const r=n[s];if(!d8(r))throw new te(`The ${t} argument must be an integer or tuple of ${e} integers. Received: ${JSON.stringify(n)} including a non-integer number ${r}`)}return n}function Zr(n,e,t,s,r=1){if(n==null)return n;const i=e+(e-1)*(r-1);let o;return t==="same"?o=n:o=n-i+1,Math.floor((o+s-1)/s)}function xi(n,e,t,s){if(n==null)return null;if(s==="valid")n=n*e+Go([t-e,0]);else if(s==="same")n=n*e;else throw new te(`Unsupport padding mode: ${s}.`);return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Dw(n,e){return de(()=>(gn(e),e==="channelsFirst"?bt(n,[0,2,3,1]):n))}function _j(n,e){return de(()=>(gn(e),e==="channelsFirst"?bt(n,[0,2,3,4,1]):n))}function MH(n,e,t,s=1,r="valid",i,o=1){return de(()=>{if(i==null&&(i=si()),gn(i),n.shape.length!==3)throw new te(`The input of a conv1dWithBias operation should be 3, but is ${n.shape.length} instead.`);if(e.shape.length!==3)throw new te(`The kernel for a conv1dWithBias operation should be 3, but is ${e.shape.length} instead`);if(t!=null&&t.shape.length!==1)throw new te(`The bias for a conv1dWithBias operation should be 1, but is ${t.shape.length} instead`);if(i==="channelsFirst"&&(n=bt(n,[0,2,1])),r==="causal")throw new at("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");let a=pE(n,e,s,r==="same"?"same":"valid","NWC",o);return t!=null&&(a=oi(a,t)),a})}function IN(n,e,t,s=[1,1],r="valid",i,o,a=null){return de(()=>{if(i==null&&(i=si()),gn(i),n.rank!==3&&n.rank!==4)throw new te(`conv2dWithBiasActivation expects input to be of rank 3 or 4, but received ${n.rank}.`);if(e.rank!==3&&e.rank!==4)throw new te(`conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received ${n.rank}.`);let l=Dw(n,i);if(r==="causal")throw new at("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return l=PV({x:l,filter:e,strides:s,pad:r==="same"?"same":"valid",dilations:o,dataFormat:"NHWC",bias:t,activation:a}),i==="channelsFirst"&&(l=bt(l,[0,3,1,2])),l})}function LH(n,e,t,s=[1,1,1],r="valid",i,o){return de(()=>{if(i==null&&(i=si()),gn(i),n.rank!==4&&n.rank!==5)throw new te(`conv3dWithBias expects input to be of rank 4 or 5, but received ${n.rank}.`);if(e.rank!==4&&e.rank!==5)throw new te(`conv3dWithBias expects kernel to be of rank 4 or 5, but received ${n.rank}.`);let a=_j(n,i);if(r==="causal")throw new at("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return a=j5(a,e,s,r==="same"?"same":"valid","NDHWC",o),t!=null&&(a=oi(a,t)),i==="channelsFirst"&&(a=bt(a,[0,4,1,2,3])),a})}class tx extends ft{constructor(e,t){if(super(t),this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",tx.verifyArgs(t),this.rank=e,_n(this.rank,"rank"),this.rank!==1&&this.rank!==2&&this.rank!==3)throw new at(`Convolution layer for rank other than 1, 2, or 3 (${this.rank}) is not implemented yet.`);if(this.kernelSize=ec(t.kernelSize,e,"kernelSize"),this.strides=ec(t.strides==null?1:t.strides,e,"strides"),this.padding=t.padding==null?"valid":t.padding,cr(this.padding),this.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,gn(this.dataFormat),this.activation=qo(t.activation),this.useBias=t.useBias==null?!0:t.useBias,this.biasInitializer=Kt(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.biasConstraint=$n(t.biasConstraint),this.biasRegularizer=Qt(t.biasRegularizer),this.activityRegularizer=Qt(t.activityRegularizer),this.dilationRate=ec(t.dilationRate==null?1:t.dilationRate,e,"dilationRate"),this.rank===1&&Array.isArray(this.dilationRate)&&this.dilationRate.length!==1)throw new te(`dilationRate must be a number or an array of a single number for 1D convolution, but received ${JSON.stringify(this.dilationRate)}`);if(this.rank===2){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==2)throw new te(`dilationRate must be a number or array of two numbers for 2D convolution, but received ${JSON.stringify(this.dilationRate)}`)}else if(this.rank===3){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==3)throw new te(`dilationRate must be a number or array of three numbers for 3D convolution, but received ${JSON.stringify(this.dilationRate)}`)}}static verifyArgs(e){if(gi("kernelSize"in e,"required key 'kernelSize' not in config"),typeof e.kernelSize!="number"&&!vw(e.kernelSize,"number",1,3))throw new te(`BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received ${JSON.stringify(e.kernelSize)}.`)}getConfig(){const e={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:Ho(this.activation),useBias:this.useBias,biasInitializer:Jt(this.biasInitializer),biasRegularizer:Lt(this.biasRegularizer),activityRegularizer:Lt(this.activityRegularizer),biasConstraint:Tn(this.biasConstraint)},t=super.getConfig();return Object.assign(e,t),e}}class Rc extends tx{constructor(e,t){super(e,t),this.kernel=null,Rc.verifyArgs(t),this.filters=t.filters,_n(this.filters,"filters"),this.kernelInitializer=Kt(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.kernelConstraint=$n(t.kernelConstraint),this.kernelRegularizer=Qt(t.kernelRegularizer)}build(e){e=Ct(e);const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null)throw new te(`The channel dimension of the input should be defined. Found ${e[t]}`);const s=e[t],r=this.kernelSize.concat([s,this.filters]);this.kernel=this.addWeight("kernel",r,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:{[t]:s}}],this.built=!0}call(e,t){return de(()=>{e=nt(e);let s;const r=this.bias==null?null:this.bias.read(),i=MA(this.activation.getClassName());if(i!=null&&this.rank===2)s=IN(e,this.kernel.read(),r,this.strides,this.padding,this.dataFormat,this.dilationRate,i);else{if(this.rank===1)s=MH(e,this.kernel.read(),r,this.strides[0],this.padding,this.dataFormat,this.dilationRate[0]);else if(this.rank===2)s=IN(e,this.kernel.read(),r,this.strides,this.padding,this.dataFormat,this.dilationRate);else if(this.rank===3)s=LH(e,this.kernel.read(),r,this.strides,this.padding,this.dataFormat,this.dilationRate);else throw new at("convolutions greater than 3D are not implemented yet.");this.activation!=null&&(s=this.activation.apply(s))}return s})}computeOutputShape(e){e=Ct(e);const t=[],s=this.dataFormat==="channelsLast"?e.slice(1,e.length-1):e.slice(2);for(let i=0;i<s.length;++i){const o=Zr(s[i],this.kernelSize[i],this.padding,this.strides[i],typeof this.dilationRate=="number"?this.dilationRate:this.dilationRate[i]);t.push(o)}let r=[e[0]];return this.dataFormat==="channelsLast"?(r=r.concat(t),r.push(this.filters)):(r.push(this.filters),r=r.concat(t)),r}getConfig(){const e={filters:this.filters,kernelInitializer:Jt(this.kernelInitializer),kernelRegularizer:Lt(this.kernelRegularizer),kernelConstraint:Tn(this.kernelConstraint)},t=super.getConfig();return Object.assign(e,t),e}static verifyArgs(e){if(!("filters"in e)||typeof e.filters!="number"||e.filters<1)throw new te(`Convolution layer expected config.filters to be a 'number' > 0 but got ${JSON.stringify(e.filters)}`)}}class $h extends Rc{constructor(e){super(2,e),$h.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!vw(e.kernelSize,"number",1,2))throw new te(`Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received ${JSON.stringify(e.kernelSize)}.`)}}$h.className="Conv2D";Se($h);class Eh extends Rc{constructor(e){super(3,e),Eh.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!(Array.isArray(e.kernelSize)&&(e.kernelSize.length===1||e.kernelSize.length===3)))throw new te(`Conv3D expects config.kernelSize to be number or [number, number, number], but received ${JSON.stringify(e.kernelSize)}.`)}}Eh.className="Conv3D";Se(Eh);class zj extends $h{constructor(e){if(super(e),this.inputSpec=[new In({ndim:4})],this.padding!=="same"&&this.padding!=="valid")throw new te(`Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=Ct(e),e.length!==4)throw new te("Input should have rank 4; Received input shape: "+JSON.stringify(e));const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null)throw new te("The channel dimension of the inputs should be defined. Found `None`.");const s=e[t],r=this.kernelSize.concat([this.filters,s]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new In({ndim:4,axes:{[t]:s}})],this.built=!0}call(e,t){return de(()=>{let s=nt(e);if(s.shape.length!==4)throw new te(`Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${s.shape.length}`);const r=s.shape,i=r[0];let o,a;this.dataFormat==="channelsFirst"?(o=2,a=3):(o=1,a=2);const l=r[o],u=r[a],d=this.kernelSize[0],f=this.kernelSize[1],p=this.strides[0],g=this.strides[1],x=xi(l,p,d,this.padding),y=xi(u,g,f,this.padding),b=[i,x,y,this.filters];this.dataFormat!=="channelsLast"&&(s=bt(s,[0,2,3,1]));let k=mE(s,this.kernel.read(),b,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(k=bt(k,[0,3,1,2])),this.bias!=null&&(k=oi(k,this.bias.read(),this.dataFormat)),this.activation!=null&&(k=this.activation.apply(k)),k})}computeOutputShape(e){e=Ct(e);const t=e.slice();let s,r,i;this.dataFormat==="channelsFirst"?(s=1,r=2,i=3):(s=3,r=1,i=2);const o=this.kernelSize[0],a=this.kernelSize[1],l=this.strides[0],u=this.strides[1];return t[s]=this.filters,t[r]=xi(t[r],l,o,this.padding),t[i]=xi(t[i],u,a,this.padding),t}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}zj.className="Conv2DTranspose";Se(zj);class Bj extends Eh{constructor(e){if(super(e),this.inputSpec=[new In({ndim:5})],this.padding!=="same"&&this.padding!=="valid")throw new te(`Conv3DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=Ct(e),e.length!==5)throw new te("Input should have rank 5; Received input shape: "+JSON.stringify(e));const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null)throw new te("The channel dimension of the inputs should be defined. Found `None`.");const s=e[t],r=this.kernelSize.concat([this.filters,s]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new In({ndim:5,axes:{[t]:s}})],this.built=!0}call(e,t){return de(()=>{let s=nt(e);if(s.shape.length!==5)throw new te(`Conv3DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${s.shape.length}`);const r=s.shape,i=r[0];let o,a,l;this.dataFormat==="channelsFirst"?(l=2,o=3,a=4):(l=1,o=2,a=3);const u=r[l],d=r[o],f=r[a],p=this.kernelSize[0],g=this.kernelSize[1],x=this.kernelSize[2],y=this.strides[0],b=this.strides[1],k=this.strides[2],w=xi(u,y,p,this.padding),N=xi(d,b,g,this.padding),C=xi(f,k,x,this.padding),S=[i,w,N,C,this.filters];this.dataFormat!=="channelsLast"&&(s=bt(s,[0,2,3,4,1]));let T=P5(s,this.kernel.read(),S,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(T=bt(T,[0,4,1,2,3])),this.bias!==null&&(T=oi(T,this.bias.read(),this.dataFormat)),this.activation!==null&&(T=this.activation.apply(T)),T})}computeOutputShape(e){e=Ct(e);const t=e.slice();let s,r,i,o;this.dataFormat==="channelsFirst"?(s=1,r=2,i=3,o=4):(s=4,r=1,i=2,o=3);const a=this.kernelSize[0],l=this.kernelSize[1],u=this.kernelSize[2],d=this.strides[0],f=this.strides[1],p=this.strides[2];return t[s]=this.filters,t[r]=xi(t[r],d,a,this.padding),t[i]=xi(t[i],f,l,this.padding),t[o]=xi(t[o],p,u,this.padding),t}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}Bj.className="Conv3DTranspose";Se(Bj);class Wj extends Rc{constructor(e,t){if(super(e,t),this.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",this.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",this.depthwiseKernel=null,this.pointwiseKernel=null,t.filters==null)throw new te("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(t.kernelInitializer!=null||t.kernelRegularizer!=null||t.kernelConstraint!=null)throw new te("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(t.padding!=null&&t.padding!=="same"&&t.padding!=="valid")throw new te(`SeparableConv${this.rank}D supports only padding modes: 'same' and 'valid', but received ${JSON.stringify(t.padding)}`);this.depthMultiplier=t.depthMultiplier==null?1:t.depthMultiplier,this.depthwiseInitializer=Kt(t.depthwiseInitializer||this.DEFAULT_DEPTHWISE_INITIALIZER),this.depthwiseRegularizer=Qt(t.depthwiseRegularizer),this.depthwiseConstraint=$n(t.depthwiseConstraint),this.pointwiseInitializer=Kt(t.depthwiseInitializer||this.DEFAULT_POINTWISE_INITIALIZER),this.pointwiseRegularizer=Qt(t.pointwiseRegularizer),this.pointwiseConstraint=$n(t.pointwiseConstraint)}build(e){if(e=Ct(e),e.length<this.rank+2)throw new te(`Inputs to SeparableConv${this.rank}D should have rank ${this.rank+2}, but received input shape: ${JSON.stringify(e)}`);const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null||e[t]<0)throw new te(`The channel dimension of the inputs should be defined, but found ${JSON.stringify(e[t])}`);const s=e[t],r=this.kernelSize.concat([s,this.depthMultiplier]),i=[];for(let a=0;a<this.rank;++a)i.push(1);i.push(s*this.depthMultiplier,this.filters);const o=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",r,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,o,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",i,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,o,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,o,this.biasConstraint):this.bias=null,this.inputSpec=[new In({ndim:this.rank+2,axes:{[t]:s}})],this.built=!0}call(e,t){return de(()=>{e=nt(e);let s;if(this.rank===1)throw new at("1D separable convolution is not implemented yet.");return this.rank===2&&(this.dataFormat==="channelsFirst"&&(e=bt(e,[0,2,3,1])),s=DE(e,this.depthwiseKernel.read(),this.pointwiseKernel.read(),this.strides,this.padding,this.dilationRate,"NHWC")),this.useBias&&(s=oi(s,this.bias.read(),this.dataFormat)),this.activation!=null&&(s=this.activation.apply(s)),this.dataFormat==="channelsFirst"&&(s=bt(s,[0,3,1,2])),s})}getConfig(){const e=super.getConfig();return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=Jt(this.depthwiseInitializer),e.pointwiseInitializer=Jt(this.pointwiseInitializer),e.depthwiseRegularizer=Lt(this.depthwiseRegularizer),e.pointwiseRegularizer=Lt(this.pointwiseRegularizer),e.depthwiseConstraint=Tn(this.depthwiseConstraint),e.pointwiseConstraint=Tn(this.pointwiseConstraint),e}}Wj.className="SeparableConv";class Vj extends Wj{constructor(e){super(2,e)}}Vj.className="SeparableConv2D";Se(Vj);class nx extends Rc{constructor(e){super(1,e),nx.verifyArgs(e),this.inputSpec=[{ndim:3}]}getConfig(){const e=super.getConfig();return delete e.rank,delete e.dataFormat,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!vw(e.kernelSize,"number",1,1))throw new te(`Conv1D expects config.kernelSize to be number or number[] with length 1, but received ${JSON.stringify(e.kernelSize)}.`)}}nx.className="Conv1D";Se(nx);class Uj extends ft{constructor(e){super(e),typeof e.cropping=="number"?this.cropping=[[e.cropping,e.cropping],[e.cropping,e.cropping]]:typeof e.cropping[0]=="number"?this.cropping=[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:this.cropping=e.cropping,this.dataFormat=e.dataFormat===void 0?"channelsLast":e.dataFormat,this.inputSpec=[{ndim:4}]}computeOutputShape(e){return this.dataFormat==="channelsFirst"?[e[0],e[1],e[2]-this.cropping[0][0]-this.cropping[0][1],e[3]-this.cropping[1][0]-this.cropping[1][1]]:[e[0],e[1]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1],e[3]]}call(e,t){return de(()=>{if(e=nt(e),this.dataFormat==="channelsLast"){const s=tp(e,this.cropping[0][0],e.shape[1]-this.cropping[0][0]-this.cropping[0][1],2);return tp(s,this.cropping[1][0],e.shape[2]-this.cropping[1][1]-this.cropping[1][0],3)}else{const s=tp(e,this.cropping[0][0],e.shape[2]-this.cropping[0][0]-this.cropping[0][1],3);return tp(s,this.cropping[1][0],e.shape[3]-this.cropping[1][1]-this.cropping[1][0],4)}})}getConfig(){const e={cropping:this.cropping,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}Uj.className="Cropping2D";Se(Uj);class Gj extends ft{constructor(e){super(e),this.DEFAULT_SIZE=[2,2],this.inputSpec=[{ndim:4}],this.size=e.size==null?this.DEFAULT_SIZE:e.size,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,gn(this.dataFormat),this.interpolation=e.interpolation==null?"nearest":e.interpolation,l8(this.interpolation)}computeOutputShape(e){if(this.dataFormat==="channelsFirst"){const t=e[2]==null?null:this.size[0]*e[2],s=e[3]==null?null:this.size[1]*e[3];return[e[0],e[1],t,s]}else{const t=e[1]==null?null:this.size[0]*e[1],s=e[2]==null?null:this.size[1]*e[2];return[e[0],t,s,e[3]]}}call(e,t){return de(()=>{let s=nt(e);const r=s.shape;if(this.dataFormat==="channelsFirst"){s=bt(s,[0,2,3,1]);const i=this.size[0]*r[2],o=this.size[1]*r[3],a=this.interpolation==="nearest"?Xi.resizeNearestNeighbor(s,[i,o]):Xi.resizeBilinear(s,[i,o]);return bt(a,[0,3,1,2])}else{const i=this.size[0]*r[1],o=this.size[1]*r[2];return this.interpolation==="nearest"?Xi.resizeNearestNeighbor(s,[i,o]):Xi.resizeBilinear(s,[i,o])}})}getConfig(){const e={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation},t=super.getConfig();return Object.assign(e,t),e}}Gj.className="UpSampling2D";Se(Gj);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function FH(n,e,t=[1,1],s="valid",r,i){return de(()=>{r==null&&(r=si()),gn(r);let o=Dw(n,r);if(n.rank!==4)throw new te(`Input for depthwiseConv2d is required to be 4-D, but is instead ${n.rank}-D`);if(e.rank!==4)throw new te(`depthwiseKernel is required to be 4-D, but is instead ${e.rank}-D`);return o=b1(o,e,t,s==="same"?"same":"valid","NHWC",i),r==="channelsFirst"&&(o=bt(o,[0,3,1,2])),o})}class Hj extends tx{constructor(e){super(2,e),this.depthwiseKernel=null,this.depthMultiplier=e.depthMultiplier==null?1:e.depthMultiplier,this.depthwiseInitializer=Kt(e.depthwiseInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.depthwiseConstraint=$n(e.depthwiseConstraint),this.depthwiseRegularizer=Qt(e.depthwiseRegularizer)}build(e){if(e=Ct(e),e.length<4)throw new te(`Inputs to DepthwiseConv2D should have rank 4. Received input shape: ${JSON.stringify(e)}.`);const t=this.dataFormat==="channelsFirst"?1:3;if(e[t]==null||e[t]<0)throw new te(`The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not (${e[t]}).`);const s=e[t],r=[this.kernelSize[0],this.kernelSize[1],s,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",r,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[s*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return de(()=>{e=nt(e);let s=FH(e,this.depthwiseKernel.read(),this.strides,this.padding,this.dataFormat,null);return this.useBias&&(s=oi(s,this.bias.read(),this.dataFormat)),this.activation!=null&&(s=this.activation.apply(s)),s})}computeOutputShape(e){e=Ct(e);const t=this.dataFormat==="channelsFirst"?e[2]:e[1],s=this.dataFormat==="channelsFirst"?e[3]:e[2],r=this.dataFormat==="channelsFirst"?e[1]*this.depthMultiplier:e[3]*this.depthMultiplier,i=Zr(t,this.kernelSize[0],this.padding,this.strides[0]),o=Zr(s,this.kernelSize[1],this.padding,this.strides[1]);return this.dataFormat==="channelsFirst"?[e[0],r,i,o]:[e[0],i,o,r]}getConfig(){const e=super.getConfig();return e.depthMultiplier=this.depthMultiplier,e.depthwiseInitializer=Jt(this.depthwiseInitializer),e.depthwiseRegularizer=Lt(this.depthwiseRegularizer),e.depthwiseConstraint=Tn(this.depthwiseRegularizer),e}}Hj.className="DepthwiseConv2D";Se(Hj);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function qj(n,e,t,s){if(Array.isArray(n)){if(e!=null||t!=null)throw new te("When inputs is an array, neither initialState or constants should be provided");s!=null&&(t=n.slice(n.length-s,n.length),n=n.slice(0,n.length-s)),n.length>1&&(e=n.slice(1,n.length)),n=n[0]}function r(i){return i==null||Array.isArray(i)?i:[i]}return e=r(e),t=r(t),{inputs:n,initialState:e,constants:t}}function Kj(n,e,t,s=!1,r,i,o=!1,a=!1){return de(()=>{const l=e.shape.length;if(l<3)throw new te(`Input should be at least 3D, but is ${l}D.`);const u=[1,0].concat(ni(2,l));e=bt(e,u),o&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),r!=null&&(r=Fe(Fe(r,"bool"),"float32"),r.rank===l-1&&(r=Es(r,-1)),r=bt(r,u)),s&&(e=Ka(e,0),r!=null&&(r=Ka(r,0)));const d=[];let f,p=t;const g=e.shape[0],x=Qa(e);let y;r!=null&&(y=Qa(r));for(let k=0;k<g;++k){const w=x[k],N=de(()=>n(w,p));if(r==null)f=N[0],p=N[1];else{const C=de(()=>{const S=y[k],T=tt($r(S),S),A=$e(ne(N[0],S),ne(p[0],T)),E=p.map((M,P)=>$e(ne(N[1][P],S),ne(M,T)));return{output:A,newStates:E}});f=C.output,p=C.newStates}a&&d.push(f)}let b;return a&&(b=no(d,1)),[f,b,p]})}class ra extends ft{constructor(e){super(e);let t;if(e.cell==null)throw new te("cell property is missing for the constructor of RNN.");if(Array.isArray(e.cell)?t=new Lw({cells:e.cell}):t=e.cell,t.stateSize==null)throw new te("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");this.cell=t,this.returnSequences=e.returnSequences==null?!1:e.returnSequences,this.returnState=e.returnState==null?!1:e.returnState,this.goBackwards=e.goBackwards==null?!1:e.goBackwards,this._stateful=e.stateful==null?!1:e.stateful,this.unroll=e.unroll==null?!1:e.unroll,this.supportsMasking=!0,this.inputSpec=[new In({ndim:3})],this.stateSpec=null,this.states_=null,this.numConstants=null,this.keptStates=[]}getStates(){if(this.states_==null){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;return ni(0,e).map(t=>null)}else return this.states_}setStates(e){this.states_=e}computeOutputShape(e){jv(e)&&(e=e[0]),e=e;let t=this.cell.stateSize;Array.isArray(t)||(t=[t]);const s=t[0];let r;if(this.returnSequences?r=[e[0],e[1],s]:r=[e[0],s],this.returnState){const i=[];for(const o of t)i.push([e[0],o]);return[r].concat(i)}else return r}computeMask(e,t){return de(()=>{Array.isArray(t)&&(t=t[0]);const s=this.returnSequences?t:null;if(this.returnState){const r=this.states.map(i=>null);return[s].concat(r)}else return s})}get states(){if(this.states_==null){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,t=[];for(let s=0;s<e;++s)t.push(null);return t}else return this.states_}set states(e){this.states_=e}build(e){if(this.numConstants!=null)throw new at("Constants support is not implemented in RNN yet.");jv(e)&&(e=e[0]),e=e;const t=this.stateful?e[0]:null,s=e.slice(2);this.inputSpec[0]=new In({shape:[t,null,...s]});const r=[e[0]].concat(e.slice(2));this.cell.build(r);let i;if(Array.isArray(this.cell.stateSize)?i=this.cell.stateSize:i=[this.cell.stateSize],this.stateSpec!=null){if(!At(this.stateSpec.map(o=>o.shape[o.shape.length-1]),i))throw new te(`An initialState was passed that is not compatible with cell.stateSize. Received stateSpec=${this.stateSpec}; However cell.stateSize is ${this.cell.stateSize}`)}else this.stateSpec=i.map(o=>new In({shape:[null,o]}));this.stateful&&this.resetStates()}resetStates(e,t=!1){de(()=>{if(!this.stateful)throw new mi("Cannot call resetStates() on an RNN Layer that is not stateful.");const s=this.inputSpec[0].shape[0];if(s==null)throw new te("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.states_==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(r=>On([s,r])):this.states_=[On([s,this.cell.stateSize])];else if(e==null)ct(this.states_),this.keptStates!=null&&(ct(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(r=>On([s,r])):this.states_[0]=On([s,this.cell.stateSize]);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new te(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);t===!0?this.keptStates.push(this.states_.slice()):ct(this.states_);for(let r=0;r<this.states_.length;++r){const i=e[r],o=Array.isArray(this.cell.stateSize)?this.cell.stateSize[r]:this.cell.stateSize,a=[s,o];if(!At(i.shape,a))throw new te(`State ${r} is incompatible with layer ${this.name}: expected shape=${a}, received shape=${i.shape}`);this.states_[r]=i}}this.states_=this.states_.map(r=>ki(r.clone()))})}apply(e,t){let s=t==null?null:t.initialState,r=t==null?null:t.constants;t==null&&(t={});const i=qj(e,s,r,this.numConstants);e=i.inputs,s=i.initialState,r=i.constants;let o=[],a=[];if(s!=null){t.initialState=s,o=o.concat(s),this.stateSpec=[];for(const u of s)this.stateSpec.push(new In({shape:u.shape}));a=a.concat(this.stateSpec)}if(r!=null&&(t.constants=r,o=o.concat(r),this.numConstants=r.length),o[0]instanceof Ai){const u=[e].concat(o),d=this.inputSpec.concat(a),f=this.inputSpec;this.inputSpec=d;const p=super.apply(u,t);return this.inputSpec=f,p}else return super.apply(e,t)}call(e,t){return de(()=>{const s=t==null?null:t.mask,r=t==null?null:t.training;let i=t==null?null:t.initialState;e=nt(e),i==null&&(this.stateful?i=this.states_:i=this.getInitialState(e));const o=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;if(i.length!==o)throw new te(`RNN Layer has ${o} state(s) but was passed ${i.length} initial state(s).`);this.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");const a={training:r},u=Kj((x,y)=>{const b=this.cell.call([x].concat(y),a);return[b[0],b.slice(1)]},e,i,this.goBackwards,s,null,this.unroll,this.returnSequences),d=u[0],f=u[1],p=u[2];this.stateful&&this.resetStates(p,r);const g=this.returnSequences?f:d;return this.returnState?[g].concat(p):g})}getInitialState(e){return de(()=>{let t=On(e.shape);return t=Ye(t,[1,2]),t=Ch(t),Array.isArray(this.cell.stateSize)?this.cell.stateSize.map(s=>s>1?Ev(t,[1,s]):t):this.cell.stateSize>1?[Ev(t,[1,this.cell.stateSize])]:[t]})}get trainableWeights(){return this.trainable?this.cell.trainableWeights:[]}get nonTrainableWeights(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.cell!=null&&this.cell.setFastWeightInitDuringBuild(e)}getConfig(){const e=super.getConfig(),t={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};this.numConstants!=null&&(t.numConstants=this.numConstants);const s=this.cell.getConfig();return this.getClassName()===ra.className&&(t.cell={className:this.cell.getClassName(),config:s}),Object.assign(Object.assign(Object.assign({},s),e),t)}static fromConfig(e,t,s={}){const r=t.cell,i=Ii(r,s);return new e(Object.assign(t,{cell:i}))}}ra.className="RNN";Se(ra);class sx extends ft{}class Pw extends sx{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,_n(this.units,"units"),this.activation=qo(e.activation==null?this.DEFAULT_ACTIVATION:e.activation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=Kt(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=Kt(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=Kt(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=Qt(e.kernelRegularizer),this.recurrentRegularizer=Qt(e.recurrentRegularizer),this.biasRegularizer=Qt(e.biasRegularizer),this.kernelConstraint=$n(e.kernelConstraint),this.recurrentConstraint=$n(e.recurrentConstraint),this.biasConstraint=$n(e.biasConstraint),this.dropout=dc([1,Go([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=dc([1,Go([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=Ct(e),this.kernel=this.addWeight("kernel",[e[e.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return de(()=>{if(e=e,e.length!==2)throw new te(`SimpleRNNCell expects 2 input Tensors, got ${e.length}.`);let s=e[1];e=e[0];const r=t.training==null?!1:t.training;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Ko({ones:()=>$r(e),rate:this.dropout,training:r,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Ko({ones:()=>$r(s),rate:this.recurrentDropout,training:r,dropoutFunc:this.dropoutFunc}));let i;const o=this.dropoutMask,a=this.recurrentDropoutMask;o!=null?i=Ni(ne(e,o),this.kernel.read()):i=Ni(e,this.kernel.read()),this.bias!=null&&(i=oi(i,this.bias.read())),a!=null&&(s=ne(s,a));let l=$e(i,Ni(s,this.recurrentKernel.read()));return this.activation!=null&&(l=this.activation.apply(l)),[l,l]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:Ho(this.activation),useBias:this.useBias,kernelInitializer:Jt(this.kernelInitializer),recurrentInitializer:Jt(this.recurrentInitializer),biasInitializer:Jt(this.biasInitializer),kernelRegularizer:Lt(this.kernelRegularizer),recurrentRegularizer:Lt(this.recurrentRegularizer),biasRegularizer:Lt(this.biasRegularizer),activityRegularizer:Lt(this.activityRegularizer),kernelConstraint:Tn(this.kernelConstraint),recurrentConstraint:Tn(this.recurrentConstraint),biasConstraint:Tn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign(Object.assign({},e),t)}}Pw.className="SimpleRNNCell";Se(Pw);class Qj extends ra{constructor(e){e.cell=new Pw(e),super(e)}call(e,t){return de(()=>{this.cell.dropoutMask!=null&&(ct(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(ct(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=t==null?null:t.mask,r=t==null?null:t.training,i=t==null?null:t.initialState;return super.call(e,{mask:s,training:r,initialState:i})})}static fromConfig(e,t){return new e(t)}}Qj.className="SimpleRNN";Se(Qj);class Mw extends sx{constructor(e){if(super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.resetAfter)throw new te("GRUCell does not support reset_after parameter set to true.");this.units=e.units,_n(this.units,"units"),this.activation=qo(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=qo(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=Kt(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=Kt(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=Kt(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=Qt(e.kernelRegularizer),this.recurrentRegularizer=Qt(e.recurrentRegularizer),this.biasRegularizer=Qt(e.biasRegularizer),this.kernelConstraint=$n(e.kernelConstraint),this.recurrentConstraint=$n(e.recurrentConstraint),this.biasConstraint=$n(e.biasConstraint),this.dropout=dc([1,Go([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=dc([1,Go([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=Ct(e);const t=e[e.length-1];this.kernel=this.addWeight("kernel",[t,this.units*3],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*3],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units*3],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return de(()=>{if(e=e,e.length!==2)throw new te(`GRUCell expects 2 input Tensors (inputs, h, c), got ${e.length}.`);const s=t.training==null?!1:t.training;let r=e[1];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Ko({ones:()=>$r(e),rate:this.dropout,training:s,count:3,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Ko({ones:()=>$r(r),rate:this.recurrentDropout,training:s,count:3,dropoutFunc:this.dropoutFunc}));const i=this.dropoutMask,o=this.recurrentDropoutMask;let a,l,u;0<this.dropout&&this.dropout<1&&(e=ne(e,i[0]));let d=Ni(e,this.kernel.read());this.useBias&&(d=oi(d,this.bias.read())),0<this.recurrentDropout&&this.recurrentDropout<1&&(r=ne(r,o[0]));const f=this.recurrentKernel.read(),[p,g]=or(f,[2*this.units,this.units],f.rank-1),x=Ni(r,p),[y,b,k]=or(d,3,d.rank-1),[w,N]=or(x,2,x.rank-1);a=this.recurrentActivation.apply($e(y,w)),l=this.recurrentActivation.apply($e(b,N));const C=Ni(ne(l,r),g);u=this.activation.apply($e(k,C));const S=$e(ne(a,r),ne($e(1,fn(a)),u));return[S,S]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:Ho(this.activation),recurrentActivation:Ho(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Jt(this.kernelInitializer),recurrentInitializer:Jt(this.recurrentInitializer),biasInitializer:Jt(this.biasInitializer),kernelRegularizer:Lt(this.kernelRegularizer),recurrentRegularizer:Lt(this.recurrentRegularizer),biasRegularizer:Lt(this.biasRegularizer),activityRegularizer:Lt(this.activityRegularizer),kernelConstraint:Tn(this.kernelConstraint),recurrentConstraint:Tn(this.recurrentConstraint),biasConstraint:Tn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign(Object.assign({},e),t)}}Mw.className="GRUCell";Se(Mw);class Xj extends ra{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new Mw(e),super(e)}call(e,t){return de(()=>{this.cell.dropoutMask!=null&&(ct(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(ct(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=t==null?null:t.mask,r=t==null?null:t.training,i=t==null?null:t.initialState;return super.call(e,{mask:s,training:r,initialState:i})})}static fromConfig(e,t){return t.implmentation===0&&(t.implementation=1),new e(t)}}Xj.className="GRU";Se(Xj);class rx extends sx{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,_n(this.units,"units"),this.activation=qo(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=qo(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=Kt(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=Kt(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=Kt(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.unitForgetBias=e.unitForgetBias,this.kernelRegularizer=Qt(e.kernelRegularizer),this.recurrentRegularizer=Qt(e.recurrentRegularizer),this.biasRegularizer=Qt(e.biasRegularizer),this.kernelConstraint=$n(e.kernelConstraint),this.recurrentConstraint=$n(e.recurrentConstraint),this.biasConstraint=$n(e.biasConstraint),this.dropout=dc([1,Go([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=dc([1,Go([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=[this.units,this.units],this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){var t;e=Ct(e);const s=e[e.length-1];this.kernel=this.addWeight("kernel",[s,this.units*4],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*4],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint);let r;if(this.useBias){if(this.unitForgetBias){const i=this.biasInitializer,o=this.units;r=new(t=class extends jr{apply(l,u){const d=i.apply([o]),f=new ww().apply([o]),p=i.apply([o*2]);return cN(cN(d,f),p)}},t.className="CustomInit",t)}else r=this.biasInitializer;this.bias=this.addWeight("bias",[this.units*4],null,r,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}call(e,t){return de(()=>{const s=t.training==null?!1:t.training;if(e=e,e.length!==3)throw new te(`LSTMCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);let r=e[1];const i=e[2];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Ko({ones:()=>$r(e),rate:this.dropout,training:s,count:4,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Ko({ones:()=>$r(r),rate:this.recurrentDropout,training:s,count:4,dropoutFunc:this.dropoutFunc}));const o=this.dropoutMask,a=this.recurrentDropoutMask;let l,u,d,f;0<this.dropout&&this.dropout<1&&(e=ne(e,o[0]));let p=Ni(e,this.kernel.read());0<this.recurrentDropout&&this.recurrentDropout<1&&(r=ne(r,a[0])),p=$e(p,Ni(r,this.recurrentKernel.read())),this.useBias&&(p=oi(p,this.bias.read()));const[g,x,y,b]=or(p,4,p.rank-1);l=this.recurrentActivation.apply(g),u=this.recurrentActivation.apply(x),d=$e(ne(u,i),ne(l,this.activation.apply(y))),f=this.recurrentActivation.apply(b);const k=ne(f,this.activation.apply(d));return[k,k,d]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:Ho(this.activation),recurrentActivation:Ho(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Jt(this.kernelInitializer),recurrentInitializer:Jt(this.recurrentInitializer),biasInitializer:Jt(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:Lt(this.kernelRegularizer),recurrentRegularizer:Lt(this.recurrentRegularizer),biasRegularizer:Lt(this.biasRegularizer),activityRegularizer:Lt(this.activityRegularizer),kernelConstraint:Tn(this.kernelConstraint),recurrentConstraint:Tn(this.recurrentConstraint),biasConstraint:Tn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign(Object.assign({},e),t)}}rx.className="LSTMCell";Se(rx);class Yj extends ra{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new rx(e),super(e)}call(e,t){return de(()=>{this.cell.dropoutMask!=null&&(ct(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(ct(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=t==null?null:t.mask,r=t==null?null:t.training,i=t==null?null:t.initialState;return super.call(e,{mask:s,training:r,initialState:i})})}static fromConfig(e,t){return t.implmentation===0&&(t.implementation=1),new e(t)}}Yj.className="LSTM";Se(Yj);class Lw extends sx{constructor(e){super(e),this.cells=e.cells}get stateSize(){const e=[];for(const t of this.cells.slice().reverse())Array.isArray(t.stateSize)?e.push(...t.stateSize):e.push(t.stateSize);return e}call(e,t){return de(()=>{e=e;let s=e.slice(1);const r=[];for(const a of this.cells.slice().reverse())Array.isArray(a.stateSize)?r.push(s.splice(0,a.stateSize.length)):r.push(s.splice(0,1));r.reverse();const i=[];let o;for(let a=0;a<this.cells.length;++a){const l=this.cells[a];s=r[a],a===0?o=[e[0]].concat(s):o=[o[0]].concat(s),o=l.call(o,t),i.push(o.slice(1))}s=[];for(const a of i.slice().reverse())s.push(...a);return[o[0]].concat(s)})}build(e){jv(e)&&(e=e[0]),e=e;let t;this.cells.forEach((s,r)=>{Ma(`RNNCell_${r}`,()=>{s.build(e),Array.isArray(s.stateSize)?t=s.stateSize[0]:t=s.stateSize,e=[e[0],t]})}),this.built=!0}getConfig(){const e=super.getConfig(),t=i=>({className:i.getClassName(),config:i.getConfig()}),r={cells:this.cells.map(t)};return Object.assign(Object.assign({},e),r)}static fromConfig(e,t,s={}){const r=[];for(const i of t.cells)r.push(Ii(i,s));return new e({cells:r})}get trainableWeights(){if(!this.trainable)return[];const e=[];for(const t of this.cells)e.push(...t.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const t of this.cells)e.push(...t.nonTrainableWeights);if(!this.trainable){const t=[];for(const s of this.cells)t.push(...s.trainableWeights);return t.concat(e)}return e}getWeights(){const e=[];for(const t of this.cells)e.push(...t.weights);return Rv(e)}setWeights(e){const t=[];for(const s of this.cells){const r=s.weights.length,i=e.splice(r);for(let o=0;o<s.weights.length;++o)t.push([s.weights[o],i[o]])}$w(t)}}Lw.className="StackedRNNCells";Se(Lw);function Ko(n){const{ones:e,rate:t,training:s=!1,count:r=1,dropoutFunc:i}=n,o=()=>i!=null?i(e(),t):WA(e(),t),a=()=>Nh(o,e,s);return!r||r<=1?ki(a().clone()):Array(r).fill(void 0).map(a).map(u=>ki(u.clone()))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var OH=function(n,e){var t={};for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&e.indexOf(s)<0&&(t[s]=n[s]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,s=Object.getOwnPropertySymbols(n);r<s.length;r++)e.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(n,s[r])&&(t[s[r]]=n[s[r]]);return t};class Zj extends ra{constructor(e){if(e.unroll)throw new at("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(e.cell))throw new at("It is not possible at the moment to stack convolutional cells.");super(e),this.inputSpec=[new In({ndim:5})]}call(e,t){return de(()=>{if(this.cell.dropoutMask!=null&&(ct(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(ct(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),t&&t.constants)throw new te("ConvRNN2D cell does not support constants");const s=t==null?null:t.mask,r=t==null?null:t.training,i=t==null?null:t.initialState;return super.call(e,{mask:s,training:r,initialState:i})})}computeOutputShape(e){let t=this.computeSingleOutputShape(e);return this.returnSequences||(t=[t[0],...t.slice(2)]),this.returnState&&(t=[t,...Array(2).fill([e[0],...t.slice(-3)])]),t}getInitialState(e){return de(()=>{const{stateSize:t}=this.cell,s=e.shape,r=this.computeSingleOutputShape(s),i=[r[0],...r.slice(2)],o=On(i);return Array.isArray(t)?Array(t.length).fill(o):[o]})}resetStates(e,t=!1){de(()=>{if(!this.stateful)throw new mi("Cannot call resetStates() on an RNN Layer that is not stateful.");const s=this.inputSpec[0].shape,r=this.computeSingleOutputShape(s),i=[r[0],...r.slice(2)];if(s[0]==null)throw new te("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.getStates()==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>On(i)):this.states_=[On(i)];else if(e==null)ct(this.states_),this.keptStates!=null&&(ct(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>On(i)):this.states_[0]=On(i);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new te(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);t?this.keptStates.push(this.states_.slice()):ct(this.states_);for(let a=0;a<this.states_.length;++a){const l=e[a],u=i;if(!At(l.shape,u))throw new te(`State ${a} is incompatible with layer ${this.name}: expected shape=${u}, received shape=${l.shape}`);this.states_[a]=l}}this.states_=this.states_.map(a=>ki(a.clone()))})}computeSingleOutputShape(e){const{dataFormat:t,filters:s,kernelSize:r,padding:i,strides:o,dilationRate:a}=this.cell,l=t==="channelsFirst",u=e[l?3:2],d=e[l?4:3],f=Zr(u,r[0],i,o[0],a[0]),p=Zr(d,r[1],i,o[1],a[1]);return[...e.slice(0,2),...l?[s,f,p]:[f,p,s]]}}Zj.className="ConvRNN2D";class Fw extends rx{constructor(e){const{filters:t,kernelSize:s,strides:r,padding:i,dataFormat:o,dilationRate:a}=e;super(Object.assign(Object.assign({},e),{units:t})),this.filters=t,_n(this.filters,"filters"),this.kernelSize=ec(s,2,"kernelSize"),this.kernelSize.forEach(l=>_n(l,"kernelSize")),this.strides=ec(r||1,2,"strides"),this.strides.forEach(l=>_n(l,"strides")),this.padding=i||"valid",cr(this.padding),this.dataFormat=o||"channelsLast",gn(this.dataFormat),this.dilationRate=ec(a||1,2,"dilationRate"),this.dilationRate.forEach(l=>_n(l,"dilationRate"))}build(e){var t;e=Ct(e);const s=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[s]==null)throw new te(`The channel dimension of the input should be defined. Found ${e[s]}`);const r=e[s],i=4,o=this.kernelSize.concat([r,this.filters*i]);this.kernel=this.addWeight("kernel",o,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);const a=this.kernelSize.concat([this.filters,this.filters*i]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",a,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){let l;if(this.unitForgetBias){const u=this.biasInitializer,d=this.filters;l=new(t=class extends jr{apply(p,g){const x=u.apply([d]),y=na([d]),b=u.apply([d*2]);return bw([x,y,b])}},t.className="CustomInit",t)}else l=this.biasInitializer;this.bias=this.addWeight("bias",[this.filters*i],null,l,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}call(e,t){return de(()=>{if(e.length!==3)throw new te(`ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);const s=t.training||!1,r=e[0],i=e[1],o=e[2],a=4;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Ko({ones:()=>$r(r),rate:this.dropout,training:s,count:a,dropoutFunc:this.dropoutFunc}));const l=this.dropoutMask,u=(Q,z,K)=>!z||!z[K]?Q:ne(z[K],Q);let d=u(r,l,0),f=u(r,l,1),p=u(r,l,2),g=u(r,l,3);0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Ko({ones:()=>$r(i),rate:this.recurrentDropout,training:s,count:a,dropoutFunc:this.dropoutFunc}));const x=this.recurrentDropoutMask;let y=u(i,x,0),b=u(i,x,1),k=u(i,x,2),w=u(i,x,3);const N=3,[C,S,T,A]=or(this.kernel.read(),a,N),[E,M,P,R]=this.useBias?or(this.bias.read(),a):[null,null,null,null];d=this.inputConv(d,C,E,this.padding),f=this.inputConv(f,S,M,this.padding),p=this.inputConv(p,T,P,this.padding),g=this.inputConv(g,A,R,this.padding);const[L,_,O,U]=or(this.recurrentKernel.read(),a,N);y=this.recurrentConv(y,L),b=this.recurrentConv(b,_),k=this.recurrentConv(k,O),w=this.recurrentConv(w,U);const W=this.recurrentActivation.apply($e(d,y)),H=this.recurrentActivation.apply($e(f,b)),G=$e(ne(H,o),ne(W,this.activation.apply($e(p,k)))),q=ne(this.recurrentActivation.apply($e(g,w)),this.activation.apply(G));return[q,q,G]})}getConfig(){const e=super.getConfig(),{units:t}=e,s=OH(e,["units"]),r={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign(Object.assign({},s),r)}inputConv(e,t,s,r){const i=Ha(e,t,this.strides,r||"valid",this.dataFormat==="channelsFirst"?"NCHW":"NHWC",this.dilationRate);return s?oi(i,s,this.dataFormat):i}recurrentConv(e,t){return Ha(e,t,1,"same",this.dataFormat==="channelsFirst"?"NCHW":"NHWC")}}Fw.className="ConvLSTM2DCell";Se(Fw);class Jj extends Zj{constructor(e){const t=new Fw(e);super(Object.assign(Object.assign({},e),{cell:t}))}static fromConfig(e,t){return new e(t)}}Jj.className="ConvLSTM2D";Se(Jj);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class ix extends ft{constructor(e){super(e),this.rate=Math.max(Math.min(e.rate,1),0),this.noiseShape=e.noiseShape,this.seed=e.seed,this.supportsMasking=!0}getNoiseShape(e){if(this.noiseShape==null)return this.noiseShape;const t=e.shape,s=[];for(let r=0;r<this.noiseShape.length;++r)s.push(this.noiseShape[r]==null?t[r]:this.noiseShape[r]);return s}call(e,t){return de(()=>{this.invokeCallHook(e,t);const s=nt(e);if(0<this.rate&&this.rate<1){const r=t.training==null?!1:t.training,i=this.getNoiseShape(s);return Nh(()=>WA(s,this.rate,i,this.seed),()=>s,r)}return e})}getConfig(){const e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},t=super.getConfig();return Object.assign(e,t),e}dispose(){return super.dispose()}}ix.className="Dropout";Se(ix);class eR extends ix{constructor(e){super(e),this.inputSpec=[{ndim:3}]}getNoiseShape(e){const t=e.shape;return[t[0],1,t[2]]}}eR.className="SpatialDropout1D";Se(eR);class Ow extends ft{constructor(e){if(super(e),this.activation=null,this.useBias=!0,this.kernel=null,this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.batchInputShape==null&&e.inputShape==null&&e.inputDim!=null){let t=null;e.batchSize!=null&&(t=e.batchSize),this.batchInputShape=[t,e.inputDim]}this.units=e.units,_n(this.units,"units"),this.activation=qo(e.activation),e.useBias!=null&&(this.useBias=e.useBias),this.kernelInitializer=Kt(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.biasInitializer=Kt(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelConstraint=$n(e.kernelConstraint),this.biasConstraint=$n(e.biasConstraint),this.kernelRegularizer=Qt(e.kernelRegularizer),this.biasRegularizer=Qt(e.biasRegularizer),this.activityRegularizer=Qt(e.activityRegularizer),this.supportsMasking=!0,this.inputSpec=[{minNDim:2}]}build(e){e=Ct(e);const t=e[e.length-1];this.kernel==null&&(this.kernel=this.addWeight("kernel",[t,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:{[-1]:t}}],this.built=!0}computeOutputShape(e){e=Ct(e);const t=e.slice();return t[t.length-1]=this.units,t}call(e,t){return de(()=>{this.invokeCallHook(e,t);const s=nt(e),r=MA(this.activation.getClassName());let i;return r!=null?i=Ni(s,this.kernel.read(),r,this.bias?this.bias.read():null):(i=Ni(s,this.kernel.read()),this.bias!=null&&(i=oi(i,this.bias.read())),this.activation!=null&&(i=this.activation.apply(i))),i})}getConfig(){const e={units:this.units,activation:Ho(this.activation),useBias:this.useBias,kernelInitializer:Jt(this.kernelInitializer),biasInitializer:Jt(this.biasInitializer),kernelRegularizer:Lt(this.kernelRegularizer),biasRegularizer:Lt(this.biasRegularizer),activityRegularizer:Lt(this.activityRegularizer),kernelConstraint:Tn(this.kernelConstraint),biasConstraint:Tn(this.biasConstraint)},t=super.getConfig();return Object.assign(e,t),e}}Ow.className="Dense";Se(Ow);class tR extends ft{constructor(e){e=e||{},super(e),this.inputSpec=[{minNDim:3}],this.dataFormat=e.dataFormat}computeOutputShape(e){e=Ct(e);for(const t of e.slice(1))if(t==null)throw new te(`The shape of the input to "Flatten" is not fully defined (got ${e.slice(1)}). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.`);return[e[0],Wo(e,1)]}call(e,t){return de(()=>{this.invokeCallHook(e,t);let s=nt(e);if(this.dataFormat==="channelsFirst"&&s.rank>1){const r=[0];for(let i=2;i<s.rank;++i)r.push(i);r.push(1),s=bt(s,r)}return p8(s)})}getConfig(){const e={};this.dataFormat!=null&&(e.dataFormat=this.dataFormat);const t=super.getConfig();return Object.assign(e,t),e}}tR.className="Flatten";Se(tR);class nR extends ft{constructor(e){super(e),this.supportsMasking=!0,this.activation=qo(e.activation)}call(e,t){return de(()=>{this.invokeCallHook(e,t);const s=nt(e);return this.activation.apply(s)})}getConfig(){const e={activation:Ho(this.activation)},t=super.getConfig();return Object.assign(e,t),e}}nR.className="Activation";Se(nR);class sR extends ft{constructor(e){super(e),this.n=e.n,this.inputSpec=[{ndim:2}]}computeOutputShape(e){return[e[0],this.n,e[1]]}call(e,t){return de(()=>(e=nt(e),h8(e,this.n)))}getConfig(){const e={n:this.n},t=super.getConfig();return Object.assign(e,t),e}}sR.className="RepeatVector";Se(sR);class rR extends ft{constructor(e){super(e),this.targetShape=e.targetShape;for(let t=0;t<this.targetShape.length;++t)this.isUnknown(this.targetShape[t])&&(this.targetShape[t]=null)}isUnknown(e){return e<0||e==null}fixUnknownDimension(e,t){const s="Total size of new array must be unchanged.",r=t.slice();let i=1,o=null;for(let l=0;l<r.length;++l){const u=r[l];if(this.isUnknown(u))if(o===null)o=l;else throw new te("Can only specifiy one unknown dimension.");else i*=u}const a=Wo(e);if(o!==null){if(i===0||a%i!==0)throw new te(s);r[o]=a/i}else if(a!==i)throw new te(s);return r}computeOutputShape(e){let t=!1;for(let s=0;s<e.length;++s)if(this.isUnknown(e[s])){t=!0;break}return t?e.slice(0,1).concat(this.targetShape):e.slice(0,1).concat(this.fixUnknownDimension(e.slice(1),this.targetShape))}call(e,t){return de(()=>{this.invokeCallHook(e,t);const s=nt(e),r=s.shape,i=r.slice(0,1).concat(this.fixUnknownDimension(r.slice(1),this.targetShape));return ie(s,i)})}getConfig(){const e={targetShape:this.targetShape},t=super.getConfig();return Object.assign(e,t),e}}rR.className="Reshape";Se(rR);class iR extends ft{constructor(e){if(super(e),e.dims==null)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(e.dims))throw new Error(`Permute constructor requires \`dims\` to be an Array, but received ${e.dims} instead.`);const t=ni(1,e.dims.length+1);if(!At(e.dims.slice().sort(),t))throw new Error("Invalid permutation `dims`: "+JSON.stringify(e.dims)+" `dims` must contain consecutive integers starting from 1.");this.dims=e.dims,this.dimsIncludingBatch=[0].concat(this.dims),this.inputSpec=[new In({ndim:this.dims.length+1})]}computeOutputShape(e){e=Ct(e);const t=e.slice();return this.dims.forEach((s,r)=>{t[r+1]=e[s]}),t}call(e,t){return bt(nt(e),this.dimsIncludingBatch)}getConfig(){const e={dims:this.dims},t=super.getConfig();return Object.assign(e,t),e}}iR.className="Permute";Se(iR);class oR extends ft{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null?this.maskValue=e.maskValue==null?0:e.maskValue:this.maskValue=0}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={maskValue:this.maskValue};return Object.assign(t,e),t}computeMask(e,t){const s=nt(e);return kv(Zp(s,this.maskValue),-1)}call(e,t){return de(()=>{this.invokeCallHook(e,t);const s=nt(e),o=kv(Zp(s,this.maskValue),-1,!0);return ne(s,Fe(o,s.dtype))})}}oR.className="Masking";Se(oR);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class aR extends ft{constructor(e){if(super(e),this.embeddings=null,this.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",e.batchInputShape==null&&e.inputShape==null){let t=null;e.batchSize!=null&&(t=e.batchSize),e.inputLength==null?this.batchInputShape=[t,null]:this.batchInputShape=[t].concat(jt(e.inputLength))}this.inputDim=e.inputDim,_n(this.inputDim,"inputDim"),this.outputDim=e.outputDim,_n(this.outputDim,"outputDim"),this.embeddingsInitializer=Kt(e.embeddingsInitializer||this.DEFAULT_EMBEDDINGS_INITIALIZER),this.embeddingsRegularizer=Qt(e.embeddingsRegularizer),this.activityRegularizer=Qt(e.activityRegularizer),this.embeddingsConstraint=$n(e.embeddingsConstraint),this.maskZero=e.maskZero,this.supportsMasking=e.maskZero,this.inputLength=e.inputLength}build(e){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}warnOnIncompatibleInputShape(e){}computeMask(e,t){return de(()=>this.maskZero?(e=nt(e),Zp(e,wt(e))):null)}computeOutputShape(e){if(e=Ct(e),this.inputLength==null)return[...e,this.outputDim];const t=jt(this.inputLength);if(t.length!==e.length-1)throw new te(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);{let s=0;for(let r=0;r<t.length;++r){const i=t[r],o=e[r+1];if(i!=null&&o!=null&&i!==o)throw new te(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);i==null&&(t[s]=o),s++}}return[e[0],...t,this.outputDim]}call(e,t){return de(()=>{this.invokeCallHook(e,t);let s=nt(e);s.dtype!=="int32"&&(s=Si(s,"int32"));const r=BA(this.embeddings.read(),ie(s,[s.size]));return ie(r,Ct(this.computeOutputShape(s.shape)))})}getConfig(){const e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:Jt(this.embeddingsInitializer),embeddingsRegularizer:Lt(this.embeddingsRegularizer),activityRegularizer:Lt(this.activityRegularizer),embeddingsConstraint:Tn(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},t=super.getConfig();return Object.assign(e,t),e}}aR.className="Embedding";Se(aR);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class ol extends ft{constructor(e){super(e||{}),this.supportsMasking=!0}mergeFunction(e){throw new at}computeElementwiseOpOutputShape(e,t){if(e==null||t==null)return null;if(e.length<t.length)return this.computeElementwiseOpOutputShape(t,e);if(t.length===0)return e;const s=e.slice(0,e.length-t.length);for(let r=0;r<t.length;++r){const i=e[e.length-t.length+r],o=t[r];if(i==null||o==null||i<0||o<0)s.push(null);else if(i===1)s.push(o);else if(o===1)s.push(i);else{if(i!==o)throw new te("Operands could not be broadcast together with shapes "+JSON.stringify(e)+" "+JSON.stringify(t));s.push(i)}}return s}build(e){if(Array.isArray(e)&&!Array.isArray(e[0])&&(e=[Ct(e)]),e=e,e.length<2)throw new te(`A merge layer should be called on an Array of at least 2 inputs. Got ${e.length} input(s).`);let t=[];for(const i of e)i!=null&&i[0]!==null&&t.push(i[0]);if(t=Bo(t),t.length>1)throw new te(`Can not merge tensors with different batch sizes. Got tensors with shapes: ${JSON.stringify(e)}.`);let s=e[0]==null?null:e[0].slice(1);for(let i=1;i<e.length;++i){const o=e[i]==null?null:e[i].slice(1);s=this.computeElementwiseOpOutputShape(s,o)}const r=e.map(i=>i.length);e.indexOf(null)===-1&&Bo(r).length===1?this.reshapeRequired=!1:this.reshapeRequired=!0}call(e,t){return de(()=>{if(e=e,this.reshapeRequired){const s=[],r=e.map(i=>i.rank);if(r.indexOf(null)===-1){const i=Go(r);for(let o of e){const a=o.rank;for(let l=0;l<i-a;++l)o=Ch(o,1);s.push(o)}return this.mergeFunction(s)}else{let i=!1;for(const l of e){const u=l.rank;if(u==null){const d=l.shape,f=d[0],p=d.slice(1).concat([f]);let g=ie(l,[f].concat(Wo(d.slice(1))));g=bt(g,[1,0]),g=ie(g,p),s.push(g),i=!0}else if(u>1){const d=ni(1,u).concat([0]);s.push(bt(l,d)),i=!0}else s.push(l)}let o=this.mergeFunction(s);const a=o.rank;if(i){if(a==null){const l=o.shape,u=l.length,d=l[u-1],f=[d].concat(l.slice(0,l.length-1));o=ie(bt(ie(o,[-1,d]),[1,0]),f)}else if(a>1){const l=[a-1].concat(ni(0,a-1));o=bt(o,l)}}return o}}else return this.mergeFunction(e)})}computeOutputShape(e){e=e;let t;e[0]==null?t=null:t=e[0].slice(1);for(let r=1;r<e.length;++r){const i=e[r]==null?null:e[r].slice(1);t=this.computeElementwiseOpOutputShape(t,i)}let s=[];for(const r of e)r!=null&&r[0]!==null&&s.push(r[0]);return s=Bo(s),s.length===1?t=s.concat(t):t=[null].concat(t),t}computeMask(e,t){return de(()=>{if(t==null)return null;if(!Array.isArray(t))throw new te("`mask` should be an Array");if(!Array.isArray(e))throw new te("`inputs` should be an Array");if(t.length!==e.length)throw new te(`The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths (${e.length} vs ${t.length})`);if(t.every(r=>r==null))return null;t=t.map(r=>r==null?r:Es(r,0));let s=t[0];for(let r=1;r<t.length-1;++r)s=to(s,t[r]);return s})}}class lR extends ol{constructor(e){super(e)}mergeFunction(e){return de(()=>{let t=e[0].clone();for(let s=1;s<e.length;++s)t=$e(t,e[s]);return t})}}lR.className="Add";Se(lR);class cR extends ol{constructor(e){super(e)}mergeFunction(e){return de(()=>{let t=e[0].clone();for(let s=1;s<e.length;++s)t=ne(t,e[s]);return t})}}cR.className="Multiply";Se(cR);class uR extends ol{constructor(e){super(e)}mergeFunction(e){return de(()=>{let t=e[0].clone();for(let s=1;s<e.length;++s)t=$e(t,e[s]);return ne(1/e.length,t)})}}uR.className="Average";Se(uR);class dR extends ol{constructor(e){super(e)}mergeFunction(e){return de(()=>{let t=e[0];for(let s=1;s<e.length;++s)t=ta(t,e[s]);return t})}}dR.className="Maximum";Se(dR);class hR extends ol{constructor(e){super(e)}mergeFunction(e){return de(()=>{let t=e[0];for(let s=1;s<e.length;++s)t=ed(t,e[s]);return t})}}hR.className="Minimum";Se(hR);class fR extends ol{constructor(e){super(e),this.DEFAULT_AXIS=-1,e==null&&(e={}),this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){if(!(Array.isArray(e)&&Array.isArray(e[0]))||e.length===1)throw new te("A `Concatenate` layer should be called on a list of at least 2 inputs");e=e;let t=!0;for(const r of e)if(r!=null){t=!1;break}if(t)return;const s=[];for(let r=0;r<e.length;++r){const i=e[r].slice();i.splice(this.axis,1);let o=!1;for(const a of s)if(At(a,i)){o=!0;break}o||s.push(i)}if(s.length>1)throw new te("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(e))}mergeFunction(e){return de(()=>bw(e,this.axis))}computeOutputShape(e){if(!(Array.isArray(e)&&Array.isArray(e[0])))throw new te("A `Concatenate` layer should be called on a list of inputs.");const t=e,s=t[0].slice(),r=this.axis<0?s.length+this.axis:this.axis;for(const i of t.slice(1)){if(s[r]==null||i[r]==null){s[r]=null;break}s[r]+=i[r]}return s}computeMask(e,t){if(t==null)return null;if(!Array.isArray(t))throw new te("`mask` should be an array for Concatenate");if(!Array.isArray(e))throw new te("`inputs` should be an array for Concatenate");if(t.length!==e.length)throw new te(`Mismatch in the length of mask (${t.length}) and the legnth of inputs (${e.length})`);return de(()=>{let s=!0;if(t.forEach(o=>{if(o!=null){s=!1;return}}),s)return null;const r=[];for(let o=0;o<e.length;++o)t[o]==null?r.push(Fe($r(e[o]),"bool")):t[o].rank<e[o].rank?r.push(Es(t[o],-1)):r.push(t[o]);const i=Rs(r,this.axis);return fE(i,-1,!1)})}getConfig(){const e={axis:this.axis},t=super.getConfig();return Object.assign(e,t),e}}fR.className="Concatenate";Se(fR);function Eu(n,e){for(;n<0;)n+=e;return n}function _H(n,e,t){if(n.shape.length>3||e.shape.length>3)throw new at("batchDot is not implemented for tensors of 4D or higher rank yet");if(V(n.shape.length>=2,()=>`batchDot requires the rank of x to be >= 2, but got ${n.shape.length}`),V(n.shape.length>=2,()=>`batchDot requires the rank of y to be >= 2, but got ${e.shape.length}`),typeof t=="number"&&(t=[t,t]),n.dtype==="complex64"||e.dtype==="complex64")throw new at("batchDot is not implemented for complex64-type Tensors yet.");const s=n.shape.length,r=e.shape.length;t==null&&(t=[s-1,r-2]);const i=t;return de(()=>{let o;if(s>r){o=s-r;const l=[];for(let u=0;u<o;++u)l.push(1);e=ie(e,e.shape.concat(l))}else if(r>s){o=r-s;const l=[];for(let u=0;u<o;++u)l.push(1);n=ie(n,n.shape.concat(l))}else o=0;let a;if(n.shape.length===2&&e.shape.length===2)i[0]===i[1]?a=Ye(ne(n,e),i[0]):a=Ye(ne(bt(n,[1,0]),e),i[1]);else{const l=i[0]!==n.shape.length-1,u=i[1]===e.shape.length-1;a=Tt(n,e,l,u)}if(o>0){let l;s>r?l=s+r-3:l=s-1;const u=[];for(let d=l;d<l+o;++d)u.push(d);a=xh(a,u)}return a.shape.length===1&&(a=Es(a,1)),a})}class pR extends ol{constructor(e){super(e),this.axes=e.axes,this.normalize=e.normalize==null?!1:e.normalize,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){V(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const t=e[0],s=e[1];if(t.length>3||s.length>3)throw new at("Dot layer does not support tensors of 4D or higher rank yet.");const r=this.interpretAxes(t,s);if(t[r[0]]!==s[r[1]])throw new te(`Dimension incompatibility: ${t[r[0]]} !== ${s[r[1]]}`)}mergeFunction(e){if(e.length!==2)throw new te(`A \`Dot\` layer must be called on exactly 2 inputs, but received ${e.length} input(s).`);let t=e[0],s=e[1],r;return Array.isArray(this.axes)?r=this.axes.map((i,o)=>Eu(i,e[o].shape.length)):r=[Eu(this.axes,t.shape.length),Eu(this.axes,s.shape.length)],this.normalize&&(t=im(t,r[0]),s=im(s,r[1])),_H(t,s,r)}interpretAxes(e,t){let s;return Array.isArray(this.axes)?s=this.axes:s=[Eu(this.axes,e.length),Eu(this.axes,t.length)],s}computeOutputShape(e){V(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const t=e[0].slice(),s=e[1].slice();if(t.length>3||s.length>3)throw new at("Dot layer does not support tensors of 4D or higher rank yet.");const r=this.interpretAxes(t,s);t.splice(r[0],1),s.splice(r[1],1),s.splice(0,1);const i=t.concat(s);return i.length===1&&i.push(1),i}computeMask(e,t){return null}getConfig(){const e={axes:this.axes,normalize:this.normalize},t=super.getConfig();return Object.assign(e,t),e}}pR.className="Dot";Se(pR);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class mR extends ft{constructor(e){super(e),this.supportsMasking=!0,this.stddev=e.stddev}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={stddev:this.stddev};return Object.assign(t,e),t}call(e,t){return de(()=>{this.invokeCallHook(e,t);const s=nt(e);return Nh(()=>$e(Yg(s.shape,0,this.stddev),s),()=>s,t.training||!1)})}}mR.className="GaussianNoise";Se(mR);class gR extends ft{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={rate:this.rate};return Object.assign(t,e),t}call(e,t){return de(()=>{this.invokeCallHook(e,t);const s=nt(e);return this.rate>0&&this.rate<1?Nh(()=>{const i=Math.sqrt(this.rate/(1-this.rate));return ne(s,Yg(s.shape,1,i))},()=>s,t.training||!1):s})}}gR.className="GaussianDropout";Se(gR);class xR extends ft{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate,this.noiseShape=e.noiseShape}_getNoiseShape(e){return this.noiseShape||nt(e).shape}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={rate:this.rate};return Object.assign(t,e),t}call(e,t){return de(()=>{if(this.rate<1&&this.rate>0){const s=this._getNoiseShape(e);return Nh(()=>{const i=nt(e),a=-1.6732632423543772*1.0507009873554805;let l=nl(gh(s),this.rate);l=Si(l,"float32");const u=((1-this.rate)*(1+this.rate*a**2))**-.5,d=-u*a*this.rate,f=$e(ne(i,l),ne($e(l,-1),a));return $e(ne(f,u),d)},()=>nt(e),t.training||!1)}return e})}}xR.className="AlphaDropout";Se(xR);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function rd(n,e,t,s,r,i=.001){let o;if(n.rank===2)o=a5(n,e,t,s,r,i);else if(n.rank===3)o=c5(n,e,t,s,r,i);else if(n.rank===4)o=d5(n,e,t,s,r,i);else throw new at(`batchNormalization is not implemented for array of rank ${n.rank} yet`);return o}function zH(n,e,t,s,r=.001){return de(()=>{const i=T1(n,s),o=i.mean,a=i.variance;return[rd(n,o,a,t,e,r),o,a]})}function BH(n,e,t,s,r=.001){return de(()=>{const i=T1(n,s),o=i.mean,a=i.variance,l=[];for(const x of ni(0,n.rank))s.indexOf(x)!==-1?l.push(1):l.push(n.shape[x]);const u=ie(o,l),d=ie(a,l),f=e==null?null:ie(e,l),p=t==null?null:ie(t,l);return[rd(n,u,d,p,f,r),o,a]})}function WH(n,e,t,s,r=.001){return At(s.slice().sort(),ni(0,n.rank-1))?zH(n,e,t,s,r):BH(n,e,t,s,r)}class yR extends ft{constructor(e){e==null&&(e={}),super(e),this.supportsMasking=!0,this.axis=e.axis==null?-1:e.axis,this.momentum=e.momentum==null?.99:e.momentum,this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=Kt(e.betaInitializer||"zeros"),this.gammaInitializer=Kt(e.gammaInitializer||"ones"),this.movingMeanInitializer=Kt(e.movingMeanInitializer||"zeros"),this.movingVarianceInitializer=Kt(e.movingVarianceInitializer||"ones"),this.betaConstraint=$n(e.betaConstraint),this.gammaConstraint=$n(e.gammaConstraint),this.betaRegularizer=Qt(e.betaRegularizer),this.gammaRegularizer=Qt(e.gammaRegularizer)}build(e){e=Ct(e);const t=this.axis>=0?this.axis:this.axis+e.length,s=e[t];if(s==null)throw new te(`Axis ${t} of input tensor should have a defined dimension but the layer received an input with shape ${JSON.stringify(e)}.`);this.inputSpec=[new In({ndim:e.length,axes:{[t]:s}})];const r=[s];this.scale&&(this.gamma=this.addWeight("gamma",r,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",r,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",r,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",r,null,this.movingVarianceInitializer,null,!1),this.built=!0}call(e,t){return de(()=>{const s=t.training==null?!1:t.training,r=nt(e),i=r.shape,o=i.length,a=ni(0,o),l=this.axis>=0?this.axis:this.axis+o;a.splice(l,1);const u=Xa(1,o);u[l]=i[l];const d=a.slice();d.sort();const f=!At(d,ni(0,o).slice(0,o-1)),p=()=>{if(f){const w=ie(this.movingMean.read(),u),N=ie(this.movingVariance.read(),u),C=this.center?ie(this.beta.read(),u):null,S=this.scale?ie(this.gamma.read(),u):null;return rd(r,w,N,C,S,this.epsilon)}else return rd(r,this.movingMean.read(),this.movingVariance.read(),this.beta==null?null:this.beta.read(),this.gamma==null?null:this.gamma.read(),this.epsilon)};if(!s)return p();const[g,x,y]=WH(r,this.gamma.read(),this.beta.read(),a,this.epsilon),b=(w,N,C)=>{de(()=>{const S=1-C,T=w.read(),A=ne(tt(T,N),S);w.write(tt(T,A))})};return(()=>{b(this.movingMean,x,this.momentum),b(this.movingVariance,y,this.momentum)})(),g})}getConfig(){const e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Jt(this.betaInitializer),gammaInitializer:Jt(this.gammaInitializer),movingMeanInitializer:Jt(this.movingMeanInitializer),movingVarianceInitializer:Jt(this.movingVarianceInitializer),betaRegularizer:Lt(this.betaRegularizer),gammaRegularizer:Lt(this.gammaRegularizer),betaConstraint:Tn(this.betaConstraint),gammaConstraint:Tn(this.gammaConstraint)},t=super.getConfig();return Object.assign(e,t),e}}yR.className="BatchNormalization";Se(yR);class vR extends ft{constructor(e){if(e==null&&(e={}),super(e),this.axis=e.axis==null?-1:e.axis,typeof this.axis=="number"){if(!Number.isInteger(this.axis))throw new Error(`Expected axis to be an integer, but received ${this.axis}`)}else if(Array.isArray(this.axis)){for(const t of this.axis)if(!Number.isInteger(t))throw new Error(`Expected axis to be an array of integers, but received ${JSON.stringify(this.axis)}`)}else throw new Error(`Expected axis to be an integer or an array of integers, but received ${JSON.stringify(this.axis)}`);this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=Kt(e.betaInitializer||"zeros"),this.gammaInitializer=Kt(e.gammaInitializer||"ones"),this.betaRegularizer=Qt(e.betaRegularizer),this.gammaRegularizer=Qt(e.gammaRegularizer),this.supportsMasking=!0}build(e){e=Ct(e);const t=e.length;typeof this.axis=="number"&&(this.axis=[this.axis]);for(let i=0;i<this.axis.length;++i)this.axis[i]<0&&(this.axis[i]+=t);for(const i of this.axis)if(i<0||i>=t)throw new Error(`Invalid axis: ${i}`);if(this.axis.length!==Bo(this.axis).length)throw new Error(`Found duplicate axes in: ${this.axis}`);const s=this.axis.map(i=>e[i]),r=!0;this.scale?this.gamma=this.addWeight("gamma",s,"float32",this.gammaInitializer,this.gammaRegularizer,r):this.gamma=null,this.center?this.beta=this.addWeight("beta",s,"float32",this.betaInitializer,this.betaRegularizer,r):this.beta=null,this.built=!0}call(e,t){const s=nt(e),r=s.shape,i=r.length;return de(()=>{let{mean:a,variance:l}=T1(s,this.axis,!0);const u=Xa(1,i);for(const y of this.axis)u[y]=r[y];const d=y=>y!=null&&y.shape.length!==i?ie(y,u):y;let f=this.scale?d(this.gamma.read()):null,p=this.center?d(this.beta.read()):null;const g=[],x=[];for(let y=0;y<i;++y)this.axis.indexOf(y)!==-1?(g.push(r[y]),x.push(1)):(g.push(1),x.push(r[y]));return a=Qr(a,g),l=Qr(l,g),f!=null&&(f=Qr(f,x)),p!=null&&(p=Qr(p,x)),rd(s,a,l,p,f,this.epsilon)})}getConfig(){const e={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Jt(this.betaInitializer),gammaInitializer:Jt(this.gammaInitializer),betaRegularizer:Lt(this.betaRegularizer),gammaRegularizer:Lt(this.gammaRegularizer)},t=super.getConfig();return Object.assign(e,t),e}}vR.className="LayerNormalization";Se(vR);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function VH(n,e,t){return de(()=>{if(n.rank!==4)throw new te(`temporalPadding expects input tensor to be 4-D, but received a ${n.rank}-D tensor.`);if(e==null&&(e=[[1,1],[1,1]]),e.length!==2||e[0].length!==2||e[1].length!==2)throw new te("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(t==null&&(t=si()),t!=="channelsLast"&&t!=="channelsFirst")throw new te(`Unknown data format: ${t}. Supported data formats are 'channelsLast' and 'channelsFirst.`);let s;return t==="channelsFirst"?s=[[0,0],[0,0],e[0],e[1]]:s=[[0,0],e[0],e[1],[0,0]],$1(n,s)})}class bR extends ft{constructor(e){if(e==null&&(e={}),super(e),this.dataFormat=e.dataFormat==null?si():e.dataFormat,e.padding==null)this.padding=[[1,1],[1,1]];else if(typeof e.padding=="number")this.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{if(e.padding=e.padding,e.padding.length!==2)throw new te(`ZeroPadding2D expects padding to be a length-2 array, but received a length-${e.padding.length} array.`);let t,s;if(typeof e.padding[0]=="number")t=[e.padding[0],e.padding[0]],s=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,e.padding[0].length!==2)throw new te(`ZeroPadding2D expects height padding to be a length-2 array, but received a length-${e.padding[0].length} array.`);if(t=e.padding[0],e.padding[1].length!==2)throw new te(`ZeroPadding2D expects width padding to be a length-2 array, but received a length-${e.padding[1].length} array.`);s=e.padding[1]}this.padding=[t,s]}this.inputSpec=[new In({ndim:4})]}computeOutputShape(e){e=Ct(e);let t,s;return this.dataFormat==="channelsFirst"?(e[2]!=null&&e[2]>=0?t=e[2]+this.padding[0][0]+this.padding[0][1]:t=null,e[3]!=null&&e[3]>=0?s=e[3]+this.padding[1][0]+this.padding[1][1]:s=null,[e[0],e[1],t,s]):(e[1]!=null&&e[1]>=0?t=e[1]+this.padding[0][0]+this.padding[0][1]:t=null,e[2]!=null&&e[2]>=0?s=e[2]+this.padding[1][0]+this.padding[1][1]:s=null,[e[0],t,s,e[3]])}call(e,t){return de(()=>VH(nt(e),this.padding,this.dataFormat))}getConfig(){const e={padding:this.padding,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}bR.className="ZeroPadding2D";Se(bR);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function ox(n,e,t,s,r,i){return de(()=>{gn(r),FA(i),cr(s),t==null&&(t=[1,1]),s==null&&(s="valid"),r==null&&(r=si()),i==null&&(i="max"),n=Dw(n,r);let o;const a=s==="same"?"same":"valid";return i==="max"?o=I1(n,e,t,a):o=g1(n,e,t,a),r==="channelsFirst"&&(o=bt(o,[0,3,1,2])),o})}function wR(n,e,t,s,r,i){return de(()=>{gn(r),FA(i),cr(s),t==null&&(t=[1,1,1]),s==null&&(s="valid"),r==null&&(r=si()),i==null&&(i="max"),n=_j(n,r);let o;const a=s==="same"?"same":"valid";return i==="max"?o=QB(n,e,t,a):o=Yz(n,e,t,a),r==="channelsFirst"&&(o=bt(o,[0,4,1,2,3])),o})}class kR extends ft{constructor(e){if(e.poolSize==null&&(e.poolSize=2),super(e),typeof e.poolSize=="number")this.poolSize=[e.poolSize];else if(Array.isArray(e.poolSize)&&e.poolSize.length===1&&typeof e.poolSize[0]=="number")this.poolSize=e.poolSize;else throw new te(`poolSize for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.poolSize)}`);if(_n(this.poolSize,"poolSize"),e.strides==null)this.strides=this.poolSize;else if(typeof e.strides=="number")this.strides=[e.strides];else if(Array.isArray(e.strides)&&e.strides.length===1&&typeof e.strides[0]=="number")this.strides=e.strides;else throw new te(`strides for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.strides)}`);_n(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,cr(this.padding),this.inputSpec=[new In({ndim:3})]}computeOutputShape(e){e=Ct(e);const t=Zr(e[1],this.poolSize[0],this.padding,this.strides[0]);return[e[0],t,e[2]]}call(e,t){return de(()=>{this.invokeCallHook(e,t),e=Ch(nt(e),2);const s=this.poolingFunction(nt(e),[this.poolSize[0],1],[this.strides[0],1],this.padding,"channelsLast");return xh(s,[2])})}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides},t=super.getConfig();return Object.assign(e,t),e}}class CR extends kR{constructor(e){super(e)}poolingFunction(e,t,s,r,i){return gn(i),cr(r),ox(e,t,s,r,i,"max")}}CR.className="MaxPooling1D";Se(CR);class SR extends kR{constructor(e){super(e)}poolingFunction(e,t,s,r,i){return gn(i),cr(r),ox(e,t,s,r,i,"avg")}}SR.className="AveragePooling1D";Se(SR);class NR extends ft{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==2)throw new te(`If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides];_n(this.poolSize,"poolSize"),_n(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,gn(this.dataFormat),cr(this.padding),this.inputSpec=[new In({ndim:4})]}computeOutputShape(e){e=Ct(e);let t=this.dataFormat==="channelsFirst"?e[2]:e[1],s=this.dataFormat==="channelsFirst"?e[3]:e[2];return t=Zr(t,this.poolSize[0],this.padding,this.strides[0]),s=Zr(s,this.poolSize[1],this.padding,this.strides[1]),this.dataFormat==="channelsFirst"?[e[0],e[1],t,s]:[e[0],t,s,e[3]]}call(e,t){return de(()=>(this.invokeCallHook(e,t),this.poolingFunction(nt(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class IR extends NR{constructor(e){super(e)}poolingFunction(e,t,s,r,i){return gn(i),cr(r),ox(e,t,s,r,i,"max")}}IR.className="MaxPooling2D";Se(IR);class TR extends NR{constructor(e){super(e)}poolingFunction(e,t,s,r,i){return gn(i),cr(r),ox(e,t,s,r,i,"avg")}}TR.className="AveragePooling2D";Se(TR);class $R extends ft{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==3)throw new te(`If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides,e.strides];_n(this.poolSize,"poolSize"),_n(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,gn(this.dataFormat),cr(this.padding),this.inputSpec=[new In({ndim:5})]}computeOutputShape(e){e=Ct(e);let t=this.dataFormat==="channelsFirst"?e[2]:e[1],s=this.dataFormat==="channelsFirst"?e[3]:e[2],r=this.dataFormat==="channelsFirst"?e[4]:e[3];return t=Zr(t,this.poolSize[0],this.padding,this.strides[0]),s=Zr(s,this.poolSize[1],this.padding,this.strides[1]),r=Zr(r,this.poolSize[2],this.padding,this.strides[2]),this.dataFormat==="channelsFirst"?[e[0],e[1],t,s,r]:[e[0],t,s,r,e[4]]}call(e,t){return de(()=>(this.invokeCallHook(e,t),this.poolingFunction(nt(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class ER extends $R{constructor(e){super(e)}poolingFunction(e,t,s,r,i){return gn(i),cr(r),wR(e,t,s,r,i,"max")}}ER.className="MaxPooling3D";Se(ER);class AR extends $R{constructor(e){super(e)}poolingFunction(e,t,s,r,i){return gn(i),cr(r),wR(e,t,s,r,i,"avg")}}AR.className="AveragePooling3D";Se(AR);class jR extends ft{constructor(e){super(e),this.inputSpec=[new In({ndim:3})]}computeOutputShape(e){return[e[0],e[2]]}call(e,t){throw new at}}class RR extends jR{constructor(e){super(e||{})}call(e,t){return de(()=>{const s=nt(e);return wn(s,1)})}}RR.className="GlobalAveragePooling1D";Se(RR);class DR extends jR{constructor(e){super(e||{})}call(e,t){return de(()=>{const s=nt(e);return Yr(s,1)})}}DR.className="GlobalMaxPooling1D";Se(DR);class PR extends ft{constructor(e){super(e),this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,gn(this.dataFormat),this.inputSpec=[new In({ndim:4})]}computeOutputShape(e){return e=e,this.dataFormat==="channelsLast"?[e[0],e[3]]:[e[0],e[1]]}call(e,t){throw new at}getConfig(){const e={dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class MR extends PR{call(e,t){return de(()=>{const s=nt(e);return this.dataFormat==="channelsLast"?wn(s,[1,2]):wn(s,[2,3])})}}MR.className="GlobalAveragePooling2D";Se(MR);class LR extends PR{call(e,t){return de(()=>{const s=nt(e);return this.dataFormat==="channelsLast"?Yr(s,[1,2]):Yr(s,[2,3])})}}LR.className="GlobalMaxPooling2D";Se(LR);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class FR extends ft{constructor(e){super(e),this.layer=e.layer}build(e){this.built=!0}get trainable(){return this.layer!=null?this.layer.trainable:!1}set trainable(e){this.layer!=null&&(this.layer.trainable=e)}get trainableWeights(){return this.layer.trainableWeights}get nonTrainableWeights(){return this.layer.nonTrainableWeights}get updates(){return this.layer._updates}get losses(){return this.layer.losses}getWeights(){return this.layer.getWeights()}setWeights(e){this.layer.setWeights(e)}getConfig(){const e={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},t=super.getConfig();return Object.assign(e,t),e}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.layer!=null&&this.layer.setFastWeightInitDuringBuild(e)}static fromConfig(e,t,s={}){const r=t.layer,i=Ii(r,s);delete t.layer;const o={layer:i};return Object.assign(o,t),new e(o)}}class OR extends FR{constructor(e){super(e),this.supportsMasking=!0}build(e){if(e=Ct(e),e.length<3)throw new te(`TimeDistributed layer expects an input shape >= 3D, but received input shape ${JSON.stringify(e)}`);this.inputSpec=[{shape:e}];const t=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(t),this.layer.built=!0),super.build(e)}computeOutputShape(e){e=Ct(e);const t=[e[0]].concat(e.slice(2)),s=this.layer.computeOutputShape(t),r=e[1];return[s[0],r].concat(s.slice(1))}call(e,t){return de(()=>(e=nt(e),Kj((o,a)=>[nt(this.layer.call(o,t)),[]],e,[],!1,null,null,!1,!0)[1]))}}OR.className="TimeDistributed";Se(OR);function UH(n){il(a8,"BidirectionalMergeMode",n)}const GH="concat";class _R extends FR{constructor(e){super(e);const t=e.layer.getConfig(),s={};s.className=e.layer.getClassName(),s.config=t,this.forwardLayer=Ii(s),t.goBackwards=t.goBackwards!==!0;const r={};if(r.className=e.layer.getClassName(),r.config=t,this.backwardLayer=Ii(r),this.forwardLayer.name="forward_"+this.forwardLayer.name,this.backwardLayer.name="backward_"+this.backwardLayer.name,this.mergeMode=e.mergeMode===void 0?GH:e.mergeMode,UH(this.mergeMode),e.weights)throw new at("weights support is not implemented for Bidirectional layer yet.");this._stateful=e.layer.stateful,this.returnSequences=e.layer.returnSequences,this.returnState=e.layer.returnState,this.supportsMasking=!0,this._trainable=!0,this.inputSpec=e.layer.inputSpec,this.numConstants=null}get trainable(){return this._trainable}set trainable(e){this._trainable=e,this.forwardLayer!=null&&(this.forwardLayer.trainable=e),this.backwardLayer!=null&&(this.backwardLayer.trainable=e)}getWeights(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}setWeights(e){const t=e.length,s=Math.floor(t/2);this.forwardLayer.setWeights(e.slice(0,s)),this.backwardLayer.setWeights(e.slice(s))}computeOutputShape(e){let t=this.forwardLayer.computeOutputShape(e);Array.isArray(t)&&Array.isArray(t[0])||(t=[t]),t=t;let s,r,i;return this.returnState&&(i=t.slice(1)),s=t[0],s=s,this.mergeMode==="concat"?(s[s.length-1]*=2,r=[s]):this.mergeMode==null?r=[s,s.slice()]:r=[s],this.returnState?this.mergeMode==null?r.concat(i).concat(i.slice()):[s].concat(i).concat(i.slice()):As(r)}apply(e,t){let s=t==null?null:t.initialState,r=t==null?null:t.constants;t==null&&(t={});const i=qj(e,s,r,this.numConstants);if(e=i.inputs,s=i.initialState,r=i.constants,Array.isArray(e)&&(s=e.slice(1),e=e[0]),(s==null||s.length===0)&&r==null)return super.apply(e,t);const o=[],a=[];if(s!=null){const u=s.length;if(u%2>0)throw new te("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");t.initialState=s,o.push(...s);const d=s.map(f=>new In({shape:f.shape}));this.forwardLayer.stateSpec=d.slice(0,u/2),this.backwardLayer.stateSpec=d.slice(u/2),a.push(...d)}if(r!=null)throw new at("Support for constants in Bidirectional layers is not implemented yet.");const l=o[0]instanceof Ai;for(const u of o)if(u instanceof Ai!==l)throw new te("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(l){const u=[e].concat(o),d=this.inputSpec.concat(a),f=this.inputSpec;this.inputSpec=d;const p=super.apply(u,t);return this.inputSpec=f,p}else return super.apply(e,t)}call(e,t){return de(()=>{const s=t.initialState;let r,i;if(s==null)r=this.forwardLayer.call(e,t),i=this.backwardLayer.call(e,t);else{const l=s.slice(0,s.length/2),u=s.slice(s.length/2);r=this.forwardLayer.call(e,Object.assign(t,{initialState:l})),i=this.backwardLayer.call(e,Object.assign(t,{initialState:u}))}let o;this.returnState&&(Array.isArray(r)&&(o=r.slice(1).concat(i.slice(1))),r=r[0],i=i[0]),this.returnSequences&&(i=Ka(i,1));let a;return this.mergeMode==="concat"?a=bw([r,i]):this.mergeMode==="sum"?a=$e(r,i):this.mergeMode==="ave"?a=ne(.5,$e(r,i)):this.mergeMode==="mul"?a=ne(r,i):this.mergeMode==null&&(a=[r,i]),this.returnState?this.mergeMode==null?a.concat(o):[a].concat(o):a})}resetStates(e){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}build(e){Ma(this.forwardLayer.name,()=>{this.forwardLayer.build(e)}),Ma(this.backwardLayer.name,()=>{this.backwardLayer.build(e)}),this.built=!0}computeMask(e,t){Array.isArray(t)&&(t=t[0]);let s;if(this.returnSequences?this.mergeMode==null?s=[t,t]:s=t:this.mergeMode==null?s=[null,null]:s=null,this.returnState){const i=this.forwardLayer.states.map(o=>null);return Array.isArray(s)?s.concat(i).concat(i):[s].concat(i).concat(i)}else return s}get trainableWeights(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}get nonTrainableWeights(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.forwardLayer!=null&&this.forwardLayer.setFastWeightInitDuringBuild(e),this.backwardLayer!=null&&this.backwardLayer.setFastWeightInitDuringBuild(e)}getConfig(){const e={mergeMode:this.mergeMode},t=super.getConfig();return Object.assign(e,t),e}static fromConfig(e,t){const s=Ii(t.layer);if(delete t.layer,t.numConstants!=null)throw new at("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");const r=t;return r.layer=s,new e(r)}}_R.className="Bidirectional";Se(_R);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class zR extends ft{constructor(e){super(e),this.scale=e.scale,e.offset?this.offset=e.offset:this.offset=0}getConfig(){const e={scale:this.scale,offset:this.offset},t=super.getConfig();return Object.assign(e,t),e}call(e,t){return de(()=>(e=nt(e),e.dtype!=="float32"&&(e=Si(e,"float32")),$e(ne(e,this.scale),this.offset)))}}zR.className="Rescaling";Se(zR);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const{resizeBilinear:HH,cropAndResize:qH}=Xi;class BR extends ft{constructor(e){super(e),this.height=e.height,this.width=e.width}centerCrop(e,t,s,r,i,o,a,l){return de(()=>{let u,d=!1;const f=t/o,p=s/a,g=(r+t)/o,x=(i+s)/a,y=[f,p,g,x],b=[];e.rank===3?(d=!0,u=no([e])):u=e;for(let S=0;S<u.shape[0];S++)b.push(y);const k=Uu(b,[b.length,4]),w=td(0,b.length,1,"int32"),C=qH(u,k,w,[r,i],"nearest");return Si(d?nt(Qa(C)):C,l)})}upsize(e,t,s,r){return de(()=>{const i=HH(e,[t,s]);return Si(i,r)})}call(e,t){return de(()=>{const s=nt(e),r=s.dtype,i=s.shape,o=i[i.length-3],a=i[i.length-2];let l=0;o!==this.height&&(l=Math.floor((o-this.height)/2));let u=0;return a!==this.width&&(u=Math.floor((a-this.width)/2),u===0&&(u=1)),l>=0&&u>=0?this.centerCrop(s,l,u,this.height,this.width,o,a,r):this.upsize(e,this.height,this.width,r)})}getConfig(){const e={height:this.height,width:this.width},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){e=Ct(e);const t=e.length-3,s=e.length-2;return e[t]=this.height,e[s]=this.width,e}}BR.className="CenterCrop";Se(BR);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function KH(n,e,t,s){let r=nt(n);if(r.dtype!=="int32"&&(r=Si(r,"int32")),e==="int")return r;const i=r.shape;if(r.rank===0&&(r=Es(r,-1)),e==="oneHot"&&r.shape[r.shape.length-1]!==1&&(r=Es(r,-1)),r.rank>2)throw new te(`When outputMode is not int, maximum output rank is 2 Received outputMode ${e} and input shape ${i} which would result in output rank ${r.rank}.`);const o=["multiHot","oneHot"].includes(e),a=r;let l;if(typeof s<"u"&&e==="count"?l=OS(a,s,t,o):l=OS(a,[],t,o),e!=="tfIdf")return l;if(s)return ne(l,s);throw new te("When outputMode is 'tfIdf', weights must be provided.")}/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class WR extends ft{constructor(e){super(e),this.numTokens=e.numTokens,e.outputMode?this.outputMode=e.outputMode:this.outputMode="multiHot"}getConfig(){const e={numTokens:this.numTokens,outputMode:this.outputMode},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){return e=Ct(e),e==null?[this.numTokens]:this.outputMode==="oneHot"&&e[e.length-1]!==1?(e.push(this.numTokens),e):(e[e.length-1]=this.numTokens,e)}call(e,t){return de(()=>{e=nt(e),e.dtype!=="int32"&&(e=Si(e,"int32"));let s;if(typeof t.countWeights<"u"){if(this.outputMode!=="count")throw new te(`countWeights is not used when outputMode !== count.
              Received countWeights=${t.countWeights}`);s=nt(t.countWeights)}const r=Yr(e),i=Xp(e),o=lr(this.numTokens,r).bufferSync().get(0),a=nl(i,0).bufferSync().get(0);if(!(o&&a))throw new te(`Input values must be between 0 < values <= numTokens with numTokens=${this.numTokens}`);return KH(e,this.outputMode,this.numTokens,s)})}}WR.className="CategoryEncoding";Se(WR);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const QH=["bilinear","nearest"],TN=new Set(QH);class VR extends ft{constructor(e){if(super(e),this.height=e.height,this.width=e.width,e.interpolation)if(TN.has(e.interpolation))this.interpolation=e.interpolation;else throw new te(`Invalid interpolation parameter: ${e.interpolation} is not implemented`);else this.interpolation="bilinear";this.cropToAspectRatio=!!e.cropToAspectRatio}computeOutputShape(e){e=Ct(e);const t=e[2];return[this.height,this.width,t]}getConfig(){const e={height:this.height,width:this.width,interpolation:this.interpolation,cropToAspectRatio:this.cropToAspectRatio},t=super.getConfig();return Object.assign(e,t),e}call(e,t){return de(()=>{const s=[this.height,this.width];if(this.interpolation==="bilinear")return Xi.resizeBilinear(e,s,!this.cropToAspectRatio);if(this.interpolation==="nearest")return Xi.resizeNearestNeighbor(e,s,!this.cropToAspectRatio);throw new Error(`Interpolation is ${this.interpolation} but only ${[...TN]} are supported`)})}}VR.className="Resizing";Se(VR);/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class UR{constructor(e){this.seed=e}next(){if(this.seed!==void 0)return this.seed++}}UR.className="RandomSeed";/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class GR extends ft{constructor(e){super(e),this.randomGenerator=new UR(e.seed)}getConfig(){const e={seed:this.randomGenerator.seed},t=super.getConfig();return Object.assign(e,t),e}}GR.className="BaseRandomLayer";/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const XH=["bilinear","nearest"],$N=new Set(XH);class HR extends GR{constructor(e){super(e);const{factor:t,interpolation:s="bilinear"}=e;if(this.factor=t,Array.isArray(this.factor)&&this.factor.length===2)this.widthLower=this.factor[0],this.widthUpper=this.factor[1];else if(!Array.isArray(this.factor)&&this.factor>0)this.widthLower=-this.factor,this.widthUpper=this.factor;else throw new te(`Invalid factor: ${this.factor}. Must be positive number or tuple of 2 numbers`);if(this.widthLower<-1||this.widthUpper<-1)throw new te(`factor must have values larger than -1. Got: ${this.factor}`);if(this.widthUpper<this.widthLower)throw new te(`factor cannot have upper bound less than lower bound.
        Got upper bound: ${this.widthUpper}.
        Got lower bound: ${this.widthLower}
      `);if(s)if($N.has(s))this.interpolation=s;else throw new te(`Invalid interpolation parameter: ${s} is not implemented`)}getConfig(){const e={factor:this.factor,interpolation:this.interpolation},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){e=Ct(e);const t=e[2];return[this.imgHeight,-1,t]}call(e,t){return de(()=>{const s=nt(e);this.imgHeight=s.shape[s.shape.length-3];const r=s.shape[s.shape.length-2];this.widthFactor=gh([1],1+this.widthLower,1+this.widthUpper,"float32",this.randomGenerator.next());let i=this.widthFactor.dataSync()[0]*r;i=Math.round(i);const o=[this.imgHeight,i];switch(this.interpolation){case"bilinear":return Xi.resizeBilinear(e,o);case"nearest":return Xi.resizeNearestNeighbor(e,o);default:throw new Error(`Interpolation is ${this.interpolation}
          but only ${[...$N]} are supported`)}})}}HR.className="RandomWidth";Se(HR);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Au(n){return new Ow(n)}function YH(n){return new ix(n)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZH=me();ZH.registerFlag("KEEP_INTERMEDIATE_TENSORS",()=>!1,n=>{n&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var EN;(function(n){n[n.DT_INVALID=0]="DT_INVALID",n[n.DT_FLOAT=1]="DT_FLOAT",n[n.DT_DOUBLE=2]="DT_DOUBLE",n[n.DT_INT32=3]="DT_INT32",n[n.DT_UINT8=4]="DT_UINT8",n[n.DT_INT16=5]="DT_INT16",n[n.DT_INT8=6]="DT_INT8",n[n.DT_STRING=7]="DT_STRING",n[n.DT_COMPLEX64=8]="DT_COMPLEX64",n[n.DT_INT64=9]="DT_INT64",n[n.DT_BOOL=10]="DT_BOOL",n[n.DT_QINT8=11]="DT_QINT8",n[n.DT_QUINT8=12]="DT_QUINT8",n[n.DT_QINT32=13]="DT_QINT32",n[n.DT_BFLOAT16=14]="DT_BFLOAT16",n[n.DT_QINT16=15]="DT_QINT16",n[n.DT_QUINT16=16]="DT_QUINT16",n[n.DT_UINT16=17]="DT_UINT16",n[n.DT_COMPLEX128=18]="DT_COMPLEX128",n[n.DT_HALF=19]="DT_HALF",n[n.DT_RESOURCE=20]="DT_RESOURCE",n[n.DT_VARIANT=21]="DT_VARIANT",n[n.DT_UINT32=22]="DT_UINT32",n[n.DT_UINT64=23]="DT_UINT64",n[n.DT_FLOAT_REF=101]="DT_FLOAT_REF",n[n.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",n[n.DT_INT32_REF=103]="DT_INT32_REF",n[n.DT_UINT8_REF=104]="DT_UINT8_REF",n[n.DT_INT16_REF=105]="DT_INT16_REF",n[n.DT_INT8_REF=106]="DT_INT8_REF",n[n.DT_STRING_REF=107]="DT_STRING_REF",n[n.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",n[n.DT_INT64_REF=109]="DT_INT64_REF",n[n.DT_BOOL_REF=110]="DT_BOOL_REF",n[n.DT_QINT8_REF=111]="DT_QINT8_REF",n[n.DT_QUINT8_REF=112]="DT_QUINT8_REF",n[n.DT_QINT32_REF=113]="DT_QINT32_REF",n[n.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",n[n.DT_QINT16_REF=115]="DT_QINT16_REF",n[n.DT_QUINT16_REF=116]="DT_QUINT16_REF",n[n.DT_UINT16_REF=117]="DT_UINT16_REF",n[n.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",n[n.DT_HALF_REF=119]="DT_HALF_REF",n[n.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",n[n.DT_VARIANT_REF=121]="DT_VARIANT_REF",n[n.DT_UINT32_REF=122]="DT_UINT32_REF",n[n.DT_UINT64_REF=123]="DT_UINT64_REF"})(EN||(EN={}));var AN;(function(n){(function(e){e[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"})(n.CheckpointFormatVersion||(n.CheckpointFormatVersion={}))})(AN||(AN={}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var jN;(function(n){n[n.FAIL=0]="FAIL",n[n.SHORTEST=1]="SHORTEST",n[n.LONGEST=2]="LONGEST"})(jN||(jN={}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function We(n,e){Array.isArray(n)||(n=[n]),n.forEach(t=>{t!=null&&V(t.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the CPU backend.`)})}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JH=BE;class ax extends vb{nextDataId(){return ax.nextDataId++}constructor(){super(),this.blockSize=48,this.firstUse=!0,this.data=new f$(this,pi())}write(e,t,s){this.firstUse&&(this.firstUse=!1,me().get("IS_NODE")&&rr(`
============================
Hi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. 
============================`));const r={id:this.nextDataId()};return this.data.set(r,{values:e,dtype:s,refCount:1}),r}makeTensorInfo(e,t,s){let r;if(t==="string"&&s!=null&&s.length>0&&yd(s[0])){const i=s.map(o=>zo(o));r=this.write(i,e,t)}else r=this.write(s,e,t);return{dataId:r,shape:e,dtype:t}}refCount(e){return this.data.has(e)?this.data.get(e).refCount:0}incRef(e){const t=this.data.get(e);t.refCount++}decRef(e){if(this.data.has(e)){const t=this.data.get(e);t.refCount--}}move(e,t,s,r,i){this.data.set(e,{values:t,dtype:r,refCount:i})}numDataIds(){return this.data.numDataIds()}async read(e){return this.readSync(e)}readSync(e){const{dtype:t,complexTensorInfos:s}=this.data.get(e);if(t==="complex64"){const r=this.readSync(s.real.dataId),i=this.readSync(s.imag.dataId);return so(r,i)}return ZO(this.data.get(e).values,t)}bufferSync(e){const t=this.readSync(e.dataId);if(e.dtype==="string")try{const s=t.map(r=>Uo(r));return dt(e.shape,e.dtype,s)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return dt(e.shape,e.dtype,t)}makeOutput(e,t,s){return pi().makeTensorFromTensorInfo(this.makeTensorInfo(t,s,e),this)}disposeData(e,t=!1){if(this.data.has(e)){if(this.data.get(e).refCount--,!t&&this.data.get(e).refCount>0)return!1;const{complexTensorInfos:s}=this.data.get(e);s!=null&&(this.disposeData(s.real.dataId,!0),this.disposeData(s.imag.dataId,!0)),this.data.delete(e)}return!0}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}async time(e){const t=$s();return e(),{kernelMs:$s()-t}}memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}where(e){We([e],"where");const t=this.readSync(e.dataId);return JH(e.shape,t)}dispose(){}floatPrecision(){return 32}epsilon(){return super.epsilon()}}ax.nextDataId=0;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qR(n){const e=new Float32Array(n.length);for(let t=0;t<n.length;++t)e[t]=Math.abs(n[t]);return e}const e9=n=>{const{x:e}=n.inputs,t=n.backend;We(e,"abs");let s=new Float32Array(be(e.shape));const r=t.data.get(e.dataId).values;return s=qR(r),t.makeOutput(s,e.shape,e.dtype)},t9={kernelName:Fm,backendName:"cpu",kernelFunc:e9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xn(n){return(e,t,s,r,i)=>{const o=ot(e,t),a=o.length,l=Qe(o),u=be(o),d=ts(i,u),f=e.length,p=t.length,g=Qe(e),x=Qe(t),y=cc(e,o),b=cc(t,o);if(y.length+b.length===0)for(let k=0;k<d.length;++k)d[k]=n(s[k%s.length],r[k%r.length]);else for(let k=0;k<d.length;++k){const w=Ic(k,a,l),N=w.slice(-f);y.forEach(A=>N[A]=0);const C=wi(N,f,g),S=w.slice(-p);b.forEach(A=>S[A]=0);const T=wi(S,p,x);d[k]=n(s[C],r[T])}return[d,o]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qs(n){const{inputs:e,backend:t}=n,{real:s,imag:r}=e,i=t.data.get(s.dataId).values,o=t.data.get(r.dataId).values,a=t.makeTensorInfo(s.shape,"complex64"),l=t.data.get(a.dataId);return l.complexTensorInfos={real:t.makeTensorInfo(s.shape,"float32",i),imag:t.makeTensorInfo(r.shape,"float32",o)},a}const n9={kernelName:Rb,backendName:"cpu",kernelFunc:qs};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dm(n,e,t="float32"){if(t==="complex64"){const r=dm(n,e,"float32"),i=dm(n,e,"float32");return qs({inputs:{real:r,imag:i},backend:n})}const s=ns(be(e),t);return n.makeTensorInfo(e,t,s)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ji(n){const{inputs:e,backend:t}=n,{x:s}=e;return t.incRef(s.dataId),{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}const s9={kernelName:_d,backendName:"cpu",kernelFunc:ji};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ya(n){const{inputs:e,backend:t}=n,{input:s}=e,r=t.data.get(s.dataId).complexTensorInfos.real,i=t.data.get(r.dataId).values;return t.makeTensorInfo(r.shape,r.dtype,i)}const r9={kernelName:n1,backendName:"cpu",kernelFunc:Ya};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KR(n,e,t,s){if(s==="int32"){const r=Int32Array.from(n);return[e,"int32",r]}if(s==="bool"){const r=tl([0],t),[i,o]=xn((a,l)=>a!==l?1:0)(e,[],n,r,"bool");return[o,"bool",i]}throw new Error(`Error in Cast: failed to cast ${t} to ${s}`)}function Qo(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{dtype:i}=s;if(i==="complex64"){if(r.dtype==="complex64")return ji({inputs:{x:r},backend:t});const d=dm(t,r.shape,r.dtype),f=Qo({inputs:{x:r},backend:t,attrs:{dtype:"float32"}}),p=qs({inputs:{real:f,imag:d},backend:t});return t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(f),p}if(r.dtype==="complex64"){const d=Ya({inputs:{input:r},backend:t}),f=Qo({inputs:{x:d},backend:t,attrs:{dtype:i}});return t.disposeIntermediateTensorInfo(d),f}if(!g$(r.dtype,i)){const d=ji({inputs:{x:r},backend:t});return{dataId:d.dataId,shape:d.shape,dtype:i}}const o=t.data.get(r.dataId).values,[a,l,u]=KR(o,r.shape,r.dtype,i);return t.makeTensorInfo(a,l,u)}const i9={kernelName:Id,backendName:"cpu",kernelFunc:Qo};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jn(n,e,t,s){return t==null?({inputs:r,backend:i})=>{const{a:o,b:a}=r,l=i;We([o,a],n);const u=l.data.get(o.dataId).values,d=l.data.get(a.dataId).values,f=o.dtype==="string"?ro(u):u,p=o.dtype==="string"?ro(d):d,g=s||o.dtype,[x,y]=e(o.shape,a.shape,f,p,g);return l.makeTensorInfo(y,g,x)}:({inputs:r,backend:i})=>{const{a:o,b:a}=r,l=i;if(o.dtype==="complex64"||a.dtype==="complex64"){const u=Qo({inputs:{x:o},backend:l,attrs:{dtype:"complex64"}}),d=l.data.get(u.dataId),f=d.complexTensorInfos.real,p=d.complexTensorInfos.imag,g=l.data.get(f.dataId).values,x=l.data.get(p.dataId).values,y=Qo({inputs:{x:a},backend:l,attrs:{dtype:"complex64"}}),b=l.data.get(y.dataId),k=b.complexTensorInfos.real,w=b.complexTensorInfos.imag,N=l.data.get(k.dataId).values,C=l.data.get(w.dataId).values,[S,T,A]=t(o.shape,a.shape,g,x,N,C),E=l.makeTensorInfo(A,"float32",S),M=l.makeTensorInfo(A,"float32",T),P=qs({inputs:{real:E,imag:M},backend:l});return l.disposeIntermediateTensorInfo(u),l.disposeIntermediateTensorInfo(y),l.disposeIntermediateTensorInfo(E),l.disposeIntermediateTensorInfo(M),P}else{const u=l.data.get(o.dataId).values,d=l.data.get(a.dataId).values,f=s||o.dtype,[p,g]=e(o.shape,a.shape,u,d,f);return l.makeTensorInfo(g,f,p)}}}function _w(n){return(e,t,s,r,i,o)=>{const a=ot(e,t),l=be(a),u=a.length,d=Qe(a),f=ts("float32",l),p=ts("float32",l),g=cc(e,a),x=cc(t,a),y=so(s,r),b=so(i,o),k=e.length,w=Qe(e),N=t.length,C=Qe(t);if(g.length+x.length===0)for(let S=0;S<f.length;S++){const T=S%y.length,A=S%b.length,E=n(y[T*2],y[T*2+1],b[A*2],b[A*2+1]);f[S]=E.real,p[S]=E.imag}else for(let S=0;S<f.length;S++){const T=Ic(S,u,d),A=T.slice(-k);g.forEach(L=>A[L]=0);const E=wi(A,k,w),M=T.slice(-N);x.forEach(L=>M[L]=0);const P=wi(M,N,C),R=n(y[E*2],y[E*2+1],b[P*2],b[P*2+1]);f[S]=R.real,p[S]=R.imag}return[f,p,a]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QR=xn(((n,e)=>n+e)),o9=_w(((n,e,t,s)=>({real:n+t,imag:e+s}))),fc=jn(Tc,QR,o9),a9={kernelName:Tc,backendName:"cpu",kernelFunc:fc};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zw(n,e,t,s,r){const i=be(s),o=ns(r,t);for(let a=0;a<n.length;a++){const l=n[a];if(l<0)throw new Error("Input x must be non-negative!");l>=r||(i>0?o[l]+=e[a]:o[l]+=1)}return o}function XR(n,e,t,s=!1){const r=n.shape[0],i=n.shape[1],o=dt([r,t],e.dtype);for(let a=0;a<r;a++)for(let l=0;l<i;l++){const u=n.get(a,l);if(u<0)throw new Error("Input x must be non-negative!");u>=t||(s?o.set(1,a,u):e.size>0?o.set(o.get(a,u)+e.get(a,l),a,u):o.set(o.get(a,u)+1,a,u))}return o}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YR=xn(((n,e)=>n&e)),l9=jn(jb,YR),c9={kernelName:jb,backendName:"cpu",kernelFunc:l9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ri(n){return(e,t,s)=>{const r=hn(t,e.length);for(let i=0;i<e.length;++i)r[i]=n(e[i],s);return r}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rt(n,e,t){const s=Ri(e);return ia(n,s,t)}function ia(n,e,t){return({inputs:s,attrs:r,backend:i})=>{const{x:o}=s;We(o,n);const a=i,l=a.data.get(o.dataId).values;let u;if(o.dtype==="string"){if(!Array.isArray(l))throw new Error("String tensor's value was not an instance of Array");u=ro(l)}else u=l;const d=t||o.dtype,f=e(u,d,r);return a.makeTensorInfo(o.shape,d,f)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZR=Ri(n=>Math.ceil(n)),u9=ia(Td,ZR),d9={kernelName:Td,backendName:"cpu",kernelFunc:u9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JR(n,e,t,s){const r=hn(t,be(e));if(s&&t!=="string"){let i=0;n.forEach(o=>{const a=be(o.shape);r.set(o.vals,i),i+=a})}else{let i=0;n.forEach(o=>{const a=t==="string"?ro(o.vals):o.vals;let l=0;for(let u=0;u<o.shape[0];++u){const d=u*e[1]+i;for(let f=0;f<o.shape[1];++f)r[d+f]=a[l++]}i+=o.shape[1]})}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eD=xn((n,e)=>n===e?1:0),tD=jn(Zm,eD,null,"bool"),h9={kernelName:Zm,backendName:"cpu",kernelFunc:tD};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nD=Ri(n=>Math.exp(n)),sD=ia(Pd,nD,"float32"),f9={kernelName:Pd,backendName:"cpu",kernelFunc:sD};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rD=Ri(n=>Math.expm1(n)),p9=ia(Md,rD),m9={kernelName:Md,backendName:"cpu",kernelFunc:p9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iD=Ri(n=>Math.floor(n)),g9=ia(Ld,iD),x9={kernelName:Ld,backendName:"cpu",kernelFunc:g9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oD=xn((n,e)=>Math.floor(n/e)),y9=jn(Fd,oD,null,"int32"),v9={kernelName:Fd,backendName:"cpu",kernelFunc:y9};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aD(n,e,t,s,r,i,o,a,l){const u=dt([s,i],t);for(let d=0;d<s;d++){const f=[];let p=0;for(let g=0;g<r;g++){const x=n[d*r+g];p+=x*o[g],f.push(x)}if(p<0||p>=l/i)throw new Error(`Invalid indices: ${f} does not index into ${a}`);for(let g=0;g<i;g++)u.values[d*i+g]=e.get(...e.indexToLoc(p*i+g))}return u}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lD(n,e,t){const s=dt(t,n.dtype);for(let r=0;r<s.size;++r){const o=s.indexToLoc(r).slice(),a=o[0],l=o[2],u=e.locToIndex([a,l]);o[2]=e.values[u];const d=n.locToIndex(o);0<=d&&d<n.values.length&&(s.values[r]=n.values[d])}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cD=xn((n,e)=>n>e?1:0),b9=jn(ng,cD,null,"bool"),w9={kernelName:ng,backendName:"cpu",kernelFunc:b9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uD=xn((n,e)=>n>=e?1:0),k9=jn(Od,uD,null,"bool"),C9={kernelName:Od,backendName:"cpu",kernelFunc:k9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dD=xn((n,e)=>n<e?1:0),S9=jn(rg,dD,null,"bool"),N9={kernelName:rg,backendName:"cpu",kernelFunc:S9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hD=xn((n,e)=>n<=e?1:0),I9=jn(ig,hD,null,"bool"),T9={kernelName:ig,backendName:"cpu",kernelFunc:I9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fD(n,e,t){const s=(e-n)/(t-1),r=ns(t,"float32");r[0]=n;for(let i=1;i<r.length;i++)r[i]=r[i-1]+s;return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pD=Ri(n=>Math.log(n)),$9=ia(Vd,pD),E9={kernelName:Vd,backendName:"cpu",kernelFunc:$9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mD(n,e,t,s){const r=ts(s,be(t));for(let i=0;i<r.length;++i){const o=i*e;let a=n[o];for(let l=0;l<e;++l){const u=n[o+l];(Number.isNaN(u)||u>a)&&(a=u)}r[i]=a}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gD=xn(((n,e)=>Math.max(n,e))),A9=jn(Gd,gD),j9={kernelName:Gd,backendName:"cpu",kernelFunc:A9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xD=xn(((n,e)=>Math.min(n,e))),R9=jn(Hd,xD),D9={kernelName:Hd,backendName:"cpu",kernelFunc:R9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bw=xn(((n,e)=>n*e)),P9=_w(((n,e,t,s)=>({real:n*t-e*s,imag:n*s+e*t}))),lx=jn(Kd,Bw,P9),M9={kernelName:Kd,backendName:"cpu",kernelFunc:lx};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yD(n,e,t){const s=Yo(-1,t);return Bw([],e,s,n,t)}function L9(n){const{inputs:e,backend:t}=n,{x:s}=e;We(s,"neg");const r=t.data.get(s.dataId).values,[i,o]=yD(r,s.shape,s.dtype);return t.makeTensorInfo(o,s.dtype,i)}const F9={kernelName:gg,backendName:"cpu",kernelFunc:L9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vD=xn(((n,e)=>n!==e?1:0)),O9=jn(xg,vD,null,"bool"),_9={kernelName:xg,backendName:"cpu",kernelFunc:O9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ww(n,e,t,s,r){const i=e.length,o=be(e),a=Qe(e),l=Qe(r),u=ts(t,be(r));for(let d=0;d<o;++d){const f=Ic(d,i,a),p=new Array(f.length);for(let x=0;x<p.length;x++)p[x]=f[s[x]];const g=wi(p,i,l);u[g]=n[d]}return u}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ps(n){const{inputs:e,attrs:t,backend:s}=n,{x:r}=e,{perm:i}=t;We(r,"transpose");const o=r.shape.length,a=new Array(o);for(let f=0;f<a.length;f++)a[f]=r.shape[i[f]];const l=s.data.get(r.dataId).values,u=Ww(l,r.shape,r.dtype,i,a);return{dataId:s.write(u,a,r.dtype),shape:a,dtype:r.dtype}}const z9={kernelName:Ql,backendName:"cpu",kernelFunc:Ps};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bD(n,e,t,s){const[r,i]=zn(n,s),o=Ks(e,"int32"),a=ns(be(r),o),l=be(i);for(let u=0;u<a.length;++u){const d=u*l;let f=1;for(let p=0;p<l;++p)f*=t[d+p];a[u]=f}return{outVals:a,outShape:r,outDtype:o}}function B9(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:o}=s;We(r,"prod");const a=r.shape.length,l=ht(i,r.shape),u=tn(l,a);let d=l,f=r;const p=[];u!=null&&(f=Ps({inputs:{x:r},backend:t,attrs:{perm:u}}),p.push(f),d=mn(d.length,a));const g=t.data.get(f.dataId).values,{outVals:x,outShape:y,outDtype:b}=bD(f.shape,f.dtype,g,d);let k=y;return o&&(k=kn(y,l)),p.forEach(w=>t.disposeIntermediateTensorInfo(w)),t.makeTensorInfo(k,b,x)}const W9={kernelName:Cg,backendName:"cpu",kernelFunc:B9};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function V9(n,e,t){n.forEach((s,r)=>{if(s<0||s>=t){const i=Ic(r,e.length,Qe(e)).join(",");throw new Error(`indices[${i}] = ${s} is not in [0, ${t})`)}})}function U9(n,e){for(let t=0;t<n.length;++t){const s=n[t],r=t===n.length-1?e:n[t+1].length;if(s.length===0)throw new Error("Ragged splits may not be empty");if(s[0]<0)throw new Error("Ragged splits must be non-negative");if(s[s.length-1]>r)throw new Error("Ragged splits must not point past values");for(let i=1;i<s.length;++i)if(s[i-1]>s[i])throw new Error("Ragged splits must be sorted in ascending order")}}function G9(n,e,t,s){const r=[];let i=0;const o=e.length-1+t.length,a=new Array(o).fill(null).map(()=>[0]);U9(t,s);let l=1;for(let u=0;u<e.length-1;++u){l*=e[u];const d=e[u+1];for(let f=1;f<l+1;++f)a[u].push(f*d)}for(let u=0;u<n.length;++u){let d=n[u],f=n[u]+1;for(let p=0;p<t.length;++p){const g=t[p],x=p+e.length-1;if(x>=0){const y=a[x],b=y[y.length-1]-g[d];for(let k=d;k<f;++k)a[x].push(g[k+1]+b)}d=g[d],f=g[f]}f!==d&&(r.push([d,f]),i+=f-d)}return{outSplits:a,valueSlices:r,numValues:i}}function H9(n){const e=[];for(let t=0;t<n.length;++t){const s=n[t].length,r=hn("int32",s);e.push(r),n[t].forEach((i,o)=>r[o]=i)}return e}function RN(n,e){const t=n.slice(0,e);for(;t.length<e;)t.push(1);for(let s=e;s<n.length;s++)t[e-1]*=n[s];return t}function q9(n,e,t,s,r,i){const o=RN(e,2)[1],a=RN(i,2)[1];let l=0;for(const u of t)for(let d=u[0];d<u[1];++d){for(let f=0;f<s;++f)r[l*a+f]=n[d*o+f];++l}}function K9(n,e,t,s,r){const i=e.slice();i[0]=r;const o=hn(t,be(i)),a=n.length,l=a===0?0:a/e[0];return q9(n,e,s,l,o,i),[o,i]}function wD(n,e,t,s,r,i,o,a){if(n.length===0)throw new Error("paramsNestedSplits must be non empty");if(e[0].length===0)throw new Error("Split tensors must not be scalars");const l=e[0][0]-1;if(V9(i,o,l),s.length===0)throw new Error("params.rank must be nonzero");const u=s[0],{outSplits:d,valueSlices:f,numValues:p}=G9(i,o,n,u),g=H9(d),x=K9(t,s,r,f,p);return[g,x[0],x[1]]}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DN=2147483647;function kD(n,e,t,s,r,i,o){if(e.length>1)throw new Error("starts must be a scalar or vector");if(r.length>1)throw new Error("limits must be a scalar or vector");if(o.length>1)throw new Error("deltas must be a scalar or vector");const a=e.length===0,l=r.length===0,u=o.length===0,d=[];a||d.push(e[0]),l||d.push(r[0]),u||d.push(o[0]);for(let b=1;b<d.length;++b)if(d[b]!==d[b-1])throw new Error("starts, limits, and deltas must have the same shape");const f=d.length===0?1:d[0],p=hn("int32",f+1);p[0]=0;for(let b=0;b<f;++b){const k=a?n[0]:n[b],w=l?s[0]:s[b],N=u?i[0]:i[b];if(N===0)throw new Error("Requires delta != 0");let C;if(N>0&&w<k||N<0&&w>k)C=0;else if(C=Math.ceil(Math.abs((w-k)/N)),C>DN)throw new Error(`Requires ((limit - start) / delta) <= ${DN}`);p[b+1]=p[b]+C}const g=p[f],x=hn(t,g);let y=0;for(let b=0;b<f;++b){const k=p[b+1]-p[b];let w=a?n[0]:n[b];const N=u?i[0]:i[b];for(let C=0;C<k;++C)x[y++]=w,w+=N}return[p,x]}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var vr=Kr;class hm{constructor(e,t,s,r,i,o,a,l,u,d){this.shape=e,this.shapeShape=t,this.values=s,this.valuesShape=r,this.valuesDType=i,this.defaultValue=o,this.defaultValueShape=a,this.rowPartitionValues=l,this.rowPartitionValuesShapes=u,this.rowPartitionTypes=lA(d),this.raggedRank=cA(this.rowPartitionTypes)}getRowPartitionTypeByDimension(e){return this.rowPartitionTypes[0]===vr.FIRST_DIM_SIZE?this.rowPartitionTypes[e+1]:this.rowPartitionTypes[e]}getRowPartitionTensor(e){return this.rowPartitionTypes[0]===vr.FIRST_DIM_SIZE?this.rowPartitionValues[e+1]:this.rowPartitionValues[e]}getMaxWidth(e){const t=this.getRowPartitionTensor(e-1);switch(this.getRowPartitionTypeByDimension(e-1)){case vr.VALUE_ROWIDS:return hm.getMaxWidthValueRowID(t);case vr.ROW_SPLITS:return hm.getMaxWidthRowSplit(t);default:throw new Error(`Cannot handle partition type ${vr[this.getRowPartitionTypeByDimension(e-1)]}`)}}static getMaxWidthRowSplit(e){const t=e.length;if(t===0||t===1)return 0;let s=0;for(let r=0;r<t-1;++r){const i=e[r+1]-e[r];i>s&&(s=i)}return s}static getMaxWidthValueRowID(e){const t=e.length;if(t===0)return 0;let s=0,r=e[0],i=0;for(let o=1;o<t;++o){const a=e[o];a!==r&&(r=a,i=Math.max(o-s,i),s=o)}return Math.max(t-s,i)}tensorShapeFromTensor(e,t,s=!0){if(t.length===0){if(e[0]===-1)return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return MN(e,s)}calculateOutputSize(e){const t=this.valuesShape,s=this.defaultValueShape;uA(s,t);const r=this.tensorShapeFromTensor(this.shape,this.shapeShape),o=aA(this.raggedRank,r,t);o[0]<0&&(o[0]=e);for(let a=1;a<=this.raggedRank;++a)o[a]<0&&(o[a]=this.getMaxWidth(a));return o}calculateFirstParentOutputIndex(e,t,s){const r=Math.min(e,s),i=[];let o=0;for(let a=0;a<r;++a,o+=t)i.push(o);for(let a=r;a<e;++a)i.push(-1);return V(i.length===e,()=>"Final length of result must be equal to firstDimension."),i}calculateOutputIndexRowSplit(e,t,s,r){const i=e.length,o=[];for(let a=0;a<i-1;++a){const l=e[a+1]-e[a];let u=Math.min(r,l),d=t[a];d===-1&&(u=0);for(let f=0;f<u;++f)o.push(d),d+=s;for(let f=0;f<l-u;++f)o.push(-1)}if(i>0&&o.length!==e[i-1])throw new Error("Invalid row split size.");return o}calculateOutputIndexValueRowID(e,t,s,r){const i=e.length,o=[];if(i===0)return[];let a=0,l=e[0];if(l>=t.length)throw new Error(`Got currentValueRowId=${l}, which is not less than ${t.length}`);let u=t[l];o.push(u);for(let d=1;d<i;++d){const f=e[d];if(f===l)u>=0&&(++a,a<r?u+=s:u=-1);else{if(a=0,l=f,f>=t.length)throw new Error(`Got nextValueRowId=${f} which is not less than ${t.length}`);u=t[f]}o.push(u)}if(o.length!==e.length)throw new Error("Invalid row ids.");return o}calculateOutputIndex(e,t,s,r){const i=this.getRowPartitionTensor(e),o=this.getRowPartitionTypeByDimension(e);switch(o){case vr.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(i,t,s,r);case vr.ROW_SPLITS:if(i.length-1>t.length)throw new Error(`Row partition size is greater than output size: ${i.length-1} > ${t.length}`);return this.calculateOutputIndexRowSplit(i,t,s,r);default:throw new Error(`Unsupported partition type: ${vr[o]}`)}}getFirstDimensionSize(){const e=this.rowPartitionValues[0];if(this.rowPartitionTypes.length===0)throw new Error("No row_partition_types given.");const t=this.rowPartitionTypes[0];switch(t){case vr.FIRST_DIM_SIZE:return e[0];case vr.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case vr.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error(`Cannot handle type ${vr[t]}`)}}compute(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");const t=this.getFirstDimensionSize(),s=this.calculateOutputSize(t),r=new Array(this.raggedRank+1);r[r.length-1]=1;for(let l=r.length-2;l>=0;--l)r[l]=r[l+1]*s[l+1];const i=MN(s,!1),o=hn(this.valuesDType,be(i));if(r[0]*s[0]>0){let l=this.calculateFirstParentOutputIndex(t,r[0],s[0]);for(let u=1;u<=this.raggedRank;++u)l=this.calculateOutputIndex(u-1,l,r[u],s[u]);this.setOutput(this.raggedRank,l,o,i)}return[i,o]}setOutput(e,t,s,r){if(s.length===0)return;const i=this.values,o=s;let a=r.slice();a=a.slice(e+1);const l=be(a),u=t.length;let d=this.defaultValue;if(d.length!==l&&d.length!==1){const x=this.defaultValueShape;de(()=>{const y=ie(d,x);d=Gu(y,a).dataSync()})}let f=0,p=0,g=0;for(let x=0;x<=u;++x){let y=x<u?t[x]:-1;if(y===g){++g;continue}if(p<g){const b=i.subarray(f*l),k=o.subarray(p*l),w=(g-p)*l;PN(k,b,w)}if(x>=u){const b=s.length;y=Math.floor(b/l)}if(y>g)if(this.defaultValue.length===1)o.subarray(g*l,y*l).fill(this.defaultValue[0]),g=y;else for(;y>g;){const b=o.slice(g*l);PN(b,d,l),++g}y<0?(f=x+1,p=g):(f=x,p=g,g=p+1)}}}function PN(n,e,t){for(let s=0;s<t;s++)n[s]=e[s]}function MN(n,e){const t=[];for(let s of n){if(s<0){if(!e)throw new Error(`Dimension ${s} must be >= 0`);if(s<-1)throw new Error(`Dimension ${s} must be >= -1`);s=-1}t.push(s)}return t}function CD(n,e,t,s,r,i,o,a,l,u){return new hm(n,e,t,s,r,i,o,a,l,u).compute()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SD(n,e,t,s){const r=n===e,i=n<e&&t<0,o=e<n&&t>1;if(r||i||o)return ns(0,s);const a=Math.abs(Math.ceil((e-n)/t)),l=ns(a,s);e<n&&t===1&&(t=-1),l[0]=n;for(let u=1;u<l.length;u++)l[u]=l[u-1]+t;return l}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ND=Ri(n=>1/Math.sqrt(n)),Q9=ia(eh,ND),X9={kernelName:eh,backendName:"cpu",kernelFunc:Q9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ra(n,e,t,s,r,i,o,a,l,u){const d=[s/r,r],f=n.values,p=e.values;if(s===0)return dt(t,e.dtype);const g=l instanceof Kn?l:dt(d,e.dtype);typeof l=="string"||typeof l=="number"?g.values.fill(l):typeof l=="boolean"&&g.values.fill(+l);for(let x=0;x<i;x++){const y=[];let b=0;for(let k=0;k<o;k++){const w=f[x*o+k];y.push(w),b+=w*a[k]}if(b<0||b>=s/r)throw new Error(`Invalid indices: ${y} does not index into ${t}`);for(let k=0;k<r;k++)u?g.values[b*r+k]+=p[x*r+k]:g.values[b*r+k]=e.rank===0?p[0]:p[x*r+k]}return g}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Y9=Ri(n=>1/(1+Math.exp(-n))),ID=Rt(ih,n=>1/(1+Math.exp(-n))),Z9={kernelName:ih,backendName:"cpu",kernelFunc:ID};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TD(n,e,t,s,r){const i=Q1(s,e,t),o=be(t),a=Qe(s);if(i){const f=X1(e,a);return r==="string"?n.slice(f,f+o):n.subarray(f,f+o)}const l=r==="string"?ro(n):n,u=dt(s,r,l),d=dt(t,r);for(let f=0;f<d.size;++f){const p=d.indexToLoc(f),g=p.map((x,y)=>x+e[y]);d.set(u.get(...g),...p)}return r==="string"?AA(d.values):d.values}function Za(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{begin:i,size:o}=s;We(r,"slice");const[a,l]=Hg(r,i,o);q1(r,a,l);const u=t.data.get(r.dataId).values,d=TD(u,a,l,r.shape,r.dtype);return t.makeTensorInfo(l,r.dtype,d)}const J9={kernelName:Eg,backendName:"cpu",kernelFunc:Za};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $D(n,e,t,s,r,i,o){const a=e[0],l=i[0],u=new Array(l),d=new Array(a),f=e[1];if(l===0){if(a!==0)throw new Error(xA(a));const b=hn(t,0),k=hn(r,0);return[b,[0,f],k,u,d]}let p=!0,g=0;const x=new Array(l).fill(0);for(let b=0;b<a;++b){const k=n[b*f];if(k<0)throw new Error(yA(b,k));if(k>=l)throw new Error(vA(b,k,l));++x[k],p=p&&k>=g,g=k}let y=!0;for(let b=0;b<l;++b){const k=x[b]===0;u[b]=k,y=y&&!k,x[b]=Math.max(x[b],1),b>0&&(x[b]+=x[b-1])}if(y&&p){const b=n,k=s;for(let w=0;w<a;++w)d[w]=w;return[b,[a,f],k,u,d]}else{const b=x[l-1],k=hn(t,b*f),w=hn(r,b),N=new Array(l).fill(0);for(let C=0;C<a;++C){const S=n[C*f],T=N[S],A=(S===0?0:x[S-1])+T;N[S]++;for(let E=0;E<f;++E)k[A*f+E]=n[C*f+E];w[A]=s[C],d[C]=A}for(let C=0;C<l;++C)if(N[C]===0){const T=C===0?0:x[C-1];k[T*f+0]=C;for(let A=1;A<f;++A)k[T*f+A]=0;w[T]=o}return[k,[b,f],w,u,d]}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ED(n,e,t,s,r){const i=be(s),o=e[0],a=r.length,l=[];let u=1,d=-1;for(let b=0;b<a;++b){const k=r[b];if(k===-1){if(d!==-1)throw new Error(bA(d,b));d=b,l.push(1)}else{if(k<0)throw new Error(wA(b,k));u*=k,l.push(k)}}if(d!==-1){if(u<=0)throw new Error(kA());const b=Math.trunc(i/u);if(u*b!==i)throw new Error(CA(s,l));l[d]=b}if(be(l)!==i)throw new Error(SA(s,l));const p=s.length,g=[];if(p>0){g[p-1]=1;for(let b=p-2;b>=0;--b)g[b]=g[b+1]*s[b+1]}const x=[];if(a>0){x[a-1]=1;for(let b=a-2;b>=0;--b)x[b]=x[b+1]*l[b+1]}const y=hn(t,o*a);for(let b=0;b<o;++b){let k=0;for(let w=0;w<p;++w)k+=n[b*p+w]*g[w];for(let w=0;w<a;++w)y[b*a+w]=Math.trunc(k/x[w]),k%=x[w]}return[y,[o,a],l]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vw(n,e,t,s,r,i=!1,o=0){const a=s.length,l=[e[0],n.length/e[0]],u=l[1],f=a>0?r[a-1]+1:0;if(f<0)throw new Error(Tv());const p=e.slice();p[0]=f;const g=p.reduce((N,C)=>N*C,1),x=hn(t,g);if(a===0)return f>0&&x.fill(o),[x,p];if(f<=0)throw new Error(Tv());let y=0,b=1,k=0,w=r[y];for(;;){let N=0;if(b<a){if(N=r[b],w===N){++b;continue}if(w>=N)throw new Error(NA())}if(w<0||w>=f)throw new Error(IA(w,f));w>k&&x.fill(o,k*u,w*u);for(let C=y;C<b;++C){const S=s[C];if(S<0||S>=l[0])throw new Error(TA(C,s[C],l[0]));for(let T=0;T<u;T++)x[w*u+T]+=n[S*u+T]}if(i)for(let C=0;C<u;C++)x[w*u+C]/=b-y;if(y=b,++b,k=w+1,w=N,b>a)break}return k<f&&x.fill(o,k*u,f*u),[x,p]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const e7=Ri(n=>Math.sqrt(n)),t7=Rt(ah,n=>Math.sqrt(n)),n7={kernelName:ah,backendName:"cpu",kernelFunc:t7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AD=xn(((n,e)=>{const t=n-e;return t*t})),s7=jn(lh,AD),r7={kernelName:lh,backendName:"cpu",kernelFunc:s7};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jD=Ri((n,e)=>{const{pattern:t,replaceGlobal:s,rewrite:r}=e;return n.replace(new RegExp(t,s?"g":""),r)}),i7=ia(o1,jD),o7={kernelName:o1,backendName:"cpu",kernelFunc:i7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RD(n,e,t,s){const r=dt(n,e.dtype);for(let i=0;i<r.size;i++){const o=r.indexToLoc(i),a=new Array(o.length);for(let l=0;l<a.length;l++)a[l]=o[l]*t[l]+s[l];r.set(e.get(...a),...o)}return r}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class a7{constructor(e,t,s,r,i,o){this.separator=zo(e),this.nGramWidths=t,this.leftPad=zo(s),this.rightPad=zo(r),this.padWidth=i,this.preserveShort=o}getPadWidth(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)}getNumNGrams(e,t){const s=this.getPadWidth(t);return Math.max(0,e+2*s-t+1)}createNGrams(e,t,s,r,i,o){for(let a=0;a<i;++a){const l=this.getPadWidth(o),u=Math.max(0,l-a),d=Math.max(0,l-(i-(a+1))),f=o-(u+d),p=t+(u>0?0:a-l);let g=0;g+=u*this.leftPad.length;for(let w=0;w<f;++w)g+=e[p+w].length;g+=d*this.rightPad.length;const x=u+d+f-1;g+=x*this.separator.length,s[r+a]=new Uint8Array(g);const y=s[r+a];let b=0;const k=w=>w.forEach(N=>y[b++]=N);for(let w=0;w<u;++w)k(this.leftPad),k(this.separator);for(let w=0;w<f-1;++w)k(e[p+w]),k(this.separator);if(f>0){k(e[p+f-1]);for(let w=0;w<d;++w)k(this.separator),k(this.rightPad)}else{for(let w=0;w<d-1;++w)k(this.rightPad),k(this.separator);k(this.rightPad)}}}compute(e,t){const s=e.length,r=t.length;if(r>0){let l=t[0];if(l!==0)throw new Error(`First split value must be 0, got ${l}`);for(let u=1;u<r;++u){let d=t[u]>=l;if(d=d&&t[u]<=s,!d)throw new Error(`Invalid split value ${t[u]}, must be in [${l}, ${s}]`);l=t[u]}if(l!==s)throw new Error(`Last split value must be data size. Expected ${s}, got ${l}`)}const i=r-1,o=hn("int32",r);if(s===0||r===0){const l=new Array(s);for(let u=0;u<=i;++u)o[u]=0;return[l,o]}o[0]=0;for(let l=1;l<=i;++l){const u=t[l]-t[l-1];let d=0;this.nGramWidths.forEach(f=>{d+=this.getNumNGrams(u,f)}),this.preserveShort&&u>0&&d===0&&(d=1),o[l]=o[l-1]+d}const a=new Array(o[i]);for(let l=0;l<i;++l){const u=t[l];let d=o[l];if(this.nGramWidths.forEach(f=>{const p=t[l+1]-t[l],g=this.getNumNGrams(p,f);this.createNGrams(e,u,a,d,g,f),d+=g}),this.preserveShort&&d===o[l]){const f=t[l+1]-t[l];if(f===0)continue;const p=f+2*this.padWidth;this.createNGrams(e,u,a,d,1,p)}}return[a,o]}}function DD(n,e,t,s,r,i,o,a){return new a7(t,s,r,i,o,a).compute(n,e)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function l7(n,e,t,s){if(!n.length)return;if(e.length===0){for(let i=0;i<n.length;++i)s.push(n.subarray(i,i+1));return}if(e.length===1){const i=e[0];let o=n.indexOf(i);for(;o!==-1;){const a=n.subarray(0,o);(!t||a.length!==0)&&s.push(a),n=n.subarray(o+1),o=n.indexOf(i)}(!t||n.length!==0)&&s.push(n);return}let r=0;for(let i=0;i<n.length+1;i++)if(i===n.length||e.indexOf(n[i])!==-1){const o=n.subarray(r,i);(!t||o.length!==0)&&s.push(o),r=i+1}}function PD(n,e,t){const s=n.length,r=[];let i=0,o=0;const a=new Array(s);for(let p=0;p<s;++p){const g=r.length;l7(n[p],e,t,r);const x=r.length-g;a[p]=x,i+=x,o=Math.max(o,x)}const l=hn("int32",i*2),u=new Array(i),d=[s,o];let f=0;for(let p=0;p<s;++p)for(let g=0;g<a[p];++g)l[f*2]=p,l[f*2+1]=g,u[f]=r[f],++f;return[l,u,d]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MD(n,e){const t=hn("int32",n.length);for(let s=0;s<n.length;++s)t[s]=x_(n[s]).modulo(e).getLowBitsUnsigned();return t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LD=xn(((n,e)=>n-e)),c7=_w(((n,e,t,s)=>({real:n-t,imag:e-s}))),Uw=jn(ch,LD,c7),u7={kernelName:ch,backendName:"cpu",kernelFunc:Uw};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FD(n,e){const t=new Array(n.rank);for(let r=0;r<t.length;r++)t[r]=n.shape[r]*e[r];const s=dt(t,n.dtype);for(let r=0;r<s.values.length;++r){const i=s.indexToLoc(r),o=new Array(n.rank);for(let l=0;l<o.length;l++)o[l]=i[l]%n.shape[l];const a=n.locToIndex(o);s.values[r]=n.values[a]}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ou=(n,e)=>{const t=e.value-n.value;return t===0?n.index-e.index:t};function OD(n,e,t=0,s=n.length-1){for(;s>t;){if(s-t>600){const a=s-t+1,l=e-t+1,u=Math.log(a),d=.5*Math.exp(2*u/3),f=.5*Math.sqrt(u*d*(a-d)/a)*Math.sign(l-a/2),p=Math.max(t,Math.floor(e-l*d/a+f)),g=Math.min(s,Math.floor(e+(a-l)*d/a+f));OD(n,e,p,g)}const r=n[e];let i=t,o=s;for(zl(n,t,e),Ou(n[s],r)>0&&zl(n,t,s);i<o;){for(zl(n,i,o),i++,o--;Ou(n[i],r)<0;)i=i+1;for(;Ou(n[o],r)>0;)o=o-1}Ou(n[t],r)===0?zl(n,t,o):(o=o+1,zl(n,o,s)),o<=e&&(t=o+1),e<=o&&(s=o-1)}}function _D(n,e,t,s,r){const i=e[e.length-1],[o,a]=[n.length/i,i],l=ts(t,o*s),u=ts("int32",o*s);for(let f=0;f<o;f++){const p=f*a,g=n.subarray(p,p+a);let x=new Array(g.length);g.forEach((w,N)=>x[N]={value:w,index:N}),s<x.length&&(OD(x,s),x=x.slice(0,s)),r&&x.sort(Ou);const y=f*s,b=l.subarray(y,y+s),k=u.subarray(y,y+s);for(let w=0;w<s;w++)b[w]=x[w].value,k[w]=x[w].index}const d=e.slice();return d[d.length-1]=s,[dt(d,t,l),dt(d,"int32",u)]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zD(n,e,t,s){const r=ht(e,t)[0],i=[1,t[0],1];for(let x=0;x<r;x++)i[0]*=t[x];i[1]=t[r];for(let x=r+1;x<t.length;x++)i[2]*=t[x];const o=new Map,a=new Int32Array(t[r]),l=new Kn(i,s,n),u=[],d=i[0]===1&&i[2]===1;for(let x=0;x<t[r];x++){let y;if(d)y=n[x].toString();else{const k=[];for(let w=0;w<i[0];w++)for(let N=0;N<i[2];N++)k.push(l.get(w,x,N));y=k.join(",")}const b=o.get(y);if(b!=null)a[x]=b;else{const k=o.size;o.set(y,k),a[x]=k,u.push(x)}}const f=i.slice();f[1]=o.size;const p=new Kn(f,s);u.forEach((x,y)=>{for(let b=0;b<i[0];b++)for(let k=0;k<i[2];k++)p.set(l.get(b,x,k),b,y,k)});const g=t.slice();return g[r]=f[1],{outputValues:p.values,outputShape:g,indices:a}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const d7=Object.freeze(Object.defineProperty({__proto__:null,addImpl:QR,bincountImpl:zw,bincountReduceImpl:XR,bitwiseAndImpl:YR,castImpl:KR,ceilImpl:ZR,concatImpl:JR,equalImpl:eD,expImpl:nD,expm1Impl:rD,floorDivImpl:oD,floorImpl:iD,gatherNdImpl:aD,gatherV2Impl:lD,greaterEqualImpl:uD,greaterImpl:cD,lessEqualImpl:hD,lessImpl:dD,linSpaceImpl:fD,logImpl:pD,maxImpl:mD,maximumImpl:gD,minimumImpl:xD,multiplyImpl:Bw,negImpl:yD,notEqualImpl:vD,prodImpl:bD,raggedGatherImpl:wD,raggedRangeImpl:kD,raggedTensorToTensorImpl:CD,rangeImpl:SD,rsqrtImpl:ND,scatterImpl:Ra,sigmoidImpl:Y9,simpleAbsImpl:qR,sliceImpl:TD,sparseFillEmptyRowsImpl:$D,sparseReshapeImpl:ED,sparseSegmentReductionImpl:Vw,sqrtImpl:e7,squaredDifferenceImpl:AD,staticRegexReplaceImpl:jD,stridedSliceImpl:RD,stringNGramsImpl:DD,stringSplitImpl:PD,stringToHashBucketFastImpl:MD,subImpl:LD,tileImpl:FD,topKImpl:_D,transposeImpl:Ww,uniqueImpl:zD},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */iE("cpu",()=>new ax,1);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BD=Rt(Rd,n=>n>=0?n:Math.exp(n)-1),h7={kernelName:Rd,backendName:"cpu",kernelFunc:BD};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WD(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{alpha:i}=s;We([r],"leakyRelu");const o=be(r.shape),a=t.data.get(r.dataId).values,l=ts("float32",o);for(let u=0;u<a.length;u++)l[u]=a[u]<0?i*a[u]:a[u];return t.makeTensorInfo(r.shape,"float32",l)}const f7={kernelName:sg,backendName:"cpu",kernelFunc:WD};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const p7=xn((n,e)=>n<0?e*n:n);function VD(n){const{inputs:e,backend:t}=n,{x:s,alpha:r}=e;We([s,r],"prelu");const i=t.data.get(s.dataId).values,o=t.data.get(r.dataId).values,[a,l]=p7(s.shape,r.shape,i,o,"float32");return t.makeTensorInfo(l,"float32",a)}const m7={kernelName:kg,backendName:"cpu",kernelFunc:VD};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UD=Rt(Yd,n=>Math.max(0,n)),g7={kernelName:Yd,backendName:"cpu",kernelFunc:UD};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GD=Rt(Zd,n=>Math.min(Math.max(0,n),6)),x7={kernelName:Zd,backendName:"cpu",kernelFunc:GD};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fm(n,e,t,s,r){if(t==="linear")return ji({inputs:{x:e},backend:n});if(t==="relu")return UD({inputs:{x:e},backend:n});if(t==="elu")return BD({inputs:{x:e},backend:n});if(t==="relu6")return GD({inputs:{x:e},backend:n});if(t==="prelu")return VD({inputs:{x:e,alpha:s},backend:n});if(t==="leakyrelu")return WD({inputs:{x:e},backend:n,attrs:{alpha:r}});if(t==="sigmoid")return ID({inputs:{x:e},backend:n});throw new Error(`Activation ${t} has not been implemented for the CPU backend.`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _t(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{shape:i}=s,o=be(r.shape),a=m$(i,o),l=be(a);V(o===l,()=>`The new shape (${a}) has ${l} elements and the old shape (${r.shape}) has ${o} elements. The new shape and old shape must have the same number of elements.`),t.incRef(r.dataId);const u=t.data.get(r.dataId);if(u.complexTensorInfos!=null){const d=u.complexTensorInfos.real,f=u.complexTensorInfos.imag;d.shape=a,f.shape=a}return{dataId:r.dataId,shape:a,dtype:r.dtype}}const y7={kernelName:Sg,backendName:"cpu",kernelFunc:_t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HD(n){const{inputs:e,backend:t,attrs:s}=n,{a:r,b:i}=e,{transposeA:o,transposeB:a}=s;We([r,i],"matMul");const l=r.shape.length,u=i.shape.length,d=o?r.shape[l-2]:r.shape[l-1],f=a?i.shape[u-1]:i.shape[u-2],p=o?r.shape[l-1]:r.shape[l-2],g=a?i.shape[u-2]:i.shape[u-1],x=r.shape.slice(0,-2),y=i.shape.slice(0,-2),b=be(x),k=be(y),N=ot(r.shape.slice(0,-2),i.shape.slice(0,-2)).concat([p,g]);V(d===f,()=>`Error in matMul: inner shapes (${d}) and (${f}) of Tensors with shapes ${r.shape} and ${i.shape} and transposeA=${o} and transposeB=${a} must match.`);const C=o?[b,d,p]:[b,p,d],S=a?[k,g,f]:[k,f,g],T=_t({inputs:{x:r},backend:t,attrs:{shape:C}}),A=_t({inputs:{x:i},backend:t,attrs:{shape:S}}),E=o?T.shape[1]:T.shape[2],M=o?T.shape[2]:T.shape[1],P=a?A.shape[1]:A.shape[2],R=Math.max(b,k),L=t.data.get(T.dataId).values,_=t.data.get(A.dataId).values,O=Qe(T.shape),U=Qe(A.shape),[W,H,G]=o?[O[0],1,O[1]]:[O[0],O[1],1],[q,Q,z]=a?[1,U[1],U[0]]:[U[1],1,U[0]],K=M*P,Y=dt([R,M,P],T.dtype),B=Y.values,J=t.blockSize;for(let ae=0;ae<R;ae++){const pe=ae%b,ge=ae%k;for(let he=0;he<M;he+=J){const we=Math.min(he+J,M);for(let Pe=0;Pe<P;Pe+=J){const ue=Math.min(Pe+J,P);for(let Te=0;Te<E;Te+=J){const ke=Math.min(Te+J,E);for(let ye=he;ye<we;ye++)for(let Ce=Pe;Ce<ue;Ce++){let Ae=0;for(let Be=Te;Be<ke;Be++){const mt=L[pe*W+ye*H+Be*G],le=_[Be*q+Ce*Q+ge*z];Ae+=mt*le}B[ae*K+(ye*P+Ce)]+=Ae}}}}}return t.disposeIntermediateTensorInfo(T),t.disposeIntermediateTensorInfo(A),t.makeTensorInfo(N,Y.dtype,Y.values)}const v7={kernelName:Wm,backendName:"cpu",kernelFunc:HD};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b7(n){const{inputs:e,backend:t,attrs:s}=n,{a:r,b:i,bias:o,preluActivationWeights:a}=e,{transposeA:l,transposeB:u,activation:d,leakyreluAlpha:f}=s;let p,g,x;const y=[];p=HD({inputs:{a:r,b:i},attrs:{transposeA:l,transposeB:u},backend:t}),o&&(g=fc({inputs:{a:p,b:o},backend:t}),y.push(p),p=g),d&&(x=fm(t,p,d,a,f),y.push(p),p=x);for(const k of y)t.disposeIntermediateTensorInfo(k);return p}const w7={kernelName:Gp,backendName:"cpu",kernelFunc:b7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const k7=Rt(vd,n=>Math.acos(n)),C7={kernelName:vd,backendName:"cpu",kernelFunc:k7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const S7=Rt(bd,n=>Math.acosh(n)),N7={kernelName:bd,backendName:"cpu",kernelFunc:S7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function I7(n){const{inputs:e,backend:t}=n,s=e;We(e,"addN");const r=s.map(a=>t.data.get(a.dataId).values),i=dt(s[0].shape,s[0].dtype),o=i.values;for(let a=0;a<s.length;a++){const l=r[a];for(let u=0;u<o.length;u++)o[u]+=l[u]}return t.makeTensorInfo(i.shape,i.dtype,i.values)}const T7={kernelName:Nb,backendName:"cpu",kernelFunc:I7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $7(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:o}=s;We(r,"all");const a=ht(i,r.shape);let l=a;const u=tn(l,r.shape.length);let d=r;u!=null&&(d=Ps({inputs:{x:r},backend:t,attrs:{perm:u}}),l=mn(l.length,r.shape.length)),Xn("all",l,d.shape.length);const[f,p]=zn(d.shape,l),g=be(p),x=ns(be(f),d.dtype),y=t.data.get(d.dataId).values;for(let k=0;k<x.length;++k){const w=k*g;let N=y[w];for(let C=0;C<g;++C){const S=y[w+C];N=N&&S}x[k]=N}u!=null&&t.disposeIntermediateTensorInfo(d);const b=t.makeTensorInfo(f,d.dtype,x);if(o){const k=kn(f,a),w=_t({inputs:{x:b},backend:t,attrs:{shape:k}});return t.disposeIntermediateTensorInfo(b),w}return b}const E7={kernelName:Ib,backendName:"cpu",kernelFunc:$7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function A7(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:o}=s;We(r,"any");const a=ht(i,r.shape);let l=a;const u=tn(l,r.shape.length);let d=r;u!=null&&(d=Ps({inputs:{x:r},backend:t,attrs:{perm:u}}),l=mn(l.length,r.shape.length)),Xn("any",l,d.shape.length);const[f,p]=zn(d.shape,l),g=be(p),x=ns(be(f),d.dtype),y=t.data.get(d.dataId).values;for(let k=0;k<x.length;++k){const w=k*g;let N=y[w];for(let C=0;C<g;++C){const S=y[w+C];N=N||S}x[k]=N}u!=null&&t.disposeIntermediateTensorInfo(d);const b=t.makeTensorInfo(f,d.dtype,x);if(o){const k=kn(f,a),w=_t({inputs:{x:b},backend:t,attrs:{shape:k}});return t.disposeIntermediateTensorInfo(b),w}return b}const j7={kernelName:Tb,backendName:"cpu",kernelFunc:A7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function R7(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i}=s;We(r,"argMax");let o=ht(i,r.shape);const a=tn(o,r.shape.length);let l=r;const u=[];a!=null&&(l=Ps({inputs:{x:r},backend:t,attrs:{perm:a}}),u.push(l),o=mn(o.length,l.shape.length)),o=[o[0]],Xn("argMax",o,l.shape.length);const[d,f]=zn(l.shape,o),p=be(d),g=ns(p,"int32"),x=be(f),y=t.data.get(l.dataId).values;for(let b=0;b<g.length;++b){const k=b*x;let w=y[k],N=0;for(let C=0;C<x;++C){const S=y[k+C];S>w&&(w=S,N=C)}g[b]=N}return u.forEach(b=>t.disposeIntermediateTensorInfo(b)),t.makeTensorInfo(d,"int32",g)}const D7={kernelName:Om,backendName:"cpu",kernelFunc:R7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function P7(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i}=s;We(r,"argMin");let o=ht(i,r.shape);const a=tn(o,r.shape.length);let l=r;const u=[];a!=null&&(l=Ps({inputs:{x:r},backend:t,attrs:{perm:a}}),u.push(l),o=mn(o.length,l.shape.length)),o=[o[0]],Xn("argMin",o,l.shape.length);const[d,f]=zn(l.shape,o),p=be(d),g=ns(p,"int32"),x=be(f),y=t.data.get(l.dataId).values;for(let b=0;b<g.length;++b){const k=b*x;let w=y[k],N=0;for(let C=0;C<x;++C){const S=y[k+C];S<w&&(w=S,N=C)}g[b]=N}return u.forEach(b=>t.disposeIntermediateTensorInfo(b)),t.makeTensorInfo(d,"int32",g)}const M7={kernelName:_m,backendName:"cpu",kernelFunc:P7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const L7=Rt(wd,n=>Math.asin(n)),F7={kernelName:wd,backendName:"cpu",kernelFunc:L7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const O7=Rt(kd,n=>Math.asinh(n)),_7={kernelName:kd,backendName:"cpu",kernelFunc:O7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const z7=Rt(Cd,n=>Math.atan(n)),B7={kernelName:Cd,backendName:"cpu",kernelFunc:z7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const W7=xn((n,e)=>Math.atan2(n,e)),V7=jn(Nd,W7),U7={kernelName:Nd,backendName:"cpu",kernelFunc:V7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const G7=Rt(Sd,n=>Math.atanh(n)),H7={kernelName:Sd,backendName:"cpu",kernelFunc:G7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gw(n,e,t,s,r,i){const o=r.strideHeight,a=r.strideWidth,l=r.dilationHeight,u=r.dilationWidth,d=r.effectiveFilterHeight,f=r.effectiveFilterWidth,p=r.padInfo.top,g=r.padInfo.left,x=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,y=dt(r.outShape,t),b=y.values,k=r.outShape[1]*r.outShape[2]*r.outShape[3],w=r.outShape[2]*r.outShape[3],N=r.outShape[3];for(let C=0;C<r.batchSize;++C){const S=C*k,T=C*s[0];for(let A=0;A<r.inChannels;++A)for(let E=0;E<r.outHeight;++E){const M=E*o-p,P=Math.max(0,M),R=Math.min(r.inHeight,d+M),L=S+E*w;for(let _=0;_<r.outWidth;++_){const O=_*a-g,U=Math.max(0,O),W=Math.min(r.inWidth,f+O);let H=x,G=0,q=0;for(let z=P;z<R;z+=l){const K=T+z*s[1];for(let Y=U;Y<W;Y+=u){const B=K+Y*s[2],J=n[B+A];i==="max"&&J>H?H=J:i==="avg"&&(G+=J,q++)}if(isNaN(H))break}const Q=L+_*N+A;b[Q]=i==="avg"?G/q:H}}}return y}function qD(n,e,t,s,r=!1,i=!1){const o=dt(s.outShape,"int32"),a=s.strideHeight,l=s.strideWidth,u=s.dilationHeight,d=s.dilationWidth,f=s.effectiveFilterHeight,p=s.effectiveFilterWidth,g=s.padInfo.top,x=s.padInfo.left,y=dt(e,t,n);for(let b=0;b<s.batchSize;++b)for(let k=0;k<s.inChannels;++k)for(let w=0;w<s.outHeight;++w){const N=w*a-g;let C=N;for(;C<0;)C+=u;const S=Math.min(s.inHeight,f+N);for(let T=0;T<s.outWidth;++T){const A=T*l-x;let E=A;for(;E<0;)E+=d;const M=Math.min(s.inWidth,p+A);let P=Number.NEGATIVE_INFINITY,R=-1;for(let L=C;L<S;L+=u){const _=L-N;for(let O=E;O<M;O+=d){const U=O-A,W=y.get(b,L,O,k);W>P&&(P=W,r?R=i?((b*s.inHeight+L)*s.inWidth+O)*s.inChannels+k:(L*s.inWidth+O)*s.inChannels+k:R=_*p+U)}}o.set(R,b,w,T,k)}}return o}function KD(n,e,t,s,r,i){const o=r.strideDepth,a=r.strideHeight,l=r.strideWidth,u=r.dilationDepth,d=r.dilationHeight,f=r.dilationWidth,p=r.effectiveFilterDepth,g=r.effectiveFilterHeight,x=r.effectiveFilterWidth,y=r.padInfo.front,b=r.padInfo.top,k=r.padInfo.left,w=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,N=dt(r.outShape,t),C=N.values,S=r.outShape[1]*r.outShape[2]*r.outShape[3]*r.outShape[4],T=r.outShape[2]*r.outShape[3]*r.outShape[4],A=r.outShape[3]*r.outShape[4],E=r.outShape[4];for(let M=0;M<r.batchSize;++M){const P=M*S,R=M*s[0];for(let L=0;L<r.inChannels;++L)for(let _=0;_<r.outDepth;++_){const O=_*o-y;let U=O;for(;U<0;)U+=u;const W=Math.min(r.inDepth,p+O),H=P+_*T;for(let G=0;G<r.outHeight;++G){const q=G*a-b;let Q=q;for(;Q<0;)Q+=d;const z=Math.min(r.inHeight,g+q),K=H+G*A;for(let Y=0;Y<r.outWidth;++Y){const B=Y*l-k;let J=B;for(;J<0;)J+=f;const ae=Math.min(r.inWidth,x+B),pe=K+Y*E;let ge=w,he=0,we=0;for(let ue=U;ue<W;ue+=u){const Te=R+ue*s[1];for(let ke=Q;ke<z;ke+=d){const ye=Te+ke*s[2];for(let Ce=J;Ce<ae;Ce+=f){const Ae=ye+Ce*s[3],Be=n[Ae+L];if(i==="max"&&Be>ge?ge=Be:i==="avg"&&(he+=Be,we++),isNaN(ge))break}if(isNaN(ge))break}if(isNaN(ge))break}const Pe=pe+L;C[Pe]=i==="avg"?he/Math.max(we,1):ge}}}}return N}function q7(n,e){const t=dt(e.outShape,"int32"),s=e.strideDepth,r=e.strideHeight,i=e.strideWidth,o=e.dilationDepth,a=e.dilationHeight,l=e.dilationWidth,u=e.effectiveFilterDepth,d=e.effectiveFilterHeight,f=e.effectiveFilterWidth,p=e.padInfo.front,g=e.padInfo.top,x=e.padInfo.left;for(let y=0;y<e.batchSize;++y)for(let b=0;b<e.inChannels;++b)for(let k=0;k<e.outDepth;++k){const w=k*s-p;let N=w;for(;N<0;)N+=o;const C=Math.min(e.inDepth,u+w);for(let S=0;S<e.outHeight;++S){const T=S*r-g;let A=T;for(;A<0;)A+=a;const E=Math.min(e.inHeight,d+T);for(let M=0;M<e.outWidth;++M){const P=M*i-x;let R=P;for(;R<0;)R+=l;const L=Math.min(e.inWidth,f+P);let _=Number.NEGATIVE_INFINITY,O=-1;for(let U=N;U<C;U+=o){const W=U-w;for(let H=A;H<E;H+=a){const G=H-T;for(let q=R;q<L;q+=l){const Q=q-P,z=n.get(y,U,H,q,b);z>=_&&(_=z,O=W*d*f+G*d+Q)}}}t.set(O,y,k,S,M,b)}}}return t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function K7(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e;We(r,"avgPool");const{filterSize:i,strides:o,pad:a,dimRoundingMode:l}=s,u=1;V(rs(o,u),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${u}'`);const d=Ar(r.shape,i,o,u,a,l);let f;if(d.filterWidth===1&&d.filterHeight===1&&At(d.inShape,d.outShape))f=ji({inputs:{x:r},backend:t});else{const p=t.data.get(r.dataId).values,g=Qe(r.shape),x=Gw(p,r.shape,r.dtype,g,d,"avg");f=t.makeTensorInfo(d.outShape,r.dtype,x.values)}return f}const Q7={kernelName:zm,backendName:"cpu",kernelFunc:K7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function X7(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{filterSize:i,strides:o,pad:a,dimRoundingMode:l,dataFormat:u}=s;We(r,"avgPool3d");const d=lo(r.shape,i,o,1,a,l,u),f=t.data.get(r.dataId).values,p=KD(f,r.shape,r.dtype,Qe(r.shape),d,"avg");return t.makeTensorInfo(p.shape,"float32",p.values)}const Y7={kernelName:Bm,backendName:"cpu",kernelFunc:X7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z7(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:i}=e,{filterSize:o,strides:a,pad:l,dimRoundingMode:u}=s;We([r,i],"avgPool3DGrad");const d=lo(i.shape,o,a,1,l,u),f=d.strideDepth,p=d.strideHeight,g=d.strideWidth,x=d.filterDepth,y=d.filterHeight,b=d.filterWidth,k=d.dilationDepth,w=d.dilationHeight,N=d.dilationWidth,C=d.effectiveFilterDepth,S=d.effectiveFilterHeight,T=d.effectiveFilterWidth,A=C-1-d.padInfo.front,E=T-1-d.padInfo.left,M=S-1-d.padInfo.top,P=dt(i.shape,"float32"),R=1/(x*y*b),L=t.bufferSync(r);for(let _=0;_<d.batchSize;++_)for(let O=0;O<d.inChannels;++O)for(let U=0;U<d.inDepth;++U)for(let W=0;W<d.inHeight;++W)for(let H=0;H<d.inWidth;++H){const G=U-A,q=W-M,Q=H-E;let z=0;for(let K=0;K<C;K+=k){const Y=(G+K)/f;if(!(Y<0||Y>=d.outDepth||Math.floor(Y)!==Y))for(let B=0;B<S;B+=w){const J=(q+B)/p;if(!(J<0||J>=d.outHeight||Math.floor(J)!==J))for(let ae=0;ae<T;ae+=N){const pe=(Q+ae)/g;if(pe<0||pe>=d.outWidth||Math.floor(pe)!==pe)continue;const ge=L.get(_,Y,J,pe,O);z+=ge}}}P.set(z*R,_,U,W,H,O)}return t.makeTensorInfo(P.shape,P.dtype,P.values)}const J7={kernelName:Eb,backendName:"cpu",kernelFunc:Z7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eq(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:i}=e,o=i;We([r,i],"avgPoolGrad");const{filterSize:a,strides:l,pad:u}=s,d=Ar(o.shape,a,l,1,u),f=d.strideHeight,p=d.strideWidth,g=d.filterHeight,x=d.filterWidth,y=d.dilationHeight,b=d.dilationWidth,k=d.effectiveFilterHeight,w=d.effectiveFilterWidth,N=w-1-d.padInfo.left,C=k-1-d.padInfo.top,S=dt(o.shape,"float32"),T=1/(g*x),A=t.data.get(r.dataId).values,E=dt(r.shape,"float32",A);for(let M=0;M<d.batchSize;++M)for(let P=0;P<d.inChannels;++P)for(let R=0;R<d.inHeight;++R)for(let L=0;L<d.inWidth;++L){const _=R-C,O=L-N;let U=0;for(let W=0;W<k;W+=y){const H=(_+W)/f;if(!(H<0||H>=d.outHeight||Math.floor(H)!==H))for(let G=0;G<w;G+=b){const q=(O+G)/p;if(q<0||q>=d.outWidth||Math.floor(q)!==q)continue;const Q=E.get(M,H,q,P);U+=Q}}S.set(U*T,M,R,L,P)}return t.makeTensorInfo(S.shape,S.dtype,S.values)}const tq={kernelName:$b,backendName:"cpu",kernelFunc:eq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nq(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,scale:i,offset:o,mean:a,variance:l}=e;V(a.shape.length===l.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),V(o==null||a.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),V(i==null||a.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks."),We([r,a,l,i,o],"batchNorm");let{varianceEpsilon:u}=s;u==null&&(u=.001);const d=t.data.get(r.dataId).values,f=t.data.get(a.dataId).values,p=t.data.get(l.dataId).values,g=i?t.data.get(i.dataId).values:new Float32Array([1]),x=o?t.data.get(o.dataId).values:new Float32Array([0]),y=new Float32Array(d.length),b=x.length,k=g.length,w=p.length,N=f.length;let C=0,S=0,T=0,A=0;for(let E=0;E<d.length;++E)y[E]=x[C++]+(d[E]-f[S++])*g[T++]/Math.sqrt(p[A++]+u),C>=b&&(C=0),S>=N&&(S=0),T>=k&&(T=0),A>=w&&(A=0);return t.makeTensorInfo(r.shape,r.dtype,y)}const sq={kernelName:eg,backendName:"cpu",kernelFunc:nq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rq(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockShape:i,crops:o}=s;We([r],"batchToSpaceND");const a=i.reduce((k,w)=>k*w),l=vh(r.shape,i,a),u=bh(l.length,i.length),d=wh(r.shape,i,a),f=tw(o,i.length),p=nw(d,o,i.length),g=_t({inputs:{x:r},backend:t,attrs:{shape:l}}),x=Ps({inputs:{x:g},backend:t,attrs:{perm:u}}),y=_t({inputs:{x},backend:t,attrs:{shape:d}}),b=Za({inputs:{x:y},backend:t,attrs:{begin:f,size:p}});return t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(x),t.disposeIntermediateTensorInfo(y),b}const iq={kernelName:Vm,backendName:"cpu",kernelFunc:rq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oq(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,weights:i}=e,{size:o}=s,a=t.data.get(r.dataId).values,l=t.data.get(i.dataId).values,u=zw(a,l,i.dtype,i.shape,o);return t.makeTensorInfo([o],i.dtype,u)}const aq={kernelName:Ab,backendName:"cpu",kernelFunc:oq};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lq(n){const{inputs:e,backend:t}=n,{s0:s,s1:r}=e,i=t.data.get(s.dataId).values,o=t.data.get(r.dataId).values,a=ot(Array.from(i),Array.from(o));return t.makeTensorInfo([a.length],"int32",Int32Array.from(a))}const cq={kernelName:w$,backendName:"cpu",kernelFunc:lq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uq=Rt($d,(n,e)=>{const t=e;return n>t.clipValueMax?t.clipValueMax:n<t.clipValueMin?t.clipValueMin:n}),dq={kernelName:$d,backendName:"cpu",kernelFunc:uq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hq=n=>{const{x:e}=n.inputs,t=n.backend,s=new Float32Array(be(e.shape)),r=t.data.get(e.dataId),i=r.complexTensorInfos.real,o=r.complexTensorInfos.imag,a=t.data.get(i.dataId).values,l=t.data.get(o.dataId).values;for(let u=0;u<a.length;u++){const d=a[u],f=l[u];s[u]=Math.hypot(d,f)}return t.makeOutput(s,e.shape,"float32")},fq={kernelName:Um,backendName:"cpu",kernelFunc:hq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pc(n){const{inputs:e,backend:t}=n,{input:s}=e,r=t.data.get(s.dataId).complexTensorInfos.imag,i=t.data.get(r.dataId).values;return t.makeTensorInfo(r.shape,r.dtype,i)}const pq={kernelName:Kb,backendName:"cpu",kernelFunc:pc};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mc(n){const{inputs:e,backend:t,attrs:s}=n,{axis:r}=s,i=ht(r,e[0].shape)[0],o=e.map(y=>y.shape);Z1(o,i);let a=Ci(e.map(y=>y.shape),i);if(be(a)===0)return t.makeTensorInfo(a,e[0].dtype,[]);const l=e.filter(y=>be(y.shape)>0);if(l.length===1)return ji({inputs:{x:l[0]},backend:t});if(l[0].dtype==="complex64"){const y=l.map(C=>Ya({inputs:{input:C},backend:t})),b=l.map(C=>pc({inputs:{input:C},backend:t})),k=mc({inputs:y,backend:t,attrs:{axis:i}}),w=mc({inputs:b,backend:t,attrs:{axis:i}}),N=qs({inputs:{real:k,imag:w},backend:t});return y.forEach(C=>t.disposeIntermediateTensorInfo(C)),b.forEach(C=>t.disposeIntermediateTensorInfo(C)),t.disposeIntermediateTensorInfo(k),t.disposeIntermediateTensorInfo(w),N}const u=l.map(y=>{const k=[-1,be(y.shape.slice(i))];return _t({inputs:{x:y},backend:t,attrs:{shape:k}})}),d=u.map(y=>({vals:t.data.get(y.dataId).values,shape:y.shape}));a=Ci(u.map(y=>y.shape),1);const f=u[0].shape[0]===1,p=JR(d,a,e[0].dtype,f),g=Ci(l.map(y=>y.shape),i),x=t.makeTensorInfo(g,e[0].dtype,p);return u.forEach(y=>t.disposeIntermediateTensorInfo(y)),x}const mq={kernelName:Gm,backendName:"cpu",kernelFunc:mc};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QD(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i}=e,{strides:o,pad:a,dataFormat:l,dilations:u,dimRoundingMode:d}=s;We([r,i],"conv2d");const f=co(l),p=Qn(r.shape,i.shape,o,u,a,d,!1,f),g=p.filterHeight,x=p.filterWidth,y=p.dilationHeight,b=p.dilationWidth,k=p.padInfo.left,w=p.padInfo.top,N=p.dataFormat==="channelsLast",C=new Kn(p.outShape,r.dtype),S=Qe(r.shape),T=Qe(i.shape),A=S[0],E=N?S[1]:S[2],M=N?S[2]:1,P=N?1:S[1],R=C.strides[0],L=N?C.strides[1]:C.strides[2],_=N?C.strides[2]:1,O=N?1:C.strides[1],U=t.data.get(r.dataId).values,W=t.data.get(i.dataId).values,H=C.values;for(let G=0;G<p.batchSize;++G){const q=G*A,Q=G*R;for(let z=0;z<p.outHeight;++z){const K=Q+z*L,Y=z*p.strideHeight-w;for(let B=0;B<g;++B){const J=Y+B*y;if(J<0||J>=p.inHeight)continue;const ae=B*T[0],pe=q+J*E;for(let ge=0;ge<p.outWidth;++ge){const he=K+ge*_,we=ge*p.strideWidth-k;for(let Pe=0;Pe<x;++Pe){const ue=we+Pe*b;if(ue<0||ue>=p.inWidth)continue;const Te=ae+Pe*T[1],ke=pe+ue*M;let ye=Te;for(let Ce=0;Ce<p.inChannels;++Ce){const Ae=U[ke+Ce*P];for(let Be=0;Be<p.outChannels;++Be)H[he+Be*O]+=Ae*W[ye+Be];ye+=p.outChannels}}}}}}return t.makeTensorInfo(C.shape,C.dtype,H)}const gq={kernelName:Hm,backendName:"cpu",kernelFunc:QD};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xq(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:i}=e,{strides:o,pad:a,dataFormat:l,dimRoundingMode:u,filterShape:d}=s;We([r,i],"conv2dBackpropFilter");const f=co(l),p=Qn(r.shape,d,o,1,a,u,!1,f),{strideHeight:g,strideWidth:x,filterHeight:y,filterWidth:b}=p,k=p.dataFormat==="channelsLast",w=new Kn(p.filterShape,"float32"),N=p.padInfo.left,C=p.padInfo.top,S=t.data.get(r.dataId).values,T=t.data.get(i.dataId).values,A=new Kn(r.shape,r.dtype,S),E=new Kn(i.shape,i.dtype,T);for(let M=0;M<y;++M){const P=Math.max(0,Math.ceil((C-M)/g)),R=Math.min(p.outHeight,(p.inHeight+C-M)/g);for(let L=0;L<b;++L){const _=Math.max(0,Math.ceil((N-L)/x)),O=Math.min(p.outWidth,(p.inWidth+N-L)/x);for(let U=0;U<p.inChannels;++U)for(let W=0;W<p.outChannels;++W){let H=0;for(let G=0;G<p.batchSize;++G)for(let q=P;q<R;++q){const Q=M+q*g-C;for(let z=_;z<O;++z){const K=L+z*x-N;k?H+=A.get(G,Q,K,U)*E.get(G,q,z,W):H+=A.get(G,U,Q,K)*E.get(G,W,q,z)}}w.set(H,M,L,U,W)}}}return t.makeTensorInfo(w.shape,w.dtype,w.values)}const yq={kernelName:Db,backendName:"cpu",kernelFunc:xq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vq(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:i}=e,{inputShape:o,strides:a,pad:l,dataFormat:u,dimRoundingMode:d}=s;We([r,i],"conv2dBackpropInput");const f=Qe(i.shape),p=Qe(r.shape);let g=co(u);const x=Qn(o,i.shape,a,1,l,d,!1,g),y=new Kn(x.inShape,"float32"),b=y.values,k=t.data.get(r.dataId).values,w=t.data.get(i.dataId).values,[N,C,S]=f,{batchSize:T,filterHeight:A,filterWidth:E,inChannels:M,inHeight:P,inWidth:R,outChannels:L,outHeight:_,outWidth:O,strideHeight:U,strideWidth:W}=x;g=x.dataFormat;const H=A-1-x.padInfo.top,G=E-1-x.padInfo.left,q=g==="channelsLast",Q=y.strides[0],z=q?y.strides[1]:y.strides[2],K=q?y.strides[2]:1,Y=q?1:y.strides[1],B=p[0],J=q?p[1]:p[2],ae=q?p[2]:1,pe=q?1:p[1];for(let ge=0;ge<T;++ge)for(let he=0;he<M;++he)for(let we=0;we<P;++we){const Pe=we-H,ue=Math.max(0,Math.ceil(Pe/U)),Te=Math.min(_,(A+Pe)/U);for(let ke=0;ke<R;++ke){const ye=ke-G,Ce=Math.max(0,Math.ceil(ye/W)),Ae=Math.min(O,(E+ye)/W);let Be=0;for(let le=ue;le<Te;++le){const je=le*U-Pe;for(let De=Ce;De<Ae;++De){const _e=De*W-ye,it=B*ge+J*le+ae*De,St=N*(A-1-je)+C*(E-1-_e)+S*he;for(let cn=0;cn<L;++cn){const Ut=k[it+pe*cn],ut=w[St+cn];Be+=Ut*ut}}}const mt=Q*ge+z*we+K*ke+Y*he;b[mt]=Be}}return t.makeTensorInfo(y.shape,y.dtype,y.values)}const bq={kernelName:qm,backendName:"cpu",kernelFunc:vq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wq(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i}=e,{strides:o,pad:a,dilations:l}=s;We([r,i],"conv3d");const u=Jo(r.shape,i.shape,o,l,a),{filterDepth:d,filterHeight:f,filterWidth:p,dilationDepth:g,dilationHeight:x,dilationWidth:y,padInfo:b}=u,k=b.front,w=b.left,N=b.top,C=new Kn(u.outShape,r.dtype),S=t.data.get(r.dataId).values,T=t.data.get(i.dataId).values,A=C.values,E=Qe(r.shape),M=Qe(i.shape);for(let P=0;P<u.batchSize;++P){const R=P*E[0],L=P*C.strides[0];for(let _=0;_<u.outDepth;++_){const O=L+_*C.strides[1],U=_*u.strideDepth-k;for(let W=0;W<d;++W){const H=U+W*g;if(H<0||H>=u.inDepth)continue;const G=W*M[0],q=R+H*E[1];for(let Q=0;Q<u.outHeight;++Q){const z=O+Q*C.strides[2],K=Q*u.strideHeight-N;for(let Y=0;Y<f;++Y){const B=K+Y*x;if(B<0||B>=u.inHeight)continue;const J=G+Y*M[1],ae=q+B*E[2];for(let pe=0;pe<u.outWidth;++pe){const ge=z+pe*u.outChannels,he=pe*u.strideWidth-w;for(let we=0;we<p;++we){const Pe=he+we*y;if(Pe<0||Pe>=u.inWidth)continue;const ue=J+we*M[2],Te=ae+Pe*u.inChannels;let ke=ue;for(let ye=0;ye<u.inChannels;++ye){const Ce=S[Te+ye];for(let Ae=0;Ae<u.outChannels;++Ae)A[ge+Ae]+=Ce*T[ke+Ae];ke+=u.outChannels}}}}}}}}return t.makeTensorInfo(C.shape,C.dtype,C.values)}const kq={kernelName:Km,backendName:"cpu",kernelFunc:wq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cq(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:i}=e,{strides:o,pad:a,filterShape:l}=s;We([r,i],"conv3dBackpropFilterV2");const u=Qe(r.shape),d=Qe(i.shape),f=Jo(r.shape,l,o,1,a),p=f.strideDepth,g=f.strideHeight,x=f.strideWidth,y=f.filterDepth,b=f.filterHeight,k=f.filterWidth,w=new Kn(f.filterShape,"float32"),N=w.values,[C,S,T,A]=w.strides,E=t.data.get(i.dataId).values,[M,P,R,L]=d,_=t.data.get(r.dataId).values,[O,U,W,H]=u,G=f.padInfo.front,q=f.padInfo.left,Q=f.padInfo.top;for(let z=0;z<y;++z){const K=Math.max(0,Math.ceil((G-z)/p)),Y=Math.min(f.outDepth,(f.inDepth+G-z)/p),B=z*C;for(let J=0;J<b;++J){const ae=Math.max(0,Math.ceil((Q-J)/g)),pe=Math.min(f.outHeight,(f.inHeight+Q-J)/g),ge=J*S+B;for(let he=0;he<k;++he){const we=Math.max(0,Math.ceil((q-he)/x)),Pe=Math.min(f.outWidth,(f.inWidth+q-he)/x),ue=he*T+ge;for(let Te=0;Te<f.inChannels;++Te){const ke=Te*A+ue;for(let ye=0;ye<f.outChannels;++ye){let Ce=0;for(let Ae=0;Ae<f.batchSize;++Ae){const Be=Ae*O,mt=Ae*M;for(let le=K;le<Y;++le){const De=(z+le*p-G)*U+Be,_e=le*P+mt;for(let it=ae;it<pe;++it){const cn=(J+it*g-Q)*W+De,Ut=it*R+_e;for(let ut=we;ut<Pe;++ut){const Zn=(he+ut*x-q)*H+cn,Yt=ut*L+Ut;Ce+=_[Zn+Te]*E[Yt+ye]}}}}N[ke+ye]=Ce}}}}}return t.makeTensorInfo(w.shape,w.dtype,w.values)}const Sq={kernelName:Pb,backendName:"cpu",kernelFunc:Cq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nq(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:i}=e,{pad:o,strides:a,inputShape:l}=s;We([r],"conv3dBackpropInputV2");const u=Qe(r.shape),d=Qe(i.shape),f=Jo(l,i.shape,a,1,o),p=new Kn(f.inShape,"float32"),g=p.values,[x,y,b,k]=p.strides,w=t.data.get(r.dataId).values,[N,C,S,T]=u,A=t.data.get(i.dataId).values,[E,M,P,R]=d,{batchSize:L,filterDepth:_,filterHeight:O,filterWidth:U,inChannels:W,inDepth:H,inHeight:G,inWidth:q,outChannels:Q,outDepth:z,outHeight:K,outWidth:Y,strideDepth:B,strideHeight:J,strideWidth:ae}=f,pe=_-1-f.padInfo.front,ge=O-1-f.padInfo.top,he=U-1-f.padInfo.left;for(let we=0;we<L;++we)for(let Pe=0;Pe<W;++Pe)for(let ue=0;ue<H;++ue){const Te=ue-pe,ke=Math.max(0,Math.ceil(Te/B)),ye=Math.min(z,(_+Te)/B);for(let Ce=0;Ce<G;++Ce){const Ae=Ce-ge,Be=Math.max(0,Math.ceil(Ae/J)),mt=Math.min(K,(O+Ae)/J);for(let le=0;le<q;++le){const je=le-he,De=Math.max(0,Math.ceil(je/ae)),_e=Math.min(Y,(U+je)/ae);let it=0;for(let St=ke;St<ye;++St){const cn=St*B-Te;for(let Ut=Be;Ut<mt;++Ut){const ut=Ut*J-Ae;for(let yn=De;yn<_e;++yn){const Zn=yn*ae-je,Yt=N*we+C*St+S*Ut+T*yn,Dr=E*(_-1-cn)+M*(O-1-ut)+P*(U-1-Zn)+R*Pe;for(let ur=0;ur<Q;++ur){const Di=w[Yt+ur],Xe=A[Dr+ur];it+=Di*Xe}}}}g[x*we+y*ue+b*Ce+k*le+Pe]=it}}}return t.makeTensorInfo(p.shape,p.dtype,p.values)}const Iq={kernelName:Mb,backendName:"cpu",kernelFunc:Nq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tq=Rt(Ed,n=>Math.cos(n)),$q={kernelName:Ed,backendName:"cpu",kernelFunc:Tq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Eq=Rt(Ad,n=>Math.cosh(n)),Aq={kernelName:Ad,backendName:"cpu",kernelFunc:Eq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jq(n){const{inputs:e,backend:t,attrs:s}=n,{image:r,boxes:i,boxInd:o}=e,{cropSize:a,method:l,extrapolationValue:u}=s,[d,f,p,g]=r.shape,x=i.shape[0],[y,b]=a,k=dt([x,y,b,g],"float32"),w=t.data.get(i.dataId).values,N=t.data.get(o.dataId).values,C=t.data.get(r.dataId).values,S=Qe(r.shape),T=Qe(k.shape);for(let A=0;A<x;A++){const E=A*4,M=w[E],P=w[E+1],R=w[E+2],L=w[E+3],_=N[A];if(_>=d)continue;const O=y>1?(R-M)*(f-1)/(y-1):0,U=b>1?(L-P)*(p-1)/(b-1):0;for(let W=0;W<y;W++){const H=y>1?M*(f-1)+W*O:.5*(M+R)*(f-1);if(H<0||H>f-1){for(let G=0;G<b;G++)for(let q=0;q<g;q++){const Q=q+G*T[2]+W*T[1]+A*T[0];k.values[Q]=u}continue}if(l==="bilinear"){const G=Math.floor(H),q=Math.ceil(H),Q=H-G;for(let z=0;z<b;z++){const K=b>1?P*(p-1)+z*U:.5*(P+L)*(p-1);if(K<0||K>p-1){for(let ae=0;ae<g;ae++){const pe=ae+z*T[2]+W*T[1]+A*T[0];k.values[pe]=u}continue}const Y=Math.floor(K),B=Math.ceil(K),J=K-Y;for(let ae=0;ae<g;ae++){let pe=ae+Y*S[2]+G*S[1]+_*S[0];const ge=C[pe];pe=ae+B*S[2]+G*S[1]+_*S[0];const he=C[pe];pe=ae+Y*S[2]+q*S[1]+_*S[0];const we=C[pe];pe=ae+B*S[2]+q*S[1]+_*S[0];const Pe=C[pe],ue=ge+(he-ge)*J,Te=we+(Pe-we)*J;pe=ae+z*T[2]+W*T[1]+A*T[0],k.values[pe]=ue+(Te-ue)*Q}}}else for(let G=0;G<b;++G){const q=b>1?P*(p-1)+G*U:.5*(P+L)*(p-1);if(q<0||q>p-1){for(let K=0;K<g;K++){const Y=K+G*T[2]+W*T[1]+A*T[0];k.values[Y]=u}continue}const Q=Math.round(q),z=Math.round(H);for(let K=0;K<g;K++){const Y=K+Q*S[2]+z*S[1]+_*S[0],B=K+G*T[2]+W*T[1]+A*T[0];k.values[B]=C[Y]}}}}return t.makeTensorInfo(k.shape,k.dtype,k.values)}const Rq={kernelName:Fb,backendName:"cpu",kernelFunc:jq};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dq(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,exclusive:o,reverse:a}=s;We(r,"cumprod");const l=tn([i],r.shape.length);let u=r;l!=null&&(u=Ps({inputs:{x:r},backend:t,attrs:{perm:l}}));const d=mn(1,r.shape.length)[0];if(d!==u.shape.length-1)throw new Error(`backend.cumprod in CPU expects an inner-most axis=${u.shape.length-1} but got axis=${d}`);const f=Ks(u.dtype,"int32"),p=kb(be(u.shape),f),g=t.data.get(u.dataId).values,x=u.shape[u.shape.length-1],y=a?(k,w)=>k+x-w-1:(k,w)=>k+w;for(let k=0;k<g.length;k+=x)for(let w=0;w<x;w++){const N=y(k,w);if(w===0)p[N]=o?1:g[N];else{const C=y(k,w-1);p[N]=o?g[C]*p[C]:g[N]*p[C]}}const b=t.makeTensorInfo(u.shape,f,p);if(l!=null){const k=ea(l),w=Ps({inputs:{x:b},backend:t,attrs:{perm:k}});return t.disposeIntermediateTensorInfo(b),t.disposeIntermediateTensorInfo(u),w}return b}const Pq={kernelName:Lb,backendName:"cpu",kernelFunc:Dq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mq(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,exclusive:o,reverse:a}=s;We(r,"cumsum");const l=tn([i],r.shape.length);let u=r;l!=null&&(u=Ps({inputs:{x:r},backend:t,attrs:{perm:l}}));const d=mn(1,r.shape.length)[0];if(d!==u.shape.length-1)throw new Error(`backend.cumsum in CPU expects an inner-most axis=${u.shape.length-1} but got axis=${d}`);const f=Ks(u.dtype,"int32"),p=ns(be(u.shape),f),g=t.data.get(u.dataId).values,x=u.shape[u.shape.length-1],y=a?(k,w)=>k+x-w-1:(k,w)=>k+w;for(let k=0;k<g.length;k+=x)for(let w=0;w<x;w++){const N=y(k,w);if(w===0)p[N]=o?0:g[N];else{const C=y(k,w-1);p[N]=o?g[C]+p[C]:g[N]+p[C]}}const b=t.makeTensorInfo(u.shape,f,p);if(l!=null){const k=ea(l),w=Ps({inputs:{x:b},backend:t,attrs:{perm:k}});return t.disposeIntermediateTensorInfo(b),t.disposeIntermediateTensorInfo(u),w}return b}const Lq={kernelName:Qm,backendName:"cpu",kernelFunc:Mq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fq(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,weights:i}=e,{size:o,binaryOutput:a}=s;if(r.shape.length===1){const l=t.data.get(r.dataId).values,u=t.data.get(i.dataId).values,d=zw(l,u,i.dtype,i.shape,o);return t.makeTensorInfo([o],i.dtype,d)}else if(r.shape.length===2){const l=t.bufferSync(r),u=t.bufferSync(i),d=XR(l,u,o,a);return t.makeTensorInfo(d.shape,i.dtype,d.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${r.shape.length}.`)}const Oq={kernelName:Ob,backendName:"cpu",kernelFunc:Fq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _q(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockSize:i,dataFormat:o}=s;V(o==="NHWC",()=>`Only NHWC dataFormat supported on CPU for depthToSpace. Got ${o}`);const a=r.shape[0],l=r.shape[1],u=r.shape[2],d=r.shape[3],f=l*i,p=u*i,g=d/(i*i),x=t.data.get(r.dataId).values,y=new Float32Array(a*f*p*g);let b=0;for(let k=0;k<a;++k)for(let w=0;w<f;++w){const N=Math.floor(w/i),C=w%i;for(let S=0;S<p;++S){const T=Math.floor(S/i),A=S%i,E=(C*i+A)*g;for(let M=0;M<g;++M){const R=M+E+d*(T+u*(N+l*k));y[b++]=x[R]}}}return t.makeTensorInfo([a,f,p,g],r.dtype,y)}const zq={kernelName:_b,backendName:"cpu",kernelFunc:_q};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XD(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i}=e,{strides:o,pad:a,dilations:l,dimRoundingMode:u}=s;We([r,i],"depthwiseConv2DNative");const d=Qe(r.shape),f=Qe(i.shape);let p=l;p==null&&(p=[1,1]),V(rs(o,p),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${o} and dilations '${p}'`);const g=Qn(r.shape,i.shape,o,p,a,u,!0),{filterHeight:x,filterWidth:y,dilationHeight:b,dilationWidth:k,padInfo:w}=g,N=w.left,C=w.top,S=g.outChannels/g.inChannels,T=new Kn(g.outShape,r.dtype),A=t.data.get(r.dataId).values,E=t.data.get(i.dataId).values,M=T.values;for(let P=0;P<g.batchSize;++P){const R=P*d[0],L=P*T.strides[0];for(let _=0;_<g.outHeight;++_){const O=L+_*T.strides[1],U=_*g.strideHeight-C;for(let W=0;W<x;++W){const H=U+W*b;if(H<0||H>=g.inHeight)continue;const G=W*f[0],q=R+H*d[1];for(let Q=0;Q<g.outWidth;++Q){const z=O+Q*T.strides[2],K=Q*g.strideWidth-N;for(let Y=0;Y<y;++Y){const B=K+Y*k;if(B<0||B>=g.inWidth)continue;const J=G+Y*f[1],ae=q+B*g.inChannels;let pe=z,ge=J;for(let he=0;he<g.inChannels;++he){const we=A[ae+he];for(let Pe=0;Pe<S;++Pe)M[pe+Pe]+=we*E[ge+Pe];pe+=S,ge+=S}}}}}}return t.makeTensorInfo(T.shape,T.dtype,T.values)}const Bq={kernelName:Xm,backendName:"cpu",kernelFunc:XD};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wq(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:i}=e,{strides:o,dilations:a,pad:l,dimRoundingMode:u,filterShape:d}=s;We([r,i],"depthwiseConv2dNativeBackpropFilter");const f=Qn(r.shape,d,o,a,l,u,!0),{strideHeight:p,strideWidth:g,filterHeight:x,filterWidth:y}=f,b=new Kn(f.filterShape,"float32"),k=f.padInfo.left,w=f.padInfo.top,N=f.outChannels/f.inChannels,C=t.data.get(r.dataId).values,S=new Kn(r.shape,r.dtype,C),T=t.data.get(i.dataId).values,A=new Kn(i.shape,i.dtype,T);for(let E=0;E<x;++E){const M=Math.max(0,Math.ceil((w-E)/p)),P=Math.min(f.outHeight,(f.inHeight+w-E)/p);for(let R=0;R<y;++R){const L=Math.max(0,Math.ceil((k-R)/g)),_=Math.min(f.outWidth,(f.inWidth+k-R)/g);for(let O=0;O<f.outChannels;++O){const U=Math.trunc(O/N),W=O%N;let H=0;for(let G=0;G<f.batchSize;++G)for(let q=M;q<P;++q){const Q=E+q*p-w;for(let z=L;z<_;++z){const K=R+z*g-k;H+=S.get(G,Q,K,U)*A.get(G,q,z,O)}}b.set(H,E,R,U,W)}}}return t.makeTensorInfo(b.shape,b.dtype,b.values)}const Vq={kernelName:zb,backendName:"cpu",kernelFunc:Wq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uq(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:i}=e,{strides:o,dilations:a,pad:l,dimRoundingMode:u,inputShape:d}=s;We([r,i],"depthwiseConv2DNativeBackpropInput");const f=Qe(r.shape),p=Qe(i.shape),g=Qn(d,i.shape,o,a,l,u,!0),x=new Kn(g.inShape,"float32"),y=x.values,[b,k,w]=x.strides,N=t.data.get(r.dataId).values,[C,S,T]=f,A=t.data.get(i.dataId).values,[E,M,P]=p,{batchSize:R,filterHeight:L,filterWidth:_,inChannels:O,inHeight:U,inWidth:W,outChannels:H,outHeight:G,outWidth:q,strideHeight:Q,strideWidth:z}=g,K=L-1-g.padInfo.top,Y=_-1-g.padInfo.left,B=H/O;for(let J=0;J<R;++J)for(let ae=0;ae<O;++ae)for(let pe=0;pe<U;++pe){const ge=pe-K,he=Math.max(0,Math.ceil(ge/Q)),we=Math.min(G,(L+ge)/Q);for(let Pe=0;Pe<W;++Pe){const ue=Pe-Y,Te=Math.max(0,Math.ceil(ue/z)),ke=Math.min(q,(_+ue)/z);let ye=0;for(let Ce=he;Ce<we;++Ce){const Ae=Ce*Q-ge;for(let Be=Te;Be<ke;++Be){const mt=Be*z-ue,le=C*J+S*Ce+T*Be,je=E*(L-1-Ae)+M*(_-1-mt)+P*ae;for(let De=0;De<B;++De){const _e=ae*B+De,it=N[le+_e],St=A[je+De];ye+=it*St}}}y[b*J+k*pe+w*Pe+ae]=ye}}return t.makeTensorInfo(x.shape,x.dtype,x.values)}const Gq={kernelName:Bb,backendName:"cpu",kernelFunc:Uq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hq(n){const{inputs:e,backend:t}=n,{x:s}=e,r=be(s.shape),i=t.data.get(s.dataId).values,o=dt([r,r],s.dtype),a=o.values;for(let u=0;u<i.length;u++)a[u*r+u]=i[u];const l=[...s.shape,...s.shape];return t.makeTensorInfo(l,o.dtype,o.values)}const qq={kernelName:k$,backendName:"cpu",kernelFunc:Hq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kq={kernelName:Ym,backendName:"cpu",kernelFunc:({inputs:n,backend:e,attrs:t})=>{const{x:s,filter:r}=n,{strides:i,pad:o,dilations:a}=t,l=e,u=l.data.get(s.dataId).values,d=s.shape.length,f=l.data.get(r.dataId).values,p=r.shape.length,{batchSize:g,inHeight:x,inWidth:y,inChannels:b,outHeight:k,outWidth:w,padInfo:N,strideHeight:C,strideWidth:S,filterHeight:T,filterWidth:A,dilationHeight:E,dilationWidth:M,outShape:P}=ph(s.shape,r.shape,i,o,"NHWC",a),R=be(P),L=P.length,_=hn(s.dtype,R);for(let U=0;U<g;++U)for(let W=0;W<k;++W){const H=W*C-N.top;for(let G=0;G<w;++G){const q=G*S-N.left;for(let Q=0;Q<b;++Q){let z=Number.MIN_SAFE_INTEGER;for(let Y=0;Y<T;++Y){const B=H+Y*E;if(B>=0&&B<x)for(let J=0;J<A;++J){const ae=q+J*M;if(ae>=0&&ae<y){const pe=wi([U,B,ae,Q],d,Qe(s.shape)),ge=wi([Y,J,Q],p,Qe(r.shape)),he=u[pe]+f[ge];he>z&&(z=he)}}}const K=wi([U,W,G,Q],L,Qe(P));_[K]=z}}}return{dataId:l.write(tl(_,s.dtype),P,s.dtype),shape:P,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qq={kernelName:hv,backendName:"cpu",kernelFunc:({inputs:n,backend:e,attrs:t})=>{const{x:s,filter:r,dy:i}=n,{strides:o,pad:a,dilations:l}=t,u=e,d=Xr(s.shape,u.data.get(s.dataId).values),f=Xr(r.shape,u.data.get(r.dataId).values),{batchSize:p,inHeight:g,inWidth:x,inChannels:y,outHeight:b,outWidth:k,padInfo:w,strideHeight:N,strideWidth:C,filterHeight:S,filterWidth:T,dilationHeight:A,dilationWidth:E,outShape:M}=ph(s.shape,r.shape,o,a,"NHWC",l);V(i.rank===M.length,()=>`Error in ${hv}, dy must have the same rank as output ${M.length}, but got ${i.rank}`);const P=Xr(M,u.data.get(i.dataId).values),R=y$(r.shape,r.dtype);for(let _=0;_<p;++_)for(let O=0;O<b;++O){const U=O*N-w.top;for(let W=0;W<k;++W){const H=W*C-w.left;for(let G=0;G<y;++G){let q=Number.MIN_SAFE_INTEGER,Q=0,z=0;for(let K=0;K<S;++K){const Y=U+K*A;if(Y>=0&&Y<g)for(let B=0;B<T;++B){const J=H+B*E;if(J>=0&&J<x){const ae=d[_][Y][J][G]+f[K][B][G];ae>q&&(q=ae,Q=K,z=B)}}}R[Q][z][G]+=P[_][O][W][G]}}}return{dataId:u.write(tl(R,s.dtype),r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xq={kernelName:dv,backendName:"cpu",kernelFunc:({inputs:n,backend:e,attrs:t})=>{const{x:s,filter:r,dy:i}=n,{strides:o,pad:a,dilations:l}=t,u=e,d=Xr(s.shape,u.data.get(s.dataId).values),f=Xr(r.shape,u.data.get(r.dataId).values),{batchSize:p,inHeight:g,inWidth:x,inChannels:y,outHeight:b,outWidth:k,padInfo:w,strideHeight:N,strideWidth:C,filterHeight:S,filterWidth:T,dilationHeight:A,dilationWidth:E,outShape:M}=ph(s.shape,r.shape,o,a,"NHWC",l);V(i.rank===M.length,()=>`Error in ${dv}, dy must have the same rank as output ${M.length}, but got ${i.rank}`);const P=Xr(M,u.data.get(i.dataId).values),R=y$(s.shape,s.dtype);for(let _=0;_<p;++_)for(let O=0;O<b;++O){const U=O*N-w.top;for(let W=0;W<k;++W){const H=W*C-w.left;for(let G=0;G<y;++G){let q=Number.MIN_SAFE_INTEGER,Q=U<0?0:U,z=H<0?0:H;for(let K=0;K<S;++K){const Y=U+K*A;if(Y>=0&&Y<g)for(let B=0;B<T;++B){const J=H+B*E;if(J>=0&&J<x){const ae=d[_][Y][J][G]+f[K][B][G];ae>q&&(q=ae,Q=Y,z=J)}}}R[_][Q][z][G]+=P[_][O][W][G]}}}return{dataId:u.write(tl(R,s.dtype),s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yq(n){const{inputs:e,backend:t,attrs:s}=n,{image:r}=e,{canvas:i,options:o}=s,{contextOptions:a,imageOptions:l}=o||{},u=(l==null?void 0:l.alpha)||1,d=(a==null?void 0:a.contextType)||"2d";if(d!=="2d")throw new Error(`Context type ${a.contextType} is not supported by the CPU backend.`);const f=i.getContext(d,(a==null?void 0:a.contextAttributes)||{});if(f==null)throw new Error(`Could not get the context with ${d} type.`);const[p,g]=r.shape.slice(0,2),x=r.shape.length===2?1:r.shape[2],y=t.data.get(r.dataId).values,b=r.dtype==="float32"?255:1,k=new Uint8ClampedArray(g*p*4);for(let N=0;N<p*g;++N){const C=[0,0,0,255*u];for(let T=0;T<x;T++){const A=y[N*x+T];if(r.dtype==="float32"){if(A<0||A>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${A}.`)}else if(r.dtype==="int32"&&(A<0||A>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${A}.`);x===1?(C[0]=A*b,C[1]=A*b,C[2]=A*b):C[T]=A*b}const S=N*4;k[S+0]=Math.round(C[0]),k[S+1]=Math.round(C[1]),k[S+2]=Math.round(C[2]),k[S+3]=Math.round(C[3])}i.width=g,i.height=p;const w=new ImageData(k,g,p);return f.putImageData(w,0,0),r}const Zq={kernelName:o_,backendName:"cpu",kernelFunc:Yq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ah(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:o}=s;We(r,"sum");let a;r.dtype==="bool"?a=Qo({inputs:{x:r},backend:t,attrs:{dtype:"int32"}}):a=ji({inputs:{x:r},backend:t});const l=a.shape.length,u=ht(i,a.shape),d=tn(u,l);let f=u,p=a;d!=null&&(p=Ps({inputs:{x:a},backend:t,attrs:{perm:d}}),f=mn(f.length,l)),Xn("sum",f,p.shape.length);const[g,x]=zn(p.shape,f),y=Ks(p.dtype,"int32");let b=dm(t,g,y);const k=be(x),w=t.data.get(b.dataId).values,N=t.data.get(p.dataId).values;for(let C=0;C<w.length;++C){const S=C*k;let T=0;for(let A=0;A<k;++A)T+=N[S+A];w[C]=T}if(o){const C=kn(b.shape,u),S=b;b=_t({inputs:{x:b},backend:t,attrs:{shape:C}}),t.disposeIntermediateTensorInfo(S)}return t.disposeIntermediateTensorInfo(a),d!=null&&t.disposeIntermediateTensorInfo(p),b}const Jq={kernelName:Ag,backendName:"cpu",kernelFunc:Ah};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eK(n){const{inputs:e,backend:t,attrs:s}=n,{equation:r}=s,i=e,{allDims:o,summedDims:a,idDims:l}=uw(r,i.length);hw(o.length,l,i);const{path:u,steps:d}=fw(a,l),f=d.length;let p=null,g=o.length;const x=[];for(let y=0;y<f;++y){for(const b of d[y]){const{permutationIndices:k,expandDims:w}=dw(g,l[b]);let N;pw(k)?N=i[b]:(N=Ps({inputs:{x:i[b]},backend:t,attrs:{perm:k}}),x.push(N));const C=N.shape.slice();for(let S=0;S<w.length;++S)C.splice(w[S],0,1);At(N.shape,C)||(N=_t({inputs:{x:N},backend:t,attrs:{shape:C}}),x.push(N)),p===null?p=N:(p=lx({inputs:{a:N,b:p},backend:t}),x.push(p))}y<f-1&&(u[y]>=0&&(p=Ah({inputs:{x:p},backend:t,attrs:{axis:u[y]-(o.length-g),keepDims:!1}}),x.push(p)),g--)}for(const y of x)y!==p&&t.disposeIntermediateTensorInfo(y);return p}const tK={kernelName:Wb,backendName:"cpu",kernelFunc:eK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nK(n){const{inputs:e,backend:t}=n,{dy:s,y:r}=e;We([s,r],"eluGrad");const i=new Float32Array(be(r.shape)),o=t.data.get(r.dataId).values,a=t.data.get(s.dataId).values;for(let l=0;l<o.length;++l){const u=o[l];u>=0?i[l]=a[l]:i[l]=a[l]*(u+1)}return t.makeTensorInfo(r.shape,"float32",i)}const sK={kernelName:Vb,backendName:"cpu",kernelFunc:nK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rK=sw,iK=rw,oK=iw,aK=ow,lK=aw,cK=lw,uK=Rt(Dd,n=>{const e=Math.sign(n),t=Math.abs(n),s=1/(1+rK*t);return e*(1-((((cK*s+lK)*s+aK)*s+oK)*s+iK)*s*Math.exp(-t*t))}),dK={kernelName:Dd,backendName:"cpu",kernelFunc:uK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pm(n){const{inputs:e,backend:t,attrs:s}=n,{input:r}=e,{dim:i}=s,o=r.shape.length,a=r.shape.slice();let l=i;return i<0&&(V(-(o+1)<=i,()=>`Axis must be in the interval [${-(o+1)}, ${o}]`),l=o+i+1),a.splice(l,0,1),_t({inputs:{x:r},backend:t,attrs:{shape:a}})}const hK={kernelName:Jm,backendName:"cpu",kernelFunc:pm};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fK=xn((n,e)=>n/e),Hw=jn(jd,fK),Fv={kernelName:jd,backendName:"cpu",kernelFunc:Hw};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YD(n,e,t){const s=n.shape,r=s[0],i=s[1],o=t.data.get(n.dataId),a=o.complexTensorInfos.real,l=o.complexTensorInfos.imag,u=[r,i],d=be(u),f=ts("float32",d),p=ts("float32",d);for(let b=0;b<r;b++){const k=Za({inputs:{x:a},backend:t,attrs:{begin:[b,0],size:[1,i]}}),w=Za({inputs:{x:l},backend:t,attrs:{begin:[b,0],size:[1,i]}}),N=qs({inputs:{real:k,imag:w},backend:t}),{real:C,imag:S}=pK(N,e,t),T=so(C,S);for(let A=0;A<i;A++){const E=cw(T,A);f[b*i+A]=E.real,p[b*i+A]=E.imag}t.disposeIntermediateTensorInfo(k),t.disposeIntermediateTensorInfo(w),t.disposeIntermediateTensorInfo(N)}const g=t.makeTensorInfo(u,"float32",f),x=t.makeTensorInfo(u,"float32",p),y=qs({inputs:{real:g,imag:x},backend:t});return t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(x),y}function pK(n,e,t){const s=be(n.shape),r=t.data.get(n.dataId),i=t.data.get(r.complexTensorInfos.real.dataId).values,o=t.data.get(r.complexTensorInfos.imag.dataId).values;if(mK(s)){const a=Ov(i,o,s,e,t),l=[n.shape[0],n.shape[1]];if(e){const u=t.makeTensorInfo(l,"float32",a.real),d=t.makeTensorInfo(l,"float32",a.imag),f=t.makeTensorInfo([],"float32",Yo(s,"float32")),p=ji({inputs:{x:f},backend:t}),g=Fv.kernelFunc({inputs:{a:u,b:f},backend:t}),x=Fv.kernelFunc({inputs:{a:d,b:p},backend:t}),y=t.data.get(g.dataId).values,b=t.data.get(x.dataId).values;return t.disposeIntermediateTensorInfo(u),t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(x),{real:y,imag:b}}return a}else{const a=so(i,o),l=gK(a,s,e);return dA(l)}}function mK(n){return(n&n-1)===0}function Ov(n,e,t,s,r){if(t===1)return{real:n,imag:e};const i=so(n,e),o=t/2,a=hA(i),l=a.real,u=a.imag,d=[l.length],f=r.makeTensorInfo(d,"float32",l),p=r.makeTensorInfo(d,"float32",u),g=qs({inputs:{real:f,imag:p},backend:r}),x=fA(i),y=x.real,b=x.imag,k=[y.length],w=r.makeTensorInfo(k,"float32",y),N=r.makeTensorInfo(k,"float32",b),C=qs({inputs:{real:w,imag:N},backend:r}),S=Ov(l,u,o,s,r),T=S.real,A=S.imag,E=[T.length],M=r.makeTensorInfo(E,"float32",T),P=r.makeTensorInfo(E,"float32",A),R=qs({inputs:{real:M,imag:P},backend:r}),L=Ov(y,b,o,s,r),_=L.real,O=L.imag,U=[_.length],W=r.makeTensorInfo(U,"float32",_),H=r.makeTensorInfo(U,"float32",O),G=qs({inputs:{real:W,imag:H},backend:r}),q=mA(t,s),Q=[q.real.length],z=r.makeTensorInfo(Q,"float32",q.real),K=r.makeTensorInfo(Q,"float32",q.imag),Y=qs({inputs:{real:z,imag:K},backend:r}),B=lx({inputs:{a:Y,b:G},backend:r}),J=fc({inputs:{a:R,b:B},backend:r}),ae=Uw({inputs:{a:R,b:B},backend:r}),pe=Ya({inputs:{input:J},backend:r}),ge=Ya({inputs:{input:ae},backend:r}),he=pc({inputs:{input:J},backend:r}),we=pc({inputs:{input:ae},backend:r}),Pe=mc({inputs:[pe,ge],backend:r,attrs:{axis:0}}),ue=mc({inputs:[he,we],backend:r,attrs:{axis:0}}),Te=r.data.get(Pe.dataId).values,ke=r.data.get(ue.dataId).values;return r.disposeIntermediateTensorInfo(f),r.disposeIntermediateTensorInfo(p),r.disposeIntermediateTensorInfo(g),r.disposeIntermediateTensorInfo(w),r.disposeIntermediateTensorInfo(N),r.disposeIntermediateTensorInfo(C),r.disposeIntermediateTensorInfo(M),r.disposeIntermediateTensorInfo(P),r.disposeIntermediateTensorInfo(R),r.disposeIntermediateTensorInfo(W),r.disposeIntermediateTensorInfo(H),r.disposeIntermediateTensorInfo(G),r.disposeIntermediateTensorInfo(z),r.disposeIntermediateTensorInfo(K),r.disposeIntermediateTensorInfo(Y),r.disposeIntermediateTensorInfo(B),r.disposeIntermediateTensorInfo(J),r.disposeIntermediateTensorInfo(ae),r.disposeIntermediateTensorInfo(pe),r.disposeIntermediateTensorInfo(he),r.disposeIntermediateTensorInfo(ge),r.disposeIntermediateTensorInfo(we),r.disposeIntermediateTensorInfo(Pe),r.disposeIntermediateTensorInfo(ue),{real:Te,imag:ke}}function gK(n,e,t){const s=new Float32Array(e*2);for(let r=0;r<e;r++){let i=0,o=0;for(let a=0;a<e;a++){const l=gA(r*a,e,t),u=cw(n,a);i+=u.real*l.real-u.imag*l.imag,o+=u.real*l.imag+u.imag*l.real}t&&(i/=e,o/=e),pA(s,i,o,r)}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xK(n){const{inputs:e,backend:t}=n,{input:s}=e,r=be(s.shape),i=s.shape[s.shape.length-1],o=r/i,a=_t({inputs:{x:s},backend:t,attrs:{shape:[o,i]}}),l=YD(a,!1,t),u=_t({inputs:{x:l},backend:t,attrs:{shape:s.shape}});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(l),u}const yK={kernelName:Ub,backendName:"cpu",kernelFunc:xK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qw(n){const{backend:e,attrs:t}=n,{shape:s,value:r,dtype:i}=t,o=i||Nc(r),a=hn(o,be(s));return bK(a,r,o),e.makeTensorInfo(s,o,a)}const vK={kernelName:Gb,backendName:"cpu",kernelFunc:qw};function bK(n,e,t){n.fill(e)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wK={kernelName:Hb,backendName:"cpu",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{image:s}=n,r=t,i=ts(s.dtype,be(s.shape)),[o,a,l,u]=s.shape,d=r.data.get(s.dataId).values;for(let p=0;p<o;p++){const g=p*l*a*u;for(let x=0;x<a;x++){const y=x*(l*u);for(let b=0;b<l;b++){const k=b*u;for(let w=0;w<u;w++){const N=Math.round(l-b-1),C=g+y+k+w;let S=d[C];if(N>=0&&N<l){const T=N*u,A=g+y+T+w;S=d[A]}i[C]=S}}}}return{dataId:r.write(i,s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kK(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i,bias:o,preluActivationWeights:a}=e,{strides:l,pad:u,dataFormat:d,dilations:f,dimRoundingMode:p,activation:g,leakyreluAlpha:x}=s;let y=QD({inputs:{x:r,filter:i},backend:t,attrs:{strides:l,pad:u,dataFormat:d,dilations:f,dimRoundingMode:p}});if(o){const b=y;if(d==="NCHW"&&o.shape.length===1&&o.shape[0]!==1){const k=_t({inputs:{x:o},backend:t,attrs:{shape:[o.shape[0],1,1]}});y=fc({inputs:{a:y,b:k},backend:t}),t.disposeIntermediateTensorInfo(k)}else y=fc({inputs:{a:y,b:o},backend:t});t.disposeIntermediateTensorInfo(b)}if(g){const b=y;if(d==="NCHW"&&g==="prelu"&&a.shape.length===1&&a.shape[0]!==1){const k=_t({inputs:{x:a},backend:t,attrs:{shape:[a.shape[0],1,1]}});y=fm(t,y,g,k,x),t.disposeIntermediateTensorInfo(k)}else y=fm(t,y,g,a,x);t.disposeIntermediateTensorInfo(b)}return y}const CK={kernelName:Hp,backendName:"cpu",kernelFunc:kK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SK(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i,bias:o,preluActivationWeights:a}=e,{strides:l,pad:u,dataFormat:d,dilations:f,dimRoundingMode:p,activation:g,leakyreluAlpha:x}=s;let y=XD({inputs:{x:r,filter:i},backend:t,attrs:{strides:l,pad:u,dataFormat:d,dilations:f,dimRoundingMode:p}});if(o){const b=y;y=fc({inputs:{a:y,b:o},backend:t}),t.disposeIntermediateTensorInfo(b)}if(g){const b=y;y=fm(t,y,g,a,x),t.disposeIntermediateTensorInfo(b)}return y}const NK={kernelName:B$,backendName:"cpu",kernelFunc:SK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IK(n){const{inputs:e,backend:t}=n,{params:s,indices:r}=e,i=be(s.shape),o=r.shape,a=o[o.length-1],[l,u,d,f]=H1(s,r);if(u===0)return t.makeTensorInfo(l,s.dtype,[]);const p=t.data.get(r.dataId).values,g=t.bufferSync(s),x=aD(p,g,s.dtype,u,a,d,f,s.shape,i);return t.makeTensorInfo(l,s.dtype,x.values)}const TK={kernelName:C$,backendName:"cpu",kernelFunc:IK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $K(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,indices:i}=e,{axis:o,batchDims:a}=s;We([r,i],"gatherV2");const l=ht(o,r.shape)[0],u=t.data.get(i.dataId).values,d=r.shape[l];for(let C=0;C<u.length;++C){const S=u[C];V(S<=d-1&&S>=0,()=>`GatherV2: the index value ${S} is not in [0, ${d-1}]`)}let f=a;a==null&&(f=0);const p=be(i.shape),g=gw(r,i,l,f),x=_t({inputs:{x:r},backend:t,attrs:{shape:[g.batchSize,g.outerSize,g.dimSize,g.sliceSize]}}),y=_t({inputs:{x:i},backend:t,attrs:{shape:[g.batchSize,p/g.batchSize]}}),b=[g.batchSize,g.outerSize,p/g.batchSize,g.sliceSize],k=t.bufferSync(y),w=t.bufferSync(x),N=lD(w,k,b);return t.disposeIntermediateTensorInfo(x),t.disposeIntermediateTensorInfo(y),t.makeTensorInfo(g.outputShape,N.dtype,N.values)}const EK={kernelName:tg,backendName:"cpu",kernelFunc:$K};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AK(n){const{inputs:e,backend:t}=n,{input:s}=e,r=be(s.shape),i=s.shape[s.shape.length-1],o=r/i,a=_t({inputs:{x:s},backend:t,attrs:{shape:[o,i]}}),l=YD(a,!0,t),u=_t({inputs:{x:l},backend:t,attrs:{shape:s.shape}});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(l),u}const jK={kernelName:qb,backendName:"cpu",kernelFunc:AK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RK=Rt(zd,n=>Number.isFinite(n)?1:0,"bool"),DK={kernelName:zd,backendName:"cpu",kernelFunc:RK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PK=Rt(Bd,n=>Math.abs(n)===1/0?1:0,"bool"),MK={kernelName:Bd,backendName:"cpu",kernelFunc:PK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LK=Rt(Wd,n=>Number.isNaN(n)?1:0,"bool"),FK={kernelName:Wd,backendName:"cpu",kernelFunc:LK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OK(n){const{backend:e,attrs:t}=n,{start:s,stop:r,num:i}=t,o=fD(s,r,i);return e.makeTensorInfo([o.length],"float32",o)}const _K={kernelName:S$,backendName:"cpu",kernelFunc:OK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zK=Rt(Ud,n=>Math.log1p(n)),BK={kernelName:Ud,backendName:"cpu",kernelFunc:zK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WK=xn((n,e)=>n&&e),VK=jn(og,WK,null,"bool"),UK={kernelName:og,backendName:"cpu",kernelFunc:VK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GK=Rt(ag,n=>n?0:1,"bool"),HK={kernelName:ag,backendName:"cpu",kernelFunc:GK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qK=xn((n,e)=>n||e),KK=jn(lg,qK,null,"bool"),QK={kernelName:lg,backendName:"cpu",kernelFunc:KK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XK(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{depthRadius:i,bias:o,alpha:a,beta:l}=s;We(r,"LRN");const u=r.shape[3],d=u-1,f=t.data.get(r.dataId).values,p=be(r.shape),g=new Float32Array(p);function x(y){const b=y%u;let k=y-b+Math.max(0,b-i);const w=y-b+Math.min(b+i,d);let N=0;for(;k<=w;k++){const C=f[k];N+=C*C}return N}for(let y=0;y<p;y++){const b=x(y),k=f[y]*Math.pow(o+a*b,-l);g[y]=k}return t.makeTensorInfo(r.shape,r.dtype,g)}const YK={kernelName:cg,backendName:"cpu",kernelFunc:XK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZK(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,y:i,dy:o}=e,{depthRadius:a,bias:l,alpha:u,beta:d}=s;We(o,"LRNGrad");const f=be(o.shape),p=o.shape[3],g=t.data.get(o.dataId).values,x=t.data.get(r.dataId).values,y=t.data.get(i.dataId).values,b=new Float32Array(f),k=f;for(let w=0;w<k;w++){const N=w%p,C=w-N+Math.max(0,N-a),S=w-N+Math.min(p,N+a+1);let T=0;for(let A=C;A<S;A++)T+=Math.pow(x[A],2);T=u*T+l;for(let A=C;A<S;A++){let E=-2*u*d*x[A]*y[w]/T;w===A&&(E+=Math.pow(T,-d)),E*=g[w],b[A]+=E}}return t.makeTensorInfo(o.shape,r.dtype,b)}const JK={kernelName:Qb,backendName:"cpu",kernelFunc:ZK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZD(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{reductionIndices:i,keepDims:o}=s,a=t;let l=r.shape;const u=l.length,d=ht(i,l);let f=d;const p=tn(f,u);let g=a.data.get(r.dataId).values;if(p!=null){const C=new Array(u);for(let S=0;S<C.length;S++)C[S]=l[p[S]];g=Ww(g,l,r.dtype,p,C),f=mn(f.length,u),l=C}We(r,"max"),Xn("max",f,u);const[x,y]=zn(l,f),b=be(y),k=mD(g,b,x,r.dtype),w=a.write(k,x,r.dtype);let N=x;return o&&(N=kn(x,d)),{dataId:w,shape:N,dtype:r.dtype}}const eQ={kernelName:ug,backendName:"cpu",kernelFunc:ZD};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tQ(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e;We(r,"maxPool");const{filterSize:i,strides:o,pad:a,dimRoundingMode:l}=s,u=1;V(rs(o,u),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${u}'`);const d=Ar(r.shape,i,o,u,a,l);let f;if(d.filterWidth===1&&d.filterHeight===1&&At(d.inShape,d.outShape))f=ji({inputs:{x:r},backend:t});else{const p=t.data.get(r.dataId).values,g=Qe(r.shape),x=Gw(p,r.shape,r.dtype,g,d,"max");f=t.makeTensorInfo(d.outShape,r.dtype,x.values)}return f}const nQ={kernelName:dg,backendName:"cpu",kernelFunc:tQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sQ(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{filterSize:i,strides:o,pad:a,dimRoundingMode:l,dataFormat:u}=s;We(r,"maxPool3d");const d=lo(r.shape,i,o,1,a,l,u),f=t.data.get(r.dataId).values,p=KD(f,r.shape,r.dtype,Qe(r.shape),d,"max");return t.makeTensorInfo(p.shape,"float32",p.values)}const rQ={kernelName:hg,backendName:"cpu",kernelFunc:sQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iQ(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:i}=e,{filterSize:o,strides:a,pad:l,dimRoundingMode:u}=s;We([r,i],"maxPool3DGrad");const d=lo(i.shape,o,a,1,l,u),f=t.bufferSync(i),p=q7(f,d),g=d.strideDepth,x=d.strideHeight,y=d.strideWidth,b=d.dilationDepth,k=d.dilationHeight,w=d.dilationWidth,N=d.effectiveFilterDepth,C=d.effectiveFilterHeight,S=d.effectiveFilterWidth,T=N-1-d.padInfo.front,A=S-1-d.padInfo.left,E=C-1-d.padInfo.top,M=dt(i.shape,"float32"),P=t.bufferSync(r);for(let R=0;R<d.batchSize;++R)for(let L=0;L<d.inChannels;++L)for(let _=0;_<d.inDepth;++_)for(let O=0;O<d.inHeight;++O)for(let U=0;U<d.inWidth;++U){const W=_-T,H=O-E,G=U-A;let q=0;for(let Q=0;Q<N;Q+=b){const z=(W+Q)/g;if(!(z<0||z>=d.outDepth||Math.floor(z)!==z))for(let K=0;K<C;K+=k){const Y=(H+K)/x;if(!(Y<0||Y>=d.outHeight||Math.floor(Y)!==Y))for(let B=0;B<S;B+=w){const J=(G+B)/y;if(J<0||J>=d.outWidth||Math.floor(J)!==J)continue;const ae=N*C*S-1-p.get(R,z,Y,J,L),pe=Q*C*S+K*S+B,ge=ae===pe?1:0;if(ge===0)continue;const he=P.get(R,z,Y,J,L);q+=he*ge}}}M.set(q,R,_,O,U,L)}return t.makeTensorInfo(M.shape,M.dtype,M.values)}const oQ={kernelName:Yb,backendName:"cpu",kernelFunc:iQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aQ(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:i,output:o}=e,a=i;We([i,o],"maxPoolGrad");const{filterSize:l,strides:u,pad:d,dimRoundingMode:f}=s,p=Ar(a.shape,l,u,1,d,f),g=t.data.get(a.dataId).values,x=dt(p.outShape,a.dtype,qD(g,a.shape,a.dtype,p).values),y=p.strideHeight,b=p.strideWidth,k=p.dilationHeight,w=p.dilationWidth,N=p.effectiveFilterHeight,C=p.effectiveFilterWidth,S=C-1-p.padInfo.left,T=N-1-p.padInfo.top,A=dt(a.shape,"float32"),E=t.data.get(r.dataId).values,M=dt(r.shape,"float32",E);for(let P=0;P<p.batchSize;++P)for(let R=0;R<p.inChannels;++R)for(let L=0;L<p.inHeight;++L)for(let _=0;_<p.inWidth;++_){const O=L-T,U=_-S;let W=0;for(let H=0;H<N;H+=k){const G=(O+H)/y;if(!(G<0||G>=p.outHeight||Math.floor(G)!==G))for(let q=0;q<C;q+=w){const Q=(U+q)/b;if(Q<0||Q>=p.outWidth||Math.floor(Q)!==Q)continue;const z=N*C-1-x.get(P,G,Q,R),K=H*C+q,Y=z===K?1:0;if(Y===0)continue;const B=M.get(P,G,Q,R);W+=B*Y}}A.set(W,P,L,_,R)}return t.makeTensorInfo(A.shape,A.dtype,A.values)}const lQ={kernelName:Xb,backendName:"cpu",kernelFunc:aQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cQ(n,e,t,s,r){const i=Qe(e),o=Gw(n,e,t,i,r,"max"),a=qD(n,e,t,r,!0,s);return[o.values,a.values]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uQ={kernelName:N$,backendName:"cpu",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{x:s}=n,{filterSize:r,strides:i,pad:o,includeBatchInIndex:a}=e,l=t;We(s,"MaxPoolWithArgmax");const u=l.data.get(s.dataId).values,d=Ar(s.shape,r,i,[1,1],o),[f,p]=cQ(u,s.shape,s.dtype,a,d),g=l.write(f,d.outShape,s.dtype),x=l.write(p,d.outShape,s.dtype);return[{dataId:g,shape:d.outShape,dtype:s.dtype},{dataId:x,shape:d.outShape,dtype:"int32"}]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dQ(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:o}=s,a=ht(i,r.shape),u=zn(r.shape,a)[1],d=be(u),f=[],p=t.makeTensorInfo([],"float32",new Float32Array([d]));f.push(p);const g=Qo({inputs:{x:r},backend:t,attrs:{dtype:"float32"}});f.push(g);const x=Hw({inputs:{a:g,b:p},backend:t});f.push(x);const y=Ah({inputs:{x},backend:t,attrs:{axis:i,keepDims:o}});return f.forEach(b=>t.disposeIntermediateTensorInfo(b)),y}const hQ={kernelName:fg,backendName:"cpu",kernelFunc:dQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fQ(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:o}=s;We(r,"min");const a=ht(i,r.shape);let l=a;const u=tn(l,r.shape.length);let d=r;u!=null&&(d=Ps({inputs:{x:r},backend:t,attrs:{perm:u}}),l=mn(l.length,r.shape.length)),Xn("min",l,d.shape.length);const[f,p]=zn(d.shape,l),g=be(p),x=ns(be(f),d.dtype),y=t.data.get(d.dataId).values;for(let k=0;k<x.length;++k){const w=k*g;let N=y[w];for(let C=0;C<g;++C){const S=y[w+C];(Number.isNaN(S)||S<N)&&(N=S)}x[k]=N}u!=null&&t.disposeIntermediateTensorInfo(d);const b=t.makeTensorInfo(f,d.dtype,x);if(o){const k=kn(f,a),w=_t({inputs:{x:b},backend:t,attrs:{shape:k}});return t.disposeIntermediateTensorInfo(b),w}return b}const pQ={kernelName:pg,backendName:"cpu",kernelFunc:fQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mQ(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{paddings:i,mode:o}=s;We(r,"mirrorPad");const a=i.map((N,C)=>N[0]+r.shape[C]+N[1]),l=i.map(N=>N[0]),u=i.map((N,C)=>N[0]+r.shape[C]),d=o==="reflect"?0:1,f=t.data.get(r.dataId).values,p=r.shape.length,g=Qe(r.shape),x=be(a),y=a.length,b=Qe(a),k=ts(r.dtype,x);for(let N=0;N<x;N++){let C=Ic(N,y,b);for(let T=0;T<y;T++)C[T]<l[T]?C[T]=l[T]*2-C[T]-d:C[T]>=u[T]&&(C[T]=(u[T]-1)*2-C[T]+d);C=C.map((T,A)=>T-l[A]);const S=wi(C,p,g);k[N]=f[S]}return{dataId:t.write(k,a,r.dtype),shape:a,dtype:r.dtype}}const gQ={kernelName:mg,backendName:"cpu",kernelFunc:mQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xQ=xn(((n,e)=>{const t=n%e;return n<0&&e<0||n>=0&&e>=0?t:(t+e)%e})),yQ=jn(qd,xQ),vQ={kernelName:qd,backendName:"cpu",kernelFunc:yQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JD(n){const{inputs:e,backend:t,attrs:s}=n,{logits:r}=e,{dim:i}=s,o=r.shape.length;let a=i;if(a===-1&&(a=o-1),a!==o-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${o} and dim was ${a}`);const l=ht([a],r.shape),u=ZD({inputs:{x:r},backend:t,attrs:{reductionIndices:l,keepDims:!1}}),d=kn(u.shape,l),f=_t({inputs:{x:u},backend:t,attrs:{shape:d}}),p=Uw({inputs:{a:r,b:f},backend:t}),g=sD({inputs:{x:p},backend:t}),x=Ah({inputs:{x:g},backend:t,attrs:{axis:l,keepDims:!1}}),y=_t({inputs:{x},backend:t,attrs:{shape:d}}),b=Hw({inputs:{a:g,b:y},backend:t});return t.disposeIntermediateTensorInfo(u),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(x),t.disposeIntermediateTensorInfo(y),b}const bQ={kernelName:Dg,backendName:"cpu",kernelFunc:JD};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wQ(n){const{inputs:e,backend:t,attrs:s}=n,{logits:r}=e,{numSamples:i,seed:o,normalized:a}=s;We(r,"multinomial");const l=a?r:JD({inputs:{logits:r},backend:t,attrs:{dim:-1}}),u=l.shape[0],d=l.shape[1],f=t.data.get(l.dataId).values,p=[u,i],g=ns(be(p),"int32");for(let x=0;x<u;++x){const y=x*d,b=new Float32Array(d-1);b[0]=f[y];for(let N=1;N<b.length;++N)b[N]=b[N-1]+f[y+N];const k=j1.alea(o.toString()),w=x*i;for(let N=0;N<i;++N){const C=k();g[w+N]=b.length;for(let S=0;S<b.length;S++)if(C<b[S]){g[w+N]=S;break}}}return a||t.disposeIntermediateTensorInfo(l),t.makeTensorInfo(p,"int32",g)}const kQ={kernelName:I$,backendName:"cpu",kernelFunc:wQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CQ=z1;function SQ(n){const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l}=s;We(r,"NonMaxSuppression");const u=t.data.get(r.dataId).values,d=t.data.get(i.dataId).values,{selectedIndices:f}=CQ(u,d,o,a,l);return t.makeTensorInfo([f.length],"int32",new Int32Array(f))}const NQ={kernelName:Zb,backendName:"cpu",kernelFunc:SQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IQ=B1;function TQ(n){const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l,padToMaxOutputSize:u}=s;We(r,"NonMaxSuppressionPadded");const d=t.data.get(r.dataId).values,f=t.data.get(i.dataId).values,{selectedIndices:p,validOutputs:g}=IQ(d,f,o,a,l,u);return[t.makeTensorInfo([p.length],"int32",new Int32Array(p)),t.makeTensorInfo([],"int32",new Int32Array([g]))]}const $Q={kernelName:Jb,backendName:"cpu",kernelFunc:TQ};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EQ=W1;function AQ(n){const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l,softNmsSigma:u}=s;We(r,"NonMaxSuppressionWithScore");const d=t.data.get(r.dataId).values,f=t.data.get(i.dataId).values,p=o,g=a,x=l,y=u,{selectedIndices:b,selectedScores:k}=EQ(d,f,p,g,x,y);return[t.makeTensorInfo([b.length],"int32",new Int32Array(b)),t.makeTensorInfo([k.length],"float32",new Float32Array(k))]}const jQ={kernelName:e1,backendName:"cpu",kernelFunc:AQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RQ(n){const{inputs:e,backend:t,attrs:s}=n,{indices:r}=e,{dtype:i,depth:o,onValue:a,offValue:l}=s;We(r,"oneHot");const u=be(r.shape),d=new Float32Array(u*o);d.fill(l);const f=t.data.get(r.dataId).values;for(let p=0;p<u;++p)f[p]>=0&&f[p]<o&&(d[p*o+f[p]]=a);return t.makeTensorInfo([...r.shape,o],i,d)}const DQ={kernelName:vg,backendName:"cpu",kernelFunc:RQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mm(n){const{inputs:e,backend:t}=n,{x:s}=e;if(s.dtype==="string")throw new Error("zerosLike is not supported for string tensors");if(s.dtype==="complex64"){const r=Ya({inputs:{input:s},backend:t}),i=mm({inputs:{x:r},backend:t}),o=pc({inputs:{input:s},backend:t}),a=mm({inputs:{x:o},backend:t}),l=qs({inputs:{real:i,imag:a},backend:t});return t.disposeIntermediateTensorInfo(r),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(a),l}else return qw({backend:t,attrs:{shape:s.shape,value:0,dtype:s.dtype}})}const PQ={kernelName:Lg,backendName:"cpu",kernelFunc:mm};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eP(n){const{inputs:e,backend:t}=n,{x:s}=e;if(s.dtype==="string")throw new Error("onesLike is not supported for string tensors");if(s.dtype==="complex64"){const r=Ya({inputs:{input:s},backend:t}),i=eP({inputs:{x:r},backend:t}),o=pc({inputs:{input:s},backend:t}),a=mm({inputs:{x:o},backend:t}),l=qs({inputs:{real:i,imag:a},backend:t});return t.disposeIntermediateTensorInfo(r),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(a),l}else return qw({backend:t,attrs:{shape:s.shape,value:1,dtype:s.dtype}})}const MQ={kernelName:yg,backendName:"cpu",kernelFunc:eP};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tP(n){const{inputs:e,backend:t,attrs:s}=n,{axis:r}=s;if(e.length===1)return pm({inputs:{input:e[0]},backend:t,attrs:{dim:r}});const i=e[0].shape,o=e[0].dtype;e.forEach(d=>{wb(i,d.shape,"All tensors passed to stack must have matching shapes"),V(o===d.dtype,()=>"All tensors passed to stack must have matching dtypes")});const a=[],l=e.map(d=>{const f=pm({inputs:{input:d},backend:t,attrs:{dim:r}});return a.push(f),f}),u=mc({inputs:l,backend:t,attrs:{axis:r}});return a.forEach(d=>t.disposeIntermediateTensorInfo(d)),u}const LQ={kernelName:bg,backendName:"cpu",kernelFunc:tP};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FQ(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{paddings:i,constantValue:o}=s;We(r,"pad");const a=i.map((w,N)=>w[0]+r.shape[N]+w[1]),l=i.map(w=>w[0]),u=t.data.get(r.dataId).values,d=be(r.shape),f=r.shape.length,p=Qe(r.shape),g=be(a),x=a.length,y=Qe(a),b=ts(r.dtype,g);o!==0&&b.fill(o);for(let w=0;w<d;w++){const C=Ic(w,f,p).map((T,A)=>T+l[A]),S=wi(C,x,y);b[S]=u[w]}return{dataId:t.write(b,a,r.dtype),shape:a,dtype:r.dtype}}const nP={kernelName:wg,backendName:"cpu",kernelFunc:FQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OQ=xn((n,e)=>Math.pow(n,e)),_Q=jn(Qd,OQ),zQ={kernelName:Qd,backendName:"cpu",kernelFunc:_Q};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BQ(n){const{inputs:e,backend:t,attrs:s}=n,{paramsNestedSplits:r,paramsDenseValues:i,indices:o}=e,{outputRaggedRank:a}=s,l=r.map(k=>t.data.get(k.dataId).values),u=r.map(k=>k.shape),d=t.data.get(i.dataId).values,f=t.data.get(o.dataId).values,[p,g,x]=wD(l,u,d,i.shape,i.dtype,f,o.shape),y=p.map(k=>t.makeTensorInfo([k.length],"int32",k)),b=t.makeTensorInfo(x,i.dtype,g);return y.concat([b])}const WQ={kernelName:T$,backendName:"cpu",kernelFunc:BQ};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VQ(n){const{inputs:e,backend:t}=n,{starts:s,limits:r,deltas:i}=e,o=t.data.get(s.dataId).values,a=t.data.get(r.dataId).values,l=t.data.get(i.dataId).values,[u,d]=kD(o,s.shape,s.dtype,a,r.shape,l,i.shape),f=t.makeTensorInfo([u.length],"int32",u),p=t.makeTensorInfo([d.length],s.dtype,d);return[f,p]}const UQ={kernelName:$$,backendName:"cpu",kernelFunc:VQ};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GQ(n){const{inputs:e,backend:t,attrs:s}=n,{shape:r,values:i,defaultValue:o,rowPartitionTensors:a}=e,{rowPartitionTypes:l}=s,u=t.data.get(r.dataId).values,d=t.data.get(i.dataId).values,f=t.data.get(o.dataId).values,p=a.map(b=>t.data.get(b.dataId).values),g=a.map(b=>b.shape),[x,y]=CD(u,r.shape,d,i.shape,i.dtype,f,o.shape,p,g,l);return t.makeTensorInfo(x,i.dtype,y)}const HQ={kernelName:E$,backendName:"cpu",kernelFunc:GQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qQ(n){const{backend:e,attrs:t}=n,{start:s,stop:r,dtype:i,step:o}=t,a=SD(s,r,o,i);return e.makeTensorInfo([a.length],i,a)}const KQ={kernelName:t1,backendName:"cpu",kernelFunc:qQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QQ=Rt(Xd,n=>1/n),XQ={kernelName:Xd,backendName:"cpu",kernelFunc:QQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YQ(n){const{inputs:e,backend:t,attrs:s}=n,{images:r}=e,{alignCorners:i,halfPixelCenters:o,size:a}=s;We(r,"resizeBilinear");const l=Qe(r.shape),[u,d]=a,[f,p,g,x]=r.shape,y=t.data.get(r.dataId).values,b=new Float32Array(be([f,u,d,x])),k=[i&&u>1?p-1:p,i&&d>1?g-1:g],w=[i&&u>1?u-1:u,i&&d>1?d-1:d];let N=0;const C=k[0]/w[0],S=k[1]/w[1];for(let T=0;T<f;T++)for(let A=0;A<u;A++){let E;o?E=C*(A+.5)-.5:E=C*A;const M=Math.max(0,Math.floor(E)),P=E-M,R=Math.min(p-1,Math.ceil(E)),L=T*l[0]+M*l[1],_=T*l[0]+R*l[1];for(let O=0;O<d;O++){let U;o?U=S*(O+.5)-.5:U=S*O;const W=Math.max(0,Math.floor(U)),H=U-W,G=Math.min(g-1,Math.ceil(U)),q=L+W*l[2],Q=_+W*l[2],z=L+G*l[2],K=_+G*l[2];for(let Y=0;Y<x;Y++){const B=y[q+Y],J=y[Q+Y],ae=y[z+Y],pe=y[K+Y],ge=B+(ae-B)*H,he=J+(pe-J)*H,we=ge+(he-ge)*P;b[N++]=we}}}return t.makeTensorInfo([f,u,d,x],"float32",b)}const ZQ={kernelName:Ig,backendName:"cpu",kernelFunc:YQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JQ(n){const{inputs:e,backend:t,attrs:s}=n,{images:r,dy:i}=e,{alignCorners:o}=s;We([i,r],"resizeBilinearGrad");const a=Qe(r.shape),[l,u,d,f]=r.shape,[,p,g]=i.shape,x=new Float32Array(l*u*d*f),y=[o&&p>1?u-1:u,o&&g>1?d-1:d],b=[o&&p>1?p-1:p,o&&g>1?g-1:g],k=y[0]/b[0],w=y[1]/b[1],N=t.data.get(i.dataId).values;let C=0;for(let S=0;S<l;S++){const T=S*a[0];for(let A=0;A<p;A++){const E=A*k,M=Math.floor(E),P=Math.min(Math.ceil(E),u-1),R=T+M*a[1],L=T+P*a[1],_=E-M,O=1-_;for(let U=0;U<g;U++){const W=U*w,H=Math.floor(W),G=Math.min(Math.ceil(W),d-1),q=W-H,Q=1-q,z=R+H*a[2],K=R+G*a[2],Y=L+H*a[2],B=L+G*a[2],J=O*Q,ae=O*q,pe=_*Q,ge=_*q;for(let he=0;he<f;he++){const we=N[C++];x[z+he]+=we*J,x[K+he]+=we*ae,x[Y+he]+=we*pe,x[B+he]+=we*ge}}}}return t.makeTensorInfo([l,d,u,f],"float32",x)}const eX={kernelName:r1,backendName:"cpu",kernelFunc:JQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tX(n){const{inputs:e,backend:t,attrs:s}=n,{images:r}=e,{alignCorners:i,halfPixelCenters:o,size:a}=s;We(r,"resizeNearestNeighbor");const l=Qe(r.shape),[u,d]=a,[f,p,g,x]=r.shape,y=t.data.get(r.dataId).values,b=new Float32Array(f*u*d*x),k=[i&&u>1?p-1:p,i&&d>1?g-1:g],w=[i&&u>1?u-1:u,i&&d>1?d-1:d],N=k[0]/w[0],C=k[1]/w[1];let S=0;for(let T=0;T<f;T++){const A=T*l[0];for(let E=0;E<u;E++){const M=o?N*(E+.5):N*E;let P=Math.min(p-1,i?Math.round(M):Math.floor(M));o&&(P=Math.max(0,P));const R=A+P*l[1];for(let L=0;L<d;L++){const _=o?C*(L+.5):C*L;let O=Math.min(g-1,i?Math.round(_):Math.floor(_));o&&(O=Math.max(0,O));const U=R+O*l[2];for(let W=0;W<x;W++){const H=y[U+W];b[S++]=H}}}}return t.makeTensorInfo([f,u,d,x],r.dtype,b)}const nX={kernelName:Ng,backendName:"cpu",kernelFunc:tX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sX(n){const{inputs:e,backend:t,attrs:s}=n,{images:r,dy:i}=e,{alignCorners:o}=s;We([i,r],"resizeNearestNeighborGrad");const a=Qe(r.shape),l=Qe(i.shape),[u,d,f,p]=r.shape,[,g,x]=i.shape,y=new Float32Array(u*d*f*p),b=t.data.get(i.dataId).values,k=[o&&g>1?d-1:d,o&&x>1?f-1:f],w=[o&&g>1?g-1:g,o&&x>1?x-1:x],N=k[0]/w[0],C=k[1]/w[1],S=1/N,T=1/C,A=Math.ceil(S)*2+2,E=Math.ceil(T)*2+2;for(let M=0;M<u;M++){const P=M*a[0];for(let R=0;R<d;R++){const L=P+R*a[1],_=Math.floor(R*S),O=Math.floor(_-A/2);for(let U=0;U<f;U++){const W=L+U*a[2],H=Math.floor(U*T),G=Math.floor(H-E/2);for(let q=0;q<p;q++){let Q=0;for(let z=0;z<A;z++){const K=z+O;if(K<0||K>=g)continue;const Y=P+K*l[1],B=K*N,J=Math.min(d-1,o?Math.round(B):Math.floor(B));if(R===J)for(let ae=0;ae<E;ae++){const pe=ae+G;if(pe<0||pe>=x)continue;const ge=Y+pe*l[2],he=pe*C,we=Math.min(f-1,o?Math.round(he):Math.floor(he));U===we&&(Q+=b[ge+q])}}y[W+q]=Q}}}}return t.makeTensorInfo(r.shape,r.dtype,y)}const rX={kernelName:s1,backendName:"cpu",kernelFunc:sX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iX(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{dims:i}=s;We(r,"reverse");const o=r.shape.length,a=ht(i,r.shape);if(o===0)return ji({inputs:{x:r},backend:t});const l=new Kn(r.shape,r.dtype),u=t.bufferSync(r);for(let d=0;d<l.size;d++){const f=l.indexToLoc(d),p=f.slice();a.forEach(g=>p[g]=r.shape[g]-1-p[g]),l.set(u.get(...p),...f)}return t.makeTensorInfo(l.shape,l.dtype,l.values)}const oX={kernelName:Tg,backendName:"cpu",kernelFunc:iX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aX={kernelName:d1,backendName:"cpu",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{image:s}=n,{radians:r,fillValue:i,center:o}=e,a=t,l=ts(s.dtype,be(s.shape)),[u,d,f,p]=s.shape,[g,x]=ew(o,d,f),y=255,b=Math.sin(r),k=Math.cos(r),w=a.data.get(s.dataId).values;for(let C=0;C<u;C++){const S=C*f*d*p;for(let T=0;T<d;T++){const A=T*(f*p);for(let E=0;E<f;E++){const M=E*p;for(let P=0;P<p;P++){const R=[u,T,E,P],L=R[2],_=R[1];let O=(L-g)*k-(_-x)*b,U=(L-g)*b+(_-x)*k;O=Math.round(O+g),U=Math.round(U+x);let W=i;if(typeof i!="number"&&(P===3?W=y:W=i[P]),O>=0&&O<f&&U>=0&&U<d){const G=U*(f*p),q=O*p,Q=S+G+q+P;W=w[Q]}const H=S+A+M+P;l[H]=W}}}}return{dataId:a.write(l,s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lX=Rt(Jd,n=>{const e=Math.floor(n);return n-e<.5?Math.floor(n):n-e>.5?Math.ceil(n):e%2===0?e:e+1}),cX={kernelName:Jd,backendName:"cpu",kernelFunc:lX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uX(n){const{inputs:e,backend:t,attrs:s}=n,{indices:r,updates:i}=e,{shape:o}=s,{sliceRank:a,numUpdates:l,sliceSize:u,strides:d,outputSize:f}=rl(i,r,o),p=!0,g=t.bufferSync(r),x=t.bufferSync(i),y=Ra(g,x,o,f,u,l,a,d,0,p);return t.makeTensorInfo(o,y.dtype,y.values)}const dX={kernelName:A$,backendName:"cpu",kernelFunc:uX};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hX(n,e){let t=0,s=n.length,r=0;for(;t<s;)r=Math.floor((t+s)/2),n[r]<e?t=r+1:s=r;return s}function fX(n,e){let t=0,s=n.length,r=0;for(;t<s;)r=Math.floor((t+s)/2),n[r]<=e?t=r+1:s=r;return s}function pX(n,e,t,s,r,i){const o=hn("int32",t*r);for(let a=0;a<t;++a){const l=n.slice(a*s,(a+1)*s),u=a*r;for(let d=0;d<r;++d)o[u+d]=i==="left"?hX(l,e[d+u]):fX(l,e[d+u])}return o}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mX(n){const{inputs:e,backend:t,attrs:s}=n,{sortedSequence:r,values:i}=e,{side:o}=s,a=t.data.get(r.dataId).values,l=t.data.get(i.dataId).values,u=pX(a,l,r.shape[0],r.shape[1],i.shape[1],o);return t.makeTensorInfo(i.shape,"int32",u)}const gX={kernelName:R$,backendName:"cpu",kernelFunc:mX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xX(n){const{inputs:e,backend:t}=n,{condition:s,t:r,e:i}=e;We([s,r,i],"select");const o=s.shape.length,a=t.data.get(s.dataId).values,l=t.data.get(r.dataId).values,u=t.data.get(i.dataId).values,d=Ks(r.dtype,i.dtype),f=ns(be(r.shape),d);let p=0;const g=o===0||o>1||r.shape.length===1?1:be(r.shape.slice(1));for(let x=0;x<a.length;x++)for(let y=0;y<g;y++)a[x]===1?f[p++]=l[x]:f[p++]=u[x];return t.makeTensorInfo(r.shape,d,f)}const yX={kernelName:$g,backendName:"cpu",kernelFunc:xX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vX=Kg,bX=Qg,wX=Rt(th,n=>n>=0?bX*n:vX*(Math.exp(n)-1)),kX={kernelName:th,backendName:"cpu",kernelFunc:wX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CX=Rt(rh,n=>n<0?-1:n>0?1:0),SX={kernelName:rh,backendName:"cpu",kernelFunc:CX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NX=Rt(nh,n=>Math.sin(n)),IX={kernelName:nh,backendName:"cpu",kernelFunc:NX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TX=Rt(sh,n=>Math.sinh(n)),$X={kernelName:sh,backendName:"cpu",kernelFunc:TX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EX=11920928955078125e-23,LN=Math.log(EX)+2,AX=Rt(oh,n=>{const e=n>-LN,t=n<LN,s=Math.exp(n);let r;return t?r=s:e?r=n:r=Math.log(1+s),r}),jX={kernelName:oh,backendName:"cpu",kernelFunc:AX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RX(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockShape:i,paddings:o}=s;We([r],"spaceToBatchND");const a=be(i),l=[[0,0]];l.push(...o);for(let T=1+i.length;T<r.shape.length;++T)l.push([0,0]);const u=nP.kernelFunc({inputs:{x:r},backend:t,attrs:{paddings:l,constantValue:0}}),d=vh(u.shape,i,a,!1),f=bh(d.length,i.length,!1),p=wh(u.shape,i,a,!1),y=_t({inputs:{x:u},backend:t,attrs:{shape:d}}),w=Ps({inputs:{x:y},backend:t,attrs:{perm:f}}),S=_t({inputs:{x:w},backend:t,attrs:{shape:p}});return t.disposeIntermediateTensorInfo(u),t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(w),S}const DX={kernelName:jg,backendName:"cpu",kernelFunc:RX};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PX(n){const{inputs:e,backend:t}=n,{indices:s,values:r,denseShape:i,defaultValue:o}=e;if(i.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
        ${i.shape}`);if(s.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
        ${s.shape}`);if(r.shape.length!==1)throw new Error(`Values must be a vector, saw:
        ${r.shape}`);if(o.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${o.shape}`);const a=t.data.get(s.dataId).values,l=t.data.get(r.dataId).values,u=t.data.get(i.dataId).values,d=t.data.get(o.dataId).values[0],[f,p,g,x,y]=$D(a,s.shape,s.dtype,l,r.dtype,u,d);return[t.makeTensorInfo(p,s.dtype,f),t.makeTensorInfo([p[0]],r.dtype,g),t.makeTensorInfo([x.length],"bool",new Uint8Array(x.map(b=>Number(b)))),t.makeTensorInfo([y.length],s.dtype,new Int32Array(y))]}const MX={kernelName:D$,backendName:"cpu",kernelFunc:PX};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LX(n){const{inputs:e,backend:t}=n,{inputIndices:s,inputShape:r,newShape:i}=e;if(s.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape
        ${s.shape}`);if(r.shape.length!==1)throw new Error(`Input shape should be a vector but received shape
        ${r.shape}`);if(i.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${i.shape}`);const o=Array.from(t.data.get(r.dataId).values),a=t.data.get(s.dataId).values,l=Array.from(t.data.get(i.dataId).values),[u,d,f]=ED(a,s.shape,s.dtype,o,l);return[t.makeTensorInfo(d,s.dtype,u),t.makeTensorInfo([f.length],i.dtype,new Int32Array(f))]}const FX={kernelName:P$,backendName:"cpu",kernelFunc:LX};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OX(n){const{inputs:e,backend:t}=n,{data:s,indices:r,segmentIds:i}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
          ${r.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
          ${i.shape}`);if(r.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");const o=t.data.get(s.dataId).values,a=t.data.get(r.dataId).values,l=t.data.get(i.dataId).values,[u,d]=Vw(o,s.shape,s.dtype,a,l,!0);return t.makeTensorInfo(d,s.dtype,u)}const _X={kernelName:M$,backendName:"cpu",kernelFunc:OX};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zX(n){const{inputs:e,backend:t}=n,{data:s,indices:r,segmentIds:i}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
         ${r.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
         ${i.shape}`);if(r.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");const o=t.data.get(s.dataId).values,a=t.data.get(r.dataId).values,l=t.data.get(i.dataId).values,[u,d]=Vw(o,s.shape,s.dtype,a,l);return t.makeTensorInfo(d,s.dtype,u)}const BX={kernelName:L$,backendName:"cpu",kernelFunc:zX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WX(n){const{inputs:e,backend:t,attrs:s}=n,{sparseIndices:r,sparseValues:i,defaultValue:o}=e,{outputShape:a}=s,{sliceRank:l,numUpdates:u,sliceSize:d,strides:f,outputSize:p}=rl(i,r,a),g=!1,x=t.bufferSync(r);let y;switch(i.dtype){case"bool":{const b=t.bufferSync(i),k=!!t.data.get(o.dataId).values[0];y=Ra(x,b,a,p,d,u,l,f,k,g);break}case"float32":{const b=t.bufferSync(i),k=t.data.get(o.dataId).values[0];y=Ra(x,b,a,p,d,u,l,f,k,g);break}case"int32":{const b=t.bufferSync(i),k=t.data.get(o.dataId).values[0];y=Ra(x,b,a,p,d,u,l,f,k,g);break}case"string":{const b=t.bufferSync(i),k=Uo(t.data.get(o.dataId).values[0]);y=Ra(x,b,a,p,d,u,l,f,k,g);break}default:throw new Error(`Unsupported type ${i.dtype}`)}return t.makeTensorInfo(a,y.dtype,y.values)}const VX={kernelName:F$,backendName:"cpu",kernelFunc:WX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UX(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{numOrSizeSplits:i,axis:o}=s,a=ht(o,r.shape)[0],l=mw(r,i,a),u=new Array(r.shape.length).fill(0),d=r.shape.slice();return l.map(f=>{const p=[...d];p[a]=f;const g=Za({inputs:{x:r},backend:t,attrs:{begin:u,size:p}});return u[a]+=f,g})}const GX={kernelName:Rg,backendName:"cpu",kernelFunc:UX};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HX={kernelName:i1,backendName:"cpu",kernelFunc:({inputs:n,backend:e})=>{const{x:t}=n,s=e;We(t,"square");const r=s.data.get(t.dataId).values,i=new Float32Array(r.length);for(let a=0;a<r.length;++a){const l=r[a];i[a]=l*l}return{dataId:s.write(i,t.shape,t.dtype),shape:t.shape,dtype:t.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qX=Rt(fh,(n,e)=>{const t=e;return isNaN(n)?NaN:n>0?1:t.alpha}),KX={kernelName:fh,backendName:"cpu",kernelFunc:qX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QX(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{begin:i,end:o,strides:a,beginMask:l,endMask:u,ellipsisMask:d,newAxisMask:f,shrinkAxisMask:p}=s;We(r,"stridedSlice");const{finalShapeSparse:g,finalShape:x,isIdentity:y,sliceDim0:b,isSimpleSlice:k,begin:w,end:N,strides:C}=Y1(r.shape,i,o,a,l,u,d,f,p);let S;if(y)S=_t({inputs:{x:r},backend:t,attrs:{shape:x}});else if(b||k){V(r.shape.length>=1,()=>`Input must have rank at least 1, got: ${r.shape.length}`);const T=K1(w,N,C),A=Za({inputs:{x:r},backend:t,attrs:{begin:w,size:T}});S=_t({inputs:{x:A},backend:t,attrs:{shape:x}}),t.disposeIntermediateTensorInfo(A)}else{const T=t.bufferSync(r),A=RD(g,T,C,w);S=t.makeTensorInfo(x,A.dtype,A.values)}return S}const XX={kernelName:a1,backendName:"cpu",kernelFunc:QX};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YX(n){const{inputs:e,backend:t,attrs:s}=n,{separator:r,nGramWidths:i,leftPad:o,rightPad:a,padWidth:l,preserveShortSequences:u}=s,{data:d,dataSplits:f}=e,p=t.data.get(d.dataId).values,g=t.data.get(f.dataId).values,[x,y]=DD(p,g,r,i,o,a,l,u);return[t.makeTensorInfo([x.length],"string",x),t.makeTensorInfo(f.shape,"int32",y)]}const ZX={kernelName:O$,backendName:"cpu",kernelFunc:YX};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JX(n){const{inputs:e,backend:t,attrs:s}=n,{skipEmpty:r}=s,{input:i,delimiter:o}=e;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(i.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${i.shape}`);if(o.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${o.shape}`);const a=t.data.get(i.dataId).values,l=t.data.get(o.dataId).values[0],[u,d,f]=PD(a,l,r),p=d.length;return[t.makeTensorInfo([p,2],"int32",u),t.makeTensorInfo([p],"string",d),t.makeTensorInfo([2],"int32",new Int32Array(f))]}const eY={kernelName:_$,backendName:"cpu",kernelFunc:JX};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tY(n){const{inputs:e,backend:t,attrs:s}=n,{numBuckets:r}=s,{input:i}=e;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");const o=t.data.get(i.dataId).values,a=MD(o,r);return t.makeTensorInfo(i.shape,"int32",a)}const nY={kernelName:z$,backendName:"cpu",kernelFunc:tY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sY=Rt(uh,n=>Math.tan(n)),rY={kernelName:uh,backendName:"cpu",kernelFunc:sY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iY=Rt(dh,n=>Math.tanh(n)),oY={kernelName:dh,backendName:"cpu",kernelFunc:iY};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aY(n){const{inputs:e,backend:t}=n,{tensor:s,indices:r,updates:i}=e,{sliceRank:o,numUpdates:a,sliceSize:l,strides:u,outputSize:d}=rl(i,r,s.shape),f=!1,p=t.bufferSync(r),g=t.bufferSync(i),x=t.bufferSync(s),y=Ra(p,g,s.shape,d,l,a,o,u,x,f);return t.makeTensorInfo(s.shape,y.dtype,y.values)}const lY={kernelName:j$,backendName:"cpu",kernelFunc:aY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cY(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{reps:i}=s;We(r,"tile");const o=FD(t.bufferSync(r),i);return t.makeTensorInfo(o.shape,o.dtype,o.values)}const uY={kernelName:hh,backendName:"cpu",kernelFunc:cY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dY(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{k:i,sorted:o}=s;We(r,"topk");const a=t.data.get(r.dataId).values,[l,u]=_D(a,r.shape,r.dtype,i,o);return[t.makeTensorInfo(l.shape,l.dtype,l.values),t.makeTensorInfo(u.shape,u.dtype,u.values)]}const hY={kernelName:l1,backendName:"cpu",kernelFunc:dY};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fY(n){const{inputs:e,attrs:t,backend:s}=n,{image:r,transforms:i}=e,{interpolation:o,fillMode:a,fillValue:l,outputShape:u}=t,[d,f,p,g]=r.shape,[x,y]=u??[f,p],b=[d,x,y,g],k=Qe(r.shape),w=k[0],N=k[1],C=k[2],S=Qe(b),T=S[0],A=S[1],E=S[2],M=ts(r.dtype,be(b));M.fill(l);const P=s.data.get(r.dataId).values,R=s.data.get(i.dataId).values;for(let _=0;_<d;++_){const O=i.shape[0]===1?R:R.subarray(_*8,_*8+8);for(let U=0;U<x;++U)for(let W=0;W<y;++W)for(let H=0;H<g;++H){let G;const q=O[6]*W+O[7]*U+1;if(q===0)continue;const Q=(O[0]*W+O[1]*U+O[2])/q,z=(O[3]*W+O[4]*U+O[5])/q,K=FN(Q,p,a),Y=FN(z,f,a);switch(o){case"nearest":G=vY(P,f,p,w,N,C,_,Y,K,H,l);break;case"bilinear":G=bY(P,f,p,w,N,C,_,Y,K,H,l);break;default:throw new Error(`Error in Transform: Expect 'nearest' or 'bilinear', but got ${o}`)}const B=_*T+U*A+W*E+H;M[B]=G}return s.makeTensorInfo(b,r.dtype,M)}return{dataId:s.write(M,b,r.dtype),shape:r.shape,dtype:r.dtype}}const pY={kernelName:c1,backendName:"cpu",kernelFunc:fY};function FN(n,e,t){switch(t){case"reflect":return mY(n,e);case"wrap":return gY(n,e);case"nearest":return yY(n,e);case"constant":default:return xY(n)}}function mY(n,e){let t=n;if(t<0)if(e<=1)t=0;else{const s=2*e;t<s&&(t=s*Math.trunc(-t/s)+t),t=t<-e?t+s:-t-1}else if(t>e-1)if(e<=1)t=0;else{const s=2*e;t-=s*Math.trunc(t/s),t>=e&&(t=s-t-1)}return _a(0,t,e-1)}function gY(n,e){let t=n;if(t<0)if(e<=1)t=0;else{const s=e-1;t+=e*(Math.trunc(-t/s)+1)}else if(t>e-1)if(e<=1)t=0;else{const s=e-1;t-=e*Math.trunc(t/s)}return _a(0,t,e-1)}function xY(n,e){return n}function yY(n,e){return _a(0,n,e-1)}function _u(n,e,t,s,r,i,o,a,l,u,d){const f=o*s+a*r+l*i+u;return 0<=a&&a<e&&0<=l&&l<t?n[f]:d}function vY(n,e,t,s,r,i,o,a,l,u,d){const f=Math.round(a),p=Math.round(l);return _u(n,e,t,s,r,i,o,f,p,u,d)}function bY(n,e,t,s,r,i,o,a,l,u,d){const f=Math.floor(a),p=Math.floor(l),g=f+1,x=p+1,y=(x-l)*_u(n,e,t,s,r,i,o,f,p,u,d)+(l-p)*_u(n,e,t,s,r,i,o,f,x,u,d),b=(x-l)*_u(n,e,t,s,r,i,o,g,p,u,d)+(l-p)*_u(n,e,t,s,r,i,o,g,x,u,d);return(g-a)*y+(a-f)*b}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wY(n){const{inputs:e,attrs:t,backend:s}=n,{axis:r}=t,{x:i}=e;We(i,"unique");const o=s.data.get(i.dataId).values,{outputValues:a,outputShape:l,indices:u}=zD(o,r,i.shape,i.dtype);return[s.makeTensorInfo(l,i.dtype,a),s.makeTensorInfo([u.length],"int32",u)]}const kY={kernelName:u1,backendName:"cpu",kernelFunc:wY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CY(n){const{inputs:e,backend:t,attrs:s}=n,{value:r}=e;let{axis:i}=s;i<0&&(i+=r.shape.length);const o=r.shape.length,a=r.shape[i],l=new Array(o-1);let u=0;for(let g=0;g<o;g++)g!==i&&(l[u++]=r.shape[g]);const d=new Array(o).fill(0),f=r.shape.slice();f[i]=1;const p=new Array(a);for(let g=0;g<p.length;g++){d[i]=g;const x=Za({inputs:{x:r},backend:t,attrs:{begin:d,size:f}});p[g]=_t({inputs:{x},backend:t,attrs:{shape:l}}),t.disposeIntermediateTensorInfo(x)}return p}const SY={kernelName:Pg,backendName:"cpu",kernelFunc:CY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NY(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,segmentIds:i}=e,{numSegments:o}=s;We(r,"unsortedSegmentSum");const a=r.shape.length,l=i.shape.length,u=[],d=[],f=a-l;let p=i;for(let x=0;x<f;++x){const y=pm({inputs:{input:p},backend:t,attrs:{dim:x+1}});p=y,d.push(y)}for(let x=0;x<o;++x){const y=Yo(x,"int32"),b=t.makeTensorInfo([],"int32",y),k=tD({inputs:{a:b,b:p},backend:t}),w=Qo({inputs:{x:k},backend:t,attrs:{dtype:"float32"}}),N=lx({inputs:{a:w,b:r},backend:t}),C=Ah({inputs:{x:N},backend:t,attrs:{axis:0,keepDims:!1}});u.push(C),d.push(b),d.push(k),d.push(w),d.push(N),d.push(C)}const g=tP({inputs:u,backend:t,attrs:{axis:0}});return d.forEach(x=>t.disposeIntermediateTensorInfo(x)),g}const IY={kernelName:Mg,backendName:"cpu",kernelFunc:NY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TY=[w7,t9,C7,N7,a9,T7,E7,j7,D7,M7,F7,_7,B7,U7,H7,Q7,Y7,J7,tq,v7,sq,iq,aq,c9,cq,i9,d9,dq,n9,fq,mq,gq,yq,bq,kq,Sq,Iq,$q,Aq,Rq,Pq,Lq,Oq,zq,Bq,Vq,Gq,qq,Kq,Qq,Xq,Zq,tK,h7,sK,h9,dK,f9,hK,m9,yK,vK,wK,x9,v9,CK,NK,TK,EK,w9,C9,s9,jK,pq,DK,MK,FK,f7,N9,T9,_K,E9,BK,UK,HK,QK,YK,JK,eQ,j9,nQ,rQ,oQ,lQ,uQ,hQ,pQ,D9,gQ,vQ,kQ,M9,F9,NQ,$Q,jQ,_9,DQ,MQ,LQ,nP,zQ,m7,W9,WQ,UQ,HQ,KQ,r9,Fv,XQ,g7,x7,y7,ZQ,eX,nX,rX,oX,aX,cX,X9,dX,gX,yX,kX,Z9,SX,IX,$X,J9,bQ,jX,DX,MX,FX,_X,BX,VX,GX,n7,HX,r7,o7,KX,XX,ZX,eY,nY,u7,Jq,rY,oY,lY,uY,hY,pY,z9,kY,SY,IY,PQ];for(const n of TY)W$(n);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ea={},sp={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function $Y(n,e){Ea[n]=e}function ri(n,e){if(!(n in Ea)||e!=null){const s=AY(n,e);if(s!==null)Ea[n]=s;else return console.log("Could not get context for WebGL version",n),null}const t=Ea[n];return t==null||t.isContextLost()?(delete Ea[n],ri(n)):(t.disable(t.DEPTH_TEST),t.disable(t.STENCIL_TEST),t.disable(t.BLEND),t.disable(t.DITHER),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SAMPLE_COVERAGE),t.enable(t.SCISSOR_TEST),t.enable(t.CULL_FACE),t.cullFace(t.BACK),Ea[n])}function EY(n){if(!me().getBool("IS_SAFARI")&&typeof OffscreenCanvas<"u"&&n===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}function AY(n,e){if(n!==1&&n!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");const t=e??EY(n);return t.addEventListener("webglcontextlost",s=>{s.preventDefault(),delete Ea[n]},!1),me().getBool("SOFTWARE_WEBGL_ENABLED")&&(sp.failIfMajorPerformanceCaveat=!1),n===1?t.getContext("webgl",sp)||t.getContext("experimental-webgl",sp):t.getContext("webgl2",sp)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var id;(function(n){n[n.DENSE=0]="DENSE",n[n.SHARED_BATCH=1]="SHARED_BATCH"})(id||(id={}));var ir;(function(n){n[n.RENDER=0]="RENDER",n[n.UPLOAD=1]="UPLOAD",n[n.PIXELS=2]="PIXELS",n[n.DOWNLOAD=3]="DOWNLOAD"})(ir||(ir={}));var qn;(function(n){n[n.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",n[n.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",n[n.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",n[n.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",n[n.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"})(qn||(qn={}));function jh(n,e){return[e,n]}function jY(n,e){return n*e}function rp(n){const e=be(n),t=Math.ceil(e/4);return av(t)}function Dc(n,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(n/2))]}function RY(n,e){const[t,s]=Dc(n,e);return t*s*4}function Kw(n,e){const t=n;let s,r,i,o,a,l,u,d,f,p;return me().getNumber("WEBGL_VERSION")===2?(s=t.R32F,r=t.R16F,i=t.RGBA16F,o=t.RGBA32F,a=t.RED,u=4,d=1,f=t.HALF_FLOAT,p=t.FLOAT,l=t.RGBA8):(s=n.RGBA,r=n.RGBA,i=n.RGBA,o=t.RGBA,a=n.RGBA,u=4,d=4,f=e!=null?e.HALF_FLOAT_OES:null,p=n.FLOAT,l=n.RGBA),{internalFormatFloat:s,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:i,internalFormatPackedFloat:o,textureFormatFloat:a,downloadTextureFormat:l,downloadUnpackNumChannels:u,defaultNumChannels:d,textureTypeHalfFloat:f,textureTypeFloat:p}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Le(n,e){const t=e();return me().getBool("DEBUG")&&DY(n),t}function DY(n){const e=n.getError();if(e!==n.NO_ERROR)throw new Error("WebGL Error: "+FY(n,e))}const PY=596e-10,MY=65504;function LY(n){return!!(me().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||n===0||PY<Math.abs(n)&&Math.abs(n)<MY)}function FY(n,e){switch(e){case n.NO_ERROR:return"NO_ERROR";case n.INVALID_ENUM:return"INVALID_ENUM";case n.INVALID_VALUE:return"INVALID_VALUE";case n.INVALID_OPERATION:return"INVALID_OPERATION";case n.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case n.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case n.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return`Unknown error code ${e}`}}function ip(n,e){return uo(n,()=>n.getExtension(e),'Extension "'+e+'" not supported on this browser.')}function OY(n,e){const t=uo(n,()=>n.createShader(n.VERTEX_SHADER),"Unable to create vertex WebGLShader.");if(Le(n,()=>n.shaderSource(t,e)),Le(n,()=>n.compileShader(t)),n.getShaderParameter(t,n.COMPILE_STATUS)===!1)throw console.log(n.getShaderInfoLog(t)),new Error("Failed to compile vertex shader.");return t}function _Y(n,e){const t=uo(n,()=>n.createShader(n.FRAGMENT_SHADER),"Unable to create fragment WebGLShader.");if(Le(n,()=>n.shaderSource(t,e)),Le(n,()=>n.compileShader(t)),me().get("ENGINE_COMPILE_ONLY"))return t;if(n.getShaderParameter(t,n.COMPILE_STATUS)===!1)throw sP(e,n.getShaderInfoLog(t)),new Error("Failed to compile fragment shader.");return t}const zY=/ERROR: [0-9]+:([0-9]+):/g;function sP(n,e){const t=zY.exec(e);if(t==null){console.log(`Couldn't parse line number in error: ${e}`),console.log(n);return}const s=+t[1],r=n.split(`
`),i=r.length.toString().length+2,o=r.map((f,p)=>Kl((p+1).toString(),i)+f);let a=0;for(let f=0;f<o.length;f++)a=Math.max(o[f].length,a);const l=o.slice(0,s-1),u=o.slice(s-1,s),d=o.slice(s);console.log(l.join(`
`)),console.log(e.split(`
`)[0]),console.log(`%c ${Kl(u[0],a)}`,"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(d.join(`
`))}function BY(n){return uo(n,()=>n.createProgram(),"Unable to create WebGLProgram.")}function WY(n,e){if(Le(n,()=>n.linkProgram(e)),!me().get("ENGINE_COMPILE_ONLY")&&n.getProgramParameter(e,n.LINK_STATUS)===!1)throw console.log(n.getProgramInfoLog(e)),new Error("Failed to link vertex and fragment shaders.")}function N0(n,e){if(Le(n,()=>n.validateProgram(e)),n.getProgramParameter(e,n.VALIDATE_STATUS)===!1)throw console.log(n.getProgramInfoLog(e)),new Error("Shader program validation failed.")}function VY(n,e){const t=uo(n,()=>n.createBuffer(),"Unable to create WebGLBuffer");return Le(n,()=>n.bindBuffer(n.ARRAY_BUFFER,t)),Le(n,()=>n.bufferData(n.ARRAY_BUFFER,e,n.STATIC_DRAW)),t}function UY(n,e){const t=uo(n,()=>n.createBuffer(),"Unable to create WebGLBuffer");return Le(n,()=>n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t)),Le(n,()=>n.bufferData(n.ELEMENT_ARRAY_BUFFER,e,n.STATIC_DRAW)),t}function GY(n){return uo(n,()=>n.createTexture(),"Unable to create WebGLTexture.")}function HY(n,e){const t=me().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(n<=0||e<=0){const s=`[${n}x${e}]`;throw new Error("Requested texture size "+s+" is invalid.")}if(n>t||e>t){const s=`[${n}x${e}]`,r=`[${t}x${t}]`;throw new Error("Requested texture size "+s+" greater than WebGL maximum on this browser / GPU "+r+".")}}function qY(n){return uo(n,()=>n.createFramebuffer(),"Unable to create WebGLFramebuffer.")}function ON(n,e,t,s,r,i,o){const a=n.getAttribLocation(e,t);return a===-1?!1:(Le(n,()=>n.bindBuffer(n.ARRAY_BUFFER,s)),Le(n,()=>n.vertexAttribPointer(a,r,n.FLOAT,!1,i,o)),Le(n,()=>n.enableVertexAttribArray(a)),!0)}function KY(n,e,t){JY(n,t),Le(n,()=>n.activeTexture(n.TEXTURE0+t)),Le(n,()=>n.bindTexture(n.TEXTURE_2D,e))}function QY(n,e,t){return uo(n,()=>n.getUniformLocation(e,t),'uniform "'+t+'" not present in program.')}function XY(n,e,t){return n.getUniformLocation(e,t)}function YY(n,e,t,s){Le(n,()=>KY(n,e,s)),Le(n,()=>n.uniform1i(t,s))}function I0(n,e,t){Le(n,()=>n.bindFramebuffer(n.FRAMEBUFFER,t)),Le(n,()=>n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e,0))}function _N(n,e){Le(n,()=>n.bindFramebuffer(n.FRAMEBUFFER,e)),Le(n,()=>n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,null,0))}function op(n){const e=n.checkFramebufferStatus(n.FRAMEBUFFER);if(e!==n.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+ZY(n,e))}function ZY(n,e){switch(e){case n.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case n.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return`unknown error ${e}`}}function uo(n,e,t){const s=Le(n,()=>e());if(s==null)throw new Error(t);return s}function JY(n,e){const t=n.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,s=e+n.TEXTURE0;if(s<n.TEXTURE0||s>t){const r=`[gl.TEXTURE0, gl.TEXTURE${t}]`;throw new Error(`textureUnit must be in ${r}.`)}}function gc(n,e=2){return be(n.slice(0,n.length-e))}function xc(n){if(n.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[n.length>1?n[n.length-2]:1,n[n.length-1]]}function ap(n){let e=[1,1,1];return n.length===0||n.length===1&&n[0]===1||(e=[gc(n),...xc(n)]),e}function eZ(n,e=!1){let t=me().getNumber("WEBGL_MAX_TEXTURE_SIZE"),s=me().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");s===1/0&&me().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(s=t/2),e&&(t=t*2,s=s*2,n=n.map((a,l)=>l>=n.length-2?bb(n[l]):n[l]),n.length===1&&(n=[2,n[0]])),n.length!==2&&(n=Xo(n).newShape);let r=be(n),i=null;n.length<=1&&r<=t?i=[1,r]:n.length===2&&n[0]<=t&&n[1]<=t?i=n:n.length===3&&n[0]*n[1]<=t&&n[2]<=t?i=[n[0]*n[1],n[2]]:n.length===3&&n[0]<=t&&n[1]*n[2]<=t?i=[n[0],n[1]*n[2]]:n.length===4&&n[0]*n[1]*n[2]<=t&&n[3]<=t?i=[n[0]*n[1]*n[2],n[3]]:n.length===4&&n[0]<=t&&n[1]*n[2]*n[3]<=t&&(i=[n[0],n[1]*n[2]*n[3]]);const o=i!=null&&Math.max(...i)>s&&Math.min(...i)<=(e?2:1)&&Math.min(...i)>0;if(i==null||o)if(e){const a=gc(n);let l=2,u=2;n.length&&([l,u]=xc(n)),r=a*(l/2)*(u/2),i=av(r).map(d=>d*2)}else i=av(r);return i}function lp(n){return n%2===0}function gm(n,e){if(n=n.slice(-2),e=e.slice(-2),At(n,e)||!n.length||!e.length||n[0]===0||n[1]===0||e[0]===0||e[1]===0)return!0;if(n.length!==e.length){const t=n[n.length-1],s=e[e.length-1];if(t===s||lp(t)&&lp(s)&&(n[0]===1||e[0]===1))return!0}return n[1]===e[1]&&lp(n[0])&&lp(e[0])}let T0,$0;function tZ(n){if(T0==null){const e=ri(n);T0=e.getParameter(e.MAX_TEXTURE_SIZE)}return T0}function nZ(n){if($0==null){const e=ri(n);$0=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,$0)}function sZ(n){if(n===0)return 0;let e;const t=ri(n);return Nr(t,"EXT_disjoint_timer_query_webgl2")&&n===2?e=2:Nr(t,"EXT_disjoint_timer_query")?e=1:e=0,e}function Nr(n,e){return n.getExtension(e)!=null}function zN(n){try{if(ri(n)!=null)return!0}catch(e){return console.log("Error when getting WebGL context: ",e),!1}return!1}function rZ(n){if(n===0)return!1;const e=ri(n);if(n===1){if(!Nr(e,"OES_texture_float"))return!1}else if(!Nr(e,"EXT_color_buffer_float"))return!1;return _v(e)}function iZ(n){if(n===0)return!1;const e=ri(n);if(n===1){if(!Nr(e,"OES_texture_float")||!Nr(e,"WEBGL_color_buffer_float"))return!1}else{if(Nr(e,"EXT_color_buffer_float"))return _v(e);const s="EXT_color_buffer_half_float";if(Nr(e,s)){const r=e.getExtension(s);return oZ(e,r)}return!1}return _v(e)}function _v(n){const e=Kw(n),t=n.createTexture();n.bindTexture(n.TEXTURE_2D,t),n.texImage2D(n.TEXTURE_2D,0,e.internalFormatFloat,1,1,0,e.textureFormatFloat,e.textureTypeFloat,null);const i=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,i),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0);const o=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(t),n.deleteFramebuffer(i),o}function oZ(n,e){const t=Kw(n,e),s=n.createTexture();n.bindTexture(n.TEXTURE_2D,s),n.texImage2D(n.TEXTURE_2D,0,t.internalFormatHalfFloat,1,1,0,t.textureFormatFloat,t.textureTypeHalfFloat,null);const o=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,o),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,s,0);const a=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(s),n.deleteFramebuffer(o),a}function aZ(n){return n!==2?!1:ri(n).fenceSync!=null}function Rh(n,e){Array.isArray(n)||(n=[n]),n.forEach(t=>{t!=null&&V(t.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the WebGL backend.`)})}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ue=me();Ue.registerFlag("HAS_WEBGL",()=>Ue.getNumber("WEBGL_VERSION")>0);Ue.registerFlag("WEBGL_VERSION",()=>zN(2)?2:zN(1)?1:0);Ue.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",()=>!1);Ue.registerFlag("WEBGL_BUFFER_SUPPORTED",()=>Ue.get("WEBGL_VERSION")===2);Ue.registerFlag("WEBGL_CPU_FORWARD",()=>!0);Ue.registerFlag("WEBGL_FORCE_F16_TEXTURES",()=>!1);Ue.registerFlag("WEBGL_PACK",()=>Ue.getBool("HAS_WEBGL"));Ue.registerFlag("WEBGL_PACK_NORMALIZATION",()=>Ue.getBool("WEBGL_PACK"));Ue.registerFlag("WEBGL_PACK_CLIP",()=>Ue.getBool("WEBGL_PACK"));Ue.registerFlag("WEBGL_PACK_DEPTHWISECONV",()=>Ue.getBool("WEBGL_PACK"));Ue.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",()=>Ue.getBool("WEBGL_PACK"));Ue.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",()=>Ue.getBool("WEBGL_PACK"));Ue.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",()=>Ue.getBool("WEBGL_PACK"));Ue.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",()=>Ue.getBool("WEBGL_PACK"));Ue.registerFlag("WEBGL_PACK_REDUCE",()=>Ue.getBool("WEBGL_PACK"));Ue.registerFlag("WEBGL_LAZILY_UNPACK",()=>Ue.getBool("WEBGL_PACK"));Ue.registerFlag("WEBGL_CONV_IM2COL",()=>Ue.getBool("WEBGL_PACK"));Ue.registerFlag("WEBGL_PACK_CONV2DTRANSPOSE",()=>Ue.getBool("WEBGL_PACK"));Ue.registerFlag("WEBGL_MAX_TEXTURE_SIZE",()=>tZ(Ue.getNumber("WEBGL_VERSION")));Ue.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",()=>nZ(Ue.getNumber("WEBGL_VERSION")));Ue.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",()=>{const n=Ue.getNumber("WEBGL_VERSION");return n===0?0:sZ(n)});Ue.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",()=>Ue.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!tE());Ue.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",()=>rZ(Ue.getNumber("WEBGL_VERSION")));Ue.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",()=>Ue.getBool("WEBGL_FORCE_F16_TEXTURES")?!1:Ue.getBool("WEBGL_RENDER_FLOAT32_CAPABLE"));Ue.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",()=>iZ(Ue.getNumber("WEBGL_VERSION")));Ue.registerFlag("WEBGL_FENCE_API_ENABLED",()=>aZ(Ue.getNumber("WEBGL_VERSION")));Ue.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",()=>Ue.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0);Ue.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",()=>-1,n=>{if(typeof n!="number")throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be a number but got ${n}.`);if(n<0&&n!==-1)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${n}.`)});Ue.registerFlag("WEBGL_FLUSH_THRESHOLD",()=>tE()?1:-1,n=>{if(typeof n!="number")throw new Error(`WEBGL_FLUSH_THRESHOLD must be a number but got ${n}.`);if(n<0&&n!==-1)throw new Error(`WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ${n}.`)});Ue.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",()=>128);Ue.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",()=>!1);Ue.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",()=>1e5);Ue.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",()=>128);Ue.registerFlag("WEBGL_EXP_CONV",()=>!1);Ue.registerFlag("SOFTWARE_WEBGL_ENABLED",()=>Ue.getBool("IS_TEST"));Ue.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",()=>1/0);Ue.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",()=>!1);Ue.registerFlag("WEBGL2_ISNAN_CUSTOM",()=>!1);Ue.registerFlag("ENGINE_COMPILE_ONLY",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ks(){let n,e,t,s,r,i,o,a,l,u;return me().getNumber("WEBGL_VERSION")===2?(n="#version 300 es",e="in",t="out",s="in",r="texture",i="outputColor",o="out vec4 outputColor;",a=me().getBool("WEBGL2_ISNAN_CUSTOM")?`
      bool isnan_custom(float val) {
        uint floatToUint = floatBitsToUint(val);
        return (floatToUint & 0x7fffffffu) > 0x7f800000u;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `:"",l="",u=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(n="",e="attribute",t="varying",s="varying",r="texture2D",i="gl_FragColor",o="",a=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,l=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,u=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:n,attribute:e,varyingVs:t,varyingFs:s,texture2D:r,output:i,defineOutput:o,defineSpecialNaN:a,defineSpecialInf:l,defineRound:u}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function al(n,e,t="index"){const s=Qe(e);return s.map((r,i)=>{const o=`int ${n[i]} = ${t} / ${r}`,a=i===s.length-1?`int ${n[i+1]} = ${t} - ${n[i]} * ${r}`:`index -= ${n[i]} * ${r}`;return`${o}; ${a};`}).join("")}function cx(n,e,t="index"){const s=Qe(e);return s.map((r,i)=>{const o=`int ${n[i]} = ${t} / outShapeStrides[${i}]`,a=i===s.length-1?`int ${n[i+1]} = ${t} - ${n[i]} * outShapeStrides[${i}]`:`index -= ${n[i]} * outShapeStrides[${i}]`;return`${o}; ${a};`}).join("")}function lZ(n,e){const t=n.length,s=n.map(i=>`${e}[${i}]`),r=new Array(t-1);r[t-2]=s[t-1];for(let i=t-3;i>=0;--i)r[i]=`(${r[i+1]} * ${s[i+1]})`;return r}function cZ(n,e,t="index"){const s=n.map((i,o)=>o),r=lZ(s,e);return r.map((i,o)=>{const a=`int ${n[o]} = ${t} / ${r[o]}`,l=o===r.length-1?`int ${n[o+1]} = ${t} - ${n[o]} * ${r[o]}`:`index -= ${n[o]} * ${r[o]}`;return`${a}; ${l};`}).join("")}function Qw(n){const e=Qe(n).map(t=>t.toString());return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * ${e[0]} + coords.y * ${e[1]} + coords.z;
  }
`}function Xw(){return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;
  }
`}const rP=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{getBroadcastDims:iP}=K6;function uZ(n,e,t){const s=[];if(n.forEach(g=>{const x=be(g.shapeInfo.logicalShape);if(g.shapeInfo.isUniform?s.push(`uniform float ${g.name}${x>1?`[${x}]`:""};`):(s.push(`uniform sampler2D ${g.name};`),s.push(`uniform int offset${g.name};`)),t.enableShapeUniforms){const{uniformShape:y}=Yw(t.packedInputs,g.shapeInfo.logicalShape,g.shapeInfo.texShape);switch(y.length){case 1:s.push(`uniform int ${g.name}Shape;`);break;case 2:s.push(`uniform ivec2 ${g.name}Shape;`);break;case 3:s.push(`uniform ivec3 ${g.name}Shape;`);break;case 4:s.push(`uniform ivec4 ${g.name}Shape;`);break}s.push(`uniform ivec2 ${g.name}TexShape;`)}}),t.enableShapeUniforms){switch(e.logicalShape.length){case 1:s.push("uniform int outShape;");break;case 2:s.push("uniform ivec2 outShape;"),s.push("uniform int outShapeStrides;");break;case 3:s.push("uniform ivec3 outShape;"),s.push("uniform ivec2 outShapeStrides;");break;case 4:s.push("uniform ivec4 outShape;"),s.push("uniform ivec3 outShapeStrides;");break}s.push("uniform ivec2 outTexShape;")}t.customUniforms&&t.customUniforms.forEach(g=>{s.push(`uniform ${g.type} ${g.name}${g.arrayIndex?`[${g.arrayIndex}]`:""};`)});const r=s.join(`
`),i=n.map(g=>dZ(g,e,t.packedInputs,t.enableShapeUniforms)).join(`
`),o=e.texShape,a=ks(),l=pZ(a);let u,d,f=xZ(a);return e.isPacked?(u=hZ(e.logicalShape,o,t.enableShapeUniforms),d=gZ(a)):(u=fZ(e.logicalShape,o,t.enableShapeUniforms),d=mZ(a)),t.packedInputs&&(f+=wZ),[f,l,d,r,u,i,t.userCode].join(`
`)}function Pc(n,e=!1){const t=n.shapeInfo.logicalShape;switch(t.length){case 0:return DZ(n,e);case 1:return MZ(n,e);case 2:return FZ(n,e);case 3:return _Z(n,e);case 4:return BZ(n,e);case 5:return WZ(n);case 6:return VZ(n);default:throw new Error(`${t.length}-D input sampling is not yet supported`)}}function oP(n,e){switch(n.shapeInfo.logicalShape.length){case 0:return RZ(n);case 1:return PZ(n,e);case 2:return LZ(n,e);case 3:return OZ(n,e);default:return zZ(n,e)}}function dZ(n,e,t=!1,s){let r="";t?r+=oP(n,s):r+=Pc(n,s);const i=n.shapeInfo.logicalShape,o=e.logicalShape;return i.length<=o.length&&(t?r+=UZ(n,e):r+=GZ(n,e)),r}function hZ(n,e,t){switch(n.length){case 0:return aP();case 1:return kZ(n,e,t);case 2:return AZ(n,e,t);case 3:return SZ(n,e,t);default:return IZ(n,e,t)}}function fZ(n,e,t){switch(n.length){case 0:return aP();case 1:return CZ(n,e,t);case 2:return jZ(n,e,t);case 3:return NZ(n,e,t);case 4:return TZ(n,e,t);case 5:return $Z(n,e);case 6:return EZ(n,e);default:throw new Error(`${n.length}-D output sampling is not yet supported`)}}function pZ(n){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return ${n.texture2D}(textureSampler, uv).r;
    }
  `}function mZ(n){return`
    void setOutput(float val) {
      ${n.output} = vec4(val, 0, 0, 0);
    }
  `}function gZ(n){return`
    void setOutput(vec4 val) {
      ${n.output} = val;
    }
  `}function xZ(n){return`${n.version}
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    ${n.varyingFs} vec2 resultUV;
    ${n.defineOutput}
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    ${n.defineSpecialNaN}
    ${n.defineSpecialInf}
    ${n.defineRound}

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    ${yZ}
    ${vZ}
    ${bZ}
  `}const yZ=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,vZ=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,bZ=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,wZ=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function aP(){return`
    int getOutputCoords() {
      return 0;
    }
  `}function kZ(n,e,t){const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];return s[0]===1?t?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ${s[1]}.0);
      }
    `:s[1]===1?t?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ${s[0]}.0);
      }
    `:t?`
    int getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      return 2 * (resTexRC.x * ${s[1]} + resTexRC.y);
    }
  `}function CZ(n,e,t){return e[0]===1?t?`
      int getOutputCoords() {
        return int(resultUV.x * float(outTexShape[1]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.x * ${e[1]}.0);
      }
    `:e[1]===1?t?`
      int getOutputCoords() {
        return int(resultUV.y * float(outTexShape[0]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.y * ${e[0]}.0);
      }
    `:t?`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      return resTexRC.x * outTexShape[1] + resTexRC.y;
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      return resTexRC.x * ${e[1]} + resTexRC.y;
    }
  `}function SZ(n,e,t){if(t)return`
    ivec3 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec3(b, r, c);
    }
  `;const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],r=Math.ceil(n[2]/2),i=r*Math.ceil(n[1]/2);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      int index = resTexRC.x * ${s[1]} + resTexRC.y;

      int b = index / ${i};
      index -= b * ${i};

      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec3(b, r, c);
    }
  `}function NZ(n,e,t){if(t)return`
  ivec3 getOutputCoords() {
    ivec2 resTexRC = ivec2(resultUV.yx *
                           vec2(outTexShape[0], outTexShape[1]));
    int index = resTexRC.x * outTexShape[1] + resTexRC.y;
    ${cx(["r","c","d"],n)}
    return ivec3(r, c, d);
  }
`;const s=al(["r","c","d"],n);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${s}
      return ivec3(r, c, d);
    }
  `}function IZ(n,e,t){if(t)return`
    ivec4 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatchN = texelsInBatch * outShape[1];

      int b2 = index / texelsInBatchN;
      index -= b2 * texelsInBatchN;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec4(b2, b, r, c);
    }
  `;const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],r=Math.ceil(n[n.length-1]/2),i=r*Math.ceil(n[n.length-2]/2);let o=i,a="",l="b, r, c";for(let u=2;u<n.length-1;u++)o*=n[n.length-u-1],a=`
      int b${u} = index / ${o};
      index -= b${u} * ${o};
    `+a,l=`b${u}, `+l;return`
    ivec${n.length} getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      int index = resTexRC.x * ${s[1]} + resTexRC.y;

      ${a}

      int b = index / ${i};
      index -= b * ${i};

      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec${n.length}(${l});
    }
  `}function TZ(n,e,t){if(t)return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      ${cx(["r","c","d","d2"],n)}
      return ivec4(r, c, d, d2);
    }
  `;const s=al(["r","c","d","d2"],n);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${s}
      return ivec4(r, c, d, d2);
    }
  `}function $Z(n,e){const t=al(["r","c","d","d2","d3"],n);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(${e[0]},
                             ${e[1]}));

      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${t}

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}function EZ(n,e){const t=al(["r","c","d","d2","d3","d4"],n);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${t}

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}function AZ(n,e,t){const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];if(At(n,e))return t?`
      ivec2 getOutputCoords() {
        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(${s[0]}, ${s[1]}));
      }
    `;const r=Math.ceil(n[1]/2);return t?`
    ivec2 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));

      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;
      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));

      int index = resTexRC.x * ${s[1]} + resTexRC.y;
      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec2(r, c);
    }
  `}function jZ(n,e,t){return At(n,e)?t?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(${e[0]}, ${e[1]}));
      }
    `:n[1]===1?t?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(index, 0);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(index, 0);
      }
    `:n[0]===1?t?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(0, index);
      }
    `:t?`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      int r = index / outShape[1];
      int c = index - r * outShape[1];
      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      int r = index / ${n[1]};
      int c = index - r * ${n[1]};
      return ivec2(r, c);
    }
  `}function ll(n){return`offset${n}`}function RZ(n){const e=n.name,t="get"+e.charAt(0).toUpperCase()+e.slice(1),s=ks();return`
    vec4 ${t}() {
      return ${s.texture2D}(${e}, halfCR);
    }
  `}function DZ(n,e){const t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1);if(n.shapeInfo.isUniform)return`float ${s}() {return ${t};}`;const[r,i]=n.shapeInfo.texShape;if(r===1&&i===1)return`
      float ${s}() {
        return sampleTexture(${t}, halfCR);
      }
    `;const o=ll(t);if(e)return`
    float ${s}() {
      vec2 uv = uvFromFlat(${t}TexShape[0], ${t}TexShape[1], ${o});
      return sampleTexture(${t}, uv);
    }
  `;const[a,l]=n.shapeInfo.texShape;return`
    float ${s}() {
      vec2 uv = uvFromFlat(${a}, ${l}, ${o});
      return sampleTexture(${t}, uv);
    }
  `}function PZ(n,e){const t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1),r=n.shapeInfo.texShape,i=ks();if(e)return`
    vec4 ${s}(int index) {
      ivec2 packedTexShape = ivec2(ceil(float(${t}TexShape[0]) / 2.0), ceil(float(${t}TexShape[1]) / 2.0));
      vec2 uv = packedUVfrom1D(
        packedTexShape[0], packedTexShape[1], index);
      return ${i.texture2D}(${t}, uv);
    }
  `;const o=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)];return`
    vec4 ${s}(int index) {
      vec2 uv = packedUVfrom1D(
        ${o[0]}, ${o[1]}, index);
      return ${i.texture2D}(${t}, uv);
    }
  `}function MZ(n,e){const t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1);if(n.shapeInfo.isUniform)return`
      float ${s}(int index) {
        ${Mc(n)}
      }
    `;const r=n.shapeInfo.texShape,i=r[0],o=r[1];if(o===1&&i===1)return`
      float ${s}(int index) {
        return sampleTexture(${t}, halfCR);
      }
    `;const a=ll(t);return o===1?e?`
      float ${s}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / float(${t}TexShape[0]));
        return sampleTexture(${t}, uv);
      }
    `:`
      float ${s}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / ${i}.0);
        return sampleTexture(${t}, uv);
      }
    `:i===1?e?`
      float ${s}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / float(${t}TexShape[1]), 0.5);
        return sampleTexture(${t}, uv);
      }
    `:`
      float ${s}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / ${o}.0, 0.5);
        return sampleTexture(${t}, uv);
      }
    `:e?`
    float ${s}(int index) {
      vec2 uv = uvFromFlat(${t}TexShape[0], ${t}TexShape[1], index + ${a});
      return sampleTexture(${t}, uv);
    }
  `:`
    float ${s}(int index) {
      vec2 uv = uvFromFlat(${i}, ${o}, index + ${a});
      return sampleTexture(${t}, uv);
    }
  `}function LZ(n,e){const t=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),i=n.shapeInfo.texShape,o=i[0],a=i[1],l=ks();if(i!=null&&At(t,i))return e?`
      vec4 ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);

        return ${l.texture2D}(${s}, uv);
      }
    `:`
      vec4 ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${a}.0, ${o}.0);

        return ${l.texture2D}(${s}, uv);
      }
    `;if(e)return`
    vec4 ${r}(int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${s}TexShape[0]) / 2.0), ceil(float(${s}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${s}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);
      return ${l.texture2D}(${s}, uv);
    }
  `;const u=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)],d=Math.ceil(t[1]/2);return`
    vec4 ${r}(int row, int col) {
      vec2 uv = packedUVfrom2D(${d}, ${u[0]}, ${u[1]}, row, col);
      return ${l.texture2D}(${s}, uv);
    }
  `}function FZ(n,e){const t=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),i=n.shapeInfo.texShape;if(i!=null&&At(t,i)){if(e)return`
      float ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `;const p=i[0],g=i[1];return`
    float ${r}(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(${g}.0, ${p}.0);
      return sampleTexture(${s}, uv);
    }
  `}const{newShape:o,keptDims:a}=Xo(t),l=o;if(l.length<t.length){const p=Lc(n,l),g=["row","col"];return`
      ${Pc(p,e)}
      float ${r}(int row, int col) {
        return ${r}(${Fc(g,a)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${r}(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(${t[1]}, 1)));
        ${Mc(n)}
      }
    `;const u=i[0],d=i[1],f=ll(s);return d===1?e?`
      float ${r}(int row, int col) {
        float index = dot(vec3(row, col, ${f}), vec3(${s}Shape[1], 1, 1));
        vec2 uv = vec2(0.5, (index + 0.5) / float(${s}TexShape[0]));
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${r}(int row, int col) {
      float index = dot(vec3(row, col, ${f}), vec3(${t[1]}, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / ${u}.0);
      return sampleTexture(${s}, uv);
    }
  `:u===1?e?`
      float ${r}(int row, int col) {
        float index = dot(vec3(row, col, ${f}), vec3(${s}Shape[1], 1, 1));
        vec2 uv = vec2((index + 0.5) / float(${s}TexShape[1]), 0.5);
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${r}(int row, int col) {
      float index = dot(vec3(row, col, ${f}), vec3(${t[1]}, 1, 1));
      vec2 uv = vec2((index + 0.5) / ${d}.0, 0.5);
      return sampleTexture(${s}, uv);
    }
  `:e?`
      float ${r}(int row, int col) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${s}Shape[1] + col + ${f};
        vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index);
        return sampleTexture(${s}, uv);
      }
    `:`
  float ${r}(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * ${t[1]} + col + ${f};
    vec2 uv = uvFromFlat(${u}, ${d}, index);
    return sampleTexture(${s}, uv);
  }
`}function OZ(n,e){const t=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),i=n.shapeInfo.texShape,o=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];if(t[0]===1){const p=t.slice(1),g=[1,2],x=Lc(n,p),y=["b","row","col"];return`
        ${oP(x,e)}
        vec4 ${r}(int b, int row, int col) {
          return ${r}(${Fc(y,g)});
        }
      `}const a=ks();if(e)return`
    vec4 ${r}(int b, int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${s}TexShape[0]) / 2.0), ceil(float(${s}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${s}Shape[2]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${s}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom3D(
        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);
      return ${a.texture2D}(${s}, uv);
    }
  `;const l=o[0],u=o[1],d=Math.ceil(t[2]/2),f=d*Math.ceil(t[1]/2);return`
    vec4 ${r}(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        ${l}, ${u}, ${f}, ${d}, b, row, col);
      return ${a.texture2D}(${s}, uv);
    }
  `}function _Z(n,e){const t=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),i=t[1]*t[2],o=t[2],{newShape:a,keptDims:l}=Xo(t),u=a;if(u.length<t.length){const y=Lc(n,u),b=["row","col","depth"];return`
        ${Pc(y,e)}
        float ${r}(int row, int col, int depth) {
          return ${r}(${Fc(b,l)});
        }
      `}if(n.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(${i}, ${o}, 1)));
        ${Mc(n)}
      }
    `;const d=n.shapeInfo.texShape,f=d[0],p=d[1],g=n.shapeInfo.flatOffset;if(p===i&&g==null)return e?`
      float ${r}(int row, int col, int depth) {
        int stride1 = ${s}Shape[2];
        float texR = float(row);
        float texC = dot(vec2(col, depth), vec2(stride1, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
        float ${r}(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(${o}, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(${p}.0, ${f}.0);
          return sampleTexture(${s}, uv);
        }
      `;if(p===o&&g==null)return e?`
      float ${r}(int row, int col, int depth) {
        float texR = dot(vec2(row, col), vec2(${s}Shape[1], 1));
        float texC = float(depth);
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${r}(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(${t[1]}, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${p}.0, ${f}.0);
      return sampleTexture(${s}, uv);
    }
  `;const x=ll(s);return e?`
    float ${r}(int row, int col, int depth) {
      // Explicitly use integer operations as dot() only works on floats.
      int stride0 = ${s}Shape[1] * ${s}Shape[2];
      int stride1 = ${s}Shape[2];
      int index = row * stride0 + col * stride1 + depth + ${x};
      vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index);
      return sampleTexture(${s}, uv);
    }
    `:`
      float ${r}(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${i} + col * ${o} + depth + ${x};
        vec2 uv = uvFromFlat(${f}, ${p}, index);
        return sampleTexture(${s}, uv);
      }
  `}function zZ(n,e){const t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1),r=ks();if(e)return`
    vec4 ${s}(int b2, int b, int row, int col) {
      int valuesPerRow = int(ceil(float(${t}Shape[3]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${t}Shape[2]) / 2.0));
      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);
      texelsInBatch *= ${t}Shape[1];
      index = b2 * texelsInBatch + index;
      ivec2 packedTexShape = ivec2(ceil(float(${t}TexShape[0]) / 2.0), ceil(float(${t}TexShape[1]) / 2.0));
      int texR = index / packedTexShape[1];
      int texC = index - texR * packedTexShape[1];
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ${r.texture2D}(${t}, uv);
    }
  `;const i=n.shapeInfo.logicalShape,o=i.length,a=n.shapeInfo.texShape,l=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],u=l[0],d=l[1],f=Math.ceil(i[o-1]/2);let p=f*Math.ceil(i[o-2]/2),g="int b, int row, int col",x=`b * ${p} + (row / 2) * ${f} + (col / 2)`;for(let y=2;y<o-1;y++)g=`int b${y}, `+g,p*=i[o-y-1],x=`b${y} * ${p} + `+x;return`
    vec4 ${s}(${g}) {
      int index = ${x};
      int texR = index / ${d};
      int texC = index - texR * ${d};
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${d}, ${u});
      return ${r.texture2D}(${t}, uv);
    }
  `}function BZ(n,e){const t=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),i=t[3],o=t[2]*i,a=t[1]*o,{newShape:l,keptDims:u}=Xo(t);if(l.length<t.length){const w=Lc(n,l),N=["row","col","depth","depth2"];return`
      ${Pc(w,e)}
      float ${r}(int row, int col, int depth, int depth2) {
        return ${r}(${Fc(N,u)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(${a}, ${o}, ${i}, 1)));
        ${Mc(n)}
      }
    `;const d=n.shapeInfo.flatOffset,f=n.shapeInfo.texShape,p=f[0],g=f[1],x=`int stride2 = ${s}Shape[3];`,y=`int stride1 = ${s}Shape[2] * stride2;`,b=`int stride0 = ${s}Shape[1] * stride1;`;if(g===a&&d==null)return e?`
      float ${r}(int row, int col, int depth, int depth2) {
        ${x}
        ${y}
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(stride1, stride2, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(${o}, ${i}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${g}.0, ${p}.0);
        return sampleTexture(${s}, uv);
      }
    `;if(g===i&&d==null)return e?`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${s}Shape[1] * ${s}Shape[2], ${s}Shape[2], 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${t[1]*t[2]}, ${t[2]}, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${g}.0, ${p}.0);
        return sampleTexture(${s}, uv);
      }
    `;const k=ll(s);return e?`
    float ${r}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      ${x}
      ${y}
      ${b}
      int index = row * stride0 + col * stride1 +
          depth * stride2 + depth2;
      vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index + ${k});
      return sampleTexture(${s}, uv);
    }
  `:`
    float ${r}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${o} +
          depth * ${i} + depth2;
      vec2 uv = uvFromFlat(${p}, ${g}, index + ${k});
      return sampleTexture(${s}, uv);
    }
  `}function WZ(n){const e=n.shapeInfo.logicalShape,t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1),r=e[4],i=e[3]*r,o=e[2]*i,a=e[1]*o,{newShape:l,keptDims:u}=Xo(e);if(l.length<e.length){const y=Lc(n,l),b=["row","col","depth","depth2","depth3"];return`
      ${Pc(y)}
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        return ${s}(${Fc(b,u)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(${a}, ${o}, ${i}, ${r})) +
          depth3;
        ${Mc(n)}
      }
    `;const d=n.shapeInfo.flatOffset,f=n.shapeInfo.texShape,p=f[0],g=f[1];if(g===a&&d==null)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(${o}, ${i}, ${r}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${g}.0, ${p}.0);
        return sampleTexture(${t}, uv);
      }
    `;if(g===r&&d==null)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]},
               ${e[2]*e[3]}, ${e[3]}, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${g}.0, ${p}.0);
        return sampleTexture(${t}, uv);
      }
    `;const x=ll(t);return`
    float ${s}(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${o} + depth * ${i} +
          depth2 * ${r} + depth3 + ${x};
      vec2 uv = uvFromFlat(${p}, ${g}, index);
      return sampleTexture(${t}, uv);
    }
  `}function VZ(n){const e=n.shapeInfo.logicalShape,t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1),{newShape:r,keptDims:i}=Xo(e);if(r.length<e.length){const b=Lc(n,r),k=["row","col","depth","depth2","depth3","depth4"];return`
      ${Pc(b)}
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return ${s}(${Fc(k,i)});
      }
    `}const o=e[5],a=e[4]*o,l=e[3]*a,u=e[2]*l,d=e[1]*u;if(n.shapeInfo.isUniform)return`
      float ${s}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(${d}, ${u}, ${l}, ${a})) +
          dot(
            vec2(depth3, depth4),
            vec2(${o}, 1)));
        ${Mc(n)}
      }
    `;const f=n.shapeInfo.flatOffset,p=n.shapeInfo.texShape,g=p[0],x=p[1];if(x===d&&f==null)return`
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(${u}, ${l}, ${a}, ${o})) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${x}.0, ${g}.0);
        return sampleTexture(${t}, uv);
      }
    `;if(x===o&&f==null)return`
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]*e[4]},
               ${e[2]*e[3]*e[4]},
               ${e[3]*e[4]},
               ${e[4]})) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${x}.0, ${g}.0);
        return sampleTexture(${t}, uv);
      }
    `;const y=ll(t);return`
    float ${s}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${d} + col * ${u} + depth * ${l} +
          depth2 * ${a} + depth3 * ${o} + depth4 + ${y};
      vec2 uv = uvFromFlat(${g}, ${x}, index);
      return sampleTexture(${t}, uv);
    }
  `}function Mc(n){const e=n.name,t=be(n.shapeInfo.logicalShape);return t<2?`return ${e};`:`
    for (int i = 0; i < ${t}; i++) {
      if (i == index) {
        return ${e}[i];
      }
    }
  `}function UZ(n,e){const t=n.name,s=t.charAt(0).toUpperCase()+t.slice(1),r="get"+s+"AtOutCoords",i=n.shapeInfo.logicalShape.length,o=e.logicalShape.length,a=iP(n.shapeInfo.logicalShape,e.logicalShape),l=Pt(o),u=o-i;let d;const f=["x","y","z","w","u","v"];i===0?d="":o<2&&a.length>=1?d="coords = 0;":d=a.map(w=>`coords.${f[w+u]} = 0;`).join(`
`);let p="";o<2&&i>0?p="coords":p=n.shapeInfo.logicalShape.map((w,N)=>`coords.${f[N+u]}`).join(", ");let g="return outputValue;";const y=be(n.shapeInfo.logicalShape)===1,k=be(e.logicalShape)===1;if(i===1&&!y&&!k)g=`
      return vec4(outputValue.xy, outputValue.xy);
    `;else if(y&&!k)o===1?g=`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:g=`
        return vec4(outputValue.x);
      `;else if(a.length){const w=i-2,N=i-1;a.indexOf(w)>-1&&a.indexOf(N)>-1?g="return vec4(outputValue.x);":a.indexOf(w)>-1?g="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":a.indexOf(N)>-1&&(g="return vec4(outputValue.xx, outputValue.zz);")}return`
    vec4 ${r}() {
      ${l} coords = getOutputCoords();
      ${d}
      vec4 outputValue = get${s}(${p});
      ${g}
    }
  `}function GZ(n,e){const t=n.name,s=t.charAt(0).toUpperCase()+t.slice(1),r="get"+s+"AtOutCoords",i=e.texShape,o=n.shapeInfo.texShape,a=n.shapeInfo.logicalShape.length,l=e.logicalShape.length;if(!n.shapeInfo.isUniform&&a===l&&n.shapeInfo.flatOffset==null&&At(o,i))return`
      float ${r}() {
        return sampleTexture(${t}, resultUV);
      }
    `;const u=Pt(l),d=iP(n.shapeInfo.logicalShape,e.logicalShape),f=l-a;let p;const g=["x","y","z","w","u","v"];a===0?p="":l<2&&d.length>=1?p="coords = 0;":p=d.map(y=>`coords.${g[y+f]} = 0;`).join(`
`);let x="";return l<2&&a>0?x="coords":x=n.shapeInfo.logicalShape.map((y,b)=>`coords.${g[b+f]}`).join(", "),`
    float ${r}() {
      ${u} coords = getOutputCoords();
      ${p}
      return get${s}(${x});
    }
  `}function Pt(n){if(n<=1)return"int";if(n===2)return"ivec2";if(n===3)return"ivec3";if(n===4)return"ivec4";if(n===5)return"ivec5";if(n===6)return"ivec6";throw Error(`GPU for rank ${n} is not yet supported`)}function Yw(n,e,t){const{newShape:s,keptDims:r}=Xo(e),i=e.length,o=n&&i===3&&e[0]===1,a=o?e.slice(1):s,l=!n&&i>1&&!At(e,t)&&s.length<i||o;return{useSqueezeShape:l,uniformShape:l?a:e,keptDims:r}}function Lc(n,e){const t=JSON.parse(JSON.stringify(n));return t.shapeInfo.logicalShape=e,t}function Fc(n,e){return e.map(t=>n[t]).join(", ")}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HZ(n,e,t,s){const r=t.map((d,f)=>{const p={logicalShape:d.shape,texShape:d.isUniform?null:d.texData.texShape,isUniform:d.isUniform,isPacked:d.isUniform?!1:d.texData.isPacked,flatOffset:null};return d.texData!=null&&d.texData.slice!=null&&d.texData.slice.flatOffset>0&&(p.flatOffset=d.texData.slice.flatOffset),{name:e.variableNames[f],shapeInfo:p}}),i=r.map(d=>d.shapeInfo),o={logicalShape:s.shape,texShape:s.texData.texShape,isUniform:!1,isPacked:s.texData.isPacked,flatOffset:null},a=uZ(r,o,e),l=_Y(n.gl,a),u=n.createProgram(l);return me().get("ENGINE_COMPILE_ONLY")?{program:e,fragmentShader:l,source:a,webGLProgram:u,inShapeInfos:i,outShapeInfo:o,variablesLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:(n.buildVao(u),Object.assign({program:e,fragmentShader:l,source:a,webGLProgram:u,inShapeInfos:i,outShapeInfo:o},lP(n,e,u)))}function lP(n,e,t){const s=[],r=[];let i,o,a,l=null,u=null;u=n.getUniformLocation(t,"NAN",!1),me().getNumber("WEBGL_VERSION")===1&&(l=n.getUniformLocation(t,"INFINITY",!1));const d=!1;for(const f of e.variableNames){const p={name:f,uniform:n.getUniformLocation(t,f,d),offset:n.getUniformLocation(t,`offset${f}`,d)};e.enableShapeUniforms&&(p.shape=n.getUniformLocation(t,`${f}Shape`,d),p.texShape=n.getUniformLocation(t,`${f}TexShape`,d)),s.push(p)}if(e.enableShapeUniforms&&(i=n.getUniformLocation(t,"outShape",d),a=n.getUniformLocation(t,"outShapeStrides",d),o=n.getUniformLocation(t,"outTexShape",d)),e.customUniforms)for(const f of e.customUniforms)r.push(n.getUniformLocation(t,f.name,d));return{variablesLocations:s,customUniformLocations:r,infLoc:l,nanLoc:u,outShapeLocation:i,outShapeStridesLocation:a,outTexShapeLocation:o}}function BN(n,e){if(n.length!==e.length)throw Error(`Binary was compiled with ${n.length} inputs, but was executed with ${e.length} inputs`);n.forEach((t,s)=>{const r=t.logicalShape,i=e[s],o=i.shape;if(!At(r,o))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${r} and ${o} must match`);if(t.isUniform&&i.isUniform)return;const a=t.texShape,l=i.isUniform?null:i.texData.texShape;if(!At(a,l))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${a} and ${l} must match`)})}function qZ(n,e,t,s,r){e.program.enableShapeUniforms||(BN(e.inShapeInfos,t),BN([e.outShapeInfo],[s]));const i=s.texData.texture,o=s.texData.texShape;s.texData.isPacked?n.setOutputPackedMatrixTexture(i.texture,o[0],o[1]):n.setOutputMatrixTexture(i.texture,o[0],o[1]),n.setProgram(e.webGLProgram),n.bindVertexArray(e.webGLProgram.vao),me().getNumber("WEBGL_VERSION")===1&&e.infLoc!==null&&n.gl.uniform1f(e.infLoc,1/0),e.nanLoc!==null&&n.gl.uniform1f(e.nanLoc,NaN);for(let l=0;l<t.length;++l){const u=t[l],{uniform:d,offset:f,shape:p,texShape:g}=e.variablesLocations[l];if(p){const{uniformShape:x}=Yw(e.program.packedInputs,u.shape,u.texData.texShape);switch(x.length){case 1:n.gl.uniform1iv(p,new Int32Array(x));break;case 2:n.gl.uniform2iv(p,new Int32Array(x));break;case 3:n.gl.uniform3iv(p,new Int32Array(x));break;case 4:n.gl.uniform4iv(p,new Int32Array(x));break}}if(g&&n.gl.uniform2i(g,u.texData.texShape[0],u.texData.texShape[1]),d!=null){if(u.isUniform){if(be(u.shape)<2)n.gl.uniform1f(d,u.uniformValues[0]);else{let x=u.uniformValues;x instanceof Float32Array||(x=new Float32Array(x)),n.gl.uniform1fv(d,x)}continue}u.texData.slice!=null&&f!=null&&n.gl.uniform1i(f,u.texData.slice.flatOffset),n.setInputMatrixTexture(u.texData.texture.texture,d,l)}}const a=e.outShapeLocation;if(a)switch(s.shape.length){case 1:n.gl.uniform1iv(a,new Int32Array(s.shape));break;case 2:n.gl.uniform2iv(a,new Int32Array(s.shape));break;case 3:n.gl.uniform3iv(a,new Int32Array(s.shape));break;case 4:n.gl.uniform4iv(a,new Int32Array(s.shape));break}if(e.outShapeStridesLocation){const l=Qe(s.shape);switch(s.shape.length){case 2:n.gl.uniform1iv(e.outShapeStridesLocation,new Int32Array(l));break;case 3:n.gl.uniform2iv(e.outShapeStridesLocation,new Int32Array(l));break;case 4:n.gl.uniform3iv(e.outShapeStridesLocation,new Int32Array(l));break}}if(e.outTexShapeLocation&&n.gl.uniform2i(e.outTexShapeLocation,s.texData.texShape[0],s.texData.texShape[1]),e.program.customUniforms&&r)for(let l=0;l<e.program.customUniforms.length;++l){const u=e.program.customUniforms[l],d=e.customUniformLocations[l],f=r[l];if(u.type==="float")n.gl.uniform1fv(d,f);else if(u.type==="vec2")n.gl.uniform2fv(d,f);else if(u.type==="vec3")n.gl.uniform3fv(d,f);else if(u.type==="vec4")n.gl.uniform4fv(d,f);else if(u.type==="int")n.gl.uniform1iv(d,f);else if(u.type==="ivec2")n.gl.uniform2iv(d,f);else if(u.type==="ivec3")n.gl.uniform3iv(d,f);else if(u.type==="ivec4")n.gl.uniform4iv(d,f);else throw Error(`uniform type ${u.type} is not supported yet.`)}n.executeProgram()}function KZ(n,e,t){let s="";e.concat(t).forEach(o=>{const a=o.texData!=null&&o.texData.slice!=null&&o.texData.slice.flatOffset>0;if(n.enableShapeUniforms&&!o.isUniform){const l=o.texData.texShape,{useSqueezeShape:u,uniformShape:d,keptDims:f}=Yw(n.packedInputs,o.shape,l);let p="",g="",x="";if(d.length===1&&n.packedInputs){const S=[Math.ceil(l[0]/2),Math.ceil(l[1]/2)];p=`${S[0]>1}_${S[1]>1}`}else if(d.length===2&&!n.packedInputs)g=`${d[0]>1}_${d[1]>1}`;else if(d.length>2&&!n.packedInputs){const S=Qe(d);x=`${S[0]===l[1]}_${S[S.length-1]===l[1]}`}const y=o.shape.length,b=d.length===2&&At(o.shape,l),k=be(o.shape)===1,w=cc(o.shape,t.shape),N=!n.packedInputs&&y===t.shape.length&&At(l,t.texData.texShape),C=n.packedInputs||d.length>2?"":`${l[0]>1}_${l[1]>1}`;s+=`${y}_${N}_${u?f:""}_${d.length}_${k}_${w}_${b}_${p}_${g}_${x}_${C}_${a}`}else{const l=o.isUniform?"uniform":o.texData.texShape;s+=`${o.shape}_${l}_${a}`}});const r=n.userCode;let i=n.constructor.name;return i+="_"+s+"_"+r+`${me().getNumber("WEBGL_VERSION")}`,i}function os(n){return me().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&n<=4}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class QZ{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=id.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const t=ks();this.outputShape=e,this.enableShapeUniforms=os(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?cx(["r","c","d"],e):al(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        ${t.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class XZ{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=id.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const t=ks();this.outputShape=e,this.enableShapeUniforms=os(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?cx(["r","c","d"],e):al(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        ${t.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class YZ{constructor(e){this.variableNames=["A"],this.outTexUsage=ir.DOWNLOAD;const t=ks();this.outputShape=e,this.userCode=`
      ${rP}

      void main() {
        float x = getAAtOutCoords();
        ${t.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ZZ{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=ir.DOWNLOAD;const t=ks();this.outputShape=e,this.userCode=`
      ${rP}

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        ${t.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JZ={R:0,G:1,B:2,A:3};class WN{constructor(e,t=!1,s="RGBA"){this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];const r=ks();this.outputShape=e,this.enableShapeUniforms=os(this.outputShape.length);let i="result";t&&(i="floor(result * 255. + 0.5)");let o="";for(let a=0;a<s.length;a++){const l=s[a];o+=`
          if(offset == ${a}) {
            result = values[${JZ[l]}];
          }`}this.userCode=`
      ${this.enableShapeUniforms?Xw():Qw(e)}

      void main() {
        ivec3 coords = getOutputCoords();
        int flatIndex = getFlatIndex(coords);
        float result = 0.;
        int offset = imod(flatIndex, ${s.length});

        flatIndex = idiv(flatIndex, ${s.length}, 1.);

        int r = flatIndex / texShape[1];
        if (r < texShape[0]) {
          int c = imod(flatIndex, texShape[1]);
          vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
          vec4 values = ${r.texture2D}(A, uv);
          ${o}
        }
        ${r.output} = vec4(${i}, 0., 0., 0.);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class eJ{constructor(e,t=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];const s=ks();this.outputShape=e,this.enableShapeUniforms=os(this.outputShape.length);let r="",i="result";t&&(i="floor(result * 255. + 0.5)");for(let o=0;o<=1;o++)for(let a=0;a<=1;a++){const l=o*2+a;r+=`
          localCoords = coords;
          if(localCoords[2] + ${a} < ${this.enableShapeUniforms?"outShape[2]":`${e[2]}`}) {
          localCoords[2] += ${a};
          if (localCoords[1] + ${o} < ${this.enableShapeUniforms?"outShape[1]":`${e[1]}`}) {
            localCoords[1] += ${o};

            flatIndex = getFlatIndex(localCoords);
            offset = imod(flatIndex, 4);

            flatIndex = idiv(flatIndex, 4, 1.);

            int r = flatIndex / texShape[1];
            int c = imod(flatIndex, texShape[1]);
            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
            values = ${s.texture2D}(A, uv);

            if (offset == 0) {
              result[${l}] = values[0];
            } else if (offset == 1) {
              result[${l}] = values[1];
            } else if (offset == 2) {
              result[${l}] = values[2];
            } else {
              result[${l}] = values[3];
            }
          }
        }
        `}this.userCode=`
        ${this.enableShapeUniforms?Xw():Qw(e)}

        void main() {
          ivec3 coords = getOutputCoords();

          vec4 result = vec4(0.);
          int flatIndex, r, c, offset;
          ivec3 localCoords;
          vec2 uv;
          vec4 values;

          ${r}

          ${s.output} = ${i};
        }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tJ(n){const e=ks(),t=`${e.version}
    precision highp float;
    ${e.attribute} vec3 clipSpacePos;
    ${e.attribute} vec2 uv;
    ${e.varyingVs} vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`;return OY(n,t)}function nJ(n){const e=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return VY(n,e)}function sJ(n){const e=new Uint16Array([0,1,2,2,1,3]);return UY(n,e)}function Dh(n,e,t,s,r,i){HY(e,t);const o=GY(n),a=n.TEXTURE_2D;return Le(n,()=>n.bindTexture(a,o)),Le(n,()=>n.texParameteri(a,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE)),Le(n,()=>n.texParameteri(a,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE)),Le(n,()=>n.texParameteri(a,n.TEXTURE_MIN_FILTER,n.NEAREST)),Le(n,()=>n.texParameteri(a,n.TEXTURE_MAG_FILTER,n.NEAREST)),me().getNumber("WEBGL_VERSION")===1?Le(n,()=>n.texImage2D(a,0,s,e,t,0,r,i,null)):Le(n,()=>n.texStorage2D(a,1,s,e,t)),Le(n,()=>n.bindTexture(n.TEXTURE_2D,null)),{texture:o,texShape:[t,e]}}function cP(n){return n.internalFormatFloat}function rJ(n,e,t,s){const[r,i]=jh(e,t);return Dh(n,r,i,cP(s),s.textureFormatFloat,n.FLOAT)}function uP(n){return n.internalFormatHalfFloat}function iJ(n,e,t,s){const[r,i]=jh(e,t);return Dh(n,r,i,uP(s),s.textureFormatFloat,s.textureTypeHalfFloat)}function dP(n){return n.downloadTextureFormat}function oJ(n,e,t,s){const[r,i]=jh(e,t);return Dh(n,r,i,dP(s),n.RGBA,n.UNSIGNED_BYTE)}function hP(n){return n.internalFormatPackedFloat}function aJ(n,e,t,s){const[r,i]=Dc(e,t);return Dh(n,r,i,hP(s),n.RGBA,n.FLOAT)}function fP(n){return n.internalFormatPackedHalfFloat}function lJ(n,e,t,s){const[r,i]=Dc(e,t);return Dh(n,r,i,fP(s),n.RGBA,s.textureTypeHalfFloat)}function cJ(n,e,t){return Le(n,()=>n.bindBuffer(n.ARRAY_BUFFER,t)),ON(n,e,"clipSpacePos",t,3,20,0)&&ON(n,e,"uv",t,2,20,12)}function uJ(n,e,t,s,r,i){Le(n,()=>n.bindTexture(n.TEXTURE_2D,e));let o,a,l;r instanceof Uint8Array?(o=new Uint8Array(t*s*4),a=n.UNSIGNED_BYTE,l=n.RGBA):(o=new Float32Array(t*s*4),a=n.FLOAT,l=i.internalFormatPackedFloat),o.set(r),me().getNumber("WEBGL_VERSION")===2?Le(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,t,s,n.RGBA,a,o)):Le(n,()=>n.texImage2D(n.TEXTURE_2D,0,l,t,s,0,n.RGBA,a,o)),Le(n,()=>n.bindTexture(n.TEXTURE_2D,null))}function dJ(n,e,t){Le(n,()=>n.bindTexture(n.TEXTURE_2D,e)),t.data instanceof Uint8Array?me().getNumber("WEBGL_VERSION")===2?Le(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,t.width,t.height,n.RGBA,n.UNSIGNED_BYTE,t.data)):Le(n,()=>n.texImage2D(n.TEXTURE_2D,0,n.RGBA,t.width,t.height,0,n.RGBA,n.UNSIGNED_BYTE,t.data)):me().getNumber("WEBGL_VERSION")===2?Le(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,t)):Le(n,()=>n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,t)),Le(n,()=>n.bindTexture(n.TEXTURE_2D,null))}function hJ(n,e,t,s){const r=n.createBuffer();Le(n,()=>n.bindBuffer(n.PIXEL_PACK_BUFFER,r));const a=4*4*e*t;return Le(n,()=>n.bufferData(n.PIXEL_PACK_BUFFER,a,n.STREAM_READ)),Le(n,()=>n.readPixels(0,0,t,e,n.RGBA,n.FLOAT,0)),Le(n,()=>n.bindBuffer(n.PIXEL_PACK_BUFFER,null)),r}function fJ(n,e,t){const s=n,r=new Float32Array(t);return s.bindBuffer(s.PIXEL_PACK_BUFFER,e),s.getBufferSubData(s.PIXEL_PACK_BUFFER,0,r),s.bindBuffer(s.PIXEL_PACK_BUFFER,null),r}function pJ(n,e,t,s){const[r,i]=jh(e,t),o=4,a=new Uint8Array(jY(e*t,o));return Le(n,()=>n.readPixels(0,0,r,i,s.downloadTextureFormat,n.UNSIGNED_BYTE,a)),new Float32Array(a.buffer)}function mJ(n,e,t,s,r,i,o,a){const l=n,u=new Float32Array(RY(i,o));return l.bindBuffer(l.PIXEL_PACK_BUFFER,e),l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,u),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),u}function gJ(n,e,t){const s=new Float32Array(e*t*4);return Le(n,()=>n.readPixels(0,0,t,e,n.RGBA,n.FLOAT,s)),s}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class E0{constructor(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.itemsToPoll=[];const t=me().getNumber("WEBGL_VERSION");if(e!=null?(this.gl=e,$Y(t,e)):this.gl=ri(t),e=this.gl,me().getNumber("WEBGL_VERSION")===2){const i=e;this.createVertexArray=()=>Le(i,()=>i.createVertexArray()),this.bindVertexArray=o=>Le(i,()=>i.bindVertexArray(o)),this.deleteVertexArray=o=>Le(i,()=>i.deleteVertexArray(o)),this.getVertexArray=()=>Le(i,()=>i.getParameter(i.VERTEX_ARRAY_BINDING))}else if(e!=null){const i=e.getExtension("OES_vertex_array_object");if(i==null)throw new Error("All WebGL1 implementations are expected to offer OES_vertex_array_object.");this.createVertexArray=()=>Le(e,()=>i.createVertexArrayOES()),this.bindVertexArray=o=>Le(e,()=>i.bindVertexArrayOES(o)),this.deleteVertexArray=o=>Le(e,()=>i.deleteVertexArrayOES(o)),this.getVertexArray=()=>Le(e,()=>e.getParameter(i.VERTEX_ARRAY_BINDING_OES))}let s="WEBGL_color_buffer_float";const r="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),me().getNumber("WEBGL_VERSION")===1){const i="OES_texture_float",o="OES_texture_half_float";if(this.textureFloatExtension=ip(this.gl,i),Nr(this.gl,o))this.textureHalfFloatExtension=ip(this.gl,o);else if(me().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(s),Nr(this.gl,r))this.colorBufferHalfFloatExtension=ip(this.gl,r);else if(me().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(s="EXT_color_buffer_float",Nr(this.gl,s))this.colorBufferFloatExtension=this.gl.getExtension(s);else if(Nr(this.gl,r))this.colorBufferHalfFloatExtension=this.gl.getExtension(r);else throw new Error("GL context does not support color renderable floats");this.vertexBuffer=nJ(this.gl),this.indexBuffer=sJ(this.gl),this.framebuffer=qY(this.gl),this.textureConfig=Kw(this.gl,this.textureHalfFloatExtension)}get debug(){return me().getBool("DEBUG")}dispose(){if(this.disposed)return;this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");const e=this.gl;Le(e,()=>e.finish()),Le(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,null)),Le(e,()=>e.deleteFramebuffer(this.framebuffer)),Le(e,()=>e.bindBuffer(e.ARRAY_BUFFER,null)),Le(e,()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)),Le(e,()=>e.deleteBuffer(this.indexBuffer)),this.disposed=!0}createFloat32MatrixTexture(e,t){return this.throwIfDisposed(),rJ(this.gl,e,t,this.textureConfig)}createFloat16MatrixTexture(e,t){return this.throwIfDisposed(),iJ(this.gl,e,t,this.textureConfig)}createUnsignedBytesMatrixTexture(e,t){return this.throwIfDisposed(),oJ(this.gl,e,t,this.textureConfig)}uploadPixelDataToTexture(e,t){this.throwIfDisposed(),dJ(this.gl,e,t)}uploadDenseMatrixToTexture(e,t,s,r){this.throwIfDisposed(),uJ(this.gl,e,t,s,r,this.textureConfig)}createFloat16PackedMatrixTexture(e,t){return this.throwIfDisposed(),lJ(this.gl,e,t,this.textureConfig)}createPackedMatrixTexture(e,t){return this.throwIfDisposed(),aJ(this.gl,e,t,this.textureConfig)}deleteMatrixTexture(e){this.throwIfDisposed(),this.outputTexture===e&&(_N(this.gl,this.framebuffer),this.outputTexture=null),Le(this.gl,()=>this.gl.deleteTexture(e))}downloadByteEncodedFloatMatrixFromOutputTexture(e,t,s){return this.downloadMatrixDriver(e,()=>pJ(this.gl,t,s,this.textureConfig))}downloadPackedMatrixFromBuffer(e,t,s,r,i,o){return mJ(this.gl,e,t,s,r,i,o,this.textureConfig)}downloadFloat32MatrixFromBuffer(e,t){return fJ(this.gl,e,t)}createBufferFromTexture(e,t,s){this.bindTextureToFrameBuffer(e);const r=hJ(this.gl,t,s,this.textureConfig);return this.unbindTextureToFrameBuffer(),r}createAndWaitForFence(){const e=this.createFence(this.gl);return this.pollFence(e)}createFence(e){let t,s;if(me().getBool("WEBGL_FENCE_API_ENABLED")){const r=e,i=r.fenceSync(r.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),s=()=>{const o=r.clientWaitSync(i,0,0);return o===r.ALREADY_SIGNALED||o===r.CONDITION_SATISFIED},t=i}else me().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),s=()=>this.isQueryAvailable(t,me().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):s=()=>!0;return{query:t,isFencePassed:s}}downloadMatrixFromPackedTexture(e,t,s){return this.downloadMatrixDriver(e,()=>gJ(this.gl,t,s))}createProgram(e){this.throwIfDisposed();const t=this.gl;this.vertexShader==null&&(this.vertexShader=tJ(t));const s=BY(t);Le(t,()=>t.attachShader(s,this.vertexShader)),Le(t,()=>t.attachShader(s,e)),WY(t,s);const r=Object.assign(s,{vao:this.createVertexArray()});return this.debug&&N0(t,r),r}buildVao(e){this.setProgram(e),this.bindVertexArray(e.vao);const t=this.gl;Le(t,()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer)),cJ(t,e,this.vertexBuffer)}deleteProgram(e){this.throwIfDisposed(),e===this.program&&(this.program=null),e!=null&&(Le(this.gl,()=>this.gl.deleteProgram(e)),this.deleteVertexArray(e.vao))}setProgram(e){this.throwIfDisposed(),this.program=e,this.program!=null&&this.debug&&N0(this.gl,this.program),Le(this.gl,()=>this.gl.useProgram(e))}getUniformLocation(e,t,s=!0){return this.throwIfDisposed(),s?QY(this.gl,e,t):XY(this.gl,e,t)}getAttributeLocation(e,t){return this.throwIfDisposed(),Le(this.gl,()=>this.gl.getAttribLocation(e,t))}getUniformLocationNoThrow(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)}setInputMatrixTexture(e,t,s){this.throwIfDisposed(),this.throwIfNoProgram(),YY(this.gl,e,t,s)}setOutputMatrixTexture(e,t,s){this.setOutputMatrixTextureDriver(e,s,t)}setOutputPackedMatrixTexture(e,t,s){this.throwIfDisposed();const[r,i]=Dc(t,s);this.setOutputMatrixTextureDriver(e,r,i)}setOutputMatrixWriteRegion(e,t,s,r){this.setOutputMatrixWriteRegionDriver(s,e,r,t)}setOutputPackedMatrixWriteRegion(e,t,s,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){this.program!=null&&N0(this.gl,this.program),op(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();const e=this.gl;if(this.debug){const t=this.getVertexArray();console.assert(t===this.program.vao,"VAO changed between setProgram and executeProgram!"),this.debugValidate()}Le(e,()=>e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),Le(this.gl,()=>this.gl.finish())}getQueryTimerExtension(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=ip(this.gl,me().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(me().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const s=this.gl,r=this.getQueryTimerExtensionWebGL2(),i=s.createQuery();return s.beginQuery(r.TIME_ELAPSED_EXT,i),i}const e=this.getQueryTimerExtensionWebGL1(),t=e.createQueryEXT();return e.beginQueryEXT(e.TIME_ELAPSED_EXT,t),t}endQuery(){if(me().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const t=this.gl,s=this.getQueryTimerExtensionWebGL2();t.endQuery(s.TIME_ELAPSED_EXT);return}const e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(e){return await CS(()=>this.disposed||this.isQueryAvailable(e,me().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))),this.getQueryTime(e,me().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(e,t){if(t===0)return null;if(t===2){const s=this.gl;return s.getQueryParameter(e,s.QUERY_RESULT)/1e6}else{const s=this.getQueryTimerExtensionWebGL1();return s.getQueryObjectEXT(e,s.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(e,t){if(t===0)return!0;if(t===2){const s=this.gl,r=this.getQueryTimerExtensionWebGL2(),i=s.getQueryParameter(e,s.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),i&&!this.disjoint}else{const s=this.getQueryTimerExtensionWebGL1(),r=s.getQueryObjectEXT(e,s.QUERY_RESULT_AVAILABLE_EXT);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(s.GPU_DISJOINT_EXT)),r&&!this.disjoint}}pollFence(e){return new Promise(t=>{this.addItemToPoll(()=>e.isFencePassed(),()=>t())})}pollItems(){const e=xJ(this.itemsToPoll.map(t=>t.isDoneFn));for(let t=0;t<=e;++t){const{resolveFn:s}=this.itemsToPoll[t];s()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}addItemToPoll(e,t){if(this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1)return;let s;"setTimeoutCustom"in me().platform&&(s=me().platform.setTimeoutCustom.bind(me().platform)),CS(()=>(this.pollItems(),this.itemsToPoll.length===0),()=>0,null,s)}bindTextureToFrameBuffer(e){this.throwIfDisposed(),I0(this.gl,e,this.framebuffer),this.debug&&op(this.gl)}unbindTextureToFrameBuffer(){this.outputTexture!=null?(I0(this.gl,this.outputTexture,this.framebuffer),this.debug&&op(this.gl)):_N(this.gl,this.framebuffer)}downloadMatrixDriver(e,t){this.bindTextureToFrameBuffer(e);const s=t();return this.unbindTextureToFrameBuffer(),s}setOutputMatrixTextureDriver(e,t,s){this.throwIfDisposed();const r=this.gl;I0(r,e,this.framebuffer),this.debug&&op(r),this.outputTexture=e,Le(r,()=>r.viewport(0,0,t,s)),Le(r,()=>r.scissor(0,0,t,s))}setOutputMatrixWriteRegionDriver(e,t,s,r){this.throwIfDisposed(),Le(this.gl,()=>this.gl.scissor(e,t,s,r))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(this.program==null)throw new Error("No GPU program is currently set.")}}function xJ(n){let e=0;for(;e<n.length&&n[e]();++e);return e-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{addImpl:yJ,bincountImpl:pP,bincountReduceImpl:vJ,bitwiseAndImpl:bJ,castImpl:wJ,ceilImpl:kJ,concatImpl:CJ,equalImpl:SJ,expImpl:NJ,expm1Impl:IJ,floorImpl:TJ,gatherNdImpl:$J,gatherV2Impl:EJ,greaterImpl:AJ,greaterEqualImpl:jJ,lessImpl:RJ,lessEqualImpl:DJ,linSpaceImpl:PJ,logImpl:MJ,maxImpl:LJ,maximumImpl:FJ,minimumImpl:OJ,multiplyImpl:_J,negImpl:zJ,notEqualImpl:BJ,prodImpl:WJ,raggedGatherImpl:VJ,raggedRangeImpl:UJ,raggedTensorToTensorImpl:GJ,rangeImpl:HJ,rsqrtImpl:qJ,scatterImpl:KJ,sigmoidImpl:QJ,simpleAbsImpl:mP,sliceImpl:XJ,sparseFillEmptyRowsImpl:YJ,sparseReshapeImpl:ZJ,sparseSegmentReductionImpl:gP,sqrtImpl:JJ,staticRegexReplaceImpl:eee,stridedSliceImpl:tee,stringNGramsImpl:nee,stringSplitImpl:see,stringToHashBucketFastImpl:ree,subImpl:iee,tileImpl:oee,topKImpl:aee,transposeImpl:Zw,uniqueImpl:lee}=d7;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xP(n,e){return["x","y","z","w","u","v"].slice(0,e).map(t=>`${n}.${t}`)}function vs(n,e){return e===1?[n]:xP(n,e)}function cee(n,e){if(n===1)return"rc";let t="";for(let s=0;s<n;s++)t+=e[s],s<n-1&&(t+=",");return t}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class uee{constructor(e){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.enableShapeUniforms=os(this.outputShape.length),this.rank===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{const t=vs("rc",this.rank),s=Pt(this.rank),r=this.getOutOfBoundsCondition(t),i=this.getSetup(t),o=this.getOutput(t);this.userCode=`
        void main() {
          ${s} rc = getOutputCoords();

          if(${r}) {
            setOutput(vec4(0));
          } else {
            ${i}

            setOutput(vec4(${o}));
          }
        }
      `}}getSourceCoordsArr(e){const t=[];for(let s=0;s<=1;s++)for(let r=0;r<=1;r++){let i=`${s===0?"r":"rp1"}, ${r===0?"c":"cp1"}`;for(let o=2;o<this.rank;o++)i=`${e[e.length-1-o]},`+i;t.push(i)}return t}getOutOfBoundsCondition(e){if(this.rank===1)return`rc > ${this.enableShapeUniforms?"outShape":this.outputShape[0]}`;let t="";for(let s=this.rank-2;s<this.rank;s++)t+=`${e[s]} >= ${this.enableShapeUniforms?`outShape[${s}]`:this.outputShape[s]}`,s<this.rank-1&&(t+="||");return t}getSetup(e){if(this.rank===1)return"";const t=e.slice(-2),s=this.enableShapeUniforms?`outShape[${this.rank} - 1]`:this.outputShape[this.rank-1],r=this.enableShapeUniforms?`outShape[${this.rank} - 2]`:this.outputShape[this.rank-2];return`
      int r = ${t[0]};
      int c = ${t[1]};
      int rp1 = r + 1;
      int cp1 = c + 1;

      bool cEdge = cp1 >= ${s};
      bool rEdge = rp1 >= ${r};
    `}getOutput(e){const t=this.getSourceCoordsArr(e);return this.rank===1?`getA(rc), (rc + 1 >= ${this.enableShapeUniforms?"outShape":this.outputShape[0]} ? 0. : getA(rc + 1)), 0, 0`:`getA(${t[0]}),
            cEdge ? 0. : getA(${t[1]}),
            rEdge ? 0. : getA(${t[2]}),
            rEdge || cEdge ? 0. : getA(${t[3]})`}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class yP{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=e,this.enableShapeUniforms=os(this.outputShape.length);let s="";for(let r=0;r<4;r++){let i="thisRC = rc;";r%2===1&&(i+="thisRC.z += 1;"),r>1&&(i+="thisRC.y += 1;"),s+=`
        ${i}
        ${r>0?"if(thisRC.y < rows && thisRC.z < cols){":""}
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[${r}] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        ${r>0?"}":""}
      `}this.userCode=`
      ${dee(t,this.enableShapeUniforms)}
      ${this.enableShapeUniforms?Xw():Qw(e)}

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = ${this.enableShapeUniforms?"outShape[1]":e[1]};
        int cols = ${this.enableShapeUniforms?"outShape[2]":e[2]};

        ${s}

        setOutput(result);
      }
    `}}function dee(n,e){return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      ${e?cZ(["r","c","d"],"inputShape"):al(["r","c","d"],n)}
      return ivec3(r, c, d);
    }
  `}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class hee{constructor(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.usedTextures={},this.logEnabled=!1}acquireTexture(e,t,s){const r=UN(t,s),i=GN(e,r,s);i in this.freeTextures||(this.freeTextures[i]=[]),i in this.usedTextures||(this.usedTextures[i]=[]);const o=VN(e,r,this.gpgpu.gl,this.gpgpu.textureConfig,s);if(this.freeTextures[i].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=o,this.log();const l=this.freeTextures[i].pop();return this.usedTextures[i].push(l),l}let a;return r===qn.PACKED_2X2_FLOAT32?a=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):r===qn.PACKED_2X2_FLOAT16?a=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):r===qn.UNPACKED_FLOAT32?a=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):r===qn.UNPACKED_FLOAT16?a=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):r===qn.PACKED_4X1_UNSIGNED_BYTE&&(a=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[i].push(a),this.numUsedTextures++,this._numBytesAllocated+=o,this.log(),a}releaseTexture(e,t,s,r){if(this.freeTextures==null)return;const i=UN(s,r),o=GN(t,i,r);o in this.freeTextures||(this.freeTextures[o]=[]);const a=VN(t,i,this.gpgpu.gl,this.gpgpu.textureConfig,r),l=me().getNumber("WEBGL_DELETE_TEXTURE_THRESHOLD");l!==-1&&this._numBytesAllocated>l?(this.gpgpu.deleteMatrixTexture(e.texture),this._numBytesAllocated-=a):(this.freeTextures[o].push(e),this.numFreeTextures++,this._numBytesFree+=a),this.numUsedTextures--;const u=this.usedTextures[o],d=u&&u.indexOf(e);if(d==null||d<0)throw new Error("Cannot release a texture that was never provided by this texture manager");u[d]=u[u.length-1],u.pop(),this.log()}log(){if(!this.logEnabled)return;const e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",`${this.numFreeTextures} / ${this.numUsedTextures}`,`(${e})`);const t=this._numBytesFree/this._numBytesAllocated;console.log(`Bytes allocated: ${this._numBytesAllocated}`),console.log(`Bytes unused: ${this._numBytesFree} (${Math.round(100*t)}%)`)}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(this.freeTextures!=null){for(const e in this.freeTextures)this.freeTextures[e].forEach(t=>{this.gpgpu.deleteMatrixTexture(t.texture)});for(const e in this.usedTextures)this.usedTextures[e].forEach(t=>{this.gpgpu.deleteMatrixTexture(t.texture)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}function fee(n,e){const t=n;if(e===t.R32F)return 4;if(e===t.R16F)return 2;if(e===t.RGBA32F)return 16;if(e===n.RGBA)return 16;if(e===t.RGBA16F)return 8;if(e===t.RGBA8)return 4;throw new Error(`Unknown internal format ${e}`)}function VN(n,e,t,s,r){const i=pee(e,s);let o;if(r){const[l,u]=Dc(n[0],n[1]);o=l*u}else{const[l,u]=jh(n[0],n[1]);o=l*u}const a=fee(t,i);return o*a}function pee(n,e){switch(n){case qn.PACKED_2X2_FLOAT32:return hP(e);case qn.PACKED_2X2_FLOAT16:return fP(e);case qn.UNPACKED_FLOAT32:return cP(e);case qn.UNPACKED_FLOAT16:return uP(e);case qn.PACKED_4X1_UNSIGNED_BYTE:return dP(e);default:throw new Error(`Unknown physical texture type ${n}`)}}function mee(n){return me().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?n?qn.PACKED_2X2_FLOAT32:qn.UNPACKED_FLOAT32:n?qn.PACKED_2X2_FLOAT16:qn.UNPACKED_FLOAT16}function UN(n,e){if(n===ir.UPLOAD)return qn.PACKED_2X2_FLOAT32;if(n===ir.RENDER||n==null)return mee(e);if(n===ir.DOWNLOAD||n===ir.PIXELS)return qn.PACKED_4X1_UNSIGNED_BYTE;throw new Error(`Unknown logical texture type ${n}`)}function GN(n,e,t){return`${n[0]}_${n[1]}_${e}_${t}`}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class vi{constructor(e,t){this.variableNames=["A"],this.outputShape=e,this.enableShapeUniforms=os(this.outputShape.length),this.userCode=`
      float unaryOperation(float x) {
        ${t}
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `}}const Rr="if (isnan(x)) return x;",gee="return x;",HN="return abs(x);",xee="return (x >= 0.0) ? x : (exp(x) - 1.0);",yee=Rr+`
  return (x < 0.0) ? 0.0 : x;
`,vee=Rr+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,Po="return x;",bee="return 1.0 / (1.0 + exp(-1.0 * x));";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wee="return x;",kee=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,Cee=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,See=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Nee="return 1.0 / (1.0 + exp(-1.0 * x));";class Fo{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.enableShapeUniforms=os(this.outputShape.length),this.userCode=`
      vec4 unaryOperation(vec4 x) {
        ${t}
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Iee{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e,this.enableShapeUniforms=os(this.outputShape.length);const t=e.length,s=vs("rc",t),r=Pt(t),i=cee(t,s),o=s.slice(-2),a=t<=1?"rc":`vec2(${o.join(",")})`;this.userCode=`
      void main() {
        ${r} rc = getOutputCoords();
        vec4 packedInput = getA(${i});

        setOutput(getChannel(packedInput, ${a}));
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tee=BE,$ee=1e-7,Eee=1e-4,cp={};function Aee(n){return n in cp||(cp[n]={}),cp[n]}const jee=me().getNumber("CPU_HANDOFF_SIZE_THRESHOLD"),Ree=600;function Dee(){return me().global.screen==null?1024:me().global.screen.height*me().global.screen.width*window.devicePixelRatio*Ree/1024/1024}class ux extends vb{nextDataId(){return ux.nextDataId++}constructor(e){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!me().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");let t;if(e!=null){if(e instanceof E0)t=e;else{const s=ri(me().getNumber("WEBGL_VERSION"),e);t=new E0(s)}this.binaryCache={},this.gpgpuCreatedLocally=!1}else{const s=ri(me().getNumber("WEBGL_VERSION"));t=new E0(s),this.binaryCache=Aee(me().getNumber("WEBGL_VERSION")),this.gpgpuCreatedLocally=!0}this.gpgpu=t,this.canvas=this.gpgpu.gl.canvas,this.textureManager=new hee(this.gpgpu),this.numMBBeforeWarning=Dee(),this.texData=new f$(this,pi())}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}writeTexture(e,t,s,r,i,o){const a=this.makeTensorInfo(t,s),l=this.texData.get(a.dataId);l.isPacked=!1,l.texture={texture:e,texShape:[r,i]},l.texShape=[r,i];const u=ap(t),d=new WN(u,!1,o),f=this.runWebGLProgram(d,[a],s,[[r,i]]);return f.shape=t,l.texture=null,this.disposeIntermediateTensorInfo(a),f.dataId}write(e,t,s){if((me().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||me().getBool("DEBUG"))&&this.checkNumericalProblems(e),s==="complex64"&&e!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");const r={id:this.nextDataId()};return this.texData.set(r,{shape:t,dtype:s,values:e,usage:ir.UPLOAD,refCount:1}),r}refCount(e){return this.texData.has(e)?this.texData.get(e).refCount:0}incRef(e){const t=this.texData.get(e);t.refCount++}decRef(e){if(this.texData.has(e)){const t=this.texData.get(e);t.refCount--}}move(e,t,s,r,i){if(me().getBool("DEBUG")&&this.checkNumericalProblems(t),r==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:s,dtype:r,values:t,usage:ir.UPLOAD,refCount:i})}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}readSync(e){const t=this.texData.get(e),{values:s,dtype:r,complexTensorInfos:i,slice:o,shape:a,isPacked:l}=t;if(o!=null){let p;l?p=new Fo(a,Po):p=new vi(a,Po);const g=this.runWebGLProgram(p,[{dataId:e,shape:a,dtype:r}],r),x=this.readSync(g.dataId);return this.disposeIntermediateTensorInfo(g),x}if(s!=null)return this.convertAndCacheOnCPU(e);if(r==="string")return s;const u=this.activeTimers!=null;let d;u&&(d=$s());let f;if(r==="complex64"){const p=this.readSync(i.real.dataId),g=this.readSync(i.imag.dataId);f=so(p,g)}else f=this.getValuesFromTexture(e);return u&&(this.downloadWaitMs+=$s()-d),this.convertAndCacheOnCPU(e,f)}async read(e){if(this.pendingRead.has(e)){const x=this.pendingRead.get(e);return new Promise(y=>x.push(y))}const t=this.texData.get(e),{values:s,shape:r,slice:i,dtype:o,complexTensorInfos:a,isPacked:l}=t;if(i!=null){let x;l?x=new Fo(r,Po):x=new vi(r,Po);const y=this.runWebGLProgram(x,[{dataId:e,shape:r,dtype:o}],o),b=this.read(y.dataId);return this.disposeIntermediateTensorInfo(y),b}if(s!=null)return this.convertAndCacheOnCPU(e);if(me().getBool("DEBUG")&&!me().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&me().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let u=null,d;if(o!=="complex64"&&me().get("WEBGL_BUFFER_SUPPORTED")){d=this.decode(e);const x=this.texData.get(d.dataId);u=this.gpgpu.createBufferFromTexture(x.texture.texture,...rp(r))}this.pendingRead.set(e,[]),o!=="complex64"&&await this.gpgpu.createAndWaitForFence();let f;if(o==="complex64"){const x=await Promise.all([this.read(a.real.dataId),this.read(a.imag.dataId)]),y=x[0],b=x[1];f=so(y,b)}else if(u==null)f=this.getValuesFromTexture(e);else{const x=be(r);f=this.gpgpu.downloadFloat32MatrixFromBuffer(u,x)}if(d!=null&&this.disposeIntermediateTensorInfo(d),u!=null){const x=this.gpgpu.gl;Le(x,()=>x.deleteBuffer(u))}const p=this.convertAndCacheOnCPU(e,f),g=this.pendingRead.get(e);return this.pendingRead.delete(e),g.forEach(x=>x(p)),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e)&&pi().removeDataId(e,this),this.pendingDeletes--),p}readToGPU(e,t={}){const s=this.texData.get(e),{values:r,shape:i,slice:o,dtype:a,isPacked:l,texture:u}=s;if(a==="complex64")throw new Error("Does not support reading texture for complex64 dtype.");if(o!=null){let g;l?g=new Fo(i,Po):g=new vi(i,Po);const x=this.runWebGLProgram(g,[{dataId:e,shape:i,dtype:a}],a),y=this.readToGPU(x,t);return this.disposeIntermediateTensorInfo(x),y}if(u==null)throw r!=null?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");const d=this.decode(e,t.customTexShape),f=pi().makeTensorFromTensorInfo(d),p=this.texData.get(d.dataId);return Object.assign({tensorRef:f},p.texture)}bufferSync(e){const t=this.readSync(e.dataId);if(e.dtype==="string")try{const s=t.map(r=>Uo(r));return dt(e.shape,e.dtype,s)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return dt(e.shape,e.dtype,t)}checkNumericalProblems(e){if(e!=null)for(let t=0;t<e.length;t++){const s=e[t];if(!LY(s))throw me().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error(`The value ${s} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`):Error(`The value ${s} cannot be represented on this device.`)}}getValuesFromTexture(e){const{shape:t,dtype:s,isPacked:r}=this.texData.get(e),i=be(t);if(me().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){const p=this.decode(e),g=this.texData.get(p.dataId),x=this.gpgpu.downloadMatrixFromPackedTexture(g.texture.texture,...rp(t)).subarray(0,i);return this.disposeIntermediateTensorInfo(p),x}const o=me().getBool("WEBGL_PACK")&&r===!0,a=o?ap(t):t,l=o?new ZZ(a):new YZ(a),u=this.runWebGLProgram(l,[{shape:a,dtype:s,dataId:e}],"float32"),d=this.texData.get(u.dataId),f=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(d.texture.texture,d.texShape[0],d.texShape[1]).subarray(0,i);return this.disposeIntermediateTensorInfo(u),f}timerAvailable(){return me().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}time(e){const t=this.activeTimers,s=[];let r=!1;this.programTimersStack==null?(this.programTimersStack=s,r=!0):this.activeTimers.push(s),this.activeTimers=s,e();const i=za(this.activeTimers.map(l=>l.query)).filter(l=>l!=null),o=za(this.activeTimers.map(l=>l.name)).filter(l=>l!=null);this.activeTimers=t,r&&(this.programTimersStack=null);const a={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return(async()=>{if(me().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){const l=await Promise.all(i);a.kernelMs=qO(l),a.getExtraProfileInfo=()=>l.map((u,d)=>({name:o[d],ms:u})).map(u=>`${u.name}: ${u.ms}`).join(", ")}else a.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,a})()}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return me().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:$s(),endMs:null}}endTimer(e){return me().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=$s(),e)}async getQueryTime(e){if(me().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(e);const t=e;return t.endMs-t.startMs}disposeData(e,t=!1){if(this.pendingDisposal.has(e))return!1;if(!this.texData.has(e))return!0;if(t?this.texData.get(e).refCount=0:this.texData.get(e).refCount--,!t&&this.texData.get(e).refCount>0)return!1;if(this.pendingRead.has(e))return this.pendingDisposal.add(e),this.pendingDeletes++,!1;this.releaseGPUData(e);const{complexTensorInfos:s}=this.texData.get(e);return s!=null&&(this.disposeData(s.real.dataId,t),this.disposeData(s.imag.dataId,t)),this.texData.delete(e),!0}releaseGPUData(e){const{texture:t,dtype:s,texShape:r,usage:i,isPacked:o,slice:a}=this.texData.get(e),l=a&&a.origDataId||e,u=this.dataRefCount.get(l);u>1?this.dataRefCount.set(l,u-1):(this.dataRefCount.delete(l),t!=null&&(this.numBytesInGPU-=this.computeBytes(r,s),this.textureManager.releaseTexture(t,r,i,o)));const d=this.texData.get(e);d.texture=null,d.texShape=null,d.isPacked=!1,d.slice=null}getTexture(e){return this.uploadToGPU(e),this.texData.get(e).texture.texture}getDataInfo(e){return this.texData.get(e)}shouldExecuteOnCPU(e,t=jee){return me().getBool("WEBGL_CPU_FORWARD")&&e.every(s=>this.texData.get(s.dataId).texture==null&&be(s.shape)<t)}getGPGPUContext(){return this.gpgpu}where(e){rr("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");const t=e.dataSync();return Tee(e.shape,t)}packedUnaryOp(e,t,s){const r=new Fo(e.shape,t),i=this.compileAndRun(r,[e],s);return pi().makeTensorFromTensorInfo(i)}abs(e){if(this.shouldExecuteOnCPU([e])&&e.dtype!=="complex64"){const r=mP(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,r)}if(me().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,HN,e.dtype);const t=new vi(e.shape,HN),s=this.compileAndRun(t,[e]);return pi().makeTensorFromTensorInfo(s)}makeTensorInfo(e,t,s){let r;if(t==="string"&&s!=null&&s.length>0&&yd(s[0])){const i=s.map(o=>zo(o));r=this.write(i,e,t)}else r=this.write(s,e,t);return this.texData.get(r).usage=null,{dataId:r,shape:e,dtype:t}}makeOutput(e,t,s){return pi().makeTensorFromTensorInfo(this.makeTensorInfo(e,t,s),this)}unpackTensor(e){const t=new Iee(e.shape);return this.runWebGLProgram(t,[e],e.dtype)}packTensor(e){const t=new uee(e.shape);return this.runWebGLProgram(t,[e],e.dtype,null,!0)}packedReshape(e,t){const s=[gc(e.shape),...xc(e.shape)],r={dtype:e.dtype,shape:s,dataId:e.dataId},i=[gc(t),...xc(t)],o=new yP(i,s),a=!0,l=[s],u=this.runWebGLProgram(o,[r],e.dtype,l,a);return{dataId:u.dataId,shape:t,dtype:u.dtype}}decode(e,t){const s=this.texData.get(e),{isPacked:r,shape:i,dtype:o}=s;if(t!=null){const p=be(i),g=t[0]*t[1]*4;V(p<=g,()=>"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data.")}const a=ap(i);let l;r?l=new XZ(a):l=new QZ(a);const u=!0,d=[t??rp(a)],f=this.runWebGLProgram(l,[{shape:a,dtype:o,dataId:e}],o,d,u,t);return{dtype:o,shape:i,dataId:f.dataId}}runWebGLProgram(e,t,s,r,i=!1,o){const a=this.makeTensorInfo(e.outputShape,s),l=this.texData.get(a.dataId);if(e.packedOutput&&(l.isPacked=!0),e.outPackingScheme===id.DENSE){const k=o??rp(e.outputShape);l.texShape=k.map(w=>w*2)}if(e.outTexUsage!=null&&(l.usage=e.outTexUsage),be(a.shape)===0)return l.values=ts(a.dtype,0),a;const u=[],d=t.map(k=>{if(k.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let w=this.texData.get(k.dataId);if(w.texture==null){if(!e.packedInputs&&be(k.shape)<=me().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:k.shape,texData:null,isUniform:!0,uniformValues:w.values};e.packedInputs&&(w.isPacked=!0,w.shape=k.shape)}if(this.uploadToGPU(k.dataId),!!w.isPacked!=!!e.packedInputs)k=w.isPacked?this.unpackTensor(k):this.packTensor(k),u.push(k),w=this.texData.get(k.dataId);else if(w.isPacked&&!gm(w.shape,k.shape)){const N=k,C=k.shape;k.shape=w.shape,k=this.packedReshape(k,C),u.push(k),w=this.texData.get(k.dataId),N.shape=C}return{shape:k.shape,texData:w,isUniform:!1}});this.uploadToGPU(a.dataId);const f={shape:a.shape,texData:l,isUniform:!1},p=KZ(e,d,f),g=this.getAndSaveBinary(p,()=>HZ(this.gpgpu,e,d,f)),x=this.activeTimers!=null;let y;x&&(y=this.startTimer()),me().get("ENGINE_COMPILE_ONLY")||qZ(this.gpgpu,g,d,f,r),u.forEach(k=>this.disposeIntermediateTensorInfo(k)),x&&(y=this.endTimer(y),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(y)}));const b=me().getNumber("WEBGL_FLUSH_THRESHOLD");if(b>0){const k=$s();k-this.lastGlFlushTime>b&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=k)}if(!me().getBool("WEBGL_LAZILY_UNPACK")&&l.isPacked&&i===!1){const k=this.unpackTensor(a);return this.disposeIntermediateTensorInfo(a),k}return a}compileAndRun(e,t,s,r,i=!1){return s=s||t[0].dtype,this.runWebGLProgram(e,t,s,r,i)}getAndSaveBinary(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]}getTextureManager(){return this.textureManager}dispose(){this.disposed||(me().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(t=>{this.gpgpu.deleteProgram(this.binaryCache[t].webGLProgram),delete this.binaryCache[t]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}floatPrecision(){return this.floatPrecisionValue==null&&(this.floatPrecisionValue=de(()=>{if(!me().get("WEBGL_RENDER_FLOAT32_ENABLED")){const e=me().getBool("DEBUG");me().set("DEBUG",!1);const t=this.abs($t(1e-8)).dataSync()[0];if(me().set("DEBUG",e),t>0)return 32}return 16})),this.floatPrecisionValue}epsilon(){return this.floatPrecision()===32?$ee:Eee}uploadToGPU(e){const t=this.texData.get(e),{shape:s,dtype:r,values:i,texture:o,usage:a,isPacked:l}=t;if(o!=null)return;const u=this.activeTimers!=null;let d;u&&(d=$s());let f=t.texShape;if(f==null&&(f=eZ(s,l),t.texShape=f),i!=null){const p=ap(s);let g,x=f[1],y=f[0];const b=i instanceof Uint8Array||i instanceof Uint8ClampedArray;(l||!b)&&([x,y]=Dc(f[0],f[1])),l?g=new eJ(p,b):g=new WN(p,b);const k=b?[y,x]:f,w=this.makeTensorInfo(k,r),N=this.texData.get(w.dataId);b?N.usage=ir.PIXELS:N.usage=ir.UPLOAD,N.texShape=k,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(w.dataId),x,y,i);const C=[[y,x]],T=this.runWebGLProgram(g,[w],r,C,!0),A=this.texData.get(T.dataId);t.texShape=A.texShape,t.isPacked=A.isPacked,t.usage=A.usage,me().get("ENGINE_COMPILE_ONLY")?this.disposeData(T.dataId):(t.texture=A.texture,t.values=null,this.texData.delete(T.dataId)),this.disposeIntermediateTensorInfo(w),u&&(this.uploadWaitMs+=$s()-d)}else{const p=this.acquireTexture(f,a,r,l);t.texture=p}}convertAndCacheOnCPU(e,t){const s=this.texData.get(e),{dtype:r}=s;return t!=null&&(s.values=Pee(t,r)),s.values}acquireTexture(e,t,s,r){if(this.numBytesInGPU+=this.computeBytes(e,s),!this.warnedAboutMemory&&this.numBytesInGPU>this.numMBBeforeWarning*1024*1024){const i=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${i} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(e,t,r)}computeBytes(e,t){return e[0]*e[1]*Up(t)}checkCompileCompletion(){for(const[,e]of Object.entries(this.binaryCache))this.checkCompletion_(e)}async checkCompileCompletionAsync(){const e=[];if(this.gpgpu.parallelCompilationExtension){for(const[,t]of Object.entries(this.binaryCache))e.push(this.checkCompletionAsync_(t));return Promise.all(e)}else{for(const[,t]of Object.entries(this.binaryCache)){const s=new Promise(r=>{try{this.checkCompletion_(t),r(!0)}catch(i){throw i}});e.push(s)}return Promise.all(e)}}async checkCompletionAsync_(e){return this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?this.checkCompletion_(e):(await oA(),this.checkCompletionAsync_(e))}checkCompletion_(e){if(this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.gl.LINK_STATUS)===!1)throw console.log(this.gpgpu.gl.getProgramInfoLog(e.webGLProgram)),this.gpgpu.gl.getShaderParameter(e.fragmentShader,this.gpgpu.gl.COMPILE_STATUS)===!1?(sP(e.source,this.gpgpu.gl.getShaderInfoLog(e.fragmentShader)),new Error("Failed to compile fragment shader.")):new Error("Failed to link vertex and fragment shaders.");return!0}getUniformLocations(){for(const e of Object.values(this.binaryCache)){this.gpgpu.buildVao(e.webGLProgram);const{variablesLocations:t,customUniformLocations:s,infLoc:r,nanLoc:i,outShapeLocation:o,outShapeStridesLocation:a,outTexShapeLocation:l}=lP(this.gpgpu,e.program,e.webGLProgram);e.variablesLocations=t,e.customUniformLocations=s,e.infLoc=r,e.nanLoc=i,e.outShapeLocation=o,e.outShapeStridesLocation=a,e.outTexShapeLocation=l}}createTensorFromGPUData(e,t,s){e.channels=e.channels||"RGBA";const{texture:r,height:i,width:o,channels:a}=e,l=pi().backend;if(!l.gpgpu.gl.isTexture(r))throw new Error("The texture is invalid. Also, please make sure the texture and the TFJS WebGL backend are using the same canvas. If you want to use your own custom canvas, you have to create and use the custom TFJS WebGL backend created from the canvas through 'new tf.MathBackendWebGL(customCanvas)'.");const u=l.writeTexture(r,t,s,i,o,a);return pi().makeTensorFromDataId(u,t,s,l)}}ux.nextDataId=0;function Pee(n,e){if(e==="float32"||e==="complex64")return n;if(e==="int32"||e==="bool"){const t=e==="int32"?new Int32Array(n.length):new Uint8Array(n.length);for(let s=0;s<t.length;++s)t[s]=Math.round(n[s]);return t}else throw new Error(`Unknown dtype ${e}`)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nE()&&iE("webgl",()=>new ux,2);/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jw=`
  if (isnan(a)) return a;
  if (isnan(b)) return b;
`;class Ja{constructor(e,t,s){this.variableNames=["A","B"],this.outputShape=ot(t,s),this.enableShapeUniforms=os(this.outputShape.length),this.userCode=`
      float binaryOperation(float a, float b) {
        ${e}
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cl=`
  result.r = isNaN.r ? NAN : result.r;
  result.g = isNaN.g ? NAN : result.g;
  result.b = isNaN.b ? NAN : result.b;
  result.a = isNaN.a ? NAN : result.a;
`;class Oc{constructor(e,t,s,r=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=ot(t,s);const i=this.outputShape.length;this.enableShapeUniforms=os(i);let o="";if(r)if(i===0||be(this.outputShape)===1)o=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(o=`
          ${Pt(i)} coords = getOutputCoords();
        `,i===1)this.enableShapeUniforms?o+=`
            result.y = (coords + 1) >= outShape ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `:o+=`
            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{const l=vs("coords",i);this.enableShapeUniforms?o+=`
            bool nextRowOutOfBounds =
              (${l[i-2]} + 1) >= outShape[${i} - 2];
            bool nextColOutOfBounds =
              (${l[i-1]} + 1) >= outShape[${i} - 1];
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `:o+=`
            bool nextRowOutOfBounds =
              (${l[i-2]} + 1) >= ${this.outputShape[i-2]};
            bool nextColOutOfBounds =
              (${l[i-1]} + 1) >= ${this.outputShape[i-1]};
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        ${e}
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        ${o}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xs(n){const{inputs:e,backend:t}=n,{x:s}=e;return t.incRef(s.dataId),{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}const Mee={kernelName:_d,backendName:"webgl",kernelFunc:Xs};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oa(n){const{inputs:e,backend:t}=n,{real:s,imag:r}=e,i=t.makeTensorInfo(s.shape,"complex64"),o=t.texData.get(i.dataId),a=Xs({inputs:{x:s},backend:t}),l=Xs({inputs:{x:r},backend:t});return o.complexTensorInfos={real:a,imag:l},i}const Lee={kernelName:Rb,backendName:"webgl",kernelFunc:oa};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vP="return (a < 0.) ? b * a : a;",bP=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function Fee(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{alpha:i}=s,o=t.makeTensorInfo([],"float32",Yo(i,"float32")),a=me().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Oc(bP,r.shape,o.shape):new Ja(vP,r.shape,o.shape),l=t.runWebGLProgram(a,[r,o],"float32");return t.disposeIntermediateTensorInfo(o),l}const Oee={kernelName:sg,backendName:"webgl",kernelFunc:Fee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wP="return (a < 0.) ? b * a : a;",kP=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function _ee(n){const{inputs:e,backend:t}=n,{x:s,alpha:r}=e,i=me().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Oc(kP,s.shape,r.shape):new Ja(wP,s.shape,r.shape);return t.runWebGLProgram(i,[s,r],"float32")}const zee={kernelName:kg,backendName:"webgl",kernelFunc:_ee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _c="if (isnan(x)) return x;";function kt({opSnippet:n,packedOpSnippet:e,cpuKernelImpl:t,dtype:s}){return({inputs:r,backend:i})=>{const{x:o}=r,a=i,l=s||o.dtype;if(a.shouldExecuteOnCPU([o])&&t!=null){const f=a.texData.get(o.dataId),p=t(f.values,l);return a.makeTensorInfo(o.shape,l,p)}const u=me().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&e!=null;let d;return u?d=new Fo(o.shape,e):d=new vi(o.shape,n),a.runWebGLProgram(d,[o],l)}}function Yn({opSnippet:n,packedOpSnippet:e,checkOutOfBounds:t=!1,supportsComplex:s=!1,cpuKernelImpl:r,dtype:i}){return({inputs:o,backend:a})=>{const{a:l,b:u}=o,d=a;if(s&&l.dtype==="complex64"){const x=d.texData.get(l.dataId),y=d.texData.get(u.dataId),[b,k]=[[x.complexTensorInfos.real,y.complexTensorInfos.real],[x.complexTensorInfos.imag,y.complexTensorInfos.imag]].map(N=>{const[C,S]=N,T={dataId:C.dataId,dtype:C.dtype,shape:l.shape},A={dataId:S.dataId,dtype:S.dtype,shape:u.shape},E=new Ja(n,l.shape,u.shape);return d.runWebGLProgram(E,[T,A],Ks(C.dtype,S.dtype))}),w=oa({inputs:{real:b,imag:k},backend:d});return d.disposeIntermediateTensorInfo(b),d.disposeIntermediateTensorInfo(k),w}const f=i||Ks(l.dtype,u.dtype);if((l.dtype==="string"||u.dtype==="string"||d.shouldExecuteOnCPU([l,u]))&&r!=null){const x=d.texData.get(l.dataId).values,y=d.texData.get(u.dataId).values,b=l.dtype==="string"?ro(x):x,k=l.dtype==="string"?ro(y):y,[w,N]=r(l.shape,u.shape,b,k,f),C=d.makeTensorInfo(N,f),S=d.texData.get(C.dataId);return S.values=w,C}const p=me().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&e!=null;let g;return p?g=new Oc(e,l.shape,u.shape,t):g=new Ja(n,l.shape,u.shape),d.runWebGLProgram(g,[l,u],f)}}function od(n,e=!1){if(n==="linear")return e?wee:gee;if(n==="relu")return e?Cee:yee;if(n==="elu")return e?kee:xee;if(n==="relu6")return e?See:vee;if(n==="prelu")return e?kP:wP;if(n==="leakyrelu")return e?bP:vP;if(n==="sigmoid")return e?Nee:bee;throw new Error(`Activation ${n} has not been implemented for the WebGL backend.`)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class CP{constructor(e,t,s,r=!1,i=!1,o=!1,a=null,l=!1,u=!1){this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=s,this.enableShapeUniforms=os(this.outputShape.length);const d=r?e[1]:e[2],f=Math.ceil(d/2),p=r?"i * 2, rc.y":"rc.y, i * 2",g=i?"rc.z, i * 2":"i * 2, rc.z",x=r?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],y=i?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"];let b="",k="";a&&(l?b=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${a}
        }`:u?b=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${a}
        }`:b=`vec4 activation(vec4 x) {
          ${a}
        }`,k="result = activation(result);");const w=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),l&&this.variableNames.push("preluActivationWeights"),u&&this.variableNames.push("leakyreluAlpha");let N="rc.x",C="rc.x";e[0]<t[0]?N=`imod(rc.x, ${e[0]})`:t[0]<e[0]&&(C=`imod(rc.x, ${t[0]})`),this.userCode=`
      ${b}
      // Don't use uniform for sharedDimensionPacked for performance.
      const float sharedDimension = ${f}.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        int batchA = ${N};
        int batchB = ${C};
        for (int i = 0; i < ${f}; i++) {
          vec4 a = getMatrixA(batchA, ${p});
          vec4 b = getMatrixB(batchB, ${g});

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (${x[0]} * ${y[0]});
          result += (${x[1]} * ${y[1]});
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        ${w}

        ${k}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qN={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"};class KN{constructor(e,t,s){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=ot(t,s),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        ${e}
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QN="return a * b;";function ek(n){const{inputs:e,backend:t}=n,{a:s,b:r}=e,i=Ks(s.dtype,r.dtype);if(s.dtype==="complex64"){const a=t.texData.get(s.dataId),l=t.texData.get(r.dataId),u=new KN(qN.REAL,s.shape,r.shape),d=new KN(qN.IMAG,s.shape,r.shape),f=[{dataId:a.complexTensorInfos.real.dataId,dtype:a.complexTensorInfos.real.dtype,shape:s.shape},{dataId:a.complexTensorInfos.imag.dataId,dtype:a.complexTensorInfos.imag.dtype,shape:s.shape},{dataId:l.complexTensorInfos.real.dataId,dtype:l.complexTensorInfos.real.dtype,shape:r.shape},{dataId:l.complexTensorInfos.imag.dataId,dtype:l.complexTensorInfos.imag.dtype,shape:r.shape}],p=t.runWebGLProgram(u,f,"float32"),g=t.runWebGLProgram(d,f,"float32"),x=oa({inputs:{real:p,imag:g},backend:t});return t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(g),x}if(t.shouldExecuteOnCPU([s,r])){const a=t.texData.get(s.dataId),l=t.texData.get(r.dataId),[u,d]=_J(s.shape,r.shape,a.values,l.values,i),f=t.makeTensorInfo(d,i),p=t.texData.get(f.dataId);return p.values=u,f}let o;return me().getBool("WEBGL_PACK_BINARY_OPERATIONS")?o=new Oc(QN,s.shape,r.shape):o=new Ja(QN,s.shape,r.shape),t.runWebGLProgram(o,[s,r],i)}const Bee={kernelName:Kd,backendName:"webgl",kernelFunc:ek};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wee(n,e,t){const s=[gc(n.shape),...xc(n.shape)],r={dtype:n.dtype,shape:s,dataId:n.dataId},i=[gc(e),...xc(e)],o=new yP(i,s),a=!0,l=[s],u=t.runWebGLProgram(o,[r],n.dtype,l,a);return{dataId:u.dataId,shape:e,dtype:u.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Me(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{shape:i}=s,o=t,a=be(r.shape),l=m$(i,a),u=be(l);V(a===u,()=>`The new shape (${l}) has ${u} elements and the old shape (${r.shape}) has ${a} elements. The new shape and old shape must have the same number of elements.`);const d=o.texData.get(r.dataId);return d.isPacked&&!gm(r.shape,l)&&!(d.texture!==null&&gm(d.shape,l))?Wee(r,l,o):(o.incRef(r.dataId),{dataId:r.dataId,shape:l,dtype:r.dtype})}const Vee={kernelName:Sg,backendName:"webgl",kernelFunc:Me};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class XN{constructor(e,t){this.variableNames=["x"];const{windowSize:s,batchSize:r,inSize:i,outSize:o}=e;this.outputShape=[r,o];const a=Math.floor(s/4)*4,l=s%4;let u="sumValue += dot(values, ones);";if(t!=null){const f=1/t;u=`sumValue += dot(values * ${oc(f)?f.toPrecision(2):f}, ones);`}let d="";i%s>0&&(d=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return 0.0;
        }
      `),this.userCode=`
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${d}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${s};

        float sumValue = 0.0;

        for (int i = 0; i < ${a}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${u}
        }

        int inIdx = inOffset + ${a};
        if (${l===1}) {
          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);

          ${u}
        } else if (${l===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1), 0.0, 0.0);

          ${u}
        } else if (${l===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2), 0.0);

          ${u}
        }
        setOutput(sumValue);
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Uee{constructor(e,t){this.variableNames=["x"];const{windowSize:s,batchSize:r,inSize:i,outSize:o}=e;this.outputShape=[r,o];let a="0.0",l="";t==="prod"?a="1.0":t==="min"?(a="1.0 / 1e-20",l="min"):t==="max"&&(a="-1.0 / 1e-20",l="max");let u=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;t==="sum"?u="sumValue":t==="prod"?u="prodValue":t==="all"?u="allValue":t==="any"&&(u="anyValue");const d=Math.floor(s/4)*4,f=s%4;let p=`
      if (${t==="sum"}) {
        sumValue += dot(values, ones);
      } else if (${t==="prod"}) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = ${l}(values, minMaxValue);
        if (${t==="min"} || ${t==="max"}) {
          minMaxValue = ${l}(values, minMaxValue);
          bvec4 isNaN = isnan(values);
          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {
            minMaxValue = vec4(NAN);
          }
        }
      }
    `,g="vec4";t==="all"?(a="1.0",p=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,g="bvec4"):t==="any"&&(a="0.0",p=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,g="bvec4");let x="";i%s>0&&(x=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = ${a};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${x}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${s};

        vec4 minMaxValue = vec4(${a});
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < ${d}; i += 4) {
          int inIdx = inOffset + i;
          ${g} values = ${g}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${p}
        }

        int inIdx = inOffset + ${d};
        if (${f===1}) {
          ${g} values = ${g}(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          ${p}
        } else if (${f===2}) {
          ${g} values = ${g}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          ${p}
        } else if (${f===3}) {
          ${g} values = ${g}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          ${p}
        }
        setOutput(${u});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gee(n){const e=[];for(;e.length===0||e[e.length-1].outSize!==1;){const t=e.length?e[e.length-1].outSize:n[1],s=qg(t);e.push({inSize:t,windowSize:s,outSize:Math.ceil(t/s)})}return e}function ul(n,e,t,s){const r=Gee(n.shape);let i=n;for(let o=0;o<r.length;o++){const{inSize:a,windowSize:l,outSize:u}=r[o];let d,f;t==="mean"?d=o===0?new XN({windowSize:l,inSize:a,batchSize:n.shape[0],outSize:u},a):new XN({windowSize:l,inSize:a,batchSize:n.shape[0],outSize:u}):d=new Uee({windowSize:l,inSize:a,batchSize:n.shape[0],outSize:u},t),f=i,i=s.runWebGLProgram(d,[i],e),f.dataId!==n.dataId&&s.disposeIntermediateTensorInfo(f)}return i}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Hee{constructor(e,t){this.variableNames=["A"];const s=new Array(e.length);for(let o=0;o<s.length;o++)s[o]=e[t[o]];this.outputShape=s,this.rank=s.length;const r=Pt(this.rank),i=qee(t);this.userCode=`
    void main() {
      ${r} resRC = getOutputCoords();
      setOutput(getA(${i}));
    }
    `}}function qee(n){const e=n.length;if(e>6)throw Error(`Transpose for rank ${e} is not yet supported`);const t=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],s=new Array(e);for(let r=0;r<n.length;r++)s[n[r]]=t[r];return s.join()}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Kee{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;const s=new Array(e.length);for(let d=0;d<s.length;d++)s[d]=e[t[d]];if(this.outputShape=s,this.rank=s.length,this.rank>6)throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);const r=Pt(this.rank),i=xP("rc",this.rank),o=new Array(this.rank);for(let d=0;d<t.length;d++)o[t[d]]=i[d];const a=`vec2(${o.slice(-2).join()})`,l=`++${i[this.rank-1]} < ${s[this.rank-1]}`,u=`getChannel(getA(${o.join()}), ${a})`;this.userCode=`
    void main() {
      ${r} rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = ${u};
      if(${l}) {
        result[1] = ${u};
      }
      --${i[this.rank-1]};
      if(++${i[this.rank-2]} < ${s[this.rank-2]}) {
        result[2] = ${u};
        if(${l}) {
          result[3] = ${u};
        }
      }
      setOutput(result);
    }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dx(n,e,t){const s=me().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Kee(n.shape,e):new Hee(n.shape,e);return t.runWebGLProgram(s,[n],n.dtype)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qee(n,e,t,s){const r=e,i=n.shape.length,o=ht(r,n.shape);let a=o;const l=tn(a,i),u=l!=null;let d=n;u&&(d=dx(n,l,s),a=mn(a.length,i)),Xn("sum",a,i);const[f,p]=zn(d.shape,a);let g=f;t&&(g=kn(f,o));const x=be(p),b=be(n.shape)/x,k=Me({inputs:{x:d},attrs:{shape:[b,x]},backend:s}),w=h1(n.dtype),N=ul(k,w,"sum",s),C=Me({inputs:{x:N},attrs:{shape:g},backend:s});return s.disposeIntermediateTensorInfo(k),s.disposeIntermediateTensorInfo(N),u&&s.disposeIntermediateTensorInfo(d),C}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hx(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:o}=s;return Qee(r,i,o,t)}const Xee={kernelName:Ag,backendName:"webgl",kernelFunc:hx};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ws(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{perm:i}=s,o=t,a=r.shape.length,l=new Array(a);for(let d=0;d<l.length;d++)l[d]=r.shape[i[d]];let u;if(o.shouldExecuteOnCPU([r])){const f=o.texData.get(r.dataId).values,p=Zw(f,r.shape,r.dtype,i,l);u=o.makeTensorInfo(l,r.dtype);const g=o.texData.get(u.dataId);g.values=p}else u=dx(r,i,o);return u}const Yee={kernelName:Ql,backendName:"webgl",kernelFunc:ws};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SP=1e3;function xm({a:n,b:e,transposeA:t,transposeB:s,backend:r,bias:i=null,preluActivationWeights:o=null,leakyreluAlpha:a=0,activation:l=null}){const u=n.shape.length,d=e.shape.length,f=t?n.shape[u-2]:n.shape[u-1],p=s?e.shape[d-1]:e.shape[d-2],g=t?n.shape[u-1]:n.shape[u-2],x=s?e.shape[d-2]:e.shape[d-1],y=n.shape.slice(0,-2),b=e.shape.slice(0,-2),k=be(y),w=be(b),C=ot(n.shape.slice(0,-2),e.shape.slice(0,-2)).concat([g,x]);V(f===p,()=>`Error in matMul: inner shapes (${f}) and (${p}) of Tensors with shapes ${n.shape} and ${e.shape} and transposeA=${t} and transposeB=${s} must match.`);const S=t?[k,f,g]:[k,g,f],T=s?[w,x,p]:[w,p,x],A=Me({inputs:{x:n},backend:r,attrs:{shape:S}}),E=Me({inputs:{x:e},backend:r,attrs:{shape:T}}),M=[A,E],P=Math.max(k,w),R=t?A.shape[1]:A.shape[2],L=i!=null,_=o!=null,O=l==="leakyrelu",U=l!=null?od(l,!0):null,W=L||_||O||U!=null;let H;if((g===1||x===1)&&R>SP&&W===!1){let q=A,Q=E;t&&(q=ws({inputs:{x:A},backend:r,attrs:{perm:[0,2,1]}}),M.push(q)),s&&(Q=ws({inputs:{x:E},backend:r,attrs:{perm:[0,2,1]}}),M.push(Q));const z=x!==1,K=x===1;let Y=q;z&&(Y=Me({inputs:{x:q},backend:r,attrs:{shape:[P,R,1]}}),M.push(Y));const B=x===1?2:1;let J=Q;K&&(J=Me({inputs:{x:Q},backend:r,attrs:{shape:[P,1,R]}}),M.push(J));const ae=ek({inputs:{a:Y,b:J},backend:r});H=hx({inputs:{x:ae},backend:r,attrs:{axis:B,keepDims:!0}}),M.push(ae)}else{const q=Ks(n.dtype,e.dtype),Q=new CP(S,T,[P,g,x],t,s,L,U,_,O),z=[A,E];if(i!=null&&z.push(i),_&&z.push(o),O){const K=r.makeTensorInfo([],"float32",Yo(a,"float32"));z.push(K),M.push(K)}H=r.runWebGLProgram(Q,z,q)}const G=Me({inputs:{x:H},backend:r,attrs:{shape:C}});M.push(H);for(const q of M)r.disposeIntermediateTensorInfo(q);return G}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zee(n){const{inputs:e,backend:t,attrs:s}=n,{a:r,b:i,bias:o,preluActivationWeights:a}=e,{transposeA:l,transposeB:u,activation:d,leakyreluAlpha:f}=s;return xm({a:r,b:i,transposeA:l,transposeB:u,backend:t,bias:o,preluActivationWeights:a,leakyreluAlpha:f,activation:d})}const Jee={kernelName:Gp,backendName:"webgl",kernelFunc:Zee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YN="return abs(x);";function ete(n){const{inputs:e,backend:t}=n,{x:s}=e;if(t.shouldExecuteOnCPU([s])&&s.dtype!=="complex64"){const i=t.texData.get(s.dataId),o=mP(i.values);return t.makeTensorInfo(s.shape,s.dtype,o)}let r;return me().getBool("WEBGL_PACK_UNARY_OPERATIONS")?r=new Fo(s.shape,YN):r=new vi(s.shape,YN),t.runWebGLProgram(r,[s],s.dtype)}const tte={kernelName:Fm,backendName:"webgl",kernelFunc:ete};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nte=Rr+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,ste=kt({opSnippet:nte}),rte={kernelName:vd,backendName:"webgl",kernelFunc:ste};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ite=Rr+`
  if (x < 1.0) return NAN;
return log(x + sqrt(x * x - 1.0));`,ote=kt({opSnippet:ite}),ate={kernelName:bd,backendName:"webgl",kernelFunc:ote};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZN="return a + b;",lte=Yn({opSnippet:ZN,packedOpSnippet:ZN,supportsComplex:!0,cpuKernelImpl:yJ}),cte={kernelName:Tc,backendName:"webgl",kernelFunc:lte};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ute{constructor(e,t){this.outputShape=[],this.outputShape=e,this.variableNames=t.map((i,o)=>`T${o}`);const s=[];this.variableNames.forEach(i=>{s.push(`float v${i} = get${i}AtOutCoords();`)});const r=this.variableNames.map(i=>`v${i}`).join(" + ");this.userCode=`
      void main() {
        ${s.join(`
        `)}

        float result = ${r};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class dte{constructor(e,t){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=t.map((i,o)=>`T${o}`);const s=[];this.variableNames.forEach(i=>{s.push(`vec4 v${i} = get${i}AtOutCoords();`)});const r=this.variableNames.map(i=>`v${i}`).join(" + ");this.userCode=`
      void main() {
        ${s.join(`
        `)}

        vec4 result = ${r};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ep(n){const{inputs:e,backend:t}=n,s=e;if(s.length===1)return Xs({inputs:{x:s[0]},backend:t});if(s.length>me().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){const l=Math.floor(s.length/2),u=Ep({inputs:s.slice(0,l),backend:t}),d=Ep({inputs:s.slice(l),backend:t});return Ep({inputs:[u,d],backend:t})}const r=s.map(l=>l.dtype).reduce((l,u)=>Ks(l,u)),i=s.map(l=>l.shape),a=me().getBool("WEBGL_PACK")?new dte(s[0].shape,i):new ute(s[0].shape,i);return t.runWebGLProgram(a,s,r)}const hte={kernelName:Nb,backendName:"webgl",kernelFunc:Ep};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fte(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:o}=s,a=r.shape.length,l=ht(i,r.shape);let u=l;const d=tn(u,a);let f=r;d!=null&&(f=ws({inputs:{x:r},backend:t,attrs:{perm:d}}),u=mn(u.length,a)),Xn("all",u,a);const[p,g]=zn(f.shape,u),x=be(g),y=Me({inputs:{x:f},backend:t,attrs:{shape:[-1,x]}}),b=ul(y,y.dtype,"all",t);let k;if(o){const w=kn(p,l);k=Me({inputs:{x:b},backend:t,attrs:{shape:w}})}else k=Me({inputs:{x:b},backend:t,attrs:{shape:p}});return t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(b),d!=null&&t.disposeIntermediateTensorInfo(f),k}const pte={kernelName:Ib,backendName:"webgl",kernelFunc:fte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mte(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:o}=s,a=r.shape.length,l=ht(i,r.shape);let u=l;const d=tn(u,a);let f=r;d!=null&&(f=ws({inputs:{x:r},backend:t,attrs:{perm:d}}),u=mn(u.length,a)),Xn("any",u,a);const[p,g]=zn(f.shape,u),x=be(g),y=Me({inputs:{x:f},backend:t,attrs:{shape:[-1,x]}}),b=ul(y,y.dtype,"any",t);let k;if(o){const w=kn(p,l);k=Me({inputs:{x:b},backend:t,attrs:{shape:w}})}else k=Me({inputs:{x:b},backend:t,attrs:{shape:p}});return t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(b),d!=null&&t.disposeIntermediateTensorInfo(f),k}const gte={kernelName:Tb,backendName:"webgl",kernelFunc:mte};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class xte{constructor(e,t,s){this.variableNames=["A"];const{windowSize:r,batchSize:i,outSize:o}=e;s||this.variableNames.push("bestIndicesA"),this.outputShape=[i,o];const a=t==="max"?">":"<",l=s?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${r};

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < ${r}; i++) {
          int inIdx = ${l};
          float candidate = getA(batch, inIdx);
          if (candidate ${a} bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class yte{constructor(e,t,s,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,V(e.length>2,()=>`Packed arg${s.charAt(0).toUpperCase()+s.slice(1)} supports only inputs with rank above 2.`);const i=e[e.length-1],o=Math.ceil(i/t);this.outputShape=e.slice(0,-1),o>1&&this.outputShape.push(o),r||this.variableNames.push("bestIndicesA");const a=this.outputShape,l=a.length,u=Pt(l),d=vs("coords",l);let f,p;if(o===1){p=l+1;const E=Pt(p);f=`
        ${E} sourceLocR = ${E}(${d.join()}, 0);
        ++${d[l-1]};
        ${E} sourceLocG = ${E}(${d.join()}, 0);
        ++${d[l-2]};
        ${E} sourceLocA = ${E}(${d.join()}, 0);
        --${d[l-1]};
        ${E} sourceLocB = ${E}(${d.join()}, 0);
        --${d[l-2]};`}else p=l,f=`
        ${u} sourceLocR = coords;
        ++${d[l-1]};
        ${u} sourceLocG = coords;
        ++${d[l-2]};
        ${u} sourceLocA = coords;
        --${d[l-1]};
        ${u} sourceLocB = coords;
        --${d[l-2]};`;const g=["x","y","z","w","u","v"].slice(0,p),x="."+g[p-1],y=g.map(E=>"int "+E),b=vs("sourceLocR",p-1).concat("inIdx.r"),k=vs("sourceLocG",p-1).concat("inIdx.g"),w=vs("sourceLocB",p-1).concat("inIdx.b"),N=vs("sourceLocA",p-1).concat("inIdx.a"),C=s==="max"?"greaterThan":"lessThan",S=r?"":`
          inIdx = round(vec4(getBestIndicesAChannel(${b.join()}),
                             getBestIndicesAChannel(${k.join()}),
                             getBestIndicesAChannel(${w.join()}),
                             getBestIndicesAChannel(${N.join()})));`,T=`vec4(
            getAChannel(${b.join()}),
            hasNextCol ? getAChannel(${k.join()}) : 0.,
            hasNextRow ? getAChannel(${w.join()}) : 0.,
            hasNextRow && hasNextCol ? getAChannel(${N.join()}) : 0.)`,A=r?"":`
      float getBestIndicesAChannel(${y.join()}) {
        return getChannel(getBestIndicesA(${g.join()}),
                                          vec2(${g.slice(-2).join()}));
      }`;this.userCode=`
      float getAChannel(${y.join()}) {
        return getChannel(getA(${g.join()}),
                               vec2(${g.slice(-2).join()}));
      }
      ${A}
      void main() {
        ${u} coords = getOutputCoords();
        bool hasNextCol = ${d[l-1]} < ${a[l-1]-1};
        bool hasNextRow = ${d[l-2]} < ${a[l-2]-1};
        ${f}
        ivec4 srcIdx = ivec4(sourceLocR${x}, sourceLocG${x},
          sourceLocB${x}, sourceLocA${x}) * ${t};
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = ${T};

        for (int i = 0; i < ${t}; i++) {
          inIdx = srcIdx;
          ${S}
          vec4 candidate = ${T};
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(${C}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NP(n,e,t,s=null){let r=e.shape[0],i=e.shape[1];s!=null&&(r=s.shape[0],i=s.shape[1]);const o=qg(i),a={windowSize:o,inSize:i,batchSize:r,outSize:Math.ceil(i/o)},l=new xte(a,t,s==null),u=[e];s!=null&&u.push(s);const d=n.runWebGLProgram(l,u,"int32");if(d.shape[1]===1)return d;const f=NP(n,e,t,d);return n.disposeIntermediateTensorInfo(d),f}function IP(n,e,t,s=null){const r=s!=null?s.shape:e.shape,i=r[r.length-1],o=qg(i),a=new yte(r,o,t,s==null),l=s==null?[e]:[e,s],u=n.runWebGLProgram(a,l,"int32");if(u.shape.length===e.shape.length){const d=IP(n,e,t,u);return n.disposeIntermediateTensorInfo(u),d}return u}function TP(n,e,t,s){const r=[t];if(Xn("arg"+s.charAt(0).toUpperCase()+s.slice(1),r,e.shape.length),!me().getBool("WEBGL_PACK_REDUCE")||e.shape.length<=2){const i=[],o=n.texData.get(e.dataId),a=o!==null&&o.isPacked;let l=e;a&&(l=n.unpackTensor(e),i.push(l));const[u,d]=zn(l.shape,r),f=be(d),p=Me({inputs:{x:l},backend:n,attrs:{shape:[-1,f]}});i.push(p);const g=NP(n,p,s);i.push(g);const x=Me({inputs:{x:g},backend:n,attrs:{shape:u}});return i.forEach(y=>n.disposeIntermediateTensorInfo(y)),x}return IP(n,e,s)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vte(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i}=s;let o=ht(i,r.shape);const a=tn(o,r.shape.length);let l=r;const u=[];a!=null&&(l=ws({inputs:{x:r},backend:t,attrs:{perm:a}}),u.push(l),o=mn(o.length,l.shape.length)),Xn("argMax",[o[0]],l.shape.length);const d=TP(t,l,o[0],"max");return u.forEach(f=>t.disposeIntermediateTensorInfo(f)),d}const bte={kernelName:Om,backendName:"webgl",kernelFunc:vte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wte(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i}=s;let o=ht(i,r.shape);const a=tn(o,r.shape.length);let l=r;const u=[];a!=null&&(l=ws({inputs:{x:r},backend:t,attrs:{perm:a}}),u.push(l),o=mn(o.length,l.shape.length)),Xn("argMin",[o[0]],l.shape.length);const d=TP(t,l,o[0],"min");return u.forEach(f=>t.disposeIntermediateTensorInfo(f)),d}const kte={kernelName:_m,backendName:"webgl",kernelFunc:wte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cte=Rr+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,Ste=kt({opSnippet:Cte}),Nte={kernelName:wd,backendName:"webgl",kernelFunc:Ste};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ite=Rr+"return log(x + sqrt(x * x + 1.0));",Tte=kt({opSnippet:Ite}),$te={kernelName:kd,backendName:"webgl",kernelFunc:Tte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ete=Rr+`
  return atan(x);
`,Ate=kt({opSnippet:Ete}),jte={kernelName:Cd,backendName:"webgl",kernelFunc:Ate};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rte=Jw+`
  return atan(a, b);
`,Dte=`
  vec4 result = atan(a, b);
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+cl+`
  return result;
`,Pte=Yn({opSnippet:Rte,packedOpSnippet:Dte}),Mte={kernelName:Nd,backendName:"webgl",kernelFunc:Pte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lte=Rr+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,Fte=kt({opSnippet:Lte}),Ote={kernelName:Sd,backendName:"webgl",kernelFunc:Fte};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ad{constructor(e,t,s,r=!1,i=!1){if(this.variableNames=["x"],t==="avg"&&s)throw new Error("Cannot compute positions for average pool.");const o=e.filterWidth,a=e.strideHeight,l=e.strideWidth,u=e.dilationHeight,d=e.dilationWidth,f=e.effectiveFilterHeight,p=e.effectiveFilterWidth,g=e.padInfo.top,x=e.padInfo.left;this.outputShape=e.outShape;const y=t==="avg",b=`((batch  * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + d`,k=`(xR * ${e.inWidth} + xC) * ${e.inChannels} + d`;let w="0.0";if(y||(w="-1.0 / 1e-20"),s){this.userCode=`
        const ivec2 strides = ivec2(${a}, ${l});
        const ivec2 pads = ivec2(${g}, ${x});

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < ${f};
              wR += ${u}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${p};
                wC += ${d}) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value >= currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = ${r?i?b:k:`wR * ${p} + wC`};
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const N="max";let C=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;t==="avg"&&(C="avgValue / max(count, 1.0)");const S=Math.floor(o/4)*4,T=o%4,A=`
      if (${y}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${N}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(${a}, ${l});
      const ivec2 pads = ivec2(${g}, ${x});
      const float initializationValue = ${w};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(${w});
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < ${f};
            wR += ${u}) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${S}; wC += 4) {
            int xC = xCCorner + wC * ${d};

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${d}, d),
              getValue(batch, xR, xC + 2 * ${d}, d),
              getValue(batch, xR, xC + 3 * ${d}, d)
            );

            ${A}
          }

          int xC = xCCorner + ${S};
          if (${T===1}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            ${A}
          } else if (${T===2}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${d}, d),
              initializationValue,
              initializationValue
            );

            ${A}
          } else if (${T===3}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${d}, d),
              getValue(batch, xR, xC + 2 * ${d}, d),
              initializationValue
            );

            ${A}
          }
        }
        setOutput(${C});
      }
    `}}class tk{constructor(e,t,s,r=!1,i=!1){if(this.variableNames=["x"],t==="avg"&&s)throw new Error("Cannot compute positions for average pool.");const o=e.filterWidth,a=e.strideDepth,l=e.strideHeight,u=e.strideWidth,d=e.dilationDepth,f=e.dilationHeight,p=e.dilationWidth,g=e.effectiveFilterDepth,x=e.effectiveFilterHeight,y=e.effectiveFilterWidth,b=e.padInfo.front,k=e.padInfo.top,w=e.padInfo.left;this.outputShape=e.outShape;const N=t==="avg";let C="0.0";if(N||(C="-1.0 / 1e-20"),s){this.userCode=`
        const ivec3 strides =
            ivec3(${a}, ${l}, ${u});
        const ivec3 pads = ivec3(${b}, ${k}, ${w});

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < ${g};
              wD += ${d}) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= ${e.inDepth}) {
              continue;
            }

            for (int wR = 0; wR < ${x};
                wR += ${f}) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int wC = 0; wC < ${y};
                  wC += ${p}) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value >= currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = ${r?i?`(((batch * ${e.inDepth} + xD) * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`((xD * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`wD * ${x} * ${y} +
                      wR * ${y} + wC`};
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const S="max";let T=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;t==="avg"&&(T="avgValue / max(count, 1.0)");const A=Math.floor(o/4)*4,E=o%4,M=`
      if (${N}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${S}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(${a}, ${l}, ${u});
      const ivec3 pads = ivec3(${b}, ${k}, ${w});
      const float initializationValue = ${C};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(${C});
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < ${g};
            wD += ${d}) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${x};
            wR += ${f}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${A}; wC += 4) {
              int xC = xCCorner + wC * ${p};

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${p}, ch),
                getValue(batch, xD, xR, xC + 2 * ${p}, ch),
                getValue(batch, xD, xR, xC + 3 * ${p}, ch)
              );

              ${M}
            }

            int xC = xCCorner + ${A};
            if (${E===1}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              ${M}
            } else if (${E===2}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${p}, ch),
                initializationValue,
                initializationValue
              );

              ${M}
            } else if (${E===3}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${p}, ch),
                getValue(batch, xD, xR, xC + 2 * ${p}, ch),
                initializationValue
              );

              ${M}
            }
          }
        }
        setOutput(${T});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _te(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e;Rh(r,"avgPool");const{filterSize:i,strides:o,pad:a,dimRoundingMode:l}=s,u=1;V(rs(o,u),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${u}'`);const d=Ar(r.shape,i,o,u,a,l);if(d.filterWidth===1&&d.filterHeight===1&&At(d.inShape,d.outShape))return Xs({inputs:{x:r},backend:t});const f=new ad(d,"avg",!1);return t.runWebGLProgram(f,[r],"float32")}const zte={kernelName:zm,backendName:"webgl",kernelFunc:_te};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bte(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{filterSize:i,strides:o,pad:a,dimRoundingMode:l,dataFormat:u}=s,d=[1,1,1],f=lo(r.shape,i,o,d,a,l,u),p=new tk(f,"avg",!1);return t.runWebGLProgram(p,[r],"float32")}const Wte={kernelName:Bm,backendName:"webgl",kernelFunc:Bte};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Vte{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const t=e.filterHeight,s=e.filterWidth,r=e.strideHeight,i=e.strideWidth,o=e.dilationHeight,a=e.dilationWidth,l=e.effectiveFilterHeight,u=e.effectiveFilterWidth,d=l-1-e.padInfo.top,f=u-1-e.padInfo.left,p=1/(t*s);this.userCode=`
      const ivec2 pads = ivec2(${d}, ${f});
      const float avgMultiplier = float(${p});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${l};
            wR += ${o}) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${u};
            wC+= ${a}) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}}class Ute{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const t=e.filterDepth,s=e.filterHeight,r=e.filterWidth,i=e.strideDepth,o=e.strideHeight,a=e.strideWidth,l=e.dilationDepth,u=e.dilationHeight,d=e.dilationWidth,f=e.effectiveFilterDepth,p=e.effectiveFilterHeight,g=e.effectiveFilterWidth,x=f-1-e.padInfo.front,y=p-1-e.padInfo.top,b=g-1-e.padInfo.left,k=1/(t*s*r);this.userCode=`
      const ivec3 pads = ivec3(${x}, ${y}, ${b});
      const float avgMultiplier = float(${k});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${f};
            wD += ${l}) {
          float dyD = float(dyDCorner + wD) / ${i}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${p};
              wR += ${u}) {
            float dyR = float(dyRCorner + wR) / ${o}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${g};
                wC += ${d}) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gte(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:i}=e,o=i,{filterSize:a,strides:l,pad:u,dimRoundingMode:d}=s,f=[1,1,1],p=lo(o.shape,a,l,f,u,d),g=new Ute(p);return t.runWebGLProgram(g,[r],o.dtype)}const Hte={kernelName:Eb,backendName:"webgl",kernelFunc:Gte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qte(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:i}=e,o=i;Rh([r,i],"avgPoolGrad");const{filterSize:a,strides:l,pad:u}=s,d=Ar(o.shape,a,l,1,u),f=new Vte(d);return t.runWebGLProgram(f,[r],o.dtype)}const Kte={kernelName:$b,backendName:"webgl",kernelFunc:qte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qte(n){const{inputs:e,backend:t,attrs:s}=n,{a:r,b:i}=e,{transposeA:o,transposeB:a}=s;return xm({a:r,b:i,transposeA:o,transposeB:a,backend:t})}const Xte={kernelName:Wm,backendName:"webgl",kernelFunc:Qte};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Yte{constructor(e,t,s,r,i,o){this.outputShape=[],this.variableNames=["x","mean","variance"],ot(e,t),ot(e,s);let a="0.0";r!=null&&(ot(e,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let l="1.0";i!=null&&(ot(e,i),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = ${a};
        float scale = ${l};
        float inv = scale * inversesqrt(variance + float(${o}));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Zte{constructor(e,t,s,r,i,o){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],ot(e,t),ot(e,s);let a="vec4(0.0)";r!=null&&(ot(e,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let l="vec4(1.0)";i!=null&&(ot(e,i),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        vec4 offset = ${a};
        vec4 scale = ${l};

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(${o}));

        setOutput((x - mean) * inv + offset);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jte=({inputs:n,backend:e,attrs:t})=>{const{x:s,mean:r,variance:i,offset:o,scale:a}=n;V(r.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),V(o==null||r.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),V(a==null||r.shape.length===a.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let{varianceEpsilon:l}=t;l==null&&(l=.001);const u=[s,r,i];let d=null;o!=null&&(d=o.shape,u.push(o));let f=null;a!=null&&(f=a.shape,u.push(a));const p=me().getBool("WEBGL_PACK_NORMALIZATION")?new Zte(s.shape,r.shape,i.shape,d,f,l):new Yte(s.shape,r.shape,i.shape,d,f,l);return e.runWebGLProgram(p,u,u[0].dtype)},ene={kernelName:eg,backendName:"webgl",kernelFunc:Jte};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class tne{constructor(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;const t=Pt(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const s=nne(this.rank);let r;const i=e.map((o,a)=>`sourceLoc.${zv[a]} = start[${a}] + coords.${zv[a]};`);r=`
        ${t} sourceLoc;
        ${t} coords = getOutputCoords();
        ${i.join(`
`)}
      `,this.userCode=`
      void main() {
        ${r}
        setOutput(getSource(${s}));
      }
    `}}const zv=["x","y","z","w","u","v"];function nne(n){if(n===1)return"sourceLoc";if(n<=6)return zv.slice(0,n).map(e=>"sourceLoc."+e).join(",");throw Error(`Slicing for rank ${n} is not yet supported`)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class sne{constructor(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const t=Pt(this.rank),s=vs("coords",this.rank),r=vs("sourceLoc",this.rank),i=this.rank===1?"sourceLoc":`vec2(${r.slice(-2).join()})`,o=`getChannel(getSource(${r.join()}), ${i})`,a=`
      result.x = ${o};
      if (++${s[this.rank-1]} < ${e[this.rank-1]}) {
        ++${r[this.rank-1]};
        result.y = ${o};
        --${r[this.rank-1]};
      }
    `,l=this.rank===1?"":`
      --${s[this.rank-1]};
      if (++${s[this.rank-2]} < ${e[this.rank-2]}) {
        ++${r[this.rank-2]};
        result.z = ${o};
        if (++${s[this.rank-1]} < ${e[this.rank-1]}) {
          ++${r[this.rank-1]};
          result.w = ${o};
        }
      }
    `,u=this.rank<=4?`sourceLoc = coords +
            ${t}(${e.map((d,f)=>`start[${f}]`).join()});`:e.map((d,f)=>`${r[f]} = ${s[f]} + start[${f}];`).join(`
`);this.userCode=`
      void main() {
        ${t} coords = getOutputCoords();
        ${t} sourceLoc;
        ${u}
        vec4 result = vec4(0.);
        ${a}
        ${l}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rne(n,e,t,s){const r=s.texData.get(n.dataId),i=s.makeTensorInfo(t,n.dtype),o=s.texData.get(i.dataId);Object.assign(o,r),o.refCount=1,o.shape=t,o.dtype=n.dtype;let a=X1(e,Qe(n.shape));r.slice&&(a+=r.slice.flatOffset),o.slice={flatOffset:a,origDataId:r.slice&&r.slice.origDataId||n.dataId};const l=s.dataRefCount.get(o.slice.origDataId)||1;return s.dataRefCount.set(o.slice.origDataId,l+1),i}function zc(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{begin:i,size:o}=s,[a,l]=Hg(r,i,o);if(q1(r,a,l),be(l)===0)return t.makeTensorInfo(l,r.dtype,[]);if(t.shouldExecuteOnCPU([r])||r.dtype==="string"){const f=t.texData.get(r.dataId),p=XJ(f.values,a,l,r.shape,r.dtype);return t.makeTensorInfo(l,r.dtype,p)}const{isPacked:u}=t.texData.get(r.dataId),d=Q1(r.shape,a,l);if(u||!d){const f=me().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new sne(l):new tne(l),p=[a];return t.runWebGLProgram(f,[r],r.dtype,p)}return t.uploadToGPU(r.dataId),rne(r,a,l,t)}const ine={kernelName:Eg,backendName:"webgl",kernelFunc:zc};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const one=n=>{const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockShape:i,crops:o}=s;V(r.shape.length<=4,()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet");const a=i.reduce((w,N)=>w*N),l=vh(r.shape,i,a),u=bh(l.length,i.length),d=wh(r.shape,i,a),f=tw(o,i.length),p=nw(d,o,i.length),g=[],x=Me({inputs:{x:r},backend:t,attrs:{shape:l}}),y=ws({inputs:{x},backend:t,attrs:{perm:u}}),b=Me({inputs:{x:y},backend:t,attrs:{shape:d}}),k=zc({inputs:{x:b},backend:t,attrs:{begin:f,size:p}});return g.push(x),g.push(y),g.push(b),g.forEach(w=>t.disposeIntermediateTensorInfo(w)),k},ane={kernelName:Vm,backendName:"webgl",kernelFunc:one};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lne(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,weights:i}=e,{size:o}=s,a=t.readSync(r.dataId),l=t.readSync(i.dataId),u=pP(a,l,i.dtype,i.shape,o);return t.makeTensorInfo([o],i.dtype,u)}const cne={kernelName:Ab,backendName:"webgl",kernelFunc:lne};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const une=`
  int r = int(a.r) & int(b.r);
  int g = int(a.g) & int(b.g);
  int rb = int(a.b) & int(b.b);
  int ra = int(a.a) & int(b.a);
  return vec4(r, g, rb, ra);
`,dne=`
  return float(int(a.r) & int(b.r));
`;function hne(n){const{inputs:e,backend:t}=n,{a:s,b:r}=e,i=me().getBool("WEBGL_PACK_BINARY_OPERATIONS"),o=me().getNumber("WEBGL_VERSION");if(t.shouldExecuteOnCPU([s,r])||o===1){const l=t.texData.get(s.dataId).values,u=t.texData.get(r.dataId).values,[d,f]=bJ(s.shape,r.shape,l,u,s.dtype),p=t.makeTensorInfo(f,s.dtype),g=t.texData.get(p.dataId);return g.values=d,p}let a;return i?a=new Oc(une,s.shape,r.shape,!1):a=new Ja(dne,s.shape,r.shape),t.runWebGLProgram(a,[s,r],s.dtype)}const fne={kernelName:jb,backendName:"webgl",kernelFunc:hne};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pne(n){const{inputs:e,backend:t}=n,{s0:s,s1:r}=e,i=t.readSync(s.dataId),o=t.readSync(r.dataId),a=ot(Array.from(i),Array.from(o));return t.makeTensorInfo([a.length],"int32",Int32Array.from(a))}const mne={kernelName:w$,backendName:"webgl",kernelFunc:pne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gne="return float(a != b);",$P=Yn({opSnippet:gne,cpuKernelImpl:BJ,dtype:"bool"}),xne={kernelName:xg,backendName:"webgl",kernelFunc:$P};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ph(n){const{inputs:e,backend:t}=n,{input:s}=e,r=t.texData.get(s.dataId);return Xs({inputs:{x:r.complexTensorInfos.real},backend:t})}const yne={kernelName:n1,backendName:"webgl",kernelFunc:Ph};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vne="return float(int(x));";function bne(n,e){const t=new vi(n.shape,vne),s=e.runWebGLProgram(t,[n],"int32");return{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bv(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{dtype:i}=s;if(i==="complex64"){if(r.dtype==="complex64")return Xs({inputs:{x:r},backend:t});const o=On(r.shape),a=Bv({inputs:{x:r},backend:t,attrs:{dtype:"float32"}}),l=oa({inputs:{real:a,imag:o},backend:t});return o.dispose(),t.disposeIntermediateTensorInfo(a),l}if(r.dtype==="complex64"){const o=Ph({inputs:{input:r},backend:t}),a=Bv({inputs:{x:o},backend:t,attrs:{dtype:i}});return t.disposeIntermediateTensorInfo(o),a}if(!g$(r.dtype,i)){const o=Xs({inputs:{x:r},backend:t});return{dataId:o.dataId,shape:o.shape,dtype:i}}if(t.shouldExecuteOnCPU([r])){const o=t.texData.get(r.dataId).values,[a,l,u]=wJ(o,r.shape,r.dtype,i);return t.makeTensorInfo(a,l,u)}if(i==="int32")return bne(r,t);if(i==="bool"){const o=t.makeTensorInfo([],"bool",ts("bool",1)),l=$P({inputs:{a:r,b:o},backend:t});return t.disposeIntermediateTensorInfo(o),l}throw new Error(`Error in Cast: failed to cast ${r.dtype} to ${i}`)}const wne={kernelName:Id,backendName:"webgl",kernelFunc:Bv};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JN="return ceil(x);",kne=kt({opSnippet:JN,packedOpSnippet:JN,cpuKernelImpl:kJ}),Cne={kernelName:Td,backendName:"webgl",kernelFunc:kne};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Sne{constructor(e){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Nne{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`
      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ine(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{clipValueMin:i,clipValueMax:o}=s;let a;me().getBool("WEBGL_PACK_CLIP")?a=new Nne(r.shape):a=new Sne(r.shape);const l=[[i],[o]];return t.runWebGLProgram(a,[r],r.dtype,l)}const Tne={kernelName:$d,backendName:"webgl",kernelFunc:Ine};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $ne{constructor(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eI(n,e){return{dataId:e.dataId,dtype:e.dtype,shape:n.shape}}function Ene(n){const{inputs:e,backend:t}=n,{x:s}=e,r=t.texData.get(s.dataId),i=new $ne(s.shape),o=[eI(s,r.complexTensorInfos.real),eI(s,r.complexTensorInfos.imag)];return t.runWebGLProgram(i,o,o[0].dtype)}const Ane={kernelName:Um,backendName:"webgl",kernelFunc:Ene};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class jne{constructor(e){this.outputShape=[],this.outputShape=Ci(e,1),this.variableNames=e.map((o,a)=>`T${a}`);const t=new Array(e.length-1);t[0]=e[0][1];for(let o=1;o<t.length;o++)t[o]=t[o-1]+e[o][1];const s=[`if (yC < ${t[0]}) setOutput(getT0(yR, yC));`];for(let o=1;o<t.length;o++){const a=t[o-1];s.push(`else if (yC < ${t[o]}) setOutput(getT${o}(yR, yC-${a}));`)}const r=t.length,i=t[t.length-1];s.push(`else setOutput(getT${r}(yR, yC-${i}));`),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        ${s.join(`
        `)}
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Rne{constructor(e,t){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=Ci(e,t);const s=this.outputShape,r=s.length,i=Pt(r),o=vs("coords",r),a=["x","y","z","w","u","v"].slice(0,r);this.variableNames=e.map((y,b)=>`T${b}`);const l=new Array(e.length-1);l[0]=e[0][t];for(let y=1;y<l.length;y++)l[y]=l[y-1]+e[y][t];const u=a[t],d=a.slice(-2),f=a.join();let p=`if (${u} < ${l[0]}) {
        return getChannel(
            getT0(${f}), vec2(${d.join()}));
        }`;for(let y=1;y<l.length;y++){const b=l[y-1];p+=`
        if (${u} < ${l[y]}  && ${u} >= ${l[y-1]}) {
          return getChannel(
            getT${y}(${up(a,u,b)}),
            vec2(${up(d,u,b)}));
        }`}const g=l.length,x=l[l.length-1];p+=`
        return getChannel(
          getT${g}(${up(a,u,x)}),
          vec2(${up(d,u,x)}));`,this.userCode=`
      float getValue(${a.map(y=>"int "+y)}) {
        ${p}
      }

      void main() {
        ${i} coords = getOutputCoords();
        vec4 result = vec4(getValue(${o}), 0., 0., 0.);

        ${o[r-1]} = ${o[r-1]} + 1;
        if (${o[r-1]} < ${s[r-1]}) {
          result.g = getValue(${o});
        }

        ${o[r-2]} = ${o[r-2]} + 1;
        if (${o[r-2]} < ${s[r-2]}) {
          result.a = getValue(${o});
        }

        ${o[r-1]} = ${o[r-1]} - 1;
        if (${o[r-2]} < ${s[r-2]} &&
            ${o[r-1]} < ${s[r-1]}) {
          result.b = getValue(${o});
        }
        setOutput(result);
      }
    `}}function up(n,e,t){const s=n.indexOf(e);return n.map((i,o)=>o===s?`${i} - ${t}`:i).join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fx(n){const{inputs:e,backend:t}=n,{input:s}=e,r=t.texData.get(s.dataId);return Xs({inputs:{x:r.complexTensorInfos.imag},backend:t})}const Dne={kernelName:Kb,backendName:"webgl",kernelFunc:fx};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zu(n,e,t){const s=n[0].dtype;if(s==="complex64"){const g=n.map(w=>Ph({inputs:{input:w},backend:t})),x=n.map(w=>fx({inputs:{input:w},backend:t})),y=zu(g,e,t),b=zu(x,e,t),k=oa({inputs:{real:y,imag:b},backend:t});return g.forEach(w=>t.disposeIntermediateTensorInfo(w)),x.forEach(w=>t.disposeIntermediateTensorInfo(w)),t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(b),k}let r=t.shouldExecuteOnCPU(n);if(s==="string"&&(r=!0),r){const g=n.map(C=>{const T=[-1,be(C.shape.slice(e))];return Me({inputs:{x:C},backend:t,attrs:{shape:T}})}),x=g.map(C=>({vals:t.readSync(C.dataId),shape:C.shape})),y=Ci(g.map(C=>C.shape),1),b=g[0].shape[0]===1,k=CJ(x,y,s,b),w=Ci(n.map(C=>C.shape),e),N=t.makeTensorInfo(w,s,k);return g.forEach(C=>t.disposeIntermediateTensorInfo(C)),N}const i=n.filter(g=>be(g.shape)>0),o=me().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&i[0].shape.length>1;if(i.length===1){const g=o?new vi(n[0].shape,Po):new Fo(n[0].shape,Po);return t.runWebGLProgram(g,n,s)}const a=me().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(i.length>a){const g=[];for(let y=0;y<i.length;y+=a){const b=i.slice(y,y+a);g.push(zu(b,e,t))}const x=zu(g,e,t);for(const y of g)t.disposeIntermediateTensorInfo(y);return x}if(o){const g=new Rne(i.map(x=>x.shape),e);return t.runWebGLProgram(g,i,s)}const{tensors2D:l,outShape:u}=Pne(i,e,t),d=new jne(l.map(g=>g.shape)),f=t.runWebGLProgram(d,l,s);l.forEach(g=>t.disposeIntermediateTensorInfo(g));const p=Me({inputs:{x:f},attrs:{shape:u},backend:t});return t.disposeIntermediateTensorInfo(f),p}function Pne(n,e,t){const s=Ci(n.map(i=>i.shape),e);return{tensors2D:n.map(i=>Me({inputs:{x:i},attrs:{shape:[-1,be(i.shape.slice(e))]},backend:t})),outShape:s}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EP(n){const{inputs:e,backend:t,attrs:s}=n,{axis:r}=s,i=ht(r,e[0].shape)[0],o=e.map(u=>u.shape);Z1(o,i);const a=Ci(e.map(u=>u.shape),i);if(be(a)===0)return t.makeTensorInfo(a,e[0].dtype,[]);const l=e.filter(u=>be(u.shape)>0);return l.length===1?Xs({inputs:{x:l[0]},backend:t}):zu(l,i,t)}const Mne={kernelName:Gm,backendName:"webgl",kernelFunc:EP};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class AP{constructor(e,t=!1,s=null,r=!1,i=!1){this.variableNames=["x","W"],this.outputShape=e.outShape;const o=e.padInfo.top,a=e.padInfo.left,l=e.strideHeight,u=e.strideWidth,d=e.dilationHeight,f=e.dilationWidth,p=e.filterHeight,g=e.filterWidth,x=Math.floor(e.inChannels/4)*4,y=e.inChannels%4,b=e.dataFormat==="channelsLast",k=b?1:2,w=b?2:3,N=b?3:1;let C="",S="";s&&(r?C=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:i?C=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:C=`
          float activation(float x) {
            ${s}
          }
        `,S="result = activation(result);");const T=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${C}

      const ivec2 strides = ivec2(${l}, ${u});
      const ivec2 pads = ivec2(${o}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[${N}];

        ivec2 xRCCorner =
            ivec2(coords[${k}], coords[${w}]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${p}; wR++) {
          int xR = xRCorner + wR * ${d};

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${g}; wC++) {
            int xC = xCCorner + wC * ${f};

            if (xC < 0 || xC >= ${e.inWidth}) {
              continue;
            }

            for (int d1 = 0; d1 < ${x}; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (${b}) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (${y===1}) {

              if (${b}) {
                dotProd +=
                    getX(batch, xR, xC, ${x}) *
                    getW(wR, wC, ${x}, d2);
              } else {
                dotProd +=
                    getX(batch, ${x}, xR, xC) *
                    getW(wR, wC, ${x}, d2);
              }

            } else if (${y===2}) {
              vec2 wValues = vec2(
                getW(wR, wC, ${x}, d2),
                getW(wR, wC, ${x} + 1, d2)
              );

              if (${b}) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, ${x}),
                  getX(batch, xR, xC, ${x} + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, ${x}, xR, xC),
                  getX(batch, ${x} + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (${y===3}) {
              vec3 wValues = vec3(
                getW(wR, wC, ${x}, d2),
                getW(wR, wC, ${x} + 1, d2),
                getW(wR, wC, ${x} + 2, d2)
              );

              if (${b}) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, ${x}),
                  getX(batch, xR, xC, ${x} + 1),
                  getX(batch, xR, xC, ${x} + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, ${x}, xR, xC),
                  getX(batch, ${x} + 1, xR, xC),
                  getX(batch, ${x} + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        ${T}
        ${S}
        setOutput(result);
      }
    `}}class Lne{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const t=e.padInfo.front,s=e.padInfo.top,r=e.padInfo.left,i=e.strideDepth,o=e.strideHeight,a=e.strideWidth,l=e.dilationDepth,u=e.dilationHeight,d=e.dilationWidth,f=e.filterDepth,p=e.filterHeight,g=e.filterWidth,x=Math.floor(e.inChannels/4)*4,y=e.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(${i}, ${o}, ${a});
      const ivec3 pads = ivec3(${t}, ${s}, ${r});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < ${f}; wF++) {
          int xF = xFCorner + wF * ${l};

          if (xF < 0 || xF >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${p}; wR++) {
            int xR = xRCorner + wR * ${u};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${g}; wC++) {
              int xC = xCCorner + wC * ${d};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              for (int d1 = 0; d1 < ${x}; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (${y===1}) {
                dotProd +=
                  getX(batch, xF, xR, xC, ${x}) *
                  getW(wF, wR, wC, ${x}, d2);
              } else if (${y===2}) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, ${x}),
                  getX(batch, xF, xR, xC, ${x} + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, ${x}, d2),
                  getW(wF, wR, wC, ${x} + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (${y===3}) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, ${x}),
                  getX(batch, xF, xR, xC, ${x} + 1),
                  getX(batch, xF, xR, xC, ${x} + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, ${x}, d2),
                  getW(wF, wR, wC, ${x} + 1, d2),
                  getW(wF, wR, wC, ${x} + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class jP{constructor(e,t=!1,s=null,r=!1,i=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=os(this.outputShape.length);const o=e.padInfo.left,a=e.strideWidth,l=e.dilationWidth,u=e.filterHeight,d=e.filterWidth,f=d;let p=`
       int xR; int xC; int xCOffset;
       vec4 wTexel; vec4 previous; vec4 final;`;for(let b=0;b<d;b++)p+=`
           vec4 xTexelC${b*2};
           int xTexelC${b*2}Ready;
           vec4 xTexelC${b*2+1};
           int xTexelC${b*2+1}Ready;
           vec4 xC${b};`;p+=`
     for (int r = 0; r < ${u}; r++) {
      for (int d1 = 0; d1 < ${e.inChannels}; d1 += 2) {
       `;for(let b=0;b<d;b++)p+=`
           xTexelC${b*2} = vec4(0.0);
           xTexelC${b*2}Ready = 0;
           xTexelC${b*2+1} = vec4(0.0);
           xTexelC${b*2+1}Ready = 0;
           xC${b} = vec4(0.0);`;p+=`
         xR = xRCorner + r * dilations[0];
         if (xR >=0 && xR < inDims[0]) {
       `;for(let b=0;b<(f+1)/2;b++){const k=b*2;if(p+=`
           xC = xCCorner + ${k*l};
           `,a===1){if(k<d&&(o%2===1?(p+=`
                 xCOffset = xC + 1;
                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${k}Ready == 0) {
                   xTexelC${k} = getX(batch, xR, xCOffset, d1);

                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${k}.zw = vec2(0.0);
                   }
                   xTexelC${k}Ready = 1;
                 }
               `,l===1&&k>0?p+=`
                 xC${k} = vec4(xTexelC${k-2}.zw, xTexelC${k}.xy);
                 `:p+=`
                   xCOffset = xC + 1 - 2;

                   if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       previous.zw = vec2(0.0);
                     }

                     xC${k} = vec4(previous.zw, xTexelC${k}.xy);
                   } else {
                     xC${k} = vec4(0.0, 0.0, xTexelC${k}.xy);
                   }
                   `):p+=`
                 if (xC >= 0 && xC < inDims[1] && xTexelC${k}Ready == 0) {
                   xTexelC${k} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${k}.zw = vec2(0.0);
                   }
                   xTexelC${k}Ready = 1;
                 }

                 xC${k} = xTexelC${k};
                 `,k+1<d)){const w=o%2===0?bb(l):l;l%2===0&&o%2===1||l%2!==0&&o%2!==1?(p+=`
                   xCOffset = xC + imod(pads[1], 2) + ${w};

                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${k+1}Ready == 0) {
                     xTexelC${k+1} = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       xTexelC${k+1}.zw = vec2(0.0);
                     }
                     xTexelC${k+1}Ready = 1;
                   }
                   `,l>1?p+=`
                     xCOffset -= 2;
                     if (xCOffset >= 0 && xCOffset < inDims[1]) {
                      previous = getX(batch, xR, xCOffset, d1);
                      xC${k+1} = vec4(previous.zw, xTexelC${k+1}.xy);
                     } else {
                      xC${k+1} = vec4(0.0, 0.0, xTexelC${k+1}.xy);
                     }
                     `:p+=`
                     xC${k+1} = vec4(xTexelC${k}.zw, xTexelC${k+1}.xy);
                     `):w===1?p+=`
                     xC${k+1} = xTexelC${k};
                     `:p+=`
                     xCOffset = xC + ${w};

                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${k+1}Ready == 0) {
                       xTexelC${k+1} = getX(batch, xR, xCOffset, d1);
                       if (xCOffset + 1 >= inDims[1]) {
                         xTexelC${k+1}.zw = vec2(0.0);
                       }
                       xTexelC${k+1}Ready = 1;
                     }

                     xC${k+1} = xTexelC${k+1};
                     `}}else k<d&&(o%2===1?(p+=`
                 xCOffset = xC + 1 - strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${k}Ready == 0) {
                   xTexelC${k} = getX(batch, xR, xCOffset, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${k}.zw = vec2(0.0);
                   }
                   xTexelC${k}Ready = 1;
                 }

                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${k+1}Ready == 0) {
                   xTexelC${k+1} = getX(batch, xR, xC + 1, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xC + 2 >= inDims[1]) {
                     xTexelC${k+1}.zw = vec2(0.0);
                   }
                   xTexelC${k+1}Ready = 1;
                 }

                 xC${k} = vec4(xTexelC${k}.zw, xTexelC${k+1}.zw);
               `,k+1<d&&(p+=`
                   final = vec4(0.0);
                   xCOffset = xC + 1 + strides[1];
                   if(xCOffset >= 0 && xCOffset < inDims[1]) {
                     final = getX(batch, xR, xCOffset, d1);
                   }
                   xC${k+1} = vec4(xTexelC${k+1}.xy, final.xy);
                 `)):(p+=`
                 if(xC >= 0 && xC < inDims[1] && xTexelC${k}Ready == 0) {
                   xTexelC${k} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${k}.zw = vec2(0.0);
                   }
                   xTexelC${k}Ready = 1;
                 }

                 xCOffset = xC + strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${k+1}Ready == 0) {
                   xTexelC${k+1} = getX(batch, xR, xCOffset, d1);
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${k+1}.zw = vec2(0.);
                   }
                   xTexelC${k+1}Ready = 1;
                 }

                 xC${k} = vec4(
                   xTexelC${k}.xy, xTexelC${k+1}.xy);
               `,k+1<d&&(p+=`
                   xC${k+1} = vec4(xTexelC${k}.zw, xTexelC${k+1}.zw);
                 `)));k<d&&(p+=`
             wTexel = getW(r, ${k}, d1, d2);
             dotProd += xC${k}.xxzz * vec4(wTexel.xy, wTexel.xy);
             if(d1 + 1 < ${e.inChannels}) {
               dotProd += xC${k}.yyww * vec4(wTexel.zw, wTexel.zw);
             }
           `,k+1<d&&(p+=`
               wTexel = getW(r, ${k+1}, d1, d2);
               dotProd += xC${k+1}.xxzz * vec4(wTexel.xy, wTexel.xy);
               if(d1 + 1 < ${e.inChannels}) {
                 dotProd += xC${k+1}.yyww * vec4(wTexel.zw, wTexel.zw);
               }
             `))}p+=`
     }
   `,p+=`
     }
   `,p+=`
     }
   `;let g="",x="";s&&(r?g=`vec4 activation(vec4 a) {
           vec4 b = getPreluActivationWeightsAtOutCoords();
           ${s}
         }`:i?g=`vec4 activation(vec4 a) {
           vec4 b = getLeakyreluAlphaAtOutCoords();
           ${s}
         }`:g=`vec4 activation(vec4 x) {
           ${s}
         }`,x="result = activation(result);");const y=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
       ${g}

       void main() {
         ivec4 coords = getOutputCoords();
         int batch = coords.x;
         ivec2 xRCCorner = coords.yz * strides - pads;
         int d2 = coords.w;
         int xRCorner = xRCCorner.x;
         int xCCorner = xRCCorner.y;

         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
         vec4 dotProd = vec4(0.000000000000001);

         ${p}

         vec4 result = dotProd - vec4(0.000000000000001);
         ${y}
         ${x}
         setOutput(result);
       }
     `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Fne{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=e,this.enableShapeUniforms=os(this.outputShape.length);const{dataFormat:s}=t,r=ks(),i=s==="channelsLast",o=i?1:2,a=i?2:3,l=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":`if(blockIndex < ${e[2]} && pos < ${e[1]}) {`;let u="";for(let d=0;d<=1;d++)for(let f=0;f<=1;f++)u+=`
          blockIndex = rc.z + ${f};
          pos = rc.y + ${d};

          ${l}
            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];
            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);

            if(d0 < inputShape[${o}] && d0 >= 0) {
              // Use custom imod instead mod. On Intel GPU, mod may generate
              // unexpected value.
              // https://github.com/tensorflow/tfjs/issues/5447
              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];
              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /
                  inChannels);

              if(d1 < inputShape[${a}] && d1 >= 0) {

                ch = imod(pos, inChannels);

                if (${i}) {
                  innerDims = vec2(d1, ch);
                  result[${d*2+f}] = getChannel(
                    getA(rc.x, d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[${d*2+f}] = getChannel(
                    getA(rc.x, ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        ${u}

        ${r.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ym(n,e){const t=n.length;return t>=3?e?[...n.slice(0,-3),n[t-3]*n[t-2],n[t-1]]:[...n.slice(0,-3),n[t-3],n[t-2]*n[t-1]]:!e&&t===1&&n[0]>1?[n[0],1]:null}function RP({x:n,filter:e,convInfo:t,backend:s,bias:r=null,preluActivationWeights:i=null,leakyreluAlpha:o=0,activation:a=null}){const l=n.shape,u=s.texData.get(n.dataId),d=t.inChannels,f=l[0]*l[1]*l[2],p=t.outChannels,g=t.dataFormat==="channelsLast",x=!1,y=!1;let b;const k=[];if(i!=null){const C=ym(i.shape,g);C!=null&&(i=Me({inputs:{x:i},backend:s,attrs:{shape:C}}),k.push(i))}if(r!=null){const C=ym(r.shape,g);C!=null&&(r=Me({inputs:{x:r},backend:s,attrs:{shape:C}}),k.push(r))}if(!((f===1||p===1)&&d>SP)&&u.isPacked&&g&&u.texture!=null&&l[2]%2!==0&&At(u.shape.slice(-3),l.slice(-3))){const C=l[0]*l[1]*(l[2]+1),S={dataId:n.dataId,shape:[1,C,t.inChannels],dtype:n.dtype},T=u.shape;u.shape=u.shape.slice(),u.shape[u.shape.length-2]++,V(gm(u.shape,S.shape),()=>`packed reshape ${u.shape} to ${S.shape} isn't free`);const A=Me({inputs:{x:e},backend:s,attrs:{shape:[1,t.inChannels,t.outChannels]}});k.push(A);const E=xm({a:S,b:A,backend:s,transposeA:x,transposeB:y,bias:r,activation:a,preluActivationWeights:i,leakyreluAlpha:o}),M=s.texData.get(E.dataId);V(M.isPacked,()=>"batchMatMul result is expected to be packed"),u.shape=T,M.shape=t.outShape,b=Xs({inputs:{x:E},backend:s}),b.shape=t.outShape,k.push(E)}else{const C=t.outHeight*t.outWidth,S=Me({inputs:{x:n},backend:s,attrs:{shape:g?[t.batchSize,C,t.inChannels]:[t.batchSize,t.inChannels,C]}}),T=Me({inputs:{x:e},backend:s,attrs:{shape:[1,t.inChannels,t.outChannels]}}),A=xm({a:g?S:T,b:g?T:S,transposeA:!g,transposeB:y,backend:s,bias:r,activation:a,preluActivationWeights:i,leakyreluAlpha:o});b=Me({inputs:{x:A},backend:s,attrs:{shape:t.outShape}}),k.push(S),k.push(T),k.push(A)}for(const C of k)s.disposeIntermediateTensorInfo(C);return b}function DP({x:n,filter:e,convInfo:t,backend:s,bias:r=null,preluActivationWeights:i=null,leakyreluAlpha:o=0,activation:a=null}){const{filterWidth:l,filterHeight:u,inChannels:d,outWidth:f,outHeight:p,dataFormat:g}=t,x=g==="channelsLast",y=l*u*d,b=p*f,k=[t.batchSize,y,b],w=!0,N=!1,C=[];if(i!=null){const G=ym(i.shape,x);G!=null&&(i=Me({inputs:{x:i},backend:s,attrs:{shape:G}}),C.push(i))}if(r!=null){const G=ym(r.shape,x);G!=null&&(r=Me({inputs:{x:r},backend:s,attrs:{shape:G}}),C.push(r))}const S=Me({inputs:{x:e},backend:s,attrs:{shape:[1,y,be(e.shape)/y]}});C.push(S);const T=new Fne(k,t),A=[n.shape,[t.padInfo.top,t.padInfo.left],[t.strideHeight,t.strideWidth],[t.dilationHeight,t.dilationWidth],[t.inChannels],[t.filterWidth*t.inChannels],[t.outWidth]],E=s.runWebGLProgram(T,[n],"float32",A),M=Me({inputs:{x:E},backend:s,attrs:{shape:k}});C.push(E),C.push(M);const P=r!=null,R=i!=null,L=a==="leakyrelu",_=a?od(a,!0):null,O=new CP(x?M.shape:S.shape,x?S.shape:M.shape,x?[t.batchSize,b,t.outChannels]:[t.batchSize,t.outChannels,b],w,N,P,_,R,L),U=x?[M,S]:[S,M];if(r&&U.push(r),R&&U.push(i),L){const G=s.makeTensorInfo([],"float32",Yo(o,"float32"));U.push(G),C.push(G)}const W=s.runWebGLProgram(O,U,"float32"),H=Me({inputs:{x:W},backend:s,attrs:{shape:t.outShape}});C.push(W);for(const G of C)s.disposeIntermediateTensorInfo(G);return H}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function One(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i}=e,{strides:o,pad:a,dataFormat:l,dilations:u,dimRoundingMode:d}=s,f=co(l),p=Qn(r.shape,i.shape,o,u,a,d,!1,f);let g;if(p.filterHeight===1&&p.filterWidth===1&&p.dilationHeight===1&&p.dilationWidth===1&&p.strideHeight===1&&p.strideWidth===1&&(p.padInfo.type==="SAME"||p.padInfo.type==="VALID"))g=RP({x:r,filter:i,convInfo:p,backend:t});else if(p.strideWidth<=2&&f==="channelsLast"&&me().getBool("WEBGL_EXP_CONV")){const y=new jP(p),b=[[p.padInfo.top,p.padInfo.left],[p.strideHeight,p.strideWidth],[p.dilationHeight,p.dilationWidth],[p.inHeight,p.inWidth]];g=t.runWebGLProgram(y,[r,i],"float32",b)}else if(me().getBool("WEBGL_CONV_IM2COL"))g=DP({x:r,filter:i,convInfo:p,backend:t});else{const y=new AP(p);g=t.runWebGLProgram(y,[r,i],"float32")}const x=Me({inputs:{x:g},backend:t,attrs:{shape:p.outShape}});return t.disposeIntermediateTensorInfo(g),x}const _ne={kernelName:Hm,backendName:"webgl",kernelFunc:One};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class zne{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideHeight,s=e.strideWidth,r=e.padInfo.top,i=e.padInfo.left,o=e.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${t} - ${r};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${s} - ${i};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              ${o?`float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);`:`float dyValue = getDy(b, d2, yR, yC);
              float xValue = getX(b, d1, xR, xC);
              dotProd += (xValue * dyValue);`}
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class Bne{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterHeight,s=e.filterWidth,r=e.strideHeight,i=e.strideWidth,o=e.dataFormat==="channelsLast",a=t-1-e.padInfo.top,l=s-1-e.padInfo.left,u=o?1:2,d=o?2:3,f=o?3:1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[${f}];

        ivec2 dyCorner = ivec2(coords[${u}], coords[${d}]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${t}; wR++) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${t} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${s} - 1 - wC;

            for (int d2 = 0; d2 < ${e.outChannels}; d2++) {

              if (${o}) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}}class Wne{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideDepth,s=e.strideHeight,r=e.strideWidth,i=e.padInfo.front,o=e.padInfo.top,a=e.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yF = 0; yF < ${e.outDepth}; yF++) {
            int xF = wF + yF * ${t} - ${i};

            if (xF < 0 || xF >= ${e.inDepth}) {
              continue;
            }

            for (int yR = 0; yR < ${e.outHeight}; yR++) {
              int xR = wR + yR * ${s} - ${o};

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int yC = 0; yC < ${e.outWidth}; yC++) {
                int xC = wC + yC * ${r} - ${a};

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class Vne{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterDepth,s=e.filterHeight,r=e.filterWidth,i=e.strideDepth,o=e.strideHeight,a=e.strideWidth,l=t-1-e.padInfo.front,u=s-1-e.padInfo.top,d=r-1-e.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(${l}, ${u}, ${d});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < ${t}; wF++) {
          float dyF = float(dyFCorner + wF) / ${i}.0;

          if (dyF < 0.0 || dyF >= ${e.outDepth}.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = ${t} - 1 - wF;

          for (int wR = 0; wR < ${s}; wR++) {
            float dyR = float(dyRCorner + wR) / ${o}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = ${s} - 1 - wR;

            for (int wC = 0; wC < ${r}; wC++) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = ${r} - 1 - wC;

              for (int d2 = 0; d2 < ${e.outChannels}; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Une(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:i}=e,{strides:o,pad:a,dataFormat:l,dimRoundingMode:u,filterShape:d}=s,f=co(l),p=Qn(r.shape,d,o,1,a,u,!1,f),g=new zne(p);return t.runWebGLProgram(g,[r,i],"float32")}const Gne={kernelName:Db,backendName:"webgl",kernelFunc:Une};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Hne{constructor(e){this.variableNames=["dy","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"strides",type:"vec2"}],this.outputShape=e.inShape,this.enableShapeUniforms=os(this.outputShape.length);const t=e.filterHeight,s=e.filterWidth,r=t-1-e.padInfo.top,i=s-1-e.padInfo.left;this.userCode=`
      const ivec2 pads = ivec2(${r}, ${i});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];

        ivec2 dyCorner = ivec2(coords[1], coords[2]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        vec4 result = vec4(0.);
        for (int wR = 0; wR < ${t}; wR++) {
          float dyR = float(dyRCorner + wR) / strides[0];
          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);
          int wRPerm = ${t} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            int wCPerm = ${s} - 1 - wC;

            float dyC = float(dyCCorner + wC) / strides[1];
            bool idyCVal = (dyC >= 0.0) && (dyC < ${e.outWidth}.0)
              && (fract(dyC) == 0.0);
            int idyC = int(dyC);

            float dyC2 = float(dyCCorner + wC + 1) / strides[1];
            bool idyCVal2 = (dyC2 >= 0.0) && (dyC2 < ${e.outWidth}.0)
              && (fract(dyC2) == 0.0);
            int idyC2 = int(dyC2);

            if (idyCVal && idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec4 dySample2 = (idyC / 2 == idyC2 / 2) ?
                  dySample : getDy(batch, idyR, idyC2, d2);

                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));

                dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample2.xy : dySample2.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC2, d2);
                vec2 dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            }
          }
        }
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qne(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:i}=e,{inputShape:o,strides:a,pad:l,dataFormat:u,dimRoundingMode:d}=s,f=co(u),p=Qn(o,i.shape,a,1,l,d,!1,f);if(me().getBool("WEBGL_PACK_CONV2DTRANSPOSE")&&f==="channelsLast"){const g=[[p.strideHeight,p.strideWidth]],x=new Hne(p);return t.runWebGLProgram(x,[r,i],"float32",g)}else{const g=new Bne(p);return t.runWebGLProgram(g,[r,i],"float32")}}const Kne={kernelName:qm,backendName:"webgl",kernelFunc:qne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qne(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i}=e,{strides:o,pad:a,dilations:l}=s,u=Jo(r.shape,i.shape,o,l,a),d=new Lne(u);return t.runWebGLProgram(d,[r,i],"float32")}const Xne={kernelName:Km,backendName:"webgl",kernelFunc:Qne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yne(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:i}=e,{strides:o,pad:a,filterShape:l}=s,u=Jo(r.shape,l,o,1,a),d=new Wne(u);return t.runWebGLProgram(d,[r,i],"float32")}const Zne={kernelName:Pb,backendName:"webgl",kernelFunc:Yne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jne(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:i}=e,{pad:o,strides:a,inputShape:l}=s,u=Jo(l,i.shape,a,1,o),d=new Vne(u);return t.runWebGLProgram(d,[r,i],"float32")}const ese={kernelName:Mb,backendName:"webgl",kernelFunc:Jne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tse=_c+`
  return cos(x);
`,nse=`
  vec4 result = cos(x);
  bvec4 isNaN = isnan(x);
  ${cl}
  return result;
`,sse=kt({opSnippet:tse,packedOpSnippet:nse}),rse={kernelName:Ed,backendName:"webgl",kernelFunc:sse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ise=`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`,ose=kt({opSnippet:ise}),ase={kernelName:Ad,backendName:"webgl",kernelFunc:ose};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class lse{constructor(e,t,s,r,i){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];const[o,a,l,u]=e,[d]=t,[f,p]=s;this.outputShape=[d,f,p,u];const g=r==="bilinear"?1:0,[x,y]=[`${a-1}.0`,`${l-1}.0`],[b,k,w]=f>1?[`${(a-1)/(f-1)}`,"(y2-y1) * height_ratio",`y1*${x} + float(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${x}`],[N,C,S]=p>1?[`${(l-1)/(p-1)}`,"(x2-x1) * width_ratio",`x1*${y} + float(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${y}`];this.userCode=`
      const float height_ratio = float(${b});
      const float width_ratio = float(${N});
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= ${o}) {
          return;
        }

        float height_scale = ${k};
        float width_scale = ${C};

        float in_y = ${w};
        if( in_y < 0.0 || in_y > ${x} ) {
          setOutput(float(${i}));
          return;
        }
        float in_x = ${S};
        if( in_x < 0.0 || in_x > ${y} ) {
          setOutput(float(${i}));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(${g} == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cse=n=>{const{inputs:e,backend:t,attrs:s}=n,{image:r,boxes:i,boxInd:o}=e,{cropSize:a,method:l,extrapolationValue:u}=s,d=new lse(r.shape,i.shape,a,l,u);return t.runWebGLProgram(d,[r,i,o],"float32")},use={kernelName:Fb,backendName:"webgl",kernelFunc:cse};var ld;(function(n){n.Prod="*",n.Sum="+"})(ld||(ld={}));class tI{constructor(e,t,s,r){this.op=e,this.outputShape=t,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];const i=this.outputShape.length,o=this.op===ld.Prod?"1.0":"0.0",a=s?o:`getX(${nI(i,"coords",this.op)})`,l=this.outputShape[this.outputShape.length-1];let u="",d="";s?(u=r?`end != ${l-1}`:"end != 0",d=r?"end + 1":"end - 1"):(u=r?`end + pow2 < ${l}`:"end >= pow2",d=r?"end + pow2":"end - pow2"),this.userCode=`
      void main() {
        ${Pt(i)} coords = getOutputCoords();
        int end = ${sI(i,"coords",this.op)};
        float val = ${a};
        int pow2 = int(pow(2.0, index));
        if (${u}) {
          int idx = ${d};
          ${sI(i,"coords",this.op)} = idx;
          val ${this.op}= getX(${nI(i,"coords",this.op)});
        }
        setOutput(val);
      }
    `}}function nI(n,e,t){if(n===1)return`${e}`;if(n===2)return`${e}.x, ${e}.y`;if(n===3)return`${e}.x, ${e}.y, ${e}.z`;if(n===4)return`${e}.x, ${e}.y, ${e}.z, ${e}.w`;throw new Error(`Cumulative ${t} for rank ${n} is not yet supported`)}function sI(n,e,t){if(n===1)return`${e}`;if(n===2)return`${e}.y`;if(n===3)return`${e}.z`;if(n===4)return`${e}.w`;throw new Error(`Cumulative ${t} for rank ${n} is not yet supported`)}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PP(n,e,t,s,r,i){const o=e.shape.length,a=tn([s],o);let l=e;a!=null&&(l=ws({inputs:{x:e},backend:t,attrs:{perm:a}}));const u=mn(1,o)[0];if(u!==o-1)throw new Error(`WebGL cumprod shader expects an inner-most axis=${e.shape.length-1} but got axis=${s}`);const d=l.shape[u];let f=Xs({inputs:{x:l},backend:t});for(let p=0;p<=Math.ceil(Math.log2(d))-1;p++){const g=new tI(n,l.shape,!1,i),x=[[p]],y=f;f=t.runWebGLProgram(g,[f],f.dtype,x),t.disposeIntermediateTensorInfo(y)}if(r){const p=new tI(n,l.shape,r,i),g=f;f=t.runWebGLProgram(p,[f],f.dtype),t.disposeIntermediateTensorInfo(g)}if(a!=null){const p=ea(a),g=ws({inputs:{x:f},backend:t,attrs:{perm:p}});return t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(l),g}return f}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dse(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,exclusive:o,reverse:a}=s;return PP(ld.Prod,r,t,i,o,a)}const hse={kernelName:Lb,backendName:"webgl",kernelFunc:dse};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fse(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,exclusive:o,reverse:a}=s;return PP(ld.Sum,r,t,i,o,a)}const pse={kernelName:Qm,backendName:"webgl",kernelFunc:fse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mse(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,weights:i}=e,{size:o,binaryOutput:a}=s;if(r.shape.length===1){const l=t.readSync(r.dataId),u=t.readSync(i.dataId),d=pP(l,u,i.dtype,i.shape,o);return t.makeTensorInfo([o],i.dtype,d)}else if(r.shape.length===2){const l=t.bufferSync(r),u=t.bufferSync(i),d=vJ(l,u,o,a);return t.makeTensorInfo(d.shape,i.dtype,d.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${r.shape.length}.`)}const gse={kernelName:Ob,backendName:"webgl",kernelFunc:mse};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class xse{constructor(e,t,s){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=s,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = ${this.getHeightCoordString()};
      int w = ${this.getWidthCoordString()};
      int d = ${this.getDepthCoordString()};

      int in_h = h / ${t};
      int offset_h = imod(h, ${t});
      int in_w = w / ${t};
      int offset_w = imod(w, ${t});
      int offset_d = (offset_h * ${t} + offset_w) *
        ${this.getOutputDepthSize()};
      int in_d = d + offset_d;

      float result = ${this.getInputSamplingString()};
      setOutput(result);
    }
  `}getHeightCoordString(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"}getWidthCoordString(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"}getDepthCoordString(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"}getOutputDepthSize(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yse(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockSize:i,dataFormat:o}=s,a=r.shape[0],l=o==="NHWC"?r.shape[1]:r.shape[2],u=o==="NHWC"?r.shape[2]:r.shape[3],d=o==="NHWC"?r.shape[3]:r.shape[1],f=l*i,p=u*i,g=d/(i*i),x=o==="NHWC"?[a,f,p,g]:[a,g,f,p],y=new xse(x,i,o);return t.runWebGLProgram(y,[r],r.dtype)}const vse={kernelName:_b,backendName:"webgl",kernelFunc:yse};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class MP{constructor(e,t=!1,s=null,r=!1,i=!1){this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=os(this.outputShape.length);const o=e.filterHeight,a=e.filterWidth,l=e.outChannels/e.inChannels;let u="",d="";s&&(r?u=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:i?u=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:u=`
          float activation(float x) {
            ${s}
          }
        `,d="result = activation(result);");const f=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${u}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${l};
        int q = d2 - d1 * ${l};

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < ${o}; wR++) {
          int xR = xRCorner + wR * dilations[0];

          if (xR < 0 || xR >= inDims[0]) {
            continue;
          }

          for (int wC = 0; wC < ${a}; wC++) {
            int xC = xCCorner + wC * dilations[1];

            if (xC < 0 || xC >= inDims[1]) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        ${f}
        ${d}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class LP{constructor(e,t=!1,s=null,r=!1,i=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=os(this.outputShape.length);const o=e.outChannels/e.inChannels,a=e.padInfo.left,l=e.strideWidth,u=e.dilationWidth,d=e.filterHeight,f=e.filterWidth,p=f;let g=`
      int xR; int xC; int xCOffset;
      vec4 wTexel; vec4 previous; vec4 final;`;for(let k=0;k<f;k++)g+=`
          vec4 xTexelC${k*2};
          int xTexelC${k*2}Ready;
          vec4 xTexelC${k*2+1};
          int xTexelC${k*2+1}Ready;
          vec4 xC${k};`;g+=`
    for (int r = 0; r < ${d}; r++) {
      `;for(let k=0;k<f;k++)g+=`
          xTexelC${k*2} = vec4(0.0);
          xTexelC${k*2}Ready = 0;
          xTexelC${k*2+1} = vec4(0.0);
          xTexelC${k*2+1}Ready = 0;
          xC${k} = vec4(0.0);`;g+=`
        xR = xRCorner + r * dilations[0];
        if (xR >=0 && xR < inDims[0]) {
      `;for(let k=0;k<(p+1)/2;k++){const w=k*2;if(g+=`
          xC = xCCorner + ${w*u};
          `,l===1){if(w<f&&(a%2===1?(g+=`
                xCOffset = xC + 1;
                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${w}Ready == 0) {
                  xTexelC${w} = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${w}.zw = vec2(0.0);
                  }
                  xTexelC${w}Ready = 1;
                }
              `,u===1&&w>0?g+=`
                xC${w} = vec4(xTexelC${w-2}.zw, xTexelC${w}.xy);
                `:g+=`
                  xCOffset = xC + 1 - 2;

                  if (xCOffset >= 0 && xCOffset < inDims[1]) {
                    previous = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      previous.zw = vec2(0.0);
                    }

                    xC${w} = vec4(previous.zw, xTexelC${w}.xy);
                  } else {
                    xC${w} = vec4(0.0, 0.0, xTexelC${w}.xy);
                  }
                  `):g+=`
                if (xC >= 0 && xC < inDims[1] && xTexelC${w}Ready == 0) {
                  xTexelC${w} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${w}.zw = vec2(0.0);
                  }
                  xTexelC${w}Ready = 1;
                }

                xC${w} = xTexelC${w};
                `,w+1<f)){const N=a%2===0?bb(u):u;u%2===0&&a%2===1||u%2!==0&&a%2!==1?(g+=`
                  xCOffset = xC + imod(pads[1], 2) + ${N};

                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${w+1}Ready == 0) {
                    xTexelC${w+1} = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      xTexelC${w+1}.zw = vec2(0.0);
                    }
                    xTexelC${w+1}Ready = 1;
                  }
                  `,u>1?g+=`
                    xCOffset -= 2;
                    if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);
                     xC${w+1} = vec4(previous.zw, xTexelC${w+1}.xy);
                    } else {
                     xC${w+1} = vec4(0.0, 0.0, xTexelC${w+1}.xy);
                    }
                    `:g+=`
                    xC${w+1} = vec4(xTexelC${w}.zw, xTexelC${w+1}.xy);
                    `):N===1?g+=`
                    xC${w+1} = xTexelC${w};
                    `:g+=`
                    xCOffset = xC + ${N};

                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${w+1}Ready == 0) {
                      xTexelC${w+1} = getX(batch, xR, xCOffset, d1);
                      if (xCOffset + 1 >= inDims[1]) {
                        xTexelC${w+1}.zw = vec2(0.0);
                      }
                      xTexelC${w+1}Ready = 1;
                    }

                    xC${w+1} = xTexelC${w+1};
                    `}}else w<f&&(a%2===1?(g+=`
                xCOffset = xC + 1 - strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${w}Ready == 0) {
                  xTexelC${w} = getX(batch, xR, xCOffset, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${w}.zw = vec2(0.0);
                  }
                  xTexelC${w}Ready = 1;
                }

                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${w+1}Ready == 0) {
                  xTexelC${w+1} = getX(batch, xR, xC + 1, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xC + 2 >= inDims[1]) {
                    xTexelC${w+1}.zw = vec2(0.0);
                  }
                  xTexelC${w+1}Ready = 1;
                }

                xC${w} = vec4(xTexelC${w}.zw, xTexelC${w+1}.zw);
              `,w+1<f&&(g+=`
                  final = vec4(0.0);
                  xCOffset = xC + 1 + strides[1];
                  if(xCOffset >= 0 && xCOffset < inDims[1]) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xC${w+1} = vec4(xTexelC${w+1}.xy, final.xy);
                `)):(g+=`
                if(xC >= 0 && xC < inDims[1] && xTexelC${w}Ready == 0) {
                  xTexelC${w} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${w}.zw = vec2(0.0);
                  }
                  xTexelC${w}Ready = 1;
                }

                xCOffset = xC + strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${w+1}Ready == 0) {
                  xTexelC${w+1} = getX(batch, xR, xCOffset, d1);
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${w+1}.zw = vec2(0.);
                  }
                  xTexelC${w+1}Ready = 1;
                }

                xC${w} = vec4(
                  xTexelC${w}.xy, xTexelC${w+1}.xy);
              `,w+1<f&&(g+=`
                  xC${w+1} = vec4(xTexelC${w}.zw, xTexelC${w+1}.zw);
                `)));w<f&&(g+=`
            wTexel = getW(r, ${w}, d1, q);
            dotProd += xC${w} * vec4(wTexel.xz, wTexel.xz);
          `,w+1<f&&(g+=`
              wTexel = getW(r, ${w+1}, d1, q);
              dotProd += xC${w+1} * vec4(wTexel.xz, wTexel.xz);
            `))}g+=`
    }
  `,g+=`
      }
    `;let x="",y="";s&&(r?x=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:i?x=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:x=`vec4 activation(vec4 x) {
          ${s}
        }`,y="result = activation(result);");const b=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${x}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${o};
        int q = d2 - d1 * ${o};
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
        vec4 dotProd = vec4(0.000000000000001);

        ${g}

        vec4 result = dotProd - vec4(0.000000000000001);
        ${b}
        ${y}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bse(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i}=e,{strides:o,pad:a,dilations:l,dimRoundingMode:u}=s;let d=l;d==null&&(d=[1,1]),V(rs(o,d),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${o} and dilations '${d}'`);const f=Qn(r.shape,i.shape,o,d,a,u,!0);let p;me().getBool("WEBGL_PACK_DEPTHWISECONV")&&f.strideWidth<=2&&f.outChannels/f.inChannels===1?p=new LP(f):p=new MP(f);const g=[[f.padInfo.top,f.padInfo.left],[f.strideHeight,f.strideWidth],[f.dilationHeight,f.dilationWidth],[f.inHeight,f.inWidth]];return t.runWebGLProgram(p,[r,i],"float32",g)}const wse={kernelName:Xm,backendName:"webgl",kernelFunc:bse};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class kse{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideHeight,s=e.strideWidth,r=e.padInfo.top,i=e.padInfo.left,o=e.outChannels/e.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * ${o} + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${t} - ${r};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${s} - ${i};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class Cse{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterHeight,s=e.filterWidth,r=e.strideHeight,i=e.strideWidth,o=t-1-e.padInfo.top,a=s-1-e.padInfo.left,l=e.outChannels/e.inChannels;this.userCode=`
      const ivec2 pads = ivec2(${o}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < ${t}; wR++) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${t} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${s} - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < ${l}; dm++) {
              int d2 = d1 * ${l} + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sse(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:i}=e,{strides:o,dilations:a,pad:l,dimRoundingMode:u,filterShape:d}=s,f=Qn(r.shape,d,o,a,l,u,!0),p=new kse(f);return t.runWebGLProgram(p,[r,i],"float32")}const Nse={kernelName:zb,backendName:"webgl",kernelFunc:Sse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ise(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:i}=e,{strides:o,dilations:a,pad:l,dimRoundingMode:u,inputShape:d}=s,f=Qn(d,i.shape,o,a,l,u,!0),p=new Cse(f);return t.runWebGLProgram(p,[r,i],"float32")}const Tse={kernelName:Bb,backendName:"webgl",kernelFunc:Ise};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $se{constructor(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ese(n){const{inputs:e,backend:t}=n,{x:s}=e,r=[...s.shape,...s.shape],i=be(s.shape),o=Me({inputs:{x:s},backend:t,attrs:{shape:[i]}}),a=new $se(i),l=t.runWebGLProgram(a,[o],o.dtype),u=Me({inputs:{x:l},backend:t,attrs:{shape:r}});return t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(l),u}const Ase={kernelName:k$,backendName:"webgl",kernelFunc:Ese};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class jse{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const{inHeight:t,inWidth:s,padInfo:r,strideHeight:i,strideWidth:o,filterHeight:a,filterWidth:l,dilationHeight:u,dilationWidth:d}=e,{top:f,left:p}=r;this.userCode=`
      const ivec2 strides = ivec2(${i}, ${o});
      const ivec2 pads = ivec2(${f}, ${p});
      const float neg_infinity = -3.4e38;

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.w;
        ivec2 outTopLeftCorner =
            coords.yz * strides - pads;
        int hBeg = outTopLeftCorner.x;
        int wBeg = outTopLeftCorner.y;

        float curVal = neg_infinity;
        for (int h = 0; h < ${a}; h++) {
          int hIn = hBeg + h * ${u};

          if (hIn >= 0 && hIn < ${t}) {
            for (int w = 0; w < ${l}; w++) {
              int wIn = wBeg + w * ${d};

              if (wIn >= 0 && wIn < ${s}) {
                float xVal = getX(batch, hIn, wIn, d1);
                float wVal = getW(h, w, d1);

                float val = xVal + wVal;
                if (val > curVal) {
                  curVal = val;
                }
              }
            }
          }
        }

        float result = curVal;
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rse(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i}=e,{strides:o,pad:a,dilations:l}=s,u=ph(r.shape,i.shape,o,a,"NHWC",l);let d;const f=new jse(u);d=t.runWebGLProgram(f,[r,i],"float32");const p=Me({inputs:{x:d},backend:t,attrs:{shape:u.outShape}});return t.disposeIntermediateTensorInfo(d),p}const Dse={kernelName:Ym,backendName:"webgl",kernelFunc:Rse};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pse(n){const{inputs:e,backend:t,attrs:s}=n,{equation:r}=s,i=e,{allDims:o,summedDims:a,idDims:l}=uw(r,i.length);hw(o.length,l,i);const{path:u,steps:d}=fw(a,l),f=d.length;let p=null,g=o.length;const x=[];for(let y=0;y<f;++y){for(const b of d[y]){const{permutationIndices:k,expandDims:w}=dw(g,l[b]);let N;pw(k)?N=i[b]:(N=ws({inputs:{x:i[b]},backend:t,attrs:{perm:k}}),x.push(N));const C=N.shape.slice();for(let S=0;S<w.length;++S)C.splice(w[S],0,1);At(N.shape,C)||(N=Me({inputs:{x:N},backend:t,attrs:{shape:C}}),x.push(N)),p===null?p=N:(p=ek({inputs:{a:N,b:p},backend:t}),x.push(p))}y<f-1&&(u[y]>=0&&(p=hx({inputs:{x:p},backend:t,attrs:{axis:u[y]-(o.length-g),keepDims:!1}}),x.push(p)),g--)}for(const y of x)y!==p&&t.disposeIntermediateTensorInfo(y);return p}const Mse={kernelName:Wb,backendName:"webgl",kernelFunc:Pse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lse="return (x >= 0.0) ? x : (exp(x) - 1.0);",Fse=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,Ose=kt({opSnippet:Lse,packedOpSnippet:Fse}),_se={kernelName:Rd,backendName:"webgl",kernelFunc:Ose};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zse="return (b >= 0.0) ? a : a * (b + 1.0);",Bse=`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,Wse=n=>{const{inputs:e,backend:t}=n,{dy:s,y:r}=e,i=me().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Oc(Bse,s.shape,r.shape):new Ja(zse,s.shape,r.shape);return t.runWebGLProgram(i,[s,r],s.dtype)},Vse={kernelName:Vb,backendName:"webgl",kernelFunc:Wse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Use=`
  return vec4(equal(a, b));
`,Gse="return float(a == b);",Hse=Yn({opSnippet:Gse,packedOpSnippet:Use,dtype:"bool",cpuKernelImpl:SJ}),qse={kernelName:Zm,backendName:"webgl",kernelFunc:Hse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kse=`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = ${sw};
  float a1 = ${rw};
  float a2 = ${iw};
  float a3 = ${ow};
  float a4 = ${aw};
  float a5 = ${lw};

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`,Qse=kt({opSnippet:Kse}),Xse={kernelName:Dd,backendName:"webgl",kernelFunc:Qse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yse=_c+`
  return exp(x);
`,Zse=`
  vec4 result = exp(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,FP=kt({opSnippet:Yse,packedOpSnippet:Zse,cpuKernelImpl:NJ,dtype:"float32"}),Jse={kernelName:Pd,backendName:"webgl",kernelFunc:FP};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wv(n){const{inputs:e,attrs:t,backend:s}=n,{dim:r}=t,{input:i}=e,o=i.shape.length,a=i.shape.slice();let l=r;return r<0&&(V(-(o+1)<=r,()=>`Axis must be in the interval [${-(o+1)}, ${o}]`),l=o+r+1),a.splice(l,0,1),Me({inputs:{x:i},backend:s,attrs:{shape:a}})}const ere={kernelName:Jm,backendName:"webgl",kernelFunc:Wv};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rI="return exp(x) - 1.0;",tre=kt({opSnippet:rI,packedOpSnippet:rI,cpuKernelImpl:IJ}),nre={kernelName:Md,backendName:"webgl",kernelFunc:tre};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class iI{constructor(e,t,s){this.variableNames=["real","imag"];const r=t[1];this.outputShape=t;const i=s?`2.0 * ${Math.PI}`:`-2.0 * ${Math.PI}`,o=s?`${r}.0`:"1.0";let a;if(e==="real")a="return real * expR - imag * expI;";else if(e==="imag")a="return real * expI + imag * expR;";else throw new Error(`FFT component must be either "real" or "imag", got ${e}.`);this.userCode=`
      const float exponentMultiplier = ${i};

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        ${a}
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(${r});
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < ${r}; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / ${o};
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OP(n,e,t){const s=t.texData.get(n.dataId),r=be(n.shape),i=n.shape[n.shape.length-1],o=r/i,a=Me({inputs:{x:n},backend:t,attrs:{shape:[o,i]}}),l=a.shape,u=new iI("real",l,e),d=new iI("imag",l,e),f=[{dataId:s.complexTensorInfos.real.dataId,dtype:s.complexTensorInfos.real.dtype,shape:l},{dataId:s.complexTensorInfos.imag.dataId,dtype:s.complexTensorInfos.imag.dtype,shape:l}],p=t.runWebGLProgram(u,f,"float32"),g=t.runWebGLProgram(d,f,"float32"),x=oa({inputs:{real:p,imag:g},backend:t});t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(g);const y=Me({inputs:{x},backend:t,attrs:{shape:n.shape}});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(x),y}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sre(n){const{inputs:e,backend:t}=n,{input:s}=e;return OP(s,!1,t)}const rre={kernelName:Ub,backendName:"webgl",kernelFunc:sre};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ire{constructor(e,t){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=e,this.userCode=`
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mh(n){const{backend:e,attrs:t}=n,{shape:s,value:r}=t;let{dtype:i}=t;if(i=i||Nc(r),i==="string"){const o=hn(i,be(s));return o.fill(r),e.makeTensorInfo(s,i,o)}else{const o=new ire(s,r),a=[[r]];return e.runWebGLProgram(o,[],i,a)}}const ore={kernelName:Gb,backendName:"webgl",kernelFunc:Mh};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class are{constructor(e){this.variableNames=["Image"],this.outputShape=[];const t=e[2];this.outputShape=e,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];

          int coordX = ${t} - x - 1;
          float outputValue;
          if(coordX >= 0 && coordX < ${t}) {
            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);
          } else {
            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lre={kernelName:Hb,backendName:"webgl",kernelFunc:({inputs:n,backend:e})=>{const{image:t}=n,s=e,r=new are(t.shape);return s.runWebGLProgram(r,[t],t.dtype)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oI="return floor(x);",cre=kt({opSnippet:oI,packedOpSnippet:oI,cpuKernelImpl:TJ}),ure={kernelName:Ld,backendName:"webgl",kernelFunc:cre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dre=`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,hre=`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,fre=Yn({opSnippet:dre,packedOpSnippet:hre,dtype:"int32"}),pre={kernelName:Fd,backendName:"webgl",kernelFunc:fre};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class mre{constructor(e){this.variableNames=["A"];const t=ks(),[s,r]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${r}.0, ${s}.0);

        vec4 values = ${t.texture2D}(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class gre{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;const t=ks(),[s,r]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(${r}.0, ${s}.0);
            vec4 values = ${t.texture2D}(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        ${t.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xre={kernelName:l_,backendName:"webgl",kernelFunc:yre};let Ll,A0=me().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");function yre(n){const{inputs:e,backend:t,attrs:s}=n;let{pixels:r}=e;const{numChannels:i}=s,o=typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement,a=typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement,[l,u]=o?[r.videoWidth,r.videoHeight]:[r.width,r.height],d=[u,l],f=[u,l,i];if(a||o){const y=me().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");(Ll==null||y!==A0)&&(A0=y,Ll=document.createElement("canvas").getContext("2d",{willReadFrequently:A0})),Ll.canvas.width=l,Ll.canvas.height=u,Ll.drawImage(r,0,0,l,u),r=Ll.canvas}const p=t.makeTensorInfo(d,"int32");t.texData.get(p.dataId).usage=ir.PIXELS,t.gpgpu.uploadPixelDataToTexture(t.getTexture(p.dataId),r);const g=me().getBool("WEBGL_PACK")?new gre(f):new mre(f),x=t.runWebGLProgram(g,[p],"int32");return t.disposeData(p.dataId),x}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vre(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i,bias:o,preluActivationWeights:a}=e,{strides:l,pad:u,dataFormat:d,dilations:f,dimRoundingMode:p,activation:g,leakyreluAlpha:x}=s,y=co(d),b=Qn(r.shape,i.shape,l,f,u,p,!1,y);let k;const w=[],N=o!=null,C=a!=null,S=g==="leakyrelu",T=()=>{const E=[r,i],M=(P,R)=>{if(R==="NCHW"&&P.shape.length===1&&P.shape[0]!==1){const L=Me({inputs:{x:P},backend:t,attrs:{shape:[P.shape[0],1,1]}});return w.push(L),L}return P};if(N&&E.push(M(o,d)),C&&E.push(M(a,d)),S){const P=t.makeTensorInfo([],"float32",Yo(x,"float32"));E.push(P),w.push(P)}return E};if(b.filterHeight===1&&b.filterWidth===1&&b.dilationHeight===1&&b.dilationWidth===1&&b.strideHeight===1&&b.strideWidth===1&&(b.padInfo.type==="SAME"||b.padInfo.type==="VALID"))k=RP({x:r,filter:i,convInfo:b,backend:t,bias:o,activation:g,preluActivationWeights:a,leakyreluAlpha:x});else if(b.strideWidth<=2&&y==="channelsLast"&&me().getBool("WEBGL_EXP_CONV")){const E=g?od(g,!0):null,M=new jP(b,N,E,C,S),P=[[b.padInfo.top,b.padInfo.left],[b.strideHeight,b.strideWidth],[b.dilationHeight,b.dilationWidth],[b.inHeight,b.inWidth]],R=T();k=t.runWebGLProgram(M,R,"float32",P)}else if(me().getBool("WEBGL_CONV_IM2COL"))k=DP({x:r,filter:i,convInfo:b,backend:t,bias:o,activation:g,preluActivationWeights:a,leakyreluAlpha:x});else{const E=g?od(g,!1):null,M=new AP(b,N,E,C,S),P=T();k=t.runWebGLProgram(M,P,"float32")}const A=Me({inputs:{x:k},backend:t,attrs:{shape:b.outShape}});return w.push(k),w.forEach(E=>t.disposeIntermediateTensorInfo(E)),A}const bre={kernelName:Hp,backendName:"webgl",kernelFunc:vre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wre(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i,bias:o,preluActivationWeights:a}=e,{strides:l,pad:u,dilations:d,dimRoundingMode:f,activation:p,leakyreluAlpha:g}=s,x=[];let y=d;y==null&&(y=[1,1]),V(rs(l,y),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${l} and dilations '${y}'`);const b=Qn(r.shape,i.shape,l,y,u,f,!0),k=me().getBool("WEBGL_PACK_DEPTHWISECONV")&&b.strideWidth<=2&&b.outChannels/b.inChannels===1,w=p?od(p,k):null,N=[r,i],C=o!=null,S=a!=null,T=p==="leakyrelu";if(C&&N.push(o),S&&N.push(a),T){const P=t.makeTensorInfo([],"float32",Yo(g,"float32"));N.push(P),x.push(P)}let A;k?A=new LP(b,C,w,S,T):A=new MP(b,C,w,S,T);const E=[[b.padInfo.top,b.padInfo.left],[b.strideHeight,b.strideWidth],[b.dilationHeight,b.dilationWidth],[b.inHeight,b.inWidth]],M=t.runWebGLProgram(A,N,"float32",E);return x.forEach(P=>t.disposeIntermediateTensorInfo(P)),M}const kre={kernelName:B$,backendName:"webgl",kernelFunc:wre};class Cre{constructor(e,t,s,r){this.sliceDim=e,this.strides=t,this.paramsShape=r,this.variableNames=["x","indices"],this.outputShape=s;const i=Pt(s.length);let o=`
    int index;`;for(let a=0;a<this.sliceDim;a++)o+=`
          index = round(getIndices(coords[0], ${a}));
          out_of_bounds = out_of_bounds || index < 0;
          out_of_bounds = out_of_bounds || index >= ${this.paramsShape[a]};
          flattenIndex += index * ${this.strides[a]};`;this.userCode=`
         void main() {
          ${i} coords = getOutputCoords();
          int flattenIndex = 0;
          bool out_of_bounds = false;

          ${o}

          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sre(n){const{inputs:e,backend:t}=n,{params:s,indices:r}=e,i=r.shape,o=i[i.length-1],a=be(s.shape),[l,u,d,f]=H1(s,r),p=Me({inputs:{x:r},backend:t,attrs:{shape:[u,o]}}),g=Me({inputs:{x:s},backend:t,attrs:{shape:[be(s.shape)/d,d]}});if(t.shouldExecuteOnCPU([s,r])||s.dtype==="string"){const k=t.readSync(r.dataId),w=t.bufferSync(s),N=$J(k,w,s.dtype,u,o,d,f,s.shape,a);return t.makeTensorInfo(l,s.dtype,N.values)}const x=new Cre(o,f,[u,d],s.shape),y=t.runWebGLProgram(x,[g,p],g.dtype),b=Me({inputs:{x:y},backend:t,attrs:{shape:l}});return t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(y),b}const Nre={kernelName:C$,backendName:"webgl",kernelFunc:Sre};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ire{constructor(e,t){this.variableNames=["A","indices"],this.outputShape=t,this.rank=t.length;const s=Pt(this.rank),r=Tre(e);this.userCode=`
      void main() {
        ${s} resRC = getOutputCoords();
        int index = int(getIndices(resRC.x, resRC.z));
        float inBounds = (index >= 0) && (index < ${e[2]}) ? 1.0 : 0.0;
        setOutput(inBounds * getA(${r}));
      }
    `}}function Tre(n,e){const t=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[];for(let r=0;r<n.length;r++)r===2?s.push("index"):s.push(`${t[r]}`);return s.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _P(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,indices:i}=e,{axis:o,batchDims:a}=s,l=ht(o,r.shape)[0];if(me().get("DEBUG")){const w=t.readSync(i.dataId),N=r.shape[l];for(let C=0;C<w.length;++C){const S=w[C];V(S<=N-1&&S>=0,()=>`GatherV2: the index value ${S} is not in [0, ${N-1}]`)}}const u=gw(r,i,l,a),d=be(i.shape),f=[],p=Me({inputs:{x:r},backend:t,attrs:{shape:[u.batchSize,u.outerSize,u.dimSize,u.sliceSize]}}),g=Me({inputs:{x:i},backend:t,attrs:{shape:[u.batchSize,d/u.batchSize]}});f.push(p),f.push(g);const x=[u.batchSize,u.outerSize,d/u.batchSize,u.sliceSize];if(t.shouldExecuteOnCPU([r,i])||r.dtype==="string"){const w=t.bufferSync(g),N=t.bufferSync(p),C=EJ(N,w,x);return f.forEach(S=>t.disposeIntermediateTensorInfo(S)),t.makeTensorInfo(u.outputShape,C.dtype,C.values)}const y=new Ire(p.shape,x),b=t.runWebGLProgram(y,[p,g],p.dtype);f.push(b);const k=Me({inputs:{x:b},backend:t,attrs:{shape:u.outputShape}});return f.forEach(w=>t.disposeIntermediateTensorInfo(w)),k}const $re={kernelName:tg,backendName:"webgl",kernelFunc:_P};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ere="return float(a > b);",Are=`
  return vec4(greaterThan(a, b));
`,jre=Yn({opSnippet:Ere,packedOpSnippet:Are,cpuKernelImpl:AJ,dtype:"bool"}),Rre={kernelName:ng,backendName:"webgl",kernelFunc:jre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dre="return float(a >= b);",Pre=`
  return vec4(greaterThanEqual(a, b));
`,Mre=Yn({opSnippet:Dre,packedOpSnippet:Pre,dtype:"bool",cpuKernelImpl:jJ}),Lre={kernelName:Od,backendName:"webgl",kernelFunc:Mre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fre(n){const{inputs:e,backend:t}=n,{input:s}=e;return OP(s,!0,t)}const Ore={kernelName:qb,backendName:"webgl",kernelFunc:Fre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _re="return float(!isnan(x) && !isinf(x));",zre=kt({opSnippet:_re,dtype:"bool"}),Bre={kernelName:zd,backendName:"webgl",kernelFunc:zre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wre="return float(isinf(x));",Vre=kt({opSnippet:Wre,dtype:"bool"}),Ure={kernelName:Bd,backendName:"webgl",kernelFunc:Vre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gre="return float(isnan(x));",Hre=kt({opSnippet:Gre,dtype:"bool"}),qre={kernelName:Wd,backendName:"webgl",kernelFunc:Hre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kre="return float(a < b);",Qre=`
  return vec4(lessThan(a, b));
`,Xre=Yn({opSnippet:Kre,packedOpSnippet:Qre,cpuKernelImpl:RJ,dtype:"bool"}),Yre={kernelName:rg,backendName:"webgl",kernelFunc:Xre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zre="return float(a <= b);",Jre=`
  return vec4(lessThanEqual(a, b));
`,eie=Yn({opSnippet:Zre,packedOpSnippet:Jre,cpuKernelImpl:DJ,dtype:"bool"}),tie={kernelName:ig,backendName:"webgl",kernelFunc:eie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nie(n){const{backend:e,attrs:t}=n,{start:s,stop:r,num:i}=t,o=PJ(s,r,i);return e.makeTensorInfo([o.length],"float32",o)}const sie={kernelName:S$,backendName:"webgl",kernelFunc:nie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rie=_c+`
  return x < 0.0 ? 0./0. : log(x);
`,iie=`
  vec4 result = log(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);
  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);
  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);
  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);
  return result;
`,oie=kt({opSnippet:rie,packedOpSnippet:iie,cpuKernelImpl:MJ}),aie={kernelName:Vd,backendName:"webgl",kernelFunc:oie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lie=_c+`
  return log(1.0 + x);
`,cie=kt({opSnippet:lie}),uie={kernelName:Ud,backendName:"webgl",kernelFunc:cie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const die="return float(a >= 1.0 && b >= 1.0);",hie=`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,fie=Yn({opSnippet:die,packedOpSnippet:hie,dtype:"bool"}),pie={kernelName:og,backendName:"webgl",kernelFunc:fie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mie="return float(!(x >= 1.0));",gie=kt({opSnippet:mie}),xie={kernelName:ag,backendName:"webgl",kernelFunc:gie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yie="return float(a >= 1.0 || b >= 1.0);",vie=`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,bie=Yn({opSnippet:yie,packedOpSnippet:vie,dtype:"bool"}),wie={kernelName:lg,backendName:"webgl",kernelFunc:bie};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class kie{constructor(e,t,s,r,i){this.variableNames=["x"],this.outputShape=[];const o=t,a=e[3]-1;this.outputShape=e;let l;const u=`float(${s}) + float(${r}) * sum`;i===.5?l=`inversesqrt(${u})`:i===1?l=`1.0/(${u})`:l=`exp(log(${u}) * float(-${i}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -${o}; j <= ${o}; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  ${a}) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * ${l};
        setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Cie{constructor(e,t,s,r,i){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;const o=t,a=e[3]-1;this.outputShape=e;let l;const u=`float(${s}) + float(${r}) * sum`;i===.5?l=`inversesqrt(${u})`:i===1?l=`1.0/(${u})`:l=`exp(log(${u}) * float(-${i}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < ${this.outputShape[3]};
        bool hasNextRow = c < ${this.outputShape[2]};

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - ${o};
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - ${o}; j <= ${o}; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(${a}));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * ${l};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Sie=n=>{const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{depthRadius:i,bias:o,alpha:a,beta:l}=s,u=me().getBool("WEBGL_PACK_NORMALIZATION")?new Cie(r.shape,i,o,a,l):new kie(r.shape,i,o,a,l);return t.runWebGLProgram(u,[r],r.dtype)},Nie={kernelName:cg,backendName:"webgl",kernelFunc:Sie};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Iie{constructor(e,t,s,r,i){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=t,this.bias=s,this.alpha=r,this.beta=i,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < ${this.depth}; ++d) {
          int depthBegin = int(max(0.0, float(d - ${t})));
          int depthEnd = int(min(float(${this.depth}),
              float(d + ${t} + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = ${this.depth};

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(${r}) * norm + float(${s});

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(${r})
                * float(${i})
                * getInputImage(b, r, c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * ${i});
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tie=n=>{const{inputs:e,backend:t,attrs:s}=n,{x:r,y:i,dy:o}=e,{depthRadius:a,bias:l,alpha:u,beta:d}=s,f=new Iie(r.shape,a,l,u,d);return t.runWebGLProgram(f,[r,i,o],r.dtype)},$ie={kernelName:Qb,backendName:"webgl",kernelFunc:Tie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Eie(n,e,t,s){const r=be(e),o=be(n.shape)/r,a=Me({inputs:{x:n},attrs:{shape:[o,r]},backend:s}),l=ul(a,n.dtype,"max",s),u=Me({inputs:{x:l},attrs:{shape:t},backend:s});return s.disposeIntermediateTensorInfo(a),s.disposeIntermediateTensorInfo(l),u}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zP(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{reductionIndices:i,keepDims:o}=s,a=r.shape.length,l=ht(i,r.shape);let u=l;const d=tn(u,a),f=d!=null,p=t.shouldExecuteOnCPU([r]);let g=r;if(f){if(p){const N=t.texData.get(g.dataId).values,C=new Array(a);for(let A=0;A<C.length;A++)C[A]=r.shape[d[A]];const S=Zw(N,r.shape,r.dtype,d,C);g=t.makeTensorInfo(C,r.dtype);const T=t.texData.get(g.dataId);T.values=S}else g=dx(r,d,t);u=mn(u.length,a)}Xn("max",u,a);const[x,y]=zn(g.shape,u);let b=x;o&&(b=kn(x,l));let k;if(p){const N=t.texData.get(g.dataId).values,C=LJ(N,be(y),b,r.dtype);k=t.makeTensorInfo(b,r.dtype);const S=t.texData.get(k.dataId);S.values=C}else k=Eie(g,y,b,t);return f&&t.disposeIntermediateTensorInfo(g),k}const Aie={kernelName:ug,backendName:"webgl",kernelFunc:zP};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jie=Jw+`
  return max(a, b);
`,Rie=`
  vec4 result = vec4(max(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+cl+`
  return result;
`,Die=Yn({opSnippet:jie,packedOpSnippet:Rie,cpuKernelImpl:FJ}),Pie={kernelName:Gd,backendName:"webgl",kernelFunc:Die};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mie(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e;Rh(r,"maxPool");const{filterSize:i,strides:o,pad:a,dimRoundingMode:l}=s,u=1;V(rs(o,u),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${u}'`);const d=Ar(r.shape,i,o,u,a,l);if(d.filterWidth===1&&d.filterHeight===1&&At(d.inShape,d.outShape))return Xs({inputs:{x:r},backend:t});const f=new ad(d,"max",!1);return t.runWebGLProgram(f,[r],r.dtype)}const Lie={kernelName:dg,backendName:"webgl",kernelFunc:Mie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fie(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{filterSize:i,strides:o,pad:a,dataFormat:l,dimRoundingMode:u}=s,d=[1,1,1],f=lo(r.shape,i,o,d,a,u,l),p=new tk(f,"max",!1);return t.runWebGLProgram(p,[r],r.dtype)}const Oie={kernelName:hg,backendName:"webgl",kernelFunc:Fie};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _ie{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const t=e.strideHeight,s=e.strideWidth,r=e.dilationHeight,i=e.effectiveFilterHeight,o=e.effectiveFilterWidth,a=i-1-e.padInfo.top,l=o-1-e.padInfo.left,u=i*o-1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${i};
          wR += ${r}) {
          float dyR = float(dyRCorner + wR) / ${t}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${o}; wC++) {
            float dyC = float(dyCCorner + wC) / ${s}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = ${u} - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * ${o} + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}}class zie{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const t=e.strideDepth,s=e.strideHeight,r=e.strideWidth,i=e.dilationDepth,o=e.dilationHeight,a=e.dilationWidth,l=e.effectiveFilterDepth,u=e.effectiveFilterHeight,d=e.effectiveFilterWidth,f=l-1-e.padInfo.front,p=u-1-e.padInfo.top,g=d-1-e.padInfo.left,x=l*u*d-1;this.userCode=`
      const ivec3 pads = ivec3(${f}, ${p}, ${g});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${l};
           wD += ${i}) {
          float dyD = float(dyDCorner + wD) / ${t}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${u};
              wR += ${o}) {
            float dyR = float(dyRCorner + wR) / ${s}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${d};
                wC += ${a}) {
              float dyC = float(dyCCorner + wC) / ${r}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = ${x} -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * ${u} * ${d} +
                  wR * ${d} + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bie(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:i}=e,o=i,{filterSize:a,strides:l,pad:u,dimRoundingMode:d}=s,f=[1,1,1],p=lo(o.shape,a,l,f,u,d),g=new tk(p,"max",!0),x=t.runWebGLProgram(g,[o],o.dtype),y=new zie(p),b=t.runWebGLProgram(y,[r,x],o.dtype);return t.disposeIntermediateTensorInfo(x),b}const Wie={kernelName:Yb,backendName:"webgl",kernelFunc:Bie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vie(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:i,output:o}=e,a=i;Rh([i,o],"maxPoolGrad");const{filterSize:l,strides:u,pad:d,dimRoundingMode:f}=s,p=Ar(a.shape,l,u,1,d,f),g=!0,x=new ad(p,"max",g),y=t.runWebGLProgram(x,[a],a.dtype),b=new _ie(p),k=t.runWebGLProgram(b,[r,y],a.dtype);return t.disposeIntermediateTensorInfo(y),k}const Uie={kernelName:Xb,backendName:"webgl",kernelFunc:Vie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gie(n,e,t,s){let r=new ad(t,"max",!1);const i=s.runWebGLProgram(r,[n],"float32");r=new ad(t,"max",!0,!0,e);const o=s.runWebGLProgram(r,[n],"float32");return[i,o]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hie={kernelName:N$,backendName:"webgl",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{x:s}=n,{filterSize:r,strides:i,pad:o,includeBatchInIndex:a}=e,l=t;V(s.shape.length===4,()=>`Error in maxPool: input must be rank 4 but got rank ${s.shape.length}.`);const u=[1,1];V(rs(i,u),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${u}'`);const d=Ar(s.shape,r,i,u,o),[f,p]=Gie(s,a,d,l);return[f,p]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qie(n,e,t,s){const r=be(e),o=be(n.shape)/r,a=Me({inputs:{x:n},attrs:{shape:[o,r]},backend:s}),l=ul(a,"float32","mean",s),u=Me({inputs:{x:l},attrs:{shape:t},backend:s});return s.disposeIntermediateTensorInfo(a),s.disposeIntermediateTensorInfo(l),u}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kie={kernelName:fg,backendName:"webgl",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{x:s}=n,{keepDims:r,axis:i}=e,o=t,a=s.shape.length,l=ht(i,s.shape);let u=l;const d=tn(u,a),f=d!=null,p=o.shouldExecuteOnCPU([s]),g=[];let x=s;if(f){if(p){const C=o.texData.get(x.dataId).values,S=new Array(a);for(let E=0;E<S.length;E++)S[E]=s.shape[d[E]];const T=Zw(C,s.shape,s.dtype,d,S);x=o.makeTensorInfo(S,s.dtype);const A=o.texData.get(x.dataId);A.values=T}else x=dx(s,d,o);g.push(x),u=mn(u.length,a)}Xn("sum",u,a);const[y,b]=zn(x.shape,u);let k=y;r&&(k=kn(y,l));const w=qie(x,b,k,o);for(const N of g)o.disposeIntermediateTensorInfo(N);return w}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qie(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:o}=s,a=r.shape.length,l=ht(i,r.shape);let u=l;const d=tn(u,a);let f=r;d!=null&&(f=ws({inputs:{x:r},backend:t,attrs:{perm:d}}),u=mn(u.length,r.shape.length)),Xn("min",u,a);const[p,g]=zn(f.shape,u),x=be(g),y=Me({inputs:{x:f},backend:t,attrs:{shape:[-1,x]}}),b=ul(y,y.dtype,"min",t);let k;if(o){const w=kn(p,l);k=Me({inputs:{x:b},backend:t,attrs:{shape:w}})}else k=Me({inputs:{x:b},backend:t,attrs:{shape:p}});return t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(b),d!=null&&t.disposeIntermediateTensorInfo(f),k}const Xie={kernelName:pg,backendName:"webgl",kernelFunc:Qie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yie=Jw+`
  return min(a, b);
`,Zie=`
  vec4 result = vec4(min(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+cl+`
  return result;
`,Jie=Yn({opSnippet:Yie,packedOpSnippet:Zie,cpuKernelImpl:OJ}),eoe={kernelName:Hd,backendName:"webgl",kernelFunc:Jie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class toe{constructor(e,t,s){this.variableNames=["x"],this.outputShape=t.map((d,f)=>d[0]+e[f]+d[1]);const r=e.length,i=Pt(r),o=t.map(d=>d[0]).join(","),a=t.map((d,f)=>d[0]+e[f]).join(","),l=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r),u=s==="reflect"?0:1;if(r===1){this.userCode=`
        int start = ${o};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start) {
            outC = start * 2 - outC - ${u};
          } else if(outC >= end) {
            outC = (end - 1) * 2 - outC + ${u};
          }
          setOutput(getX(outC - start));
        }
      `;return}this.userCode=`
      ${i} start = ${i}(${o});
      ${i} end = ${i}(${a});

      void main() {
        ${i} outC = getOutputCoords();
        for (int i = 0; i < ${r}; i++) {
          if (outC[i] < start[i]) {
            outC[i] = start[i] * 2 - outC[i] - ${u};
          } else if(outC[i] >= end[i]) {
            outC[i] = (end[i] - 1) * 2 - outC[i] + ${u};
          }
        }
        ${i} coords = outC - start;
        setOutput(getX(${l}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class noe{constructor(e,t,s){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.map((x,y)=>x[0]+e[y]+x[1]);const r=e.length,i=Pt(r),o=t.map(x=>x[0]).join(","),a=t.map((x,y)=>x[0]+e[y]).join(","),l=vs("rc",r),u=vs("source",r),d=`${l[r-1]} < ${this.outputShape[r-1]}`,f=r===1?"source":`vec2(${u.slice(-2).join()})`,p=s==="reflect"?0:1;let g="";if(r===1){const x=`
        ${i} source = rc;
        if (source < start) {
          source = start * 2 - source - ${p};
        } else if (source >= end) {
          source = (end - 1) * 2 - source + ${p};
        }
        source -= start;
      `;g=`
        ${i} rc = outputLoc;
        ${x}
        result[0] = getChannel(getX(${u.join()}), ${f});
        ${l[r-1]} += 1;
        if(${d}) {
          ${x}
          result[1] = getChannel(getX(${u.join()}), ${f});
        }
      `}else{const x=`
        ${i} source = rc;
        ${i} lt = ${i}(lessThan(source, start));
        ${i} gte = ${i}(greaterThanEqual(source, end));
        ${i} orig = 1 - (lt + gte);
        source = orig * source +
                lt * (start * 2 - source - ${p}) +
                gte * ((end - 1) * 2 - source + ${p});
        source -= start;
      `;g=`
        ${i} rc = outputLoc;
        ${x}
        result[0] = getChannel(getX(${u.join()}), ${f});
        ${l[r-1]} += 1;
        if(${d}) {
          ${x}
          result[1] = getChannel(getX(${u.join()}), ${f});
        }
        rc = outputLoc;
        ${l[r-2]} += 1;
        if(${l[r-2]} < ${this.outputShape[r-2]}) {
          ${x}
          result[2] = getChannel(getX(${u.join()}), ${f});
          ${l[r-1]} += 1;
          if(${d}) {
            ${x}
            result[3] = getChannel(getX(${u.join()}), ${f});
          }
        }
      `}this.userCode=`
      const ${i} start = ${i}(${o});
      const ${i} end = ${i}(${a});

      void main() {
        ${i} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${g}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const soe=({inputs:n,backend:e,attrs:t})=>{const{x:s}=n,{paddings:r,mode:i}=t,o=me().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new noe(s.shape,r,i):new toe(s.shape,r,i);return e.runWebGLProgram(o,[s],s.dtype)},roe={kernelName:mg,backendName:"webgl",kernelFunc:soe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ioe=`if (b == 0.0) return NAN;
  return mod(a, b);`,ooe=`
  vec4 result = mod(a, b);
  bvec4 isNaN = equal(b, vec4(0.0));
  `+cl+`
  return result;
`,aoe=Yn({opSnippet:ioe,packedOpSnippet:ooe}),loe={kernelName:qd,backendName:"webgl",kernelFunc:aoe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class coe{constructor(e,t,s){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[e,s],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < ${t-1}; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(${t-1}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uoe=`
if (a == b) {
  return 1.0;
};
return a / b;`,doe=`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,BP=Yn({opSnippet:uoe,packedOpSnippet:doe,checkOutOfBounds:!0}),hoe={kernelName:jd,backendName:"webgl",kernelFunc:BP};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aI="return a - b;",WP=Yn({opSnippet:aI,packedOpSnippet:aI,supportsComplex:!0,cpuKernelImpl:iee}),foe={kernelName:ch,backendName:"webgl",kernelFunc:WP};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VP(n){const{inputs:e,backend:t,attrs:s}=n,{logits:r}=e,{dim:i}=s,o=ht([i],r.shape),a=zP({inputs:{x:r},backend:t,attrs:{reductionIndices:o,keepDims:!1}}),l=kn(a.shape,o),u=Me({inputs:{x:a},backend:t,attrs:{shape:l}}),d=WP({inputs:{a:r,b:u},backend:t}),f=FP({inputs:{x:d},backend:t}),p=hx({inputs:{x:f},backend:t,attrs:{axis:o,keepDims:!1}}),g=Me({inputs:{x:p},backend:t,attrs:{shape:l}}),x=BP({inputs:{a:f,b:g},backend:t});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(u),t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(g),x}const poe={kernelName:Dg,backendName:"webgl",kernelFunc:VP};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function moe(n){const{inputs:e,backend:t,attrs:s}=n,{logits:r}=e,{numSamples:i,seed:o,normalized:a}=s,l=a?r:VP({inputs:{logits:r},backend:t,attrs:{dim:r.shape.length-1}}),u=l.shape[0],d=l.shape[1],f=new coe(u,d,i),p=[[o]],g=t.runWebGLProgram(f,[l],"int32",p);return a||t.disposeIntermediateTensorInfo(l),g}const goe={kernelName:I$,backendName:"webgl",kernelFunc:moe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xoe=Rr+`
  return -x;
`,yoe=`
  vec4 result = -x;
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`;function voe(n){const{inputs:e,backend:t}=n,{x:s}=e;if(t.shouldExecuteOnCPU([s])){const i=t.texData.get(s.dataId),[o,a]=zJ(i.values,s.shape,s.dtype);return t.makeTensorInfo(a,s.dtype,o)}let r;return me().getBool("WEBGL_PACK_UNARY_OPERATIONS")?r=new Fo(s.shape,yoe):r=new vi(s.shape,xoe),t.runWebGLProgram(r,[s],s.dtype)}const boe={kernelName:gg,backendName:"webgl",kernelFunc:voe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const woe=z1;function koe(n){rr("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l}=s,u=t.readSync(r.dataId),d=t.readSync(i.dataId),{selectedIndices:f}=woe(u,d,o,a,l);return t.makeTensorInfo([f.length],"int32",new Int32Array(f))}const Coe={kernelName:Zb,backendName:"webgl",kernelFunc:koe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Soe=B1;function Noe(n){rr("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l,padToMaxOutputSize:u}=s,d=t.readSync(r.dataId),f=t.readSync(i.dataId),{selectedIndices:p,validOutputs:g}=Soe(d,f,o,a,l,u);return[t.makeTensorInfo([p.length],"int32",new Int32Array(p)),t.makeTensorInfo([],"int32",new Int32Array([g]))]}const Ioe={kernelName:Jb,backendName:"webgl",kernelFunc:Noe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Toe=W1;function $oe(n){rr("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l,softNmsSigma:u}=s,d=t.readSync(r.dataId),f=t.readSync(i.dataId),p=o,g=a,x=l,y=u,{selectedIndices:b,selectedScores:k}=Toe(d,f,p,g,x,y);return[t.makeTensorInfo([b.length],"int32",new Int32Array(b)),t.makeTensorInfo([k.length],"float32",new Float32Array(k))]}const Eoe={kernelName:e1,backendName:"webgl",kernelFunc:$oe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Aoe{constructor(e,t,s,r){this.variableNames=["indices"],this.outputShape=[e,t],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(${r}), float(${s}),
                      float(index == coords.y)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const joe=n=>{const{inputs:e,backend:t,attrs:s}=n,{indices:r}=e,{dtype:i,depth:o,onValue:a,offValue:l}=s,u=be(r.shape),d=new Aoe(u,o,a,l),f=Me({inputs:{x:r},backend:t,attrs:{shape:[u]}}),p=t.runWebGLProgram(d,[f],i);t.disposeIntermediateTensorInfo(f);const g=[...r.shape,o],x=Me({inputs:{x:p},backend:t,attrs:{shape:g}});return t.disposeIntermediateTensorInfo(p),x},Roe={kernelName:vg,backendName:"webgl",kernelFunc:joe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vm(n){const{inputs:e,backend:t}=n,{x:s}=e;if(s.dtype==="complex64"){const r=Ph({inputs:{input:s},backend:t}),i=vm({inputs:{x:r},backend:t}),o=fx({inputs:{input:s},backend:t}),a=vm({inputs:{x:o},backend:t}),l=oa({inputs:{real:i,imag:a},backend:t});return t.disposeIntermediateTensorInfo(r),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(a),l}else return Mh({attrs:{shape:s.shape,dtype:s.dtype,value:s.dtype==="string"?"":0},backend:t})}const Doe={kernelName:Lg,backendName:"webgl",kernelFunc:vm};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UP(n){const{inputs:e,backend:t}=n,{x:s}=e;if(s.dtype==="string")throw new Error("onesLike is not supported under string dtype");if(s.dtype==="complex64"){const r=Ph({inputs:{input:s},backend:t}),i=UP({inputs:{x:r},backend:t}),o=fx({inputs:{input:s},backend:t}),a=vm({inputs:{x:o},backend:t}),l=oa({inputs:{real:i,imag:a},backend:t});return t.disposeIntermediateTensorInfo(r),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(a),l}else return Mh({attrs:{shape:s.shape,dtype:s.dtype,value:1},backend:t})}const Poe={kernelName:yg,backendName:"webgl",kernelFunc:UP};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Moe(n){const{inputs:e,backend:t,attrs:s}=n,{axis:r}=s;if(e.length===1)return Wv({inputs:{input:e[0]},backend:t,attrs:{dim:r}});const i=e[0].shape,o=e[0].dtype;e.forEach(d=>{wb(i,d.shape,"All tensors passed to stack must have matching shapes"),V(o===d.dtype,()=>"All tensors passed to stack must have matching dtypes")});const a=[],l=e.map(d=>{const f=Wv({inputs:{input:d},backend:t,attrs:{dim:r}});return a.push(f),f}),u=EP({inputs:l,backend:t,attrs:{axis:r}});return a.forEach(d=>t.disposeIntermediateTensorInfo(d)),u}const Loe={kernelName:bg,backendName:"webgl",kernelFunc:Moe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Foe{constructor(e,t,s){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map((u,d)=>u[0]+e[d]+u[1]);const r=e.length,i=Pt(r),o=t.map(u=>u[0]).join(","),a=t.map((u,d)=>u[0]+e[d]).join(","),l=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);if(r===1){this.userCode=`
        int start = ${o};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(value);
          } else {
            setOutput(getX(outC - start));
          }
        }
      `;return}this.userCode=`
      ${i} start = ${i}(${o});
      ${i} end = ${i}(${a});

      void main() {
        ${i} outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(value);
        } else {
          ${i} coords = outC - start;
          setOutput(getX(${l}));
        }
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ooe{constructor(e,t,s){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map((y,b)=>y[0]+e[b]+y[1]);const r=e.length,i=Pt(r),o=t.map(y=>y[0]).join(","),a=t.map((y,b)=>y[0]+e[b]).join(","),l=vs("rc",r),u=vs("source",r),d=`${l[r-1]} < ${this.outputShape[r-1]}`,f=r===1?"source":`vec2(${u.slice(-2).join()})`,p=[`${i} rc = outputLoc;`,`${l[r-1]} += 1;
       if(${d}) {
      `,r===1?"":`}
       rc = outputLoc;
       ${l[r-2]} += 1;
       if(${l[r-2]} < ${this.outputShape[r-2]}) {`,r===1?"":`  ${l[r-1]} += 1;
         if(${d}) {`],g=r===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))";let x="";for(let y=0,b=r===1?2:4;y<b;y++)x+=`
        ${p[y]}
        if (${g}) {
          result[${y}] = float(value);
        } else {
          ${i} source = rc - start;
          result[${y}] = getChannel(getX(${u.join()}), ${f});
        }
      `;x+=r===1?"} ":"}}",this.userCode=`
      const ${i} start = ${i}(${o});
      const ${i} end = ${i}(${a});

      void main() {
        ${i} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${x}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GP=n=>{const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{paddings:i,constantValue:o}=s;if(be(r.shape)===0){const u=i.map((d,f)=>d[0]+r.shape[f]+d[1]);return Mh({backend:t,attrs:{shape:u,value:o,dtype:r.dtype}})}const a=me().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Ooe(r.shape,i,o):new Foe(r.shape,i,o),l=[[o]];return t.runWebGLProgram(a,[r],r.dtype,l)},_oe={kernelName:wg,backendName:"webgl",kernelFunc:GP};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zoe=`
  if(a < 0.0 && floor(b) < b){
    return NAN;
  }
  if (b == 0.0) {
    return 1.0;
  }
  return (round(mod(b, 2.0)) != 1) ?
      pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,Boe=`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  bvec4 isNaN1 = lessThan(a, vec4(0.0));
  bvec4 isNaN2 = lessThan(floor(b), b);
  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);
  `+cl+`
  return result;
`,Woe=Yn({opSnippet:zoe,packedOpSnippet:Boe}),Voe={kernelName:Qd,backendName:"webgl",kernelFunc:Woe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uoe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:o}=s,a=r.shape.length,l=[],u=ht(i,r.shape);let d=u;const f=tn(d,a);let p=r;f!=null&&(p=ws({inputs:{x:r},backend:t,attrs:{perm:f}}),d=mn(d.length,a),l.push(p)),Xn("prod",d,a);let g;if(t.shouldExecuteOnCPU([p])){const x=t.texData.get(p.dataId).values,{outVals:y,outShape:b,outDtype:k}=WJ(p.shape,p.dtype,x,d);g=t.makeTensorInfo(b,k,y)}else{const[x,y]=zn(p.shape,d),b=be(y),k=Me({inputs:{x:p},backend:t,attrs:{shape:[-1,b]}}),w=h1(r.dtype),N=ul(k,w,"prod",t);g=Me({inputs:{x:N},backend:t,attrs:{shape:x}}),l.push(k),l.push(N)}if(o){l.push(g);const x=kn(g.shape,u);g=Me({inputs:{x:g},backend:t,attrs:{shape:x}})}return l.forEach(x=>t.disposeIntermediateTensorInfo(x)),g}const Goe={kernelName:Cg,backendName:"webgl",kernelFunc:Uoe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hoe(n){const{inputs:e,backend:t,attrs:s}=n,{paramsNestedSplits:r,paramsDenseValues:i,indices:o}=e,{outputRaggedRank:a}=s,l=r.map(k=>t.readSync(k.dataId)),u=r.map(k=>k.shape),d=t.readSync(i.dataId),f=t.readSync(o.dataId),[p,g,x]=VJ(l,u,d,i.shape,i.dtype,f,o.shape,a),y=p.map(k=>t.makeTensorInfo([k.length],"int32",k)),b=t.makeTensorInfo(x,i.dtype,g);return y.concat([b])}const qoe={kernelName:T$,backendName:"webgl",kernelFunc:Hoe};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Koe(n){const{inputs:e,backend:t}=n,{starts:s,limits:r,deltas:i}=e,o=t.readSync(s.dataId),a=t.readSync(r.dataId),l=t.readSync(i.dataId),[u,d]=UJ(o,s.shape,s.dtype,a,r.shape,l,i.shape),f=t.makeTensorInfo([u.length],"int32",u),p=t.makeTensorInfo([d.length],s.dtype,d);return[f,p]}const Qoe={kernelName:$$,backendName:"webgl",kernelFunc:Koe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xoe(n){const{inputs:e,backend:t,attrs:s}=n,{shape:r,values:i,defaultValue:o,rowPartitionTensors:a}=e,{rowPartitionTypes:l}=s,u=t.readSync(r.dataId),d=t.readSync(i.dataId),f=t.readSync(o.dataId),p=a.map(b=>t.readSync(b.dataId)),g=a.map(b=>b.shape),[x,y]=GJ(u,r.shape,d,i.shape,i.dtype,f,o.shape,p,g,l);return t.makeTensorInfo(x,i.dtype,y)}const Yoe={kernelName:E$,backendName:"webgl",kernelFunc:Xoe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HP=n=>{const{backend:e,attrs:t}=n,{start:s,stop:r,step:i,dtype:o}=t,a=HJ(s,r,i,o);return e.makeTensorInfo([a.length],o,a)},Zoe={kernelName:t1,backendName:"webgl",kernelFunc:HP};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Joe="return 1.0 / x;",eae=kt({opSnippet:Joe}),tae={kernelName:Xd,backendName:"webgl",kernelFunc:eae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nae=Rr+`
  return (x < 0.0) ? 0.0 : x;
`,sae=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,rae=kt({opSnippet:nae,packedOpSnippet:sae}),iae={kernelName:Yd,backendName:"webgl",kernelFunc:rae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oae=Rr+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,aae=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,lae=kt({opSnippet:oae,packedOpSnippet:aae}),cae={kernelName:Zd,backendName:"webgl",kernelFunc:lae};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class uae{constructor(e,t,s,r,i){this.variableNames=["A"],this.outputShape=[];const[o,a,l,u]=e;this.outputShape=[o,t,s,u];const d=[r&&t>1?a-1:a,r&&s>1?l-1:l],f=[r&&t>1?t-1:t,r&&s>1?s-1:s];let p;i?p="(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":p="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${d[0]/f[0]},
          ${d[1]/f[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${l}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${p};

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class dae{constructor(e,t,s,r,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[o,a,l,u]=e;this.outputShape=[o,t,s,u];const d=[r&&t>1?a-1:a,r&&s>1?l-1:l],f=[r&&t>1?t-1:t,r&&s>1?s-1:s];let p;i?p="(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":p="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${d[0]/f[0]},
          ${d[1]/f[1]},
          ${d[1]/f[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${l}.0,
                                     ${l}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${p};

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${u-1};
        bool hasNextRow = coords.z < ${s-1};

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hae(n){const{inputs:e,backend:t,attrs:s}=n,{images:r}=e,{alignCorners:i,halfPixelCenters:o,size:a}=s,[l,u]=a,d=me().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new dae(r.shape,l,u,i,o):new uae(r.shape,l,u,i,o);return t.runWebGLProgram(d,[r],"float32")}const fae={kernelName:Ig,backendName:"webgl",kernelFunc:hae};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class pae{constructor(e,t,s){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;const[,r,i]=t,[,o,a]=e,l=[s&&o>1?r-1:r,s&&a>1?i-1:i],u=[s&&o>1?o-1:o,s&&a>1?a-1:a],d=l[0]/u[0],f=l[1]/u[1],p=1/d,g=1/f,x=Math.ceil(p)*2+2,y=Math.ceil(g)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${d});
        const float widthScale = float(${f});

        const float invHeightScale = float(${p});
        const float invWidthScale = float(${g});

        const int winHeight = int(${x});
        const int winWidth = int(${y});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${o}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), ${r-1}.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), ${i-1}.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mae(n){const{inputs:e,backend:t,attrs:s}=n,{images:r,dy:i}=e,{alignCorners:o}=s,a=new pae(i.shape,r.shape,o);return t.runWebGLProgram(a,[i],i.dtype)}const gae={kernelName:r1,backendName:"webgl",kernelFunc:mae};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class xae{constructor(e,t,s,r,i){this.variableNames=["A"],this.outputShape=[];const[o,a,l,u]=e;this.outputShape=[o,t,s,u];const d=[r&&t>1?a-1:a,r&&s>1?l-1:l],f=[r&&t>1?t-1:t,r&&s>1?s-1:s],p=r?"0.5":"0.0";let g;i?g="max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":g="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${d[0]/f[0]},
          ${d[1]/f[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${l}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${g};

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${p})));
        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class yae{constructor(e,t,s,r,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[o,a,l,u]=e;this.outputShape=[o,t,s,u];const d=[r&&t>1?a-1:a,r&&s>1?l-1:l],f=[r&&t>1?t-1:t,r&&s>1?s-1:s],p=r?"0.5":"0.0";let g;i?g="max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":g="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${d[0]/f[0]},
          ${d[1]/f[1]},
          ${d[1]/f[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${l}.0,
                                     ${l}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${g};

        // Compute the coordinators of nearest neighbor point.
        ivec3 sourceNearestRC = ivec3(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${p})));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${u-1};
        bool hasNextRow = coords.z < ${s-1};

        vec4 newValue = vec4(
          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),
          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vae(n){const{inputs:e,backend:t,attrs:s}=n,{images:r}=e,{alignCorners:i,halfPixelCenters:o,size:a}=s,[l,u]=a,d=me().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new yae(r.shape,l,u,i,o):new xae(r.shape,l,u,i,o);return t.runWebGLProgram(d,[r],r.dtype)}const bae={kernelName:Ng,backendName:"webgl",kernelFunc:vae};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class wae{constructor(e,t,s){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;const[,r,i]=t,[,o,a]=e,l=[s&&o>1?r-1:r,s&&a>1?i-1:i],u=[s&&o>1?o-1:o,s&&a>1?a-1:a],d=l[0]/u[0],f=l[1]/u[1],p=1/d,g=1/f,x=Math.ceil(p)*2+2,y=Math.ceil(g)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${d});
        const float widthScale = float(${f});

        const float invHeightScale = float(${p});
        const float invWidthScale = float(${g});

        const int winHeight = int(${x});
        const int winWidth = int(${y});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${o}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float sourceFracRow =
              float(${l[0]}) *
                (float(dyR) / float(${u[0]}));

            float sourceFracCol =
                float(${l[1]}) *
                  (float(dyC) / float(${u[1]}));

            int sourceNearestRow = int(min(
                float(int(${r}) - 1),
                ${s} ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(${i}) - 1),
                ${s} ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kae(n){const{inputs:e,backend:t,attrs:s}=n,{images:r,dy:i}=e,{alignCorners:o}=s,a=new wae(i.shape,r.shape,o);return t.runWebGLProgram(a,[i],i.dtype)}const Cae={kernelName:s1,backendName:"webgl",kernelFunc:kae};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Sae{constructor(e,t){this.variableNames=["x"];const s=e.length;if(s>4)throw new Error(`WebGL backend: Reverse of rank-${s} tensor is not yet supported`);if(this.outputShape=e,s===1){this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(${e[0]} - coord - 1));
        }
      `;return}const r=a=>t.indexOf(a)!==-1&&e[a]!==1?`${e[a]} - coords[${a}] - 1`:`coords[${a}]`,i=e.map((a,l)=>r(l)).join(","),o=Pt(s);this.userCode=`
      void main() {
        ${o} coords = getOutputCoords();
        setOutput(getX(${i}));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Nae{constructor(e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;const s=e.length;if(s>4)throw new Error(`WebGL backend: Reverse of rank-${s} tensor is not yet supported`);this.outputShape=e;const r=vs("rc",s),i=`${r[s-1]} + 1 < ${this.outputShape[s-1]}`,o=`${r[s-2]} + 1 < ${this.outputShape[s-2]}`,a=Pt(s);s===1?this.userCode=`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(${e[0]} - rc - 1),
            ${e[0]} - rc - 1);
          if(${i}){
              result.g = getChannel(getX(${e[0]} - (rc  + 1) - 1),
                ${e[0]} - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:this.userCode=`
        void main() {
          ${a} rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = ${l(r.slice())};
          if(${i}){
            result.g = ${u(r.slice())};
          }
          if(${o}) {
            result.b = ${d(r.slice())};
            if(${i}) {
              result.a = ${f(r.slice())};
            }
          }
          setOutput(result);
        }
    `;function l(x){return p(x)}function u(x){return x[s-1]="("+x[s-1]+" + 1)",p(x)}function d(x){return x[s-2]="("+x[s-2]+" + 1)",p(x)}function f(x){return x[s-1]="("+x[s-1]+" + 1)",x[s-2]="("+x[s-2]+" + 1)",p(x)}function p(x){const y=e.map((w,N)=>g(N,x)),b=y.join(","),k=y.slice(-2).join(",");return`getChannel(getX(${b}), vec2(${k}))`}function g(x,y){return t.indexOf(x)!==-1&&e[x]!==1?`${e[x]} - ${y[x]} - 1`:`${y[x]}`}}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Iae(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{dims:i}=s,o=r.shape.length,a=ht(i,r.shape);if(o===0)return Xs({inputs:{x:r},backend:t});const l=me().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Nae(r.shape,a):new Sae(r.shape,a);return t.runWebGLProgram(l,[r],r.dtype)}const Tae={kernelName:Tg,backendName:"webgl",kernelFunc:Iae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $ae{constructor(e,t){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];const s=e[1],r=e[2];this.outputShape=e;let i="";typeof t=="number"?i=`float outputValue = ${t.toFixed(2)};`:i=`
        vec3 fill = vec3(${t.join(",")});
        float outputValue = fill[coords[3]];`,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];
          int y = coords[1];
          float coordXFloat = (float(x) - params[0]) * params[3] -
            (float(y) - params[1]) * params[2];
          float coordYFloat = (float(x) - params[0]) * params[2] +
            (float(y) - params[1]) * params[3];
          int coordX = int(round(coordXFloat + params[0]));
          int coordY = int(round(coordYFloat + params[1]));
          ${i}
          if(coordX >= 0 && coordX < ${r} && coordY >= 0 && coordY < ${s}) {
            outputValue = getImage(coords[0], coordY, coordX, coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Eae={kernelName:d1,backendName:"webgl",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{image:s}=n,{radians:r,fillValue:i,center:o}=e,a=t,l=new $ae(s.shape,i),[u,d]=ew(o,s.shape[1],s.shape[2]),f=[[u,d,Math.sin(r),Math.cos(r)]];return a.runWebGLProgram(l,[s],s.dtype,f)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Aae=`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`,jae=kt({opSnippet:Aae}),Rae={kernelName:Jd,backendName:"webgl",kernelFunc:jae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dae="return inversesqrt(x);",Pae=kt({opSnippet:Dae,cpuKernelImpl:qJ}),Mae={kernelName:eh,backendName:"webgl",kernelFunc:Pae};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class nk{constructor(e,t,s,r,i,o,a=!0,l=!1){this.variableNames=["updates","indices","defaultValue"],this.outputShape=o;const u=Pt(i.length),d=Pt(o.length);let f="";s===1?f="i":s===2&&(f="i, j");const p=`getIndices(${f})`;let g="";r===1?g="i":r===2&&(g="i, coords[1]");const x=`getUpdates(${g})`;let y="";l&&(y="coords[0], coords[1]");const b=`getDefaultValue(${y})`,k=t>1?"strides[j]":"strides";this.userCode=`
        ${u} strides = ${u}(${i});

        void main() {
          ${d} coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < ${e}; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < ${t}; j++) {
              int index = round(${p});
              flattenedIndex += index * ${k};
            }
            if (flattenedIndex == coords[0]) {
              sum += ${x};
              found = true;
            }
          }
          setOutput(mix(${b}, sum, float(found)));
        }
      `}}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Lae{constructor(e,t,s,r,i,o,a=!0,l=!1){this.variableNames=["updates","indices","defaultValue"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=o;const u=Pt(i.length),d=Pt(o.length);let f="";s===1?f="i":s===2&&(f="i, j");const p=`getIndices(${f})`;let g="";r===1?g="i":r===2&&(g="i, coords[1]");const x=`getUpdates(${g})`;let y="";l&&(y="coords[0], coords[1]");const b=`getDefaultValue(${y})`,k=t>1?"strides[j]":"strides",w=t>1?"strides[j + 1]":"strides";this.userCode=`
        ${u} strides = ${u}(${i});

        void main() {
          ${d} coords = getOutputCoords();
          vec4 sum = vec4(0.);
          vec4 found = vec4(0.);
          for (int i = 0; i < ${e}; i+=2) {
            ivec2 flattenedIndex = ivec2(0);
            for (int j = 0; j < ${t}; j+=2) {
              ivec4 index = round(${p});
              flattenedIndex += index.xz * ${k};
              if (j + 1 < ${t}) {
                flattenedIndex += index.yw * ${w};
              }
            }
            if (flattenedIndex[0] == coords[0] || flattenedIndex[1] == coords[0] ||
                flattenedIndex[0] == coords[0] + 1 || flattenedIndex[1] == coords[0] + 1) {
              vec4 updVals = ${x};
              if (flattenedIndex[0] == coords[0]) {
                sum.xy += updVals.xy;
                found.xy = vec2(1.);
              } else if (flattenedIndex[0] == coords[0] + 1) {
                sum.zw += updVals.xy;
                found.zw = vec2(1.);
              }
              if (flattenedIndex[1] == coords[0]) {
                sum.xy += updVals.zw;
                found.xy = vec2(1.);
              } else if (flattenedIndex[1] == coords[0] + 1) {
                sum.zw += updVals.zw;
                found.zw = vec2(1.);
              }
            }
          }
          setOutput(mix(${b}, sum, found));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fae(n){const{inputs:e,backend:t,attrs:s}=n,{indices:r,updates:i}=e,{shape:o}=s,{sliceRank:a,numUpdates:l,sliceSize:u,strides:d,outputSize:f}=rl(i,r,o),p=[f/u,u];if(f===0)return t.makeTensorInfo(o,r.dtype);const g=Me({inputs:{x:r},backend:t,attrs:{shape:[l,a]}}),x=Me({inputs:{x:i},backend:t,attrs:{shape:[l,u]}}),y=t.makeTensorInfo([],"float32",new Float32Array([0]));let b;me().getBool("WEBGL_PACK")?b=new Lae(l,a,g.shape.length,x.shape.length,d,p):b=new nk(l,a,g.shape.length,x.shape.length,d,p);const k=t.runWebGLProgram(b,[x,g,y],x.dtype),w=Me({inputs:{x:k},backend:t,attrs:{shape:o}});return t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(x),t.disposeIntermediateTensorInfo(k),t.disposeIntermediateTensorInfo(y),w}const Oae={kernelName:A$,backendName:"webgl",kernelFunc:Fae};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _ae{constructor(e,t,s,r){this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[e,s];const i="while (left < right) {",o=`for (int i = 0; i < ${Math.ceil(Math.log2(t+1))}; ++i) { if (left >= right) break;`,a=me().getNumber("WEBGL_VERSION")===2?i:o,l=r==="left"?"<":"<=";this.userCode=`
       int findBound(int batch, float value) {
         int left = 0;
         int right = numInputs;
         int mid;
         ${a}
           mid = (left + right) / 2;
           if (getSortedSequence(batch, mid) ${l} value) {
             left = mid + 1;
           } else {
             right = mid;
           }
         }
         return right;
       }

       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int valueIndex = coords[1];

         float value = getValues(batch, valueIndex);

         setOutput(float(findBound(batch, value)));
       }
     `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zae(n){const{inputs:e,backend:t,attrs:s}=n,{sortedSequence:r,values:i}=e,{side:o}=s,a=new _ae(r.shape[0],r.shape[1],i.shape[1],o),l=[[r.shape[1]]];return t.runWebGLProgram(a,[r,i],"int32",l)}const Bae={kernelName:R$,backendName:"webgl",kernelFunc:zae};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Wae{constructor(e,t,s){this.variableNames=["c","a","b"],this.outputShape=t;let r,i;if(s>4)throw Error(`Where for rank ${s} is not yet supported`);if(s===1)i="resRC",r="resRC";else{const a=["resRC.x","resRC.y","resRC.z","resRC.w"],l=[],u=[];for(let d=0;d<t.length;d++)u.push(`${a[d]}`),d<e&&l.push(`${a[d]}`);r=l.join(),i=u.join()}const o=Pt(s);this.userCode=`
      void main() {
        ${o} resRC = getOutputCoords();
        float cVal = getC(${r});
        if (cVal >= 1.0) {
          setOutput(getA(${i}));
        } else {
          setOutput(getB(${i}));
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vae(n){const{inputs:e,backend:t}=n,{condition:s,t:r,e:i}=e,o=new Wae(s.shape.length,r.shape,r.shape.length);return t.runWebGLProgram(o,[s,r,i],Ks(r.dtype,i.dtype))}const Uae={kernelName:$g,backendName:"webgl",kernelFunc:Vae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gae=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = ${Kg};
  float scale = ${Qg};
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,Hae=kt({opSnippet:Gae}),qae={kernelName:th,backendName:"webgl",kernelFunc:Hae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kae=_c+`
  return 1.0 / (1.0 + exp(-1.0 * x));
`,Qae=`
  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Xae=kt({opSnippet:Kae,packedOpSnippet:Qae,cpuKernelImpl:QJ}),Yae={kernelName:ih,backendName:"webgl",kernelFunc:Xae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zae=`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`,Jae=kt({opSnippet:Zae}),ele={kernelName:rh,backendName:"webgl",kernelFunc:Jae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tle=_c+`
  return sin(x);
`,nle=`
  vec4 result = sin(x);
  bvec4 isNaN = isnan(x);
  ${cl}
  return result;
`,sle=kt({opSnippet:tle,packedOpSnippet:nle}),rle={kernelName:nh,backendName:"webgl",kernelFunc:sle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ile=`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`,ole=kt({opSnippet:ile}),ale={kernelName:sh,backendName:"webgl",kernelFunc:ole};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lle=`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`,cle=kt({opSnippet:lle}),ule={kernelName:oh,backendName:"webgl",kernelFunc:cle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dle=n=>{const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockShape:i,paddings:o}=s;V(r.shape.length<=4,()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet");const a=i.reduce((k,w)=>k*w),l=[[0,0]];l.push(...o);for(let k=1+i.length;k<r.shape.length;++k)l.push([0,0]);const u=[],d=GP({inputs:{x:r},backend:t,attrs:{paddings:l,constantValue:0}}),f=vh(d.shape,i,a,!1),p=bh(f.length,i.length,!1),g=wh(d.shape,i,a,!1),x=Me({inputs:{x:d},backend:t,attrs:{shape:f}}),y=ws({inputs:{x},backend:t,attrs:{perm:p}}),b=Me({inputs:{x:y},backend:t,attrs:{shape:g}});return u.push(d),u.push(x),u.push(y),u.forEach(k=>t.disposeIntermediateTensorInfo(k)),b},hle={kernelName:jg,backendName:"webgl",kernelFunc:dle};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fle(n){const{inputs:e,backend:t}=n,{indices:s,values:r,denseShape:i,defaultValue:o}=e;if(i.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
         ${i.shape}`);if(s.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
         ${s.shape}`);if(r.shape.length!==1)throw new Error(`Values must be a vector, saw:
         ${r.shape}`);if(o.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${o.shape}`);const a=t.readSync(s.dataId),l=t.readSync(r.dataId),u=t.readSync(i.dataId),d=t.readSync(o.dataId)[0],[f,p,g,x,y]=YJ(a,s.shape,s.dtype,l,r.dtype,u,d);return[t.makeTensorInfo(p,s.dtype,f),t.makeTensorInfo([p[0]],r.dtype,g),t.makeTensorInfo([x.length],"bool",new Uint8Array(x.map(b=>Number(b)))),t.makeTensorInfo([y.length],s.dtype,new Int32Array(y))]}const ple={kernelName:D$,backendName:"webgl",kernelFunc:fle};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mle(n){const{inputs:e,backend:t}=n,{inputIndices:s,inputShape:r,newShape:i}=e;if(s.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape ${s.shape}`);if(r.shape.length!==1)throw new Error(`Input shape should be a vector but received shape ${r.shape}`);if(i.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${i.shape}`);const o=Array.from(t.readSync(r.dataId)),a=t.readSync(s.dataId),l=Array.from(t.readSync(i.dataId)),[u,d,f]=ZJ(a,s.shape,s.dtype,o,l);return[t.makeTensorInfo(d,s.dtype,u),t.makeTensorInfo([f.length],i.dtype,new Int32Array(f))]}const gle={kernelName:P$,backendName:"webgl",kernelFunc:mle};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xle(n){const{inputs:e,backend:t}=n,{data:s,indices:r,segmentIds:i}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
              ${r.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
              ${i.shape}`);const o=t.readSync(s.dataId),a=t.readSync(r.dataId),l=t.readSync(i.dataId),[u,d]=gP(o,s.shape,s.dtype,a,l,!0);return t.makeTensorInfo(d,s.dtype,u)}const yle={kernelName:M$,backendName:"webgl",kernelFunc:xle};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vle(n){const{inputs:e,backend:t}=n,{data:s,indices:r,segmentIds:i}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
             ${r.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
             ${i.shape}`);const o=t.readSync(s.dataId),a=t.readSync(r.dataId),l=t.readSync(i.dataId),[u,d]=gP(o,s.shape,s.dtype,a,l);return t.makeTensorInfo(d,s.dtype,u)}const ble={kernelName:L$,backendName:"webgl",kernelFunc:vle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wle(n){const{inputs:e,backend:t,attrs:s}=n,{sparseIndices:r,sparseValues:i,defaultValue:o}=e,{outputShape:a}=s,{sliceRank:l,numUpdates:u,sliceSize:d,strides:f,outputSize:p}=rl(i,r,a),g=!1;if(i.dtype==="string"){const k=t.bufferSync(r),w=t.bufferSync(i),N=Uo(t.readSync(o.dataId)[0]),C=KJ(k,w,a,p,d,u,l,f,N,g);return t.makeTensorInfo(a,C.dtype,C.values)}const x=new nk(u,l,r.shape.length,i.shape.length,f,[p,1],g),y=t.runWebGLProgram(x,[i,r,o],i.dtype),b=Me({inputs:{x:y},backend:t,attrs:{shape:a}});return t.disposeIntermediateTensorInfo(y),b}const kle={kernelName:F$,backendName:"webgl",kernelFunc:wle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cle(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{numOrSizeSplits:i,axis:o}=s,a=ht(o,r.shape)[0],l=mw(r,i,a),u=r.shape.length,d=new Array(u).fill(0),f=r.shape.slice();return l.map(p=>{const g=[...f];g[a]=p;const x=zc({inputs:{x:r},backend:t,attrs:{begin:d,size:g}});return d[a]+=p,x})}const Sle={kernelName:Rg,backendName:"webgl",kernelFunc:Cle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lI="return sqrt(x);",Nle=kt({opSnippet:lI,packedOpSnippet:lI,cpuKernelImpl:JJ}),Ile={kernelName:ah,backendName:"webgl",kernelFunc:Nle};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tle="return x * x;",$le=kt({opSnippet:Tle}),Ele={kernelName:i1,backendName:"webgl",kernelFunc:$le};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cI="return (a - b) * (a - b);",Ale=Yn({opSnippet:cI,packedOpSnippet:cI}),jle={kernelName:lh,backendName:"webgl",kernelFunc:Ale};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rle(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e;if(r.dtype!=="string")throw new Error("Input must be of datatype string");const i=t.readSync(r.dataId),o=ro(i),a=eee(o,"string",s);return t.makeTensorInfo(r.shape,"string",a)}const Dle={kernelName:o1,backendName:"webgl",kernelFunc:Rle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ple({inputs:n,attrs:e,backend:t}){const{x:s}=n,r=Rr+`
    return x > 0.0 ? 1.0 : float(${e.alpha});
  `,i=new vi(s.shape,r);return t.runWebGLProgram(i,[s],s.dtype)}const Mle={kernelName:fh,backendName:"webgl",kernelFunc:Ple};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Lle{constructor(e,t,s){this.variableNames=["x"],this.outputShape=s;const r=s.length,i=Pt(s.length),o=Pt(s.length);let a="";if(r===1)a="coords * strides + begin";else{let l=0;a=s.map((u,d)=>(l++,s.length===1?`coords * strides[${d}] + begin[${d}]`:`coords[${l-1}] * strides[${d}] + begin[${d}]`)).join(",")}this.userCode=`
      ${i} begin = ${i}(${e});
      ${i} strides = ${i}(${t});

      void main() {
        ${o} coords = getOutputCoords();
        setOutput(getX(${a}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fle(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{begin:i,end:o,strides:a,beginMask:l,endMask:u,ellipsisMask:d,newAxisMask:f,shrinkAxisMask:p}=s,{finalShapeSparse:g,finalShape:x,isIdentity:y,sliceDim0:b,isSimpleSlice:k,begin:w,end:N,strides:C}=Y1(r.shape,i,o,a,l,u,d,f,p);let S;if(y)S=Me({inputs:{x:r},backend:t,attrs:{shape:x}});else if(b||k){V(r.shape.length>=1,()=>`Input must have rank at least 1, got: ${r.shape.length}`);const A=K1(w,N,C),E=zc({inputs:{x:r},backend:t,attrs:{begin:w,size:A}});S=Me({inputs:{x:E},backend:t,attrs:{shape:x}}),t.disposeIntermediateTensorInfo(E)}else if(t.shouldExecuteOnCPU([r])){const E=t.readSync(r.dataId),M=dt(r.shape,r.dtype,E),P=tee(g,M,C,w);S=t.makeTensorInfo(x,r.dtype,P.values)}else{const E=new Lle(w,C,g);S=t.runWebGLProgram(E,[r],r.dtype)}const T=Me({inputs:{x:S},backend:t,attrs:{shape:x}});return t.disposeIntermediateTensorInfo(S),T}const Ole={kernelName:a1,backendName:"webgl",kernelFunc:Fle};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _le(n){const{inputs:e,backend:t,attrs:s}=n,{separator:r,nGramWidths:i,leftPad:o,rightPad:a,padWidth:l,preserveShortSequences:u}=s,{data:d,dataSplits:f}=e,p=t.readSync(d.dataId),g=t.readSync(f.dataId),[x,y]=nee(p,g,r,i,o,a,l,u);return[t.makeTensorInfo([x.length],"string",x),t.makeTensorInfo(f.shape,"int32",y)]}const zle={kernelName:O$,backendName:"webgl",kernelFunc:_le};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ble(n){const{inputs:e,backend:t,attrs:s}=n,{skipEmpty:r}=s,{input:i,delimiter:o}=e;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(i.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${i.shape}`);if(o.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${o.shape}`);const a=t.readSync(i.dataId),l=t.readSync(o.dataId)[0],[u,d,f]=see(a,l,r),p=d.length;return[t.makeTensorInfo([p,2],"int32",u),t.makeTensorInfo([p],"string",d),t.makeTensorInfo([2],"int32",new Int32Array(f))]}const Wle={kernelName:_$,backendName:"webgl",kernelFunc:Ble};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vle(n){const{inputs:e,backend:t,attrs:s}=n,{numBuckets:r}=s,{input:i}=e;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");const o=t.readSync(i.dataId),a=ree(o,r);return t.makeTensorInfo(i.shape,"int32",a)}const Ule={kernelName:z$,backendName:"webgl",kernelFunc:Vle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gle="return tan(x);",Hle=kt({opSnippet:Gle}),qle={kernelName:uh,backendName:"webgl",kernelFunc:Hle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kle=`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`,Qle=kt({opSnippet:Kle}),Xle={kernelName:dh,backendName:"webgl",kernelFunc:Qle};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yle(n){const{inputs:e,backend:t,attrs:s}=n,{tensor:r,indices:i,updates:o}=e,{sliceRank:a,numUpdates:l,sliceSize:u,strides:d,outputSize:f}=rl(o,i,r.shape),p=[f/u,u];if(f===0)return t.makeTensorInfo(r.shape,i.dtype);const g=Me({inputs:{x:i},backend:t,attrs:{shape:[l,a]}}),x=Me({inputs:{x:o},backend:t,attrs:{shape:[l,u]}}),y=Me({inputs:{x:r},backend:t,attrs:{shape:p}}),b=new nk(l,a,g.shape.length,x.shape.length,d,p,!1,!0),k=t.runWebGLProgram(b,[x,g,y],y.dtype),w=Me({inputs:{x:k},backend:t,attrs:{shape:r.shape}});return t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(x),t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(k),w}const Zle={kernelName:j$,backendName:"webgl",kernelFunc:Yle};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Jle{constructor(e,t){this.variableNames=["A"];const s=new Array(e.length);for(let o=0;o<s.length;o++)s[o]=e[o]*t[o];this.outputShape=s,this.rank=s.length;const r=Pt(this.rank),i=ece(e);this.userCode=`
      void main() {
        ${r} resRC = getOutputCoords();
        setOutput(getA(${i}));
      }
    `}}function ece(n){const e=n.length;if(e>5)throw Error(`Tile for rank ${e} is not yet supported`);if(e===1)return`imod(resRC, ${n[0]})`;const t=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],s=[];for(let r=0;r<n.length;r++)s.push(`imod(${t[r]}, ${n[r]})`);return s.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qP(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{reps:i}=s;if(r.dtype==="string"||r.shape.length>5){const l=t.readSync(r.dataId),u=r.dtype==="string"?l.map(p=>Uo(p)):l,d=dt(r.shape,r.dtype,u),f=oee(d,i);return t.makeTensorInfo(f.shape,f.dtype,f.values)}const o=new Jle(r.shape,i);return t.runWebGLProgram(o,[r],r.dtype)}const tce={kernelName:hh,backendName:"webgl",kernelFunc:qP};class nce{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=e,this.userCode=`
       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // We compare elements pair-wise within a group of size 2 * inc.
         // The comparing rule for each group alternates between ascending
         // and descending. Within each group, we compare each pair at
         // positions i and i+inc. To decide whether an element at position i
         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than
         // inc, it is in the first half of the group, we denote it as x0,
         // otherwise we denote it as x1.
         // For example, as shown in the Bitonic top K paper referenced above,
         // Figure5(a) shows that element[1] is in the
         // second half of the group when group size is 2, but it is in the
         // first half of the group when group size is 4.

         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;
         int i = isFirstInPair ? elemIdx : elemIdx - inc;

         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));
         float x0 = i0 < n ? getX(batch, i0) : negativeInf;
         float x1 = i1 < n ? getX(batch, i1) : negativeInf;

         // Denotes which direction indices are in (ascending or descending).
         bool reverse = imod(elemIdx, 2 * dir) >= dir;
         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);
         if (reverse == isGreater) { // Elements in opposite order of direction
           int iTemp = i0;
           i0 = i1;
           i1 = iTemp;
         }
         if (isFirstInPair) {
            setOutput(float(i0));
         } else {
            setOutput(float(i1));
         }
       }
     `}}class sce{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=e,this.userCode=`
    void main() {
         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // The output size is half of the previous size.
         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),
         // we only need to output the indices at positions |, the indices at
         // positions _ can be thrown away, see Figure5(b) After Phase 2
         // (Merge phase) in the Bitonic Top K paper referenced above.
         // For example, the paper shows we only need to output the orange bars.
         // The output sequence should look like this | | | | | | | |.
         // Because the sequence is halved, to map the output index back
         // to the previous sequence to find the corresponding value,
         // we need to double the index. When we double the index,
         // we basically interpolate a position, so 2i looks like
         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position
         // of each 2k positions by - elemIdx % k. E.g. for output at
         // index 4,5,6,7, we want to get the corresponding element at
         // original index 8,9,10,11, for output at index 8,9,10,11,
         // we want to get the corresponding element at original index
         // 16,17,18,19, so on and so forth.

         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));
         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));

         float x0 = getX(batch, i0);
         float x1 = i1 < n ? getX(batch, i1) : x0;

         setOutput(x0 >= x1 ? float(i0) : float(i1));
       }
     `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sa(n,e){e!==null&&n.disposeIntermediateTensorInfo(e)}function uI(n){let e=1;for(;e<n;)e*=2;return e}function rce(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{k:i,sorted:o}=s,a=me().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),l=me().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),u=r.shape,d=u[u.length-1];if(t.shouldExecuteOnCPU([r])||d<a||i>l){const P=t.readSync(r.dataId),[R,L]=aee(P,u,r.dtype,i,o);return[t.makeTensorInfo(R.shape,R.dtype,R.values),t.makeTensorInfo(L.shape,L.dtype,L.values)]}if(i===0)return u[u.length-1]=0,[t.makeTensorInfo(u,r.dtype,[]),t.makeTensorInfo(u,"int32",[])];if(d===1)return[r,Mh({attrs:{shape:u,dtype:"int32",value:0},backend:t})];const f=t.texData.get(r.dataId),p=f!==null&&f.isPacked,g=p?t.unpackTensor(r):r,y=be(u)/d,b=Me({inputs:{x:g},attrs:{shape:[y,d]},backend:t});p&&Sa(t,g);const k=uI(i),w=uI(d);let N=null;const C=()=>N===null?[b,b]:[b,N],S=(P,R,L)=>{const _=C(),O=new nce(L),W=[[d],[N===null?1:0],[Number.NEGATIVE_INFINITY],[P],[R]],H=N;N=t.runWebGLProgram(O,_,"int32",W),Sa(t,H)};for(let P=1;P<k;P*=2){const R=P*2;for(let L=P;L>=1;L/=2)S(R,L,[y,w])}for(let P=w;P>k;P/=2){const R=C(),L=new sce([y,P/2]),O=[[d],[N===null?1:0],[k]],U=N;N=t.runWebGLProgram(L,R,"int32",O),Sa(t,U);const W=k/2,H=W*2;for(let G=W;G>=1;G/=2)S(H,G,N.shape)}let T=N;N=zc({inputs:{x:N},backend:t,attrs:{begin:0,size:[y,i]}}),Sa(t,T);let A=_P({inputs:{x:b,indices:N},backend:t,attrs:{axis:1,batchDims:1}});Sa(t,b);const E=u.slice(0,-1);E.push(i),T=N,N=Me({inputs:{x:N},attrs:{shape:E},backend:t}),Sa(t,T);const M=A;return A=Me({inputs:{x:A},attrs:{shape:E},backend:t}),Sa(t,M),[A,N]}const ice={kernelName:l1,backendName:"webgl",kernelFunc:rce};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class oce{constructor(e,t,s,r,i,o){this.variableNames=["Image","Transforms"],this.outputShape=o;const a=s==="nearest"?1:2;let l;switch(r){case"constant":l=1;break;case"reflect":l=2;break;case"wrap":l=3;break;case"nearest":l=4;break;default:l=1;break}this.userCode=`
            float mapCoord(float outCoord, float len) {
              float inCoord = outCoord;
              if(${l} == 2) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    if (inCoord < sz2) {
                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +
                      inCoord;
                    }
                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    inCoord -= sz2 * float(int(float(inCoord / sz2)));
                    if (inCoord >= len) {
                      inCoord = sz2 - inCoord - 1.0;
                    }
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${l} == 3) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord -= len * float(int(float(inCoord / sz)));
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${l} == 4) {
                return clamp(outCoord, 0.0, len - 1.0);
              } else {
                return outCoord;
              }
            }

            float readWithFillValue(int batch, int coordY, int coordX,
              int channel) {
              float outputValue;
              if (0 <= coordY && coordY < ${e} && 0 <= coordX && coordX < ${t}) {
                  outputValue = getImage(batch, coordY, coordX, channel);
              } else {
                outputValue = float(${i});
              }
              return outputValue;
            }

            void main() {
              ivec4 coords = getOutputCoords();
              float outputValue;
              int batch = coords[0];
              int x = coords[2];
              int y = coords[1];
              int channel = coords[3];
              float xf = float(x);
              float yf = float(y);
              float a1 = getTransforms(batch, 0);
              float a2 = getTransforms(batch, 1);
              float a3 = getTransforms(batch, 2);
              float b1 = getTransforms(batch, 3);
              float b2 = getTransforms(batch, 4);
              float b3 = getTransforms(batch, 5);
              float c1 = getTransforms(batch, 6);
              float c2 = getTransforms(batch, 7);
              float projection = c1 * xf + c2 * yf + 1.0;
              if (projection == 0.0) {
                outputValue = float(${i});
              } else {
                float inX = (a1 * xf + a2 * yf + a3) / projection;
                float inY = (b1 * xf + b2 * yf + b3) / projection;
                float mapX = mapCoord(inX, float(${t}));
                float mapY = mapCoord(inY, float(${e}));

                if (${a} == 1) {
                  int coordY = int(round(mapY));
                  int coordX = int(round(mapX));
                  outputValue = readWithFillValue(batch, coordY, coordX,
                    channel);
                } else {
                  float yFloor = floor(mapY);
                  float xFloor = floor(mapX);
                  float yCeil = yFloor + 1.0;
                  float xCeil = xFloor + 1.0;
                  float valueYFloor = (xCeil - mapX) *
                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);
                  float valueYCeil = (xCeil - mapX) *
                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);
                  outputValue = (yCeil - mapY) * valueYFloor +
                  (mapY - yFloor) * valueYCeil;
                }
              }
              setOutput(outputValue);
            }
        `}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ace(n){const{inputs:e,backend:t,attrs:s}=n,{image:r,transforms:i}=e,{interpolation:o,fillMode:a,fillValue:l,outputShape:u}=s,[d,f,p,g]=r.shape,[x,y]=u??[f,p],b=[d,x,y,g],k=new oce(f,p,o,a,l,b);return t.runWebGLProgram(k,[r,i],"float32")}const lce={kernelName:c1,backendName:"webgl",kernelFunc:ace};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cce(n){const{inputs:e,attrs:t,backend:s}=n,{axis:r}=t,{x:i}=e;Rh(i,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");const o=s.readSync(i.dataId),{outputValues:a,outputShape:l,indices:u}=lee(o,r,i.shape,i.dtype);return[s.makeTensorInfo(l,i.dtype,a),s.makeTensorInfo([u.length],"int32",u)]}const uce={kernelName:u1,backendName:"webgl",kernelFunc:cce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dce(n){const{inputs:e,backend:t,attrs:s}=n,{value:r}=e;let{axis:i}=s;i<0&&(i+=r.shape.length);const o=r,a=o.shape.length,l=r.shape[i],u=new Array(a-1);let d=0;for(let y=0;y<a;y++)y!==i&&(u[d++]=o.shape[y]);const f=[],p=new Array(a).fill(0),g=o.shape.slice();g[i]=1;const x=new Array(l);for(let y=0;y<x.length;y++){p[i]=y;const b=zc({inputs:{x:o},backend:t,attrs:{begin:p,size:g}}),k=Me({inputs:{x:b},backend:t,attrs:{shape:u}});x[y]=k,f.push(b)}return f.forEach(y=>t.disposeIntermediateTensorInfo(y)),x}const hce={kernelName:Pg,backendName:"webgl",kernelFunc:dce};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class fce{constructor(e,t){this.variableNames=["x","segmentIds"];const s=e.windowSize,r=e.batchSize,i=e.inSize,o=e.numSegments,a=o*Math.ceil(i/s);this.outputShape=[r,a];const l="0.0",u="sumValue",d=Math.floor(s/4)*4,f=s%4,p=`
        sumValue += dot(values, segFilter);
    `;let g="";i%s>0&&(g=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return initializationValue;
        }
      `);let x="";i%s>0&&(x=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = ${l};

      float getValue(int batch, int inIdx) {
        ${g}
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        ${x}
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          ${o})) * float(${s}));
        int currentSeg = int(mod(float(outIdx), float(${o})));

        float sumValue = 0.0;

        for (int i = 0; i < ${d}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          ${p}
        }

        int inIdx = inOffset + ${d};
        if (${f===1}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          ${p}
        } else if (${f===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          ${p}
        } else if (${f===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          ${p}
        }
        setOutput(${u});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pce(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,segmentIds:i}=e,{numSegments:o}=s,a=r.shape.length,l=[];let u=0;const d=tn([u],a);let f=r;d!=null&&(f=ws({inputs:{x:r},backend:t,attrs:{perm:d}}),l.push(f),u=mn(1,a)[0]);const p=EA(f.shape,u,o),g=be([f.shape[u]]),x=Me({inputs:{x:f},backend:t,attrs:{shape:[-1,g]}});l.push(x);const y=h1(r.dtype),b=(C,S,T,A,E)=>{const M=C.shape[0],P=C.shape[1],R=$A(P,E),L={windowSize:R,inSize:P,batchSize:M,numSegments:E},_=new fce(L,S),O=t.compileAndRun(_,[C,T],A);if(l.push(O),O.shape[1]===E)return O;const U=HP({backend:t,attrs:{start:0,stop:E,step:1,dtype:"float32"}}),W=qP({inputs:{x:U},backend:t,attrs:{reps:[P/R]}});return l.push(U),l.push(W),b(O,S,W,A,E)},k=b(x,"unsortedSegmentSum",i,y,o),w=Me({inputs:{x:k},backend:t,attrs:{shape:p}});let N=w;if(d!=null){l.push(w);const C=ea(d);N=ws({inputs:{x:N},backend:t,attrs:{perm:C}})}return l.forEach(C=>t.disposeIntermediateTensorInfo(C)),N}const mce={kernelName:Mg,backendName:"webgl",kernelFunc:pce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gce=[Jee,tte,rte,ate,cte,hte,pte,gte,bte,kte,Nte,$te,jte,Mte,Ote,zte,Wte,Hte,Kte,Xte,ene,ane,cne,fne,mne,wne,Cne,Tne,Lee,Ane,Mne,_ne,Gne,Kne,Xne,Zne,ese,rse,ase,use,hse,pse,gse,vse,wse,Nse,Tse,Ase,Dse,Mse,_se,Vse,qse,Xse,Jse,ere,nre,rre,ore,lre,ure,pre,xre,bre,kre,Nre,$re,Rre,Lre,Mee,Ore,Dne,Bre,Ure,qre,Oee,Yre,tie,sie,aie,uie,pie,xie,wie,Nie,$ie,Aie,Pie,Lie,Oie,Wie,Uie,Hie,Kie,Xie,eoe,roe,loe,goe,Bee,boe,Coe,Ioe,Eoe,xne,Roe,Poe,Loe,_oe,Voe,zee,Goe,qoe,Qoe,Yoe,Zoe,yne,hoe,tae,iae,cae,Vee,fae,gae,bae,Cae,Tae,Eae,Rae,Mae,Oae,Bae,Uae,qae,Yae,ele,rle,ale,ine,poe,ule,hle,ple,gle,yle,ble,kle,Sle,Ile,Ele,jle,Dle,Mle,Ole,zle,Wle,Ule,foe,Xee,qle,Xle,Zle,tce,ice,lce,Yee,uce,hce,mce,Doe];for(const n of gce)W$(n);const j0={epochs:50,batchSize:32,learningRate:.001,validationSplit:.2},dp="audiio-ml-model";class xce{constructor(){Mt(this,"model",null);Mt(this,"isDisposed",!1)}createModel(){this.model&&this.model.dispose();const e=DH();return e.add(Au({inputShape:[RO],units:64,activation:"relu",kernelInitializer:"heNormal",name:"input_dense"})),e.add(Au({units:128,activation:"relu",kernelInitializer:"heNormal",name:"hidden_1"})),e.add(YH({rate:.3,name:"dropout"})),e.add(Au({units:64,activation:"relu",kernelInitializer:"heNormal",name:"hidden_2"})),e.add(Au({units:32,activation:"relu",kernelInitializer:"heNormal",name:"hidden_3"})),e.add(Au({units:1,activation:"sigmoid",name:"output"})),e.compile({optimizer:Do.adam(j0.learningRate),loss:"binaryCrossentropy",metrics:["accuracy"]}),this.model=e,e}getModel(){return this.model}isReady(){return this.model!==null&&!this.isDisposed}async train(e,t,s,r,i={},o,a){var b,k,w;const l={...j0,...i};this.model||this.createModel();const{inputs:u,labels:d}=VO(e,t,s,r,a),f=d.filter(N=>N>.5).length,p=d.filter(N=>N<=.2).length,g=d.length-f-p;if(console.log(`[MLTrainer] Training data: ${f} positive, ${p} negative (disliked), ${g} neutral samples`),u.length<10)throw new Error("Insufficient training data (need at least 10 samples)");const x=Zl(u),y=js(d);try{const N=await this.model.fit(x,y,{epochs:l.epochs,batchSize:l.batchSize,validationSplit:l.validationSplit,shuffle:!0,callbacks:{onEpochEnd:(T,A)=>{o&&A&&o({epoch:T+1,totalEpochs:l.epochs,loss:A.loss,accuracy:A.acc})}}}),C=N.history.loss.length-1;return{loss:N.history.loss[C],accuracy:((b=N.history.acc)==null?void 0:b[C])??0,valLoss:(k=N.history.val_loss)==null?void 0:k[C],valAccuracy:(w=N.history.val_acc)==null?void 0:w[C],samplesUsed:u.length}}finally{x.dispose(),y.dispose()}}predict(e,t,s,r,i){if(!this.model||this.isDisposed)return .5;const o=Vp(e,t,s,r,i),a=Zl([o.combined]);try{const l=this.model.predict(a),u=l.dataSync()[0];return l.dispose(),u}finally{a.dispose()}}predictBatch(e,t,s,r,i){if(!this.model||this.isDisposed||e.length===0)return e.map(()=>.5);h$(i);const o=e.map(l=>Vp(l,t,s,r,i).combined),a=Zl(o);try{const l=this.model.predict(a),u=Array.from(l.dataSync());return l.dispose(),u}finally{a.dispose()}}async saveModel(){if(!this.model)return console.warn("[MLTrainer] No model to save"),!1;try{return await this.model.save(`indexeddb://${dp}`),console.log("[MLTrainer] Model saved to IndexedDB"),!0}catch(e){return console.error("[MLTrainer] Failed to save model:",e),!1}}async loadModel(){try{return this.model=await AH(`indexeddb://${dp}`),this.model.compile({optimizer:Do.adam(j0.learningRate),loss:"binaryCrossentropy",metrics:["accuracy"]}),console.log("[MLTrainer] Model loaded from IndexedDB"),!0}catch{return console.log("[MLTrainer] No saved model found, will create new one"),!1}}async hasSavedModel(){try{const e=await dz();return`indexeddb://${dp}`in e}catch{return!1}}async deleteModel(){try{await hz(`indexeddb://${dp}`),console.log("[MLTrainer] Saved model deleted")}catch{console.warn("[MLTrainer] No model to delete")}}getSummary(){if(!this.model)return"No model loaded";let e="";return this.model.summary(void 0,void 0,t=>{e+=t+`
`}),e}dispose(){this.model&&(this.model.dispose(),this.model=null),this.isDisposed=!0}}let R0=null;function ju(){return R0||(R0=new xce),R0}function yce(n){return n>=50}function vce(n,e,t,s){if(s===0&&e>=50)return!0;if(s===0)return!1;const r=(Date.now()-n)/(1e3*60*60);return r>=24&&e-t>=10||r>=168}const Bc={exploration:{epsilon:.15,explorationBoost:25,noveltyDecay:.9},serendipity:{maxBonus:30,genreJumpBonus:15,unexpectedArtistBonus:20},diversity:{sameArtistPenalty:-30,sameGenrePenalty:-10,idealGenreMix:.4},flow:{energyTransitionMax:.3,smoothTransitionBonus:15,jarringTransitionPenalty:-20},temporal:{hourWeight:.25},weights:{base:.4,exploration:.1,serendipity:.15,diversity:.15,flow:.1,temporal:.05,plugin:.05}},Oo=[],D0=new Map;function bce(n){const e=Oo.findIndex(t=>t.pluginId===n.pluginId);e>=0&&Oo.splice(e,1),Oo.push(n),Oo.sort((t,s)=>s.priority-t.priority),console.log(`[AdvancedScoring] Registered feature provider: ${n.pluginId}`)}function wce(n){const e=Oo.findIndex(t=>t.pluginId===n);e>=0&&(Oo.splice(e,1),console.log(`[AdvancedScoring] Unregistered feature provider: ${n}`))}function kce(){return Oo}async function bm(n){if(D0.has(n))return D0.get(n);for(const e of Oo)try{const t=await e.getAudioFeatures(n);if(t)return D0.set(n,t),t}catch(t){console.warn(`[AdvancedScoring] Provider ${e.pluginId} failed:`,t)}return null}function Cce(n,e,t,s){var u;const r=Bc.exploration,i=!n.artists.some(d=>e.has(d.id||d.name.toLowerCase())),o=!((u=n.genres)!=null&&u.some(d=>t.has(d.toLowerCase())));let a=0;i&&(a+=r.explorationBoost*.6),o&&(a+=r.explorationBoost*.4);const l=Math.pow(r.noveltyDecay,s);return a*=l,Math.random()<r.epsilon&&(a+=r.explorationBoost*.5),a}function Sce(n,e,t){var p;const s=Bc.serendipity;let r=0;const i=Object.entries(e.genrePreferences).filter(([g,x])=>x>20).map(([g])=>g.toLowerCase()),o=Object.entries(e.artistPreferences).filter(([g,x])=>x>30).map(([g])=>g.toLowerCase()),a=((p=n.genres)==null?void 0:p.map(g=>g.toLowerCase()))||[],l=a.some(g=>i.includes(g));return!a.some(g=>t.slice(0,10).some(x=>{var y;return(y=x.genres)==null?void 0:y.some(b=>b.toLowerCase()===g)}))&&l&&(r+=s.genreJumpBonus),!n.artists.map(g=>g.name.toLowerCase()).some(g=>o.includes(g))&&l&&(r+=s.unexpectedArtistBonus),a.length>=2&&a.filter(x=>i.includes(x)).length>=1&&a.filter(x=>!i.includes(x)).length>=1&&(r+=10),Math.min(r,s.maxBonus)}function Nce(n,e,t,s){var l,u,d;const r=Bc.diversity;let i=0;const o=(l=n.artists[0])==null?void 0:l.name.toLowerCase();if(o&&t.has(o)){const f=t.get(o);i+=r.sameArtistPenalty*Math.min(f,3)}const a=(d=(u=n.genres)==null?void 0:u[0])==null?void 0:d.toLowerCase();if(a&&s.size>0){const f=Array.from(s.values()).reduce((x,y)=>x+y,0),g=(s.get(a)||0)/Math.max(f,1);g>r.idealGenreMix?i+=r.sameGenrePenalty*(g-r.idealGenreMix)*10:i+=10*(r.idealGenreMix-g)}return a&&!s.has(a)&&(i+=15),i}function Ice(n,e,t,s,r){const i=Bc.flow;if(!e)return 0;let o=0;const a=(t==null?void 0:t.energy)??Vv(n),l=(s==null?void 0:s.energy)??(r.length>0?r[r.length-1]:.5),u=Math.abs(a-l);if(u<=i.energyTransitionMax?o+=i.smoothTransitionBonus*(1-u/i.energyTransitionMax):o+=i.jarringTransitionPenalty*(u-i.energyTransitionMax),t!=null&&t.bpm&&(s!=null&&s.bpm)){const d=Math.abs(t.bpm-s.bpm),f=d/s.bpm;f<=.15?o+=10:f<=.5||d<=30?o+=5:o-=10}if(t!=null&&t.key&&(s!=null&&s.key)){const d=Ece(t.key,s.key);o+=d*10}return o}function Tce(n,e,t,s){var u,d;const r=Bc.temporal;let i=0;const o=s.get(e);if(o){const f=(d=(u=n.genres)==null?void 0:u[0])==null?void 0:d.toLowerCase();f&&o.genres[f]&&(i+=o.genres[f]*r.hourWeight*100);const p=Vv(n),g=Math.abs(p-o.energy);i+=(1-g)*r.hourWeight*50}const a=t===0||t===6,l=Vv(n);return a?l>.6&&(i+=5):e>=9&&e<=17?l>=.3&&l<=.6&&(i+=5):e>=18&&e<=22&&l>=.4&&l<=.7&&(i+=5),i}async function $ce(n,e,t,s,r=0){var S,T,A,E;const i=Bc.weights,o=[],a=await bm(n.id),l=t.sessionTracks[t.sessionTracks.length-1],u=l?await bm(l.id):null,d=new Map,f=new Map;for(const M of t.sessionTracks){const P=(S=M.artists[0])==null?void 0:S.name.toLowerCase();P&&d.set(P,(d.get(P)||0)+1);const R=(A=(T=M.genres)==null?void 0:T[0])==null?void 0:A.toLowerCase();R&&f.set(R,(f.get(R)||0)+1)}const p=Cce(n,s.artistHistory,s.genreHistory,r);p>10&&o.push("New discovery");const g=Sce(n,s,t.sessionTracks);g>15&&o.push("Unexpected find");const x=Nce(n,t.sessionTracks,d,f);x>10&&o.push("Adds variety"),x<-15&&o.push("Too repetitive");const y=Ice(n,l||null,a,u,t.recentEnergy);y>10&&o.push("Smooth transition");const b=Tce(n,t.hour,t.dayOfWeek,s.timePatterns);b>5&&o.push("Right time");let k=0;if(a){const M=((E=s.timePatterns.get(t.hour))==null?void 0:E.energy)??.5;a.energy!==void 0&&(k+=(1-Math.abs(a.energy-M))*20),o.push("Audio-analyzed")}const w=Math.max(-100,Math.min(100,e));let C=w*i.base+p*i.exploration+g*i.serendipity+x*i.diversity+y*i.flow+b*i.temporal+k*i.plugin;return t.explorationMode==="explore"?C+=p*.5:t.explorationMode==="exploit"&&(C+=w*.2),{baseScore:w,explorationBonus:p,serendipityScore:g,diversityScore:x,flowScore:y,temporalScore:b,pluginScore:k,finalScore:C,explanation:o}}function Vv(n){var i;const e=((i=n.genres)==null?void 0:i.map(o=>o.toLowerCase()))||[],t=["electronic","edm","dance","metal","punk","hardcore","drum and bass","dubstep"],s=["pop","rock","hip-hop","rap","indie","alternative","funk","disco"],r=["ambient","classical","jazz","acoustic","folk","lo-fi","chill","sleep"];for(const o of e){if(t.some(a=>o.includes(a)))return .8;if(r.some(a=>o.includes(a)))return .3;if(s.some(a=>o.includes(a)))return .55}return .5}function Ece(n,e){const t=["C","G","D","A","E","B","F#","C#","Ab","Eb","Bb","F"],s=u=>u.replace("m","").replace("#","#").toUpperCase(),r=s(n),i=s(e),o=t.indexOf(r),a=t.indexOf(i);if(o===-1||a===-1)return .5;const l=Math.min(Math.abs(o-a),12-Math.abs(o-a));return l<=1?1:l<=2?.8:l<=3?.5:.2}async function KP(n,e,t,s,r){const i=new Map,o=10;for(let a=0;a<n.length;a+=o){const u=n.slice(a,a+o).map(f=>$ce(f,e.get(f.id)||50,t,s,r.get(f.id)||0).then(p=>({trackId:f.id,score:p}))),d=await Promise.all(u);for(const{trackId:f,score:p}of d)i.set(f,p)}return i}function sk(n,e,t){return{pluginId:n,priority:e,getAudioFeatures:t.getAudioFeatures||(async()=>null),getSimilarTracks:t.getSimilarTracks,getArtistSimilarity:t.getArtistSimilarity}}function QP(n){bce(n),console.log(`[PluginAudio] Registered provider: ${n.pluginId} (priority: ${n.priority})`)}function dI(n){wce(n),console.log(`[PluginAudio] Unregistered provider: ${n}`)}function Ace(n,e){const s=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"][n]||"C";return e===0?`${s}m`:s}bp();const Ap=An()(Er((n,e)=>({isModelLoaded:!1,isTraining:!1,modelVersion:0,lastTrainedAt:0,eventsAtLastTrain:0,featureScalers:null,trainingMetrics:null,trainingProgress:null,lastError:null,initializeModel:async()=>{const t=ju();try{await t.loadModel()?(n({isModelLoaded:!0,lastError:null}),console.log("[MLStore] Model loaded successfully")):(t.createModel(),n({isModelLoaded:!1,lastError:null}),console.log("[MLStore] New model created, needs training"))}catch(s){const r=s instanceof Error?s.message:"Failed to initialize model";console.error("[MLStore] Initialization error:",r),n({lastError:r}),t.createModel()}},trainModel:async t=>{const s=e();if(s.isTraining)return console.log("[MLStore] Training already in progress"),!1;const r=dn.getState(),{listenHistory:i,userProfile:o,dislikedTracks:a}=r,l=i.length+Object.keys(a).length;if(!yce(l))return console.log("[MLStore] Not enough data to train"),n({lastError:"Need at least 50 listen events to train"}),!1;console.log(`[MLStore] Training with ${i.length} listens + ${Object.keys(a).length} disliked tracks`);let u=s.featureScalers;u||(u=t.length>0?kS(t):bp(),n({featureScalers:u}));const d=new Map;for(const f of t)d.set(f.id,f);n({isTraining:!0,trainingProgress:{epoch:0,totalEpochs:50,loss:0},lastError:null});try{const f=ju();f.isReady()||f.createModel();const p=await f.train(d,i,o,u,{epochs:50,batchSize:32},g=>{n({trainingProgress:g})},a);return await f.saveModel(),n({isModelLoaded:!0,isTraining:!1,modelVersion:s.modelVersion+1,lastTrainedAt:Date.now(),eventsAtLastTrain:i.length,trainingMetrics:p,trainingProgress:null,lastError:null}),console.log("[MLStore] Training complete:",p),!0}catch(f){const p=f instanceof Error?f.message:"Training failed";return console.error("[MLStore] Training error:",p),n({isTraining:!1,trainingProgress:null,lastError:p}),!1}},predictScore:(t,s)=>{const r=e();if(!r.isModelLoaded)return .5;const i=ju();if(!i.isReady())return .5;const o=dn.getState(),a=r.featureScalers||bp();return i.predict(t,o.userProfile,o.listenHistory,a,s)},predictBatchScores:(t,s)=>{const r=new Map,i=e();if(!i.isModelLoaded||t.length===0)return t.forEach(d=>r.set(d.id,.5)),r;const o=ju();if(!o.isReady())return t.forEach(d=>r.set(d.id,.5)),r;const a=dn.getState(),l=i.featureScalers||bp(),u=o.predictBatch(t,a.userProfile,a.listenHistory,l,s);return t.forEach((d,f)=>{r.set(d.id,u[f])}),r},getHybridScore:(t,s)=>{const r=e(),o=dn.getState().calculateTrackScore(t,{hour:s});if(!r.isModelLoaded)return o;const l=r.predictScore(t,s)*200-100,u=Math.min(.6,.1+r.modelVersion*.1),d=1-u,f=o*d+l*u;return Math.max(-100,Math.min(100,f))},getHybridRecommendations:(t,s=20,r)=>{const i=e(),o=dn.getState(),a=r??new Date().getHours(),l=t.filter(p=>!o.isDisliked(p.id));if(l.length===0)return[];const u=l.map(p=>({track:p,score:i.getHybridScore(p,a)}));u.sort((p,g)=>g.score-p.score);const d=Math.min(s*2,u.length),f=u.slice(0,d);for(let p=f.length-1;p>0;p--){const g=Math.min(p,3),x=p-Math.floor(Math.random()*g);x!==p&&Math.abs(f[p].score-f[x].score)<10&&([f[p],f[x]]=[f[x],f[p]])}return f.slice(0,s).map(p=>p.track)},updateScalers:t=>{if(t.length===0)return;const s=kS(t);n({featureScalers:s})},checkAndTrain:async t=>{const s=e();if(s.isTraining)return;const r=dn.getState(),{listenHistory:i}=r;vce(s.lastTrainedAt,i.length,s.eventsAtLastTrain,s.modelVersion)&&(console.log("[MLStore] Training triggered"),await s.trainModel(t))},resetModel:async()=>{const t=ju();await t.deleteModel(),t.dispose(),n({isModelLoaded:!1,isTraining:!1,modelVersion:0,lastTrainedAt:0,eventsAtLastTrain:0,featureScalers:null,trainingMetrics:null,trainingProgress:null,lastError:null}),console.log("[MLStore] Model reset")}}),{name:"audiio-ml",partialize:n=>({modelVersion:n.modelVersion,lastTrainedAt:n.lastTrainedAt,eventsAtLastTrain:n.eventsAtLastTrain,featureScalers:n.featureScalers,trainingMetrics:n.trainingMetrics})})),jce=1800*1e3,Rce=20,Dce=5e3;class Pce{constructor(){Mt(this,"cache",new Map);Mt(this,"pendingPrefetch",new Set);Mt(this,"lastPrefetchAttempt",new Map)}getCached(e){const t=this.cache.get(e);return t?this.isExpiredEntry(t)?(this.cache.delete(e),null):t.streamInfo:null}isExpired(e){const t=this.cache.get(e);return t?this.isExpiredEntry(t):!0}async prefetch(e){var s;if(!((s=window.api)!=null&&s.prefetchTracks)){console.warn("[StreamPrefetch] prefetchTracks API not available");return}const t=e.filter(r=>{if(this.isLocalTrack(r)||this.getCached(r.id)||this.pendingPrefetch.has(r.id))return!1;const i=this.lastPrefetchAttempt.get(r.id);return!(i&&Date.now()-i<Dce)});if(t.length!==0){t.forEach(r=>{this.pendingPrefetch.add(r.id),this.lastPrefetchAttempt.set(r.id,Date.now())}),console.log(`[StreamPrefetch] Prefetching ${t.length} tracks`);try{const r=await window.api.prefetchTracks(t),i=Date.now();let o=0;for(const a of t){const l=r[a.id];l&&(this.addToCache(a.id,l,i),o++)}console.log(`[StreamPrefetch] Cached ${o}/${t.length} streams`)}catch(r){console.warn("[StreamPrefetch] Prefetch failed:",r)}finally{t.forEach(r=>this.pendingPrefetch.delete(r.id))}}}addToCache(e,t,s){const r=s??Date.now(),i=t.expiresAt??r+360*60*1e3;this.cache.size>=Rce&&this.evictOldest(),this.cache.set(e,{streamInfo:t,resolvedAt:r,expiresAt:i})}remove(e){this.cache.delete(e),this.pendingPrefetch.delete(e)}clear(){this.cache.clear(),this.pendingPrefetch.clear(),this.lastPrefetchAttempt.clear()}cleanup(){const e=[];this.cache.forEach((t,s)=>{this.isExpiredEntry(t)&&e.push(s)}),e.forEach(t=>this.cache.delete(t)),e.length>0&&console.log(`[StreamPrefetch] Cleaned up ${e.length} expired entries`)}getStats(){return{size:this.cache.size,pending:this.pendingPrefetch.size}}isLocalTrack(e){var t,s,r,i,o;return e.id.startsWith("local:")||((t=e._meta)==null?void 0:t.metadataProvider)==="local-file"||((r=(s=e.streamInfo)==null?void 0:s.url)==null?void 0:r.startsWith("local-audio://"))||((o=(i=e.streamInfo)==null?void 0:i.url)==null?void 0:o.startsWith("file://"))}isExpiredEntry(e){return Date.now()>=e.expiresAt-jce}evictOldest(){let e=null,t=1/0;this.cache.forEach((s,r)=>{s.resolvedAt<t&&(t=s.resolvedAt,e=r)}),e&&this.cache.delete(e)}}const Vl=new Pce;typeof window<"u"&&setInterval(()=>{Vl.cleanup()},300*1e3);const Ke=An((n,e)=>({currentTrack:null,queue:[],queueIndex:-1,isPlaying:!1,position:0,duration:0,volume:1,isMuted:!1,isLoading:!1,error:null,shuffle:!1,repeat:"off",play:async t=>{var s,r;n({isLoading:!0,error:null});try{if((t.id.startsWith("local:")||((s=t._meta)==null?void 0:s.metadataProvider)==="local-file")&&((r=t.streamInfo)!=null&&r.url)){console.log("[PlayerStore] Playing local track with existing streamInfo:",t.streamInfo.url),n({currentTrack:t,isPlaying:!0,duration:t.duration*1e3,position:0,isLoading:!1});const{queue:o}=e(),a=o.findIndex(l=>l.id===t.id);a!==-1&&(n({queueIndex:a}),setTimeout(()=>{window.dispatchEvent(new CustomEvent("audiio:check-auto-queue"))},100))}else if(window.api){const o=Vl.getCached(t.id);let a;o&&!Vl.isExpired(t.id)?(console.log("[PlayerStore] Using prefetched stream for:",t.title),a=o):(a=await window.api.playTrack(t),Vl.addToCache(t.id,a));const l={...t,streamInfo:a};n({currentTrack:l,isPlaying:!0,duration:t.duration*1e3,position:0,isLoading:!1});const{queue:u}=e(),d=u.findIndex(p=>p.id===t.id);d!==-1&&(n({queueIndex:d}),setTimeout(()=>{window.dispatchEvent(new CustomEvent("audiio:check-auto-queue"))},100));const f=u.slice(d+1,d+4);f.length>0&&Vl.prefetch(f)}else{n({currentTrack:t,isPlaying:!0,duration:t.duration*1e3,position:0,isLoading:!1});const{queue:o}=e(),a=o.findIndex(l=>l.id===t.id);a!==-1&&(n({queueIndex:a}),setTimeout(()=>{window.dispatchEvent(new CustomEvent("audiio:check-auto-queue"))},100))}}catch(i){n({error:i instanceof Error?i.message:"Playback failed",isLoading:!1})}},pause:()=>{n({isPlaying:!1}),window.api&&window.api.pause()},resume:()=>{const{currentTrack:t}=e();t&&(n({isPlaying:!0}),window.api&&window.api.resume())},stop:()=>{n({isPlaying:!1,position:0})},seek:t=>{n({position:t}),window.api&&window.api.seek(t)},next:async()=>{const{queue:t,queueIndex:s,play:r,shuffle:i,repeat:o}=e();if(o==="one"){const l=t[s];l&&await r(l);return}let a=s+1;if(i){const l=t.map((u,d)=>d).filter(u=>u!==s);l.length>0&&(a=l[Math.floor(Math.random()*l.length)])}if(a<t.length){const l=t[a];l&&await r(l)}else if(o==="all"&&t.length>0){const l=t[0];l&&await r(l)}setTimeout(()=>{window.dispatchEvent(new CustomEvent("audiio:check-auto-queue"))},100)},previous:async()=>{const{queue:t,queueIndex:s,position:r,play:i,seek:o}=e();if(r>3e3){o(0);return}if(s>0){const a=t[s-1];a&&await i(a)}},setVolume:t=>{n({volume:Math.max(0,Math.min(1,t)),isMuted:!1})},toggleMute:()=>{n(t=>({isMuted:!t.isMuted}))},setQueue:(t,s=0)=>{n({queue:t,queueIndex:s});const r=t.slice(s,s+4);r.length>0&&Vl.prefetch(r)},addToQueue:t=>{n(s=>({queue:[...s.queue,t]}))},playNext:t=>{n(s=>{const r=s.queueIndex+1;return{queue:[...s.queue.slice(0,r),t,...s.queue.slice(r)]}})},removeFromQueue:t=>{n(s=>{const r=s.queue.findIndex(a=>a.id===t);if(r===-1)return s;const i=s.queue.filter(a=>a.id!==t);let o=s.queueIndex;if(r<s.queueIndex)o=s.queueIndex-1;else if(r===s.queueIndex)return s;return{queue:i,queueIndex:o}})},setPosition:t=>{n({position:t})},setIsPlaying:t=>{n({isPlaying:t})},setStreamInfo:(t,s)=>{n(r=>{var i;return((i=r.currentTrack)==null?void 0:i.id)===t.id?{currentTrack:{...r.currentTrack,streamInfo:s}}:r})},clearError:()=>{n({error:null})},toggleShuffle:()=>{n(t=>({shuffle:!t.shuffle}))},cycleRepeat:()=>{n(t=>{const s=["off","all","one"],i=(s.indexOf(t.repeat)+1)%s.length;return{repeat:s[i]}})},reorderQueue:(t,s)=>{n(r=>{const i=r.queueIndex+1+t,o=r.queueIndex+1+s,a=[...r.queue],[l]=a.splice(i,1);return l&&a.splice(o,0,l),{queue:a}})}}));function XP(){const n=dn,e=Ap,t=Ke,s=Ap(d=>d.isModelLoaded),r=Ap(d=>d.isTraining),i=j.useCallback((d="balanced")=>{const f=new Date,p=t.getState(),g=p.queue.slice(Math.max(0,p.queueIndex-5),p.queueIndex+1);return{hour:f.getHours(),dayOfWeek:f.getDay(),sessionTracks:g,recentGenres:g.flatMap(x=>x.genres||[]).slice(0,10),recentArtists:g.map(x=>{var y;return(y=x.artists[0])==null?void 0:y.name}).filter(Boolean).slice(0,5),recentEnergy:[],explorationMode:d,userMood:"auto"}},[]),o=j.useCallback(()=>{const d=n.getState();return{genrePreferences:d.userProfile.genrePreferences,artistPreferences:d.userProfile.artistPreferences,artistHistory:d.getArtistHistory(),genreHistory:d.getGenreHistory(),timePatterns:d.getTimePatternsForScoring()}},[]),a=j.useCallback(d=>{const f=e.getState(),p=n.getState();return f.isModelLoaded?f.getHybridScore(d):p.calculateTrackScore(d)},[]),l=j.useCallback(async(d,f={})=>{const{enabled:p=!0,explorationMode:g="balanced",minScore:x,limit:y,shuffle:b=!1,shuffleIntensity:k=.1}=f;if(!p||d.length===0)return d.map(M=>({track:M,score:0,explanation:[]}));const w=d.filter(M=>M&&M.id&&typeof M.id=="string");if(w.length===0)return d.map(M=>({track:M,score:0,explanation:[]}));const N=i(g),C=o(),S=n.getState().getPlayCounts(),T=new Map;for(const M of w)T.set(M.id,a(M));const A=await KP(w,T,N,C,S);let E=w.map(M=>{const P=A.get(M.id);return{track:M,score:(P==null?void 0:P.finalScore)??T.get(M.id)??0,explanation:(P==null?void 0:P.explanation)||[]}});return E.sort((M,P)=>P.score-M.score),x!==void 0&&(E=E.filter(M=>M.score>=x)),b&&E.length>1&&(E=hI(E,k)),y!==void 0&&y>0&&(E=E.slice(0,y)),E},[i,o,a]),u=j.useCallback((d,f={})=>{const{enabled:p=!0,minScore:g,limit:x,shuffle:y=!1,shuffleIntensity:b=.1}=f;if(!p||d.length===0)return d.map(w=>({track:w,score:0,explanation:[]}));let k=d.map(w=>({track:w,score:a(w),explanation:[]}));return k.sort((w,N)=>N.score-w.score),g!==void 0&&(k=k.filter(w=>w.score>=g)),y&&k.length>1&&(k=hI(k,b)),x!==void 0&&x>0&&(k=k.slice(0,x)),k},[a]);return{rankTracks:l,rankTracksSync:u,getTrackScore:a,isMLReady:s,isTraining:r}}function hI(n,e){const t=[...n],s=Math.ceil(t.length*e);for(let r=0;r<t.length;r++){const i=Math.min(s,3);if(Math.random()<e&&r+i<t.length){const o=r+1+Math.floor(Math.random()*i);Math.abs(t[r].score-t[o].score)<15&&([t[r],t[o]]=[t[o],t[r]])}}return t}const Mce={energy:1.5,valence:1.5,danceability:1.2,acousticness:1,instrumentalness:.8,speechiness:.6,liveness:.4,bpm:1,loudness:.5,brightness:.8,warmth:.8},Lce={dimensions:128,audioFeatureWeights:Mce,genreEmbeddingDimensions:32,normalizeVectors:!0,minConfidenceThreshold:.3},Fce={electronic:[1,.8,.9,.1,.9,.1,.3],edm:[1,.9,1,.05,.95,.05,.4],house:[.85,.8,.95,.1,.9,.1,.5],techno:[.9,.6,.85,.05,.95,.05,.3],dubstep:[.95,.5,.8,.05,.95,.1,.2],ambient:[.2,.5,.1,.3,.95,.02,.1],trance:[.85,.75,.8,.1,.9,.05,.3],dnb:[.95,.7,.75,.05,.9,.1,.2],rock:[.7,.6,.5,.3,.3,.1,.4],"indie-rock":[.6,.55,.45,.4,.35,.1,.3],"alt-rock":[.65,.5,.45,.35,.3,.1,.35],metal:[.95,.3,.4,.1,.2,.15,.3],punk:[.85,.6,.55,.2,.15,.2,.5],"classic-rock":[.65,.65,.5,.35,.25,.1,.4],pop:[.7,.8,.75,.3,.2,.15,.3],"synth-pop":[.75,.75,.8,.15,.7,.1,.25],"indie-pop":[.55,.7,.6,.45,.35,.1,.25],"dance-pop":[.8,.85,.9,.2,.5,.1,.35],kpop:[.75,.85,.85,.25,.4,.15,.3],"hip-hop":[.75,.7,.7,.15,.3,.7,.3],rap:[.8,.65,.65,.1,.25,.85,.25],trap:[.85,.6,.75,.1,.6,.6,.2],lofi:[.3,.6,.4,.4,.7,.1,.1],rnb:[.5,.7,.65,.35,.3,.3,.3],soul:[.45,.75,.55,.5,.2,.2,.35],funk:[.7,.85,.85,.35,.25,.15,.4],jazz:[.4,.6,.35,.6,.4,.1,.45],"smooth-jazz":[.3,.65,.3,.55,.45,.05,.35],bebop:[.55,.55,.3,.65,.5,.05,.4],classical:[.3,.5,.1,.9,.95,.02,.4],orchestral:[.45,.55,.1,.85,.95,.02,.35],folk:[.35,.6,.35,.85,.3,.15,.3],acoustic:[.3,.6,.35,.95,.4,.1,.25],country:[.5,.7,.55,.7,.2,.2,.35],latin:[.7,.85,.85,.45,.25,.2,.4],reggae:[.5,.8,.65,.4,.3,.15,.35],afrobeats:[.75,.85,.85,.35,.3,.2,.35],blues:[.45,.55,.4,.6,.25,.15,.4],gospel:[.55,.8,.5,.5,.2,.25,.5],soundtrack:[.4,.5,.15,.7,.75,.05,.3]},fI={chill:[.25,.6,.35,.5,.6,.1,.15],energetic:[.95,.8,.85,.15,.5,.2,.35],happy:[.7,.9,.75,.35,.35,.15,.3],sad:[.25,.25,.2,.6,.45,.15,.2],angry:[.9,.2,.5,.15,.2,.25,.25],romantic:[.35,.75,.45,.55,.35,.15,.25],focus:[.35,.5,.25,.5,.75,.05,.1],party:[.9,.9,.95,.15,.5,.2,.45],workout:[.95,.75,.8,.1,.6,.15,.3],sleep:[.1,.4,.1,.6,.85,.02,.05],melancholy:[.3,.35,.25,.55,.4,.1,.15],uplifting:[.75,.9,.7,.35,.4,.15,.35]};class Oce{constructor(e={}){this.embeddings=new Map,this.genreEmbeddingCache=new Map,this.version=1,this.config={...Lce,...e},this.initializeGenreEmbeddings()}initializeGenreEmbeddings(){for(const[e,t]of Object.entries(Fce)){const s=this.expandVector(t,this.config.genreEmbeddingDimensions);this.genreEmbeddingCache.set(e,s)}}generateEmbedding(e){const t=Date.now(),s=[],r={audioFeaturesUsed:[],genresUsed:[],confidenceScore:0};if(e.audioFeatures&&this.hasMinimumAudioFeatures(e.audioFeatures)){const a=this.generateAudioFeatureVector(e.audioFeatures);s.push(a),r.audioFeaturesUsed=Object.keys(e.audioFeatures).filter(l=>e.audioFeatures[l]!==void 0),r.confidenceScore=.8}if(e.genres&&e.genres.length>0){const a=this.generateGenreVector(e.genres);s.push(a),r.genresUsed=e.genres,r.confidenceScore=Math.max(r.confidenceScore??0,.6)}if(e.tags&&e.tags.length>0){const a=this.generateTagVector(e.tags);a&&s.push(a)}let i;s.length===0?(i=this.generateNeutralVector(),r.confidenceScore=.1):s.length===1?i=s[0]:i=this.combineVectors(s),this.config.normalizeVectors&&(i=this.normalizeVector(i));const o={trackId:e.id,vector:i,version:this.version,createdAt:t,updatedAt:t,source:this.determineSource(e),metadata:r};return this.embeddings.set(e.id,o),o}generateAudioFeatureVector(e){const t=this.config.audioFeatureWeights,s=this.config.dimensions,r=new Float32Array(s),i=[["energy",e.energy??.5,t.energy],["valence",e.valence??.5,t.valence],["danceability",e.danceability??.5,t.danceability],["acousticness",e.acousticness??.5,t.acousticness],["instrumentalness",e.instrumentalness??.5,t.instrumentalness],["speechiness",e.speechiness??.1,t.speechiness],["liveness",e.liveness??.2,t.liveness],["bpm",this.normalizeBpm(e.bpm??120),t.bpm],["loudness",this.normalizeLoudness(e.loudness??-10),t.loudness],["brightness",e.brightness??.5,t.brightness],["warmth",e.warmth??.5,t.warmth]],o=(1+Math.sqrt(5))/2;for(let a=0;a<i.length;a++){const[,l,u]=i[a],d=Math.floor(a*o*s%s),f=Math.floor(s/i.length);for(let p=0;p<f;p++){const g=(d+p)%s,x=u*Math.exp(-p*.3);r[g]+=l*x}}if(e.energy!==void 0&&e.valence!==void 0){const a=e.energy*e.valence;for(let l=0;l<8;l++)r[(s-1-l)%s]+=a*.5}if(e.danceability!==void 0&&e.bpm!==void 0){const a=e.danceability*this.normalizeBpm(e.bpm);for(let l=0;l<8;l++)r[(s-9-l)%s]+=a*.4}return r}generateGenreVector(e){const t=this.config.dimensions,s=new Float32Array(t);let r=0;for(const i of e){const o=this.normalizeGenre(i);let a=this.genreEmbeddingCache.get(o);if(a||(a=this.findClosestGenreEmbedding(o)),a){for(let l=0;l<t;l++)s[l]+=a[l];r++}}if(r>1)for(let i=0;i<t;i++)s[i]/=r;return s}generateTagVector(e){const t=this.config.dimensions,s=new Float32Array(t);let r=0;for(const i of e){const o=i.toLowerCase().trim(),a=fI[o];if(a){const u=this.expandVector(a,t);for(let d=0;d<t;d++)s[d]+=u[d];r++;continue}const l=this.genreEmbeddingCache.get(o);if(l){for(let u=0;u<t;u++)s[u]+=l[u];r++}}if(r===0)return null;for(let i=0;i<t;i++)s[i]/=r;return s}generateNeutralVector(){const e=this.config.dimensions,t=new Float32Array(e);for(let s=0;s<e;s++)t[s]=.5+(Math.random()-.5)*.1;return t}combineVectors(e){const t=this.config.dimensions,s=new Float32Array(t);for(const r of e)for(let i=0;i<t;i++)s[i]+=r[i];for(let r=0;r<t;r++)s[r]/=e.length;return s}normalizeVector(e){let t=0;for(let r=0;r<e.length;r++)t+=e[r]*e[r];if(t=Math.sqrt(t),t===0)return e;const s=new Float32Array(e.length);for(let r=0;r<e.length;r++)s[r]=e[r]/t;return s}expandVector(e,t){const s=new Float32Array(t),r=e.length;for(let i=0;i<t;i++){const o=i*r/t,a=Math.floor(o),l=Math.min(a+1,r-1),u=o-a;s[i]=e[a]*(1-u)+e[l]*u}return s}normalizeGenre(e){return e.toLowerCase().trim().replace(/[^a-z0-9-]/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")}findClosestGenreEmbedding(e){const t=e.toLowerCase();for(const[r,i]of this.genreEmbeddingCache)if(r.includes(t)||t.includes(r))return i;const s=t.split(/[-\s]+/);for(const[r,i]of this.genreEmbeddingCache){const o=r.split(/[-\s]+/);if(s.filter(l=>o.includes(l)).length>0)return i}}normalizeBpm(e){return Math.max(0,Math.min(1,(e-60)/120))}normalizeLoudness(e){return Math.max(0,Math.min(1,(e+60)/60))}hasMinimumAudioFeatures(e){let s=0;return e.energy!==void 0&&s++,e.valence!==void 0&&s++,e.danceability!==void 0&&s++,e.bpm!==void 0&&s++,e.acousticness!==void 0&&s++,s>=3}determineSource(e){const t=e.audioFeatures&&this.hasMinimumAudioFeatures(e.audioFeatures),s=e.genres&&e.genres.length>0;return t&&s?"hybrid":t?"audio-features":"genre-tags"}getEmbedding(e){return this.embeddings.get(e)}getOrGenerateEmbedding(e){const t=this.embeddings.get(e.id);return t&&t.version===this.version?t:this.generateEmbedding(e)}generateBatch(e){const t=new Map;for(const s of e){const r=this.generateEmbedding(s);t.set(s.id,r)}return t}updateEmbedding(e,t){const s=this.embeddings.get(e),r=this.generateEmbedding(t);if(s){const i=new Float32Array(this.config.dimensions);for(let o=0;o<this.config.dimensions;o++)i[o]=r.vector[o]*.7+s.vector[o]*.3;r.vector=this.normalizeVector(i),r.createdAt=s.createdAt}return this.embeddings.set(e,r),r}generateMoodVector(e){const t=fI[e.toLowerCase()];if(t){const s=this.expandVector(t,this.config.dimensions);return this.normalizeVector(s)}return this.generateNeutralVector()}generateGenreQueryVector(e){const t=this.normalizeGenre(e),s=this.genreEmbeddingCache.get(t);if(s)return this.normalizeVector(new Float32Array(s));const r=this.findClosestGenreEmbedding(t);return r?this.normalizeVector(new Float32Array(r)):this.generateNeutralVector()}getAllEmbeddings(){return new Map(this.embeddings)}clear(){this.embeddings.clear()}getDimensions(){return this.config.dimensions}exportEmbeddings(){const e=[];for(const[t,s]of this.embeddings)e.push({trackId:t,vector:Array.from(s.vector),metadata:s.metadata});return e}importEmbeddings(e){const t=Date.now();for(const s of e){const r={trackId:s.trackId,vector:new Float32Array(s.vector),version:this.version,createdAt:t,updatedAt:t,source:"hybrid",metadata:s.metadata};this.embeddings.set(s.trackId,r)}}}const _ce={dimensions:128,maxElements:1e5,efConstruction:200,efSearch:50,mMax:16,mMax0:32};class zce{constructor(e={}){this.nodes=new Map,this.entryPoint=null,this.maxLayer=0,this.config={..._ce,...e},this.levelMultiplier=1/Math.log(this.config.mMax)}add(e,t){if(this.nodes.has(e)){this.update(e,t);return}const s=this.getRandomLevel(),r={id:e,vector:new Float32Array(t),connections:new Map,layer:s};for(let o=0;o<=s;o++)r.connections.set(o,new Set);if(this.nodes.set(e,r),this.entryPoint===null){this.entryPoint=e,this.maxLayer=s;return}let i=this.entryPoint;this.distance(t,this.nodes.get(i).vector);for(let o=this.maxLayer;o>s;o--){const a=this.searchLayer(t,i,1,o);a.length>0&&(i=a[0].id,a[0].distance)}for(let o=Math.min(s,this.maxLayer);o>=0;o--){const a=this.searchLayer(t,i,this.config.efConstruction,o),l=o===0?this.config.mMax0:this.config.mMax,u=this.selectNeighbors(a,l);for(const d of u){r.connections.get(o).add(d.id);const f=this.nodes.get(d.id);f.connections.has(o)||f.connections.set(o,new Set),f.connections.get(o).add(e)}for(const d of u){const f=this.nodes.get(d.id);f.connections.get(o).size>l&&this.pruneConnections(f,o,l)}a.length>0&&(i=a[0].id)}s>this.maxLayer&&(this.entryPoint=e,this.maxLayer=s)}update(e,t){const s=this.nodes.get(e);if(!s){this.add(e,t);return}s.vector=new Float32Array(t)}remove(e){const t=this.nodes.get(e);if(!t)return!1;for(const[s,r]of t.connections)for(const i of r){const o=this.nodes.get(i);o&&o.connections.has(s)&&o.connections.get(s).delete(e)}if(this.nodes.delete(e),this.entryPoint===e)if(this.nodes.size===0)this.entryPoint=null,this.maxLayer=0;else{let s=-1,r=null;for(const[i,o]of this.nodes)o.layer>s&&(s=o.layer,r=i);this.entryPoint=r,this.maxLayer=s}return!0}search(e,t){if(this.entryPoint===null||this.nodes.size===0)return[];let s=this.entryPoint;for(let i=this.maxLayer;i>0;i--){const o=this.searchLayer(e,s,1,i);o.length>0&&(s=o[0].id)}return this.searchLayer(e,s,Math.max(t,this.config.efSearch),0).slice(0,t).map(i=>({trackId:i.id,score:1/(1+i.distance),distance:i.distance}))}searchLayer(e,t,s,r){const i=this.nodes.get(t);if(!i)return[];const o=new Set([t]),a=[{id:t,distance:this.distance(e,i.vector)}],l=[...a];for(;a.length>0;){a.sort((g,x)=>g.distance-x.distance);const u=a.shift(),d=l[l.length-1];if(u.distance>d.distance&&l.length>=s)break;const p=this.nodes.get(u.id).connections.get(r);if(p)for(const g of p){if(o.has(g))continue;o.add(g);const x=this.nodes.get(g);if(!x)continue;const y=this.distance(e,x.vector);(l.length<s||y<l[l.length-1].distance)&&(a.push({id:g,distance:y}),l.push({id:g,distance:y}),l.sort((b,k)=>b.distance-k.distance),l.length>s&&l.pop())}}return l}selectNeighbors(e,t){return e.slice(0,t)}pruneConnections(e,t,s){const r=e.connections.get(t);if(r.size<=s)return;const i=[];for(const a of r){const l=this.nodes.get(a);l&&i.push({id:a,distance:this.distance(e.vector,l.vector)})}i.sort((a,l)=>a.distance-l.distance);const o=new Set(i.slice(0,s).map(a=>a.id));for(const a of r)if(!o.has(a)){r.delete(a);const l=this.nodes.get(a);l&&l.connections.has(t)&&l.connections.get(t).delete(e.id)}}getRandomLevel(){const e=Math.random();return Math.floor(-Math.log(e)*this.levelMultiplier)}distance(e,t){let s=0;const r=Math.min(e.length,t.length);for(let i=0;i<r;i++){const o=e[i]-t[i];s+=o*o}return Math.sqrt(s)}cosineSimilarity(e,t){let s=0,r=0,i=0;const o=Math.min(e.length,t.length);for(let a=0;a<o;a++)s+=e[a]*t[a],r+=e[a]*e[a],i+=t[a]*t[a];return r===0||i===0?0:s/(Math.sqrt(r)*Math.sqrt(i))}searchByCosine(e,t){return this.nodes.size===0?[]:this.nodes.size<=1e3?this.bruteForceSearch(e,t):this.search(e,t)}bruteForceSearch(e,t){const s=[];for(const[r,i]of this.nodes){const o=this.cosineSimilarity(e,i.vector);s.push({trackId:r,score:o,distance:1-o})}return s.sort((r,i)=>i.score-r.score),s.slice(0,t)}size(){return this.nodes.size}has(e){return this.nodes.has(e)}get(e){var t;return(t=this.nodes.get(e))==null?void 0:t.vector}clear(){this.nodes.clear(),this.entryPoint=null,this.maxLayer=0}buildFromEmbeddings(e){this.clear();for(const[t,s]of e)this.add(t,s.vector)}export(){const e=[];for(const[t,s]of this.nodes)e.push({id:t,vector:Array.from(s.vector),layer:s.layer});return{nodes:e,entryPoint:this.entryPoint,maxLayer:this.maxLayer}}import(e){this.clear();for(const t of e.nodes)this.add(t.id,new Float32Array(t.vector))}getStats(){let e=0;for(const t of this.nodes.values())for(const s of t.connections.values())e+=s.size;return{size:this.nodes.size,maxLayer:this.maxLayer,avgConnections:this.nodes.size>0?e/this.nodes.size:0,dimensions:this.config.dimensions}}}const Bce={dimensions:128,likeWeight:3,listenWeight:1,recentWeight:1.5,recencyDecayDays:30,minTracksForProfile:5,contextTimeSlots:4,maxTracksToConsider:1e3};class Wce{constructor(e,t,s={}){this.profile=null,this.interactions=[],this.userId=e,this.embeddingEngine=t,this.config={...Bce,...s}}addInteraction(e){this.interactions.push(e),this.interactions.length>this.config.maxTracksToConsider&&(this.interactions=this.interactions.sort((t,s)=>s.timestamp-t.timestamp).slice(0,this.config.maxTracksToConsider)),this.profile=null}addLike(e,t,s,r){this.addInteraction({trackId:e,embedding:t,interactionType:"like",timestamp:Date.now(),genres:s,artistId:r,context:this.getCurrentContext()})}addListen(e,t,s,r,i,o){this.addInteraction({trackId:e,embedding:t,interactionType:"listen",timestamp:Date.now(),duration:s,completed:s>=r*.8,genres:i,artistId:o,context:this.getCurrentContext()})}generateProfile(){if(this.profile&&this.interactions.length===this.profile.stats.tracksContributed)return this.profile;const e=Date.now(),t=this.config.dimensions,s=new Float32Array(t);let r=0;const i={},o={};let a=0,l=0;const u={morning:{vector:new Float32Array(t),weight:0},afternoon:{vector:new Float32Array(t),weight:0},evening:{vector:new Float32Array(t),weight:0},night:{vector:new Float32Array(t),weight:0},weekday:{vector:new Float32Array(t),weight:0},weekend:{vector:new Float32Array(t),weight:0}};for(const g of this.interactions){let x=this.config.listenWeight;g.interactionType==="like"?(x=this.config.likeWeight,a++):g.interactionType==="download"?x=this.config.likeWeight*1.2:g.interactionType==="playlist-add"&&(x=this.config.likeWeight*.8),g.completed&&(x*=1.5);const y=(e-g.timestamp)/(1440*60*1e3),b=Math.pow(.5,y/this.config.recencyDecayDays);x*=b*this.config.recentWeight;for(let k=0;k<t;k++)s[k]+=g.embedding[k]*x;if(r+=x,g.genres)for(const k of g.genres)i[k]=(i[k]||0)+1;if(g.artistId&&(o[g.artistId]=(o[g.artistId]||0)+1),g.duration&&(l+=g.duration),g.context){const{hour:k,dayOfWeek:w}=g.context;if(k!==void 0){const N=this.getTimeSlot(k),C=u[N];for(let S=0;S<t;S++)C.vector[S]+=g.embedding[S]*x;C.weight+=x}if(w!==void 0){const C=u[w===0||w===6?"weekend":"weekday"];for(let S=0;S<t;S++)C.vector[S]+=g.embedding[S]*x;C.weight+=x}}}if(r>0)for(let g=0;g<t;g++)s[g]/=r;const d=this.normalizeVector(s),f={};for(const[g,x]of Object.entries(u))if(x.weight>0){for(let y=0;y<t;y++)x.vector[y]/=x.weight;f[g]=this.normalizeVector(x.vector)}const p={tracksContributed:this.interactions.length,likesContributed:a,totalListenTime:l,genreDistribution:i,artistDistribution:o};return this.profile={userId:this.userId,vector:d,version:1,updatedAt:e,stats:p,contextProfiles:f},this.profile}getContextualVector(e,t){const s=this.generateProfile(),r=s.contextProfiles;if(!r)return s.vector;const i=this.getTimeSlot(e),o=t===0||t===6,a=r[i],l=o?r.weekend:r.weekday;if(!a&&!l)return s.vector;const u=this.config.dimensions,d=new Float32Array(u),f=.5,p=a?.3:0,g=l?.2:0,x=f+p+g;for(let y=0;y<u;y++)d[y]=s.vector[y]*f,a&&(d[y]+=a[y]*p),l&&(d[y]+=l[y]*g),d[y]/=x;return this.normalizeVector(d)}getTimeSlot(e){return e>=6&&e<12?"morning":e>=12&&e<18?"afternoon":e>=18&&e<22?"evening":"night"}isProfileValid(){return this.interactions.length>=this.config.minTracksForProfile}getProfile(){return this.isProfileValid()?this.generateProfile():null}getTasteVector(){return this.isProfileValid()?this.generateProfile().vector:null}calculateTrackSimilarity(e){const t=this.getProfile();return t?this.cosineSimilarity(t.vector,e):.5}calculateContextualSimilarity(e,t,s){if(!this.isProfileValid())return .5;const r=this.getContextualVector(t,s);return this.cosineSimilarity(r,e)}getTopGenres(e=5){const t=this.getProfile();return t?Object.entries(t.stats.genreDistribution).sort((s,r)=>r[1]-s[1]).slice(0,e).map(([s,r])=>({genre:s,count:r})):[]}getTopArtists(e=5){const t=this.getProfile();return t?Object.entries(t.stats.artistDistribution).sort((s,r)=>r[1]-s[1]).slice(0,e).map(([s,r])=>({artistId:s,count:r})):[]}getExplorationVector(){const e=this.getProfile();if(!e)return null;const t=this.config.dimensions,s=new Float32Array(t);for(let r=0;r<t;r++)s[r]=e.vector[r]*.3+(Math.random()-.5)*.7;return this.normalizeVector(s)}blendWithMood(e,t=.6){const s=this.getProfile();if(!s)return e;const r=this.config.dimensions,i=new Float32Array(r),o=1-t;for(let a=0;a<r;a++)i[a]=s.vector[a]*o+e[a]*t;return this.normalizeVector(i)}normalizeVector(e){let t=0;for(let r=0;r<e.length;r++)t+=e[r]*e[r];if(t=Math.sqrt(t),t===0)return e;const s=new Float32Array(e.length);for(let r=0;r<e.length;r++)s[r]=e[r]/t;return s}cosineSimilarity(e,t){let s=0,r=0,i=0;const o=Math.min(e.length,t.length);for(let a=0;a<o;a++)s+=e[a]*t[a],r+=e[a]*e[a],i+=t[a]*t[a];return r===0||i===0?0:s/(Math.sqrt(r)*Math.sqrt(i))}getCurrentContext(){const e=new Date;return{hour:e.getHours(),dayOfWeek:e.getDay()}}export(){return{userId:this.userId,interactions:this.interactions.map(e=>({trackId:e.trackId,vector:Array.from(e.embedding),type:e.interactionType,timestamp:e.timestamp,genres:e.genres,artistId:e.artistId}))}}import(e){this.interactions=e.interactions.map(t=>({trackId:t.trackId,embedding:new Float32Array(t.vector),interactionType:t.type,timestamp:t.timestamp,genres:t.genres,artistId:t.artistId})),this.profile=null}clear(){this.interactions=[],this.profile=null}getInteractionCount(){return this.interactions.length}}const Vce={maxPairs:5e4,decayFactor:.98,minCount:2,sessionWindow:1800*1e3,maxSessionTracks:20};class Uce{constructor(e={}){this.matrix=new Map,this.lastDecay=Date.now(),this.config={...Vce,...e}}getPairKey(e,t){return e<t?`${e}:${t}`:`${t}:${e}`}recordCoOccurrence(e,t,s=1){if(e.length<2)return;const r=Date.now(),i=e.slice(0,this.config.maxSessionTracks);for(let o=0;o<i.length;o++)for(let a=o+1;a<i.length;a++){const l=this.getPairKey(i[o],i[a]);let u=this.matrix.get(l);u||(u={count:0,contexts:new Map,lastSeen:r,firstSeen:r},this.matrix.set(l,u));const d=a-o,f=s*Math.exp(-d*.1);u.count+=f,u.lastSeen=r,u.contexts.set(t,(u.contexts.get(t)||0)+f)}this.maybeApplyDecay(),this.matrix.size>this.config.maxPairs&&this.prune()}recordSequentialPlay(e,t,s="session"){if(e===t)return;const r=this.getPairKey(e,t),i=Date.now();let o=this.matrix.get(r);o||(o={count:0,contexts:new Map,lastSeen:i,firstSeen:i},this.matrix.set(r,o)),o.count+=1.5,o.lastSeen=i,o.contexts.set(s,(o.contexts.get(s)||0)+1.5)}recordLikeAfterPlay(e,t){if(e===t)return;const s=this.getPairKey(e,t),r=Date.now();let i=this.matrix.get(s);i||(i={count:0,contexts:new Map,lastSeen:r,firstSeen:r},this.matrix.set(s,i)),i.count+=3,i.lastSeen=r,i.contexts.set("session",(i.contexts.get("session")||0)+3)}getScore(e,t){const s=this.getPairKey(e,t),r=this.matrix.get(s);return r?r.count:0}getRelatedTracks(e,t=50){const s=[];for(const[r,i]of this.matrix){const[o,a]=r.split(":");o===e?s.push({trackId:a,score:i.count}):a===e&&s.push({trackId:o,score:i.count})}return s.sort((r,i)=>i.score-r.score).slice(0,t)}getRelatedTracksMultiple(e,t=50){const s=new Map,r=new Set(e);for(const i of e){const o=this.getRelatedTracks(i,t*2);for(const{trackId:a,score:l}of o)r.has(a)||s.set(a,(s.get(a)||0)+l)}return Array.from(s.entries()).map(([i,o])=>({trackId:i,score:o})).sort((i,o)=>o.score-i.score).slice(0,t)}generateCollaborativeEmbedding(e,t){const s=this.getRelatedTracks(e,100);if(s.length<3)return null;const r=new Float32Array(t);let i=0;for(const{trackId:a,score:l}of s){const u=this.hashString(a),d=Math.log1p(l);for(let f=0;f<t;f++){const p=u*(f+1)*2654435761%1e3/1e3-.5;r[f]+=p*d}i+=d}if(i>0)for(let a=0;a<t;a++)r[a]/=i;let o=0;for(let a=0;a<t;a++)o+=r[a]*r[a];if(o=Math.sqrt(o),o>0)for(let a=0;a<t;a++)r[a]/=o;return r}hashString(e){let t=5381;for(let s=0;s<e.length;s++)t=(t<<5)+t^e.charCodeAt(s);return Math.abs(t)}maybeApplyDecay(){const e=Date.now(),t=(e-this.lastDecay)/(1440*60*1e3);if(t<1)return;const s=Math.pow(this.config.decayFactor,Math.floor(t));for(const[r,i]of this.matrix)i.count*=s,i.count<this.config.minCount&&this.matrix.delete(r);this.lastDecay=e}prune(){if(this.matrix.size<=this.config.maxPairs)return;const e=Array.from(this.matrix.entries()).map(([s,r])=>{const i=Math.exp(-(Date.now()-r.lastSeen)/6048e5);return{key:s,priority:r.count*i}});e.sort((s,r)=>s.priority-r.priority);const t=e.slice(0,e.length-this.config.maxPairs);for(const{key:s}of t)this.matrix.delete(s)}getStats(){let e=0;const t=[];for(const[s,r]of this.matrix)e+=r.count,t.push({pair:s,score:r.count});return t.sort((s,r)=>r.score-s.score),{pairCount:this.matrix.size,avgScore:this.matrix.size>0?e/this.matrix.size:0,topPairs:t.slice(0,10)}}export(){const e=[];for(const[t,s]of this.matrix)e.push({key:t,count:s.count,contexts:Object.fromEntries(s.contexts),lastSeen:s.lastSeen,firstSeen:s.firstSeen});return e}import(e){this.matrix.clear();for(const t of e)this.matrix.set(t.key,{count:t.count,contexts:new Map(Object.entries(t.contexts)),lastSeen:t.lastSeen,firstSeen:t.firstSeen});this.lastDecay=Date.now()}clear(){this.matrix.clear(),this.lastDecay=Date.now()}size(){return this.matrix.size}}class Gce{constructor(e,t,s,r){this.trackMetadata=new Map,this.embeddingEngine=e,this.vectorIndex=t,this.cooccurrence=s,this.tasteProfile=r??null}setTasteProfile(e){this.tasteProfile=e}registerTrack(e){this.trackMetadata.set(e.id,e);const t=this.embeddingEngine.getOrGenerateEmbedding(e);this.vectorIndex.add(e.id,t.vector)}registerTracks(e){for(const t of e)this.registerTrack(t)}generateMoodPlaylist(e,t={}){const s=this.normalizeOptions(t),r=Date.now();let i=this.embeddingEngine.generateMoodVector(e);if(this.tasteProfile&&s.explorationFactor!==1){const d=this.tasteProfile.blendWithMood(i,.6+s.explorationFactor*.3);d&&(i=d)}const o=this.vectorIndex.searchByCosine(i,s.limit*3),a=this.filterCandidates(o,s),l=this.rankWithCollaborative(a,s),u=this.selectFinal(l,s);return{tracks:u,queryVector:i,method:"mood",stats:{candidatesConsidered:o.length,embeddingSearchTime:Date.now()-r,collaborativeBoost:s.includeCollaborative?.2:0,avgSimilarity:this.calculateAvgSimilarity(u)}}}generateGenrePlaylist(e,t={}){const s=this.normalizeOptions(t),r=Date.now();let i=this.embeddingEngine.generateGenreQueryVector(e);if(this.tasteProfile&&s.explorationFactor!==1){const d=this.tasteProfile.getTasteVector();d&&(i=this.blendVectors(i,d,.7,.3))}const o=this.vectorIndex.searchByCosine(i,s.limit*3),a=this.filterCandidates(o,s),l=this.rankWithCollaborative(a,s),u=this.selectFinal(l,s);return{tracks:u,queryVector:i,method:"genre",stats:{candidatesConsidered:o.length,embeddingSearchTime:Date.now()-r,collaborativeBoost:s.includeCollaborative?.2:0,avgSimilarity:this.calculateAvgSimilarity(u)}}}generateSeedPlaylist(e,t={}){const s=this.normalizeOptions({...t,seedTrackIds:e}),r=Date.now(),i=[];for(const p of e){const g=this.embeddingEngine.getEmbedding(p);g&&i.push(g.vector)}if(i.length===0)return this.generatePersonalizedPlaylist(t);let o=this.averageVectors(i);if(this.tasteProfile){const p=this.tasteProfile.getTasteVector();p&&(o=this.blendVectors(o,p,.8,.2))}const a=this.vectorIndex.searchByCosine(o,s.limit*3),l=this.cooccurrence.getRelatedTracksMultiple(e,s.limit),u=this.mergeCandidates(a,l,.7,.3),d=this.filterCandidates(u,s),f=this.selectFinal(d,s);return{tracks:f,queryVector:o,method:"seed-tracks",stats:{candidatesConsidered:a.length+l.length,embeddingSearchTime:Date.now()-r,collaborativeBoost:l.length>0?.3:0,avgSimilarity:this.calculateAvgSimilarity(f)}}}generatePersonalizedPlaylist(e={}){const t=this.normalizeOptions(e),s=Date.now();let r,i="personalized";if(this.tasteProfile&&this.tasteProfile.isProfileValid()){if(t.contextHour!==void 0&&t.contextDayOfWeek!==void 0?r=this.tasteProfile.getContextualVector(t.contextHour,t.contextDayOfWeek):r=this.tasteProfile.getTasteVector(),t.explorationFactor&&t.explorationFactor>0){const d=this.tasteProfile.getExplorationVector();d&&(r=this.blendVectors(r,d,1-t.explorationFactor,t.explorationFactor),i="discovery")}}else r=this.generatePopularityVector(),i="discovery";const o=this.vectorIndex.searchByCosine(r,t.limit*3),a=this.filterCandidates(o,t),l=this.rankWithCollaborative(a,t),u=this.selectFinal(l,t);return{tracks:u,queryVector:r,method:i,stats:{candidatesConsidered:o.length,embeddingSearchTime:Date.now()-s,collaborativeBoost:t.includeCollaborative?.2:0,avgSimilarity:this.calculateAvgSimilarity(u)}}}generateArtistRadio(e,t={}){const s=this.normalizeOptions({...t,seedArtistId:e}),r=Date.now(),i=[];for(const x of this.trackMetadata.values())x.artistId===e&&i.push(x);if(i.length===0)return this.generatePersonalizedPlaylist(t);const o=[];for(const x of i){const y=this.embeddingEngine.getEmbedding(x.id);y&&o.push(y.vector)}let a=this.averageVectors(o);if(this.tasteProfile){const x=this.tasteProfile.getTasteVector();x&&(a=this.blendVectors(a,x,.85,.15))}const l=this.vectorIndex.searchByCosine(a,s.limit*3),u=i.map(x=>x.id),d=this.cooccurrence.getRelatedTracksMultiple(u.slice(0,10),s.limit),f=this.mergeCandidates(l,d,.7,.3),p=this.filterCandidates(f,s),g=this.selectFinal(p,s);return{tracks:g,queryVector:a,method:"artist-radio",stats:{candidatesConsidered:l.length+d.length,embeddingSearchTime:Date.now()-r,collaborativeBoost:.3,avgSimilarity:this.calculateAvgSimilarity(g)}}}generateEnergyPlaylist(e,t={}){const s={low:"chill",medium:"happy",high:"energetic"};return this.generateMoodPlaylist(s[e],{...t,energy:e})}generateDiscoveryPlaylist(e={}){return this.generatePersonalizedPlaylist({...e,explorationFactor:.7})}findSimilarTracks(e,t=20){const s=this.embeddingEngine.getEmbedding(e);if(!s)return[];const r=this.vectorIndex.searchByCosine(s.vector,t*2),i=this.cooccurrence.getRelatedTracks(e,t);return this.mergeCandidates(r,i,.6,.4).filter(a=>a.trackId!==e).slice(0,t).map(a=>({trackId:a.trackId,score:a.score,reasons:this.generateReasons(a.trackId,e)}))}normalizeOptions(e){return{limit:20,explorationFactor:.2,includeCollaborative:!0,...e,excludeTrackIds:e.excludeTrackIds||[],excludeArtistIds:e.excludeArtistIds||[]}}filterCandidates(e,t){const s=new Set(t.excludeTrackIds),r=new Set(t.excludeArtistIds);if(t.seedTrackIds)for(const i of t.seedTrackIds)s.add(i);return e.filter(i=>{if(s.has(i.trackId))return!1;const o=this.trackMetadata.get(i.trackId);return!(o&&o.artistId&&r.has(o.artistId))})}rankWithCollaborative(e,t){var i;if(!t.includeCollaborative||!((i=t.seedTrackIds)!=null&&i.length))return e;const s=new Map,r=this.cooccurrence.getRelatedTracksMultiple(t.seedTrackIds,100);for(const{trackId:o,score:a}of r)s.set(o,a);return e.map(o=>{const a=s.get(o.trackId)||0,l=a>0?Math.log1p(a)*.1:0;return{...o,score:o.score+l}}).sort((o,a)=>a.score-o.score)}selectFinal(e,t){var i;const s=[];for(const o of e){if(s.length>=t.limit)break;const a=this.trackMetadata.get(o.trackId);a!=null&&a.artistId&&Array.from(s).filter(u=>{var d;return((d=this.trackMetadata.get(u.trackId))==null?void 0:d.artistId)===a.artistId}).length>=3||s.push({trackId:o.trackId,score:o.score,reasons:this.generateReasons(o.trackId,(i=t.seedTrackIds)==null?void 0:i[0])})}return s}mergeCandidates(e,t,s,r){const i=new Map,o=Math.max(...e.map(l=>l.score),.001);for(const l of e){const u=l.score/o*s;i.set(l.trackId,u)}const a=Math.max(...t.map(l=>l.score),.001);for(const l of t){const u=l.score/a*r;i.set(l.trackId,(i.get(l.trackId)||0)+u)}return Array.from(i.entries()).map(([l,u])=>({trackId:l,score:u,distance:1-u})).sort((l,u)=>u.score-l.score)}averageVectors(e){if(e.length===0)return new Float32Array(128);const t=e[0].length,s=new Float32Array(t);for(const r of e)for(let i=0;i<t;i++)s[i]+=r[i];for(let r=0;r<t;r++)s[r]/=e.length;return this.normalizeVector(s)}blendVectors(e,t,s,r){const i=e.length,o=new Float32Array(i);for(let a=0;a<i;a++)o[a]=e[a]*s+t[a]*r;return this.normalizeVector(o)}normalizeVector(e){let t=0;for(let r=0;r<e.length;r++)t+=e[r]*e[r];if(t=Math.sqrt(t),t===0)return e;const s=new Float32Array(e.length);for(let r=0;r<e.length;r++)s[r]=e[r]/t;return s}generatePopularityVector(){return this.embeddingEngine.generateGenreQueryVector("pop")}calculateAvgSimilarity(e){return e.length===0?0:e.reduce((t,s)=>t+s.score,0)/e.length}generateReasons(e,t){const s=[],r=this.trackMetadata.get(e);if(!r)return["Similar sound"];if(r.genres&&r.genres.length>0&&s.push(`${r.genres[0]} vibes`),t&&this.cooccurrence.getScore(e,t)>5&&s.push("Frequently played together"),this.tasteProfile){const i=this.embeddingEngine.getEmbedding(e);i&&this.tasteProfile.calculateTrackSimilarity(i.vector)>.7&&s.push("Matches your taste")}return s.length===0&&s.push("Similar sound"),s}getTrackMetadata(e){return this.trackMetadata.get(e)}getIndexSize(){return this.vectorIndex.size()}}let hp=null,P0=null,M0=null,L0=null,pI=null,wm=!1;const Uv=new Set;let yc=0;const wr=new Set,Gl=new Map;function Hce(){Uv.forEach(n=>n())}function qce(n){return Uv.add(n),()=>Uv.delete(n)}function F0(){return yc}function jp(n){n!==yc&&(yc=n,Hce())}function gs(){return wm||(hp=new Oce({dimensions:128}),P0=new zce({dimensions:128}),M0=new Uce,L0=new Wce("default-user",hp),pI=new Gce(hp,P0,M0,L0),wm=!0),{embeddingEngine:hp,vectorIndex:P0,cooccurrence:M0,tasteProfile:L0,playlistGenerator:pI}}function Rp(n){var e,t,s,r,i,o,a;return{id:n.id,title:n.title,artist:(t=(e=n.artists)==null?void 0:e[0])==null?void 0:t.name,artistId:((r=(s=n.artists)==null?void 0:s[0])==null?void 0:r.id)||((a=(o=(i=n.artists)==null?void 0:i[0])==null?void 0:o.name)==null?void 0:a.toLowerCase().replace(/\s+/g,"-")),genres:n.genres||[],duration:n.duration,audioFeatures:n.audioFeatures?{energy:n.audioFeatures.energy,valence:n.audioFeatures.valence,danceability:n.audioFeatures.danceability,acousticness:n.audioFeatures.acousticness,instrumentalness:n.audioFeatures.instrumentalness,speechiness:n.audioFeatures.speechiness,liveness:n.audioFeatures.liveness,bpm:n.audioFeatures.tempo,loudness:n.audioFeatures.loudness}:void 0}}function YP(){const[n,e]=j.useState(!1),[t,s]=j.useState(F0);j.useEffect(()=>{gs(),e(!0),s(F0())},[]),j.useEffect(()=>qce(()=>{s(F0())}),[]);const r=j.useCallback(w=>{const{playlistGenerator:N}=gs();let C=0;for(const S of w)if(!wr.has(S.id)){const T=Rp(S);N.registerTrack(T),wr.add(S.id),Gl.set(S.id,S),C++}C>0&&jp(wr.size)},[]),i=j.useCallback((w,N,C)=>{var M,P;const{embeddingEngine:S,tasteProfile:T,playlistGenerator:A}=gs();if(!wr.has(w.id)){const R=Rp(w);A.registerTrack(R),wr.add(w.id),Gl.set(w.id,w),jp(wr.size)}const E=S.getEmbedding(w.id);E&&T.addListen(w.id,E.vector,N,w.duration||N*1.2,w.genres,(P=(M=w.artists)==null?void 0:M[0])==null?void 0:P.id)},[]),o=j.useCallback(w=>{var A,E;const{embeddingEngine:N,tasteProfile:C,playlistGenerator:S}=gs();if(!wr.has(w.id)){const M=Rp(w);S.registerTrack(M),wr.add(w.id),Gl.set(w.id,w),jp(wr.size)}const T=N.getEmbedding(w.id);T&&C.addLike(w.id,T.vector,w.genres,(E=(A=w.artists)==null?void 0:A[0])==null?void 0:E.id)},[]),a=j.useCallback(w=>{const{cooccurrence:N}=gs();N.recordCoOccurrence(w,"session")},[]),l=j.useCallback((w,N={})=>{if(!n||t<1)return null;const{playlistGenerator:C}=gs(),S=new Date;return C.generateMoodPlaylist(w,{limit:N.limit||20,explorationFactor:N.exploration||.2,includeCollaborative:N.includeCollaborative??!0,excludeTrackIds:N.excludeTrackIds,excludeArtistIds:N.excludeArtistIds,contextHour:S.getHours(),contextDayOfWeek:S.getDay()})},[n,t]),u=j.useCallback((w,N={})=>{if(!n||t<1)return null;const{playlistGenerator:C}=gs(),S=new Date;return C.generateGenrePlaylist(w,{limit:N.limit||20,explorationFactor:N.exploration||.2,includeCollaborative:N.includeCollaborative??!0,excludeTrackIds:N.excludeTrackIds,excludeArtistIds:N.excludeArtistIds,contextHour:S.getHours(),contextDayOfWeek:S.getDay()})},[n,t]),d=j.useCallback((w,N={})=>{if(!n||t<1)return null;const{playlistGenerator:C}=gs();return C.generateSeedPlaylist(w,{limit:N.limit||20,explorationFactor:N.exploration||.2,includeCollaborative:N.includeCollaborative??!0,excludeTrackIds:N.excludeTrackIds,excludeArtistIds:N.excludeArtistIds})},[n,t]),f=j.useCallback((w={})=>{if(!n||t<1)return null;const{playlistGenerator:N}=gs(),C=new Date;return N.generatePersonalizedPlaylist({limit:w.limit||20,explorationFactor:w.exploration||.2,includeCollaborative:w.includeCollaborative??!0,excludeTrackIds:w.excludeTrackIds,excludeArtistIds:w.excludeArtistIds,contextHour:C.getHours(),contextDayOfWeek:C.getDay()})},[n,t]),p=j.useCallback((w,N={})=>{if(!n||t<1)return null;const{playlistGenerator:C}=gs();return C.generateArtistRadio(w,{limit:N.limit||20,explorationFactor:N.exploration||.2,includeCollaborative:N.includeCollaborative??!0,excludeTrackIds:N.excludeTrackIds,excludeArtistIds:N.excludeArtistIds})},[n,t]),g=j.useCallback((w={})=>{if(!n||t<1)return null;const{playlistGenerator:N}=gs();return N.generateDiscoveryPlaylist({limit:w.limit||20,explorationFactor:w.exploration||.7,includeCollaborative:w.includeCollaborative??!0,excludeTrackIds:w.excludeTrackIds,excludeArtistIds:w.excludeArtistIds})},[n,t]),x=j.useCallback((w,N=20)=>{if(!n)return[];const{playlistGenerator:C}=gs();return C.findSimilarTracks(w,N)},[n]),y=j.useCallback(w=>w?w.tracks.map(N=>{const C=Gl.get(N.trackId);if(C)return{...C,streamInfo:void 0,streamSources:[]}}).filter(N=>N!==void 0):[],[]),b=j.useCallback(()=>{const{tasteProfile:w}=gs(),N=w.getProfile();return N?{isValid:!0,interactionCount:N.stats.tracksContributed,topGenres:w.getTopGenres(5),topArtists:w.getTopArtists(5),totalListenTime:N.stats.totalListenTime}:{isValid:!1,interactionCount:w.getInteractionCount(),topGenres:[],topArtists:[]}},[]),k=j.useCallback(()=>{const{vectorIndex:w,cooccurrence:N}=gs();return{tracksIndexed:w.size(),cooccurrencePairs:N.size()}},[]);return{isReady:n,tracksIndexed:t,indexTracks:r,recordPlay:i,recordLike:o,recordSession:a,generateMoodPlaylist:l,generateGenrePlaylist:u,generateSeedPlaylist:d,generatePersonalizedPlaylist:f,generateArtistRadio:p,generateDiscoveryPlaylist:g,findSimilarTracks:x,getTracksFromPlaylist:y,getTasteStats:b,getIndexStats:k}}function mI(){return yc}function Kce(){return wm&&yc>0}function Qce(n){const{playlistGenerator:e}=gs();let t=0;for(const s of n)if(!wr.has(s.id)){const r=Rp(s);e.registerTrack(r),wr.add(s.id),Gl.set(s.id,s),t++}return t>0&&jp(wr.size),t}function Xce(n,e={}){var o;if(!wm||yc<1)return[];const{playlistGenerator:t}=gs(),s=new Date,r={limit:e.limit||20,explorationFactor:e.exploration||.2,includeCollaborative:!0,excludeTrackIds:e.excludeTrackIds,contextHour:s.getHours(),contextDayOfWeek:s.getDay()};let i=null;switch(n){case"personalized":i=t.generatePersonalizedPlaylist(r);break;case"mood":e.mood&&(i=t.generateMoodPlaylist(e.mood,r));break;case"genre":e.genre&&(i=t.generateGenrePlaylist(e.genre,r));break;case"artist-radio":e.artistId&&(i=t.generateArtistRadio(e.artistId,r));break;case"discovery":i=t.generateDiscoveryPlaylist({...r,explorationFactor:e.exploration||.7});break;case"similar":(o=e.seedTrackIds)!=null&&o.length&&(i=t.generateSeedPlaylist(e.seedTrackIds,r));break}return i?i.tracks.map(a=>{const l=Gl.get(a.trackId);if(l)return{...l,streamInfo:void 0,streamSources:[]}}).filter(a=>a!==void 0):[]}function Yce(n){var e,t,s,r,i;return n?JSON.stringify({strategy:n.strategy,sectionType:n.sectionType,title:n.title,search:(e=n.search)==null?void 0:e.query,limit:n.limit,embeddingMethod:(t=n.embedding)==null?void 0:t.method,embeddingGenre:(s=n.embedding)==null?void 0:s.genre,embeddingMood:(r=n.embedding)==null?void 0:r.mood,embeddingSeedArtist:(i=n.embedding)==null?void 0:i.seedArtistId}):"null"}function Vt(n,e={}){const{enabled:t=!0,applyMLRanking:s=!0,applyTransformers:r=!0,limit:i=50,fallbackFetcher:o,deps:a=[]}=e,[l,u]=j.useState([]),[d,f]=j.useState(!0),[p,g]=j.useState(null),[x,y]=j.useState(null),b=dn,{rankTracks:k}=XP(),w=j.useMemo(()=>Yce(n),[n]),N=j.useRef(n);N.current=n;const C=j.useRef(!0),S=j.useRef(0);j.useEffect(()=>(C.current=!0,()=>{C.current=!1}),[]);const T=j.useCallback(async()=>{var _;const E=N.current;if(!t||!E){u([]),f(!1);return}const M=++S.current;f(!0),g(null);const P=new Date,R=b.getState().userProfile,L={query:E,userProfile:R,hour:P.getHours(),dayOfWeek:P.getDay()};try{console.log(`[usePluginData] Fetching for ${E.sectionType}...`);const O=await Oa.executePipeline([],E,L);if(!C.current||M!==S.current)return;let U=O.tracks;if(console.log(`[usePluginData] Pipeline returned ${U.length} tracks from providers: [${O.contributingProviders.join(", ")}]`),U.length===0&&o&&(console.log("[usePluginData] No pipeline results, trying fallback..."),U=await o(),!C.current||M!==S.current))return;if(U.length>0){const W=Qce(U);W>0&&console.log(`[usePluginData] Auto-indexed ${W} new tracks into embedding system`)}if(s&&U.length>0){console.log(`[usePluginData] Applying ML ranking to ${U.length} tracks...`);try{U=(await k(U,{enabled:!0,explorationMode:(_=E.embedding)!=null&&_.exploration&&E.embedding.exploration>.5?"explore":"balanced",limit:i*2,shuffle:!0,shuffleIntensity:.1})).map(H=>H.track)}catch(W){console.warn("[usePluginData] ML ranking failed, using unranked results:",W)}}if(r&&O.appliedTransformers.length===0&&U.length>0){const W=await Oa.runTransformers(U,{...L,currentResults:U});U=W.tracks,O.appliedTransformers.push(...W.appliedTransformers)}if(U=U.slice(0,i),!C.current||M!==S.current)return;console.log(`[usePluginData] Final result: ${U.length} tracks`),u(U),y(O),g(null)}catch(O){console.error("[usePluginData] Fetch error:",O),C.current&&M===S.current&&(g(O instanceof Error?O:new Error(String(O))),u([]))}finally{C.current&&M===S.current&&f(!1)}},[w,t,s,r,i,o,k]);j.useEffect(()=>{T()},[T,...a]);const A=j.useCallback(async()=>{await T()},[T]);return{tracks:l,isLoading:d,error:p,refetch:A,metadata:x}}function Lh(n,e,t){t!==void 0?console.error(`${n} ${e}`,t):console.error(`${n} ${e}`)}const Fs=({id:n,title:e,subtitle:t,isPersonalized:s,whyExplanation:r,children:i,isLoading:o,error:a,className:l="",showHeader:u=!0,animationDelay:d=0,showWhyExplanation:f=!0,onSeeAll:p})=>a?null:c.jsxs("section",{id:n,className:`discover-section ${s?"personalized":""} ${l}`,style:{animationDelay:`${d}ms`},children:[u&&c.jsxs("div",{className:"discover-section-header",children:[c.jsxs("div",{className:"discover-section-title-row",children:[c.jsx("h2",{className:"discover-section-title",children:e}),t&&c.jsx("span",{className:"discover-section-subtitle",children:t})]}),c.jsxs("div",{className:"discover-section-actions",children:[f&&r&&c.jsx("span",{className:"discover-section-why",title:r,children:r}),p&&c.jsx("button",{className:"discover-section-more",onClick:p,children:"See all"})]})]}),o?c.jsx("div",{className:"discover-section-loading",children:c.jsx("div",{className:"discover-loading-cards",children:[1,2,3,4].map(g=>c.jsx("div",{className:"track-card skeleton",style:{animationDelay:`${g*100}ms`}},g))})}):i]});function rk(n,e={}){const{limit:t=12,embedding:s}=e,r=j.useMemo(()=>{let l="personalized",u,d;if(s)switch(s.type){case"mood":l="mood",u=s.id;break;case"genre":l="genre",d=s.id;break;case"discovery":l="discovery";break;case"personalized":default:l="personalized";break}return{strategy:"plugin",sectionType:"generic",title:"Section",embedding:{method:l,mood:u,genre:d,exploration:(s==null?void 0:s.exploration)??.2},limit:t}},[s,t]),{tracks:i,isLoading:o}=Vt(r,{enabled:!!s,applyMLRanking:!0,applyTransformers:!0,limit:t}),a=i.length>0?"embedding":"none";return{tracks:i,isLoading:o,error:null,source:a}}function io(n){return Array.isArray?Array.isArray(n):eM(n)==="[object Array]"}function Zce(n){if(typeof n=="string")return n;let e=n+"";return e=="0"&&1/n==-1/0?"-0":e}function Jce(n){return n==null?"":Zce(n)}function bi(n){return typeof n=="string"}function ZP(n){return typeof n=="number"}function eue(n){return n===!0||n===!1||tue(n)&&eM(n)=="[object Boolean]"}function JP(n){return typeof n=="object"}function tue(n){return JP(n)&&n!==null}function nr(n){return n!=null}function O0(n){return!n.trim().length}function eM(n){return n==null?n===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(n)}const nue="Incorrect 'index' type",sue=n=>`Invalid value for key ${n}`,rue=n=>`Pattern length exceeds max of ${n}.`,iue=n=>`Missing ${n} property in key`,oue=n=>`Property 'weight' in key '${n}' must be a positive integer`,gI=Object.prototype.hasOwnProperty;class aue{constructor(e){this._keys=[],this._keyMap={};let t=0;e.forEach(s=>{let r=tM(s);this._keys.push(r),this._keyMap[r.id]=r,t+=r.weight}),this._keys.forEach(s=>{s.weight/=t})}get(e){return this._keyMap[e]}keys(){return this._keys}toJSON(){return JSON.stringify(this._keys)}}function tM(n){let e=null,t=null,s=null,r=1,i=null;if(bi(n)||io(n))s=n,e=xI(n),t=Gv(n);else{if(!gI.call(n,"name"))throw new Error(iue("name"));const o=n.name;if(s=o,gI.call(n,"weight")&&(r=n.weight,r<=0))throw new Error(oue(o));e=xI(o),t=Gv(o),i=n.getFn}return{path:e,id:t,weight:r,src:s,getFn:i}}function xI(n){return io(n)?n:n.split(".")}function Gv(n){return io(n)?n.join("."):n}function lue(n,e){let t=[],s=!1;const r=(i,o,a)=>{if(nr(i))if(!o[a])t.push(i);else{let l=o[a];const u=i[l];if(!nr(u))return;if(a===o.length-1&&(bi(u)||ZP(u)||eue(u)))t.push(Jce(u));else if(io(u)){s=!0;for(let d=0,f=u.length;d<f;d+=1)r(u[d],o,a+1)}else o.length&&r(u,o,a+1)}};return r(n,bi(e)?e.split("."):e,0),s?t:t[0]}const cue={includeMatches:!1,findAllMatches:!1,minMatchCharLength:1},uue={isCaseSensitive:!1,ignoreDiacritics:!1,includeScore:!1,keys:[],shouldSort:!0,sortFn:(n,e)=>n.score===e.score?n.idx<e.idx?-1:1:n.score<e.score?-1:1},due={location:0,threshold:.6,distance:100},hue={useExtendedSearch:!1,getFn:lue,ignoreLocation:!1,ignoreFieldNorm:!1,fieldNormWeight:1};var st={...uue,...cue,...due,...hue};const fue=/[^ ]+/g;function pue(n=1,e=3){const t=new Map,s=Math.pow(10,e);return{get(r){const i=r.match(fue).length;if(t.has(i))return t.get(i);const o=1/Math.pow(i,.5*n),a=parseFloat(Math.round(o*s)/s);return t.set(i,a),a},clear(){t.clear()}}}class ik{constructor({getFn:e=st.getFn,fieldNormWeight:t=st.fieldNormWeight}={}){this.norm=pue(t,3),this.getFn=e,this.isCreated=!1,this.setIndexRecords()}setSources(e=[]){this.docs=e}setIndexRecords(e=[]){this.records=e}setKeys(e=[]){this.keys=e,this._keysMap={},e.forEach((t,s)=>{this._keysMap[t.id]=s})}create(){this.isCreated||!this.docs.length||(this.isCreated=!0,bi(this.docs[0])?this.docs.forEach((e,t)=>{this._addString(e,t)}):this.docs.forEach((e,t)=>{this._addObject(e,t)}),this.norm.clear())}add(e){const t=this.size();bi(e)?this._addString(e,t):this._addObject(e,t)}removeAt(e){this.records.splice(e,1);for(let t=e,s=this.size();t<s;t+=1)this.records[t].i-=1}getValueForItemAtKeyId(e,t){return e[this._keysMap[t]]}size(){return this.records.length}_addString(e,t){if(!nr(e)||O0(e))return;let s={v:e,i:t,n:this.norm.get(e)};this.records.push(s)}_addObject(e,t){let s={i:t,$:{}};this.keys.forEach((r,i)=>{let o=r.getFn?r.getFn(e):this.getFn(e,r.path);if(nr(o)){if(io(o)){let a=[];const l=[{nestedArrIndex:-1,value:o}];for(;l.length;){const{nestedArrIndex:u,value:d}=l.pop();if(nr(d))if(bi(d)&&!O0(d)){let f={v:d,i:u,n:this.norm.get(d)};a.push(f)}else io(d)&&d.forEach((f,p)=>{l.push({nestedArrIndex:p,value:f})})}s.$[i]=a}else if(bi(o)&&!O0(o)){let a={v:o,n:this.norm.get(o)};s.$[i]=a}}}),this.records.push(s)}toJSON(){return{keys:this.keys,records:this.records}}}function nM(n,e,{getFn:t=st.getFn,fieldNormWeight:s=st.fieldNormWeight}={}){const r=new ik({getFn:t,fieldNormWeight:s});return r.setKeys(n.map(tM)),r.setSources(e),r.create(),r}function mue(n,{getFn:e=st.getFn,fieldNormWeight:t=st.fieldNormWeight}={}){const{keys:s,records:r}=n,i=new ik({getFn:e,fieldNormWeight:t});return i.setKeys(s),i.setIndexRecords(r),i}function fp(n,{errors:e=0,currentLocation:t=0,expectedLocation:s=0,distance:r=st.distance,ignoreLocation:i=st.ignoreLocation}={}){const o=e/n.length;if(i)return o;const a=Math.abs(s-t);return r?o+a/r:a?1:o}function gue(n=[],e=st.minMatchCharLength){let t=[],s=-1,r=-1,i=0;for(let o=n.length;i<o;i+=1){let a=n[i];a&&s===-1?s=i:!a&&s!==-1&&(r=i-1,r-s+1>=e&&t.push([s,r]),s=-1)}return n[i-1]&&i-s>=e&&t.push([s,i-1]),t}const Aa=32;function xue(n,e,t,{location:s=st.location,distance:r=st.distance,threshold:i=st.threshold,findAllMatches:o=st.findAllMatches,minMatchCharLength:a=st.minMatchCharLength,includeMatches:l=st.includeMatches,ignoreLocation:u=st.ignoreLocation}={}){if(e.length>Aa)throw new Error(rue(Aa));const d=e.length,f=n.length,p=Math.max(0,Math.min(s,f));let g=i,x=p;const y=a>1||l,b=y?Array(f):[];let k;for(;(k=n.indexOf(e,x))>-1;){let A=fp(e,{currentLocation:k,expectedLocation:p,distance:r,ignoreLocation:u});if(g=Math.min(A,g),x=k+d,y){let E=0;for(;E<d;)b[k+E]=1,E+=1}}x=-1;let w=[],N=1,C=d+f;const S=1<<d-1;for(let A=0;A<d;A+=1){let E=0,M=C;for(;E<M;)fp(e,{errors:A,currentLocation:p+M,expectedLocation:p,distance:r,ignoreLocation:u})<=g?E=M:C=M,M=Math.floor((C-E)/2+E);C=M;let P=Math.max(1,p-M+1),R=o?f:Math.min(p+M,f)+d,L=Array(R+2);L[R+1]=(1<<A)-1;for(let O=R;O>=P;O-=1){let U=O-1,W=t[n.charAt(U)];if(y&&(b[U]=+!!W),L[O]=(L[O+1]<<1|1)&W,A&&(L[O]|=(w[O+1]|w[O])<<1|1|w[O+1]),L[O]&S&&(N=fp(e,{errors:A,currentLocation:U,expectedLocation:p,distance:r,ignoreLocation:u}),N<=g)){if(g=N,x=U,x<=p)break;P=Math.max(1,2*p-x)}}if(fp(e,{errors:A+1,currentLocation:p,expectedLocation:p,distance:r,ignoreLocation:u})>g)break;w=L}const T={isMatch:x>=0,score:Math.max(.001,N)};if(y){const A=gue(b,a);A.length?l&&(T.indices=A):T.isMatch=!1}return T}function yue(n){let e={};for(let t=0,s=n.length;t<s;t+=1){const r=n.charAt(t);e[r]=(e[r]||0)|1<<s-t-1}return e}const km=String.prototype.normalize?(n=>n.normalize("NFD").replace(/[\u0300-\u036F\u0483-\u0489\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u0711\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A70\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B62\u0B63\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0C00-\u0C04\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D82\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0EB1\u0EB4-\u0EB9\u0EBB\u0EBC\u0EC8-\u0ECD\u0F18\u0F19\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F\u109A-\u109D\u135D-\u135F\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u180B-\u180D\u1885\u1886\u18A9\u1920-\u192B\u1930-\u193B\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F\u1AB0-\u1ABE\u1B00-\u1B04\u1B34-\u1B44\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BE6-\u1BF3\u1C24-\u1C37\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF2-\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u20D0-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA66F-\uA672\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA880\uA881\uA8B4-\uA8C5\uA8E0-\uA8F1\uA8FF\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9E5\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F]/g,"")):(n=>n);class sM{constructor(e,{location:t=st.location,threshold:s=st.threshold,distance:r=st.distance,includeMatches:i=st.includeMatches,findAllMatches:o=st.findAllMatches,minMatchCharLength:a=st.minMatchCharLength,isCaseSensitive:l=st.isCaseSensitive,ignoreDiacritics:u=st.ignoreDiacritics,ignoreLocation:d=st.ignoreLocation}={}){if(this.options={location:t,threshold:s,distance:r,includeMatches:i,findAllMatches:o,minMatchCharLength:a,isCaseSensitive:l,ignoreDiacritics:u,ignoreLocation:d},e=l?e:e.toLowerCase(),e=u?km(e):e,this.pattern=e,this.chunks=[],!this.pattern.length)return;const f=(g,x)=>{this.chunks.push({pattern:g,alphabet:yue(g),startIndex:x})},p=this.pattern.length;if(p>Aa){let g=0;const x=p%Aa,y=p-x;for(;g<y;)f(this.pattern.substr(g,Aa),g),g+=Aa;if(x){const b=p-Aa;f(this.pattern.substr(b),b)}}else f(this.pattern,0)}searchIn(e){const{isCaseSensitive:t,ignoreDiacritics:s,includeMatches:r}=this.options;if(e=t?e:e.toLowerCase(),e=s?km(e):e,this.pattern===e){let y={isMatch:!0,score:0};return r&&(y.indices=[[0,e.length-1]]),y}const{location:i,distance:o,threshold:a,findAllMatches:l,minMatchCharLength:u,ignoreLocation:d}=this.options;let f=[],p=0,g=!1;this.chunks.forEach(({pattern:y,alphabet:b,startIndex:k})=>{const{isMatch:w,score:N,indices:C}=xue(e,y,b,{location:i+k,distance:o,threshold:a,findAllMatches:l,minMatchCharLength:u,includeMatches:r,ignoreLocation:d});w&&(g=!0),p+=N,w&&C&&(f=[...f,...C])});let x={isMatch:g,score:g?p/this.chunks.length:1};return g&&r&&(x.indices=f),x}}class aa{constructor(e){this.pattern=e}static isMultiMatch(e){return yI(e,this.multiRegex)}static isSingleMatch(e){return yI(e,this.singleRegex)}search(){}}function yI(n,e){const t=n.match(e);return t?t[1]:null}class vue extends aa{constructor(e){super(e)}static get type(){return"exact"}static get multiRegex(){return/^="(.*)"$/}static get singleRegex(){return/^=(.*)$/}search(e){const t=e===this.pattern;return{isMatch:t,score:t?0:1,indices:[0,this.pattern.length-1]}}}class bue extends aa{constructor(e){super(e)}static get type(){return"inverse-exact"}static get multiRegex(){return/^!"(.*)"$/}static get singleRegex(){return/^!(.*)$/}search(e){const s=e.indexOf(this.pattern)===-1;return{isMatch:s,score:s?0:1,indices:[0,e.length-1]}}}class wue extends aa{constructor(e){super(e)}static get type(){return"prefix-exact"}static get multiRegex(){return/^\^"(.*)"$/}static get singleRegex(){return/^\^(.*)$/}search(e){const t=e.startsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[0,this.pattern.length-1]}}}class kue extends aa{constructor(e){super(e)}static get type(){return"inverse-prefix-exact"}static get multiRegex(){return/^!\^"(.*)"$/}static get singleRegex(){return/^!\^(.*)$/}search(e){const t=!e.startsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[0,e.length-1]}}}class Cue extends aa{constructor(e){super(e)}static get type(){return"suffix-exact"}static get multiRegex(){return/^"(.*)"\$$/}static get singleRegex(){return/^(.*)\$$/}search(e){const t=e.endsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[e.length-this.pattern.length,e.length-1]}}}class Sue extends aa{constructor(e){super(e)}static get type(){return"inverse-suffix-exact"}static get multiRegex(){return/^!"(.*)"\$$/}static get singleRegex(){return/^!(.*)\$$/}search(e){const t=!e.endsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[0,e.length-1]}}}class rM extends aa{constructor(e,{location:t=st.location,threshold:s=st.threshold,distance:r=st.distance,includeMatches:i=st.includeMatches,findAllMatches:o=st.findAllMatches,minMatchCharLength:a=st.minMatchCharLength,isCaseSensitive:l=st.isCaseSensitive,ignoreDiacritics:u=st.ignoreDiacritics,ignoreLocation:d=st.ignoreLocation}={}){super(e),this._bitapSearch=new sM(e,{location:t,threshold:s,distance:r,includeMatches:i,findAllMatches:o,minMatchCharLength:a,isCaseSensitive:l,ignoreDiacritics:u,ignoreLocation:d})}static get type(){return"fuzzy"}static get multiRegex(){return/^"(.*)"$/}static get singleRegex(){return/^(.*)$/}search(e){return this._bitapSearch.searchIn(e)}}class iM extends aa{constructor(e){super(e)}static get type(){return"include"}static get multiRegex(){return/^'"(.*)"$/}static get singleRegex(){return/^'(.*)$/}search(e){let t=0,s;const r=[],i=this.pattern.length;for(;(s=e.indexOf(this.pattern,t))>-1;)t=s+i,r.push([s,t-1]);const o=!!r.length;return{isMatch:o,score:o?0:1,indices:r}}}const Hv=[vue,iM,wue,kue,Sue,Cue,bue,rM],vI=Hv.length,Nue=/ +(?=(?:[^\"]*\"[^\"]*\")*[^\"]*$)/,Iue="|";function Tue(n,e={}){return n.split(Iue).map(t=>{let s=t.trim().split(Nue).filter(i=>i&&!!i.trim()),r=[];for(let i=0,o=s.length;i<o;i+=1){const a=s[i];let l=!1,u=-1;for(;!l&&++u<vI;){const d=Hv[u];let f=d.isMultiMatch(a);f&&(r.push(new d(f,e)),l=!0)}if(!l)for(u=-1;++u<vI;){const d=Hv[u];let f=d.isSingleMatch(a);if(f){r.push(new d(f,e));break}}}return r})}const $ue=new Set([rM.type,iM.type]);class Eue{constructor(e,{isCaseSensitive:t=st.isCaseSensitive,ignoreDiacritics:s=st.ignoreDiacritics,includeMatches:r=st.includeMatches,minMatchCharLength:i=st.minMatchCharLength,ignoreLocation:o=st.ignoreLocation,findAllMatches:a=st.findAllMatches,location:l=st.location,threshold:u=st.threshold,distance:d=st.distance}={}){this.query=null,this.options={isCaseSensitive:t,ignoreDiacritics:s,includeMatches:r,minMatchCharLength:i,findAllMatches:a,ignoreLocation:o,location:l,threshold:u,distance:d},e=t?e:e.toLowerCase(),e=s?km(e):e,this.pattern=e,this.query=Tue(this.pattern,this.options)}static condition(e,t){return t.useExtendedSearch}searchIn(e){const t=this.query;if(!t)return{isMatch:!1,score:1};const{includeMatches:s,isCaseSensitive:r,ignoreDiacritics:i}=this.options;e=r?e:e.toLowerCase(),e=i?km(e):e;let o=0,a=[],l=0;for(let u=0,d=t.length;u<d;u+=1){const f=t[u];a.length=0,o=0;for(let p=0,g=f.length;p<g;p+=1){const x=f[p],{isMatch:y,indices:b,score:k}=x.search(e);if(y){if(o+=1,l+=k,s){const w=x.constructor.type;$ue.has(w)?a=[...a,...b]:a.push(b)}}else{l=0,o=0,a.length=0;break}}if(o){let p={isMatch:!0,score:l/o};return s&&(p.indices=a),p}}return{isMatch:!1,score:1}}}const qv=[];function Aue(...n){qv.push(...n)}function Kv(n,e){for(let t=0,s=qv.length;t<s;t+=1){let r=qv[t];if(r.condition(n,e))return new r(n,e)}return new sM(n,e)}const Cm={AND:"$and",OR:"$or"},Qv={PATH:"$path",PATTERN:"$val"},Xv=n=>!!(n[Cm.AND]||n[Cm.OR]),jue=n=>!!n[Qv.PATH],Rue=n=>!io(n)&&JP(n)&&!Xv(n),bI=n=>({[Cm.AND]:Object.keys(n).map(e=>({[e]:n[e]}))});function oM(n,e,{auto:t=!0}={}){const s=r=>{let i=Object.keys(r);const o=jue(r);if(!o&&i.length>1&&!Xv(r))return s(bI(r));if(Rue(r)){const l=o?r[Qv.PATH]:i[0],u=o?r[Qv.PATTERN]:r[l];if(!bi(u))throw new Error(sue(l));const d={keyId:Gv(l),pattern:u};return t&&(d.searcher=Kv(u,e)),d}let a={children:[],operator:i[0]};return i.forEach(l=>{const u=r[l];io(u)&&u.forEach(d=>{a.children.push(s(d))})}),a};return Xv(n)||(n=bI(n)),s(n)}function Due(n,{ignoreFieldNorm:e=st.ignoreFieldNorm}){n.forEach(t=>{let s=1;t.matches.forEach(({key:r,norm:i,score:o})=>{const a=r?r.weight:null;s*=Math.pow(o===0&&a?Number.EPSILON:o,(a||1)*(e?1:i))}),t.score=s})}function Pue(n,e){const t=n.matches;e.matches=[],nr(t)&&t.forEach(s=>{if(!nr(s.indices)||!s.indices.length)return;const{indices:r,value:i}=s;let o={indices:r,value:i};s.key&&(o.key=s.key.src),s.idx>-1&&(o.refIndex=s.idx),e.matches.push(o)})}function Mue(n,e){e.score=n.score}function Lue(n,e,{includeMatches:t=st.includeMatches,includeScore:s=st.includeScore}={}){const r=[];return t&&r.push(Pue),s&&r.push(Mue),n.map(i=>{const{idx:o}=i,a={item:e[o],refIndex:o};return r.length&&r.forEach(l=>{l(i,a)}),a})}class Vo{constructor(e,t={},s){this.options={...st,...t},this.options.useExtendedSearch,this._keyStore=new aue(this.options.keys),this.setCollection(e,s)}setCollection(e,t){if(this._docs=e,t&&!(t instanceof ik))throw new Error(nue);this._myIndex=t||nM(this.options.keys,this._docs,{getFn:this.options.getFn,fieldNormWeight:this.options.fieldNormWeight})}add(e){nr(e)&&(this._docs.push(e),this._myIndex.add(e))}remove(e=()=>!1){const t=[];for(let s=0,r=this._docs.length;s<r;s+=1){const i=this._docs[s];e(i,s)&&(this.removeAt(s),s-=1,r-=1,t.push(i))}return t}removeAt(e){this._docs.splice(e,1),this._myIndex.removeAt(e)}getIndex(){return this._myIndex}search(e,{limit:t=-1}={}){const{includeMatches:s,includeScore:r,shouldSort:i,sortFn:o,ignoreFieldNorm:a}=this.options;let l=bi(e)?bi(this._docs[0])?this._searchStringList(e):this._searchObjectList(e):this._searchLogical(e);return Due(l,{ignoreFieldNorm:a}),i&&l.sort(o),ZP(t)&&t>-1&&(l=l.slice(0,t)),Lue(l,this._docs,{includeMatches:s,includeScore:r})}_searchStringList(e){const t=Kv(e,this.options),{records:s}=this._myIndex,r=[];return s.forEach(({v:i,i:o,n:a})=>{if(!nr(i))return;const{isMatch:l,score:u,indices:d}=t.searchIn(i);l&&r.push({item:i,idx:o,matches:[{score:u,value:i,norm:a,indices:d}]})}),r}_searchLogical(e){const t=oM(e,this.options),s=(a,l,u)=>{if(!a.children){const{keyId:f,searcher:p}=a,g=this._findMatches({key:this._keyStore.get(f),value:this._myIndex.getValueForItemAtKeyId(l,f),searcher:p});return g&&g.length?[{idx:u,item:l,matches:g}]:[]}const d=[];for(let f=0,p=a.children.length;f<p;f+=1){const g=a.children[f],x=s(g,l,u);if(x.length)d.push(...x);else if(a.operator===Cm.AND)return[]}return d},r=this._myIndex.records,i={},o=[];return r.forEach(({$:a,i:l})=>{if(nr(a)){let u=s(t,a,l);u.length&&(i[l]||(i[l]={idx:l,item:a,matches:[]},o.push(i[l])),u.forEach(({matches:d})=>{i[l].matches.push(...d)}))}}),o}_searchObjectList(e){const t=Kv(e,this.options),{keys:s,records:r}=this._myIndex,i=[];return r.forEach(({$:o,i:a})=>{if(!nr(o))return;let l=[];s.forEach((u,d)=>{l.push(...this._findMatches({key:u,value:o[d],searcher:t}))}),l.length&&i.push({idx:a,item:o,matches:l})}),i}_findMatches({key:e,value:t,searcher:s}){if(!nr(t))return[];let r=[];if(io(t))t.forEach(({v:i,i:o,n:a})=>{if(!nr(i))return;const{isMatch:l,score:u,indices:d}=s.searchIn(i);l&&r.push({score:u,key:e,value:i,idx:o,norm:a,indices:d})});else{const{v:i,n:o}=t,{isMatch:a,score:l,indices:u}=s.searchIn(i);a&&r.push({score:l,key:e,value:i,norm:o,indices:u})}return r}}Vo.version="7.1.0";Vo.createIndex=nM;Vo.parseIndex=mue;Vo.config=st;Vo.parseQuery=oM;Aue(Eue);const Gr={byArtist:/\bby\s+([^,]+?)(?=\s+from\s+|\s+genre:|\s+\d{4}\b|$)/i,fromAlbum:/\bfrom\s+([^,]+?)(?=\s+by\s+|\s+genre:|\s+\d{4}\b|$)/i,genre:/(?:genre:\s*|in\s+)([\w\s-]+?)(?=\s+by\s+|\s+from\s+|\s+\d{4}\b|$)/i,year:/(?:year:\s*|\bfrom\s+)?(\d{4})\b/i,liked:/\b(liked|favorites?|my\s+favorites?|loved)\b/i,playlist:/\bplaylist:\s*([^\s]+)/i};function Yv(n){if(!(n!=null&&n.trim()))return{text:"",filters:[],original:""};const e=n,t=[];let s=n.trim();s.match(Gr.liked)&&(t.push({type:"liked",value:"true",label:"Liked"}),s=s.replace(Gr.liked,"").trim());const i=s.match(Gr.year);if(i){const d=i[1],f=parseInt(d,10);f>=1900&&f<=new Date().getFullYear()+1&&(t.push({type:"year",value:d,label:d}),s=s.replace(/year:\s*\d{4}/i,"").trim())}const o=s.match(Gr.genre);if(o){const d=o[1].trim();d&&(t.push({type:"genre",value:d.toLowerCase(),label:Fue(d)}),s=s.replace(Gr.genre,"").trim())}const a=s.match(Gr.fromAlbum);if(a){const d=a[1].trim();d&&(t.push({type:"album",value:d,label:`Album: ${d}`}),s=s.replace(Gr.fromAlbum,"").trim())}const l=s.match(Gr.byArtist);if(l){const d=l[1].trim();d&&(t.push({type:"artist",value:d,label:`By: ${d}`}),s=s.replace(Gr.byArtist,"").trim())}const u=s.match(Gr.playlist);if(u){const d=u[1].trim();d&&(t.push({type:"playlist",value:d,label:`Playlist: ${d}`}),s=s.replace(Gr.playlist,"").trim())}return s=s.replace(/\s+/g," ").replace(/^[\s,]+|[\s,]+$/g,"").trim(),{text:s,filters:t,original:e}}function Fue(n){return n.toLowerCase().split(" ").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ")}const _0={keys:[{name:"title",weight:.35},{name:"artists.name",weight:.3},{name:"album.title",weight:.2},{name:"genre",weight:.1},{name:"album.releaseDate",weight:.05}],threshold:.4,distance:100,minMatchCharLength:2,ignoreLocation:!0,useExtendedSearch:!0,includeScore:!0,includeMatches:!0};class aM{constructor(e=[]){Mt(this,"fuse");Mt(this,"tracks");this.tracks=e,this.fuse=new Vo(e,_0)}updateIndex(e){this.tracks=e,this.fuse=new Vo(e,_0)}addTracks(e){for(const t of e)this.tracks.some(s=>s.id===t.id)||this.tracks.push(t);this.fuse=new Vo(this.tracks,_0)}search(e,t={}){const{limit:s=50,threshold:r=.3,includeScore:i=!0,includeMatches:o=!1}=t;if(!(e!=null&&e.trim()))return[];const a=Yv(e);if(!a.text&&a.filters.length>0)return this.filterOnly(a.filters,s);let u=this.fuse.search(a.text,{limit:s*2}).filter(d=>1-(d.score||0)>=r).map(d=>({track:d.item,score:1-(d.score||0),matches:o?this.extractMatches(d.matches||[]):[]}));return a.filters.length>0&&(u=this.applyFilters(u,a.filters)),u.slice(0,s)}quickSearch(e,t=20){return this.search(e,{limit:t,includeMatches:!1}).map(r=>r.track)}searchWithParsed(e,t={}){const{limit:s=50,threshold:r=.3,includeMatches:i=!1}=t;if(!e.text)return this.filterOnly(e.filters,s);let a=this.fuse.search(e.text,{limit:s*2}).filter(l=>1-(l.score||0)>=r).map(l=>({track:l.item,score:1-(l.score||0),matches:i?this.extractMatches(l.matches||[]):[]}));return e.filters.length>0&&(a=this.applyFilters(a,e.filters)),a.slice(0,s)}getSuggestions(e,t=5){var i;if(!e||e.length<2)return[];const s=this.fuse.search(e,{limit:t*3}),r=new Set;for(const o of s){const a=o.item;a.title.toLowerCase().includes(e.toLowerCase())&&r.add(a.title);for(const l of a.artists)l.name.toLowerCase().includes(e.toLowerCase())&&r.add(l.name);if((i=a.album)!=null&&i.title&&a.album.title.toLowerCase().includes(e.toLowerCase())&&r.add(a.album.title),r.size>=t)break}return Array.from(r).slice(0,t)}filterOnly(e,t){let s=[...this.tracks];for(const r of e)s=this.applyFilter(s,r);return s.slice(0,t).map(r=>({track:r,score:1,matches:[]}))}applyFilters(e,t){return e.filter(s=>{for(const r of t)if(!this.matchesFilter(s.track,r))return!1;return!0})}applyFilter(e,t){return e.filter(s=>this.matchesFilter(s,t))}matchesFilter(e,t){var r,i,o,a,l;const s=t.value.toLowerCase();switch(t.type){case"artist":return e.artists.some(d=>d.name.toLowerCase().includes(s));case"album":return((i=(r=e.album)==null?void 0:r.title)==null?void 0:i.toLowerCase().includes(s))??!1;case"genre":return((o=e.genre)==null?void 0:o.toLowerCase().includes(s))??!1;case"year":return((l=(a=e.album)==null?void 0:a.releaseDate)==null?void 0:l.substring(0,4))===s;case"liked":return!0;case"playlist":return!0;default:return!0}}extractMatches(e){return e.map(t=>({field:t.key||"",value:t.value||"",indices:t.indices}))}getStats(){return{trackCount:this.tracks.length}}}const Fl=new aM,la=An((n,e)=>({query:"",results:{tracks:[],artists:[],albums:[],localTracks:[]},isSearching:!1,error:null,activeFilter:"all",parsedQuery:null,smartSearch:Fl,suggestions:[],setQuery:t=>{const s=Yv(t),r=t.length>=2?Fl.getSuggestions(t):[];n({query:t,parsedQuery:s,suggestions:r})},setActiveFilter:t=>{n({activeFilter:t})},search:async t=>{var r,i,o,a,l,u,d,f,p,g,x,y,b,k;if(!t.trim()){n({results:{tracks:[],artists:[],albums:[],localTracks:[]},isSearching:!1});return}const s=Yv(t);n({isSearching:!0,error:null,query:t,parsedQuery:s});try{if(window.api){const[w,N,C]=await Promise.all([window.api.search({query:t,type:"track"}),window.api.search({query:t,type:"artist"}).catch(()=>[]),window.api.search({query:t,type:"album"}).catch(()=>[])]),S=[],T=new Set;for(const _ of w||[])for(const O of _.artists||[]){const U=O.name.toLowerCase().trim();T.has(U)||(T.add(U),S.push({id:O.id||`artist-${U.replace(/\s+/g,"-")}`,name:O.name,image:((r=O.artwork)==null?void 0:r.medium)||((i=_.artwork)==null?void 0:i.medium),source:((o=_._meta)==null?void 0:o.metadataProvider)||"unknown"}))}const A=[],E=new Set;for(const _ of w||[])if(_.album&&_.album.title){const O=`${_.album.title.toLowerCase().trim()}-${(((a=_.artists[0])==null?void 0:a.name)||"").toLowerCase().trim()}`;E.has(O)||(E.add(O),A.push({id:_.album.id||`album-${O.replace(/\s+/g,"-")}`,title:_.album.title,artist:((l=_.artists[0])==null?void 0:l.name)||"Unknown",artwork:((u=_.album.artwork)==null?void 0:u.medium)||((d=_.artwork)==null?void 0:d.medium),year:_.album.releaseDate?parseInt(_.album.releaseDate.substring(0,4)):void 0,trackCount:_.album.trackCount,source:((f=_._meta)==null?void 0:f.metadataProvider)||"unknown"}))}let M=S,P=A;if(Array.isArray(N)&&N.length>0){const _=N[0];if(_&&typeof _.name=="string"&&_.name.trim()){const O=[],U=new Set;for(const W of N)W.name&&!U.has(W.name.toLowerCase().trim())&&(U.add(W.name.toLowerCase().trim()),O.push({id:W.id,name:W.name,image:(p=W.artwork)==null?void 0:p.medium,source:"addon"}));O.length>0&&(M=O)}}if(Array.isArray(C)&&C.length>0){const _=C[0];if(_&&typeof _.title=="string"&&_.title.trim()){const O=[],U=new Set;for(const W of C)if(W.title){const H=`${W.title.toLowerCase().trim()}-${(((x=(g=W.artists)==null?void 0:g[0])==null?void 0:x.name)||"").toLowerCase().trim()}`;U.has(H)||(U.add(H),O.push({id:W.id,title:W.title,artist:((b=(y=W.artists)==null?void 0:y[0])==null?void 0:b.name)||"Unknown Artist",artwork:(k=W.artwork)==null?void 0:k.medium,year:W.releaseDate?parseInt(W.releaseDate.substring(0,4)):void 0,trackCount:W.trackCount,source:"addon"}))}O.length>0&&(P=O)}}const R=Fl.search(t,{limit:20}),L=w||[];n({results:{tracks:L,artists:M.slice(0,12),albums:P.slice(0,12),localTracks:R},isSearching:!1}),L.length>0&&window.dispatchEvent(new CustomEvent("audiio:search-results",{detail:{tracks:L}}))}else{const w=Fl.search(t,{limit:50});n({results:{tracks:[],artists:[],albums:[],localTracks:w},isSearching:!1})}}catch(w){n({error:w instanceof Error?w.message:"Search failed",isSearching:!1})}},searchLocal:(t,s)=>new aM(s).search(t),updateLocalIndex:t=>{Fl.updateIndex(t)},getSuggestions:t=>Fl.getSuggestions(t),clear:()=>{n({query:"",results:{tracks:[],artists:[],albums:[],localTracks:[]},error:null,activeFilter:"all",parsedQuery:null,suggestions:[]})}})),Oue={autoQueueEnabled:!1,autoQueueThreshold:2,autoQueueBatchSize:10,limitArtistRepetition:!0,maxArtistPerBatch:2,useMLRecommendations:!0},_ue={seedWeight:.7,diversityFactor:.3,progressiveDrift:!0},zue=5e3,Bue=14400*1e3;function Wue(n,e,t){var i,o;if(!n.length)return[];const s=[],r=new Map;for(const a of n){if(s.length>=e)break;const l=((o=(i=a.artists[0])==null?void 0:i.name)==null?void 0:o.toLowerCase())||"unknown",u=r.get(l)||0;u<t&&(s.push(a),r.set(l,u+1))}if(s.length<e){const a=n.filter(l=>!s.includes(l));s.push(...a.slice(0,e-s.length))}return s}const wI={C:0,G:1,D:2,A:3,E:4,B:5,"F#":6,Gb:6,"C#":7,Db:7,Ab:8,"G#":8,Eb:9,"D#":9,Bb:10,"A#":10,F:11,Am:0,Em:1,Bm:2,"F#m":3,"C#m":4,"G#m":5,"D#m":6,Ebm:6,"A#m":7,Bbm:7,Fm:8,Cm:9,Gm:10,Dm:11};function Vue(n,e){if(!n||!e)return .5;const t=wI[n],s=wI[e];if(t===void 0||s===void 0)return .5;const r=Math.min(Math.abs(t-s),12-Math.abs(t-s));return Math.max(0,1-r*.2)}function Uue(n,e){var s,r,i,o;let t=0;switch(e.type){case"track":(s=e.artistIds)!=null&&s.some(a=>n.artists.some(l=>l.id===a||l.name.toLowerCase()===a.toLowerCase()))&&(t+=30),(r=e.genres)!=null&&r.some(a=>{var l;return(l=n.genres)==null?void 0:l.some(u=>u.toLowerCase().includes(a.toLowerCase()))})&&(t+=20);break;case"artist":n.artists.some(a=>a.id===e.id||a.name.toLowerCase()===e.name.toLowerCase())&&(t+=50),(i=e.genres)!=null&&i.some(a=>{var l;return(l=n.genres)==null?void 0:l.some(u=>u.toLowerCase().includes(a.toLowerCase()))})&&(t+=20);break;case"genre":(o=n.genres)!=null&&o.some(a=>a.toLowerCase().includes(e.id.toLowerCase())||e.id.toLowerCase().includes(a.toLowerCase()))&&(t+=60);break}if(e.audioFeatures){const a=e.audioFeatures,l=n.audioFeatures||{};let u=0,d=0;if(a.bpm!==void 0&&l.bpm!==void 0){const f=Math.abs(a.bpm-l.bpm),p=Math.min(f/a.bpm,1);p<=.1?u+=12:p<=.2?u+=8:p<=.3&&(u+=4),d++}if(a.energy!==void 0&&l.energy!==void 0){const f=Math.abs(a.energy-l.energy);f<=.15?u+=12:f<=.25?u+=8:f<=.35&&(u+=4),d++}if(a.key!==void 0&&l.key!==void 0){const f=Vue(a.key,l.key);u+=Math.round(f*10),d++}if(a.valence!==void 0&&l.valence!==void 0){const f=Math.abs(a.valence-l.valence);f<=.2?u+=6:f<=.35&&(u+=3),d++}t+=u,d>0&&console.log(`[RadioSeed] Audio match for "${n.title}": +${u} (${d} factors)`)}return Math.min(100,t)}const dl=An()(Er((n,e)=>({mode:"manual",radioSeed:null,radioTracksPlayed:0,sessionHistory:{playedTrackIds:[],playedArtistIds:[],sessionStartTime:Date.now()},isAutoQueueFetching:!1,lastAutoQueueFetch:0,autoQueueError:null,consecutiveFailures:0,config:Oue,radioConfig:_ue,pendingCandidates:[],setMode:t=>n({mode:t}),enableAutoQueue:()=>n({mode:"auto-queue",config:{...e().config,autoQueueEnabled:!0}}),disableAutoQueue:()=>n({mode:"manual",config:{...e().config,autoQueueEnabled:!1}}),toggleAutoQueue:()=>{const{config:t,mode:s}=e();t.autoQueueEnabled||s==="auto-queue"?e().disableAutoQueue():e().enableAutoQueue()},startRadio:async(t,s=[])=>{const r=Ke.getState();let i=t;if(t.type==="track"&&!t.audioFeatures)try{const o=await bm(t.id);o&&(i={...t,audioFeatures:o},console.log("[SmartQueue] Enriched seed with audio features:",o))}catch(o){console.warn("[SmartQueue] Could not fetch audio features for seed:",o)}if(n({mode:"radio",radioSeed:i,radioTracksPlayed:0,sessionHistory:{playedTrackIds:[],playedArtistIds:[],sessionStartTime:Date.now()},autoQueueError:null,consecutiveFailures:0}),console.log("[SmartQueue] Starting radio with seed:",i),s.length>0){const o=await e().fetchMoreTracks(s);o.length>0&&(r.setQueue(o,0),await r.play(o[0]),e().recordTrackPlayed(o[0]))}},stopRadio:()=>{n({mode:"manual",radioSeed:null,radioTracksPlayed:0,pendingCandidates:[]}),console.log("[SmartQueue] Radio stopped")},checkAndReplenish:async t=>{const s=e(),{config:r,mode:i,isAutoQueueFetching:o,lastAutoQueueFetch:a}=s;if(i==="manual"||!r.autoQueueEnabled&&i!=="radio"||o||Date.now()-a<zue)return;const l=Ke.getState(),{queue:u,queueIndex:d}=l,f=u.length-d-1;if(f<=r.autoQueueThreshold){console.log("[SmartQueue] Replenishing queue, remaining:",f),n({isAutoQueueFetching:!0});try{const p=await s.fetchMoreTracks(t);p.length>0?(p.forEach(g=>l.addToQueue(g)),n({isAutoQueueFetching:!1,lastAutoQueueFetch:Date.now(),autoQueueError:null,consecutiveFailures:0}),console.log("[SmartQueue] Added",p.length,"tracks to queue")):n({isAutoQueueFetching:!1,lastAutoQueueFetch:Date.now(),autoQueueError:"No matching tracks found",consecutiveFailures:s.consecutiveFailures+1})}catch(p){const g=p instanceof Error?p.message:"Failed to fetch tracks";console.error("[SmartQueue] Fetch error:",g),n({isAutoQueueFetching:!1,lastAutoQueueFetch:Date.now(),autoQueueError:g,consecutiveFailures:s.consecutiveFailures+1})}}},fetchMoreTracks:async t=>{var B,J,ae,pe,ge,he,we,Pe,ue,Te;const s=e(),{config:r,radioConfig:i,mode:o,radioSeed:a,sessionHistory:l,radioTracksPlayed:u}=s,d=Ke.getState(),f=dn.getState(),p=Ap.getState(),g=la.getState(),x=d.currentTrack,y=new Set;d.queue.forEach(ke=>y.add(ke.id)),l.playedTrackIds.forEach(ke=>y.add(ke)),Object.keys(f.dislikedTracks).forEach(ke=>y.add(ke));const b=[],k=[],w=[];if(console.log("[SmartQueue] Gathering candidates from multiple sources..."),console.log(`[SmartQueue] Current track: ${(x==null?void 0:x.title)||"none"} by ${((B=x==null?void 0:x.artists[0])==null?void 0:B.name)||"unknown"}`),t.length>0&&(b.push(...t),console.log(`[SmartQueue] Local library: ${t.length} tracks`)),x){for(const ke of kce())if(ke.getSimilarTracks)try{const ye=await ke.getSimilarTracks(x.id,20);ye.length>0&&console.log(`[SmartQueue] Plugin ${ke.pluginId} returned ${ye.length} similar tracks`)}catch(ye){console.warn(`[SmartQueue] Plugin ${ke.pluginId} similar tracks failed:`,ye)}}try{if((J=window.api)!=null&&J.getSimilarTracks&&x){const ye=await window.api.getSimilarTracks(x.id);ye&&ye.length>0&&(w.push(...ye),console.log(`[SmartQueue] API similar: ${ye.length} tracks`))}if((ae=window.api)!=null&&ae.getRecommendedTracks){if(o==="radio"&&a){const Ce=a.type==="track"?"artist":a.type,Ae=await window.api.getRecommendedTracks(Ce,a.id);(Ae==null?void 0:Ae.length)>0&&(k.push(...Ae),console.log(`[SmartQueue] Radio seed recs: ${Ae.length} tracks`))}if(x!=null&&x.artists[0]){const Ce=x.artists[0].id||x.artists[0].name,Ae=await window.api.getRecommendedTracks("artist",Ce);(Ae==null?void 0:Ae.length)>0&&(k.push(...Ae),console.log(`[SmartQueue] Artist recs (${x.artists[0].name}): ${Ae.length} tracks`))}if((pe=x==null?void 0:x.genres)!=null&&pe[0]){const Ce=await window.api.getRecommendedTracks("genre",x.genres[0]);(Ce==null?void 0:Ce.length)>0&&(k.push(...Ce),console.log(`[SmartQueue] Genre recs (${x.genres[0]}): ${Ce.length} tracks`))}const ye=Object.entries(f.userProfile.genrePreferences).sort((Ce,Ae)=>Ae[1].score-Ce[1].score).slice(0,2).map(([Ce])=>Ce);for(const Ce of ye)if(Ce!==((ge=x==null?void 0:x.genres)==null?void 0:ge[0]))try{const Ae=await window.api.getRecommendedTracks("genre",Ce);(Ae==null?void 0:Ae.length)>0&&(k.push(...Ae.slice(0,10)),console.log(`[SmartQueue] User genre recs (${Ce}): ${Math.min(Ae.length,10)} tracks`))}catch{}}if(k.length<20&&((he=window.api)!=null&&he.search)){const ye=[];x&&(x.artists[0]&&(ye.push(`${x.artists[0].name} fans also like`),ye.push(`similar to ${x.artists[0].name}`)),(we=x.genres)!=null&&we[0]&&(ye.push(`best ${x.genres[0]} 2024`),ye.push(`${x.genres[0]} playlist`)));const Ce=Object.entries(f.userProfile.artistPreferences).sort((Ae,Be)=>Be[1].score-Ae[1].score).slice(0,3).map(([Ae,Be])=>Be.artistName);for(const Ae of Ce)Ae&&Ae!==((Pe=x==null?void 0:x.artists[0])==null?void 0:Pe.name)&&ye.push(`${Ae} popular songs`);for(const Ae of ye.slice(0,3))try{const Be=await window.api.search({query:Ae,type:"track"});(Be==null?void 0:Be.length)>0&&(k.push(...Be.slice(0,15)),console.log(`[SmartQueue] Search "${Ae}": ${Math.min(Be.length,15)} tracks`))}catch{console.warn(`[SmartQueue] Search failed: "${Ae}"`)}}if(k.length<10&&((ue=window.api)!=null&&ue.getTrending)){const ye=await window.api.getTrending();((Te=ye==null?void 0:ye.tracks)==null?void 0:Te.length)>0&&(k.push(...ye.tracks.slice(0,20)),console.log(`[SmartQueue] Trending fallback: ${Math.min(ye.tracks.length,20)} tracks`))}g.results.tracks.length>0&&(k.push(...g.results.tracks),console.log(`[SmartQueue] Search cache: ${g.results.tracks.length} tracks`))}catch(ke){console.warn("[SmartQueue] API fetch failed:",ke)}let N=[];const C=b.length,S=k.length+w.length;console.log(`[SmartQueue] Source breakdown - Local: ${C}, Similar: ${w.length}, Discovery: ${k.length}`);const T=[];let A=0,E=0,M=0;for(;A<w.length;)T.push(w[A++]);for(;E<k.length||M<b.length;)E<k.length&&T.push(k[E++]),E<k.length&&T.push(k[E++]),M<b.length&&T.push(b[M++]);N=T;const P=new Set;if(N=N.filter(ke=>!(ke!=null&&ke.id)||P.has(ke.id)||y.has(ke.id)?!1:(P.add(ke.id),!0)),console.log(`[SmartQueue] ${N.length} unique candidates after deduplication`),N.length===0)return console.warn("[SmartQueue] No candidates available for auto-queue"),[];const R=new Date,L=d.queue.slice(Math.max(0,d.queueIndex-5),d.queueIndex+1),_=[];for(const ke of L.slice(-3)){const ye=ke.audioFeatures||await bm(ke.id);(ye==null?void 0:ye.energy)!==void 0&&_.push(ye.energy)}const O=S/Math.max(1,C+S);let U="balanced";O>.6?U="exploit":O<.3&&(U="explore"),console.log(`[SmartQueue] Exploration mode: ${U} (discovery ratio: ${(O*100).toFixed(0)}%)`);const W={hour:R.getHours(),dayOfWeek:R.getDay(),sessionTracks:L,recentGenres:L.flatMap(ke=>ke.genres||[]).slice(0,10),recentArtists:L.map(ke=>{var ye;return(ye=ke.artists[0])==null?void 0:ye.name}).filter(Boolean).slice(0,5),recentEnergy:_,explorationMode:U},H={genrePreferences:f.userProfile.genrePreferences,artistPreferences:f.userProfile.artistPreferences,artistHistory:f.getArtistHistory(),genreHistory:f.getGenreHistory(),timePatterns:f.getTimePatternsForScoring()},G=f.getPlayCounts(),q=new Map,Q=r.useMLRecommendations&&p.isModelLoaded;for(const ke of N){let ye;if(o==="radio"&&a){const Ce=Q?p.getHybridScore(ke):f.calculateTrackScore(ke),Ae=Uue(ke,a);let Be=i.seedWeight;i.progressiveDrift&&(Be=Math.max(.3,i.seedWeight-u*.02)),ye=Ce*(1-Be)+Ae*Be}else ye=Q?p.getHybridScore(ke):f.calculateTrackScore(ke);q.set(ke.id,ye)}console.log(`[SmartQueue] Using ${Q?"ML hybrid":"rule-based"} + advanced scoring...`);const z=await KP(N,q,W,H,G),K=N.map(ke=>{const ye=z.get(ke.id);return{track:ke,score:(ye==null?void 0:ye.finalScore)??q.get(ke.id)??0,explanation:(ye==null?void 0:ye.explanation)||[]}});K.sort((ke,ye)=>ye.score-ke.score),console.log("[SmartQueue] Top 5 candidates:"),K.slice(0,5).forEach((ke,ye)=>{var Ae;const Ce=ke.explanation.length>0?` [${ke.explanation.join(", ")}]`:"";console.log(`  ${ye+1}. ${ke.track.title} by ${(Ae=ke.track.artists[0])==null?void 0:Ae.name} (${ke.score.toFixed(1)})${Ce}`)});let Y=K.map(ke=>ke.track);return r.limitArtistRepetition?Y=Wue(Y,r.autoQueueBatchSize,r.maxArtistPerBatch):Y=Y.slice(0,r.autoQueueBatchSize),console.log(`[SmartQueue] Selected ${Y.length} tracks for queue`),Y},recordTrackPlayed:t=>{n(s=>{const r=[...s.sessionHistory.playedTrackIds,t.id],i=[...s.sessionHistory.playedArtistIds,...t.artists.map(l=>l.id||l.name)],o=r.slice(-200),a=i.slice(-400);return{sessionHistory:{...s.sessionHistory,playedTrackIds:o,playedArtistIds:a},radioTracksPlayed:s.mode==="radio"?s.radioTracksPlayed+1:s.radioTracksPlayed}})},clearSession:()=>{n({sessionHistory:{playedTrackIds:[],playedArtistIds:[],sessionStartTime:Date.now()},radioTracksPlayed:0})},resetSession:()=>{const{sessionHistory:t}=e();Date.now()-t.sessionStartTime>Bue&&e().clearSession()},updateConfig:t=>{n(s=>({config:{...s.config,...t}}))},updateRadioConfig:t=>{n(s=>({radioConfig:{...s.radioConfig,...t}}))}}),{name:"audiio-smart-queue",partialize:n=>({config:n.config,radioConfig:n.radioConfig})}));function lM(){return dl(d$(n=>({isRadioMode:n.mode==="radio",seed:n.radioSeed,tracksPlayed:n.radioTracksPlayed})))}function Gue(){return dl(d$(n=>({isEnabled:n.config.autoQueueEnabled||n.mode==="auto-queue",isFetching:n.isAutoQueueFetching,error:n.autoQueueError})))}let Hue=0;const cM=An((n,e)=>({toasts:[],addToast:t=>{const s=`toast-${++Hue}`,r={...t,id:s};return n(i=>({toasts:[...i.toasts,r]})),t.duration>0&&setTimeout(()=>{e().removeToast(s)},t.duration),s},removeToast:t=>{n(s=>({toasts:s.toasts.filter(r=>r.id!==t)}))},clearToasts:()=>{n({toasts:[]})}}));function que(n,e="info",t=3e3){return cM.getState().addToast({message:n,type:e,duration:t})}function tc(n,e=3e3){return que(n,"success",e)}const Kue=({entity:n,x:e,y:t,onClose:s,onAddToPlaylist:r,onDislike:i})=>{const o=j.useRef(null),a=j.useRef(null),[l,u]=j.useState(!1),d=j.useRef(null),{play:f,addToQueue:p,playNext:g}=Ke(),{isLiked:x,toggleLike:y,playlists:b,addToPlaylist:k,startDownload:w,undislikeTrack:N,likedTracks:C}=Xt(),{isDisliked:S,removeDislike:T}=dn(),{openArtist:A,openAlbum:E}=Wt(),{startRadio:M}=dl();j.useEffect(()=>()=>{d.current&&clearTimeout(d.current)},[]);const P=j.useCallback(()=>{d.current&&(clearTimeout(d.current),d.current=null),u(!0)},[]),R=j.useCallback(()=>{d.current=setTimeout(()=>{u(!1)},150)},[]);if(j.useEffect(()=>{if(o.current){const L=o.current.getBoundingClientRect(),_=window.innerWidth,O=window.innerHeight;let U=e,W=t;e+L.width>_&&(U=_-L.width-10),t+L.height>O&&(W=O-L.height-10),o.current.style.left=`${U}px`,o.current.style.top=`${W}px`}},[e,t]),j.useEffect(()=>{const L=O=>{o.current&&!o.current.contains(O.target)&&s()},_=O=>{O.key==="Escape"&&s()};return document.addEventListener("mousedown",L),document.addEventListener("keydown",_),()=>{document.removeEventListener("mousedown",L),document.removeEventListener("keydown",_)}},[s]),n.type==="track"){const L=n.data,_=x(L.id),O=S(L.id),U=()=>{f(L),s()},W=()=>{g(L),tc(`"${L.title}" will play next`),s()},H=()=>{p(L),tc(`Added "${L.title}" to queue`),s()},G=()=>{y(L),s()},q=()=>{w(L),s()},Q=()=>{O?(T(L.id),N(L.id)):i&&i(L),s()},z=J=>{k(J,L),u(!1),s()},K=()=>{r&&r(L),s()},Y=()=>{var ae,pe;const J=L.artists[0];J&&A(J.id,{id:J.id,name:J.name,image:(ae=L.artwork)==null?void 0:ae.medium,source:((pe=L._meta)==null?void 0:pe.metadataProvider)||"unknown"}),s()},B=()=>{var J,ae,pe;L.album&&E(L.album.id,{id:L.album.id,title:L.album.title,artist:((J=L.artists[0])==null?void 0:J.name)||"Unknown",artwork:(ae=L.album.artwork)==null?void 0:ae.medium,year:L.album.releaseDate?parseInt(L.album.releaseDate.substring(0,4)):void 0,source:((pe=L._meta)==null?void 0:pe.metadataProvider)||"unknown"}),s()};return c.jsxs("div",{ref:o,className:"context-menu",style:{left:e,top:t},children:[c.jsxs("button",{className:"context-menu-item",onClick:U,children:[c.jsx(Et,{size:16}),c.jsx("span",{children:"Play"})]}),c.jsxs("button",{className:"context-menu-item",onClick:W,children:[c.jsx(Dm,{size:16}),c.jsx("span",{children:"Play Next"})]}),c.jsxs("button",{className:"context-menu-item",onClick:H,children:[c.jsx(Bp,{size:16}),c.jsx("span",{children:"Add to Queue"})]}),c.jsx("div",{className:"context-menu-divider"}),c.jsxs("div",{className:"context-menu-item has-submenu",onMouseEnter:P,onMouseLeave:R,children:[c.jsx(yi,{size:16}),c.jsx("span",{children:"Add to Playlist"}),c.jsx(Yi,{size:14,className:"context-menu-arrow"}),l&&c.jsxs("div",{ref:a,className:"context-submenu",onMouseEnter:P,onMouseLeave:R,children:[r&&c.jsxs("button",{className:"context-menu-item",onClick:K,children:[c.jsx(Zi,{size:16}),c.jsx("span",{children:"New Playlist..."})]}),b.length>0&&r&&c.jsx("div",{className:"context-menu-divider"}),b.length===0?c.jsx("div",{className:"context-menu-item disabled",children:c.jsx("span",{children:"No playlists"})}):b.map(J=>c.jsxs("button",{className:"context-menu-item",onClick:()=>z(J.id),children:[c.jsx(yi,{size:16}),c.jsx("span",{children:J.name})]},J.id))]})]}),c.jsx("div",{className:"context-menu-divider"}),L.artists[0]&&c.jsxs("button",{className:"context-menu-item",onClick:Y,children:[c.jsx(qe,{size:16}),c.jsx("span",{children:"Go to Artist"})]}),L.album&&c.jsxs("button",{className:"context-menu-item",onClick:B,children:[c.jsx(qe,{size:16}),c.jsx("span",{children:"Go to Album"})]}),(L.artists[0]||L.album)&&c.jsx("div",{className:"context-menu-divider"}),c.jsxs("button",{className:"context-menu-item",onClick:G,children:[_?c.jsx(Sc,{size:16}):c.jsx(ic,{size:16}),c.jsx("span",{children:_?"Remove from Liked":"Add to Liked"})]}),c.jsxs("button",{className:`context-menu-item ${O?"active":""}`,onClick:Q,children:[O?c.jsx(JT,{size:16}):c.jsx(ql,{size:16}),c.jsx("span",{children:O?"Remove Dislike":"Not for me..."})]}),c.jsx("div",{className:"context-menu-divider"}),c.jsxs("button",{className:"context-menu-item",onClick:q,children:[c.jsx(Ir,{size:16}),c.jsx("span",{children:"Download"})]})]})}if(n.type==="artist"){const L=n.data,_=()=>{s()},O=async()=>{const W={type:"artist",id:L.id,name:`${L.name} Radio`,artwork:L.image,artistIds:[L.id]};await M(W,C),tc(`Started ${L.name} Radio`),s()},U=()=>{A(L.id,L),s()};return c.jsxs("div",{ref:o,className:"context-menu",style:{left:e,top:t},children:[c.jsxs("button",{className:"context-menu-item",onClick:_,children:[c.jsx(Et,{size:16}),c.jsx("span",{children:"Play Artist"})]}),c.jsxs("button",{className:"context-menu-item",onClick:O,children:[c.jsx(rc,{size:16}),c.jsxs("span",{children:["Start ",L.name," Radio"]})]}),c.jsx("div",{className:"context-menu-divider"}),c.jsxs("button",{className:"context-menu-item",onClick:U,children:[c.jsx(qe,{size:16}),c.jsx("span",{children:"Go to Artist Page"})]})]})}if(n.type==="album"){const L=n.data,_=()=>{s()},O=()=>{s()},U=()=>{E(L.id,L),s()},W=()=>{A(`artist-${L.artist}`,{id:`artist-${L.artist}`,name:L.artist,source:L.source}),s()};return c.jsxs("div",{ref:o,className:"context-menu",style:{left:e,top:t},children:[c.jsxs("button",{className:"context-menu-item",onClick:_,children:[c.jsx(Et,{size:16}),c.jsx("span",{children:"Play Album"})]}),c.jsxs("button",{className:"context-menu-item",onClick:O,children:[c.jsx(Bp,{size:16}),c.jsx("span",{children:"Add to Queue"})]}),c.jsx("div",{className:"context-menu-divider"}),c.jsxs("button",{className:"context-menu-item",onClick:U,children:[c.jsx(qe,{size:16}),c.jsx("span",{children:"Go to Album Page"})]}),c.jsxs("button",{className:"context-menu-item",onClick:W,children:[c.jsx(qe,{size:16}),c.jsx("span",{children:"Go to Artist"})]})]})}return null},px=j.createContext(null);function pt(){const n=j.useContext(px);if(!n)throw new Error("useTrackContextMenu must be used within a ContextMenuProvider");return{showContextMenu:n.showTrackMenu,hideContextMenu:n.hideContextMenu}}function mx(){const n=j.useContext(px);if(!n)throw new Error("useArtistContextMenu must be used within a ContextMenuProvider");return{showContextMenu:n.showArtistMenu,hideContextMenu:n.hideContextMenu}}function Fh(){const n=j.useContext(px);if(!n)throw new Error("useAlbumContextMenu must be used within a ContextMenuProvider");return{showContextMenu:n.showAlbumMenu,hideContextMenu:n.hideContextMenu}}const Que=({children:n,onAddToPlaylist:e,onDislike:t})=>{const[s,r]=j.useState(null),i=j.useCallback((d,f)=>{d.preventDefault(),d.stopPropagation(),r({entity:f,x:d.clientX,y:d.clientY})},[]),o=j.useCallback((d,f)=>{d.preventDefault(),d.stopPropagation(),r({entity:{type:"track",data:f},x:d.clientX,y:d.clientY})},[]),a=j.useCallback((d,f)=>{d.preventDefault(),d.stopPropagation(),r({entity:{type:"artist",data:f},x:d.clientX,y:d.clientY})},[]),l=j.useCallback((d,f)=>{d.preventDefault(),d.stopPropagation(),r({entity:{type:"album",data:f},x:d.clientX,y:d.clientY})},[]),u=j.useCallback(()=>{r(null)},[]);return c.jsxs(px.Provider,{value:{showContextMenu:i,hideContextMenu:u,showTrackMenu:o,showArtistMenu:a,showAlbumMenu:l},children:[n,s&&c.jsx(Kue,{entity:s.entity,x:s.x,y:s.y,onClose:u,onAddToPlaylist:e,onDislike:t})]})};function Xue(n){let e=n.trim();if(/^[a-zA-Z0-9_-]+\/[a-zA-Z0-9_.-]+$/.test(e)){const t=e.split("/"),s=t[0]??"",r=t[1]??"";return{owner:s,repo:r}}try{e.startsWith("http")||(e="https://"+e);const t=new URL(e);if(!t.hostname.includes("github.com"))return null;const s=t.pathname.split("/").filter(Boolean);if(s.length<2)return null;const r=s[0]??"",i=s[1]??"";let o;return s.length>3&&s[2]==="tree"&&(o=s[3]),{owner:r,repo:i.replace(/\.git$/,""),branch:o}}catch{return null}}function Yue(n,e="audiio-theme.json"){const t=n.branch||"main";return`https://raw.githubusercontent.com/${n.owner}/${n.repo}/${t}/${e}`}const Zue=["name","colors"],Jue=["bgPrimary","bgSecondary","textPrimary","textSecondary","accent"];function ede(n){const e=[];if(!n||typeof n!="object")return{valid:!1,errors:["Theme must be an object"]};const t=n;for(const s of Zue)t[s]||e.push(`Missing required field: ${s}`);if(t.name&&typeof t.name!="string"&&e.push("Theme name must be a string"),t.colors)if(typeof t.colors!="object")e.push("Colors must be an object");else{const s=t.colors;for(const r of Jue)s[r]?tde(s[r])||e.push(`Invalid color value for ${r}: ${s[r]}`):e.push(`Missing required color: ${r}`)}return t.mode&&!["light","dark"].includes(t.mode)&&e.push('Mode must be "light" or "dark"'),t.customCSS&&typeof t.customCSS=="string"&&t.customCSS.length>5e4&&e.push("Custom CSS must be less than 50KB"),{valid:e.length===0,errors:e}}function tde(n){return!n||typeof n!="string"?!1:!!(/^#([0-9A-Fa-f]{3}){1,2}$/.test(n)||/^#([0-9A-Fa-f]{4}){1,2}$/.test(n)||/^rgba?\s*\(\s*\d+\s*,\s*\d+\s*,\s*\d+\s*(,\s*[\d.]+)?\s*\)$/i.test(n)||/^hsla?\s*\(\s*\d+\s*,\s*[\d.]+%?\s*,\s*[\d.]+%?\s*(,\s*[\d.]+)?\s*\)$/i.test(n)||["transparent","currentColor","inherit","black","white","red","green","blue","yellow","orange","purple","gray","grey","pink","cyan","magenta"].includes(n.toLowerCase()))}const nde=[/expression\s*\(/gi,/javascript\s*:/gi,/vbscript\s*:/gi,/behavior\s*:/gi,/@import/gi,/url\s*\(\s*["']?data:/gi,/-moz-binding/gi,/binding\s*:/gi];function sde(n){if(!n||typeof n!="string")return"";let e=n;for(const t of nde)e=e.replace(t,"/* blocked */");return e=rde(e,".audiio-app"),e}function rde(n,e){const t=n.split(`
`),s=[];let r=!1,i="",o="";for(const a of t){const l=a.trim();if(l.startsWith("@")){s.push(a);continue}if(l.includes("{")){const u=l.split("{");o=(u[0]??"").trim(),!o.startsWith(e)&&!o.startsWith(":root")&&(o=o.split(",").map(d=>{const f=d.trim();return f.startsWith("body")||f.startsWith("html")?`${e} ${f}`:`${e} ${f}`}).join(", ")),s.push(`${o} {`),r=!0,i=u.slice(1).join("{"),i.includes("}")&&(s.push(i),r=!1,i="")}else r&&l.includes("}")?(s.push(a),r=!1,i=""):s.push(a)}return s.join(`
`)}async function ide(n){const e=Xue(n);if(!e)throw new Error("Invalid GitHub URL format");const t=["audiio-theme.json","theme.json",".audiio-theme.json"];for(const s of t)try{const r=Yue(e,s),i=await fetch(r);if(i.ok){const o=await i.json(),a=ede(o);if(!a.valid)throw new Error(`Invalid theme: ${a.errors.join(", ")}`);return o.customCSS&&(o.customCSS=sde(o.customCSS)),o}}catch{continue}throw new Error("Could not find a valid theme manifest in the repository")}function ode(n,e){const t=n.startsWith("--")?n:`--${n}`;return getComputedStyle(document.documentElement).getPropertyValue(t).trim()||e}function ade(){return ode("--accent","#1db954")}async function lde(n){const e=ade();return new Promise(t=>{const s=new Image;s.crossOrigin="anonymous",s.onload=()=>{try{const r=document.createElement("canvas");r.width=50,r.height=50;const i=r.getContext("2d");if(!i){t(e);return}i.drawImage(s,0,0,50,50);const o=i.getImageData(0,0,50,50).data;let a=0,l=0,u=0;for(let f=0;f<o.length;f+=4)a+=o[f],l+=o[f+1],u+=o[f+2];const d=o.length/4;t(`rgb(${Math.round(a/d)}, ${Math.round(l/d)}, ${Math.round(u/d)})`)}catch{t(e)}},s.onerror=()=>t(e),s.src=n})}function cde(n){const e=[...n];for(let t=e.length-1;t>0;t--){const s=Math.floor(Math.random()*(t+1)),r=e[t];e[t]=e[s],e[s]=r}return e}const ude=({title:n,subtitle:e,query:t,isPersonalized:s,context:r})=>{var H,G;const{play:i,setQueue:o}=Ke(),{startRadio:a,enableAutoQueue:l}=dl(),{isRadioMode:u,seed:d}=lM(),f=dn,{likedTracks:p}=Xt(),{showContextMenu:g}=pt(),[x,y]=j.useState(0),[b,k]=j.useState("var(--accent-primary)"),[w,N]=j.useState(!1),C=u&&(d==null?void 0:d.type)==="genre"&&d.name==="Made For You",S=j.useMemo(()=>{const q=r==null?void 0:r.isNewUser,Q=.15+x*.05;return{strategy:"plugin",sectionType:"hero",title:n,subtitle:e,embedding:{method:q?"discovery":"personalized",exploration:Q},limit:20}},[n,e,r==null?void 0:r.isNewUser,x]),{tracks:T,isLoading:A}=Vt(S,{enabled:!0,applyMLRanking:!0,applyTransformers:!0,limit:20}),E=T==null?void 0:T[0],M=((H=E==null?void 0:E.artwork)==null?void 0:H.large)||((G=E==null?void 0:E.artwork)==null?void 0:G.medium);j.useEffect(()=>{M?lde(M).then(k):k("var(--accent-primary)")},[M]),j.useEffect(()=>{const q=setTimeout(()=>N(!0),50);return()=>clearTimeout(q)},[]);const P=j.useCallback(()=>{T.length>0&&T[0]&&(o(T,0),i(T[0]),l())},[T,o,i,l]),R=j.useCallback(()=>{if(T.length>0){const q=cde(T);q[0]&&(o(q,0),i(q[0]),l())}},[T,o,i,l]),L=j.useCallback(async()=>{if(T.length===0)return;const q=f.getState().userProfile,Q=Object.entries(q.genrePreferences).sort((J,ae)=>ae[1].score-J[1].score)[0],z={type:"genre",id:(Q==null?void 0:Q[0])||"pop",name:"Made For You",genres:Object.keys(q.genrePreferences).slice(0,3),artwork:M},K=new Set,Y=p.map(J=>J.track),B=[...T,...Y].filter(J=>K.has(J.id)?!1:(K.add(J.id),!0));await a(z,B)},[T,M,p,a]),_=j.useCallback(()=>{y(q=>q+1)},[]),O=!A&&T.length===0,U=C?"Made For You Radio":n,W=C?"Endless personalized music":e;return c.jsx("section",{className:`discover-hero-section discover-hero-section--centered ${w?"is-visible":""} ${C?"is-radio-active":""}`,style:{"--ambient-color":b},onContextMenu:E?q=>g(q,E):void 0,children:A?c.jsxs("div",{className:"hero-skeleton hero-skeleton--centered",children:[c.jsx("div",{className:"hero-skeleton-artwork hero-skeleton-artwork--centered"}),c.jsxs("div",{className:"hero-skeleton-info hero-skeleton-info--centered",children:[c.jsx("div",{className:"hero-skeleton-badge"}),c.jsx("div",{className:"hero-skeleton-title"}),c.jsx("div",{className:"hero-skeleton-subtitle"}),c.jsx("div",{className:"hero-skeleton-actions"})]})]}):O?c.jsxs("div",{className:"hero-content hero-content--centered",children:[c.jsx("div",{className:"hero-artwork hero-artwork--centered",children:c.jsx("div",{className:"hero-artwork-placeholder",children:c.jsx(qe,{size:80})})}),c.jsxs("div",{className:"hero-info hero-info--centered",children:[c.jsx("h1",{className:"hero-title hero-title--centered",children:n}),c.jsx("p",{className:"hero-subtitle hero-subtitle--centered",children:"Discover new music"})]})]}):c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"hero-ambient-bg hero-ambient-bg--subtle",style:{backgroundImage:M?`url(${M})`:"none"}}),c.jsxs("div",{className:"hero-content hero-content--centered",children:[c.jsxs("div",{className:"hero-artwork hero-artwork--centered",children:[M?c.jsx("img",{src:M,alt:E==null?void 0:E.title}):c.jsx("div",{className:"hero-artwork-placeholder",children:c.jsx(qe,{size:80})}),C&&c.jsxs("div",{className:"hero-radio-indicator",children:[c.jsx(rc,{size:24}),c.jsx("span",{className:"radio-pulse"})]})]}),c.jsxs("div",{className:"hero-info hero-info--centered",children:[s&&c.jsx("span",{className:"hero-badge hero-badge--centered",children:C?"Live Radio":"Made for You"}),c.jsx("h1",{className:"hero-title hero-title--centered",children:U}),W&&c.jsx("p",{className:"hero-subtitle hero-subtitle--centered",children:W}),c.jsxs("div",{className:"hero-track-info",children:[c.jsxs("span",{children:[T.length," tracks"]}),c.jsx("span",{className:"hero-dot",children:""}),c.jsx("span",{children:"Updates as you listen"})]}),c.jsxs("div",{className:"hero-actions hero-actions--centered",children:[c.jsxs("button",{className:"hero-play-btn hero-play-btn--pill",onClick:P,children:[c.jsx(Et,{size:20}),c.jsx("span",{children:"Play"})]}),c.jsxs("button",{className:"hero-shuffle-btn hero-shuffle-btn--pill",onClick:R,children:[c.jsx(oo,{size:18}),c.jsx("span",{children:"Shuffle"})]}),c.jsxs("button",{className:`hero-radio-btn hero-radio-btn--pill ${C?"active":""}`,onClick:L,title:"Start endless personalized radio",children:[c.jsx(rc,{size:18}),c.jsx("span",{children:"Radio"})]}),c.jsx("button",{className:"hero-refresh-btn",onClick:_,title:"Refresh mix",children:c.jsx(sr,{size:16})})]})]})]})]})})},uM={basePreference:{label:"Taste Match",icon:"",descriptions:{high:"This artist and genre match your listening history",low:"This is outside your usual preferences",neutral:"Moderate match to your taste"}},mlPrediction:{label:"AI Prediction",icon:"",descriptions:{high:"Our AI model predicts you'll enjoy this",low:"Less likely to match your preferences",neutral:"Moderate prediction confidence"}},audioMatch:{label:"Sound Profile",icon:"",descriptions:{high:"Similar sound to what you're listening to",low:"Different sound characteristics",neutral:"Moderate audio similarity"}},moodMatch:{label:"Mood Match",icon:"",descriptions:{high:"Matches your current mood perfectly",low:"Different mood than requested",neutral:"Partially matches the mood"}},harmonicFlow:{label:"Harmonic Flow",icon:"",descriptions:{high:"Key and harmony flow smoothly from the previous track",low:"Key change may feel abrupt",neutral:"Acceptable key transition"}},temporalFit:{label:"Time of Day",icon:"",descriptions:{high:"Perfect energy level for this time of day",low:"Energy doesn't match typical listening patterns",neutral:"Reasonable fit for current time"}},sessionFlow:{label:"Session Flow",icon:"",descriptions:{high:"Energy flows naturally from recent tracks",low:"May disrupt the current vibe",neutral:"Acceptable session flow"}},activityMatch:{label:"Activity Match",icon:"",descriptions:{high:"Great for your current activity",low:"May not suit your current activity",neutral:"Works reasonably well"}},explorationBonus:{label:"Discovery",icon:"",descriptions:{high:"Something new to expand your horizons",low:"Familiar territory",neutral:"Mildly new territory"}},serendipityScore:{label:"Serendipity",icon:"",descriptions:{high:"A delightful surprise recommendation",low:"Predictable choice",neutral:"Some novelty factor"}},diversityScore:{label:"Variety",icon:"",descriptions:{high:"Adds diversity to your queue",low:"Similar to what's already queued",neutral:"Some variety added"}},recentPlayPenalty:{label:"Freshness",icon:"",descriptions:{high:"Recently played - giving it a rest",low:"Haven't heard this in a while",neutral:"Reasonable time since last play"}},repetitionPenalty:{label:"Artist Variety",icon:"",descriptions:{high:"Too much of this artist in queue",low:"Good artist variety",neutral:"Acceptable artist frequency"}}};function dde(n,e){return e?n>15?"negative":n<5?"positive":"neutral":n>70?"positive":n<30?"negative":"neutral"}function hde(n,e){const t=uM[n];return t?e==="positive"?t.descriptions.high:e==="negative"?t.descriptions.low:t.descriptions.neutral:""}function fde(){const[n,e]=j.useState(null),[t,s]=j.useState(!1),[r,i]=j.useState(null),{getPluginsByRole:o}=ii(),a=j.useCallback(async u=>{var d,f;s(!0),i(null);try{const g=o("audio-processor")[0];let x={},y=75;if(g!=null&&g.enabled&&((d=g.instance)!=null&&d.explain))try{const S=await g.instance.explain(u.id);(f=S==null?void 0:S.score)!=null&&f.components&&(x=S.score.components,y=S.score.finalScore)}catch{}Object.keys(x).length===0&&(x={basePreference:Math.random()*40+50,temporalFit:Math.random()*30+50,explorationBonus:Math.random()*60+20,diversityScore:Math.random()*40+40,serendipityScore:Math.random()*50+25},y=Object.values(x).reduce((S,T)=>S+T,0)/5);const b=[],k=["recentPlayPenalty","dislikePenalty","repetitionPenalty","fatiguePenalty"];for(const[S,T]of Object.entries(x)){const A=uM[S];if(!A)continue;const E=k.includes(S),M=dde(T,E);b.push({id:S,label:A.label,value:Math.round(T),impact:M,icon:A.icon,description:hde(S,M)})}b.sort((S,T)=>{const A={positive:0,neutral:1,negative:2};return A[S.impact]-A[T.impact]});const w=b.filter(S=>S.impact==="positive");let N="";w.length>=2?N=`Recommended because it ${w[0].description.toLowerCase()} and ${w[1].description.toLowerCase()}.`:w.length===1?N=`Recommended because it ${w[0].description.toLowerCase()}.`:N="This recommendation balances multiple factors to match your listening preferences.";const C={trackId:u.id,track:u,score:Math.round(y),summary:N,factors:b,generatedAt:Date.now()};return e(C),C}catch(p){const g=p instanceof Error?p.message:"Failed to fetch explanation";return i(g),null}finally{s(!1)}},[o]),l=j.useCallback(()=>{e(null),i(null)},[]);return{explanation:n,isLoading:t,error:r,fetchExplanation:a,clearExplanation:l}}const pde=({explanation:n,isLoading:e,error:t,onClose:s})=>{var o;const r=j.useRef(null);j.useEffect(()=>{const a=l=>{l.key==="Escape"&&s()};return window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)},[s]);const i=a=>{a.target===a.currentTarget&&s()};return!n&&!e&&!t?null:c.jsx("div",{className:"explanation-modal-backdrop",onClick:i,children:c.jsxs("div",{className:"explanation-modal",ref:r,children:[c.jsxs("header",{className:"explanation-modal-header",children:[c.jsx("h2",{className:"explanation-modal-title",children:"Why this recommendation?"}),c.jsx("button",{className:"explanation-modal-close",onClick:s,children:c.jsx(an,{size:20})})]}),e&&c.jsxs("div",{className:"explanation-modal-loading",children:[c.jsx("div",{className:"explanation-spinner"}),c.jsx("p",{children:"Analyzing recommendation..."})]}),t&&c.jsx("div",{className:"explanation-modal-error",children:c.jsx("p",{children:t})}),n&&!e&&c.jsxs("div",{className:"explanation-modal-content",children:[c.jsxs("div",{className:"explanation-track-info",children:[c.jsx("div",{className:"explanation-track-artwork",children:(o=n.track.artwork)!=null&&o.medium?c.jsx("img",{src:n.track.artwork.medium,alt:n.track.title}):c.jsx("div",{className:"explanation-track-artwork-placeholder",children:c.jsx(qe,{size:32})})}),c.jsxs("div",{className:"explanation-track-details",children:[c.jsx("h3",{className:"explanation-track-title",children:n.track.title}),c.jsx("p",{className:"explanation-track-artist",children:n.track.artists.map(a=>a.name).join(", ")})]}),c.jsxs("div",{className:"explanation-score-badge",children:[c.jsx("span",{className:"explanation-score-value",children:n.score}),c.jsx("span",{className:"explanation-score-label",children:"match"})]})]}),c.jsx("div",{className:"explanation-summary",children:c.jsx("p",{children:n.summary})}),c.jsxs("div",{className:"explanation-factors",children:[c.jsx("h4",{className:"explanation-factors-title",children:"Scoring Factors"}),c.jsx("div",{className:"explanation-factors-list",children:n.factors.map(a=>c.jsx(mde,{factor:a},a.id))})]})]})]})})},mde=({factor:n})=>{const e=`factor-impact-${n.impact}`;return c.jsxs("div",{className:`explanation-factor ${e}`,children:[c.jsx("div",{className:"explanation-factor-icon",children:n.icon}),c.jsxs("div",{className:"explanation-factor-content",children:[c.jsxs("div",{className:"explanation-factor-header",children:[c.jsx("span",{className:"explanation-factor-label",children:n.label}),c.jsxs("span",{className:"explanation-factor-value",children:[n.value,"%"]})]}),c.jsx("div",{className:"explanation-factor-bar",children:c.jsx("div",{className:"explanation-factor-bar-fill",style:{width:`${n.value}%`}})}),c.jsx("p",{className:"explanation-factor-description",children:n.description})]})]})},dM=j.createContext(null);function gde(){const n=j.useContext(dM);if(!n)throw new Error("useExplanationContext must be used within RecommendationExplanationProvider");return n}const xde=({children:n})=>{const[e,t]=j.useState(!1),[s,r]=j.useState(null),{explanation:i,isLoading:o,error:a,fetchExplanation:l,clearExplanation:u}=fde(),d=j.useCallback(async g=>{r(g),t(!0),await l(g)},[l]),f=j.useCallback(()=>{t(!1),r(null),u()},[u]),p={showExplanation:d,hideExplanation:f,isVisible:e,currentTrack:s};return c.jsxs(dM.Provider,{value:p,children:[n,e&&c.jsx(pde,{explanation:i,isLoading:o,error:a,onClose:f})]})},yde=({track:n,className:e="",size:t="small"})=>{const{showExplanation:s}=gde(),r=i=>{i.stopPropagation(),s(n)};return c.jsx("button",{className:`why-button why-button-${t} ${e}`,onClick:r,title:"Why was this recommended?",children:"?"})},ln=({track:n,onClick:e,onContextMenu:t,style:s})=>{var x,y,b,k;const{currentTrack:r,isPlaying:i}=Ke(),{isLiked:o,toggleLike:a}=Xt(),l=(r==null?void 0:r.id)===n.id,u=o(n.id),d=((x=n.artwork)==null?void 0:x.medium)??((b=(y=n.album)==null?void 0:y.artwork)==null?void 0:b.medium),f=((k=n.artists)==null?void 0:k.map(w=>w.name).join(", "))??"Unknown Artist",p=w=>{w.stopPropagation(),a(n)},g=w=>{t&&t(w,n)};return c.jsxs("div",{className:`track-card ${l?"playing":""}`,onClick:e,onContextMenu:g,style:s,children:[c.jsx(yde,{track:n}),c.jsxs("div",{className:"track-card-artwork",children:[d?c.jsx("img",{src:d,alt:n.title,loading:"lazy"}):c.jsx("div",{className:"track-card-artwork-placeholder",children:c.jsx(qe,{size:48})}),c.jsx("div",{className:"track-card-overlay",children:c.jsx("button",{className:"track-card-play",children:l&&i?c.jsx(gd,{size:24}):c.jsx(Et,{size:24})})})]}),c.jsxs("div",{className:"track-card-info",children:[c.jsx("div",{className:"track-card-title",children:n.title}),c.jsx("div",{className:"track-card-artist",children:f})]}),c.jsx("button",{className:`track-card-like ${u?"liked":""}`,onClick:p,title:u?"Remove from Liked Songs":"Add to Liked Songs",children:u?c.jsx(Sc,{size:16}):c.jsx(ic,{size:16})})]})},hM=({title:n,subtitle:e,tracks:t,artists:s,albums:r,isLoading:i,onSeeAll:o})=>{const{play:a,setQueue:l}=Ke(),{openArtist:u,openAlbum:d}=Wt(),{showContextMenu:f}=pt(),{showContextMenu:p}=mx(),{showContextMenu:g}=Fh(),x=(w,N)=>{t&&(l(t,N),a(w))},y=w=>{u(w.id,w)},b=w=>{d(w.id,w)},k=t&&t.length>0||s&&s.length>0||r&&r.length>0;return!i&&!k?null:c.jsxs("section",{className:"discover-horizontal-section",children:[c.jsxs("div",{className:"discover-section-header",children:[c.jsxs("div",{className:"discover-section-title-row",children:[c.jsx("h2",{className:"discover-section-title",children:n}),e&&c.jsx("span",{className:"discover-section-subtitle",children:e})]}),o&&c.jsx("button",{className:"discover-section-more",onClick:o,children:"See all"})]}),i?c.jsx("div",{className:"discover-horizontal-scroll",children:[1,2,3,4,5,6].map(w=>c.jsx("div",{className:"discover-card-skeleton"},w))}):c.jsxs("div",{className:"discover-horizontal-scroll",children:[t==null?void 0:t.map((w,N)=>c.jsx(ln,{track:w,onClick:()=>x(w,N),onContextMenu:f},w.id)),s==null?void 0:s.map(w=>c.jsxs("div",{className:"artist-card",onClick:()=>y(w),onContextMenu:N=>p(N,w),children:[c.jsx("div",{className:"artist-card-image",children:w.image?c.jsx("img",{src:w.image,alt:w.name}):c.jsx("div",{className:"artist-card-placeholder",children:c.jsx(qe,{size:32})})}),c.jsx("div",{className:"artist-card-name",children:w.name}),c.jsx("div",{className:"artist-card-type",children:"Artist"})]},w.id)),r==null?void 0:r.map(w=>c.jsxs("div",{className:"album-card",onClick:()=>b(w),onContextMenu:N=>g(N,w),children:[c.jsx("div",{className:"album-card-image",children:w.artwork?c.jsx("img",{src:w.artwork,alt:w.title}):c.jsx("div",{className:"album-card-placeholder",children:c.jsx(qe,{size:32})})}),c.jsx("div",{className:"album-card-title",children:w.title}),c.jsx("div",{className:"album-card-artist",children:w.artist})]},w.id))]})]})},fM=({id:n,title:e,subtitle:t,query:s,embedding:r,onSeeAll:i,maxItems:o=12})=>{const{tracks:a,isLoading:l,source:u}=rk(s,{limit:o,embedding:r});return u!=="none"&&a.length>0&&(`${e}${u}${a.length}`,void 0),c.jsx(hM,{id:n,title:e,subtitle:t,tracks:a,isLoading:l,onSeeAll:i})},vde=({title:n,subtitle:e,tracks:t=[],isLoading:s,maxItems:r=6})=>{const{play:i,setQueue:o,currentTrack:a,isPlaying:l}=Ke(),{showContextMenu:u}=pt(),d=(t==null?void 0:t.slice(0,r))??[],f=(p,g)=>{o(d,g),i(p)};return!s&&(!t||t.length===0)?null:c.jsxs("section",{className:"discover-large-card-section",children:[c.jsx("div",{className:"discover-section-header",children:c.jsxs("div",{className:"discover-section-title-row",children:[c.jsx("h2",{className:"discover-section-title",children:n}),e&&c.jsx("span",{className:"discover-section-subtitle",children:e})]})}),s?c.jsx("div",{className:"large-card-grid",children:[1,2,3].map(p=>c.jsx("div",{className:"large-card-skeleton"},p))}):c.jsx("div",{className:"large-card-grid",children:d.map((p,g)=>{var b,k,w,N;const x=(a==null?void 0:a.id)===p.id,y=((b=p.artwork)==null?void 0:b.medium)??((w=(k=p.album)==null?void 0:k.artwork)==null?void 0:w.medium);return c.jsxs("div",{className:`large-track-card ${x?"playing":""}`,onClick:()=>f(p,g),onContextMenu:C=>u(C,p),children:[c.jsxs("div",{className:"large-track-artwork",children:[y?c.jsx("img",{src:y,alt:p.title}):c.jsx("div",{className:"large-track-placeholder",children:c.jsx(qe,{size:48})}),c.jsx("div",{className:"large-track-overlay",children:c.jsx("button",{className:"large-track-play",children:x&&l?c.jsx(gd,{size:28}):c.jsx(Et,{size:28})})}),x&&l&&c.jsxs("div",{className:"large-track-playing-badge",children:[c.jsx("span",{className:"playing-bar"}),c.jsx("span",{className:"playing-bar"}),c.jsx("span",{className:"playing-bar"})]})]}),c.jsxs("div",{className:"large-track-info",children:[c.jsx("h3",{className:"large-track-title",children:p.title}),c.jsx("p",{className:"large-track-artist",children:p.artists.map(C=>C.name).join(", ")}),((N=p.album)==null?void 0:N.releaseDate)&&c.jsx("span",{className:"large-track-year",children:p.album.releaseDate.substring(0,4)})]})]},p.id)})})]})},bde=({id:n,title:e,subtitle:t,query:s,embedding:r,maxItems:i=6})=>{const{tracks:o,isLoading:a,source:l}=rk(s,{limit:i,embedding:r});return l!=="none"&&o.length>0&&(`${e}${l}${o.length}`,void 0),c.jsx(vde,{id:n,title:e,subtitle:t,tracks:o,isLoading:a,maxItems:i})},wde=({title:n,tracks:e=[],isLoading:t,maxItems:s=5})=>{const{play:r,setQueue:i,currentTrack:o,isPlaying:a}=Ke(),{showContextMenu:l}=pt(),u=(e==null?void 0:e.slice(0,s))??[],d=(p,g)=>{i(u,g),r(p)},f=p=>{if(!p)return"--:--";const g=Math.floor(p/60),x=Math.floor(p%60);return`${g}:${x.toString().padStart(2,"0")}`};return!t&&(!e||e.length===0)?null:c.jsxs("section",{className:"discover-compact-section",children:[c.jsx("h2",{className:"discover-section-title",children:n}),t?c.jsx("div",{className:"compact-list-loading",children:[1,2,3,4,5].map(p=>c.jsx("div",{className:"compact-track-skeleton"},p))}):c.jsx("div",{className:"compact-list",children:u.map((p,g)=>{var y;const x=(o==null?void 0:o.id)===p.id;return c.jsxs("div",{className:`compact-track-item ${x?"playing":""}`,onClick:()=>d(p,g),onContextMenu:b=>l(b,p),children:[c.jsxs("div",{className:"compact-track-artwork",children:[(y=p.artwork)!=null&&y.small?c.jsx("img",{src:p.artwork.small,alt:p.title}):c.jsx("div",{className:"compact-track-placeholder",children:c.jsx(qe,{size:16})}),c.jsx("div",{className:"compact-track-play-overlay",children:x&&a?c.jsxs("div",{className:"compact-playing-indicator",children:[c.jsx("span",{className:"playing-bar"}),c.jsx("span",{className:"playing-bar"}),c.jsx("span",{className:"playing-bar"})]}):c.jsx(Et,{size:14})})]}),c.jsxs("div",{className:"compact-track-info",children:[c.jsx("span",{className:"compact-track-title",children:p.title}),c.jsx("span",{className:"compact-track-artist",children:p.artists.map(b=>b.name).join(", ")})]}),c.jsx("span",{className:"compact-track-duration",children:f(p.duration)})]},p.id)})})]})},kde=({title:n,subtitle:e,tracks:t,isLoading:s,isPersonalized:r,maxItems:i=8,onSeeAll:o})=>{const{play:a,setQueue:l}=Ke(),{showContextMenu:u}=pt(),d=(t==null?void 0:t.slice(0,i))||[],f=(p,g)=>{l(d,g),a(p)};return!s&&(!t||t.length===0)?null:c.jsxs("section",{className:`discover-section ${r?"personalized":""}`,children:[c.jsxs("div",{className:"discover-section-header",children:[c.jsxs("div",{className:"discover-section-title-row",children:[c.jsx("h2",{className:"discover-section-title",children:n}),e&&c.jsx("span",{className:"discover-section-subtitle",children:e})]}),o&&c.jsx("button",{className:"discover-section-more",onClick:o,children:"See all"})]}),s?c.jsx("div",{className:"discover-section-loading",children:c.jsx("div",{className:"discover-loading-cards",children:[1,2,3,4].map(p=>c.jsx("div",{className:"track-card skeleton",style:{animationDelay:`${p*100}ms`}},p))})}):c.jsx("div",{className:"discover-section-grid",children:d.map((p,g)=>c.jsx(ln,{track:p,onClick:()=>f(p,g),onContextMenu:u,style:{animationDelay:`${g*50}ms`}},p.id))})]})},Cde=({id:n,title:e,subtitle:t,query:s,onSeeAll:r,isPersonalized:i,maxItems:o=12})=>{const{play:a,setQueue:l}=Ke(),{showContextMenu:u}=pt(),d={strategy:"plugin",sectionType:"trending-tracks",title:e||"Trending Songs",subtitle:t,search:s?{query:s}:void 0,limit:o},{tracks:f,isLoading:p}=Vt(d,{enabled:!0,applyMLRanking:!0,applyTransformers:!0,limit:o}),g=(y,b)=>{l(f,b),a(y)},x=!p&&f.length===0;return c.jsxs("section",{id:n,className:"discover-horizontal-section discover-trending-section",children:[c.jsxs("div",{className:"discover-section-header",children:[c.jsxs("div",{className:"discover-section-title-row",children:[c.jsx("h2",{className:"discover-section-title",children:e}),t&&c.jsx("span",{className:"discover-section-subtitle",children:t})]}),r&&c.jsx("button",{className:"discover-section-more",onClick:r,children:"See all"})]}),p?c.jsx("div",{className:"discover-horizontal-scroll",children:[1,2,3,4,5,6].map(y=>c.jsx("div",{className:"discover-card-skeleton"},y))}):x?c.jsx("div",{className:"discover-empty-state",children:c.jsx("p",{children:"Unable to load trending tracks"})}):c.jsx("div",{className:"discover-horizontal-scroll",children:f.map((y,b)=>c.jsx(ln,{track:y,onClick:()=>g(y,b),onContextMenu:u},y.id))})]})},Sde=({id:n,title:e,subtitle:t,onSeeAll:s,maxItems:r=10})=>{const[i,o]=j.useState([]),[a,l]=j.useState(!0),{openArtist:u}=Wt(),{showContextMenu:d}=mx();j.useEffect(()=>{let p=!0;return(async()=>{var x,y,b,k,w,N;l(!0);try{if((x=window.api)!=null&&x.getTrending){const C=await window.api.getTrending();if(p&&((y=C==null?void 0:C.artists)==null?void 0:y.length)>0){const S=C.artists.slice(0,r).map(T=>{var A,E;return{id:T.id,name:T.name,image:((A=T.artwork)==null?void 0:A.medium)||((E=T.artwork)==null?void 0:E.small),source:"trending"}});o(S),l(!1);return}}if((b=window.api)!=null&&b.search){const C=await window.api.search({query:"top hits 2024 popular",type:"track"});if(p&&(C==null?void 0:C.length)>0){const S=new Map;for(const T of C){for(const A of T.artists)if(S.has(A.id)||S.set(A.id,{id:A.id,name:A.name,image:((k=A.artwork)==null?void 0:k.medium)||((w=A.artwork)==null?void 0:w.small),source:((N=T._meta)==null?void 0:N.metadataProvider)||"search"}),S.size>=r)break;if(S.size>=r)break}o(Array.from(S.values()))}}}catch(C){Lh("[TrendingArtistsSection]","Failed to fetch:",C)}finally{p&&l(!1)}})(),()=>{p=!1}},[r]);const f=p=>{u(p.id,{id:p.id,name:p.name,image:p.image,source:p.source})};return!a&&i.length===0?null:c.jsxs("section",{id:n,className:"discover-horizontal-section discover-trending-artists-section",children:[c.jsxs("div",{className:"discover-section-header",children:[c.jsxs("div",{className:"discover-section-title-row",children:[c.jsx("h2",{className:"discover-section-title",children:e}),t&&c.jsx("span",{className:"discover-section-subtitle",children:t})]}),s&&c.jsx("button",{className:"discover-section-more",onClick:s,children:"See all"})]}),a?c.jsx("div",{className:"discover-horizontal-scroll",children:[1,2,3,4,5,6].map(p=>c.jsx("div",{className:"artist-card-skeleton circular"},p))}):c.jsx("div",{className:"discover-horizontal-scroll",children:i.map(p=>c.jsxs("div",{className:"artist-card circular",onClick:()=>f(p),onContextMenu:g=>d(g,{id:p.id,name:p.name,image:p.image,source:p.source}),children:[c.jsx("div",{className:"artist-card-image",children:p.image?c.jsx("img",{src:p.image,alt:p.name}):c.jsx("div",{className:"artist-card-placeholder",children:c.jsx(qe,{size:32})})}),c.jsx("div",{className:"artist-card-name",children:p.name}),c.jsx("div",{className:"artist-card-type",children:"Artist"})]},p.id))})]})},Nde=({id:n,title:e,subtitle:t,context:s,onSeeAll:r,maxItems:i=10})=>{var S,T;const{play:o,setQueue:a}=Ke(),{showContextMenu:l}=pt(),u=((S=s==null?void 0:s.topArtists)==null?void 0:S.length)||0,d=Math.floor(Date.now()/(1e3*60*60*24)),f=u>0?d%u:0,p=(T=s==null?void 0:s.topArtists)==null?void 0:T[f],g=p==null?void 0:p.toLowerCase().replace(/\s+/g,"-"),x=p||"",y=j.useMemo(()=>({strategy:"plugin",sectionType:"artist-radio",title:e||`More like ${x}`,subtitle:t||"Based on your listening",embedding:{method:"artist-radio",seedArtistId:g||"",artistName:x,exploration:.3},limit:i}),[e,t,x,g,i]),{tracks:b,isLoading:k}=Vt(y,{enabled:!!g,applyMLRanking:!0,applyTransformers:!0,limit:i}),w=(A,E)=>{a(b,E),o(A)};if(!x||!k&&b.length===0)return null;const N=e||`More like ${x}`,C=t||"Based on your listening";return c.jsxs("section",{id:n,className:"discover-horizontal-section discover-artist-radio-section",children:[c.jsxs("div",{className:"discover-section-header",children:[c.jsxs("div",{className:"discover-section-title-row",children:[c.jsx("h2",{className:"discover-section-title",children:N}),c.jsx("span",{className:"discover-section-subtitle",children:C})]}),r&&c.jsx("button",{className:"discover-section-more",onClick:r,children:"See all"})]}),k?c.jsx("div",{className:"discover-horizontal-scroll",children:[1,2,3,4,5,6].map(A=>c.jsx("div",{className:"discover-card-skeleton"},A))}):c.jsx("div",{className:"discover-horizontal-scroll",children:b.map((A,E)=>c.jsx(ln,{track:A,onClick:()=>w(A,E),onContextMenu:l},A.id))})]})},pM=({id:n,title:e,context:t,onSeeAll:s,artistIndex:r=0,maxItems:i=8})=>{var C,S;const{play:o,setQueue:a}=Ke(),{showContextMenu:l}=pt(),u=((C=t==null?void 0:t.topArtists)==null?void 0:C.length)||0,d=Math.floor(Date.now()/(1e3*60*60*24)),f=u>0?(d+r)%u:r,p=(S=t==null?void 0:t.topArtists)==null?void 0:S[f],g=p==null?void 0:p.toLowerCase().replace(/\s+/g,"-"),x=p||"",y=g?{strategy:"plugin",sectionType:"because-you-like",title:e||`Because you like ${x}`,embedding:{method:"artist-radio",seedArtistId:g,artistName:x,exploration:.3,includeCollaborative:!0},limit:i}:null,{tracks:b,isLoading:k}=Vt(y,{enabled:!!g,applyMLRanking:!0,applyTransformers:!0,limit:i}),w=(T,A)=>{a(b,A),o(T)};if(!x||!k&&b.length===0)return null;const N=e||`Because you like ${x}`;return c.jsxs("section",{id:n,className:"discover-horizontal-section discover-because-you-like-section",children:[c.jsxs("div",{className:"discover-section-header",children:[c.jsx("div",{className:"discover-section-title-row",children:c.jsx("h2",{className:"discover-section-title",children:N})}),s&&c.jsx("button",{className:"discover-section-more",onClick:s,children:"See all"})]}),k?c.jsx("div",{className:"discover-horizontal-scroll",children:[1,2,3,4,5].map(T=>c.jsx("div",{className:"discover-card-skeleton"},T))}):c.jsx("div",{className:"discover-horizontal-scroll",children:b.map((T,A)=>c.jsx(ln,{track:T,onClick:()=>w(T,A),onContextMenu:l},T.id))})]})},Ide=({id:n,title:e,subtitle:t,context:s,onSeeAll:r,maxItems:i=10})=>{const[o,a]=j.useState([]),[l,u]=j.useState(!0),{openAlbum:d}=Wt(),{showContextMenu:f}=Fh();j.useEffect(()=>{let g=!0;return(async()=>{var y,b,k,w,N,C;u(!0);try{if((y=window.api)!=null&&y.search){const S=(b=s==null?void 0:s.topGenres)==null?void 0:b[0],T=S?`${S} new releases 2024`:"new releases 2024 popular",A=await window.api.search({query:T,type:"album"});if(g&&(A==null?void 0:A.length)>0){const E=new Map;for(const M of A){const P=M;if(P.id&&!E.has(P.id)&&E.set(P.id,{id:P.id,title:P.title,artist:((w=(k=P.artists)==null?void 0:k[0])==null?void 0:w.name)||"Unknown Artist",artwork:((N=P.artwork)==null?void 0:N.medium)||((C=P.artwork)==null?void 0:C.small),year:P.releaseDate?parseInt(P.releaseDate.substring(0,4)):void 0,source:"search"}),E.size>=i)break}a(Array.from(E.values()))}}}catch(S){Lh("[NewReleasesSection]","Failed to fetch:",S)}finally{g&&u(!1)}})(),()=>{g=!1}},[s==null?void 0:s.topGenres,i]);const p=g=>{d(g.id,{id:g.id,title:g.title,artist:g.artist,artwork:g.artwork,year:g.year,source:g.source})};return!l&&o.length===0?null:c.jsxs("section",{id:n,className:"discover-horizontal-section discover-new-releases-section",children:[c.jsxs("div",{className:"discover-section-header",children:[c.jsxs("div",{className:"discover-section-title-row",children:[c.jsx("h2",{className:"discover-section-title",children:e}),t&&c.jsx("span",{className:"discover-section-subtitle",children:t})]}),r&&c.jsx("button",{className:"discover-section-more",onClick:r,children:"See all"})]}),l?c.jsx("div",{className:"discover-horizontal-scroll",children:[1,2,3,4,5,6].map(g=>c.jsx("div",{className:"album-card-skeleton"},g))}):c.jsx("div",{className:"discover-horizontal-scroll",children:o.map(g=>c.jsxs("div",{className:"album-card",onClick:()=>p(g),onContextMenu:x=>f(x,{id:g.id,title:g.title,artist:g.artist,artwork:g.artwork,year:g.year,source:g.source}),children:[c.jsxs("div",{className:"album-card-image",children:[g.artwork?c.jsx("img",{src:g.artwork,alt:g.title}):c.jsx("div",{className:"album-card-placeholder",children:c.jsx(qe,{size:32})}),g.year&&g.year>=new Date().getFullYear()&&c.jsx("span",{className:"album-new-badge",children:"NEW"})]}),c.jsx("div",{className:"album-card-title",children:g.title}),c.jsx("div",{className:"album-card-artist",children:g.artist})]},g.id))})]})},Tde=({id:n,title:e,subtitle:t,query:s,onSeeAll:r,maxItems:i=10})=>{const[o,a]=j.useState([]),[l,u]=j.useState(!0),{play:d,setQueue:f,currentTrack:p,isPlaying:g}=Ke(),{showContextMenu:x}=pt();j.useEffect(()=>{let w=!0;return(async()=>{var C,S,T;u(!0);try{if((C=window.api)!=null&&C.getTrending){const A=await window.api.getTrending();if(w&&((S=A==null?void 0:A.tracks)==null?void 0:S.length)>0){const E=A.tracks.slice(0,i).map(M=>({...M,streamSources:[],_meta:{metadataProvider:M._provider||"chart",matchConfidence:1,externalIds:M.externalIds||{},lastUpdated:new Date}}));a(E),u(!1);return}}if((T=window.api)!=null&&T.search){const A=s||"chart top 50 2024",E=await window.api.search({query:A,type:"track"});w&&a((E||[]).slice(0,i))}}catch(A){Lh("[ChartListSection]","Failed to fetch:",A)}finally{w&&u(!1)}})(),()=>{w=!1}},[s,i]);const y=(w,N)=>{f(o,N),d(w)},b=w=>{if(!w)return"--:--";const N=Math.floor(w/60),C=Math.floor(w%60);return`${N}:${C.toString().padStart(2,"0")}`},k=!l&&o.length===0;return c.jsxs("section",{id:n,className:"chart-list-section",children:[c.jsxs("div",{className:"discover-section-header",children:[c.jsxs("div",{className:"discover-section-title-row",children:[c.jsx("h2",{className:"discover-section-title",children:e}),t&&c.jsx("span",{className:"discover-section-subtitle",children:t})]}),r&&c.jsx("button",{className:"discover-section-more",onClick:r,children:"See all"})]}),l?c.jsx("div",{className:"chart-list",children:Array.from({length:i}).map((w,N)=>c.jsxs("div",{className:"chart-item-skeleton",children:[c.jsx("div",{className:"skeleton-rank"}),c.jsx("div",{className:"skeleton-artwork"}),c.jsxs("div",{className:"skeleton-info",children:[c.jsx("div",{className:"skeleton-title"}),c.jsx("div",{className:"skeleton-artist"})]})]},N))}):k?c.jsx("div",{className:"discover-empty-state",children:c.jsx("p",{children:"Unable to load chart data"})}):c.jsx("div",{className:"chart-list",children:o.map((w,N)=>{var A,E,M;const C=(p==null?void 0:p.id)===w.id,S=C&&g,T=((A=w.artwork)==null?void 0:A.small)||((M=(E=w.album)==null?void 0:E.artwork)==null?void 0:M.small);return c.jsxs("div",{className:`chart-item ${C?"playing":""}`,onClick:()=>y(w,N),onContextMenu:P=>x(P,w),children:[c.jsx("span",{className:"chart-rank",children:N+1}),c.jsxs("div",{className:"chart-artwork",children:[T?c.jsx("img",{src:T,alt:w.title,loading:"lazy"}):c.jsx("div",{className:"chart-artwork-placeholder",children:c.jsx(qe,{size:20})}),S&&c.jsxs("div",{className:"chart-playing-indicator",children:[c.jsx("span",{className:"bar"}),c.jsx("span",{className:"bar"}),c.jsx("span",{className:"bar"})]})]}),c.jsxs("div",{className:"chart-info",children:[c.jsxs("div",{className:"chart-title",children:[w.title,w.explicit&&c.jsx("span",{className:"chart-explicit",children:"E"})]}),c.jsx("div",{className:"chart-artist",children:w.artists.map(P=>P.name).join(", ")})]}),c.jsx("span",{className:"chart-duration",children:b(w.duration)})]},w.id)})})]})},$de=({id:n,title:e,context:t,maxItems:s=6})=>{const{play:r,setQueue:i,currentTrack:o,isPlaying:a}=Ke(),{showContextMenu:l}=pt(),u=j.useMemo(()=>({strategy:"plugin",sectionType:"quick-picks",title:e||"Quick Picks",embedding:{method:"personalized",exploration:.1},limit:s}),[e,s]),{tracks:d,isLoading:f}=Vt(u,{enabled:!0,applyMLRanking:!0,applyTransformers:!0,limit:s}),p=(x,y)=>{i(d,y),r(x)};return!f&&d.length===0?null:c.jsxs("section",{id:n,className:"quick-picks-section",children:[e&&c.jsx("div",{className:"discover-section-header",children:c.jsx("h2",{className:"discover-section-title",children:e})}),f?c.jsx("div",{className:"quick-picks-grid",children:Array.from({length:s}).map((x,y)=>c.jsx("div",{className:"quick-pick-skeleton"},y))}):c.jsx("div",{className:"quick-picks-grid",children:d.map((x,y)=>{var N,C,S;const b=(o==null?void 0:o.id)===x.id,k=b&&a,w=((N=x.artwork)==null?void 0:N.small)||((S=(C=x.album)==null?void 0:C.artwork)==null?void 0:S.small);return c.jsxs("div",{className:`quick-pick-tile ${b?"playing":""}`,onClick:()=>p(x,y),onContextMenu:T=>l(T,x),children:[c.jsxs("div",{className:"quick-pick-artwork",children:[w?c.jsx("img",{src:w,alt:x.title,loading:"lazy"}):c.jsx("div",{className:"quick-pick-artwork-placeholder",children:c.jsx(qe,{size:20})}),k&&c.jsxs("div",{className:"quick-pick-playing",children:[c.jsx("span",{className:"bar"}),c.jsx("span",{className:"bar"}),c.jsx("span",{className:"bar"})]})]}),c.jsx("div",{className:"quick-pick-info",children:c.jsx("span",{className:"quick-pick-title",children:x.title})})]},x.id)})})]})},Ede=({id:n,title:e,subtitle:t,isPersonalized:s,context:r,artist:i,artistName:o})=>{const{play:a,setQueue:l,currentTrack:u,isPlaying:d}=Ke(),{openArtist:f}=Wt(),{showContextMenu:p}=pt(),{getTopArtists:g}=dn(),[x,y]=j.useState(i??null),[b,k]=j.useState(!i),[w,N]=j.useState(null),C=o??g(1)[0];j.useEffect(()=>{if(i||!C)return;(async()=>{var M,P;k(!0),N(null);try{if(window.api){const L=(await window.api.search({query:C,type:"track"})).filter(O=>O.artists.some(U=>U.name.toLowerCase().includes(C.toLowerCase()))).slice(0,5),_=L[0];if(_&&L.length>0){const O=_.artists[0];O&&y({id:O.id||C.toLowerCase().replace(/\s+/g,"-"),name:O.name,image:((M=_.artwork)==null?void 0:M.large)??((P=_.artwork)==null?void 0:P.medium),topTracks:L,relatedArtists:[]})}}}catch(R){Lh("[ArtistSpotlight]","Failed to fetch artist:",R),N("Failed to load artist")}finally{k(!1)}})()},[i,C]);const S=E=>{x&&(l(x.topTracks,x.topTracks.indexOf(E)),a(E))},T=()=>{const E=x==null?void 0:x.topTracks[0];!x||!E||(l(x.topTracks,0),a(E))},A=()=>{x&&f(x.id,{id:x.id,name:x.name,image:x.image,source:"spotlight"})};return!b&&!x?null:c.jsx(Fs,{id:n,type:"artist-spotlight",title:e,subtitle:t,isPersonalized:s,isLoading:b,error:w,context:r,showHeader:!1,className:"artist-spotlight-section",children:x&&c.jsxs("div",{className:"spotlight-container",children:[c.jsxs("div",{className:"spotlight-hero",children:[c.jsxs("div",{className:"spotlight-image",children:[x.image?c.jsx("img",{src:x.image,alt:x.name}):c.jsx("div",{className:"spotlight-image-placeholder",children:c.jsx(Wp,{size:64})}),c.jsx("div",{className:"spotlight-image-gradient"})]}),c.jsxs("div",{className:"spotlight-info",children:[c.jsx("span",{className:"spotlight-label",children:"Artist Spotlight"}),c.jsx("h2",{className:"spotlight-name",children:x.name}),x.monthlyListeners&&c.jsxs("p",{className:"spotlight-listeners",children:[jde(x.monthlyListeners)," monthly listeners"]}),x.bio&&c.jsx("p",{className:"spotlight-bio",children:Dde(x.bio,150)}),c.jsxs("div",{className:"spotlight-actions",children:[c.jsxs("button",{className:"spotlight-play",onClick:T,children:[c.jsx(Et,{size:20}),c.jsx("span",{children:"Play"})]}),c.jsx("button",{className:"spotlight-view",onClick:A,children:"View Artist"})]})]})]}),c.jsxs("div",{className:"spotlight-tracks",children:[c.jsx("h3",{className:"spotlight-tracks-title",children:"Popular Tracks"}),c.jsx("div",{className:"spotlight-tracks-list",children:x.topTracks.map((E,M)=>c.jsx(Ade,{track:E,index:M,isPlaying:(u==null?void 0:u.id)===E.id&&d,onClick:()=>S(E),onContextMenu:P=>p(P,E)},E.id))})]}),x.relatedArtists&&x.relatedArtists.length>0&&c.jsxs("div",{className:"spotlight-related",children:[c.jsx("h3",{className:"spotlight-related-title",children:"Similar Artists"}),c.jsx("div",{className:"spotlight-related-list",children:x.relatedArtists.slice(0,4).map(E=>c.jsxs("div",{className:"related-artist",children:[c.jsx("div",{className:"related-artist-image",children:E.image?c.jsx("img",{src:E.image,alt:E.name}):c.jsx(Wp,{size:24})}),c.jsx("span",{className:"related-artist-name",children:E.name})]},E.id))})]})]})})},Ade=({track:n,index:e,isPlaying:t,onClick:s,onContextMenu:r})=>{var o;const i=(o=n.artwork)==null?void 0:o.small;return c.jsxs("div",{className:`spotlight-track ${t?"playing":""}`,onClick:s,onContextMenu:r,children:[c.jsx("span",{className:"track-number",children:e+1}),c.jsxs("div",{className:"track-artwork",children:[i?c.jsx("img",{src:i,alt:n.title}):c.jsx(qe,{size:16}),t&&c.jsxs("div",{className:"track-playing",children:[c.jsx("span",{className:"playing-bar"}),c.jsx("span",{className:"playing-bar"}),c.jsx("span",{className:"playing-bar"})]})]}),c.jsx("div",{className:"track-info",children:c.jsx("span",{className:"track-title",children:n.title})}),c.jsx("span",{className:"track-duration",children:Rde(n.duration)})]})};function jde(n){return n>=1e6?(n/1e6).toFixed(1)+"M":n>=1e3?(n/1e3).toFixed(1)+"K":n.toString()}function Rde(n){const e=Math.floor(n/60),t=n%60;return`${e}:${t.toString().padStart(2,"0")}`}function Dde(n,e){return n.length<=e?n:n.slice(0,e).trim()+"..."}const Ts={rock:"var(--color-genre-rock)",pop:"var(--color-genre-pop)",hiphop:"var(--color-genre-hiphop)",electronic:"var(--color-genre-electronic)",rnb:"var(--color-genre-rnb)",jazz:"var(--color-genre-jazz)",classical:"var(--color-genre-classical)",country:"var(--color-genre-country)",latin:"var(--color-genre-latin)",metal:"var(--color-genre-metal)",folk:"var(--color-genre-folk)",blues:"var(--color-genre-blues)",reggae:"var(--color-genre-reggae)",world:"var(--color-genre-world)",ambient:"var(--color-genre-ambient)"},Pde={root:[{id:"pop",name:"Pop",color:Ts.pop,searchQuery:"pop music",children:[{id:"synth-pop",name:"Synth Pop",color:"#a855f7",searchQuery:"synth pop"},{id:"dance-pop",name:"Dance Pop",color:"#c084fc",searchQuery:"dance pop"},{id:"indie-pop",name:"Indie Pop",color:"#d8b4fe",searchQuery:"indie pop"},{id:"k-pop",name:"K-Pop",color:"#e879f9",searchQuery:"k-pop"},{id:"j-pop",name:"J-Pop",color:"#f0abfc",searchQuery:"j-pop"},{id:"art-pop",name:"Art Pop",color:"#f5d0fe",searchQuery:"art pop"}]},{id:"rock",name:"Rock",color:Ts.rock,searchQuery:"rock music",children:[{id:"indie-rock",name:"Indie Rock",color:"#ef4444",searchQuery:"indie rock"},{id:"alt-rock",name:"Alternative",color:"#dc2626",searchQuery:"alternative rock"},{id:"classic-rock",name:"Classic Rock",color:"#b91c1c",searchQuery:"classic rock"},{id:"punk-rock",name:"Punk",color:"#991b1b",searchQuery:"punk rock"},{id:"prog-rock",name:"Progressive",color:"#7f1d1d",searchQuery:"progressive rock"},{id:"garage-rock",name:"Garage",color:"#fca5a5",searchQuery:"garage rock"}]},{id:"hiphop",name:"Hip Hop",color:Ts.hiphop,searchQuery:"hip hop music",children:[{id:"trap",name:"Trap",color:"#f59e0b",searchQuery:"trap music"},{id:"boom-bap",name:"Boom Bap",color:"#d97706",searchQuery:"boom bap"},{id:"conscious",name:"Conscious",color:"#b45309",searchQuery:"conscious hip hop"},{id:"drill",name:"Drill",color:"#92400e",searchQuery:"drill music"},{id:"lo-fi-hiphop",name:"Lo-Fi Hip Hop",color:"#fbbf24",searchQuery:"lo-fi hip hop"},{id:"old-school",name:"Old School",color:"#fcd34d",searchQuery:"old school hip hop"}]},{id:"electronic",name:"Electronic",color:Ts.electronic,searchQuery:"electronic music",children:[{id:"house",name:"House",color:"#06b6d4",searchQuery:"house music"},{id:"techno",name:"Techno",color:"#0891b2",searchQuery:"techno"},{id:"edm",name:"EDM",color:"#0e7490",searchQuery:"edm"},{id:"dubstep",name:"Dubstep",color:"#155e75",searchQuery:"dubstep"},{id:"dnb",name:"Drum & Bass",color:"#164e63",searchQuery:"drum and bass"},{id:"trance",name:"Trance",color:"#22d3ee",searchQuery:"trance music"},{id:"ambient-electronic",name:"Ambient",color:"#67e8f9",searchQuery:"ambient electronic"}]},{id:"rnb",name:"R&B / Soul",color:Ts.rnb,searchQuery:"r&b soul music",children:[{id:"contemporary-rnb",name:"Contemporary R&B",color:"#ec4899",searchQuery:"contemporary r&b"},{id:"neo-soul",name:"Neo Soul",color:"#db2777",searchQuery:"neo soul"},{id:"classic-soul",name:"Classic Soul",color:"#be185d",searchQuery:"classic soul"},{id:"funk",name:"Funk",color:"#9d174d",searchQuery:"funk music"},{id:"motown",name:"Motown",color:"#f472b6",searchQuery:"motown"}]},{id:"jazz",name:"Jazz",color:Ts.jazz,searchQuery:"jazz music",children:[{id:"smooth-jazz",name:"Smooth Jazz",color:"#3b82f6",searchQuery:"smooth jazz"},{id:"bebop",name:"Bebop",color:"#2563eb",searchQuery:"bebop jazz"},{id:"fusion",name:"Fusion",color:"#1d4ed8",searchQuery:"jazz fusion"},{id:"vocal-jazz",name:"Vocal Jazz",color:"#1e40af",searchQuery:"vocal jazz"},{id:"free-jazz",name:"Free Jazz",color:"#60a5fa",searchQuery:"free jazz"}]},{id:"classical",name:"Classical",color:Ts.classical,searchQuery:"classical music",children:[{id:"orchestral",name:"Orchestral",color:"#a855f7",searchQuery:"orchestral classical"},{id:"chamber",name:"Chamber",color:"#9333ea",searchQuery:"chamber music"},{id:"piano",name:"Piano",color:"#7c3aed",searchQuery:"classical piano"},{id:"opera",name:"Opera",color:"#6d28d9",searchQuery:"opera"},{id:"modern-classical",name:"Modern",color:"#c084fc",searchQuery:"modern classical"}]},{id:"country",name:"Country",color:Ts.country,searchQuery:"country music",children:[{id:"modern-country",name:"Modern Country",color:"#ea580c",searchQuery:"modern country"},{id:"classic-country",name:"Classic Country",color:"#c2410c",searchQuery:"classic country"},{id:"country-rock",name:"Country Rock",color:"#9a3412",searchQuery:"country rock"},{id:"americana",name:"Americana",color:"#fb923c",searchQuery:"americana"},{id:"bluegrass",name:"Bluegrass",color:"#fdba74",searchQuery:"bluegrass"}]},{id:"latin",name:"Latin",color:Ts.latin,searchQuery:"latin music",children:[{id:"reggaeton",name:"Reggaeton",color:"#f97316",searchQuery:"reggaeton"},{id:"salsa",name:"Salsa",color:"#ea580c",searchQuery:"salsa"},{id:"bachata",name:"Bachata",color:"#c2410c",searchQuery:"bachata"},{id:"latin-pop",name:"Latin Pop",color:"#fb923c",searchQuery:"latin pop"},{id:"cumbia",name:"Cumbia",color:"#fed7aa",searchQuery:"cumbia"}]},{id:"metal",name:"Metal",color:Ts.metal,searchQuery:"metal music",children:[{id:"heavy-metal",name:"Heavy Metal",color:"#334155",searchQuery:"heavy metal"},{id:"death-metal",name:"Death Metal",color:"#1e293b",searchQuery:"death metal"},{id:"black-metal",name:"Black Metal",color:"#0f172a",searchQuery:"black metal"},{id:"prog-metal",name:"Progressive Metal",color:"#475569",searchQuery:"progressive metal"},{id:"metalcore",name:"Metalcore",color:"#64748b",searchQuery:"metalcore"}]},{id:"folk",name:"Folk",color:Ts.folk,searchQuery:"folk music",children:[{id:"indie-folk",name:"Indie Folk",color:"#22c55e",searchQuery:"indie folk"},{id:"traditional-folk",name:"Traditional",color:"#16a34a",searchQuery:"traditional folk"},{id:"folk-rock",name:"Folk Rock",color:"#15803d",searchQuery:"folk rock"},{id:"singer-songwriter",name:"Singer-Songwriter",color:"#4ade80",searchQuery:"singer songwriter"}]},{id:"blues",name:"Blues",color:Ts.blues,searchQuery:"blues music",children:[{id:"electric-blues",name:"Electric Blues",color:"#3b82f6",searchQuery:"electric blues"},{id:"delta-blues",name:"Delta Blues",color:"#2563eb",searchQuery:"delta blues"},{id:"chicago-blues",name:"Chicago Blues",color:"#1d4ed8",searchQuery:"chicago blues"},{id:"blues-rock",name:"Blues Rock",color:"#60a5fa",searchQuery:"blues rock"}]},{id:"reggae",name:"Reggae",color:Ts.reggae,searchQuery:"reggae music",children:[{id:"roots-reggae",name:"Roots Reggae",color:"#14b8a6",searchQuery:"roots reggae"},{id:"dub",name:"Dub",color:"#0d9488",searchQuery:"dub music"},{id:"dancehall",name:"Dancehall",color:"#0f766e",searchQuery:"dancehall"},{id:"ska",name:"Ska",color:"#2dd4bf",searchQuery:"ska"}]},{id:"world",name:"World",color:Ts.world,searchQuery:"world music",children:[{id:"afrobeat",name:"Afrobeat",color:"#78350f",searchQuery:"afrobeat"},{id:"indian",name:"Indian",color:"#92400e",searchQuery:"indian music"},{id:"celtic",name:"Celtic",color:"#a16207",searchQuery:"celtic music"},{id:"middle-eastern",name:"Middle Eastern",color:"#854d0e",searchQuery:"middle eastern music"},{id:"asian",name:"Asian",color:"#a3a3a3",searchQuery:"asian music"}]},{id:"ambient",name:"Ambient / Chill",color:Ts.ambient,searchQuery:"ambient chill music",children:[{id:"lofi",name:"Lo-Fi",color:"#64748b",searchQuery:"lo-fi beats"},{id:"chillout",name:"Chillout",color:"#475569",searchQuery:"chillout"},{id:"downtempo",name:"Downtempo",color:"#334155",searchQuery:"downtempo"},{id:"new-age",name:"New Age",color:"#94a3b8",searchQuery:"new age music"},{id:"sleep",name:"Sleep",color:"#cbd5e1",searchQuery:"sleep music"}]}]};function Mde(){return Pde.root}const Lde=({id:n,title:e,subtitle:t,isPersonalized:s,context:r,highlightedGenres:i,maxGenres:o=10,onSeeAll:a})=>{const{getTopGenres:l}=dn(),{play:u,setQueue:d}=Ke(),{showContextMenu:f}=pt(),[p,g]=j.useState(null),x=i??l(3),y=Mde().slice(0,o),b=p?{strategy:"plugin",sectionType:"genre-explorer",title:p.name,embedding:{method:"genre",genre:p.id,exploration:.4,includeCollaborative:!0},limit:15}:null,{tracks:k,isLoading:w}=Vt(b,{enabled:!!p,applyMLRanking:!0,applyTransformers:!0,limit:15}),N=j.useCallback(A=>{(p==null?void 0:p.id)===A.id?g(null):g(A)},[p]),C=j.useCallback(()=>{k.length>0&&k[0]&&(d(k,0),u(k[0]))},[k,d,u]),S=j.useCallback((A,E)=>{d(k,E),u(A)},[k,d,u]),T=A=>x.some(E=>E.toLowerCase().includes(A.toLowerCase()));return c.jsxs(Fs,{id:n,type:"genre-explorer",title:e,subtitle:t,isPersonalized:s,context:r,onSeeAll:a,className:"genre-explorer-section",children:[c.jsx("div",{className:"genre-pills",children:y.map(A=>c.jsxs("button",{className:`genre-pill ${(p==null?void 0:p.id)===A.id?"active":""} ${T(A.id)?"highlighted":""}`,onClick:()=>N(A),style:{"--genre-color":A.color},children:[c.jsx("span",{className:"genre-pill-dot",style:{backgroundColor:A.color}}),c.jsx("span",{className:"genre-pill-name",children:A.name}),T(A.id)&&c.jsx("span",{className:"genre-pill-badge",children:"For You"})]},A.id))}),p&&c.jsxs("div",{className:"genre-tracks-panel",children:[c.jsxs("div",{className:"genre-tracks-header",children:[c.jsxs("div",{className:"genre-tracks-info",children:[c.jsx("span",{className:"genre-tracks-dot",style:{backgroundColor:p.color}}),c.jsx("span",{className:"genre-tracks-name",children:p.name}),!w&&c.jsxs("span",{className:"genre-tracks-count",children:[k.length," tracks"]})]}),c.jsxs("button",{className:"genre-play-btn",onClick:C,disabled:w||k.length===0,children:[c.jsx(Et,{size:16}),c.jsx("span",{children:"Play"})]})]}),w?c.jsx("div",{className:"genre-tracks-scroll",children:[1,2,3,4,5].map(A=>c.jsx("div",{className:"genre-track-item skeleton"},A))}):k.length>0?c.jsx("div",{className:"genre-tracks-scroll",children:k.map((A,E)=>{var M;return c.jsxs("div",{className:"genre-track-item",onClick:()=>S(A,E),onContextMenu:P=>f(P,A),children:[c.jsxs("div",{className:"genre-track-artwork",children:[(M=A.artwork)!=null&&M.small?c.jsx("img",{src:A.artwork.small,alt:A.title,loading:"lazy"}):c.jsx("div",{className:"genre-track-placeholder",children:c.jsx(qe,{size:16})}),c.jsx("div",{className:"genre-track-play-overlay",children:c.jsx(Et,{size:14})})]}),c.jsxs("div",{className:"genre-track-info",children:[c.jsx("span",{className:"genre-track-title",children:A.title}),c.jsx("span",{className:"genre-track-artist",children:A.artists.map(P=>P.name).join(", ")})]})]},A.id)})}):c.jsx("div",{className:"genre-tracks-empty",children:c.jsx("p",{children:"No tracks found for this genre"})})]})]})},Fde=({id:n,title:e="Weekly Rotation",subtitle:t="Your heavy rotation this week",isPersonalized:s=!0,context:r,onSeeAll:i,maxItems:o=10})=>{const{play:a,setQueue:l}=Ke(),{showContextMenu:u}=pt(),d={strategy:"plugin",sectionType:"weekly-rotation",title:e,subtitle:t,embedding:{method:"personalized",exploration:.2,includeCollaborative:!0},limit:o},{tracks:f,isLoading:p}=Vt(d,{enabled:!0,applyMLRanking:!0,applyTransformers:!0,limit:o}),g=(y,b)=>{l(f,b),a(y)},x=!p&&f.length===0;return c.jsx(Fs,{id:n,type:"weekly-rotation",title:e,subtitle:t,isPersonalized:s,context:r,onSeeAll:i,className:"weekly-rotation-section",children:p?c.jsx("div",{className:"discover-horizontal-scroll",children:[1,2,3,4,5].map(y=>c.jsx("div",{className:"discover-card-skeleton"},y))}):x?c.jsx("div",{className:"discover-empty-state",children:c.jsx("p",{children:"Building your weekly rotation..."})}):c.jsx("div",{className:"discover-horizontal-scroll",children:f.map((y,b)=>c.jsx(ln,{track:y,onClick:()=>g(y,b),onContextMenu:u},y.id))})})};function Ode(n=new Date){return n.toISOString().split("T")[0]}function kI(n){const e=[],t=new Date;for(let s=0;s<n;s++){const r=new Date(t);r.setDate(r.getDate()-s),e.push(Ode(r))}return e}const _de=360*60*1e3,zde=An()(Er((n,e)=>({dailyTrending:[],banners:[],searchPopularity:new Map,lastTrendingUpdate:0,lastBannerUpdate:0,updateDailyTrending:(t,s)=>{n(r=>{const i=r.dailyTrending.filter(l=>l.date!==t);return{dailyTrending:[{date:t,tracks:s,fetchedAt:Date.now()},...i].slice(0,7),lastTrendingUpdate:Date.now()}})},getTrendingForDate:t=>{const{dailyTrending:s}=e(),r=s.find(i=>i.date===t);if(r&&Date.now()-r.fetchedAt<_de)return r},getWeeklyTrending:()=>{const{dailyTrending:t}=e();return kI(7).map(r=>t.find(i=>i.date===r)).filter(r=>r!==void 0)},recordSearch:t=>{const s=t.toLowerCase().trim();s.length<2||n(r=>{const i=new Map(r.searchPopularity),o=i.get(s)||0;if(i.set(s,o+1),i.size>1e3){const l=[...i.entries()].sort((u,d)=>d[1]-u[1]).slice(0,500);return{searchPopularity:new Map(l)}}return{searchPopularity:i}})},getPopularSearches:(t=10)=>{const{searchPopularity:s}=e();return[...s.entries()].sort((r,i)=>i[1]-r[1]).slice(0,t).map(([r,i])=>({query:r,count:i}))},addBanner:t=>{const s=`banner-${Date.now()}-${Math.random().toString(36).slice(2,7)}`;n(r=>({banners:[...r.banners,{...t,id:s}],lastBannerUpdate:Date.now()}))},removeBanner:t=>{n(s=>({banners:s.banners.filter(r=>r.id!==t)}))},getActiveBanners:()=>{const{banners:t}=e(),s=Date.now();return t.filter(r=>!r.expiresAt||r.expiresAt>s).sort((r,i)=>i.priority-r.priority)},computeTrendingFromTracks:t=>{const{searchPopularity:s,dailyTrending:r}=e(),i=kI(2)[1],o=r.find(l=>l.date===i),a=new Map((o==null?void 0:o.tracks.map((l,u)=>[l.id,u]))??[]);return t.slice(0,20).map((l,u)=>{var y,b,k;const d=`${((y=l.artists[0])==null?void 0:y.name)??""} ${l.title}`.toLowerCase(),f=s.get(d)??0,p=100-u*5+f,g=a.get(l.id);let x="new";return g!==void 0&&(g>u?x="up":g<u?x="down":x="stable"),{id:l.id,title:l.title,artist:l.artists.map(w=>w.name).join(", "),artwork:((b=l.artwork)==null?void 0:b.small)??((k=l.artwork)==null?void 0:k.medium),trendScore:p,changeDirection:x,previousRank:g!==void 0?g+1:void 0}})}}),{name:"audiio-trending",partialize:n=>({dailyTrending:n.dailyTrending.slice(0,7),banners:n.banners.filter(e=>!e.expiresAt||e.expiresAt>Date.now()),searchPopularity:Object.fromEntries([...n.searchPopularity.entries()].slice(0,200)),lastTrendingUpdate:n.lastTrendingUpdate,lastBannerUpdate:n.lastBannerUpdate}),merge:(n,e)=>{const t=n;return{...e,dailyTrending:t.dailyTrending??[],banners:t.banners??[],searchPopularity:new Map(Object.entries(t.searchPopularity??{})),lastTrendingUpdate:t.lastTrendingUpdate??0,lastBannerUpdate:t.lastBannerUpdate??0}}})),Bde=({id:n,context:e,banner:t})=>{const{setSearchQuery:s}=Wt(),{search:r}=la(),{getActiveBanners:i}=zde(),o=i(),a=t??o[0];if(!a)return null;const l=()=>{if(a.ctaAction)if(a.ctaAction.startsWith("search:")){const d=a.ctaAction.replace("search:","");s(d),r(d)}else a.ctaAction.startsWith("artist:")?a.ctaAction.replace("artist:",""):a.ctaAction.startsWith("album:")&&a.ctaAction.replace("album:","")},u={};return a.backgroundImage?(u.backgroundImage=`url(${a.backgroundImage})`,u.backgroundSize="cover",u.backgroundPosition="center"):a.gradientColors?u.background=`linear-gradient(135deg, ${a.gradientColors[0]} 0%, ${a.gradientColors[1]} 100%)`:a.backgroundColor?u.backgroundColor=a.backgroundColor:u.background="linear-gradient(135deg, var(--accent) 0%, var(--bg-primary) 100%)",c.jsxs("section",{id:n,className:"banner-section",style:u,children:[c.jsx("div",{className:"banner-overlay"}),c.jsxs("div",{className:"banner-content",children:[c.jsxs("div",{className:"banner-text",children:[a.type!=="custom"&&c.jsx("span",{className:"banner-badge",children:Wde(a.type)}),c.jsx("h2",{className:"banner-title",children:a.title}),a.subtitle&&c.jsx("p",{className:"banner-subtitle",children:a.subtitle})]}),a.ctaText&&c.jsxs("button",{className:"banner-cta",onClick:l,children:[c.jsx("span",{children:a.ctaText}),c.jsx(Yi,{size:20})]})]}),c.jsxs("div",{className:"banner-decoration",children:[c.jsx("div",{className:"banner-circle banner-circle--1"}),c.jsx("div",{className:"banner-circle banner-circle--2"})]})]})};function Wde(n){switch(n){case"new-release":return"New Release";case"featured-artist":return"Featured Artist";case"playlist":return"Playlist";case"event":return"Event";default:return""}}function Vde(n,e){return n===0||n%5===0?"large":n%3===0?"medium":"small"}const Ude=({id:n,title:e,subtitle:t,query:s,isPersonalized:r,context:i,tracks:o,onSeeAll:a})=>{const{play:l,setQueue:u,currentTrack:d,isPlaying:f}=Ke(),{showContextMenu:p}=pt(),{tracks:g,isLoading:x,error:y}=rk(o?void 0:s,{limit:12}),b=o??g,k=b.map((N,C)=>({track:N,size:Vde(C,b.length)})),w=N=>{u(b,b.indexOf(N)),l(N)};return!x&&b.length===0?null:c.jsx(Fs,{id:n,type:"masonry",title:e,subtitle:t,isPersonalized:r,isLoading:x,error:y,context:i,onSeeAll:a,className:"masonry-section",children:c.jsx("div",{className:"masonry-grid",children:k.map(({track:N,size:C},S)=>c.jsx(Gde,{track:N,size:C,index:S,isPlaying:(d==null?void 0:d.id)===N.id&&f,onClick:()=>w(N),onContextMenu:T=>p(T,N)},N.id))})})},Gde=({track:n,size:e,index:t,isPlaying:s,onClick:r,onContextMenu:i})=>{var a,l,u,d;const o=e==="large"?((a=n.artwork)==null?void 0:a.large)??((l=n.artwork)==null?void 0:l.medium):((u=n.artwork)==null?void 0:u.medium)??((d=n.artwork)==null?void 0:d.small);return c.jsxs("div",{className:`masonry-card masonry-card--${e} ${s?"playing":""}`,onClick:r,onContextMenu:i,style:{animationDelay:`${t*50}ms`},children:[c.jsxs("div",{className:"masonry-card-artwork",children:[o?c.jsx("img",{src:o,alt:n.title,loading:"lazy"}):c.jsx("div",{className:"masonry-card-placeholder",children:c.jsx(qe,{size:e==="large"?48:e==="medium"?32:24})}),c.jsx("div",{className:"masonry-card-overlay",children:c.jsx("button",{className:"masonry-card-play",children:c.jsx(Et,{size:e==="large"?32:24})})}),s&&c.jsxs("div",{className:"masonry-card-playing",children:[c.jsx("span",{className:"playing-bar"}),c.jsx("span",{className:"playing-bar"}),c.jsx("span",{className:"playing-bar"})]})]}),c.jsxs("div",{className:"masonry-card-info",children:[c.jsx("span",{className:"masonry-card-title",children:n.title}),(e==="large"||e==="medium")&&c.jsx("span",{className:"masonry-card-artist",children:n.artists.map(f=>f.name).join(", ")})]})]})},CI=[{id:"chill",name:"Chill",icon:"",description:"Relaxed vibes",gradient:["#667eea","#764ba2"],searchTerms:["chill vibes","lofi beats","relaxing music"]},{id:"workout",name:"Workout",icon:"",description:"High energy",gradient:["#f12711","#f5af19"],searchTerms:["workout music","gym motivation","high energy"]},{id:"focus",name:"Focus",icon:"",description:"Deep work",gradient:["#11998e","#38ef7d"],searchTerms:["focus music","study beats","concentration"]},{id:"party",name:"Party",icon:"",description:"Get moving",gradient:["#ff0844","#ffb199"],searchTerms:["party music","dance hits","club bangers"]},{id:"sleep",name:"Sleep",icon:"",description:"Peaceful rest",gradient:["#2c3e50","#4ca1af"],searchTerms:["sleep music","relaxing sleep","peaceful"]},{id:"happy",name:"Happy",icon:"",description:"Feel good",gradient:["#ffecd2","#fcb69f"],searchTerms:["happy music","feel good songs","uplifting"]}],Hde=({id:n,title:e="Moods",subtitle:t="Match your vibe",isPersonalized:s,context:r,onSeeAll:i})=>{const{play:o,setQueue:a}=Ke(),[l,u]=j.useState(null),[d,f]=j.useState(!1),p=CI.find(N=>N.id===l),g=j.useMemo(()=>({strategy:"plugin",sectionType:"mood-playlist",title:p?`${p.name} Playlist`:e,subtitle:t,embedding:{method:"mood",mood:l||"chill",exploration:.2},limit:20}),[e,t,l,p]),{tracks:x,isLoading:y}=Vt(g,{enabled:!!l,applyMLRanking:!0,applyTransformers:!0,limit:20}),b=j.useCallback(N=>{l===N?(u(null),f(!1)):(u(N),f(!0))},[l]),k=j.useCallback(()=>{x.length>0&&(a(x,0),o(x[0]),tc(`Playing ${(p==null?void 0:p.name)||"mood"} playlist`))},[x,a,o,p]),w=j.useCallback(()=>{if(x.length>0){const N=[...x].sort(()=>Math.random()-.5);a(N,0),o(N[0]),tc(`Shuffling ${(p==null?void 0:p.name)||"mood"} playlist`)}},[x,a,o,p]);return c.jsxs(Fs,{id:n,type:"mood-playlist",title:e,subtitle:t,isPersonalized:s,context:r,onSeeAll:i,className:"mood-playlist-section",children:[c.jsx("div",{className:"mood-tiles-grid",children:CI.map(N=>c.jsx(qde,{mood:N,isActive:l===N.id,onClick:()=>b(N.id)},N.id))}),d&&p&&c.jsxs("div",{className:"mood-expanded-content",style:{"--mood-color-1":p.gradient[0],"--mood-color-2":p.gradient[1]},children:[c.jsxs("div",{className:"mood-expanded-header",children:[c.jsxs("div",{className:"mood-expanded-info",children:[c.jsx("span",{className:"mood-expanded-icon",children:p.icon}),c.jsxs("div",{className:"mood-expanded-text",children:[c.jsxs("h3",{children:[p.name," Playlist"]}),c.jsxs("span",{children:[x.length," tracks"]})]})]}),c.jsxs("div",{className:"mood-expanded-actions",children:[c.jsxs("button",{className:"mood-play-btn",onClick:k,disabled:y||x.length===0,children:[c.jsx(Et,{size:18}),c.jsx("span",{children:"Play"})]}),c.jsx("button",{className:"mood-shuffle-btn",onClick:w,disabled:y||x.length===0,children:c.jsx(oo,{size:18})})]})]}),y?c.jsx("div",{className:"mood-tracks-loading",children:[1,2,3,4].map(N=>c.jsx("div",{className:"mood-track-skeleton"},N))}):c.jsxs("div",{className:"mood-tracks-list",children:[x.slice(0,8).map((N,C)=>c.jsx(Kde,{track:N,index:C,onPlay:()=>{a(x,C),o(N)}},N.id)),x.length>8&&c.jsxs("div",{className:"mood-tracks-more",children:["+",x.length-8," more tracks"]})]})]})]})},qde=({mood:n,isActive:e,onClick:t})=>c.jsxs("button",{className:`mood-tile ${e?"active":""}`,onClick:t,style:{"--gradient-start":n.gradient[0],"--gradient-end":n.gradient[1]},children:[c.jsx("div",{className:"mood-tile-bg"}),c.jsxs("div",{className:"mood-tile-content",children:[c.jsx("span",{className:"mood-tile-icon",children:n.icon}),c.jsx("span",{className:"mood-tile-name",children:n.name}),c.jsx("span",{className:"mood-tile-desc",children:n.description})]})]}),Kde=({track:n,index:e,onPlay:t})=>{var i,o;const{showContextMenu:s}=pt(),r=((i=n.artwork)==null?void 0:i.small)??((o=n.artwork)==null?void 0:o.medium);return c.jsxs("div",{className:"mood-track-item",onClick:t,onContextMenu:a=>s(a,n),children:[c.jsxs("div",{className:"mood-track-artwork",children:[r?c.jsx("img",{src:r,alt:n.title,loading:"lazy"}):c.jsx("div",{className:"mood-track-placeholder",children:c.jsx(qe,{size:16})}),c.jsx("div",{className:"mood-track-overlay",children:c.jsx(Et,{size:14})})]}),c.jsxs("div",{className:"mood-track-info",children:[c.jsx("span",{className:"mood-track-title",children:n.title}),c.jsx("span",{className:"mood-track-artist",children:n.artists.map(a=>a.name).join(", ")})]})]})};function Qde(n){return n>=5&&n<12?{greeting:"Good morning",mood:"uplifting",icon:""}:n>=12&&n<17?{greeting:"Good afternoon",mood:"focus",icon:""}:n>=17&&n<21?{greeting:"Good evening",mood:"chill",icon:""}:{greeting:"Late night",mood:"chill",icon:""}}const Xde=({id:n,context:e,onSeeAll:t,maxItems:s=8})=>{const{play:r,setQueue:i}=Ke(),{showContextMenu:o}=pt(),a=Qde((e==null?void 0:e.hour)??new Date().getHours()),l=j.useMemo(()=>({strategy:"plugin",sectionType:"time-greeting",title:`${a.icon} ${a.greeting}`,subtitle:"Music for right now",embedding:{method:"mood",mood:a.mood,exploration:.2},limit:s}),[a.greeting,a.mood,a.icon,s]),{tracks:u,isLoading:d}=Vt(l,{enabled:!0,applyMLRanking:!0,applyTransformers:!0,limit:s}),f=(p,g)=>{i(u,g),r(p)};return!d&&u.length===0?null:c.jsx(Fs,{id:n,type:"time-greeting",title:`${a.icon} ${a.greeting}`,subtitle:"Music for right now",isPersonalized:!0,context:e,onSeeAll:t,className:"time-greeting-section",children:d?c.jsx("div",{className:"discover-horizontal-scroll",children:Array.from({length:6}).map((p,g)=>c.jsx("div",{className:"discover-card-skeleton"},g))}):c.jsx("div",{className:"discover-horizontal-scroll",children:u.map((p,g)=>c.jsx(ln,{track:p,onClick:()=>f(p,g),onContextMenu:o},p.id))})})},Yde=({id:n,title:e="On Repeat",subtitle:t="Your heavy rotation",context:s,onSeeAll:r,maxItems:i=10})=>{const{play:o,setQueue:a}=Ke(),{showContextMenu:l}=pt(),u=j.useMemo(()=>({strategy:"plugin",sectionType:"on-repeat",title:e,subtitle:t,embedding:{method:"personalized",exploration:.05},limit:i}),[e,t,i]),{tracks:d,isLoading:f}=Vt(u,{enabled:!0,applyMLRanking:!0,applyTransformers:!0,limit:i}),p=(g,x)=>{a(d,x),o(g)};return!f&&d.length===0?null:c.jsx(Fs,{id:n,type:"on-repeat",title:e,subtitle:t,isPersonalized:!0,context:s,onSeeAll:r,className:"on-repeat-section",children:f?c.jsx("div",{className:"discover-horizontal-scroll",children:Array.from({length:6}).map((g,x)=>c.jsx("div",{className:"discover-card-skeleton"},x))}):c.jsx("div",{className:"discover-horizontal-scroll",children:d.map((g,x)=>c.jsx(ln,{track:g,onClick:()=>p(g,x),onContextMenu:l,showPlayCount:!0},g.id))})})},Zde=({id:n,title:e="Discover Weekly",subtitle:t="Your personalized mix of new and familiar",context:s,onSeeAll:r,maxItems:i=20})=>{const{play:o,setQueue:a}=Ke(),{showContextMenu:l}=pt(),u=j.useMemo(()=>({strategy:"plugin",sectionType:"discover-weekly",title:e,subtitle:t,embedding:{method:"discovery",exploration:.5},limit:i}),[e,t,i]),{tracks:d,isLoading:f}=Vt(u,{enabled:!0,applyMLRanking:!0,applyTransformers:!0,limit:i}),p=(y,b)=>{a(d,b),o(y)},g=()=>{d.length>0&&d[0]&&(a(d,0),o(d[0]))},x=()=>{if(d.length>0){const y=[...d].sort(()=>Math.random()-.5);y[0]&&(a(y,0),o(y[0]))}};return!f&&d.length===0?null:c.jsxs(Fs,{id:n,type:"discover-weekly",title:e,subtitle:t,isPersonalized:!0,context:s,onSeeAll:r,className:"discover-weekly-section",children:[c.jsxs("div",{className:"discover-weekly-header",children:[c.jsxs("div",{className:"discover-weekly-info",children:[c.jsxs("span",{className:"discover-weekly-count",children:[d.length," tracks"]}),c.jsx("span",{className:"discover-weekly-updated",children:"Updated weekly"})]}),c.jsxs("div",{className:"discover-weekly-actions",children:[c.jsxs("button",{className:"discover-weekly-play",onClick:g,children:[c.jsx(Et,{size:16}),c.jsx("span",{children:"Play"})]}),c.jsx("button",{className:"discover-weekly-shuffle",onClick:x,children:c.jsx(oo,{size:16})})]})]}),c.jsx("div",{className:"discover-horizontal-scroll",children:d.slice(0,12).map((y,b)=>c.jsx(ln,{track:y,onClick:()=>p(y,b),onContextMenu:l},y.id))})]})},Jde=({id:n,title:e="Your Top Mix",subtitle:t="Based on everything you love",context:s,onSeeAll:r,maxItems:i=12})=>{const{play:o,setQueue:a}=Ke(),{showContextMenu:l}=pt(),u=j.useMemo(()=>{var x;if((x=s==null?void 0:s.topGenres)!=null&&x.length){const y=s.topGenres.slice(0,2).join(", ");return y?`${y} and more`:t}return t},[s==null?void 0:s.topGenres,t]),d=j.useMemo(()=>({strategy:"plugin",sectionType:"top-mix",title:e,subtitle:u,embedding:{method:"personalized",exploration:.2},limit:i}),[e,u,i]),{tracks:f,isLoading:p}=Vt(d,{enabled:!0,applyMLRanking:!0,applyTransformers:!0,limit:i}),g=(x,y)=>{a(f,y),o(x)};return!p&&f.length===0?null:c.jsx(Fs,{id:n,type:"top-mix",title:e,subtitle:u,isPersonalized:!0,context:s,onSeeAll:r,className:"top-mix-section",children:p?c.jsx("div",{className:"discover-horizontal-scroll",children:Array.from({length:6}).map((x,y)=>c.jsx("div",{className:"discover-card-skeleton"},y))}):c.jsx("div",{className:"discover-horizontal-scroll",children:f.map((x,y)=>c.jsx(ln,{track:x,onClick:()=>g(x,y),onContextMenu:l},x.id))})})},ehe=({id:n,title:e="Rediscover",subtitle:t="Tracks you might have forgotten",context:s,onSeeAll:r,maxItems:i=10})=>{const{play:o,setQueue:a}=Ke(),{showContextMenu:l}=pt(),u=j.useMemo(()=>({strategy:"plugin",sectionType:"rediscover",title:e,subtitle:t,embedding:{method:"personalized",exploration:.1},limit:i}),[e,t,i]),{tracks:d,isLoading:f}=Vt(u,{enabled:!0,applyMLRanking:!0,applyTransformers:!0,limit:i}),p=(g,x)=>{a(d,x),o(g)};return!f&&d.length===0?null:c.jsx(Fs,{id:n,type:"rediscover",title:` ${e}`,subtitle:t,isPersonalized:!0,context:s,onSeeAll:r,className:"rediscover-section",children:c.jsx("div",{className:"discover-horizontal-scroll",children:d.map((g,x)=>c.jsx(ln,{track:g,onClick:()=>p(g,x),onContextMenu:l},g.id))})})},SI=[{id:"workout",name:"Workout",icon:"",mood:"energetic",gradient:["#f12711","#f5af19"]},{id:"study",name:"Study",icon:"",mood:"focus",gradient:["#11998e","#38ef7d"]},{id:"cooking",name:"Cooking",icon:"",mood:"uplifting",gradient:["#fc4a1a","#f7b733"]},{id:"gaming",name:"Gaming",icon:"",mood:"energetic",gradient:["#8e2de2","#4a00e0"]},{id:"running",name:"Running",icon:"",mood:"energetic",gradient:["#f857a6","#ff5858"]},{id:"relaxing",name:"Relaxing",icon:"",mood:"chill",gradient:["#667eea","#764ba2"]}],the=({id:n,title:e="Activity Playlists",subtitle:t="Music for what you're doing",context:s,onSeeAll:r,maxTracks:i=12})=>{const{play:o,setQueue:a}=Ke(),{showContextMenu:l}=pt(),[u,d]=j.useState(null),f=SI.find(k=>k.id===u),p=j.useMemo(()=>({strategy:"plugin",sectionType:"activity",title:f?`${f.name} Mix`:e,subtitle:t,embedding:{method:"mood",mood:(f==null?void 0:f.mood)||"chill",exploration:.25},limit:i}),[e,t,f,i]),{tracks:g}=Vt(p,{enabled:!!u,applyMLRanking:!0,applyTransformers:!0,limit:i}),x=j.useCallback(k=>{d(u===k?null:k)},[u]),y=j.useCallback(()=>{g.length>0&&g[0]&&(a(g,0),o(g[0]))},[g,a,o]),b=(k,w)=>{a(g,w),o(k)};return c.jsxs(Fs,{id:n,type:"activity",title:e,subtitle:t,context:s,onSeeAll:r,className:"activity-section",children:[c.jsx("div",{className:"activity-tiles",children:SI.map(k=>c.jsxs("button",{className:`activity-tile ${u===k.id?"active":""}`,onClick:()=>x(k.id),style:{"--gradient-start":k.gradient[0],"--gradient-end":k.gradient[1]},children:[c.jsx("span",{className:"activity-icon",children:k.icon}),c.jsx("span",{className:"activity-name",children:k.name})]},k.id))}),f&&g.length>0&&c.jsxs("div",{className:"activity-tracks-panel",children:[c.jsxs("div",{className:"activity-tracks-header",children:[c.jsxs("span",{className:"activity-tracks-title",children:[f.icon," ",f.name," Mix"]}),c.jsxs("button",{className:"activity-play-btn",onClick:y,children:[c.jsx(Et,{size:16}),"Play All"]})]}),c.jsx("div",{className:"activity-tracks-scroll",children:g.map((k,w)=>{var N;return c.jsxs("div",{className:"activity-track-item",onClick:()=>b(k,w),onContextMenu:C=>l(C,k),children:[c.jsx("div",{className:"activity-track-artwork",children:(N=k.artwork)!=null&&N.small?c.jsx("img",{src:k.artwork.small,alt:k.title,loading:"lazy"}):c.jsx("div",{className:"activity-track-placeholder",children:c.jsx(qe,{size:16})})}),c.jsxs("div",{className:"activity-track-info",children:[c.jsx("span",{className:"activity-track-title",children:k.title}),c.jsx("span",{className:"activity-track-artist",children:k.artists.map(C=>C.name).join(", ")})]})]},k.id)})})]})]})},NI=[{id:"80s",name:"80s",years:"1980-89",startYear:1980,endYear:1989,color:"#ff6b9d",searchTerms:"80s hits synthwave retro"},{id:"90s",name:"90s",years:"1990-99",startYear:1990,endYear:1999,color:"#4ecdc4",searchTerms:"90s hits grunge alternative"},{id:"2000s",name:"00s",years:"2000-09",startYear:2e3,endYear:2009,color:"#45b7d1",searchTerms:"2000s hits pop rock rnb"},{id:"2010s",name:"10s",years:"2010-19",startYear:2010,endYear:2019,color:"#96ceb4",searchTerms:"2010s hits edm pop indie"},{id:"2020s",name:"20s",years:"2020-now",startYear:2020,endYear:2030,color:"#9b59b6",searchTerms:"2024 hits trending new music"}],nhe=({id:n,title:e="Decades",subtitle:t="Music through the years",context:s,onSeeAll:r,maxItems:i=12})=>{const{play:o,setQueue:a}=Ke(),{showContextMenu:l}=pt(),[u,d]=j.useState(null),f=NI.find(w=>w.id===u),p=f?{strategy:"plugin",sectionType:"decade-mix",title:`${f.name} Hits`,search:{query:f.searchTerms},embedding:{method:"discovery",exploration:.3,yearRange:[f.startYear,f.endYear]},limit:i}:null,{tracks:g,isLoading:x}=Vt(p,{enabled:!!u,applyMLRanking:!0,applyTransformers:!0,limit:i}),y=j.useCallback(w=>{d(u===w?null:w)},[u]),b=j.useCallback(()=>{g.length>0&&g[0]&&(a(g,0),o(g[0]))},[g,a,o]),k=(w,N)=>{a(g,N),o(w)};return c.jsxs(Fs,{id:n,type:"decade-mix",title:e,subtitle:t,context:s,onSeeAll:r,className:"decade-mix-section",children:[c.jsx("div",{className:"decade-pills",children:NI.map(w=>c.jsx("button",{className:`decade-pill ${u===w.id?"active":""}`,onClick:()=>y(w.id),style:{"--decade-color":w.color},children:c.jsx("span",{className:"decade-pill-name",children:w.name})},w.id))}),f&&c.jsxs("div",{className:"decade-tracks-panel",children:[c.jsxs("div",{className:"decade-tracks-header",children:[c.jsxs("div",{className:"decade-tracks-info",children:[c.jsxs("span",{className:"decade-tracks-name",children:[f.name," Hits"]}),!x&&c.jsxs("span",{className:"decade-tracks-count",children:[g.length," tracks"]})]}),c.jsxs("button",{className:"decade-play-btn",onClick:b,disabled:x||g.length===0,children:[c.jsx(Et,{size:16}),c.jsx("span",{children:"Play"})]})]}),x?c.jsx("div",{className:"discover-horizontal-scroll",children:[1,2,3,4,5].map(w=>c.jsx("div",{className:"discover-card-skeleton"},w))}):g.length>0?c.jsx("div",{className:"discover-horizontal-scroll",children:g.map((w,N)=>c.jsx(ln,{track:w,onClick:()=>k(w,N),onContextMenu:l},w.id))}):c.jsx("div",{className:"decade-empty",children:c.jsxs("p",{children:["No ",f.name," tracks found"]})})]})]})};function she(n){return n===11||n===0||n===1?{name:"Winter Warmers",mood:"chill",icon:"",gradient:["#667eea","#764ba2"],searchTerms:"winter chill acoustic cozy"}:n>=2&&n<=4?{name:"Spring Awakening",mood:"uplifting",icon:"",gradient:["#ffecd2","#fcb69f"],searchTerms:"spring uplifting fresh indie"}:n>=5&&n<=7?{name:"Summer Vibes",mood:"energetic",icon:"",gradient:["#f12711","#f5af19"],searchTerms:"summer hits beach party dance"}:{name:"Autumn Mood",mood:"chill",icon:"",gradient:["#ff9966","#ff5e62"],searchTerms:"autumn fall chill acoustic"}}const rhe=({id:n,context:e,onSeeAll:t,maxItems:s=10})=>{const{play:r,setQueue:i}=Ke(),{showContextMenu:o}=pt(),a=new Date().getMonth(),l=she(a),u={strategy:"plugin",sectionType:"seasonal",title:`${l.icon} ${l.name}`,subtitle:"Music for the season",search:{query:l.searchTerms},embedding:{method:"mood",mood:l.mood,exploration:.4,includeCollaborative:!0},limit:s},{tracks:d,isLoading:f}=Vt(u,{enabled:!0,applyMLRanking:!0,applyTransformers:!0,limit:s}),p=(g,x)=>{i(d,x),r(g)};return!f&&d.length===0?null:c.jsx(Fs,{id:n,type:"seasonal",title:`${l.icon} ${l.name}`,subtitle:"Music for the season",context:e,onSeeAll:t,className:"seasonal-section",style:{"--seasonal-gradient-start":l.gradient[0],"--seasonal-gradient-end":l.gradient[1]},children:f?c.jsx("div",{className:"discover-horizontal-scroll",children:[1,2,3,4,5].map(g=>c.jsx("div",{className:"discover-card-skeleton"},g))}):c.jsx("div",{className:"discover-horizontal-scroll",children:d.map((g,x)=>c.jsx(ln,{track:g,onClick:()=>p(g,x),onContextMenu:o},g.id))})})},ihe=({id:n,title:e="Blind Picks",subtitle:t="Songs you haven't heard yet",context:s,onSeeAll:r,maxItems:i=8})=>{const{play:o,setQueue:a,history:l}=Ke(),{likedTracks:u,isLiked:d}=Xt(),{showContextMenu:f}=pt(),[p,g]=j.useState(0),x=j.useMemo(()=>{const A=new Set;return l&&l.forEach(E=>A.add(E.trackId)),A},[l]),y=j.useMemo(()=>{const A=new Set;return u.forEach(E=>A.add(E.track.id)),A},[u]),b={strategy:"plugin",sectionType:"blind-picks",title:e,subtitle:t,embedding:{method:"discovery",exploration:.95,includeCollaborative:!1,excludeTrackIds:[...x,...y]},limit:i*2},{tracks:k,isLoading:w}=Vt(b,{enabled:!0,applyMLRanking:!0,applyTransformers:!0,limit:i*2,deps:[p]}),N=j.useMemo(()=>k.filter(A=>!y.has(A.id)&&!x.has(A.id)&&!d(A.id)).slice(0,i),[k,y,x,d,i]),C=j.useCallback(()=>{g(A=>A+1)},[]),S=(A,E)=>{a(N,E),o(A)},T=!w&&N.length===0;return c.jsx(Fs,{id:n,type:"blind-picks",title:e,subtitle:t,context:s,onSeeAll:r,className:"blind-picks-section",children:w?c.jsx("div",{className:"discover-horizontal-scroll",children:[1,2,3,4,5].map(A=>c.jsx("div",{className:"discover-card-skeleton"},A))}):T?c.jsx("div",{className:"discover-empty-state",children:c.jsx("p",{children:"Finding new music for you..."})}):c.jsxs("div",{className:"discover-horizontal-scroll",children:[N.map((A,E)=>c.jsx(ln,{track:A,onClick:()=>S(A,E),onContextMenu:f},A.id)),c.jsxs("button",{className:"blind-picks-refresh-card",onClick:C,title:"Get new picks",children:[c.jsx(sr,{size:24}),c.jsx("span",{children:"More picks"})]})]})})},ohe=({id:n,title:e="Artists For You",subtitle:t="Based on your listening",context:s,onSeeAll:r,maxArtists:i=6})=>{const{play:o,setQueue:a}=Ke(),l={strategy:"plugin",sectionType:"similar-artists",title:e,subtitle:t,embedding:{method:"personalized",exploration:.3,includeCollaborative:!0},limit:50},{tracks:u,isLoading:d}=Vt(l,{enabled:!0,applyMLRanking:!0,applyTransformers:!0,limit:50}),f=j.useMemo(()=>{var y,b,k,w,N,C,S;if(u.length===0)return[];const x=new Map;for(const T of u){const A=(y=T.artists)==null?void 0:y[0];if(!(A!=null&&A.name))continue;const E=A.id||A.name.toLowerCase().replace(/\s+/g,"-");if(!x.has(E))x.set(E,{id:E,name:A.name,artwork:((b=A.artwork)==null?void 0:b.medium)||((k=T.artwork)==null?void 0:k.medium),trackCount:1,tracks:[T]});else{const M=x.get(E);M.trackCount++,M.tracks.push(T),!M.artwork&&((w=A.artwork)!=null&&w.medium||(N=T.artwork)!=null&&N.medium)&&(M.artwork=((C=A.artwork)==null?void 0:C.medium)||((S=T.artwork)==null?void 0:S.medium))}}return Array.from(x.values()).sort((T,A)=>A.trackCount-T.trackCount).slice(0,i)},[u,i]),p=x=>{x.tracks.length>0&&x.tracks[0]&&(a(x.tracks,0),o(x.tracks[0]))},g=!d&&f.length===0;return c.jsx(Fs,{id:n,type:"similar-artists",title:e,subtitle:t,isPersonalized:!0,context:s,onSeeAll:r,className:"similar-artists-section",children:d?c.jsx("div",{className:"similar-artists-grid",children:[1,2,3,4].map(x=>c.jsx("div",{className:"similar-artist-card skeleton"},x))}):g?c.jsx("div",{className:"discover-empty-state",children:c.jsx("p",{children:"Discovering artists for you..."})}):c.jsx("div",{className:"similar-artists-grid",children:f.map(x=>c.jsxs("div",{className:"similar-artist-card",onClick:()=>p(x),children:[c.jsxs("div",{className:"similar-artist-artwork",children:[x.artwork?c.jsx("img",{src:x.artwork,alt:x.name,loading:"lazy"}):c.jsx("div",{className:"similar-artist-placeholder",children:c.jsx(qe,{size:32})}),c.jsx("div",{className:"similar-artist-play-overlay",children:c.jsx(Et,{size:24})}),c.jsx("div",{className:"similar-artist-radio-badge",title:"Plays artist radio",children:c.jsx(rc,{size:12})})]}),c.jsxs("div",{className:"similar-artist-info",children:[c.jsx("span",{className:"similar-artist-name",children:x.name}),c.jsxs("span",{className:"similar-artist-radio-label",children:["Radio  ",x.trackCount," tracks"]})]})]},x.id))})})},ahe=({id:n,title:e="Lyrical Gems",subtitle:t,onSeeAll:s,maxItems:r=8})=>{var w;const{play:i,setQueue:o}=Ke(),{showContextMenu:a}=pt(),{hasCapability:l,getPluginsByRole:u}=ii(),d=l("lyrics-provider"),f=u("lyrics-provider"),p=e,g=t||`Powered by ${((w=f[0])==null?void 0:w.name)||"lyrics provider"}`,x=j.useMemo(()=>({strategy:"plugin",sectionType:"lyrics-highlight",title:p,subtitle:g,embedding:{method:"personalized",exploration:.25},limit:r}),[p,g,r]),{tracks:y,isLoading:b}=Vt(x,{enabled:d,applyMLRanking:!0,applyTransformers:!0,limit:r}),k=(N,C)=>{o(y,C),i(N)};return!d||!b&&y.length===0?null:c.jsxs("section",{id:n,className:"discover-horizontal-section discover-lyrics-section",children:[c.jsxs("div",{className:"discover-section-header",children:[c.jsxs("div",{className:"discover-section-title-row",children:[c.jsx("h2",{className:"discover-section-title",children:p}),c.jsx("span",{className:"discover-section-subtitle",children:g})]}),s&&c.jsx("button",{className:"discover-section-more",onClick:s,children:"See all"})]}),c.jsx("div",{className:"discover-horizontal-scroll",children:y.map((N,C)=>c.jsx(ln,{track:N,onClick:()=>k(N,C),onContextMenu:a},N.id))})]})},lhe=({id:n,title:e="Fresh Finds",subtitle:t="Expand your horizons",onSeeAll:s,maxItems:r=10,explorationLevel:i=.8})=>{const{play:o,setQueue:a}=Ke(),{showContextMenu:l}=pt(),u={strategy:"plugin",sectionType:"fresh-finds",title:e,subtitle:t,embedding:{method:"discovery",exploration:i,includeCollaborative:!0},limit:r},{tracks:d,isLoading:f}=Vt(u,{enabled:!0,applyMLRanking:!0,applyTransformers:!0,limit:r}),p=(g,x)=>{a(d,x),o(g)};return!f&&d.length===0?null:c.jsxs("section",{id:n,className:"discover-horizontal-section discover-fresh-finds-section",children:[c.jsxs("div",{className:"discover-section-header",children:[c.jsxs("div",{className:"discover-section-title-row",children:[c.jsx("h2",{className:"discover-section-title",children:e}),c.jsx("span",{className:"discover-section-subtitle",children:t})]}),s&&c.jsx("button",{className:"discover-section-more",onClick:s,children:"See all"})]}),f?c.jsx("div",{className:"discover-horizontal-scroll",children:[1,2,3,4,5,6].map(g=>c.jsx("div",{className:"discover-card-skeleton"},g))}):c.jsx("div",{className:"discover-horizontal-scroll",children:d.map((g,x)=>c.jsx(ln,{track:g,onClick:()=>p(g,x),onContextMenu:l},g.id))})]})},che=({id:n,title:e="Deep Cuts",subtitle:t="Hidden gems you might love",onSeeAll:s,maxItems:r=8})=>{const{play:i,setQueue:o}=Ke(),{showContextMenu:a}=pt(),{likedTracks:l}=Xt(),u=j.useMemo(()=>l.sort(()=>Math.random()-.5).slice(0,5).map(x=>x.track.id),[l]),d=j.useMemo(()=>({strategy:"plugin",sectionType:"deep-cuts",title:e,subtitle:t,embedding:{method:"similar",seedTrackIds:u,exploration:.6},limit:r}),[e,t,u,r]),{tracks:f,isLoading:p}=Vt(d,{enabled:u.length>0,applyMLRanking:!0,applyTransformers:!0,limit:r}),g=(x,y)=>{o(f,y),i(x)};return l.length===0||!p&&f.length===0?null:c.jsxs("section",{id:n,className:"discover-horizontal-section discover-deep-cuts-section",children:[c.jsxs("div",{className:"discover-section-header",children:[c.jsxs("div",{className:"discover-section-title-row",children:[c.jsx("h2",{className:"discover-section-title",children:e}),c.jsx("span",{className:"discover-section-subtitle",children:t})]}),s&&c.jsx("button",{className:"discover-section-more",onClick:s,children:"See all"})]}),p?c.jsx("div",{className:"discover-horizontal-scroll",children:[1,2,3,4,5].map(x=>c.jsx("div",{className:"discover-card-skeleton"},x))}):c.jsx("div",{className:"discover-horizontal-scroll",children:f.map((x,y)=>c.jsx(ln,{track:x,onClick:()=>g(x,y),onContextMenu:a},x.id))})]})},uhe={study:"focus",work:"focus",creative:"chill",relax:"chill"},II={study:{title:"Study Session",subtitle:"Focus-enhancing music"},work:{title:"Deep Work",subtitle:"Music for productivity"},creative:{title:"Creative Flow",subtitle:"Inspiring background music"},relax:{title:"Wind Down",subtitle:"Peaceful and calming"}},dhe=({id:n,title:e,subtitle:t,onSeeAll:s,maxItems:r=8,focusType:i="work"})=>{const{play:o,setQueue:a}=Ke(),{showContextMenu:l}=pt(),u=II[i]||II.work,d=e||u.title,f=t||u.subtitle,p=uhe[i]||"focus",g=j.useMemo(()=>({strategy:"plugin",sectionType:"focus-mode",title:d,subtitle:f,embedding:{method:"mood",mood:p,exploration:.3},limit:r}),[d,f,p,r]),{tracks:x,isLoading:y}=Vt(g,{enabled:!0,applyMLRanking:!0,applyTransformers:!0,limit:r}),b=(k,w)=>{a(x,w),o(k)};return!y&&x.length===0?null:c.jsxs("section",{id:n,className:"discover-horizontal-section discover-focus-section",children:[c.jsxs("div",{className:"discover-section-header",children:[c.jsxs("div",{className:"discover-section-title-row",children:[c.jsx("h2",{className:"discover-section-title",children:d}),c.jsx("span",{className:"discover-section-subtitle",children:f})]}),s&&c.jsx("button",{className:"discover-section-more",onClick:s,children:"See all"})]}),y?c.jsx("div",{className:"discover-horizontal-scroll",children:[1,2,3,4,5].map(k=>c.jsx("div",{className:"discover-card-skeleton"},k))}):c.jsx("div",{className:"discover-horizontal-scroll",children:x.map((k,w)=>c.jsx(ln,{track:k,onClick:()=>b(k,w),onContextMenu:l},k.id))})]})},hhe=({id:n,title:e,subtitle:t,onSeeAll:s,maxItems:r=10})=>{const{play:i,setQueue:o}=Ke(),{showContextMenu:a}=pt(),{hasCapability:l,getPluginsByRole:u}=ii(),d=l("stream-provider"),g=u("stream-provider").filter(C=>C.enabled).map(C=>C.name).join(", "),x=e||"Streaming Picks",y=t||(g?`From ${g}`:"From your streaming services"),b=j.useMemo(()=>({strategy:"plugin",sectionType:"streaming-highlights",title:x,subtitle:y,embedding:{method:"personalized",exploration:.4},limit:r}),[x,y,r]),{tracks:k,isLoading:w}=Vt(b,{enabled:d,applyMLRanking:!0,applyTransformers:!0,limit:r}),N=(C,S)=>{o(k,S),i(C)};return!d||!w&&k.length===0?null:c.jsxs("section",{id:n,className:"discover-horizontal-section discover-streaming-section",children:[c.jsxs("div",{className:"discover-section-header",children:[c.jsxs("div",{className:"discover-section-title-row",children:[c.jsx("h2",{className:"discover-section-title",children:x}),c.jsx("span",{className:"discover-section-subtitle",children:y})]}),s&&c.jsx("button",{className:"discover-section-more",onClick:s,children:"See all"})]}),w?c.jsx("div",{className:"discover-horizontal-scroll",children:[1,2,3,4,5,6].map(C=>c.jsx("div",{className:"discover-card-skeleton"},C))}):c.jsx("div",{className:"discover-horizontal-scroll",children:k.map((C,S)=>c.jsx(ln,{track:C,onClick:()=>N(C,S),onContextMenu:a},C.id))})]})},TI={energy:{title:"High Energy",subtitle:"AI-analyzed energetic tracks"},mood:{title:"Mood Match",subtitle:"AI-curated for your vibe"},tempo:{title:"Perfect Tempo",subtitle:"Matched to your rhythm"},mixed:{title:"AI Enhanced",subtitle:"Smart recommendations"}},fhe=({id:n,title:e,subtitle:t,onSeeAll:s,maxItems:r=8,analysisType:i="mixed"})=>{var A;const{play:o,setQueue:a}=Ke(),{showContextMenu:l}=pt(),{hasCapability:u,getPluginsByRole:d}=ii(),f=u("audio-processor"),p=d("audio-processor"),g=TI[i]||TI.mixed,x=e||g.title,y=p.length>0?` via ${(A=p[0])==null?void 0:A.name}`:"",b=t||g.subtitle+y,k=i==="energy"?"energetic":i==="mood"?"uplifting":void 0,w=k?"mood":"personalized",N=j.useMemo(()=>({strategy:"plugin",sectionType:"audio-analysis",title:x,subtitle:b,embedding:{method:w,mood:k,exploration:i==="energy"?.3:i==="mood"?.4:.35},limit:r}),[x,b,w,k,i,r]),{tracks:C,isLoading:S}=Vt(N,{enabled:f,applyMLRanking:!0,applyTransformers:!0,limit:r}),T=(E,M)=>{a(C,M),o(E)};return!f&&!S&&C.length===0?null:c.jsxs("section",{id:n,className:"discover-horizontal-section discover-audio-analysis-section",children:[c.jsxs("div",{className:"discover-section-header",children:[c.jsxs("div",{className:"discover-section-title-row",children:[c.jsx("h2",{className:"discover-section-title",children:x}),c.jsx("span",{className:"discover-section-subtitle",children:b})]}),s&&c.jsx("button",{className:"discover-section-more",onClick:s,children:"See all"})]}),S?c.jsx("div",{className:"discover-horizontal-scroll",children:[1,2,3,4,5].map(E=>c.jsx("div",{className:"discover-card-skeleton"},E))}):c.jsx("div",{className:"discover-horizontal-scroll",children:C.map((E,M)=>c.jsx(ln,{track:E,onClick:()=>T(E,M),onContextMenu:l},E.id))})]})},phe=({id:n,title:e,subtitle:t,onSeeAll:s,maxItems:r=8})=>{var k,w,N,C;const{play:i,setQueue:o,currentTrack:a,queue:l}=Ke(),{showContextMenu:u}=pt(),d=j.useMemo(()=>{if(a)return a;if(l&&l.length>0){const S=Math.min(5,l.length);return l[Math.floor(Math.random()*S)]}return null},[a,l]),f=d?{strategy:"plugin",sectionType:"similar-tracks",title:e||`More like "${d.title}"`,subtitle:t||`Similar to ${((w=(k=d.artists)==null?void 0:k[0])==null?void 0:w.name)||"your recent plays"}`,embedding:{method:"similar",seedTrackIds:[d.id],exploration:.3,includeCollaborative:!0,excludeTrackIds:[d.id]},limit:r}:null,{tracks:p,isLoading:g}=Vt(f,{enabled:!!d,applyMLRanking:!0,applyTransformers:!0,limit:r}),x=(S,T)=>{o(p,T),i(S)};if(!d||!g&&p.length===0)return null;const y=e||`More like "${d.title}"`,b=t||`Similar to ${((C=(N=d.artists)==null?void 0:N[0])==null?void 0:C.name)||"your recent plays"}`;return c.jsxs("section",{id:n,className:"discover-horizontal-section discover-similar-tracks-section",children:[c.jsxs("div",{className:"discover-section-header",children:[c.jsxs("div",{className:"discover-section-title-row",children:[c.jsx("h2",{className:"discover-section-title",children:y}),c.jsx("span",{className:"discover-section-subtitle",children:b})]}),s&&c.jsx("button",{className:"discover-section-more",onClick:s,children:"See all"})]}),g?c.jsx("div",{className:"discover-horizontal-scroll",children:[1,2,3,4,5].map(S=>c.jsx("div",{className:"discover-card-skeleton"},S))}):c.jsx("div",{className:"discover-horizontal-scroll",children:p.map((S,T)=>c.jsx(ln,{track:S,onClick:()=>x(S,T),onContextMenu:u},S.id))})]})},mhe={type:"hero",component:ude,displayName:"Featured",description:"Compact featured content with ambient background",requirements:{},constraints:{maxPerPage:1,preferredPosition:"top"},weights:{base:75,personalizedBoost:15},generateConfig:n=>({title:n.isNewUser?"Trending Now":"Made For You",subtitle:n.isNewUser?"Popular tracks right now":"Personalized mix based on your listening",query:n.isNewUser?"top hits 2024 trending":`${n.topArtists[0]??""} ${n.topGenres[0]??""} similar`,isPersonalized:!n.isNewUser})},ghe={type:"compact-list",component:wde,displayName:"Jump Back In",description:"Compact list for recently played tracks",requirements:{},constraints:{maxPerPage:1,preferredPosition:"top"},weights:{base:80,personalizedBoost:20},generateConfig:n=>({title:n.isNewUser?"Popular Right Now":"Jump Back In",query:n.isNewUser?"popular trending 2024":"recently played popular tracks",isPersonalized:!n.isNewUser})},xhe={type:"trending-tracks",component:Cde,displayName:"Trending Songs",description:"Hot tracks right now",requirements:{},constraints:{maxPerPage:1,preferredPosition:"top"},weights:{base:85,personalizedBoost:0,newUserBoost:20},generateConfig:()=>({title:"Trending Songs",subtitle:"Popular right now",query:"top hits 2024 trending popular",isPersonalized:!1})},yhe={type:"trending-artists",component:Sde,displayName:"Popular Artists",description:"Trending artists right now",requirements:{},constraints:{maxPerPage:1,cooldownSections:4},weights:{base:70,personalizedBoost:0,newUserBoost:15},generateConfig:()=>({title:"Popular Artists",subtitle:"Artists everyone is listening to",query:"trending popular artists 2024",isPersonalized:!1})},vhe={type:"artist-radio",component:Nde,displayName:"Artist Radio",description:"Tracks similar to your top artist",requirements:{},constraints:{maxPerPage:1,preferredPosition:"top"},weights:{base:75,personalizedBoost:25},generateConfig:n=>({title:n.topArtists[0]?`More like ${n.topArtists[0]}`:"Artist Radio",subtitle:n.topArtists[0]?"Based on your listening":"Discover similar artists",query:n.topArtists[0]?`${n.topArtists[0]} similar`:"popular artists 2024",isPersonalized:n.topArtists.length>0,whyExplanation:n.topArtists[0]?`You've played ${n.topArtists[0]} a lot`:void 0})},bhe={type:"because-you-like",component:pM,displayName:"Because You Like",description:"Recommendations based on a specific artist",requirements:{},constraints:{maxPerPage:2,cooldownSections:2},weights:{base:65,personalizedBoost:20},generateConfig:n=>{const e=n.topArtists[0],t=e?`Because you like ${e}`:"You Might Like";if(e){const s=e.toLowerCase().replace(/\s+/g,"-");return{title:t,query:`${e} similar artists`,structuredQuery:c$(s,e,t,{exploration:.3,includeCollaborative:!0,sectionType:"because-you-like"}),isPersonalized:!0,whyExplanation:`Fans of ${e} love these`}}return{title:t,query:"recommended music 2024",structuredQuery:Lm(t,{exploration:.5,sectionType:"because-you-like"}),isPersonalized:!1,whyExplanation:void 0}}},whe={type:"because-you-like",component:pM,displayName:"Because You Like",description:"Recommendations based on another artist",requirements:{minTopArtists:1},constraints:{maxPerPage:2,cooldownSections:3},weights:{base:55,personalizedBoost:15},generateConfig:n=>{const e=n.topArtists[1],t=e?`Because you like ${e}`:"More For You";if(e){const s=e.toLowerCase().replace(/\s+/g,"-");return{title:t,query:`${e} similar`,structuredQuery:c$(s,e,t,{exploration:.35,includeCollaborative:!0,sectionType:"because-you-like"}),isPersonalized:!0,whyExplanation:`Your taste for ${e}`}}return{title:t,query:"discover new music",structuredQuery:Lm(t,{exploration:.6,sectionType:"because-you-like"}),isPersonalized:!1,whyExplanation:void 0}}},khe={type:"new-releases",component:Ide,displayName:"New Releases",description:"Latest music releases",requirements:{},constraints:{maxPerPage:1,cooldownSections:5},weights:{base:60,personalizedBoost:10},generateConfig:n=>({title:"New Releases",subtitle:n.topGenres[0]?`In ${n.topGenres[0]}`:"Fresh music",query:n.topGenres[0]?`new releases ${n.topGenres[0]} 2024`:"new releases 2024 latest",isPersonalized:n.topGenres.length>0,whyExplanation:n.topGenres[0]?`Fresh ${n.topGenres[0]} for you`:"Just dropped this week"})},Che={type:"chart-list",component:Tde,displayName:"Top Charts",description:"Numbered list of trending tracks",requirements:{},constraints:{maxPerPage:1,preferredPosition:"top"},weights:{base:80,personalizedBoost:5,newUserBoost:15},generateConfig:()=>({title:"Top Charts",subtitle:"What everyone is listening to",query:"top charts hits 2024",isPersonalized:!1})},She={type:"quick-picks",component:$de,displayName:"Quick Picks",description:"Small tiles for quick access",requirements:{},constraints:{maxPerPage:1,preferredPosition:"top"},weights:{base:90,personalizedBoost:15,newUserBoost:10},generateConfig:n=>({title:"",query:n.topArtists[0]?`${n.topArtists[0]} similar recommendations`:"recommended popular tracks 2024",isPersonalized:n.topArtists.length>0})},Nhe={type:"grid",component:kde,displayName:"Discover",description:"Standard responsive grid of track cards",requirements:{},constraints:{maxPerPage:2,cooldownSections:3},weights:{base:55,personalizedBoost:15},generateConfig:n=>({title:n.topGenres[0]?`${n.topGenres[0]} Mix`:"Discover",query:n.topGenres[0]?`${n.topGenres[0]} best 2024`:"discover new music",isPersonalized:n.topGenres.length>0,whyExplanation:n.topGenres[0]?`Your love for ${n.topGenres[0]}`:void 0})},Ihe={type:"horizontal",component:hM,displayName:"Browse",description:"Horizontally scrollable row of content",requirements:{},constraints:{maxPerPage:3,cooldownSections:2},weights:{base:50,personalizedBoost:10},generateConfig:n=>({title:n.topGenres[1]?`${n.topGenres[1]} Hits`:"Popular Tracks",query:n.topGenres[1]?`${n.topGenres[1]} hits 2024`:"popular tracks 2024",isPersonalized:n.topGenres.length>1})},The={type:"large-cards",component:bde,displayName:"Highlights",description:"Large card grid with 2-3 columns (embedding-enhanced)",requirements:{},constraints:{maxPerPage:1,cooldownSections:4},weights:{base:45,personalizedBoost:15,timeRelevance:n=>n>=18&&n<22?15:0},generateConfig:n=>{const e=n.hour;return e>=6&&e<12?{title:"Morning Energy",query:"upbeat energizing morning",embedding:{type:"mood",id:"uplifting"},whyExplanation:"Perfect for starting your day"}:e>=12&&e<18?{title:"Afternoon Vibes",query:"popular trending afternoon",embedding:{type:"mood",id:"focus"},whyExplanation:"Keep the momentum going"}:e>=18&&e<22?{title:"Evening Wind Down",query:"chill relaxing evening",embedding:{type:"mood",id:"chill"},whyExplanation:"Time to unwind"}:{title:"Night Mode",query:"ambient calm night lofi",embedding:{type:"mood",id:"chill"},whyExplanation:"Late night listening"}}},$he={type:"artist-spotlight",component:Ede,displayName:"Featured Artist",description:"Magazine-style artist deep dive",requirements:{},constraints:{maxPerPage:1,cooldownSections:6,preferredPosition:"bottom"},weights:{base:45,personalizedBoost:25},generateConfig:n=>({title:n.topArtists[0]?`Spotlight: ${n.topArtists[0]}`:"Featured Artist",query:n.topArtists[0]||"popular artist 2024",isPersonalized:n.topArtists.length>0})},Ehe={type:"genre-explorer",component:Lde,displayName:"Explore Genres",description:"Browse music by genre",requirements:{},constraints:{maxPerPage:1,cooldownSections:5,preferredPosition:"middle"},weights:{base:55,personalizedBoost:10,newUserBoost:20},generateConfig:n=>{const e=n.topGenres[0]||"pop";return{title:"Explore Genres",subtitle:"Find your next favorite sound",query:"music genres discover variety",structuredQuery:NO(e,"Explore Genres",{exploration:.5,includeCollaborative:!0,sectionType:"genre-explorer",subtitle:"Find your next favorite sound"}),isPersonalized:!1}}},Ahe={type:"weekly-rotation",component:Fde,displayName:"Weekly Rotation",description:"Trending tracks by day",requirements:{},constraints:{maxPerPage:1,cooldownSections:6},weights:{base:50,personalizedBoost:5,newUserBoost:15},generateConfig:()=>({title:"Weekly Rotation",subtitle:"What's been trending this week",query:"trending this week popular 2024",isPersonalized:!1})},jhe={type:"banner",component:Bde,displayName:"Featured",description:"Promotional banner",requirements:{},constraints:{maxPerPage:1,preferredPosition:"top"},weights:{base:70,personalizedBoost:0,newUserBoost:25},generateConfig:()=>({title:"Featured",query:"featured popular hits 2024",isPersonalized:!1})},Rhe={type:"masonry",component:Ude,displayName:"Discover Grid",description:"Masonry layout of tracks",requirements:{},constraints:{maxPerPage:1,cooldownSections:4},weights:{base:55,personalizedBoost:15},generateConfig:n=>({title:n.topGenres[0]?`${n.topGenres[0]} Discoveries`:"Discover",query:n.topGenres[0]?`${n.topGenres[0]} best 2024`:"discover new music 2024",isPersonalized:n.topGenres.length>0})},Dhe={type:"mood-playlist",component:Hde,displayName:"Mood Playlists",description:"Interactive mood-based playlist generator",requirements:{},constraints:{maxPerPage:1,preferredPosition:"top",cooldownSections:6},weights:{base:80,personalizedBoost:10,newUserBoost:15},generateConfig:()=>({title:"Moods",subtitle:"Match your vibe",query:"mood music",isPersonalized:!1})},Phe={type:"horizontal",component:fM,displayName:"Chill Vibes",description:"Relaxing music (embedding-enhanced)",requirements:{},constraints:{maxPerPage:3,cooldownSections:2},weights:{base:50,personalizedBoost:10,timeRelevance:n=>n>=20||n<6?20:0},generateConfig:()=>({title:"Chill Vibes",subtitle:"Wind down with these tracks",query:"chill lofi relaxing music",embedding:{type:"mood",id:"chill"},structuredQuery:yb("chill","Chill Vibes",{exploration:.3,includeCollaborative:!0,sectionType:"horizontal",subtitle:"Wind down with these tracks"}),isPersonalized:!1})},Mhe={type:"horizontal",component:fM,displayName:"Energy Boost",description:"Upbeat music (embedding-enhanced)",requirements:{},constraints:{maxPerPage:3,cooldownSections:2},weights:{base:50,personalizedBoost:10,timeRelevance:n=>n>=6&&n<18?15:0},generateConfig:()=>({title:"Energy Boost",subtitle:"Get pumped up",query:"upbeat energetic workout music",embedding:{type:"mood",id:"energetic"},structuredQuery:yb("energetic","Energy Boost",{exploration:.3,includeCollaborative:!0,sectionType:"horizontal",subtitle:"Get pumped up"}),isPersonalized:!1})},Lhe={type:"time-greeting",component:Xde,displayName:"Time Greeting",description:"Context-aware greeting with personalized tracks",requirements:{},constraints:{maxPerPage:1,preferredPosition:"top"},weights:{base:85,personalizedBoost:15,timeRelevance:()=>10},generateConfig:n=>({title:"",isPersonalized:!0})},Fhe={type:"on-repeat",component:Yde,displayName:"On Repeat",description:"Your most played tracks",requirements:{minListens:5},constraints:{maxPerPage:1,cooldownSections:4},weights:{base:70,personalizedBoost:20},generateConfig:n=>({title:"On Repeat",subtitle:"Your heavy rotation",isPersonalized:!0,whyExplanation:n.userProfile.totalListens>50?`${n.userProfile.totalListens}+ plays and counting`:"Your favorites"})},Ohe={type:"discover-weekly",component:Zde,displayName:"Discover Weekly",description:"Mix of familiar and new music",requirements:{},constraints:{maxPerPage:1,cooldownSections:5},weights:{base:75,personalizedBoost:15},generateConfig:n=>({title:"Discover Weekly",subtitle:"Your personalized mix of new and familiar",isPersonalized:!0,whyExplanation:n.topGenres[0]?`Curated from your ${n.topGenres[0]} taste`:"Fresh picks for you"})},_he={type:"top-mix",component:Jde,displayName:"Your Top Mix",description:"Pure taste profile-based recommendations",requirements:{minListens:3},constraints:{maxPerPage:1,cooldownSections:4},weights:{base:70,personalizedBoost:25},generateConfig:n=>({title:"Your Top Mix",subtitle:"Based on everything you love",query:"personalized mix recommendations",structuredQuery:u$("Your Top Mix",{exploration:.2,includeCollaborative:!0,contextHour:n.hour,contextDayOfWeek:n.dayOfWeek,sectionType:"top-mix",subtitle:"Based on everything you love"}),isPersonalized:!0,whyExplanation:n.likedTracksCount>0?`From ${n.likedTracksCount} liked tracks`:"Matched to your taste"})},zhe={type:"rediscover",component:ehe,displayName:"Rediscover",description:"Old favorites you might have forgotten",requirements:{minListens:10},constraints:{maxPerPage:1,cooldownSections:6},weights:{base:55,personalizedBoost:20},generateConfig:()=>({title:"Rediscover",subtitle:"Tracks you might have forgotten",isPersonalized:!0})},Bhe={type:"activity",component:the,displayName:"Activity Playlists",description:"Music for what you're doing",requirements:{},constraints:{maxPerPage:1,cooldownSections:5},weights:{base:65,personalizedBoost:10,newUserBoost:15},generateConfig:()=>({title:"Activity Playlists",subtitle:"Music for what you're doing",isPersonalized:!1})},Whe={type:"decade-mix",component:nhe,displayName:"Decades",description:"Music through the years",requirements:{},constraints:{maxPerPage:1,cooldownSections:6},weights:{base:55,personalizedBoost:5,newUserBoost:10},generateConfig:()=>({title:"Decades",subtitle:"Music from your library through the years",isPersonalized:!1})},Vhe={type:"seasonal",component:rhe,displayName:"Seasonal",description:"Music for the season",requirements:{},constraints:{maxPerPage:1,cooldownSections:7},weights:{base:50,personalizedBoost:10},generateConfig:()=>({title:"",isPersonalized:!1})},Uhe={type:"blind-picks",component:ihe,displayName:"Blind Picks",description:"Random discovery to expand taste",requirements:{},constraints:{maxPerPage:1,cooldownSections:5},weights:{base:60,personalizedBoost:5,newUserBoost:20},generateConfig:()=>({title:"Blind Picks",subtitle:"Songs you haven't heard yet",isPersonalized:!1})},Ghe={type:"similar-artists",component:ohe,displayName:"Artist Radios",description:"Artist radios based on your favorites",requirements:{},constraints:{maxPerPage:1,cooldownSections:5},weights:{base:65,personalizedBoost:20},generateConfig:()=>({title:"Artist Radios",subtitle:"Click to play artist radio",isPersonalized:!0})},Hhe={type:"lyrics-highlight",component:ahe,displayName:"Lyrical Gems",description:"Tracks with notable lyrics (requires lyrics plugin)",requirements:{},constraints:{maxPerPage:1,cooldownSections:6},weights:{base:55,personalizedBoost:15},generateConfig:()=>({title:"Lyrical Gems",subtitle:"Songs worth singing along to",isPersonalized:!0})},qhe={type:"fresh-finds",component:lhe,displayName:"Fresh Finds",description:"ML-powered new music discovery",requirements:{},constraints:{maxPerPage:1,cooldownSections:4},weights:{base:70,personalizedBoost:15,newUserBoost:10},generateConfig:n=>({title:"Fresh Finds",subtitle:"Expand your horizons",query:"new music discovery 2024",structuredQuery:Lm("Fresh Finds",{exploration:.8,includeCollaborative:!0,contextHour:n.hour,contextDayOfWeek:n.dayOfWeek,sectionType:"fresh-finds",subtitle:"Expand your horizons"}),isPersonalized:!0,whyExplanation:n.topGenres[0]?`Beyond your usual ${n.topGenres[0]}`:"AI-curated for discovery"})},Khe={type:"deep-cuts",component:che,displayName:"Deep Cuts",description:"Hidden gems based on your favorites",requirements:{},constraints:{maxPerPage:1,cooldownSections:5},weights:{base:60,personalizedBoost:20},generateConfig:n=>({title:"Deep Cuts",subtitle:"Hidden gems you might love",query:"hidden gems underground music",structuredQuery:Lm("Deep Cuts",{exploration:.6,includeCollaborative:!0,sectionType:"deep-cuts",subtitle:"Hidden gems you might love"}),isPersonalized:!0,whyExplanation:n.topArtists[0]?`Like ${n.topArtists[0]}, but deeper`:"Less played, equally loved"})},Qhe={type:"focus-mode",component:dhe,displayName:"Focus Mode",description:"ML-curated music for concentration",requirements:{},constraints:{maxPerPage:1,cooldownSections:6},weights:{base:55,personalizedBoost:10,timeRelevance:n=>n>=9&&n<17?20:0},generateConfig:()=>({title:"Deep Work",subtitle:"Music for productivity",query:"focus concentration ambient lofi",structuredQuery:yb("focus","Deep Work",{exploration:.2,includeCollaborative:!0,sectionType:"focus-mode",subtitle:"Music for productivity"}),isPersonalized:!0})},Xhe={type:"streaming-highlights",component:hhe,displayName:"Streaming Picks",description:"Content from your streaming services",requirements:{},constraints:{maxPerPage:1,cooldownSections:5},weights:{base:60,personalizedBoost:15},generateConfig:()=>({title:"Streaming Picks",subtitle:"From your connected services",isPersonalized:!0})},Yhe={type:"audio-analysis",component:fhe,displayName:"AI Enhanced",description:"Smart recommendations via audio analysis",requirements:{},constraints:{maxPerPage:1,cooldownSections:5},weights:{base:55,personalizedBoost:15},generateConfig:()=>({title:"AI Enhanced",subtitle:"Smart recommendations",isPersonalized:!0})},Zhe={type:"similar-tracks",component:phe,displayName:"Similar Tracks",description:"ML-powered track similarity",requirements:{},constraints:{maxPerPage:1,cooldownSections:4},weights:{base:70,personalizedBoost:20},generateConfig:()=>({title:"Similar Tracks",subtitle:"More like what you're playing",query:"similar tracks recommendations",structuredQuery:u$("Similar Tracks",{exploration:.3,includeCollaborative:!0,sectionType:"similar-tracks",subtitle:"More like what you're playing"}),isPersonalized:!0})};let $I=!1;function Jhe(){$I||(lt.register(She),lt.register(mhe),lt.register(jhe),lt.register(Che),lt.register(xhe),lt.register(yhe),lt.register(vhe),lt.register(bhe),lt.register(whe),lt.register(khe),lt.register(ghe),lt.register(Nhe),lt.register(Ihe),lt.register(Phe),lt.register(Mhe),lt.register(Rhe),lt.register(The),lt.register(Ehe),lt.register(Ahe),lt.register(Dhe),lt.register(Lhe),lt.register(Fhe),lt.register(Ohe),lt.register(_he),lt.register(zhe),lt.register(Bhe),lt.register(Whe),lt.register(Vhe),lt.register(Uhe),lt.register(Ghe),lt.register($he),lt.register(Hhe),lt.register(qhe),lt.register(Khe),lt.register(Qhe),lt.register(Xhe),lt.register(Yhe),lt.register(Zhe),$I=!0,console.log("[SectionRegistry] Registered",lt.getAll().length,"sections"))}let EI=!1;EI||(Jhe(),EI=!0);const z0=()=>{const{openSectionDetail:n}=Wt(),e=dn,t=dn(g=>g.userProfile.totalListens),s=Xt(g=>g.likedTracks.length),r=Xt(g=>g.playlists.length),i=ii(g=>g.hasCapability),o=gt.useRef([]),[a,l]=j.useState([]),u=i("lyrics-provider"),d=j.useMemo(()=>{const g=e.getState();return SO({userProfile:g.userProfile,likedTracksCount:s,topArtists:g.getTopArtists(5),topGenres:g.getTopGenres(5),hasLyrics:u,hasPlaylists:r>0,playlistCount:r,recentSections:o.current})},[t,s,u,r]);j.useEffect(()=>{const g=lt.getAllSectionConfigs(d);l(g),o.current=[...g.map(x=>x.type),...o.current].slice(0,20)},[t,s]);const f=j.useCallback(g=>{(g.structuredQuery||g.query)&&n({title:g.title||"Browse",subtitle:g.subtitle,type:g.type,query:g.query,structuredQuery:g.structuredQuery})},[n]),p=j.useMemo(()=>{const g=new Date().getHours(),x=new Date().getDay(),y=x===0||x===6,b=d.topGenres,k=d.topArtists,w=t||0;let N="";g>=5&&g<12?N=y?"Lazy morning":"Morning":g>=12&&g<17?N="Afternoon":g>=17&&g<21?N=y?"Weekend vibes":"Evening":N="Late night";const C=[];if(b.length>0){const A=b[0].toLowerCase();C.push(`Your ${A} mood continues`),C.push(`More ${A} for you`),C.push(`Curated with your love for ${A}`)}if(k.length>0){const A=k[0];C.push(`Because you love ${A}`),C.push(`Inspired by your ${A} plays`)}w>100&&C.push(`Tailored from ${w}+ listens`),C.length===0&&(C.push("Fresh picks for you"),C.push("Discover something new"),C.push("Music curated for you"));const S=x%C.length,T=C[S];return{timeContext:N,contextPhrase:T}},[d.topGenres,d.topArtists,t]);return c.jsxs("div",{className:"discover",children:[c.jsxs("header",{className:"discover-header",children:[c.jsx("span",{className:"discover-greeting-time",children:p.timeContext}),c.jsx("span",{className:"discover-greeting-context",children:p.contextPhrase})]}),c.jsx("div",{className:"discover-sections",children:a.map((g,x)=>c.jsx(efe,{config:g,context:d,index:x,onSeeAll:()=>f(g)},g.id))})]})},efe=({config:n,context:e,index:t,onSeeAll:s})=>{const r=lt.get(n.type);if(!r)return console.warn(`[Discover] Unknown section type: ${n.type}`),null;const i=r.component;return c.jsx("div",{className:"discover-section-wrapper",style:{animationDelay:`${t*100}ms`},children:c.jsx(i,{id:n.id,type:n.type,title:n.title,subtitle:n.subtitle,query:n.query,isPersonalized:n.isPersonalized,whyExplanation:n.whyExplanation,context:e,onSeeAll:s})})},tfe=({isOpen:n,onClose:e,onFullSearch:t,inputValue:s})=>{const r=j.useRef(null),{results:i,isSearching:o,suggestions:a,search:l}=la(),{openArtist:u,openAlbum:d}=Wt(),{play:f,addToQueue:p}=Ke(),[g,x]=j.useState(""),y=j.useRef(null);j.useEffect(()=>(y.current&&clearTimeout(y.current),s.length>=2?y.current=setTimeout(()=>{x(s)},300):x(""),()=>{y.current&&clearTimeout(y.current)}),[s]),j.useEffect(()=>{g.length>=2&&l(g)},[g,l]),j.useEffect(()=>{if(!n)return;const L=O=>{if(r.current&&!r.current.contains(O.target)){if(O.target.closest(".search-bar"))return;e()}},_=O=>{O.key==="Escape"&&e()};return document.addEventListener("mousedown",L),document.addEventListener("keydown",_),()=>{document.removeEventListener("mousedown",L),document.removeEventListener("keydown",_)}},[n,e]);const b=j.useCallback(L=>{f(L),e()},[f,e]),k=j.useCallback(L=>{u(L.id,L),e()},[u,e]),w=j.useCallback(L=>{d(L.id,L),e()},[d,e]),N=j.useCallback(()=>{t(s),e()},[s,t,e]);if(!n)return null;const C=i.tracks.length>0||i.artists.length>0||i.albums.length>0||i.localTracks.length>0,S=a.length>0&&s.length>=2,T=C&&g.length>=2,A=!o&&g.length>=2&&!C,E=s.length<2,M=i.tracks.slice(0,4),P=i.artists.slice(0,3),R=i.albums.slice(0,3);return c.jsxs("div",{className:"search-dropdown",ref:r,children:[o&&c.jsxs("div",{className:"search-dropdown-loading",children:[c.jsx("div",{className:"search-dropdown-spinner"}),c.jsx("span",{children:"Searching..."})]}),E&&!o&&c.jsxs("div",{className:"search-dropdown-prompt",children:[c.jsx(Xu,{size:20}),c.jsx("span",{children:"Type to search for songs, artists, or albums"})]}),A&&c.jsx("div",{className:"search-dropdown-empty",children:c.jsxs("span",{children:['No results found for "',g,'"']})}),S&&!T&&!o&&c.jsxs("div",{className:"search-dropdown-section",children:[c.jsx("div",{className:"search-dropdown-section-title",children:"Suggestions"}),a.slice(0,5).map((L,_)=>c.jsxs("button",{className:"search-dropdown-suggestion",onClick:()=>t(L),children:[c.jsx(Xu,{size:14}),c.jsx("span",{children:L})]},_))]}),T&&!o&&c.jsxs(c.Fragment,{children:[M.length>0&&c.jsxs("div",{className:"search-dropdown-section",children:[c.jsxs("div",{className:"search-dropdown-section-title",children:[c.jsx(qe,{size:14}),c.jsx("span",{children:"Songs"})]}),M.map(L=>{var _;return c.jsxs("button",{className:"search-dropdown-item",onClick:()=>b(L),children:[c.jsx("div",{className:"search-dropdown-item-art",children:(_=L.artwork)!=null&&_.small?c.jsx("img",{src:L.artwork.small,alt:""}):c.jsx(qe,{size:16})}),c.jsxs("div",{className:"search-dropdown-item-info",children:[c.jsx("div",{className:"search-dropdown-item-title",children:L.title}),c.jsx("div",{className:"search-dropdown-item-subtitle",children:L.artists.map(O=>O.name).join(", ")})]})]},L.id)})]}),P.length>0&&c.jsxs("div",{className:"search-dropdown-section",children:[c.jsxs("div",{className:"search-dropdown-section-title",children:[c.jsx(Wp,{size:14}),c.jsx("span",{children:"Artists"})]}),P.map(L=>c.jsxs("button",{className:"search-dropdown-item",onClick:()=>k(L),children:[c.jsx("div",{className:"search-dropdown-item-art artist",children:L.image?c.jsx("img",{src:L.image,alt:""}):c.jsx(Wp,{size:16})}),c.jsxs("div",{className:"search-dropdown-item-info",children:[c.jsx("div",{className:"search-dropdown-item-title",children:L.name}),c.jsx("div",{className:"search-dropdown-item-subtitle",children:"Artist"})]})]},L.id))]}),R.length>0&&c.jsxs("div",{className:"search-dropdown-section",children:[c.jsxs("div",{className:"search-dropdown-section-title",children:[c.jsx(tv,{size:14}),c.jsx("span",{children:"Albums"})]}),R.map(L=>c.jsxs("button",{className:"search-dropdown-item",onClick:()=>w(L),children:[c.jsx("div",{className:"search-dropdown-item-art",children:L.artwork?c.jsx("img",{src:L.artwork,alt:""}):c.jsx(tv,{size:16})}),c.jsxs("div",{className:"search-dropdown-item-info",children:[c.jsx("div",{className:"search-dropdown-item-title",children:L.title}),c.jsx("div",{className:"search-dropdown-item-subtitle",children:L.artist})]})]},L.id))]}),c.jsxs("button",{className:"search-dropdown-see-all",onClick:N,children:[c.jsxs("span",{children:['See all results for "',s,'"']}),c.jsx(Yi,{size:16})]})]})]})},nfe=({onSearch:n,placeholder:e="Search for songs, artists, or albums...",onFocus:t,onBlur:s,onTyping:r,showDropdown:i=!0})=>{const{query:o,setQuery:a,search:l}=la(),[u,d]=j.useState(o),[f,p]=j.useState(!1),g=j.useRef(null),x=j.useCallback(S=>{S.preventDefault(),n?n(u):l(u),p(!1)},[u,l,n]),y=j.useCallback(S=>{const T=S.target.value;d(T),a(T),r==null||r(),i&&T.length>0&&p(!0)},[a,r,i]),b=j.useCallback(S=>{var T;S.key==="Enter"?(n?n(u):l(u),p(!1)):S.key==="Escape"&&(p(!1),(T=g.current)==null||T.blur())},[u,l,n]),k=j.useCallback(()=>{t==null||t(),i&&u.length>0&&p(!0)},[t,i,u]),w=j.useCallback(()=>{s==null||s(),setTimeout(()=>{},150)},[s]),N=j.useCallback(()=>{p(!1)},[]),C=j.useCallback(S=>{n?n(S):l(S),p(!1)},[n,l]);return c.jsxs("div",{className:"search-bar-container",children:[c.jsx("form",{className:"search-bar",onSubmit:x,children:c.jsx("input",{ref:g,type:"text",className:"search-input",placeholder:e,value:u,onChange:y,onKeyDown:b,onFocus:k,onBlur:w})}),i&&c.jsx(tfe,{isOpen:f,onClose:N,onFullSearch:C,inputValue:u})]})},sfe=({onSearch:n,onClose:e,isSearchActive:t})=>{const[s,r]=j.useState(!1),[i,o]=j.useState(!1),a=j.useRef(null);j.useEffect(()=>()=>{a.current&&clearTimeout(a.current)},[]);const l=()=>{r(!0)},u=()=>{r(!1)},d=()=>{o(!0),a.current&&clearTimeout(a.current),a.current=setTimeout(()=>{o(!1)},500)},f=()=>{e()},p=["floating-search",t?"active":"",s?"focused":"",i?"typing":""].filter(Boolean).join(" ");return c.jsxs(c.Fragment,{children:[c.jsx("div",{className:`floating-search-backdrop ${t?"visible":""}`,onClick:f}),c.jsxs("div",{className:p,children:[c.jsx("div",{className:"floating-search-spotlight"}),c.jsxs("div",{className:"floating-search-bar",children:[c.jsxs("button",{className:`floating-search-morph-icon ${t?"is-close":""}`,onClick:t?f:void 0,"aria-label":t?"Close search":"Search",type:"button",tabIndex:t?0:-1,children:[c.jsx("span",{className:"morph-icon morph-icon--search",children:c.jsx(Xu,{size:18})}),c.jsx("span",{className:"morph-icon morph-icon--close",children:c.jsx(an,{size:18})})]}),c.jsx(nfe,{onSearch:n,onFocus:l,onBlur:u,onTyping:d})]})]})]})},Oh=({track:n,index:e,isPlaying:t=!1,onClick:s,onContextMenu:r,compact:i=!1})=>{var d,f,p,g;const o=x=>{const y=Math.floor(x/60),b=Math.floor(x%60);return`${y}:${b.toString().padStart(2,"0")}`},a=((d=n.artists)==null?void 0:d.map(x=>x.name).join(", "))??"Unknown Artist",l=((f=n.artwork)==null?void 0:f.medium)??((g=(p=n.album)==null?void 0:p.artwork)==null?void 0:g.medium),u=x=>{r&&r(x,n)};return c.jsxs("div",{className:`track-row ${t?"playing":""} ${i?"compact":""}`,onClick:s,onContextMenu:u,children:[c.jsx("span",{className:"track-number",children:e}),l?c.jsx("img",{className:"track-artwork",src:l,alt:n.title,loading:"lazy"}):c.jsx("div",{className:"track-artwork-placeholder",children:c.jsx(qe,{size:20})}),c.jsxs("div",{className:"track-info",children:[c.jsx("div",{className:"track-title",children:n.title}),c.jsx("div",{className:"track-artist",children:a})]}),c.jsx("span",{className:"track-duration",children:o(n.duration)})]})},AI=({artist:n,onClick:e,onContextMenu:t})=>c.jsxs("div",{className:"artist-card",onClick:e,onContextMenu:t,children:[c.jsx("div",{className:"artist-card-image",children:n.image?c.jsx("img",{src:n.image,alt:n.name}):c.jsx("div",{className:"artist-card-placeholder",children:c.jsx(qe,{size:32})})}),c.jsxs("div",{className:"artist-card-info",children:[c.jsx("span",{className:"artist-card-name",children:n.name}),c.jsx("span",{className:"artist-card-type",children:"Artist"})]})]}),jI=({album:n,onClick:e,onContextMenu:t})=>c.jsxs("div",{className:"album-card",onClick:e,onContextMenu:t,children:[c.jsxs("div",{className:"album-card-image",children:[n.artwork?c.jsx("img",{src:n.artwork,alt:n.title}):c.jsx("div",{className:"album-card-placeholder",children:c.jsx(qe,{size:32})}),c.jsx("div",{className:"album-card-play",children:c.jsx(Et,{size:24})})]}),c.jsxs("div",{className:"album-card-info",children:[c.jsx("span",{className:"album-card-title",children:n.title}),c.jsx("span",{className:"album-card-artist",children:n.artist}),n.year&&c.jsx("span",{className:"album-card-year",children:n.year})]})]}),rfe=()=>{var C;const{results:n,isSearching:e,error:t,query:s,activeFilter:r,setActiveFilter:i}=la(),{play:o,setQueue:a,currentTrack:l}=Ke(),{openArtist:u,openAlbum:d}=Wt(),{showContextMenu:f}=pt(),{showContextMenu:p}=mx(),{showContextMenu:g}=Fh(),x=async(S,T)=>{a(n.tracks,T),await o(S)},y=S=>{u(S.id,S)},b=S=>{d(S.id,S)},k=[{id:"all",label:"All"},{id:"tracks",label:"Songs"},{id:"artists",label:"Artists"},{id:"albums",label:"Albums"}],w=n.tracks.length>0||n.artists.length>0||n.albums.length>0,N=n.tracks[0]||null;return e?c.jsx("div",{className:"search-results",children:c.jsxs("div",{className:"search-results-loading",children:[c.jsx("div",{className:"search-loading-spinner"}),c.jsx("span",{children:"Searching..."})]})}):t?c.jsx("div",{className:"search-results",children:c.jsx("div",{className:"search-results-error",children:t})}):s?w?c.jsxs("div",{className:"search-results",children:[c.jsx("div",{className:"search-filters",children:k.map(S=>c.jsx("button",{className:`search-filter-btn ${r===S.id?"active":""}`,onClick:()=>i(S.id),children:S.label},S.id))}),r==="all"&&c.jsxs("div",{className:"search-results-all",children:[c.jsxs("div",{className:"search-top-section",children:[N&&c.jsxs("div",{className:"search-top-result",children:[c.jsx("h3",{className:"search-section-title",children:"Top Result"}),c.jsxs("div",{className:"top-result-card",onClick:()=>x(N,0),children:[c.jsx("div",{className:"top-result-image",children:(C=N.artwork)!=null&&C.medium?c.jsx("img",{src:N.artwork.medium,alt:N.title}):c.jsx("div",{className:"top-result-placeholder",children:c.jsx(qe,{size:48})})}),c.jsxs("div",{className:"top-result-info",children:[c.jsx("span",{className:"top-result-title",children:N.title}),c.jsxs("div",{className:"top-result-meta",children:[c.jsx("span",{className:"top-result-artist",children:N.artists.map(S=>S.name).join(", ")}),c.jsx("span",{className:"top-result-type",children:"Song"})]})]}),c.jsx("button",{className:"top-result-play",children:c.jsx(Et,{size:24})})]})]}),n.tracks.length>0&&c.jsxs("div",{className:"search-songs-preview",children:[c.jsx("h3",{className:"search-section-title",children:"Songs"}),c.jsx("div",{className:"search-songs-list",children:n.tracks.slice(0,4).map((S,T)=>{var A;return c.jsxs("div",{className:`search-song-row ${(l==null?void 0:l.id)===S.id?"playing":""}`,onClick:()=>x(S,T),onContextMenu:E=>f(E,S),children:[c.jsx("div",{className:"search-song-image",children:(A=S.artwork)!=null&&A.small?c.jsx("img",{src:S.artwork.small,alt:S.title}):c.jsx(qe,{size:16})}),c.jsxs("div",{className:"search-song-info",children:[c.jsx("span",{className:"search-song-title",children:S.title}),c.jsx("span",{className:"search-song-artist",children:S.artists.map(E=>E.name).join(", ")})]}),c.jsx("span",{className:"search-song-duration",children:ife(S.duration)})]},S.id)})})]})]}),n.artists.length>0&&c.jsxs("div",{className:"search-section",children:[c.jsxs("div",{className:"search-section-header",children:[c.jsx("h3",{className:"search-section-title",children:"Artists"}),n.artists.length>6&&c.jsxs("button",{className:"search-see-all",onClick:()=>i("artists"),children:["See All ",c.jsx(Yi,{size:14})]})]}),c.jsx("div",{className:"search-horizontal-scroll",children:n.artists.map(S=>c.jsx(AI,{artist:S,onClick:()=>y(S),onContextMenu:T=>p(T,S)},S.id))})]}),n.albums.length>0&&c.jsxs("div",{className:"search-section",children:[c.jsxs("div",{className:"search-section-header",children:[c.jsx("h3",{className:"search-section-title",children:"Albums"}),n.albums.length>6&&c.jsxs("button",{className:"search-see-all",onClick:()=>i("albums"),children:["See All ",c.jsx(Yi,{size:14})]})]}),c.jsx("div",{className:"search-horizontal-scroll",children:n.albums.map(S=>c.jsx(jI,{album:S,onClick:()=>b(S),onContextMenu:T=>g(T,S)},S.id))})]})]}),r==="tracks"&&c.jsx("div",{className:"search-tracks-view",children:c.jsx("div",{className:"results-list",children:n.tracks.map((S,T)=>c.jsx(Oh,{track:S,index:T+1,isPlaying:(l==null?void 0:l.id)===S.id,onClick:()=>x(S,T),onContextMenu:f},S.id))})}),r==="artists"&&c.jsx("div",{className:"search-artists-view",children:c.jsx("div",{className:"search-artists-grid large",children:n.artists.map(S=>c.jsx(AI,{artist:S,onClick:()=>y(S),onContextMenu:T=>p(T,S)},S.id))})}),r==="albums"&&c.jsx("div",{className:"search-albums-view",children:c.jsx("div",{className:"search-albums-grid large",children:n.albums.map(S=>c.jsx(jI,{album:S,onClick:()=>b(S),onContextMenu:T=>g(T,S)},S.id))})})]}):c.jsx("div",{className:"search-results",children:c.jsxs("div",{className:"search-results-empty",children:['No results found for "',s,'"']})}):c.jsx("div",{className:"search-results",children:c.jsx("div",{className:"search-results-empty",children:"Search for tracks, artists, or albums"})})};function ife(n){if(!n)return"--:--";const e=Math.floor(n/60),t=Math.floor(n%60);return`${e}:${t.toString().padStart(2,"0")}`}const _h=({onPlay:n,onShuffle:e,disablePlay:t=!1,searchQuery:s,onSearchChange:r,searchPlaceholder:i="Search...",sortOptions:o,currentSort:a,onSortChange:l,filterOptions:u,currentFilter:d,onFilterChange:f,filterLabel:p,totalCount:g,filteredCount:x})=>{var M,P,R;const[y,b]=j.useState(!1),[k,w]=j.useState(!1),N=j.useRef(null),C=j.useRef(null),S=j.useRef(null);j.useEffect(()=>{const L=_=>{N.current&&!N.current.contains(_.target)&&b(!1),C.current&&!C.current.contains(_.target)&&w(!1)};return document.addEventListener("mousedown",L),()=>document.removeEventListener("mousedown",L)},[]);const T=((M=o==null?void 0:o.find(L=>L.value===a))==null?void 0:M.label)||"Sort",A=((P=u==null?void 0:u.find(L=>L.value===d))==null?void 0:P.label)||p||"Filter",E=x!==void 0&&g!==void 0&&x!==g;return c.jsxs("div",{className:"library-action-bar",children:[n&&c.jsxs("button",{className:"library-play-btn",onClick:n,disabled:t,children:[c.jsx(Et,{size:18}),c.jsx("span",{children:"Play"})]}),e&&c.jsx("button",{className:"library-shuffle-btn",onClick:e,disabled:t,title:"Shuffle",children:c.jsx(oo,{size:20})}),(n||e)&&c.jsx("div",{className:"library-action-separator"}),c.jsxs("div",{className:"library-search",children:[c.jsx(Xu,{size:16,className:"library-search-icon"}),c.jsx("input",{ref:S,type:"text",className:"library-search-input",placeholder:i,value:s,onChange:L=>r(L.target.value)}),s&&c.jsx("button",{className:"library-search-clear",onClick:()=>{var L;r(""),(L=S.current)==null||L.focus()},children:c.jsx(an,{size:14})})]}),E&&c.jsxs("span",{className:"library-results-count",children:[x," of ",g]}),u&&u.length>0&&f&&c.jsxs("div",{className:"library-filter",ref:C,children:[c.jsxs("button",{className:`library-filter-btn ${k?"active":""} ${d&&d!==((R=u[0])==null?void 0:R.value)?"has-filter":""}`,onClick:()=>w(!k),children:[c.jsx(rO,{size:14}),c.jsx("span",{children:A}),c.jsx(Fa,{size:12,className:`library-sort-chevron ${k?"open":""}`})]}),k&&c.jsx("div",{className:"library-filter-menu",children:u.map(L=>c.jsxs("button",{className:`library-filter-option ${d===L.value?"active":""}`,onClick:()=>{f(L.value),w(!1)},children:[c.jsx("span",{children:L.label}),L.count!==void 0&&c.jsx("span",{className:"library-filter-count",children:L.count})]},L.value))})]}),o&&o.length>0&&l&&c.jsxs("div",{className:"library-sort",ref:N,children:[c.jsxs("button",{className:`library-sort-btn ${y?"active":""}`,onClick:()=>b(!y),children:[c.jsx(iO,{size:14}),c.jsx("span",{children:T}),c.jsx(Fa,{size:12,className:`library-sort-chevron ${y?"open":""}`})]}),y&&c.jsx("div",{className:"library-sort-menu",children:o.map(L=>c.jsx("button",{className:`library-sort-option ${a===L.value?"active":""}`,onClick:()=>{l(L.value),b(!1)},children:L.label},L.value))})]})]})},ofe=[{value:"recent",label:"Recently Added"},{value:"oldest",label:"Oldest First"},{value:"title",label:"Title A-Z"},{value:"title-desc",label:"Title Z-A"},{value:"artist",label:"Artist A-Z"},{value:"artist-desc",label:"Artist Z-A"}],afe=n=>{const e=[...n];for(let t=e.length-1;t>0;t--){const s=Math.floor(Math.random()*(t+1));[e[t],e[s]]=[e[s],e[t]]}return e},lfe=()=>{const{likedTracks:n}=Xt(),{play:e,setQueue:t,currentTrack:s}=Ke(),{showContextMenu:r}=pt(),[i,o]=j.useState(""),[a,l]=j.useState("recent"),u=j.useMemo(()=>{let x=[...n];if(i.trim()){const y=i.toLowerCase();x=x.filter(b=>{var k,w;return b.track.title.toLowerCase().includes(y)||b.track.artists.some(N=>N.name.toLowerCase().includes(y))||((w=(k=b.track.album)==null?void 0:k.name)==null?void 0:w.toLowerCase().includes(y))})}switch(a){case"recent":x.sort((y,b)=>b.addedAt-y.addedAt);break;case"oldest":x.sort((y,b)=>y.addedAt-b.addedAt);break;case"title":x.sort((y,b)=>y.track.title.localeCompare(b.track.title));break;case"title-desc":x.sort((y,b)=>b.track.title.localeCompare(y.track.title));break;case"artist":x.sort((y,b)=>{var N,C;const k=((N=y.track.artists[0])==null?void 0:N.name)||"",w=((C=b.track.artists[0])==null?void 0:C.name)||"";return k.localeCompare(w)});break;case"artist-desc":x.sort((y,b)=>{var N,C;const k=((N=y.track.artists[0])==null?void 0:N.name)||"";return(((C=b.track.artists[0])==null?void 0:C.name)||"").localeCompare(k)});break}return x},[n,i,a]),d=j.useMemo(()=>u.map(x=>x.track),[u]),f=(x,y)=>{t(d,y),e(x)},p=()=>{d.length>0&&(t(d,0),e(d[0]))},g=()=>{if(d.length>0){const x=afe(d);t(x,0),e(x[0])}};return c.jsxs("div",{className:"library-view",children:[c.jsxs("header",{className:"library-header",children:[c.jsx("div",{className:"library-header-icon likes-icon",children:c.jsx(Sc,{size:64})}),c.jsxs("div",{className:"library-header-info",children:[c.jsx("span",{className:"library-header-type",children:"Collection"}),c.jsx("h1",{className:"library-header-title",children:"Liked Songs"}),c.jsxs("span",{className:"library-header-count",children:[n.length," songs"]})]})]}),n.length>0&&c.jsx(_h,{onPlay:p,onShuffle:g,disablePlay:d.length===0,searchQuery:i,onSearchChange:o,searchPlaceholder:"Search liked songs...",sortOptions:ofe,currentSort:a,onSortChange:l,totalCount:n.length,filteredCount:u.length}),c.jsx("div",{className:"library-content",children:n.length===0?c.jsxs("div",{className:"library-empty",children:[c.jsx("div",{className:"library-empty-icon",children:c.jsx(ic,{size:48})}),c.jsx("h3",{children:"Songs you like will appear here"}),c.jsx("p",{children:"Save songs by tapping the heart icon"})]}):u.length===0?c.jsxs("div",{className:"library-empty",children:[c.jsx("div",{className:"library-empty-icon",children:c.jsx(ic,{size:48})}),c.jsx("h3",{children:"No matching songs"}),c.jsx("p",{children:"Try adjusting your search"})]}):c.jsx("div",{className:"library-track-list",children:u.map((x,y)=>c.jsx(Oh,{track:x.track,index:y+1,isPlaying:(s==null?void 0:s.id)===x.track.id,onClick:()=>f(x.track,y),onContextMenu:r},x.track.id))})})]})},cfe=[{value:"recent",label:"Recently Added"},{value:"oldest",label:"Oldest First"},{value:"title",label:"Title A-Z"},{value:"title-desc",label:"Title Z-A"},{value:"artist",label:"Artist A-Z"},{value:"artist-desc",label:"Artist Z-A"}],ufe=n=>{const e=[...n];for(let t=e.length-1;t>0;t--){const s=Math.floor(Math.random()*(t+1));[e[t],e[s]]=[e[s],e[t]]}return e},dfe=()=>{const{dislikedTracks:n,undislikeTrack:e}=Xt(),{play:t,setQueue:s,currentTrack:r}=Ke(),{getDislikeReasons:i,removeDislike:o}=dn(),[a,l]=j.useState(""),[u,d]=j.useState("recent"),[f,p]=j.useState("all"),g=[{value:"all",label:"All Reasons"},...rv.map(S=>({value:S.value,label:S.label}))],x=S=>{const T=i(S);return T?T.map(A=>{var E;return((E=rv.find(M=>M.value===A))==null?void 0:E.label)||A}):[]},y=j.useMemo(()=>{let S=[...n];if(a.trim()){const T=a.toLowerCase();S=S.filter(A=>A.track.title.toLowerCase().includes(T)||A.track.artists.some(E=>E.name.toLowerCase().includes(T)))}switch(f&&f!=="all"&&(S=S.filter(T=>{const A=i(T.track.id);return A==null?void 0:A.includes(f)})),u){case"recent":S.sort((T,A)=>A.addedAt-T.addedAt);break;case"oldest":S.sort((T,A)=>T.addedAt-A.addedAt);break;case"title":S.sort((T,A)=>T.track.title.localeCompare(A.track.title));break;case"title-desc":S.sort((T,A)=>A.track.title.localeCompare(T.track.title));break;case"artist":S.sort((T,A)=>{var P,R;const E=((P=T.track.artists[0])==null?void 0:P.name)||"",M=((R=A.track.artists[0])==null?void 0:R.name)||"";return E.localeCompare(M)});break}return S},[n,a,u,f,i]),b=j.useMemo(()=>y.map(S=>S.track),[y]),k=(S,T)=>{s(b,T),t(S)},w=()=>{b.length>0&&(s(b,0),t(b[0]))},N=()=>{if(b.length>0){const S=ufe(b);s(S,0),t(S[0])}},C=(S,T)=>{T.stopPropagation(),o(S),e(S)};return c.jsxs("div",{className:"library-view",children:[c.jsxs("header",{className:"library-header",children:[c.jsx("div",{className:"library-header-icon dislikes-icon",children:c.jsx(ql,{size:64})}),c.jsxs("div",{className:"library-header-info",children:[c.jsx("span",{className:"library-header-type",children:"Collection"}),c.jsx("h1",{className:"library-header-title",children:"Disliked Songs"}),c.jsxs("span",{className:"library-header-count",children:[n.length," songs"]})]})]}),n.length>0&&c.jsx(_h,{onPlay:w,onShuffle:N,disablePlay:b.length===0,searchQuery:a,onSearchChange:l,searchPlaceholder:"Search disliked songs...",sortOptions:cfe,currentSort:u,onSortChange:d,filterOptions:g,currentFilter:f,onFilterChange:p,filterLabel:"Reason",totalCount:n.length,filteredCount:y.length}),c.jsx("div",{className:"library-content",children:n.length===0?c.jsxs("div",{className:"library-empty",children:[c.jsx("div",{className:"library-empty-icon",children:c.jsx(ql,{size:48})}),c.jsx("h3",{children:"Songs you dislike will appear here"}),c.jsx("p",{children:"Dislike songs to help improve your recommendations"})]}):y.length===0?c.jsxs("div",{className:"library-empty",children:[c.jsx("div",{className:"library-empty-icon",children:c.jsx(ql,{size:48})}),c.jsx("h3",{children:"No matching songs"}),c.jsx("p",{children:"Try adjusting your search or filter"})]}):c.jsx("div",{className:"library-track-list",children:y.map((S,T)=>{const A=x(S.track.id);return c.jsxs("div",{className:"dislike-track-item",children:[c.jsx(Oh,{track:S.track,index:T+1,isPlaying:(r==null?void 0:r.id)===S.track.id,onClick:()=>k(S.track,T)}),c.jsxs("div",{className:"dislike-reasons",children:[A.map((E,M)=>c.jsx("span",{className:"dislike-reason-tag",children:E},M)),c.jsxs("button",{className:"dislike-remove-btn",onClick:E=>C(S.track.id,E),title:"Remove from dislikes",children:[c.jsx(an,{size:12}),c.jsx("span",{children:"Remove"})]})]})]},S.track.id)})})})]})},hfe=[{value:"recent",label:"Recently Created"},{value:"name",label:"Name A-Z"},{value:"name-desc",label:"Name Z-A"},{value:"tracks",label:"Most Songs"},{value:"tracks-asc",label:"Fewest Songs"}],ffe=()=>{const{playlists:n,createPlaylist:e,deletePlaylist:t}=Xt(),{openPlaylist:s}=Wt(),{play:r,setQueue:i}=Ke(),{isCreatePlaylistModalOpen:o,openCreatePlaylistModal:a,closeCreatePlaylistModal:l}=el(),[u,d]=j.useState(null),[f,p]=j.useState(""),[g,x]=j.useState("recent"),y=j.useMemo(()=>{let C=[...n];if(f.trim()){const S=f.toLowerCase();C=C.filter(T=>T.name.toLowerCase().includes(S))}switch(g){case"name":C.sort((S,T)=>S.name.localeCompare(T.name));break;case"name-desc":C.sort((S,T)=>T.name.localeCompare(S.name));break;case"tracks":C.sort((S,T)=>T.tracks.length-S.tracks.length);break;case"tracks-asc":C.sort((S,T)=>S.tracks.length-T.tracks.length);break}return C},[n,f,g]),b=C=>{const S=e(C);s(S.id)},k=(C,S)=>{C.stopPropagation(),d(S)},w=()=>{u&&(t(u),d(null))},N=(C,S)=>{C.stopPropagation();const T=n.find(A=>A.id===S);T&&T.tracks.length>0&&(i(T.tracks,0),r(T.tracks[0]))};return c.jsxs("div",{className:"library-view",children:[c.jsxs("header",{className:"library-header",children:[c.jsx("div",{className:"library-header-icon playlists-icon",children:c.jsx(yi,{size:64})}),c.jsxs("div",{className:"library-header-info",children:[c.jsx("span",{className:"library-header-type",children:"Library"}),c.jsx("h1",{className:"library-header-title",children:"Playlists"}),c.jsxs("span",{className:"library-header-count",children:[n.length," playlists"]})]})]}),n.length>0&&c.jsx(_h,{searchQuery:f,onSearchChange:p,searchPlaceholder:"Search playlists...",sortOptions:hfe,currentSort:g,onSortChange:x,totalCount:n.length,filteredCount:y.length}),c.jsx("div",{className:"library-content playlists-grid",children:n.length===0?c.jsxs("div",{className:"library-empty library-empty-centered",children:[c.jsx("div",{className:"library-empty-icon",children:c.jsx(yi,{size:48})}),c.jsx("h3",{children:"Create your first playlist"}),c.jsx("p",{children:"Organize your favorite tracks"}),c.jsxs("button",{className:"library-create-button",onClick:a,children:[c.jsx(Zi,{size:18})," Create Playlist"]})]}):y.length===0?c.jsxs("div",{className:"library-empty library-empty-centered",children:[c.jsx("div",{className:"library-empty-icon",children:c.jsx(yi,{size:48})}),c.jsx("h3",{children:"No matching playlists"}),c.jsx("p",{children:"Try a different search term"})]}):y.map(C=>c.jsxs("div",{className:"playlist-card",onClick:()=>s(C.id),children:[c.jsxs("div",{className:"playlist-card-artwork",children:[c.jsx(r$,{tracks:C.tracks,name:C.name,size:"lg"}),c.jsx("div",{className:"playlist-card-overlay",children:c.jsx("button",{className:"playlist-card-play",onClick:S=>N(S,C.id),disabled:C.tracks.length===0,children:c.jsx(Et,{size:24})})})]}),c.jsxs("div",{className:"playlist-card-info",children:[c.jsx("div",{className:"playlist-card-name",children:C.name}),c.jsxs("div",{className:"playlist-card-count",children:[C.tracks.length," songs"]})]}),c.jsx("button",{className:"playlist-card-delete",onClick:S=>k(S,C.id),title:"Delete playlist",children:c.jsx(an,{size:16})})]},C.id))}),o&&c.jsx(sv,{title:"Create Playlist",placeholder:"Playlist name",submitLabel:"Create",onSubmit:b,onClose:l,icon:c.jsx(yi,{size:20})}),u&&c.jsx("div",{className:"modal-overlay",children:c.jsxs("div",{className:"modal modal-small",children:[c.jsxs("header",{className:"modal-header",children:[c.jsx("h2",{children:"Delete Playlist?"}),c.jsx("button",{className:"modal-close",onClick:()=>d(null),children:c.jsx(an,{size:20})})]}),c.jsxs("div",{className:"modal-content",children:[c.jsx("p",{style:{color:"var(--text-secondary)",marginBottom:"16px"},children:"This action cannot be undone."}),c.jsxs("div",{className:"modal-actions",children:[c.jsx("button",{className:"modal-button secondary",onClick:()=>d(null),children:"Cancel"}),c.jsx("button",{className:"modal-button primary",onClick:w,style:{background:"var(--danger)"},children:"Delete"})]})]})]})})]})},pfe=[{value:"custom",label:"Custom Order"},{value:"title",label:"Title A-Z"},{value:"title-desc",label:"Title Z-A"},{value:"artist",label:"Artist A-Z"},{value:"artist-desc",label:"Artist Z-A"}],mfe=n=>{const e=[...n];for(let t=e.length-1;t>0;t--){const s=Math.floor(Math.random()*(t+1));[e[t],e[s]]=[e[s],e[t]]}return e},gfe=()=>{var R,L,_,O,U;const{selectedPlaylistId:n,goBack:e}=Wt(),{playlists:t,renamePlaylist:s,removeFromPlaylist:r}=Xt(),{play:i,setQueue:o,currentTrack:a}=Ke(),{showContextMenu:l}=pt(),[u,d]=j.useState(""),[f,p]=j.useState("custom"),[g,x]=j.useState(!1),[y,b]=j.useState(""),k=t.find(W=>W.id===n),w=j.useMemo(()=>{if(!k)return[];let W=[...k.tracks];if(u.trim()){const H=u.toLowerCase();W=W.filter(G=>{var q,Q;return G.title.toLowerCase().includes(H)||G.artists.some(z=>z.name.toLowerCase().includes(H))||((Q=(q=G.album)==null?void 0:q.name)==null?void 0:Q.toLowerCase().includes(H))})}switch(f){case"title":W.sort((H,G)=>H.title.localeCompare(G.title));break;case"title-desc":W.sort((H,G)=>G.title.localeCompare(H.title));break;case"artist":W.sort((H,G)=>{var z,K;const q=((z=H.artists[0])==null?void 0:z.name)||"",Q=((K=G.artists[0])==null?void 0:K.name)||"";return q.localeCompare(Q)});break;case"artist-desc":W.sort((H,G)=>{var z,K;const q=((z=H.artists[0])==null?void 0:z.name)||"";return(((K=G.artists[0])==null?void 0:K.name)||"").localeCompare(q)});break}return W},[k,u,f]);if(!k)return c.jsx("div",{className:"library-view",children:c.jsxs("div",{className:"library-empty",children:[c.jsx("h3",{children:"Playlist not found"}),c.jsx("button",{onClick:e,children:"Go back"})]})});const N=(W,H)=>{o(w,H),i(W)},C=()=>{w.length>0&&(o(w,0),i(w[0]))},S=()=>{if(w.length>0){const W=mfe(w);o(W,0),i(W[0])}},T=()=>{b(k.name),x(!0)},A=()=>{y.trim()&&y!==k.name&&s(k.id,y.trim()),x(!1)},E=W=>{W.key==="Enter"?A():W.key==="Escape"&&x(!1)},M=(W,H)=>{W.stopPropagation(),r(k.id,H)},P=((L=(R=k.tracks[0])==null?void 0:R.artwork)==null?void 0:L.medium)??((U=(O=(_=k.tracks[0])==null?void 0:_.album)==null?void 0:O.artwork)==null?void 0:U.medium);return c.jsxs("div",{className:"library-view",children:[c.jsxs("header",{className:"library-header playlist-detail-header",children:[c.jsx("button",{className:"back-btn-round playlist-back-btn-pos",onClick:e,"aria-label":"Go back",children:c.jsx(Cc,{size:20})}),c.jsx("div",{className:"playlist-detail-artwork",children:P?c.jsx("img",{src:P,alt:k.name}):c.jsx("div",{className:"playlist-detail-artwork-placeholder",children:c.jsx(qe,{size:48})})}),c.jsxs("div",{className:"library-header-info",children:[c.jsx("span",{className:"library-header-type",children:"Playlist"}),g?c.jsx("input",{type:"text",className:"playlist-name-input",value:y,onChange:W=>b(W.target.value),onBlur:A,onKeyDown:E,autoFocus:!0}):c.jsxs("div",{className:"playlist-title-row",children:[c.jsx("h1",{className:"library-header-title",children:k.name}),c.jsx("button",{className:"playlist-edit-btn",onClick:T,title:"Rename playlist",children:c.jsx(ZT,{size:18})})]}),c.jsxs("span",{className:"library-header-count",children:[k.tracks.length," songs"]})]})]}),k.tracks.length>0&&c.jsx(_h,{onPlay:C,onShuffle:S,disablePlay:w.length===0,searchQuery:u,onSearchChange:d,searchPlaceholder:"Search in playlist...",sortOptions:pfe,currentSort:f,onSortChange:p,totalCount:k.tracks.length,filteredCount:w.length}),c.jsx("div",{className:"library-content",children:k.tracks.length===0?c.jsxs("div",{className:"library-empty",children:[c.jsx("div",{className:"library-empty-icon",children:c.jsx(qe,{size:48})}),c.jsx("h3",{children:"This playlist is empty"}),c.jsx("p",{children:"Search for songs and add them here"})]}):w.length===0?c.jsxs("div",{className:"library-empty",children:[c.jsx("div",{className:"library-empty-icon",children:c.jsx(qe,{size:48})}),c.jsx("h3",{children:"No matching songs"}),c.jsx("p",{children:"Try adjusting your search"})]}):c.jsx("div",{className:"library-track-list",children:w.map((W,H)=>c.jsxs("div",{className:"playlist-track-row",children:[c.jsx(Oh,{track:W,index:H+1,isPlaying:(a==null?void 0:a.id)===W.id,onClick:()=>N(W,H),onContextMenu:l}),c.jsx("button",{className:"playlist-track-remove",onClick:G=>M(G,W.id),title:"Remove from playlist",children:c.jsx(an,{size:16})})]},W.id))})})]})},xfe=[{value:"recent",label:"Recently Added"},{value:"title",label:"Title A-Z"},{value:"title-desc",label:"Title Z-A"},{value:"artist",label:"Artist A-Z"}],RI={all:"All Downloads",completed:"Completed",in_progress:"In Progress",failed:"Failed"},yfe=()=>{const{downloads:n,removeDownload:e,retryDownload:t}=Xt(),{play:s,setQueue:r,currentTrack:i}=Ke(),[o,a]=j.useState(""),[l,u]=j.useState("recent"),[d,f]=j.useState("all"),p=n.filter(T=>T.status==="completed"),g=n.filter(T=>T.status!=="completed"),x=n.filter(T=>T.status==="failed"),y=j.useMemo(()=>{let T=[...n];if(o.trim()){const A=o.toLowerCase();T=T.filter(E=>E.track.title.toLowerCase().includes(A)||E.track.artists.some(M=>M.name.toLowerCase().includes(A)))}switch(d){case"completed":T=T.filter(A=>A.status==="completed");break;case"in_progress":T=T.filter(A=>A.status==="pending"||A.status==="downloading");break;case"failed":T=T.filter(A=>A.status==="failed");break}switch(l){case"title":T.sort((A,E)=>A.track.title.localeCompare(E.track.title));break;case"title-desc":T.sort((A,E)=>E.track.title.localeCompare(A.track.title));break;case"artist":T.sort((A,E)=>{var R,L;const M=((R=A.track.artists[0])==null?void 0:R.name)||"",P=((L=E.track.artists[0])==null?void 0:L.name)||"";return M.localeCompare(P)});break}return T},[n,o,d,l]),b=y.filter(T=>T.status==="completed"),k=y.filter(T=>T.status!=="completed"),w=T=>{if(T.status==="completed"){const A=b.map(M=>M.track),E=A.findIndex(M=>M.id===T.track.id);r(A,E),s(T.track)}},N=T=>`${Math.round(T)}%`,C={all:n.length,completed:p.length,in_progress:g.length-x.length,failed:x.length},S=Object.keys(RI).map(T=>({value:T,label:RI[T],count:C[T]}));return c.jsxs("div",{className:"library-view",children:[c.jsxs("header",{className:"library-header",children:[c.jsx("div",{className:"library-header-icon downloads-icon",children:c.jsx(Ir,{size:64})}),c.jsxs("div",{className:"library-header-info",children:[c.jsx("span",{className:"library-header-type",children:"Library"}),c.jsx("h1",{className:"library-header-title",children:"Downloads"}),c.jsxs("span",{className:"library-header-count",children:[p.length," downloaded",g.length>0&&`  ${g.length} in progress`]})]})]}),n.length>0&&c.jsx(_h,{searchQuery:o,onSearchChange:a,searchPlaceholder:"Search downloads...",sortOptions:xfe,currentSort:l,onSortChange:u,filterOptions:S,currentFilter:d,onFilterChange:T=>f(T),filterLabel:"Status",totalCount:n.length,filteredCount:y.length}),c.jsxs("div",{className:"library-content downloads-content",children:[k.length>0&&c.jsxs("section",{className:"downloads-section",children:[c.jsx("h2",{className:"downloads-section-title",children:"In Progress"}),c.jsx("div",{className:"downloads-list",children:k.map(T=>{var A;return c.jsxs("div",{className:"download-item",children:[c.jsx("div",{className:"download-artwork",children:(A=T.track.artwork)!=null&&A.medium?c.jsx("img",{src:T.track.artwork.medium,alt:T.track.title}):c.jsx("div",{className:"download-artwork-placeholder",children:c.jsx(qe,{size:24})})}),c.jsxs("div",{className:"download-info",children:[c.jsx("div",{className:"download-title",children:T.track.title}),c.jsx("div",{className:"download-artist",children:T.track.artists.map(E=>E.name).join(", ")}),T.status==="downloading"&&c.jsxs("div",{className:"download-progress",children:[c.jsx("div",{className:"download-progress-bar",style:{"--progress":`${T.progress}%`}}),c.jsx("span",{className:"download-progress-text",children:N(T.progress)})]}),T.status==="pending"&&c.jsx("div",{className:"download-status",children:"Waiting..."}),T.status==="failed"&&c.jsx("div",{className:"download-status error",children:T.error||"Download failed"})]}),c.jsxs("div",{className:"download-actions",children:[T.status==="failed"&&c.jsx("button",{className:"download-retry",onClick:()=>t(T.track.id),title:"Retry",children:c.jsx(sr,{size:18})}),c.jsx("button",{className:"download-remove",onClick:()=>e(T.track.id),title:"Cancel",children:c.jsx(an,{size:18})})]})]},T.track.id)})})]}),c.jsxs("section",{className:"downloads-section",children:[c.jsxs("h2",{className:"downloads-section-title",children:["Downloaded",b.length>0&&c.jsx("span",{className:"downloads-section-count",children:b.length})]}),n.length===0?c.jsxs("div",{className:"library-empty",children:[c.jsx("div",{className:"library-empty-icon",children:c.jsx(Ir,{size:48})}),c.jsx("h3",{children:"No downloads yet"}),c.jsx("p",{children:"Download songs to listen offline"})]}):b.length===0&&d!=="in_progress"&&d!=="failed"?c.jsxs("div",{className:"library-empty",children:[c.jsx("div",{className:"library-empty-icon",children:c.jsx(Ir,{size:48})}),c.jsx("h3",{children:"No matching downloads"}),c.jsx("p",{children:"Try adjusting your search or filter"})]}):b.length>0?c.jsx("div",{className:"downloads-list",children:b.map(T=>{var A;return c.jsxs("div",{className:`download-item completed ${(i==null?void 0:i.id)===T.track.id?"playing":""}`,onClick:()=>w(T),children:[c.jsxs("div",{className:"download-artwork",children:[(A=T.track.artwork)!=null&&A.medium?c.jsx("img",{src:T.track.artwork.medium,alt:T.track.title}):c.jsx("div",{className:"download-artwork-placeholder",children:c.jsx(qe,{size:24})}),c.jsx("div",{className:"download-play-overlay",children:c.jsx(Et,{size:24})})]}),c.jsxs("div",{className:"download-info",children:[c.jsx("div",{className:"download-title",children:T.track.title}),c.jsx("div",{className:"download-artist",children:T.track.artists.map(E=>E.name).join(", ")}),c.jsxs("div",{className:"download-status success",children:[c.jsx(X4,{size:12})," Downloaded"]})]}),c.jsx("button",{className:"download-remove",onClick:E=>{E.stopPropagation(),e(T.track.id)},title:"Remove",children:c.jsx(an,{size:18})})]},T.track.id)})}):null]})]})]})},vfe=()=>`folder-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,fi=async(n,e)=>{var t;if((t=window.api)!=null&&t.updateSettings)try{await window.api.updateSettings(n,e)}catch(s){console.error(`Failed to sync setting ${n}:`,s)}},vc=An()(Er((n,e)=>({downloadFolder:null,pluginFolder:null,localMusicFolders:[],crossfadeEnabled:!1,crossfadeDuration:3,normalizeVolume:!0,downloadQuality:"high",autoDownloadLikes:!1,demucsConfig:{useLocalFiles:!0,cdnBaseUrl:null,preferredModel:"htdemucs",autoEnableHQ:!0},demucsInstalled:!1,demucsEnabled:!0,demucsVersion:null,customRelayUrl:null,remoteAccessEnabled:!0,setDownloadFolder:t=>{n({downloadFolder:t}),fi("downloadFolder",t)},setPluginFolder:t=>{n({pluginFolder:t}),fi("pluginFolder",t)},addLocalMusicFolder:t=>{const s={...t,id:vfe(),trackCount:0,lastScanned:null,isScanning:!1};n(r=>({localMusicFolders:[...r.localMusicFolders,s]})),fi("localMusicFolders",e().localMusicFolders)},removeLocalMusicFolder:t=>{n(s=>({localMusicFolders:s.localMusicFolders.filter(r=>r.id!==t)})),fi("localMusicFolders",e().localMusicFolders)},updateLocalMusicFolder:(t,s)=>{n(r=>({localMusicFolders:r.localMusicFolders.map(i=>i.id===t?{...i,...s}:i)}))},setCrossfadeEnabled:t=>{n({crossfadeEnabled:t})},setCrossfadeDuration:t=>{n({crossfadeDuration:t})},setNormalizeVolume:t=>{n({normalizeVolume:t})},setDownloadQuality:t=>{n({downloadQuality:t})},setAutoDownloadLikes:t=>{n({autoDownloadLikes:t})},updateDemucsConfig:t=>{n(s=>({demucsConfig:{...s.demucsConfig,...t}})),fi("demucsConfig",e().demucsConfig)},setDemucsInstalled:t=>{n({demucsInstalled:t}),fi("demucsInstalled",t)},setDemucsEnabled:t=>{n({demucsEnabled:t}),fi("demucsEnabled",t)},setDemucsVersion:t=>{n({demucsVersion:t}),fi("demucsVersion",t)},setCustomRelayUrl:t=>{n({customRelayUrl:t}),fi("customRelayUrl",t)},setRemoteAccessEnabled:t=>{n({remoteAccessEnabled:t}),fi("remoteAccessEnabled",t)}}),{name:"audiio-settings",partialize:n=>({downloadFolder:n.downloadFolder,pluginFolder:n.pluginFolder,localMusicFolders:n.localMusicFolders.map(e=>({...e,isScanning:!1})),crossfadeEnabled:n.crossfadeEnabled,crossfadeDuration:n.crossfadeDuration,normalizeVolume:n.normalizeVolume,downloadQuality:n.downloadQuality,autoDownloadLikes:n.autoDownloadLikes,demucsConfig:n.demucsConfig,demucsInstalled:n.demucsInstalled,demucsEnabled:n.demucsEnabled,demucsVersion:n.demucsVersion,customRelayUrl:n.customRelayUrl,remoteAccessEnabled:n.remoteAccessEnabled})})),mM={metadata:"Metadata",streaming:"Streaming",lyrics:"Lyrics",translation:"Translation",scrobbling:"Scrobbling",analysis:"Analysis",audio:"Audio",tool:"Tool",other:"Other"},Sm={metadata:"var(--color-access-metadata)",streaming:"var(--color-access-streaming)",lyrics:"var(--color-access-lyrics)",translation:"var(--color-access-translation, var(--color-access-lyrics))",scrobbling:"var(--color-access-scrobbling)",analysis:"var(--color-access-analysis, var(--color-access-metadata))",audio:"var(--color-access-audio, var(--color-access-streaming))",tool:"var(--color-access-tool, var(--color-primary))",other:"var(--color-access-other)"},bfe=({plugin:n,index:e,onClick:t,onToggle:s,isDraggable:r=!0})=>{const{attributes:i,listeners:o,setNodeRef:a,transform:l,transition:u,isDragging:d}=Rm({id:n.id,disabled:!r}),f={transform:ei.Transform.toString(l),transition:u,opacity:d?.5:1,zIndex:d?1e3:"auto"},p=g=>{g.stopPropagation(),s()};return c.jsxs("div",{ref:a,style:f,className:`plugin-card ${d?"dragging":""}`,onClick:t,children:[r&&c.jsxs("div",{className:"plugin-card-drag-handle",...i,...o,onClick:g=>g.stopPropagation(),children:[c.jsx(Mm,{size:20}),c.jsx("span",{className:"plugin-card-priority",children:e+1})]}),c.jsx("div",{className:"plugin-card-icon",style:{background:Sm[n.category]},children:n.icon?c.jsx("img",{src:n.icon,alt:n.name}):c.jsx(Qi,{size:28})}),c.jsxs("div",{className:"plugin-card-info",children:[c.jsxs("div",{className:"plugin-card-header",children:[c.jsx("h3",{className:"plugin-card-name",children:n.name}),c.jsxs("span",{className:"plugin-card-version",children:["v",n.version]})]}),c.jsx("p",{className:"plugin-card-description",children:n.description}),c.jsxs("div",{className:"plugin-card-meta",children:[c.jsx("span",{className:"plugin-card-category",style:{color:Sm[n.category]},children:mM[n.category]}),c.jsxs("span",{className:"plugin-card-author",children:["by ",n.author]})]})]}),c.jsxs("div",{className:"plugin-card-actions",children:[c.jsxs("label",{className:"plugin-toggle",onClick:p,children:[c.jsx("input",{type:"checkbox",checked:n.enabled,readOnly:!0,disabled:!n.installed}),c.jsx("span",{className:"plugin-toggle-slider"})]}),c.jsx(Yi,{size:20,className:"plugin-card-arrow"})]})]})},wfe=({plugin:n,isInstalled:e,isInstalling:t,onInstall:s})=>{const i=(o=>o.includes("tool")?"tool":o.includes("metadata-provider")?"metadata":o.includes("stream-provider")?"streaming":o.includes("lyrics-provider")?"lyrics":o.includes("scrobbler")?"scrobbling":o.includes("audio-processor")?"audio":"other")(n.roles);return c.jsxs("div",{className:"plugin-card browse-plugin-card",children:[c.jsx("div",{className:"plugin-card-icon",style:{background:Sm[i]},children:n.icon?c.jsx("img",{src:n.icon,alt:n.name}):c.jsx(Qi,{size:28})}),c.jsxs("div",{className:"plugin-card-info",children:[c.jsxs("div",{className:"plugin-card-header",children:[c.jsx("h3",{className:"plugin-card-name",children:n.name}),c.jsxs("span",{className:"plugin-card-version",children:["v",n.version]})]}),c.jsx("p",{className:"plugin-card-description",children:n.description}),c.jsxs("div",{className:"plugin-card-meta",children:[c.jsx("span",{className:"plugin-card-category",style:{color:Sm[i]},children:mM[i]}),c.jsxs("span",{className:"plugin-card-author",children:["by ",n.author]})]})]}),c.jsx("div",{className:"plugin-card-actions",children:e?c.jsxs("span",{className:"plugin-installed-badge",children:[c.jsx(Ji,{size:16}),"Installed"]}):c.jsxs("button",{className:"plugin-install-button",onClick:s,disabled:t,children:[t?c.jsx(sr,{size:16,className:"spinning"}):c.jsx(Ir,{size:16}),t?"Installing...":"Install"]})})]})},kfe=({update:n,pluginName:e,onUpdate:t,isUpdating:s})=>c.jsxs("div",{className:"plugin-card update-card",children:[c.jsx("div",{className:"plugin-card-icon",style:{background:"var(--color-primary)"},children:c.jsx(Qi,{size:28})}),c.jsxs("div",{className:"plugin-card-info",children:[c.jsx("div",{className:"plugin-card-header",children:c.jsx("h3",{className:"plugin-card-name",children:e})}),c.jsxs("p",{className:"plugin-card-description",children:["Update available: v",n.currentVersion,"  v",n.latestVersion]})]}),c.jsx("div",{className:"plugin-card-actions",children:c.jsxs("button",{className:"plugin-update-button",onClick:t,disabled:s,children:[s?c.jsx(sr,{size:16,className:"spinning"}):c.jsx(Ir,{size:16}),s?"Updating...":"Update"]})})]}),Cfe=({repo:n,onRemove:e,onToggle:t,onRefresh:s,isRefreshing:r})=>c.jsxs("div",{className:`repository-card ${n.enabled?"":"disabled"}`,children:[c.jsxs("div",{className:"repository-info",children:[c.jsx("h4",{className:"repository-name",children:n.name}),c.jsx("p",{className:"repository-url",children:n.url}),c.jsxs("div",{className:"repository-meta",children:[c.jsxs("span",{children:[n.pluginCount||0," plugins"]}),n.lastUpdated&&c.jsxs("span",{children:["Updated ",new Date(n.lastUpdated).toLocaleDateString()]})]})]}),c.jsxs("div",{className:"repository-actions",children:[c.jsxs("label",{className:"plugin-toggle",onClick:i=>{i.stopPropagation(),t()},children:[c.jsx("input",{type:"checkbox",checked:n.enabled,readOnly:!0}),c.jsx("span",{className:"plugin-toggle-slider"})]}),c.jsx("button",{className:"repository-action-btn",onClick:s,disabled:r,children:c.jsx(sr,{size:18,className:r?"spinning":""})}),c.jsx("button",{className:"repository-action-btn danger",onClick:e,children:c.jsx(xd,{size:18})})]})]}),Sfe=({isOpen:n,onClose:e,onAdd:t})=>{const[s,r]=j.useState(""),[i,o]=j.useState(!1),[a,l]=j.useState(null),u=async d=>{if(d.preventDefault(),!!s.trim()){o(!0),l(null);try{await t(s.trim()),r(""),e()}catch(f){l(f instanceof Error?f.message:"Failed to add repository")}finally{o(!1)}}};return n?c.jsx("div",{className:"modal-overlay",onClick:e,children:c.jsxs("div",{className:"modal-content",onClick:d=>d.stopPropagation(),children:[c.jsxs("div",{className:"modal-header",children:[c.jsx("h3",{children:"Add Plugin Repository"}),c.jsx("button",{className:"modal-close",onClick:e,children:c.jsx(an,{size:20})})]}),c.jsxs("form",{onSubmit:u,children:[c.jsxs("div",{className:"modal-body",children:[c.jsx("p",{className:"modal-description",children:"Enter the URL to a plugin repository's registry.json file."}),c.jsx("input",{type:"url",value:s,onChange:d=>r(d.target.value),placeholder:"https://example.com/registry.json",className:"modal-input",autoFocus:!0}),a&&c.jsx("p",{className:"modal-error",children:a})]}),c.jsxs("div",{className:"modal-footer",children:[c.jsx("button",{type:"button",className:"modal-btn secondary",onClick:e,children:"Cancel"}),c.jsx("button",{type:"submit",className:"modal-btn primary",disabled:i||!s.trim(),children:i?"Adding...":"Add Repository"})]})]})]})}):null},Nfe=({isOpen:n,onClose:e,onInstall:t})=>{const[s,r]=j.useState(""),[i,o]=j.useState(!1),[a,l]=j.useState(null),u=async d=>{if(d.preventDefault(),!!s.trim()){o(!0),l(null);try{await t(s.trim()),r(""),e()}catch(f){l(f instanceof Error?f.message:"Failed to install plugin")}finally{o(!1)}}};return n?c.jsx("div",{className:"modal-overlay",onClick:e,children:c.jsxs("div",{className:"modal-content",onClick:d=>d.stopPropagation(),children:[c.jsxs("div",{className:"modal-header",children:[c.jsx("h3",{children:"Install Plugin from URL"}),c.jsx("button",{className:"modal-close",onClick:e,children:c.jsx(an,{size:20})})]}),c.jsxs("form",{onSubmit:u,children:[c.jsxs("div",{className:"modal-body",children:[c.jsx("p",{className:"modal-description",children:"Enter a plugin source URL. Supported formats:"}),c.jsxs("ul",{className:"modal-list",children:[c.jsx("li",{children:c.jsx("code",{children:"npm:@audiio/plugin-name"})}),c.jsx("li",{children:c.jsx("code",{children:"https://github.com/user/repo"})}),c.jsx("li",{children:c.jsx("code",{children:"git:https://github.com/user/repo.git"})})]}),c.jsx("input",{type:"text",value:s,onChange:d=>r(d.target.value),placeholder:"npm:@audiio/plugin-example",className:"modal-input",autoFocus:!0}),a&&c.jsx("p",{className:"modal-error",children:a})]}),c.jsxs("div",{className:"modal-footer",children:[c.jsx("button",{type:"button",className:"modal-btn secondary",onClick:e,children:"Cancel"}),c.jsx("button",{type:"submit",className:"modal-btn primary",disabled:i||!s.trim(),children:i?"Installing...":"Install Plugin"})]})]})]})}):null},Ife=()=>{const{plugins:n,togglePlugin:e,getOrderedPlugins:t,pluginOrder:s,setPluginOrder:r,syncFromBackend:i}=ii(),{openPlugin:o}=Wt(),{pluginFolder:a,setPluginFolder:l}=vc();j.useEffect(()=>{var je,De,_e;i();const le=(_e=(De=(je=window.api)==null?void 0:je.repositories)==null?void 0:De.onPluginsChanged)==null?void 0:_e.call(De,()=>{console.log("[PluginsView] Plugins changed, syncing..."),i()});return()=>{le==null||le()}},[i]);const[u,d]=j.useState(null),[f,p]=j.useState("installed"),[g,x]=j.useState([]),[y,b]=j.useState(""),[k,w]=j.useState(!1),[N,C]=j.useState([]),[S,T]=j.useState(!1),[A,E]=j.useState([]),[M,P]=j.useState(!1),[R,L]=j.useState(null),[_,O]=j.useState(null),[U,W]=j.useState(null),[H,G]=j.useState(!1),[q,Q]=j.useState(!1),z=ib(sc(pd,{activationConstraint:{distance:8}}),sc(fd,{coordinateGetter:pb})),Y=t().filter(le=>le.installed),B=new Set(Y.map(le=>le.id)),J=n.filter(le=>le.enabled).length,ae=j.useCallback(async()=>{var le;if((le=window.api)!=null&&le.selectFolder){const je=await window.api.selectFolder({title:"Select Plugin Folder",defaultPath:a||void 0});je&&l(je)}},[a,l]);j.useEffect(()=>{var le;(le=window.api)!=null&&le.setPluginFolder&&window.api.setPluginFolder(a)},[a]),j.useEffect(()=>{var je;if(!((je=window.api)!=null&&je.onPluginDetected))return;const le=window.api.onPluginDetected(async De=>{var _e;if(console.log("[PluginsView] Plugin detected:",De.filename),(_e=window.api)!=null&&_e.installPlugin){const it=await window.api.installPlugin(De.path);it.success?(d(`Installed: ${it.plugin.name}`),setTimeout(()=>d(null),3e3)):(d(`Failed: ${it.error}`),setTimeout(()=>d(null),5e3))}});return()=>le()},[]);const pe=j.useCallback(async()=>{var le,je;if((je=(le=window.api)==null?void 0:le.repositories)!=null&&je.list){P(!0);try{const De=await window.api.repositories.list();E(De)}catch(De){console.error("Failed to load repositories:",De)}finally{P(!1)}}},[]),ge=j.useCallback(async()=>{var le,je;if((je=(le=window.api)==null?void 0:le.repositories)!=null&&je.getAvailablePlugins){w(!0);try{const De=await window.api.repositories.getAvailablePlugins();x(De)}catch(De){console.error("Failed to load browse plugins:",De)}finally{w(!1)}}},[]),he=j.useCallback(async()=>{var le,je;if((je=(le=window.api)==null?void 0:le.repositories)!=null&&je.checkUpdates){T(!0);try{const De=await window.api.repositories.checkUpdates();C(De)}catch(De){console.error("Failed to check updates:",De)}finally{T(!1)}}},[]);j.useEffect(()=>{f==="browse"?ge():f==="updates"?he():f==="repositories"&&pe()},[f,ge,he,pe]);const we=y?g.filter(le=>le.name.toLowerCase().includes(y.toLowerCase())||le.description.toLowerCase().includes(y.toLowerCase())||le.author.toLowerCase().includes(y.toLowerCase())):g,Pe=le=>{const{active:je,over:De}=le;if(De&&je.id!==De.id){const _e=s.indexOf(String(je.id)),it=s.indexOf(String(De.id));if(_e!==-1&&it!==-1){const St=db(s,_e,it);r(St)}}},ue=async le=>{var je,De,_e,it;if((De=(je=window.api)==null?void 0:je.repositories)!=null&&De.installFromSource){O(le.id);try{const St=await window.api.repositories.installFromSource(le.downloadUrl);St.success?(await((it=(_e=window.api)==null?void 0:_e.reloadPlugins)==null?void 0:it.call(_e)),ge()):console.error("Install failed:",St.error)}catch(St){console.error("Failed to install plugin:",St)}finally{O(null)}}},Te=async le=>{var De,_e,it,St;if(!((_e=(De=window.api)==null?void 0:De.repositories)!=null&&_e.installFromSource))throw new Error("Installation API not available");const je=await window.api.repositories.installFromSource(le);if(!je.success)throw new Error(je.error||"Installation failed");await((St=(it=window.api)==null?void 0:it.reloadPlugins)==null?void 0:St.call(it))},ke=async le=>{var je,De;if((De=(je=window.api)==null?void 0:je.repositories)!=null&&De.updatePlugin){W(le.pluginId);try{const _e=g.find(St=>St.id===le.pluginId);if(!_e){console.error("Plugin not found in browse list");return}const it=await window.api.repositories.updatePlugin(le.pluginId,_e.downloadUrl);it.success?he():console.error("Update failed:",it.error)}catch(_e){console.error("Failed to update plugin:",_e)}finally{W(null)}}},ye=async le=>{var De,_e;if(!((_e=(De=window.api)==null?void 0:De.repositories)!=null&&_e.add))throw new Error("Repository API not available");const je=await window.api.repositories.add(le);if(!je.success)throw new Error(je.error||"Failed to add repository");pe()},Ce=async le=>{var je,De;if((De=(je=window.api)==null?void 0:je.repositories)!=null&&De.remove)try{await window.api.repositories.remove(le),pe()}catch(_e){console.error("Failed to remove repository:",_e)}},Ae=async(le,je)=>{var De,_e;if((_e=(De=window.api)==null?void 0:De.repositories)!=null&&_e.setEnabled)try{await window.api.repositories.setEnabled(le,je),pe()}catch(it){console.error("Failed to toggle repository:",it)}},Be=async le=>{var je,De;if((De=(je=window.api)==null?void 0:je.repositories)!=null&&De.refresh){L(le);try{await window.api.repositories.refresh(le),pe()}catch(_e){console.error("Failed to refresh repository:",_e)}finally{L(null)}}},mt=le=>{const je=n.find(_e=>_e.id===le);if(je)return je.name;const De=g.find(_e=>_e.id===le);return De?De.name:le};return c.jsxs("div",{className:"plugins-view",children:[c.jsxs("header",{className:"plugins-header",children:[c.jsx("div",{className:"plugins-header-icon",children:c.jsx(Qi,{size:64})}),c.jsxs("div",{className:"plugins-header-info",children:[c.jsx("span",{className:"plugins-header-type",children:"Extensions"}),c.jsx("h1",{className:"plugins-header-title",children:"Plugins"}),c.jsxs("span",{className:"plugins-header-count",children:[J," enabled  ",Y.length," installed"]})]})]}),c.jsxs("div",{className:"plugins-tabs",children:[c.jsxs("button",{className:`plugins-tab ${f==="installed"?"active":""}`,onClick:()=>p("installed"),children:["Installed",c.jsx("span",{className:"plugins-tab-count",children:Y.length})]}),c.jsx("button",{className:`plugins-tab ${f==="browse"?"active":""}`,onClick:()=>p("browse"),children:"Browse"}),c.jsxs("button",{className:`plugins-tab ${f==="updates"?"active":""}`,onClick:()=>p("updates"),children:["Updates",N.length>0&&c.jsx("span",{className:"plugins-tab-badge",children:N.length})]}),c.jsxs("button",{className:`plugins-tab ${f==="repositories"?"active":""}`,onClick:()=>p("repositories"),children:[c.jsx(Pm,{size:16}),"Repos"]})]}),f==="installed"&&c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"plugins-priority-hint",children:c.jsx("span",{children:"Drag plugins to set priority order. Higher position = higher priority (tried first)."})}),c.jsx(ub,{sensors:z,collisionDetection:ob,onDragEnd:Pe,children:c.jsx(fb,{items:Y.map(le=>le.id),strategy:hb,children:c.jsx("div",{className:"plugins-list",children:Y.length===0?c.jsxs("div",{className:"plugins-empty",children:[c.jsx(Qi,{size:48}),c.jsx("h3",{children:"No plugins installed"}),c.jsx("p",{children:"Browse available plugins or add a repository to get started."}),c.jsx("button",{className:"plugins-empty-action",onClick:()=>p("browse"),children:"Browse Plugins"})]}):Y.map(le=>c.jsx(bfe,{plugin:le,index:s.indexOf(le.id),onClick:()=>o(le.id),onToggle:()=>e(le.id),isDraggable:!0},le.id))})})}),c.jsx("div",{className:"plugins-add-section",children:c.jsxs("button",{className:"plugins-add-button",onClick:()=>Q(!0),children:[c.jsx(Zi,{size:20}),c.jsx("span",{children:"Install from URL"})]})}),c.jsxs("div",{className:"plugins-folder-section",children:[c.jsxs("div",{className:"plugins-folder-header",children:[c.jsx(eo,{size:18}),c.jsx("span",{children:"Plugin Drop Folder"})]}),c.jsxs("p",{className:"plugins-folder-description",children:["Drop ",c.jsx("code",{children:".audiio-plugin"})," files into this folder to install them automatically."]}),c.jsxs("div",{className:"plugins-folder-input",children:[c.jsx("input",{type:"text",value:a||"",placeholder:"Select a folder for plugins",readOnly:!0}),c.jsxs("button",{className:"plugins-folder-browse",onClick:ae,children:[c.jsx(eo,{size:16}),c.jsx("span",{children:"Browse"})]}),a&&c.jsx("button",{className:"plugins-folder-clear",onClick:()=>l(null),title:"Clear folder",children:c.jsx(an,{size:14})})]}),a&&c.jsxs("div",{className:"plugins-folder-active",children:[c.jsx(Ji,{size:14}),c.jsx("span",{children:"Watching for new plugins"})]}),u&&c.jsx("div",{className:`plugins-folder-notification ${u.startsWith("Failed")?"error":"success"}`,children:u})]})]}),f==="browse"&&c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"plugins-search",children:[c.jsx(Xu,{size:20}),c.jsx("input",{type:"text",placeholder:"Search plugins...",value:y,onChange:le=>b(le.target.value)}),c.jsx("button",{className:"plugins-refresh-btn",onClick:ge,disabled:k,children:c.jsx(sr,{size:18,className:k?"spinning":""})})]}),c.jsx("div",{className:"plugins-list",children:k?c.jsxs("div",{className:"plugins-loading",children:[c.jsx(sr,{size:32,className:"spinning"}),c.jsx("p",{children:"Loading plugins..."})]}):we.length===0?c.jsxs("div",{className:"plugins-empty",children:[c.jsx(Qi,{size:48}),c.jsx("h3",{children:"No plugins available"}),c.jsx("p",{children:A.length===0?"Add a plugin repository to browse available plugins.":"No plugins found matching your search."}),A.length===0&&c.jsx("button",{className:"plugins-empty-action",onClick:()=>p("repositories"),children:"Add Repository"})]}):we.map(le=>c.jsx(wfe,{plugin:le,isInstalled:B.has(le.id),isInstalling:_===le.id,onInstall:()=>ue(le)},le.id))})]}),f==="updates"&&c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"plugins-updates-header",children:c.jsxs("button",{className:"plugins-check-updates-btn",onClick:he,disabled:S,children:[c.jsx(sr,{size:18,className:S?"spinning":""}),S?"Checking...":"Check for Updates"]})}),c.jsx("div",{className:"plugins-list",children:S?c.jsxs("div",{className:"plugins-loading",children:[c.jsx(sr,{size:32,className:"spinning"}),c.jsx("p",{children:"Checking for updates..."})]}):N.length===0?c.jsxs("div",{className:"plugins-empty",children:[c.jsx(Ji,{size:48}),c.jsx("h3",{children:"All plugins up to date"}),c.jsx("p",{children:"No updates are available for your installed plugins."})]}):N.map(le=>c.jsx(kfe,{update:le,pluginName:mt(le.pluginId),onUpdate:()=>ke(le),isUpdating:U===le.pluginId},le.pluginId))})]}),f==="repositories"&&c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"plugins-repos-header",children:[c.jsx("p",{className:"plugins-repos-description",children:"Plugin repositories provide collections of plugins you can browse and install. Add repositories by entering the URL to their registry.json file."}),c.jsxs("button",{className:"plugins-add-repo-btn",onClick:()=>G(!0),children:[c.jsx(Zi,{size:18}),"Add Repository"]})]}),c.jsx("div",{className:"repositories-list",children:M?c.jsxs("div",{className:"plugins-loading",children:[c.jsx(sr,{size:32,className:"spinning"}),c.jsx("p",{children:"Loading repositories..."})]}):A.length===0?c.jsxs("div",{className:"plugins-empty",children:[c.jsx(Qi,{size:48}),c.jsx("h3",{children:"No repositories added"}),c.jsx("p",{children:"Add a plugin repository to browse and install plugins."}),c.jsx("button",{className:"plugins-empty-action",onClick:()=>G(!0),children:"Add Repository"})]}):A.map(le=>c.jsx(Cfe,{repo:le,onRemove:()=>Ce(le.id),onToggle:()=>Ae(le.id,!le.enabled),onRefresh:()=>Be(le.id),isRefreshing:R===le.id},le.id))})]}),c.jsx(Sfe,{isOpen:H,onClose:()=>G(!1),onAdd:ye}),c.jsx(Nfe,{isOpen:q,onClose:()=>Q(!1),onInstall:Te})]})},Tfe={metadata:"Metadata Provider",streaming:"Streaming Provider",lyrics:"Lyrics Provider",translation:"Translation Service",scrobbling:"Scrobbling Service",analysis:"Audio Analysis",audio:"Audio Processor",tool:"Tool",other:"Other"},DI={metadata:"var(--color-access-metadata)",streaming:"var(--color-access-streaming)",lyrics:"var(--color-access-lyrics)",translation:"var(--color-access-translation, var(--color-access-lyrics))",scrobbling:"var(--color-access-scrobbling)",analysis:"var(--color-access-analysis, var(--color-access-metadata))",audio:"var(--color-access-audio, var(--color-access-playback))",tool:"var(--color-access-tool, var(--color-access-system))",other:"var(--color-access-other)"},$fe={network:cO,storage:lO,playback:dO,library:uO,system:s$},Efe={network:"var(--color-access-network)",storage:"var(--color-access-storage)",playback:"var(--color-access-playback)",library:"var(--color-access-library)",system:"var(--color-access-system)"},Afe=({setting:n,value:e,onChange:t,disabled:s=!1})=>{const r=()=>{var i;switch(n.type){case"boolean":return c.jsxs("label",{className:"plugin-toggle",children:[c.jsx("input",{type:"checkbox",checked:e,onChange:o=>t(o.target.checked),disabled:s}),c.jsx("span",{className:"plugin-toggle-slider"})]});case"select":return c.jsx("select",{className:"plugin-select",value:e,onChange:o=>t(o.target.value),disabled:s,children:(i=n.options)==null?void 0:i.map(o=>c.jsx("option",{value:o.value,children:o.label},o.value))});case"number":return c.jsx("input",{type:"number",className:"plugin-number-input",value:e,min:n.min,max:n.max,onChange:o=>t(parseInt(o.target.value,10)||n.default),disabled:s});default:return null}};return c.jsxs("div",{className:"plugin-setting-item",children:[c.jsxs("div",{className:"plugin-setting-info",children:[c.jsx("span",{className:"plugin-setting-label",children:n.label}),c.jsx("span",{className:"plugin-setting-description",children:n.description})]}),r()]})},jfe=({privacyAccess:n})=>n.length===0?c.jsxs("div",{className:"privacy-card",children:[c.jsxs("div",{className:"privacy-card-header",children:[c.jsx(pS,{size:24}),c.jsx("h3",{children:"App Privacy"})]}),c.jsxs("div",{className:"privacy-card-empty",children:[c.jsx(Ji,{size:32}),c.jsx("p",{children:"This plugin does not access any sensitive data"})]})]}):c.jsxs("div",{className:"privacy-card",children:[c.jsxs("div",{className:"privacy-card-header",children:[c.jsx(pS,{size:24}),c.jsx("h3",{children:"App Privacy"})]}),c.jsx("p",{className:"privacy-card-subtitle",children:"The developer indicated that this plugin may access the following data:"}),c.jsx("div",{className:"privacy-access-list",children:n.map((e,t)=>{const s=$fe[e.type]||s$,r=Efe[e.type]||"#6b7280";return c.jsxs("div",{className:"privacy-access-item",children:[c.jsx("div",{className:"privacy-access-icon",style:{backgroundColor:`${r}20`,color:r},children:c.jsx(s,{size:20})}),c.jsxs("div",{className:"privacy-access-info",children:[c.jsxs("div",{className:"privacy-access-header",children:[c.jsx("span",{className:"privacy-access-label",children:e.label}),e.required&&c.jsx("span",{className:"privacy-access-required",children:"Required"})]}),c.jsx("p",{className:"privacy-access-description",children:e.description})]})]},t)})}),c.jsx("div",{className:"privacy-card-footer",children:c.jsxs("p",{children:["Privacy practices may vary based on the features you use or your configuration.",c.jsx("a",{href:"#",className:"privacy-learn-more",children:"Learn More"})]})})]}),Rfe=()=>{const{selectedPluginId:n,goBack:e}=Wt(),{plugins:t,togglePlugin:s,removePlugin:r,updatePluginSetting:i}=ii(),o=t.find(u=>u.id===n);if(!o)return c.jsx("div",{className:"plugin-detail-view",children:c.jsxs("div",{className:"plugin-detail-empty",children:[c.jsx("h3",{children:"Plugin not found"}),c.jsx("button",{onClick:e,children:"Go back"})]})});const a=()=>{s(o.id)},l=async()=>{if(confirm(`Are you sure you want to uninstall "${o.name}"?`))try{await r(o.id),e()}catch(u){console.error("Failed to uninstall plugin:",u)}};return c.jsxs("div",{className:"plugin-detail-view",children:[c.jsx("header",{className:"plugin-detail-header",children:c.jsx("button",{className:"back-btn-round plugin-back-btn-pos",onClick:e,"aria-label":"Go back",children:c.jsx(Cc,{size:20})})}),c.jsxs("div",{className:"plugin-detail-hero",children:[c.jsx("div",{className:"plugin-detail-icon",style:{background:DI[o.category]},children:o.icon?c.jsx("img",{src:o.icon,alt:o.name}):c.jsx(Qi,{size:56})}),c.jsxs("div",{className:"plugin-detail-info",children:[c.jsx("h1",{className:"plugin-detail-name",children:o.name}),c.jsx("span",{className:"plugin-detail-category",style:{color:DI[o.category]},children:Tfe[o.category]}),c.jsxs("div",{className:"plugin-detail-meta",children:[c.jsxs("span",{className:"plugin-detail-version",children:["Version ",o.version]}),c.jsxs("span",{className:"plugin-detail-author",children:["by ",o.author]})]})]}),c.jsx("div",{className:"plugin-detail-actions",children:o.installed?c.jsxs("button",{className:"plugin-action-button danger",onClick:l,children:[c.jsx(YT,{size:18}),"Uninstall"]}):c.jsx("button",{className:"plugin-action-button primary",children:"Install"})})]}),c.jsxs("div",{className:"plugin-detail-content",children:[c.jsxs("section",{className:"plugin-detail-section",children:[c.jsx("h2",{children:"About"}),c.jsx("p",{className:"plugin-detail-description",children:o.description}),(o.homepage||o.repository)&&c.jsxs("div",{className:"plugin-detail-links",children:[o.homepage&&c.jsx("a",{href:o.homepage,target:"_blank",rel:"noopener noreferrer",children:"Homepage"}),o.repository&&c.jsx("a",{href:o.repository,target:"_blank",rel:"noopener noreferrer",children:"Source Code"})]})]}),c.jsx("section",{className:"plugin-detail-section",children:c.jsx(jfe,{privacyAccess:o.privacyAccess||[]})}),c.jsxs("section",{className:"plugin-detail-section",children:[c.jsx("h2",{children:"Settings"}),c.jsxs("div",{className:"plugin-settings-list",children:[c.jsxs("div",{className:"plugin-setting-item",children:[c.jsxs("div",{className:"plugin-setting-info",children:[c.jsx("span",{className:"plugin-setting-label",children:"Enabled"}),c.jsx("span",{className:"plugin-setting-description",children:"Allow this plugin to run and access data"})]}),c.jsxs("label",{className:"plugin-toggle",children:[c.jsx("input",{type:"checkbox",checked:o.enabled,onChange:a,disabled:!o.installed}),c.jsx("span",{className:"plugin-toggle-slider"})]})]}),o.settingsDefinitions&&o.settingsDefinitions.length>0&&c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"plugin-settings-divider"}),c.jsxs("div",{className:"plugin-settings-header",children:[c.jsx(Pm,{size:16}),c.jsx("span",{children:"Plugin Configuration"})]}),o.settingsDefinitions.map(u=>{var d;return c.jsx(Afe,{setting:u,value:((d=o.settings)==null?void 0:d[u.key])??u.default,onChange:f=>i(o.id,u.key,f),disabled:!o.enabled||!o.installed},u.key)})]})]})]})]})]})},Dfe={id:"default-dark",name:"Default Dark",author:"Audiio Team",version:"1.0.0",description:"The classic Audiio dark theme with green accent",mode:"dark",source:"builtin",colors:{bgPrimary:"#0a0a0a",bgSecondary:"#141414",bgTertiary:"#1c1c1c",bgHover:"#252525",bgElevated:"#1a1a1a",bgSurface:"#121212",bgOverlay:"rgba(0, 0, 0, 0.6)",textPrimary:"#ffffff",textSecondary:"#a3a3a3",textMuted:"#737373",textInverse:"#000000",textOnAccent:"#ffffff",accent:"#1db954",accentHover:"#1ed760",accentGlow:"rgba(29, 185, 84, 0.25)",accentSoft:"rgba(29, 185, 84, 0.1)",accentMuted:"rgba(29, 185, 84, 0.5)",borderColor:"rgba(255, 255, 255, 0.08)",borderLight:"rgba(255, 255, 255, 0.12)",borderStrong:"rgba(255, 255, 255, 0.18)",colorSuccess:"#1db954",colorWarning:"#f59e0b",colorError:"#ef4444",colorInfo:"#3b82f6"}},Pfe={id:"midnight",name:"Midnight",author:"Audiio Team",version:"1.0.0",description:"Deep blues and purples for late night listening",mode:"dark",source:"builtin",colors:{bgPrimary:"#0a0a14",bgSecondary:"#12121e",bgTertiary:"#1a1a2e",bgHover:"#252540",bgElevated:"#161628",bgSurface:"#0e0e1a",bgOverlay:"rgba(10, 10, 20, 0.7)",textPrimary:"#e8e8ff",textSecondary:"#a0a0c0",textMuted:"#7878a0",textInverse:"#0a0a14",textOnAccent:"#ffffff",accent:"#8b5cf6",accentHover:"#a78bfa",accentGlow:"rgba(139, 92, 246, 0.25)",accentSoft:"rgba(139, 92, 246, 0.1)",accentMuted:"rgba(139, 92, 246, 0.5)",borderColor:"rgba(139, 92, 246, 0.1)",borderLight:"rgba(139, 92, 246, 0.15)",borderStrong:"rgba(139, 92, 246, 0.2)",colorSuccess:"#10b981",colorWarning:"#f59e0b",colorError:"#ef4444",colorInfo:"#6366f1"},gradients:{accent:"linear-gradient(135deg, #8b5cf6 0%, #a855f7 100%)"}},Mfe={id:"sunset",name:"Sunset",author:"Audiio Team",version:"1.0.0",description:"Warm oranges and reds inspired by golden hour",mode:"dark",source:"builtin",colors:{bgPrimary:"#0f0a08",bgSecondary:"#1a1210",bgTertiary:"#241a16",bgHover:"#352520",bgElevated:"#1e1612",bgSurface:"#140e0c",bgOverlay:"rgba(15, 10, 8, 0.7)",textPrimary:"#fff5f0",textSecondary:"#c0a090",textMuted:"#a08070",textInverse:"#0f0a08",textOnAccent:"#ffffff",accent:"#f97316",accentHover:"#fb923c",accentGlow:"rgba(249, 115, 22, 0.25)",accentSoft:"rgba(249, 115, 22, 0.1)",accentMuted:"rgba(249, 115, 22, 0.5)",borderColor:"rgba(249, 115, 22, 0.1)",borderLight:"rgba(249, 115, 22, 0.15)",borderStrong:"rgba(249, 115, 22, 0.2)",colorSuccess:"#22c55e",colorWarning:"#eab308",colorError:"#ef4444",colorInfo:"#3b82f6"},gradients:{accent:"linear-gradient(135deg, #f97316 0%, #fb923c 50%, #fbbf24 100%)"}},Lfe={id:"ocean",name:"Ocean",author:"Audiio Team",version:"1.0.0",description:"Cool teals and cyans like deep ocean waters",mode:"dark",source:"builtin",colors:{bgPrimary:"#080a0a",bgSecondary:"#101414",bgTertiary:"#161c1c",bgHover:"#202828",bgElevated:"#121818",bgSurface:"#0c1010",bgOverlay:"rgba(8, 10, 10, 0.7)",textPrimary:"#f0ffff",textSecondary:"#a0c0c0",textMuted:"#789090",textInverse:"#080a0a",textOnAccent:"#ffffff",accent:"#14b8a6",accentHover:"#2dd4bf",accentGlow:"rgba(20, 184, 166, 0.25)",accentSoft:"rgba(20, 184, 166, 0.1)",accentMuted:"rgba(20, 184, 166, 0.5)",borderColor:"rgba(20, 184, 166, 0.1)",borderLight:"rgba(20, 184, 166, 0.15)",borderStrong:"rgba(20, 184, 166, 0.2)",colorSuccess:"#10b981",colorWarning:"#f59e0b",colorError:"#ef4444",colorInfo:"#06b6d4"},gradients:{accent:"linear-gradient(135deg, #14b8a6 0%, #06b6d4 100%)"}},Ffe={id:"monochrome-dark",name:"Monochrome Dark",author:"Audiio Team",version:"1.0.0",description:"Elegant grayscale with crisp white accents",mode:"dark",source:"builtin",colors:{bgPrimary:"#0a0a0a",bgSecondary:"#141414",bgTertiary:"#1e1e1e",bgHover:"#282828",bgElevated:"#1a1a1a",bgSurface:"#121212",bgOverlay:"rgba(0, 0, 0, 0.7)",textPrimary:"#ffffff",textSecondary:"#a3a3a3",textMuted:"#737373",textInverse:"#000000",textOnAccent:"#000000",accent:"#ffffff",accentHover:"#e0e0e0",accentGlow:"rgba(255, 255, 255, 0.15)",accentSoft:"rgba(255, 255, 255, 0.08)",accentMuted:"rgba(255, 255, 255, 0.4)",borderColor:"rgba(255, 255, 255, 0.1)",borderLight:"rgba(255, 255, 255, 0.15)",borderStrong:"rgba(255, 255, 255, 0.2)",colorSuccess:"#4ade80",colorWarning:"#fbbf24",colorError:"#f87171",colorInfo:"#60a5fa"},gradients:{accent:"linear-gradient(135deg, #ffffff 0%, #e0e0e0 100%)"}},Ofe={id:"default-light",name:"Default Light",author:"Audiio Team",version:"1.0.0",description:"Clean white theme with the classic green accent",mode:"light",source:"builtin",colors:{bgPrimary:"#ffffff",bgSecondary:"#f5f5f5",bgTertiary:"#ebebeb",bgHover:"#e0e0e0",bgElevated:"#ffffff",bgSurface:"#fafafa",bgOverlay:"rgba(0, 0, 0, 0.4)",textPrimary:"#1a1a1a",textSecondary:"#666666",textMuted:"#999999",textInverse:"#ffffff",textOnAccent:"#ffffff",accent:"#1db954",accentHover:"#1aa34a",accentGlow:"rgba(29, 185, 84, 0.2)",accentSoft:"rgba(29, 185, 84, 0.08)",accentMuted:"rgba(29, 185, 84, 0.4)",borderColor:"rgba(0, 0, 0, 0.08)",borderLight:"rgba(0, 0, 0, 0.05)",borderStrong:"rgba(0, 0, 0, 0.15)",colorSuccess:"#16a34a",colorWarning:"#d97706",colorError:"#dc2626",colorInfo:"#2563eb"},shadows:{xs:"0 1px 3px rgba(0, 0, 0, 0.08)",sm:"0 2px 8px rgba(0, 0, 0, 0.1)",md:"0 4px 16px rgba(0, 0, 0, 0.12)",lg:"0 8px 32px rgba(0, 0, 0, 0.15)",xl:"0 16px 48px rgba(0, 0, 0, 0.18)",module:"0 4px 24px rgba(0, 0, 0, 0.08)",card:"0 2px 12px rgba(0, 0, 0, 0.06)",elevated:"0 8px 40px rgba(0, 0, 0, 0.12)"},glass:{bg:"rgba(255, 255, 255, 0.85)",bgLight:"rgba(255, 255, 255, 0.7)",border:"rgba(0, 0, 0, 0.06)",borderStrong:"rgba(0, 0, 0, 0.1)"}},_fe={id:"paper",name:"Paper",author:"Audiio Team",version:"1.0.0",description:"Warm cream and beige tones like aged paper",mode:"light",source:"builtin",colors:{bgPrimary:"#faf8f5",bgSecondary:"#f2efe8",bgTertiary:"#e8e4da",bgHover:"#ddd8cc",bgElevated:"#fffdf8",bgSurface:"#f5f2ec",bgOverlay:"rgba(40, 35, 28, 0.4)",textPrimary:"#2c2820",textSecondary:"#6b6355",textMuted:"#9a9080",textInverse:"#faf8f5",textOnAccent:"#ffffff",accent:"#b45309",accentHover:"#d97706",accentGlow:"rgba(180, 83, 9, 0.2)",accentSoft:"rgba(180, 83, 9, 0.08)",accentMuted:"rgba(180, 83, 9, 0.4)",borderColor:"rgba(44, 40, 32, 0.08)",borderLight:"rgba(44, 40, 32, 0.05)",borderStrong:"rgba(44, 40, 32, 0.15)",colorSuccess:"#15803d",colorWarning:"#b45309",colorError:"#b91c1c",colorInfo:"#1d4ed8"},gradients:{accent:"linear-gradient(135deg, #b45309 0%, #d97706 100%)",surface:"linear-gradient(180deg, #f2efe8 0%, #faf8f5 100%)"},shadows:{xs:"0 1px 3px rgba(44, 40, 32, 0.06)",sm:"0 2px 8px rgba(44, 40, 32, 0.08)",md:"0 4px 16px rgba(44, 40, 32, 0.1)",lg:"0 8px 32px rgba(44, 40, 32, 0.12)",xl:"0 16px 48px rgba(44, 40, 32, 0.14)",module:"0 4px 24px rgba(44, 40, 32, 0.06)",card:"0 2px 12px rgba(44, 40, 32, 0.05)",elevated:"0 8px 40px rgba(44, 40, 32, 0.1)"},glass:{bg:"rgba(250, 248, 245, 0.85)",bgLight:"rgba(250, 248, 245, 0.7)",border:"rgba(44, 40, 32, 0.06)",borderStrong:"rgba(44, 40, 32, 0.1)"}},zfe={id:"monochrome-light",name:"Monochrome Light",author:"Audiio Team",version:"1.0.0",description:"Pure white with elegant gray accents",mode:"light",source:"builtin",colors:{bgPrimary:"#ffffff",bgSecondary:"#f8f8f8",bgTertiary:"#f0f0f0",bgHover:"#e8e8e8",bgElevated:"#ffffff",bgSurface:"#fcfcfc",bgOverlay:"rgba(0, 0, 0, 0.5)",textPrimary:"#1a1a1a",textSecondary:"#6a6a6a",textMuted:"#9a9a9a",textInverse:"#ffffff",textOnAccent:"#ffffff",accent:"#1a1a1a",accentHover:"#333333",accentGlow:"rgba(26, 26, 26, 0.15)",accentSoft:"rgba(26, 26, 26, 0.06)",accentMuted:"rgba(26, 26, 26, 0.35)",borderColor:"rgba(0, 0, 0, 0.08)",borderLight:"rgba(0, 0, 0, 0.04)",borderStrong:"rgba(0, 0, 0, 0.12)",colorSuccess:"#16a34a",colorWarning:"#ca8a04",colorError:"#dc2626",colorInfo:"#2563eb"},gradients:{accent:"linear-gradient(135deg, #1a1a1a 0%, #333333 100%)"},shadows:{xs:"0 1px 3px rgba(0, 0, 0, 0.06)",sm:"0 2px 8px rgba(0, 0, 0, 0.08)",md:"0 4px 16px rgba(0, 0, 0, 0.1)",lg:"0 8px 32px rgba(0, 0, 0, 0.12)",xl:"0 16px 48px rgba(0, 0, 0, 0.14)",module:"0 4px 24px rgba(0, 0, 0, 0.06)",card:"0 2px 12px rgba(0, 0, 0, 0.04)",elevated:"0 8px 40px rgba(0, 0, 0, 0.1)"},glass:{bg:"rgba(255, 255, 255, 0.9)",bgLight:"rgba(255, 255, 255, 0.75)",border:"rgba(0, 0, 0, 0.05)",borderStrong:"rgba(0, 0, 0, 0.08)"}},PI=[Dfe,Pfe,Mfe,Lfe,Ffe,Ofe,_fe,zfe],B0=()=>`custom-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,W0=()=>typeof window<"u"&&window.matchMedia?window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":"dark",nc=An()(Er((n,e)=>({activeThemeId:"default-dark",systemMode:"auto",themes:[...PI],communityThemes:[],setTheme:t=>{e().themes.find(r=>r.id===t)&&n({activeThemeId:t})},setSystemMode:t=>{const{activeThemeId:s,themes:r}=e(),i=r.find(a=>a.id===s);let o;t==="auto"?o=W0():o=t,i&&i.mode!==o?n({systemMode:t,activeThemeId:o==="dark"?"default-dark":"default-light"}):n({systemMode:t})},installTheme:t=>{const s={...t,source:"community",id:t.id||B0()};n(r=>({themes:[...r.themes,s],communityThemes:[...r.communityThemes,s]}))},uninstallTheme:t=>{const s=e().themes.find(r=>r.id===t);(s==null?void 0:s.source)!=="builtin"&&n(r=>({activeThemeId:r.activeThemeId===t?"default-dark":r.activeThemeId,themes:r.themes.filter(o=>o.id!==t),communityThemes:r.communityThemes.filter(o=>o.id!==t)}))},updateTheme:(t,s)=>{n(r=>({themes:r.themes.map(i=>i.id===t?{...i,...s}:i),communityThemes:r.communityThemes.map(i=>i.id===t?{...i,...s}:i)}))},getTheme:t=>e().themes.find(s=>s.id===t),getActiveTheme:()=>{const{activeThemeId:t,themes:s,systemMode:r}=e();if(r==="auto"){const i=W0(),o=s.find(l=>l.id===t);if((o==null?void 0:o.mode)===i)return o;const a=i==="dark"?"default-dark":"default-light";return s.find(l=>l.id===a)||s[0]}return s.find(i=>i.id===t)||s[0]},getEffectiveColorMode:()=>{const{systemMode:t,activeThemeId:s,themes:r}=e();if(t==="auto")return W0();const i=r.find(o=>o.id===s);return(i==null?void 0:i.mode)||"dark"},createCustomTheme:t=>{const s={...t,id:B0(),source:"community"};return e().installTheme(s),s},exportTheme:t=>{const s=e().themes.find(i=>i.id===t);if(!s)return"";const r={...s,id:s.source==="builtin"?void 0:s.id,source:void 0};return JSON.stringify(r,null,2)},importTheme:t=>{try{const s=JSON.parse(t);if(!s.name||!s.colors||!s.mode)return console.error("Invalid theme: missing required fields"),null;const r={...s,id:s.id||B0(),source:"community",author:s.author||"Unknown",version:s.version||"1.0.0"};return e().installTheme(r),r}catch(s){return console.error("Failed to import theme:",s),null}}}),{name:"audiio-themes",partialize:n=>({activeThemeId:n.activeThemeId,systemMode:n.systemMode,communityThemes:n.communityThemes}),merge:(n,e)=>{const t=n,s=[...PI,...t.communityThemes||[]];return{...e,...t,themes:s}}}));typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",n=>{const e=nc.getState();if(e.systemMode==="auto"){const t=n.matches?"dark":"light",s=e.themes.find(r=>r.id===e.activeThemeId);if((s==null?void 0:s.mode)!==t){const r=t==="dark"?"default-dark":"default-light";e.setTheme(r)}}});const Bfe=["#1db954","#8b5cf6","#ec4899","#3b82f6","#f97316","#ef4444","#14b8a6","#f59e0b","#6366f1","#10b981","#ffffff","#000000"],Wfe=({color:n,onChange:e,label:t})=>{const[s,r]=j.useState(!1),[i,o]=j.useState(n),a=j.useRef(null);j.useEffect(()=>{o(n)},[n]),j.useEffect(()=>{const f=p=>{a.current&&!a.current.contains(p.target)&&r(!1)};return s&&document.addEventListener("mousedown",f),()=>{document.removeEventListener("mousedown",f)}},[s]);const l=f=>{const p=f.target.value;o(p),(/^#[0-9A-Fa-f]{6}$/.test(p)||/^#[0-9A-Fa-f]{3}$/.test(p))&&e(p)},u=f=>{const p=f.target.value;o(p),e(p)},d=f=>{o(f),e(f)};return c.jsxs("div",{className:"color-picker",ref:a,children:[t&&c.jsx("label",{className:"color-picker-label",children:t}),c.jsxs("div",{className:"color-picker-trigger",onClick:()=>r(!s),children:[c.jsx("div",{className:"color-picker-swatch",style:{backgroundColor:n}}),c.jsx("input",{type:"text",className:"color-picker-input",value:i,onChange:l,onClick:f=>f.stopPropagation(),placeholder:"#000000"})]}),s&&c.jsxs("div",{className:"color-picker-dropdown",children:[c.jsxs("div",{className:"color-picker-native-wrapper",children:[c.jsx("input",{type:"color",className:"color-picker-native",value:n,onChange:u}),c.jsx("span",{className:"color-picker-native-label",children:"Pick custom color"})]}),c.jsxs("div",{className:"color-picker-presets",children:[c.jsx("span",{className:"color-picker-presets-label",children:"Quick colors"}),c.jsx("div",{className:"color-picker-presets-grid",children:Bfe.map(f=>c.jsx("button",{className:`color-picker-preset ${n===f?"active":""}`,style:{backgroundColor:f},onClick:()=>d(f),title:f},f))})]})]})]})},pp=n=>n==="light"?{bgPrimary:"#ffffff",bgSecondary:"#f5f5f5",bgTertiary:"#ebebeb",bgHover:"#e0e0e0",bgElevated:"#ffffff",bgSurface:"#fafafa",bgOverlay:"rgba(0, 0, 0, 0.4)",textPrimary:"#1a1a1a",textSecondary:"#666666",textMuted:"#999999",textInverse:"#ffffff",accent:"#1db954",accentHover:"#1ed760",accentGlow:"rgba(29, 185, 84, 0.2)",accentSoft:"rgba(29, 185, 84, 0.08)",accentMuted:"rgba(29, 185, 84, 0.4)",borderColor:"rgba(0, 0, 0, 0.08)",borderLight:"rgba(0, 0, 0, 0.05)",borderStrong:"rgba(0, 0, 0, 0.15)",colorSuccess:"#16a34a",colorWarning:"#d97706",colorError:"#dc2626",colorInfo:"#2563eb"}:{bgPrimary:"#0a0a0a",bgSecondary:"#141414",bgTertiary:"#1c1c1c",bgHover:"#252525",bgElevated:"#1a1a1a",bgSurface:"#121212",bgOverlay:"rgba(0, 0, 0, 0.6)",textPrimary:"#ffffff",textSecondary:"#a0a0a0",textMuted:"#606060",textInverse:"#000000",accent:"#1db954",accentHover:"#1ed760",accentGlow:"rgba(29, 185, 84, 0.25)",accentSoft:"rgba(29, 185, 84, 0.1)",accentMuted:"rgba(29, 185, 84, 0.5)",borderColor:"rgba(255, 255, 255, 0.08)",borderLight:"rgba(255, 255, 255, 0.12)",borderStrong:"rgba(255, 255, 255, 0.18)",colorSuccess:"#1db954",colorWarning:"#f59e0b",colorError:"#ef4444",colorInfo:"#3b82f6"},Vfe=n=>{const e=Ufe(n,15),t=V0(n,.25),s=V0(n,.1),r=V0(n,.5);return{accentHover:e,accentGlow:t,accentSoft:s,accentMuted:r}},V0=(n,e)=>{const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(n);if(!t)return`rgba(0, 0, 0, ${e})`;const s=parseInt(t[1],16),r=parseInt(t[2],16),i=parseInt(t[3],16);return`rgba(${s}, ${r}, ${i}, ${e})`},Ufe=(n,e)=>{const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(n);if(!t)return n;let s=parseInt(t[1],16),r=parseInt(t[2],16),i=parseInt(t[3],16);return s=Math.min(255,Math.max(0,s+s*e/100)),r=Math.min(255,Math.max(0,r+r*e/100)),i=Math.min(255,Math.max(0,i+i*e/100)),`#${Math.round(s).toString(16).padStart(2,"0")}${Math.round(r).toString(16).padStart(2,"0")}${Math.round(i).toString(16).padStart(2,"0")}`},Gfe=({isOpen:n,onClose:e,editingTheme:t})=>{const{createCustomTheme:s,updateTheme:r,exportTheme:i,setTheme:o}=nc(),[a,l]=j.useState("My Custom Theme"),[u,d]=j.useState("dark"),[f,p]=j.useState(pp("dark")),[g,x]=j.useState(""),[y,b]=j.useState("colors");j.useEffect(()=>{t?(l(t.name),d(t.mode),p(t.colors),x(t.customCSS||"")):(l("My Custom Theme"),d("dark"),p(pp("dark")),x(""))},[t,n]),j.useEffect(()=>{t||p(pp(u))},[u,t]);const k=(T,A)=>{p(E=>{const M={...E,[T]:A};if(T==="accent"){const P=Vfe(A);return{...M,...P}}return M})},w=()=>{const T={name:a,author:"You",version:"1.0.0",description:`Custom ${u} theme`,mode:u,colors:f,customCSS:g||void 0};if(t&&t.source==="community")r(t.id,T),o(t.id);else{const A=s(T);o(A.id)}e()},N=()=>{const T={name:a,author:"You",version:"1.0.0",description:`Custom ${u} theme`,mode:u,colors:f,customCSS:g||void 0},A=JSON.stringify(T,null,2);navigator.clipboard.writeText(A)},C=()=>{p(pp(u)),x("")},S=j.useMemo(()=>[{name:"Background",colors:[{key:"bgPrimary",label:"Primary"},{key:"bgSecondary",label:"Secondary"},{key:"bgTertiary",label:"Tertiary"},{key:"bgHover",label:"Hover"},{key:"bgElevated",label:"Elevated"},{key:"bgSurface",label:"Surface"}]},{name:"Text",colors:[{key:"textPrimary",label:"Primary"},{key:"textSecondary",label:"Secondary"},{key:"textMuted",label:"Muted"}]},{name:"Accent",colors:[{key:"accent",label:"Primary"},{key:"accentHover",label:"Hover"}]},{name:"Semantic",colors:[{key:"colorSuccess",label:"Success"},{key:"colorWarning",label:"Warning"},{key:"colorError",label:"Error"},{key:"colorInfo",label:"Info"}]}],[]);return n?c.jsx("div",{className:"modal-overlay",onClick:e,children:c.jsxs("div",{className:"theme-editor-modal",onClick:T=>T.stopPropagation(),children:[c.jsxs("div",{className:"theme-editor-header",children:[c.jsx("h2",{children:t?"Edit Theme":"Create Theme"}),c.jsx("button",{className:"modal-close",onClick:e,children:c.jsx(an,{size:20})})]}),c.jsxs("div",{className:"theme-editor-content",children:[c.jsxs("div",{className:"theme-editor-controls",children:[c.jsxs("div",{className:"theme-editor-field",children:[c.jsx("label",{children:"Theme Name"}),c.jsx("input",{type:"text",className:"theme-editor-input",value:a,onChange:T=>l(T.target.value),placeholder:"My Custom Theme"})]}),c.jsxs("div",{className:"theme-editor-field",children:[c.jsx("label",{children:"Mode"}),c.jsxs("div",{className:"theme-editor-mode-toggle",children:[c.jsxs("button",{className:`theme-editor-mode-btn ${u==="dark"?"active":""}`,onClick:()=>d("dark"),children:[c.jsx(n$,{size:16}),"Dark"]}),c.jsxs("button",{className:`theme-editor-mode-btn ${u==="light"?"active":""}`,onClick:()=>d("light"),children:[c.jsx(t$,{size:16}),"Light"]})]})]}),c.jsxs("div",{className:"theme-editor-tabs",children:[c.jsx("button",{className:`theme-editor-tab ${y==="colors"?"active":""}`,onClick:()=>b("colors"),children:"Colors"}),c.jsx("button",{className:`theme-editor-tab ${y==="advanced"?"active":""}`,onClick:()=>b("advanced"),children:"Advanced"})]}),y==="colors"&&c.jsx("div",{className:"theme-editor-colors",children:S.map(T=>c.jsxs("div",{className:"theme-editor-color-group",children:[c.jsx("h4",{children:T.name}),c.jsx("div",{className:"theme-editor-color-grid",children:T.colors.map(({key:A,label:E})=>c.jsx(Wfe,{label:E,color:f[A],onChange:M=>k(A,M)},A))})]},T.name))}),y==="advanced"&&c.jsx("div",{className:"theme-editor-advanced",children:c.jsxs("div",{className:"theme-editor-field",children:[c.jsx("label",{children:"Custom CSS"}),c.jsx("textarea",{className:"theme-editor-css",value:g,onChange:T=>x(T.target.value),placeholder:`.sidebar {
  /* Custom styles */
}`,rows:12}),c.jsx("span",{className:"theme-editor-hint",children:"Add custom CSS to fine-tune your theme. Selectors are automatically scoped."})]})})]}),c.jsxs("div",{className:"theme-editor-preview-panel",children:[c.jsx("h4",{children:"Live Preview"}),c.jsx("div",{className:"theme-editor-preview",style:{"--preview-bg-primary":f.bgPrimary,"--preview-bg-secondary":f.bgSecondary,"--preview-bg-tertiary":f.bgTertiary,"--preview-text-primary":f.textPrimary,"--preview-text-secondary":f.textSecondary,"--preview-accent":f.accent,"--preview-border":f.borderColor},children:c.jsxs("div",{className:"preview-app",children:[c.jsxs("div",{className:"preview-sidebar",children:[c.jsx("div",{className:"preview-logo",style:{background:f.accent}}),c.jsx("div",{className:"preview-nav-item active",style:{background:f.accentSoft},children:c.jsx("div",{className:"preview-nav-indicator",style:{background:f.accent}})}),c.jsx("div",{className:"preview-nav-item"}),c.jsx("div",{className:"preview-nav-item"})]}),c.jsxs("div",{className:"preview-content",children:[c.jsx("div",{className:"preview-header",style:{background:f.textPrimary}}),c.jsxs("div",{className:"preview-cards",children:[c.jsxs("div",{className:"preview-card",children:[c.jsx("div",{className:"preview-card-art",style:{background:f.bgTertiary}}),c.jsx("div",{className:"preview-card-text",style:{background:f.textSecondary}})]}),c.jsxs("div",{className:"preview-card",children:[c.jsx("div",{className:"preview-card-art",style:{background:f.bgTertiary}}),c.jsx("div",{className:"preview-card-text",style:{background:f.textSecondary}})]}),c.jsxs("div",{className:"preview-card",children:[c.jsx("div",{className:"preview-card-art",style:{background:f.bgTertiary}}),c.jsx("div",{className:"preview-card-text",style:{background:f.textSecondary}})]})]})]}),c.jsxs("div",{className:"preview-player",children:[c.jsx("div",{className:"preview-player-art",style:{background:f.bgTertiary}}),c.jsxs("div",{className:"preview-player-info",children:[c.jsx("div",{className:"preview-player-title",style:{background:f.textPrimary}}),c.jsx("div",{className:"preview-player-artist",style:{background:f.textSecondary}})]}),c.jsx("div",{className:"preview-player-btn",style:{background:f.accent}})]})]})})]})]}),c.jsxs("div",{className:"theme-editor-footer",children:[c.jsxs("div",{className:"theme-editor-footer-left",children:[c.jsxs("button",{className:"theme-editor-btn secondary",onClick:C,children:[c.jsx(sr,{size:16}),"Reset"]}),c.jsxs("button",{className:"theme-editor-btn secondary",onClick:N,children:[c.jsx(Ir,{size:16}),"Copy JSON"]})]}),c.jsxs("div",{className:"theme-editor-footer-right",children:[c.jsx("button",{className:"theme-editor-btn secondary",onClick:e,children:"Cancel"}),c.jsxs("button",{className:"theme-editor-btn primary",onClick:w,children:[c.jsx(Ji,{size:16}),t?"Save Changes":"Create Theme"]})]})]})]})}):null},Hfe=({onAccept:n,onDecline:e})=>c.jsx("div",{className:"mobile-privacy-overlay",children:c.jsxs("div",{className:"mobile-privacy-modal",children:[c.jsx("div",{className:"mobile-privacy-icon",children:c.jsx(gM,{size:48})}),c.jsx("h2",{className:"mobile-privacy-title",children:"Mobile Access"}),c.jsx("p",{className:"mobile-privacy-subtitle",children:"Stream your music anywhere"}),c.jsxs("div",{className:"mobile-privacy-content",children:[c.jsxs("div",{className:"mobile-privacy-section",children:[c.jsxs("div",{className:"mobile-privacy-feature",children:[c.jsx("div",{className:"mobile-privacy-feature-icon secure",children:c.jsx(Yfe,{size:20})}),c.jsxs("div",{className:"mobile-privacy-feature-info",children:[c.jsx("h4",{children:"Secure Connection"}),c.jsx("p",{children:"All connections are end-to-end encrypted. Only devices with your code can connect."})]})]}),c.jsxs("div",{className:"mobile-privacy-feature",children:[c.jsx("div",{className:"mobile-privacy-feature-icon private",children:c.jsx(Zfe,{size:20})}),c.jsxs("div",{className:"mobile-privacy-feature-info",children:[c.jsx("h4",{children:"Your Data Stays Yours"}),c.jsx("p",{children:"Music streams directly from your computer. No data is stored in the cloud."})]})]}),c.jsxs("div",{className:"mobile-privacy-feature",children:[c.jsx("div",{className:"mobile-privacy-feature-icon control",children:c.jsx(Jfe,{size:20})}),c.jsxs("div",{className:"mobile-privacy-feature-info",children:[c.jsx("h4",{children:"You're in Control"}),c.jsx("p",{children:"See all paired devices and revoke access anytime."})]})]})]}),c.jsxs("div",{className:"mobile-privacy-note",children:[c.jsx(epe,{size:16}),c.jsxs("p",{children:[c.jsx("strong",{children:"How it works:"})," Enter the code on your phone or scan the QR code. Works on the same network or from anywhere."]})]})]}),c.jsxs("div",{className:"mobile-privacy-actions",children:[c.jsx("button",{className:"mobile-privacy-btn secondary",onClick:e,children:"Not Now"}),c.jsx("button",{className:"mobile-privacy-btn primary",onClick:n,children:"Enable Mobile Access"})]})]})}),qfe=({code:n,qrCode:e,isActive:t,onRefresh:s,isLoading:r})=>{const[i,o]=j.useState(!1),a=async()=>{try{await navigator.clipboard.writeText(n),o(!0),setTimeout(()=>o(!1),2e3)}catch{}};return c.jsxs("div",{className:"mobile-pairing-container",children:[c.jsxs("div",{className:"mobile-pairing-status",children:[c.jsx("span",{className:`mobile-pairing-indicator ${t?"active":""}`}),c.jsx("span",{children:t?"Ready to connect":"Connecting..."})]}),c.jsxs("div",{className:"mobile-pairing-code-card",children:[c.jsx("div",{className:"mobile-pairing-code",children:n.split("-").map((l,u)=>c.jsxs(gt.Fragment,{children:[u>0&&c.jsx("span",{className:"mobile-pairing-separator",children:"-"}),c.jsx("span",{className:"mobile-pairing-code-part",children:l})]},u))}),c.jsxs("div",{className:"mobile-pairing-actions",children:[c.jsx("button",{className:"mobile-pairing-btn",onClick:a,title:"Copy code",children:i?c.jsx(npe,{size:16}):c.jsx(tpe,{size:16})}),c.jsx("button",{className:"mobile-pairing-btn",onClick:s,disabled:r,title:"Generate new code",children:c.jsx(ope,{size:16})})]})]}),e&&c.jsx("div",{className:"mobile-pairing-qr",children:c.jsx("img",{src:e,alt:"Scan to connect",className:"mobile-pairing-qr-image"})}),c.jsx("p",{className:"mobile-pairing-hint",children:"Enter this code on your mobile device or scan the QR code. Works from any network."})]})},Kfe=({enabled:n,customUrl:e,onToggle:t,onUrlChange:s})=>{const[r,i]=j.useState(e||""),[o,a]=j.useState(!!e),l=()=>{const d=r.trim();s(d||null)},u=()=>{i(""),s(null),a(!1)};return c.jsxs("div",{className:"mobile-relay-settings",children:[c.jsxs("div",{className:"mobile-relay-option",children:[c.jsxs("div",{className:"mobile-relay-option-info",children:[c.jsxs("div",{className:"mobile-relay-option-row",children:[c.jsx(ipe,{size:18}),c.jsx("h4",{children:"Remote Access"})]}),c.jsx("p",{children:"Connect from anywhere via relay server"})]}),c.jsxs("label",{className:"mobile-access-toggle small",children:[c.jsx("input",{type:"checkbox",checked:n,onChange:d=>t(d.target.checked)}),c.jsx("span",{className:"mobile-access-toggle-slider"})]})]}),n&&c.jsx("div",{className:"mobile-relay-url-section",children:o?c.jsxs("div",{className:"mobile-relay-url-input-group",children:[c.jsx("label",{className:"mobile-relay-url-label",children:"Relay Server"}),c.jsxs("div",{className:"mobile-relay-url-row",children:[c.jsx("input",{type:"text",className:"mobile-relay-url-input",placeholder:"wss://audiio-relay.fly.dev",value:r,onChange:d=>i(d.target.value),onBlur:l,onKeyDown:d=>d.key==="Enter"&&l()}),c.jsx("button",{className:"mobile-relay-url-clear",onClick:u,title:"Use default",children:c.jsx(xM,{size:14})})]}),c.jsx("p",{className:"mobile-relay-url-hint",children:"Leave empty to use the default relay"})]}):c.jsxs("button",{className:"mobile-relay-custom-btn",onClick:()=>a(!0),children:[c.jsx(ape,{size:14}),"Use custom relay server"]})})]})},Qfe=({devices:n,onRevoke:e,onRevokeAll:t})=>{const s=r=>{const i=new Date(r),o=Date.now()-i.getTime(),a=Math.floor(o/6e4);if(a<1)return"Just now";if(a<60)return`${a}m ago`;const l=Math.floor(a/60);if(l<24)return`${l}h ago`;const u=Math.floor(l/24);return u<7?`${u}d ago`:i.toLocaleDateString()};return n.length===0?c.jsxs("div",{className:"mobile-devices-empty",children:[c.jsx(spe,{size:32}),c.jsx("p",{children:"No paired devices"}),c.jsx("span",{children:"Devices will appear here after connecting"})]}):c.jsxs("div",{className:"mobile-paired-devices",children:[c.jsx("div",{className:"mobile-devices-list",children:n.map(r=>c.jsxs("div",{className:"mobile-device-item",children:[c.jsx("div",{className:"mobile-device-icon",children:c.jsx(rpe,{size:20})}),c.jsxs("div",{className:"mobile-device-info",children:[c.jsx("span",{className:"mobile-device-name",children:r.name||"Unknown Device"}),c.jsxs("span",{className:"mobile-device-time",children:["Last seen ",s(r.lastAccessAt)]})]}),c.jsx("button",{className:"mobile-device-disconnect",onClick:()=>e(r.id),title:"Revoke access",children:c.jsx(xM,{size:16})})]},r.id))}),n.length>1&&c.jsx("button",{className:"mobile-revoke-all-btn",onClick:t,children:"Revoke all devices"})]})},Xfe=()=>{const{customRelayUrl:n,remoteAccessEnabled:e,setCustomRelayUrl:t,setRemoteAccessEnabled:s}=vc(),[r,i]=j.useState({isEnabled:!1,isLoading:!0,pairing:null,devices:[],hasAcceptedPrivacy:localStorage.getItem("audiio-mobile-privacy-accepted")==="true"}),[o,a]=j.useState(!1);j.useEffect(()=>{l()},[]),j.useEffect(()=>{r.isEnabled&&u()},[r.isEnabled]);const l=async()=>{var C,S;try{const T=await((S=(C=window.api)==null?void 0:C.getMobileStatus)==null?void 0:S.call(C));i(T?A=>({...A,isEnabled:T.isEnabled,pairing:T.pairing||null,isLoading:!1}):A=>({...A,isLoading:!1}))}catch(T){console.error("[MobileAccess] Error loading status:",T),i(A=>({...A,isLoading:!1}))}},u=async()=>{var C,S;try{const T=await((S=(C=window.api)==null?void 0:C.getMobileDevices)==null?void 0:S.call(C));T!=null&&T.devices&&i(A=>({...A,devices:T.devices}))}catch(T){console.error("[MobileAccess] Error loading devices:",T)}},d=()=>{r.hasAcceptedPrivacy?g():a(!0)},f=()=>{localStorage.setItem("audiio-mobile-privacy-accepted","true"),i(C=>({...C,hasAcceptedPrivacy:!0})),a(!1),g()},p=()=>{a(!1)},g=async()=>{var C,S;i(T=>({...T,isLoading:!0}));try{const T=await((S=(C=window.api)==null?void 0:C.enableMobileAccess)==null?void 0:S.call(C,{customRelayUrl:n||void 0}));T!=null&&T.success?i(A=>({...A,isEnabled:!0,pairing:T.pairing||null,isLoading:!1})):(console.error("[MobileAccess] Enable failed:",T==null?void 0:T.error),i(A=>({...A,isLoading:!1})))}catch(T){console.error("[MobileAccess] Failed to enable:",T),i(A=>({...A,isLoading:!1}))}},x=async()=>{var C,S;i(T=>({...T,isLoading:!0}));try{await((S=(C=window.api)==null?void 0:C.disableMobileAccess)==null?void 0:S.call(C)),i(T=>({...T,isEnabled:!1,pairing:null,devices:[],isLoading:!1}))}catch(T){console.error("[MobileAccess] Failed to disable:",T),i(A=>({...A,isLoading:!1}))}},y=async()=>{var C,S;i(T=>({...T,isLoading:!0}));try{const T=await((S=(C=window.api)==null?void 0:C.refreshMobilePairingCode)==null?void 0:S.call(C));T!=null&&T.pairing?i(A=>({...A,pairing:T.pairing,isLoading:!1})):i(A=>({...A,isLoading:!1}))}catch(T){console.error("[MobileAccess] Failed to refresh code:",T),i(A=>({...A,isLoading:!1}))}},b=async C=>{var S,T;try{const A=await((T=(S=window.api)==null?void 0:S.revokeMobileDevice)==null?void 0:T.call(S,C));A!=null&&A.success&&i(E=>({...E,devices:E.devices.filter(M=>M.id!==C)}))}catch(A){console.error("[MobileAccess] Failed to revoke device:",A)}},k=async()=>{var C,S;try{const T=await((S=(C=window.api)==null?void 0:C.revokeAllMobileDevices)==null?void 0:S.call(C));T!=null&&T.success&&i(A=>({...A,devices:[]}))}catch(T){console.error("[MobileAccess] Failed to revoke all devices:",T)}},w=async C=>{var S,T;s(C);try{await((T=(S=window.api)==null?void 0:S.setMobileRemoteAccess)==null?void 0:T.call(S,C))}catch(A){console.error("[MobileAccess] Failed to toggle remote access:",A)}},N=async C=>{var S,T;t(C);try{await((T=(S=window.api)==null?void 0:S.setMobileRelayUrl)==null?void 0:T.call(S,C))}catch(A){console.error("[MobileAccess] Failed to set relay URL:",A)}};return r.isLoading&&!r.isEnabled?c.jsx("div",{className:"mobile-access-loading",children:c.jsx("div",{className:"mobile-access-spinner"})}):c.jsxs("div",{className:"mobile-access-settings",children:[o&&c.jsx(Hfe,{onAccept:f,onDecline:p}),c.jsxs("div",{className:"mobile-access-header",children:[c.jsx("div",{className:"mobile-access-header-icon",children:c.jsx(gM,{size:24})}),c.jsxs("div",{className:"mobile-access-header-info",children:[c.jsx("h3",{children:"Mobile Access"}),c.jsx("p",{children:"Access your music from your phone or tablet"})]}),c.jsxs("label",{className:"mobile-access-toggle",children:[c.jsx("input",{type:"checkbox",checked:r.isEnabled,onChange:r.isEnabled?x:d,disabled:r.isLoading}),c.jsx("span",{className:"mobile-access-toggle-slider"})]})]}),r.isEnabled&&c.jsx("div",{className:"mobile-access-content",children:r.pairing?c.jsxs(c.Fragment,{children:[c.jsx(qfe,{code:r.pairing.code,qrCode:r.pairing.qrCode,isActive:r.pairing.relayActive,onRefresh:y,isLoading:r.isLoading}),c.jsx(Kfe,{enabled:e,customUrl:n,onToggle:w,onUrlChange:N}),c.jsxs("div",{className:"mobile-access-section",children:[c.jsxs("div",{className:"mobile-access-section-header",children:[c.jsx("h4",{children:"Paired Devices"}),c.jsx("span",{className:"mobile-access-count",children:r.devices.length})]}),c.jsx(Qfe,{devices:r.devices,onRevoke:b,onRevokeAll:k})]})]}):c.jsxs("div",{className:"mobile-access-connecting",children:[c.jsx("div",{className:"mobile-access-spinner"}),c.jsx("p",{children:"Connecting to relay server..."})]})}),!r.isEnabled&&c.jsx("div",{className:"mobile-access-disabled-hint",children:c.jsx("p",{children:"Turn on to access your music library from your phone. Enter a code or scan a QR to connect."})})]})},gM=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M17 1.01L7 1c-1.1 0-2 .9-2 2v18c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2V3c0-1.1-.9-1.99-2-1.99zM17 19H7V5h10v14z"})}),Yfe=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z"})}),Zfe=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm0 10.99h7c-.53 4.12-3.28 7.79-7 8.94V12H5V6.3l7-3.11v8.8z"})}),Jfe=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M3 17v2h6v-2H3zM3 5v2h10V5H3zm10 16v-2h8v-2h-8v-2h-2v6h2zM7 9v2H3v2h4v2h2V9H7zm14 4v-2H11v2h10zm-6-4h2V7h4V5h-4V3h-2v6z"})}),epe=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"})}),tpe=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"})}),npe=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"})}),spe=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M4 6h18V4H4c-1.1 0-2 .9-2 2v11H0v3h14v-3H4V6zm19 2h-6c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h6c.55 0 1-.45 1-1V9c0-.55-.45-1-1-1zm-1 9h-4v-7h4v7z"})}),rpe=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M16 1H8C6.34 1 5 2.34 5 4v16c0 1.66 1.34 3 3 3h8c1.66 0 3-1.34 3-3V4c0-1.66-1.34-3-3-3zm-2 20h-4v-1h4v1zm3.25-3H6.75V4h10.5v14z"})}),xM=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})}),ipe=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"})}),ope=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"})}),ape=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M19.14 12.94c.04-.31.06-.63.06-.94 0-.31-.02-.63-.06-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.04.31-.06.63-.06.94s.02.63.06.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"})}),lpe=({label:n,description:e,icon:t,value:s,placeholder:r,onChange:i,onBrowse:o})=>c.jsxs("div",{className:"storage-folder-picker",children:[c.jsxs("div",{className:"storage-folder-info",children:[c.jsx("div",{className:"storage-folder-icon",children:t}),c.jsxs("div",{className:"storage-folder-text",children:[c.jsx("h4",{children:n}),c.jsx("p",{children:e})]})]}),c.jsxs("div",{className:"storage-folder-input",children:[c.jsx("input",{type:"text",value:s||"",placeholder:r,onChange:a=>i(a.target.value||null),readOnly:!0}),c.jsxs("button",{className:"storage-folder-browse",onClick:o,children:[c.jsx(eo,{size:16}),c.jsx("span",{children:"Browse"})]}),s&&c.jsx("button",{className:"storage-folder-clear",onClick:()=>i(null),title:"Reset to default",children:c.jsx(xd,{size:14})})]})]}),cpe=({folder:n,onRemove:e,onScan:t})=>{const s=n.lastScanned?new Date(n.lastScanned).toLocaleDateString():"Never";return c.jsxs("div",{className:`local-music-folder-card ${n.isScanning?"scanning":""}`,children:[c.jsx("div",{className:"local-music-folder-icon",children:c.jsx(eo,{size:24})}),c.jsxs("div",{className:"local-music-folder-info",children:[c.jsx("h4",{children:n.name}),c.jsx("p",{className:"local-music-folder-path",children:n.path}),c.jsxs("div",{className:"local-music-folder-meta",children:[c.jsxs("span",{children:[n.trackCount," tracks"]}),c.jsx("span",{children:""}),c.jsxs("span",{children:["Scanned: ",s]})]})]}),c.jsxs("div",{className:"local-music-folder-actions",children:[c.jsx("button",{className:"local-music-folder-action",onClick:t,disabled:n.isScanning,title:"Rescan folder",children:c.jsx(sr,{size:16,className:n.isScanning?"spinning":""})}),c.jsx("button",{className:"local-music-folder-action danger",onClick:e,title:"Remove folder",children:c.jsx(xd,{size:16})})]})]})},upe=()=>{const{downloadFolder:n,localMusicFolders:e,setDownloadFolder:t,addLocalMusicFolder:s,removeLocalMusicFolder:r,updateLocalMusicFolder:i}=vc(),{setLocalFolderPlaylistTracks:o,deleteLocalFolderPlaylist:a}=Xt(),[l,u]=j.useState(!1),d=j.useCallback(async()=>{var x;if((x=window.api)!=null&&x.selectFolder){const y=await window.api.selectFolder({title:"Select Download Folder",defaultPath:n||void 0});y&&t(y)}},[n,t]),f=j.useCallback(async()=>{var x,y,b,k;if((x=window.api)!=null&&x.selectFolder){u(!0);try{const w=await window.api.selectFolder({title:"Select Music Folder"});if(w){const N=w.split(/[/\\]/).pop()||"Music";if(s({path:w,name:N}),(y=window.api)!=null&&y.scanMusicFolder){const C=(b=vc.getState().localMusicFolders.find(S=>S.path===w))==null?void 0:b.id;if(C){i(C,{isScanning:!0});try{const S=await window.api.scanMusicFolder(w);i(C,{trackCount:S.trackCount,lastScanned:Date.now(),isScanning:!1}),((k=S.tracks)==null?void 0:k.length)>0&&o(C,N,S.tracks)}catch(S){console.error("Failed to scan folder:",S),i(C,{isScanning:!1})}}}}}finally{u(!1)}}},[s,i,o]),p=j.useCallback(async x=>{var y,b;if((y=window.api)!=null&&y.scanMusicFolder){i(x.id,{isScanning:!0});try{const k=await window.api.scanMusicFolder(x.path);i(x.id,{trackCount:k.trackCount,lastScanned:Date.now(),isScanning:!1}),((b=k.tracks)==null?void 0:b.length)>0&&o(x.id,x.name,k.tracks)}catch(k){console.error("Failed to scan folder:",k),i(x.id,{isScanning:!1})}}},[i,o]),g=j.useCallback(x=>{a(x),r(x)},[r,a]);return c.jsxs("div",{className:"storage-settings",children:[c.jsxs("div",{className:"storage-section",children:[c.jsxs("h3",{className:"storage-section-title",children:[c.jsx(Ir,{size:18}),"Downloads"]}),c.jsx(lpe,{label:"Download Location",description:"Where downloaded tracks are saved",icon:c.jsx(Ir,{size:20}),value:n,placeholder:"~/Downloads/Audiio (default)",onChange:t,onBrowse:d})]}),c.jsxs("div",{className:"storage-section",children:[c.jsxs("div",{className:"storage-section-header",children:[c.jsxs("h3",{className:"storage-section-title",children:[c.jsx(qe,{size:18}),"Local Music"]}),c.jsxs("button",{className:"storage-add-btn",onClick:f,disabled:l,children:[c.jsx(Zi,{size:16}),c.jsx("span",{children:"Add Folder"})]})]}),c.jsx("p",{className:"storage-section-description",children:"Add folders containing your local music files. Audiio will scan for MP3, FLAC, WAV, and other audio formats."}),e.length===0?c.jsxs("div",{className:"storage-empty",children:[c.jsx(eo,{size:32}),c.jsx("p",{children:"No local music folders added"}),c.jsxs("button",{className:"storage-empty-btn",onClick:f,children:[c.jsx(Zi,{size:16}),"Add Music Folder"]})]}):c.jsx("div",{className:"local-music-folder-list",children:e.map(x=>c.jsx(cpe,{folder:x,onRemove:()=>g(x.id),onScan:()=>p(x)},x.id))})]})]})},cd=An()((n,e)=>({isAvailable:!1,isEnabled:!1,isProcessing:!1,vocalReduction:1,qualityMode:"auto",processedTracks:new Set,currentInstrumentalUrl:null,get isVocalRemovalEnabled(){return e().isEnabled},setAvailable:t=>{n({isAvailable:t}),!t&&e().isEnabled&&n({isEnabled:!1,isProcessing:!1})},toggle:()=>{const{isAvailable:t,isEnabled:s}=e();t&&(n({isEnabled:!s}),s&&n({isProcessing:!1,currentInstrumentalUrl:null}))},toggleVocalRemoval:()=>{e().toggle()},enable:()=>{e().isAvailable&&n({isEnabled:!0})},disable:()=>{n({isEnabled:!1,isProcessing:!1,currentInstrumentalUrl:null})},setProcessing:t=>{n({isProcessing:t})},setVocalReduction:t=>{n({vocalReduction:Math.max(0,Math.min(1,t))})},setQualityMode:t=>{n({qualityMode:t})},addProcessedTrack:t=>{n(s=>({processedTracks:new Set(s.processedTracks).add(t)}))},setCurrentInstrumentalUrl:t=>{n({currentInstrumentalUrl:t})},reset:()=>{n({isEnabled:!1,isProcessing:!1,vocalReduction:1,qualityMode:"auto",currentInstrumentalUrl:null})}})),MI=[{value:"auto",label:"Auto",description:"Best settings for your hardware"},{value:"quality",label:"Quality",description:"Best quality, requires GPU"},{value:"balanced",label:"Balanced",description:"Good quality with reasonable speed"},{value:"fast",label:"Fast",description:"Faster processing, optimized for CPU"}],dpe=()=>{var u;const{crossfadeEnabled:n,crossfadeDuration:e,setCrossfadeEnabled:t,setCrossfadeDuration:s,normalizeVolume:r,setNormalizeVolume:i}=vc(),{isAvailable:o,qualityMode:a,setQualityMode:l}=cd();return c.jsxs("div",{className:"audio-settings",children:[c.jsxs("div",{className:"settings-group",children:[c.jsxs("div",{className:"settings-group-header",children:[c.jsx(hpe,{size:20}),c.jsx("h3",{children:"Crossfade"})]}),c.jsxs("div",{className:"settings-option",children:[c.jsxs("div",{className:"settings-option-info",children:[c.jsx("h4",{children:"Enable Crossfade"}),c.jsx("p",{children:"Smoothly blend between tracks during transitions"})]}),c.jsxs("label",{className:"toggle-switch",children:[c.jsx("input",{type:"checkbox",checked:n,onChange:d=>t(d.target.checked)}),c.jsx("span",{className:"toggle-slider"})]})]}),n&&c.jsxs("div",{className:"settings-option",children:[c.jsxs("div",{className:"settings-option-info",children:[c.jsx("h4",{children:"Duration"}),c.jsxs("p",{children:[e," seconds"]})]}),c.jsx("input",{type:"range",className:"settings-slider",min:1,max:12,step:1,value:e,onChange:d=>s(parseInt(d.target.value))})]})]}),c.jsxs("div",{className:"settings-group",children:[c.jsxs("div",{className:"settings-group-header",children:[c.jsx(fpe,{size:20}),c.jsx("h3",{children:"Playback"})]}),c.jsxs("div",{className:"settings-option",children:[c.jsxs("div",{className:"settings-option-info",children:[c.jsx("h4",{children:"Normalize Volume"}),c.jsx("p",{children:"Automatically adjust volume to maintain consistent levels"})]}),c.jsxs("label",{className:"toggle-switch",children:[c.jsx("input",{type:"checkbox",checked:r,onChange:d=>i(d.target.checked)}),c.jsx("span",{className:"toggle-slider"})]})]})]}),o&&c.jsxs("div",{className:"settings-group",children:[c.jsxs("div",{className:"settings-group-header",children:[c.jsx(ppe,{size:20}),c.jsx("h3",{children:"Vocal Removal"})]}),c.jsxs("div",{className:"settings-option",children:[c.jsxs("div",{className:"settings-option-info",children:[c.jsx("h4",{children:"Processing Quality"}),c.jsx("p",{children:"Balance between quality and speed"})]}),c.jsx("select",{className:"settings-select",value:a,onChange:d=>l(d.target.value),children:MI.map(d=>c.jsx("option",{value:d.value,children:d.label},d.value))})]}),c.jsx("div",{className:"settings-description",children:(u=MI.find(d=>d.value===a))==null?void 0:u.description})]})]})},hpe=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M16.5 3c-1.74 0-3.41.81-4.5 2.09C10.91 3.81 9.24 3 7.5 3 4.42 3 2 5.42 2 8.5c0 3.78 3.4 6.86 8.55 11.54L12 21.35l1.45-1.32C18.6 15.36 22 12.28 22 8.5 22 5.42 19.58 3 16.5 3zm-4.4 15.55l-.1.1-.1-.1C7.14 14.24 4 11.39 4 8.5 4 6.5 5.5 5 7.5 5c1.54 0 3.04.99 3.57 2.36h1.87C13.46 5.99 14.96 5 16.5 5c2 0 3.5 1.5 3.5 3.5 0 2.89-3.14 5.74-7.9 10.05z"})}),fpe=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"})}),ppe=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm-1-9c0-.55.45-1 1-1s1 .45 1 1v6c0 .55-.45 1-1 1s-1-.45-1-1V5zm6 6c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"})}),mpe=({name:n,description:e,size:t,status:s,installProgress:r,isInstalling:i,onInstall:o,onUninstall:a,onCancel:l,onToggleEnabled:u})=>{const d=(s==null?void 0:s.installed)||!1,f=(s==null?void 0:s.enabled)??!0,p=s==null?void 0:s.version;return c.jsxs("div",{className:`component-card ${d?"installed":""}`,children:[c.jsx("div",{className:"component-card-icon",children:c.jsx(xpe,{size:32})}),c.jsxs("div",{className:"component-card-content",children:[c.jsxs("div",{className:"component-card-header",children:[c.jsx("h4",{className:"component-card-name",children:n}),d&&c.jsxs("span",{className:"component-card-badge",children:[c.jsx(Ji,{size:12}),"Installed"]})]}),c.jsx("p",{className:"component-card-description",children:e}),c.jsxs("div",{className:"component-card-meta",children:[c.jsx("span",{className:"component-card-size",children:t}),p&&c.jsxs("span",{className:"component-card-version",children:["v",p]})]}),i&&r&&c.jsxs("div",{className:"component-card-progress",children:[c.jsx("div",{className:"component-progress-bar",children:c.jsx("div",{className:"component-progress-fill",style:{width:`${r.progress}%`}})}),c.jsxs("div",{className:"component-progress-info",children:[c.jsx("span",{className:"component-progress-message",children:r.message}),c.jsxs("span",{className:"component-progress-percent",children:[r.progress,"%"]})]})]})]}),c.jsxs("div",{className:"component-card-actions",children:[!d&&!i&&c.jsxs("button",{className:"component-action-btn install",onClick:o,children:[c.jsx(Ir,{size:16}),"Install"]}),i&&c.jsx("button",{className:"component-action-btn cancel",onClick:l,children:"Cancel"}),d&&!i&&c.jsxs(c.Fragment,{children:[c.jsxs("label",{className:"toggle-switch component-toggle",children:[c.jsx("input",{type:"checkbox",checked:f,onChange:g=>u(g.target.checked)}),c.jsx("span",{className:"toggle-slider"})]}),c.jsx("button",{className:"component-action-btn uninstall",onClick:a,children:c.jsx(xd,{size:16})})]})]})]})},gpe=()=>{const{demucsInstalled:n,demucsEnabled:e,demucsVersion:t,setDemucsInstalled:s,setDemucsEnabled:r,setDemucsVersion:i}=vc(),[o,a]=j.useState(null),[l,u]=j.useState(!1),[d,f]=j.useState(null),[p,g]=j.useState(null);j.useEffect(()=>{(async()=>{var N,C;if((C=(N=window.api)==null?void 0:N.components)!=null&&C.getDemucsStatus)try{const S=await window.api.components.getDemucsStatus();S.success&&(a(S.status),s(S.status.installed),r(S.status.enabled),i(S.status.version))}catch(S){console.error("[ComponentsSettings] Failed to fetch status:",S)}})()},[s,r,i]),j.useEffect(()=>{var N,C;if(!((C=(N=window.api)==null?void 0:N.components)!=null&&C.onInstallProgress))return;const w=window.api.components.onInstallProgress(S=>{f(S),S.phase==="complete"?(u(!1),s(!0),window.api.components.getDemucsStatus().then(T=>{T.success&&(a(T.status),i(T.status.version))})):S.phase==="error"&&(u(!1),g(S.message))});return()=>{w==null||w()}},[s,i]);const x=j.useCallback(async()=>{var w,N;if((N=(w=window.api)==null?void 0:w.components)!=null&&N.installDemucs){g(null),u(!0),f({phase:"downloading",progress:0,message:"Starting installation..."});try{const C=await window.api.components.installDemucs();C.success||(g(C.error||"Installation failed"),u(!1))}catch(C){g(C instanceof Error?C.message:"Installation failed"),u(!1)}}},[]),y=j.useCallback(()=>{var w,N;(N=(w=window.api)==null?void 0:w.components)!=null&&N.cancelDemucsInstall&&window.api.components.cancelDemucsInstall(),u(!1),f(null)},[]),b=j.useCallback(async()=>{var N,C;if(!(!((C=(N=window.api)==null?void 0:N.components)!=null&&C.uninstallDemucs)||!window.confirm("Are you sure you want to uninstall AI Vocal Removal? You can reinstall it later.")))try{const S=await window.api.components.uninstallDemucs();S.success?(s(!1),i(null),a(T=>T?{...T,installed:!1,version:null}:null)):g(S.error||"Uninstall failed")}catch(S){g(S instanceof Error?S.message:"Uninstall failed")}},[s,i]),k=j.useCallback(async w=>{var N,C;if((C=(N=window.api)==null?void 0:N.components)!=null&&C.setDemucsEnabled)try{(await window.api.components.setDemucsEnabled(w)).success&&(r(w),a(T=>T?{...T,enabled:w}:null))}catch(S){console.error("[ComponentsSettings] Failed to toggle enabled:",S)}},[r]);return c.jsxs("div",{className:"components-settings",children:[c.jsx("p",{className:"components-settings-description",children:"Install optional features that enhance your Audiio experience. These components require additional storage and are downloaded separately."}),p&&c.jsxs("div",{className:"components-error",children:[c.jsx(e$,{size:16}),c.jsx("span",{children:p}),c.jsx("button",{onClick:()=>g(null),children:""})]}),c.jsx("div",{className:"components-list",children:c.jsx(mpe,{name:"AI Vocal Removal",description:"Remove vocals from any song for karaoke mode. Uses Demucs AI for high-quality stem separation.",size:"~1.5 GB",status:o,installProgress:d,isInstalling:l,onInstall:x,onUninstall:b,onCancel:y,onToggleEnabled:k})}),c.jsx("p",{className:"components-note",children:"Components are stored in your application data folder and can be uninstalled at any time to free up space."})]})},xpe=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M12 14c1.66 0 2.99-1.34 2.99-3L15 5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.3-3c0 3-2.54 5.1-5.3 5.1S6.7 14 6.7 11H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c3.28-.48 6-3.3 6-6.72h-1.7z"})}),U0=({theme:n,isActive:e,onSelect:t,onDelete:s,onEdit:r})=>c.jsxs("button",{className:`theme-preview-card ${e?"active":""}`,onClick:t,title:n.description,children:[c.jsxs("div",{className:"theme-preview",style:{background:n.colors.bgPrimary,borderColor:n.colors.borderColor},children:[c.jsxs("div",{className:"theme-preview-sidebar",style:{background:n.colors.bgSecondary},children:[c.jsx("div",{className:"theme-preview-sidebar-item",style:{background:n.colors.accent}}),c.jsx("div",{className:"theme-preview-sidebar-item",style:{background:n.colors.bgTertiary}})]}),c.jsxs("div",{className:"theme-preview-content",children:[c.jsx("div",{className:"theme-preview-header",style:{background:n.colors.textPrimary}}),c.jsxs("div",{className:"theme-preview-cards",children:[c.jsx("div",{className:"theme-preview-card-item",style:{background:n.colors.bgSecondary}}),c.jsx("div",{className:"theme-preview-card-item",style:{background:n.colors.bgSecondary}})]})]}),c.jsx("div",{className:"theme-preview-player",style:{background:n.colors.bgSecondary},children:c.jsx("div",{className:"theme-preview-player-accent",style:{background:n.colors.accent}})})]}),c.jsxs("div",{className:"theme-preview-info",children:[c.jsx("span",{className:"theme-preview-name",children:n.name}),c.jsx("span",{className:"theme-preview-mode",children:n.mode})]}),e&&c.jsx("div",{className:"theme-preview-check",children:c.jsx(Ji,{size:14})}),(r||s)&&c.jsxs("div",{className:"theme-preview-actions",children:[r&&c.jsx("button",{className:"theme-preview-action edit",onClick:i=>{i.stopPropagation(),r()},title:"Edit theme",children:c.jsx(ZT,{size:14})}),s&&c.jsx("button",{className:"theme-preview-action delete",onClick:i=>{i.stopPropagation(),s()},title:"Remove theme",children:c.jsx(xd,{size:14})})]})]}),ype=({currentMode:n,onChange:e})=>{const t=[{id:"auto",label:"Auto",icon:c.jsx(aO,{size:16})},{id:"light",label:"Light",icon:c.jsx(t$,{size:16})},{id:"dark",label:"Dark",icon:c.jsx(n$,{size:16})}];return c.jsx("div",{className:"mode-toggle",children:t.map(s=>c.jsxs("button",{className:`mode-toggle-btn ${n===s.id?"active":""}`,onClick:()=>e(s.id),children:[s.icon,c.jsx("span",{children:s.label})]},s.id))})},vpe=()=>{const{activeThemeId:n,systemMode:e,themes:t,communityThemes:s,setTheme:r,setSystemMode:i,installTheme:o,uninstallTheme:a,importTheme:l,exportTheme:u,getActiveTheme:d}=nc(),[f,p]=j.useState("appearance"),[g,x]=j.useState(!1),[y,b]=j.useState(""),[k,w]=j.useState(""),[N,C]=j.useState(!1),[S,T]=j.useState(void 0),[A,E]=j.useState(!1),[M,P]=j.useState(""),[R,L]=j.useState(""),[_,O]=j.useState(!1),U=d(),W=t.filter(B=>B.source==="builtin"),H=W.filter(B=>B.mode==="dark"),G=W.filter(B=>B.mode==="light"),q=()=>{if(!y.trim()){w("Please paste theme JSON");return}const B=l(y);B?(x(!1),b(""),w(""),r(B.id)):w("Invalid theme format. Please check the JSON.")},Q=()=>{const B=u(n);B&&navigator.clipboard.writeText(B)},z=()=>{T(void 0),C(!0)},K=B=>{T(B),C(!0)},Y=async()=>{if(!M.trim()){L("Please enter a GitHub repository URL");return}O(!0),L("");try{const B=await ide(M);if(B){const J={...B,id:`community-${Date.now()}`,source:"community"};o(J),r(J.id),E(!1),P("")}}catch(B){L(B instanceof Error?B.message:"Failed to import theme")}finally{O(!1)}};return c.jsxs("div",{className:"settings-view",children:[c.jsxs("header",{className:"settings-header",children:[c.jsx("div",{className:"settings-header-icon",children:c.jsx(Pm,{size:64})}),c.jsxs("div",{className:"settings-header-info",children:[c.jsx("span",{className:"settings-header-type",children:"Preferences"}),c.jsx("h1",{className:"settings-header-title",children:"Settings"}),c.jsx("span",{className:"settings-header-subtitle",children:"Customize your Audiio experience"})]})]}),c.jsxs("div",{className:"settings-tabs",children:[c.jsxs("button",{className:`settings-tab ${f==="appearance"?"active":""}`,onClick:()=>p("appearance"),children:[c.jsx(mS,{size:18}),c.jsx("span",{children:"Appearance"})]}),c.jsxs("button",{className:`settings-tab ${f==="audio"?"active":""}`,onClick:()=>p("audio"),children:[c.jsx(qe,{size:18}),c.jsx("span",{children:"Audio"})]}),c.jsxs("button",{className:`settings-tab ${f==="components"?"active":""}`,onClick:()=>p("components"),children:[c.jsx(FI,{size:18}),c.jsx("span",{children:"Components"})]}),c.jsxs("button",{className:`settings-tab ${f==="storage"?"active":""}`,onClick:()=>p("storage"),children:[c.jsx(eo,{size:18}),c.jsx("span",{children:"Storage"})]}),c.jsxs("button",{className:`settings-tab ${f==="mobile"?"active":""}`,onClick:()=>p("mobile"),children:[c.jsx(LI,{size:18}),c.jsx("span",{children:"Mobile"})]})]}),c.jsxs("div",{className:"settings-content",children:[f==="appearance"&&c.jsxs("section",{className:"settings-section",children:[c.jsxs("div",{className:"settings-section-header",children:[c.jsx(mS,{size:20}),c.jsx("h2",{children:"Appearance"})]}),c.jsxs("div",{className:"settings-option",children:[c.jsxs("div",{className:"settings-option-info",children:[c.jsx("h3",{children:"Mode"}),c.jsx("p",{children:"Choose between light, dark, or auto (follows system)"})]}),c.jsx(ype,{currentMode:e,onChange:i})]}),c.jsxs("div",{className:"settings-current-theme",children:[c.jsx("div",{className:"settings-current-theme-label",children:"Current Theme"}),c.jsxs("div",{className:"settings-current-theme-preview",style:{background:U.colors.bgSecondary,borderColor:U.colors.borderLight},children:[c.jsx("div",{className:"settings-current-accent",style:{background:U.colors.accent}}),c.jsxs("div",{className:"settings-current-info",children:[c.jsx("span",{className:"settings-current-name",children:U.name}),c.jsxs("span",{className:"settings-current-author",children:["by ",U.author]})]})]})]}),c.jsxs("div",{className:"settings-theme-group",children:[c.jsx("h3",{children:"Dark Themes"}),c.jsx("div",{className:"settings-theme-grid",children:H.map(B=>c.jsx(U0,{theme:B,isActive:n===B.id,onSelect:()=>r(B.id)},B.id))})]}),c.jsxs("div",{className:"settings-theme-group",children:[c.jsx("h3",{children:"Light Themes"}),c.jsx("div",{className:"settings-theme-grid",children:G.map(B=>c.jsx(U0,{theme:B,isActive:n===B.id,onSelect:()=>r(B.id)},B.id))})]}),s.length>0&&c.jsxs("div",{className:"settings-theme-group",children:[c.jsx("h3",{children:"Community Themes"}),c.jsx("div",{className:"settings-theme-grid",children:s.map(B=>c.jsx(U0,{theme:B,isActive:n===B.id,onSelect:()=>r(B.id),onEdit:()=>K(B),onDelete:()=>a(B.id)},B.id))})]}),c.jsxs("div",{className:"settings-theme-actions",children:[c.jsxs("button",{className:"settings-action-btn primary",onClick:z,children:[c.jsx(q4,{size:16}),c.jsx("span",{children:"Create Theme"})]}),c.jsxs("button",{className:"settings-action-btn",onClick:()=>E(!0),children:[c.jsx(u0,{size:16}),c.jsx("span",{children:"From GitHub"})]}),c.jsxs("button",{className:"settings-action-btn",onClick:()=>x(!0),children:[c.jsx(Q4,{size:16}),c.jsx("span",{children:"Import JSON"})]}),c.jsxs("button",{className:"settings-action-btn",onClick:Q,children:[c.jsx(Ir,{size:16}),c.jsx("span",{children:"Export Current"})]})]})]}),f==="audio"&&c.jsxs("section",{className:"settings-section",children:[c.jsxs("div",{className:"settings-section-header",children:[c.jsx(qe,{size:20}),c.jsx("h2",{children:"Audio & Playback"})]}),c.jsx("p",{className:"settings-section-description",children:"Configure audio processing, vocal removal, crossfade, and other playback settings."}),c.jsx(dpe,{})]}),f==="components"&&c.jsxs("section",{className:"settings-section",children:[c.jsxs("div",{className:"settings-section-header",children:[c.jsx(FI,{size:20}),c.jsx("h2",{children:"Optional Components"})]}),c.jsx(gpe,{})]}),f==="storage"&&c.jsxs("section",{className:"settings-section",children:[c.jsxs("div",{className:"settings-section-header",children:[c.jsx(eo,{size:20}),c.jsx("h2",{children:"Storage & Local Music"})]}),c.jsx("p",{className:"settings-section-description",children:"Configure where downloads are saved, add local music folders, and manage plugin installation."}),c.jsx(upe,{})]}),f==="mobile"&&c.jsxs("section",{className:"settings-section",children:[c.jsxs("div",{className:"settings-section-header",children:[c.jsx(LI,{size:20}),c.jsx("h2",{children:"Mobile Access"})]}),c.jsx("p",{className:"settings-section-description",children:"Access your music library from your phone or tablet. Stream anywhere on your local network or use remote access to listen from outside your home."}),c.jsx(Xfe,{})]})]}),g&&c.jsx("div",{className:"modal-overlay",onClick:()=>x(!1),children:c.jsxs("div",{className:"modal",onClick:B=>B.stopPropagation(),children:[c.jsxs("div",{className:"modal-header",children:[c.jsx("h2",{children:"Import Theme"}),c.jsx("button",{className:"modal-close",onClick:()=>x(!1),children:""})]}),c.jsxs("div",{className:"modal-body",children:[c.jsx("p",{className:"settings-import-hint",children:"Paste the theme JSON below to import a custom theme."}),c.jsx("textarea",{className:"settings-import-textarea",placeholder:'{"name": "My Theme", "colors": {...}}',value:y,onChange:B=>{b(B.target.value),w("")},rows:10}),k&&c.jsx("div",{className:"settings-import-error",children:k})]}),c.jsxs("div",{className:"modal-footer",children:[c.jsx("button",{className:"modal-btn secondary",onClick:()=>x(!1),children:"Cancel"}),c.jsx("button",{className:"modal-btn primary",onClick:q,children:"Import"})]})]})}),A&&c.jsx("div",{className:"modal-overlay",onClick:()=>E(!1),children:c.jsxs("div",{className:"modal",onClick:B=>B.stopPropagation(),children:[c.jsxs("div",{className:"modal-header",children:[c.jsxs("h2",{children:[c.jsx(u0,{size:20}),"Import from GitHub"]}),c.jsx("button",{className:"modal-close",onClick:()=>E(!1),children:""})]}),c.jsxs("div",{className:"modal-body",children:[c.jsxs("p",{className:"settings-import-hint",children:["Enter a GitHub repository URL to import a theme. The repository should contain an"," ",c.jsx("code",{children:"audiio-theme.json"})," file in its root."]}),c.jsxs("div",{className:"settings-github-input-wrapper",children:[c.jsx(u0,{size:18}),c.jsx("input",{type:"text",className:"settings-github-input",placeholder:"github.com/user/my-theme or user/my-theme",value:M,onChange:B=>{P(B.target.value),L("")},onKeyDown:B=>{B.key==="Enter"&&!_&&Y()}})]}),R&&c.jsx("div",{className:"settings-import-error",children:R}),c.jsxs("div",{className:"settings-github-examples",children:[c.jsx("span",{className:"settings-github-examples-label",children:"Examples:"}),c.jsx("code",{children:"github.com/username/theme-repo"}),c.jsx("code",{children:"username/audiio-dark-theme"})]})]}),c.jsxs("div",{className:"modal-footer",children:[c.jsx("button",{className:"modal-btn secondary",onClick:()=>E(!1),children:"Cancel"}),c.jsx("button",{className:"modal-btn primary",onClick:Y,disabled:_,children:_?c.jsxs(c.Fragment,{children:[c.jsx(Z4,{size:16}),"Importing..."]}):"Import"})]})]})}),c.jsx(Gfe,{isOpen:N,onClose:()=>{C(!1),T(void 0)},editingTheme:S})]})},LI=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M17 1.01L7 1c-1.1 0-2 .9-2 2v18c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2V3c0-1.1-.9-1.99-2-1.99zM17 19H7V5h10v14z"})}),FI=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M20 2H4c-1 0-2 .9-2 2v3.01c0 .72.43 1.34 1 1.69V20c0 1.1 1.1 2 2 2h14c.9 0 2-.9 2-2V8.7c.57-.35 1-.97 1-1.69V4c0-1.1-1-2-2-2zm-5 12H9v-2h6v2zm5-7H4V4h16v3z"})});function Ol(n,e,t){var s,r,i,o;return{id:n.id,title:n.title,artist:((r=(s=n.artists)==null?void 0:s[0])==null?void 0:r.name)||e,artwork:((i=n.artwork)==null?void 0:i.medium)||((o=n.artwork)==null?void 0:o.small),year:n.releaseDate?parseInt(n.releaseDate.substring(0,4)):void 0,trackCount:n.trackCount,albumType:n.albumType,source:t}}const bpe=An((n,e)=>({artistCache:new Map,loadingArtistId:null,error:null,fetchArtist:async(t,s,r)=>{var o,a,l,u;const i=e().artistCache.get(t);if(i&&i.topTracks.length>0)return i;n({loadingArtistId:t,error:null});try{if(!window.api)throw new Error("API not available");if(window.api.getArtist)try{const w=await window.api.getArtist(t,r==null?void 0:r.source);if(w){const N={albums:(w.albums||[]).map(_=>Ol(_,s,(r==null?void 0:r.source)||"addon")),singles:(w.singles||[]).map(_=>Ol(_,s,(r==null?void 0:r.source)||"addon")),eps:(w.eps||[]).map(_=>Ol(_,s,(r==null?void 0:r.source)||"addon")),compilations:(w.compilations||[]).map(_=>Ol(_,s,(r==null?void 0:r.source)||"addon"))},C=(w.similarArtists||[]).map(_=>{var O,U;return{id:_.id,name:_.name,image:((O=_.artwork)==null?void 0:O.medium)||((U=_.artwork)==null?void 0:U.small),source:(r==null?void 0:r.source)||"addon"}}),S=(w.appearsOn||[]).map(_=>Ol(_,s,(r==null?void 0:r.source)||"addon")),T=(w.topTracks||[]).map(_=>({..._,streamSources:[],_meta:{metadataProvider:(r==null?void 0:r.source)||"addon",matchConfidence:1,externalIds:{},lastUpdated:new Date}})),A=Date.now()-365*24*60*60*1e3,P=[...N.albums,...N.singles,...N.eps].filter(_=>_.year?new Date(`${_.year}-01-01`).getTime()>A:!1).sort((_,O)=>(O.year||0)-(_.year||0))[0],R={id:t,name:w.name||s,image:((o=w.artwork)==null?void 0:o.large)||((a=w.artwork)==null?void 0:a.medium)||(r==null?void 0:r.image),followers:w.followers||(r==null?void 0:r.followers),genres:w.genres||(r==null?void 0:r.genres),bio:w.bio,verified:w.verified,externalUrls:w.externalUrls,source:(r==null?void 0:r.source)||"addon",topTracks:T.slice(0,10),albums:N.albums.slice(0,10),singles:N.singles.slice(0,10),eps:N.eps.slice(0,10),compilations:N.compilations.slice(0,10),appearsOn:S.slice(0,10),similarArtists:C.slice(0,10),latestRelease:P},L=new Map(e().artistCache);return L.set(t,R),n({artistCache:L,loadingArtistId:null}),R}}catch(w){console.warn("getArtist API failed, falling back to search:",w)}const f=(await window.api.search({query:s,type:"track"})||[]).filter(w=>w.artists.some(N=>N.name.toLowerCase()===s.toLowerCase()||N.id===t)),g=(await window.api.search({query:s,type:"album"}).catch(()=>[])||[]).filter(w=>{var C;const N=(C=w.artists)==null?void 0:C[0];return N&&(N.name.toLowerCase()===s.toLowerCase()||N.id===t)}).map(w=>Ol(w,s,"addon")),x=new Map;for(const w of f)w.album&&!x.has(w.album.id)&&x.set(w.album.id,{id:w.album.id,title:w.album.title,artist:s,artwork:(l=w.album.artwork)==null?void 0:l.medium,year:w.album.releaseDate?parseInt(w.album.releaseDate.substring(0,4)):void 0,trackCount:w.album.trackCount,source:((u=w._meta)==null?void 0:u.metadataProvider)||"unknown"});const y=g.length>0?g:Array.from(x.values()),b={id:t,name:s,image:r==null?void 0:r.image,followers:r==null?void 0:r.followers,genres:r==null?void 0:r.genres,bio:void 0,verified:void 0,externalUrls:void 0,source:(r==null?void 0:r.source)||"addon",topTracks:f.slice(0,10),albums:y.slice(0,10),singles:[],eps:[],compilations:[],appearsOn:[],similarArtists:[]},k=new Map(e().artistCache);return k.set(t,b),n({artistCache:k,loadingArtistId:null}),b}catch(d){return n({error:d instanceof Error?d.message:"Failed to fetch artist",loadingArtistId:null}),null}},getArtist:t=>e().artistCache.get(t)||null,clearCache:()=>{n({artistCache:new Map})}})),Ru=new Map;function Da(){return{dominant:"#1db954",vibrant:"#1ed760",muted:"#2d2d2d",darkVibrant:"#0d5c2a",lightVibrant:"#5eff8f"}}function Du(n,e,t){return"#"+[n,e,t].map(s=>{const r=Math.round(Math.max(0,Math.min(255,s))).toString(16);return r.length===1?"0"+r:r}).join("")}function G0(n,e,t){return(.299*n+.587*e+.114*t)/255}function OI(n,e,t){const s=Math.max(n,e,t),r=Math.min(n,e,t);return s===0?0:(s-r)/s}function _I(n,e,t,s){return{r:Math.round(n*s),g:Math.round(e*s),b:Math.round(t*s)}}function wpe(n,e=5){const t=new Map;for(let s=0;s<n.length;s+=4){const r=n[s]??0,i=n[s+1]??0,o=n[s+2]??0;if((n[s+3]??0)<128)continue;const l=Math.round(r/16)*16,u=Math.round(i/16)*16,d=Math.round(o/16)*16,f=`${l},${u},${d}`,p=t.get(f);p?(p.count++,p.r=Math.round(((p.r??0)*(p.count-1)+r)/p.count),p.g=Math.round(((p.g??0)*(p.count-1)+i)/p.count),p.b=Math.round(((p.b??0)*(p.count-1)+o)/p.count)):t.set(f,{r,g:i,b:o,count:1})}return Array.from(t.values()).sort((s,r)=>r.count-s.count).slice(0,e*3)}function kpe(n){if(n.length===0)return Da();let e=n[0];for(const l of n){const u=G0(l.r,l.g,l.b);if(u>.1&&u<.9){e=l;break}}let t=e,s=0;for(const l of n){const u=OI(l.r,l.g,l.b),d=G0(l.r,l.g,l.b);u>s&&d>.2&&d<.8&&(s=u,t=l)}let r=e,i=1;for(const l of n){const u=OI(l.r,l.g,l.b),d=G0(l.r,l.g,l.b);u<i&&u>.05&&d>.15&&d<.85&&(i=u,r=l)}const o=_I(t.r??0,t.g??0,t.b??0,.4),a=_I(t.r??0,t.g??0,t.b??0,1.4);return{dominant:Du(e.r??0,e.g??0,e.b??0),vibrant:Du(t.r??0,t.g??0,t.b??0),muted:Du(r.r??0,r.g??0,r.b??0),darkVibrant:Du(o.r??0,o.g??0,o.b??0),lightVibrant:Du(a.r??0,a.g??0,a.b??0)}}async function Cpe(n){return new Promise(e=>{const t=new Image;t.crossOrigin="anonymous";const s=setTimeout(()=>{e(Da())},5e3);t.onload=()=>{clearTimeout(s);try{const r=document.createElement("canvas"),i=50;r.width=i,r.height=i;const o=r.getContext("2d");if(!o){e(Da());return}o.drawImage(t,0,0,i,i);const a=o.getImageData(0,0,i,i).data,l=wpe(a),u=kpe(l);e(u)}catch(r){console.warn("Color extraction failed:",r),e(Da())}},t.onerror=()=>{clearTimeout(s),e(Da())},t.src=n})}async function yM(n){const e=Ru.get(n);if(e)return e;const t=await Cpe(n);if(Ru.set(n,t),Ru.size>100){const s=Ru.keys().next().value;s&&Ru.delete(s)}return t}const mp={videos:[],timeline:[],setlists:[],concerts:[],gallery:null,merchandiseUrl:null},H0={videos:!1,timeline:!1,setlists:!1,concerts:!1,gallery:!1,merchandise:!1},zI={videos:null,timeline:null,setlists:null,concerts:null,gallery:null,merchandise:null};function Spe(n,e={}){const{enabled:t=!0,mbid:s}=e,[r,i]=j.useState(mp),[o,a]=j.useState(H0),[l,u]=j.useState(zI),[d,f]=j.useState([]),p=j.useRef(!0),g=j.useRef(0);j.useEffect(()=>(p.current=!0,()=>{p.current=!1}),[]);const x=j.useCallback(async()=>{var k;if(!t||!n){i(mp),a(H0);return}if(!((k=window.api)!=null&&k.enrichment)){console.warn("[useArtistEnrichment] window.api.enrichment not available"),i(mp),a(H0);return}const b=++g.current;try{console.log("[useArtistEnrichment] Fetching available types for artist:",n);const w=await window.api.enrichment.getAvailableTypes();if(console.log("[useArtistEnrichment] Available types:",w,"for artist:",n),!p.current||b!==g.current)return;f(w);const N=[];w.includes("videos")&&(a(C=>({...C,videos:!0})),N.push(window.api.enrichment.getVideos(n,8).then(C=>{!p.current||b!==g.current||(C.success?(i(S=>({...S,videos:C.data})),u(S=>({...S,videos:null}))):u(S=>({...S,videos:C.error||"Failed to fetch videos"})),a(S=>({...S,videos:!1})))}).catch(C=>{p.current&&b===g.current&&(u(S=>({...S,videos:String(C)})),a(S=>({...S,videos:!1})))}))),w.includes("timeline")&&(a(C=>({...C,timeline:!0})),N.push(window.api.enrichment.getTimeline(n).then(C=>{!p.current||b!==g.current||(C.success?(i(S=>({...S,timeline:C.data})),u(S=>({...S,timeline:null}))):u(S=>({...S,timeline:C.error||"Failed to fetch timeline"})),a(S=>({...S,timeline:!1})))}).catch(C=>{p.current&&b===g.current&&(u(S=>({...S,timeline:String(C)})),a(S=>({...S,timeline:!1})))}))),w.includes("setlists")&&(a(C=>({...C,setlists:!0})),N.push(window.api.enrichment.getSetlists(n,s,5).then(C=>{!p.current||b!==g.current||(C.success?(i(S=>({...S,setlists:C.data})),u(S=>({...S,setlists:null}))):u(S=>({...S,setlists:C.error||"Failed to fetch setlists"})),a(S=>({...S,setlists:!1})))}).catch(C=>{p.current&&b===g.current&&(u(S=>({...S,setlists:String(C)})),a(S=>({...S,setlists:!1})))}))),w.includes("concerts")&&(a(C=>({...C,concerts:!0})),N.push(window.api.enrichment.getConcerts(n).then(C=>{!p.current||b!==g.current||(C.success?(i(S=>({...S,concerts:C.data})),u(S=>({...S,concerts:null}))):u(S=>({...S,concerts:C.error||"Failed to fetch concerts"})),a(S=>({...S,concerts:!1})))}).catch(C=>{p.current&&b===g.current&&(u(S=>({...S,concerts:String(C)})),a(S=>({...S,concerts:!1})))}))),w.includes("gallery")&&(a(C=>({...C,gallery:!0})),N.push(window.api.enrichment.getGallery(s,n).then(C=>{!p.current||b!==g.current||(C.success?(i(S=>({...S,gallery:C.data})),u(S=>({...S,gallery:null}))):u(S=>({...S,gallery:C.error||"Failed to fetch gallery"})),a(S=>({...S,gallery:!1})))}).catch(C=>{p.current&&b===g.current&&(u(S=>({...S,gallery:String(C)})),a(S=>({...S,gallery:!1})))}))),w.includes("merchandise")&&(a(C=>({...C,merchandise:!0})),N.push(window.api.enrichment.getMerchandise(n).then(C=>{!p.current||b!==g.current||(C.success?(i(S=>({...S,merchandiseUrl:C.data})),u(S=>({...S,merchandise:null}))):u(S=>({...S,merchandise:C.error||"Failed to fetch merchandise"})),a(S=>({...S,merchandise:!1})))}).catch(C=>{p.current&&b===g.current&&(u(S=>({...S,merchandise:String(C)})),a(S=>({...S,merchandise:!1})))}))),await Promise.allSettled(N)}catch(w){console.error("[useArtistEnrichment] Error fetching enrichment data:",w)}},[n,t,s]);j.useEffect(()=>{i(mp),u(zI),x()},[x]);const y=j.useCallback(()=>{x()},[x]);return{data:r,loading:o,errors:l,availableTypes:d,refetch:y}}const BI="audiio-section-collapsed-",Ia=({title:n,sectionId:e,icon:t,defaultExpanded:s=!0,children:r,className:i="",badge:o,loading:a=!1})=>{const[l,u]=j.useState(()=>{try{const y=localStorage.getItem(`${BI}${e}`);if(y!==null)return y!=="true"}catch{}return s}),d=j.useRef(null),[f,p]=j.useState(void 0);j.useEffect(()=>{try{localStorage.setItem(`${BI}${e}`,(!l).toString())}catch{}},[l,e]),j.useEffect(()=>{d.current&&requestAnimationFrame(()=>{d.current&&p(d.current.scrollHeight)})},[r,a]),j.useEffect(()=>{if(!a&&d.current){const y=setTimeout(()=>{d.current&&p(d.current.scrollHeight)},100);return()=>clearTimeout(y)}},[a]);const g=()=>{l&&d.current&&p(d.current.scrollHeight),u(y=>!y)},x=()=>l?f?`${f+20}px`:"2000px":"0px";return c.jsxs("section",{className:`collapsible-section ${l?"expanded":"collapsed"} ${i}`,children:[c.jsxs("button",{className:"collapsible-section-header",onClick:g,"aria-expanded":l,"aria-controls":`section-content-${e}`,type:"button",children:[c.jsxs("div",{className:"collapsible-section-title-wrapper",children:[t&&c.jsx("span",{className:"collapsible-section-icon",children:t}),c.jsx("h2",{className:"section-title-spotify",children:n}),o&&c.jsx("span",{className:"collapsible-section-badge",children:o})]}),c.jsx("span",{className:`collapsible-section-chevron ${l?"rotated":""}`,children:c.jsx(Fa,{size:20})})]}),c.jsx("div",{id:`section-content-${e}`,className:"collapsible-section-content",style:{maxHeight:x(),opacity:l?1:0,overflow:"hidden"},children:c.jsx("div",{ref:d,children:a?c.jsx("div",{className:"collapsible-section-loading",children:c.jsx("div",{className:"section-loading-skeleton skeleton"})}):r})})]})},vM=({videos:n,onVideoClick:e})=>{if(!n||n.length===0)return null;const t=r=>r?r>=1e9?`${(r/1e9).toFixed(1)}B views`:r>=1e6?`${(r/1e6).toFixed(1)}M views`:r>=1e3?`${Math.floor(r/1e3)}K views`:`${r} views`:"",s=r=>{try{return new Date(r).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})}catch{return""}};return c.jsx("div",{className:"enrichment-videos-grid",children:n.slice(0,8).map(r=>c.jsxs("div",{className:"video-card",onClick:()=>e==null?void 0:e(r),role:"button",tabIndex:0,onKeyDown:i=>i.key==="Enter"&&(e==null?void 0:e(r)),children:[c.jsxs("div",{className:"video-card-thumbnail",children:[c.jsx("img",{src:r.thumbnail,alt:r.title,loading:"lazy"}),r.duration&&c.jsx("span",{className:"video-card-duration",children:r.duration}),c.jsx("div",{className:"video-card-play-overlay",children:c.jsx("svg",{width:"40",height:"40",viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M8 5v14l11-7z"})})})]}),c.jsxs("div",{className:"video-card-info",children:[c.jsx("span",{className:"video-card-title",children:r.title}),c.jsxs("span",{className:"video-card-meta",children:[r.viewCount?t(r.viewCount):"",r.viewCount&&r.publishedAt?"  ":"",r.publishedAt?s(r.publishedAt):""]})]})]},r.id))})},Npe=({concerts:n})=>{if(!n||n.length===0)return null;const e=s=>{try{const r=new Date(s);return{day:r.getDate().toString(),month:r.toLocaleDateString(void 0,{month:"short"}),year:r.getFullYear().toString()}}catch{return{day:"--",month:"---",year:"----"}}},t=s=>{const r=[s.city];return s.region&&r.push(s.region),s.country&&r.push(s.country),r.join(", ")};return c.jsx("div",{className:"enrichment-concerts-list",children:n.slice(0,5).map(s=>{const r=e(s.datetime);return c.jsxs("div",{className:"concert-card",children:[c.jsxs("div",{className:"concert-date",children:[c.jsx("span",{className:"concert-date-month",children:r.month}),c.jsx("span",{className:"concert-date-day",children:r.day})]}),c.jsxs("div",{className:"concert-info",children:[c.jsx("span",{className:"concert-venue",children:s.venue.name}),c.jsx("span",{className:"concert-location",children:t(s.venue)}),s.lineup&&s.lineup.length>1&&c.jsxs("span",{className:"concert-lineup",children:["with ",s.lineup.slice(1,3).join(", "),s.lineup.length>3?` +${s.lineup.length-3} more`:""]})]}),s.ticketUrl&&c.jsx("a",{href:s.ticketUrl,target:"_blank",rel:"noopener noreferrer",className:"concert-tickets-btn",onClick:i=>i.stopPropagation(),children:"Tickets"})]},s.id)})})},Ipe=({setlists:n})=>{const[e,t]=j.useState(null);if(!n||n.length===0)return null;const s=o=>{try{return new Date(o).toLocaleDateString(void 0,{year:"numeric",month:"long",day:"numeric"})}catch{return o}},r=o=>`${o.name}, ${o.city}, ${o.country}`,i=o=>{t(a=>a===o?null:o)};return c.jsx("div",{className:"enrichment-setlists-list",children:n.slice(0,5).map(o=>{const a=e===o.id;return c.jsxs("div",{className:`setlist-card ${a?"expanded":""}`,children:[c.jsxs("button",{className:"setlist-header",onClick:()=>i(o.id),"aria-expanded":a,children:[c.jsxs("div",{className:"setlist-info",children:[c.jsx("span",{className:"setlist-date",children:s(o.eventDate)}),c.jsx("span",{className:"setlist-venue",children:r(o.venue)}),o.tour&&c.jsx("span",{className:"setlist-tour",children:o.tour})]}),c.jsxs("div",{className:"setlist-meta",children:[c.jsxs("span",{className:"setlist-song-count",children:[o.songs.length," songs"]}),c.jsx("span",{className:`setlist-chevron ${a?"rotated":""}`,children:c.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M7 10l5 5 5-5z"})})})]})]}),a&&o.songs.length>0&&c.jsxs("div",{className:"setlist-songs",children:[c.jsx("ol",{className:"setlist-songs-list",children:o.songs.map((l,u)=>c.jsxs("li",{className:`setlist-song ${l.cover?"cover":""}`,children:[c.jsx("span",{className:"setlist-song-number",children:u+1}),c.jsx("span",{className:"setlist-song-name",children:l.name}),l.cover&&c.jsx("span",{className:"setlist-song-cover-badge",children:"Cover"}),l.info&&c.jsx("span",{className:"setlist-song-info",children:l.info})]},u))}),o.url&&c.jsx("a",{href:o.url,target:"_blank",rel:"noopener noreferrer",className:"setlist-view-link",children:"View on Setlist.fm"})]})]},o.id)})})},Tpe=({timeline:n,onEntryClick:e})=>{if(!n||n.length===0)return null;const t=n.reduce((o,a)=>{const l=a.year.toString();return o[l]||(o[l]=[]),o[l].push(a),o},{}),s=Object.keys(t).sort((o,a)=>parseInt(a)-parseInt(o)),r=o=>{switch(o){case"album":return"Album";case"single":return"Single";case"ep":return"EP";case"compilation":return"Compilation";case"live":return"Live";default:return o}},i=o=>{switch(o){case"album":return"var(--accent-primary)";case"single":return"var(--accent-success)";case"ep":return"var(--accent-warning)";case"compilation":return"var(--text-muted)";case"live":return"var(--accent-error)";default:return"var(--text-secondary)"}};return c.jsx("div",{className:"enrichment-timeline",children:s.slice(0,10).map(o=>c.jsxs("div",{className:"timeline-year-group",children:[c.jsxs("div",{className:"timeline-year-marker",children:[c.jsx("span",{className:"timeline-year",children:o}),c.jsx("div",{className:"timeline-year-line"})]}),c.jsx("div",{className:"timeline-entries",children:t[o].map((a,l)=>c.jsxs("div",{className:"timeline-entry",onClick:()=>e==null?void 0:e(a),role:e?"button":void 0,tabIndex:e?0:void 0,onKeyDown:u=>u.key==="Enter"&&(e==null?void 0:e(a)),children:[c.jsx("div",{className:"timeline-entry-artwork",children:a.artwork?c.jsx("img",{src:a.artwork,alt:a.title,loading:"lazy"}):c.jsx("div",{className:"timeline-entry-artwork-placeholder",children:c.jsx(qe,{size:20})})}),c.jsxs("div",{className:"timeline-entry-info",children:[c.jsx("span",{className:"timeline-entry-title",children:a.title}),c.jsxs("div",{className:"timeline-entry-meta",children:[c.jsx("span",{className:"timeline-entry-type",style:{color:i(a.type)},children:r(a.type)}),a.label&&c.jsx("span",{className:"timeline-entry-label",children:a.label})]})]})]},`${a.title}-${l}`))})]},o))})},$pe=({gallery:n})=>{var k,w,N,C;const[e,t]=j.useState("backgrounds"),[s,r]=j.useState(null);if(!n)return null;const i=n.backgrounds&&n.backgrounds.length>0,o=n.thumbs&&n.thumbs.length>0,a=n.logos&&n.logos.length>0||n.hdLogos&&n.hdLogos.length>0;if(!i&&!o&&!a)return null;const d=(()=>{switch(e){case"backgrounds":return n.backgrounds||[];case"thumbs":return n.thumbs||[];case"logos":return[...n.hdLogos||[],...n.logos||[]];default:return[]}})().slice(0,12),f=j.useCallback(()=>{r(S=>S!==null&&S>0?S-1:S)},[]),p=j.useCallback(()=>{r(S=>S!==null&&S<d.length-1?S+1:S)},[d.length]),g=j.useCallback(()=>{r(null)},[]);j.useEffect(()=>{if(s===null)return;const S=T=>{switch(T.key){case"Escape":g();break;case"ArrowLeft":f();break;case"ArrowRight":p();break}};return document.body.style.overflow="hidden",document.addEventListener("keydown",S),()=>{document.body.style.overflow="",document.removeEventListener("keydown",S)}},[s,g,f,p]);const x=s!==null?d[s]:null,y=s!==null&&s>0,b=s!==null&&s<d.length-1;return c.jsxs("div",{className:"enrichment-gallery",children:[c.jsxs("div",{className:"gallery-tabs",children:[i&&c.jsxs("button",{className:`gallery-tab ${e==="backgrounds"?"active":""}`,onClick:()=>t("backgrounds"),children:["Backgrounds",c.jsx("span",{className:"gallery-tab-count",children:((k=n.backgrounds)==null?void 0:k.length)||0})]}),o&&c.jsxs("button",{className:`gallery-tab ${e==="thumbs"?"active":""}`,onClick:()=>t("thumbs"),children:["Photos",c.jsx("span",{className:"gallery-tab-count",children:((w=n.thumbs)==null?void 0:w.length)||0})]}),a&&c.jsxs("button",{className:`gallery-tab ${e==="logos"?"active":""}`,onClick:()=>t("logos"),children:["Logos",c.jsx("span",{className:"gallery-tab-count",children:(((N=n.hdLogos)==null?void 0:N.length)||0)+(((C=n.logos)==null?void 0:C.length)||0)})]})]}),c.jsx("div",{className:`gallery-grid gallery-grid-${e}`,children:d.map((S,T)=>c.jsxs("div",{className:"gallery-image",onClick:()=>r(T),role:"button",tabIndex:0,onKeyDown:A=>A.key==="Enter"&&r(T),children:[c.jsx("img",{src:S.url,alt:`Gallery image ${T+1}`,loading:"lazy"}),S.likes!==void 0&&S.likes>0&&c.jsxs("span",{className:"gallery-image-likes",children:[c.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"})}),S.likes]})]},`${S.url}-${T}`))}),x&&c.jsxs("div",{className:"gallery-lightbox",onClick:S=>S.target===S.currentTarget&&g(),role:"dialog","aria-modal":"true","aria-label":"Image viewer",children:[c.jsx("button",{className:"gallery-lightbox-close",onClick:g,"aria-label":"Close lightbox",children:c.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})})}),c.jsxs("div",{className:"gallery-lightbox-counter",children:[s+1," / ",d.length]}),c.jsx("button",{className:`gallery-lightbox-nav gallery-lightbox-prev ${y?"":"disabled"}`,onClick:S=>{S.stopPropagation(),f()},disabled:!y,"aria-label":"Previous image",children:c.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"})})}),c.jsxs("div",{className:"gallery-lightbox-image-container",children:[c.jsx("img",{src:x.url,alt:`Gallery image ${s+1}`,className:"gallery-lightbox-image"}),x.likes!==void 0&&x.likes>0&&c.jsxs("div",{className:"gallery-lightbox-info",children:[c.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"})}),c.jsxs("span",{children:[x.likes," likes"]})]})]}),c.jsx("button",{className:`gallery-lightbox-nav gallery-lightbox-next ${b?"":"disabled"}`,onClick:S=>{S.stopPropagation(),p()},disabled:!b,"aria-label":"Next image",children:c.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"})})})]})]})},Epe=({merchandiseUrl:n,artistName:e})=>{if(!n)return null;const s=(r=>r.includes("bandcamp.com")?{name:"Bandcamp",icon:"bandcamp"}:r.includes("shopify")?{name:"Shop",icon:"shop"}:r.includes("merch")?{name:"Merch Store",icon:"shop"}:{name:"Official Store",icon:"shop"})(n);return c.jsx("div",{className:"enrichment-merchandise",children:c.jsxs("a",{href:n,target:"_blank",rel:"noopener noreferrer",className:"merchandise-link-card",children:[c.jsx("div",{className:"merchandise-icon",children:s.icon==="bandcamp"?c.jsx("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M0 18.75l7.437-13.5H24l-7.438 13.5H0z"})}):c.jsx("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12.9-1.63h7.45c.75 0 1.41-.41 1.75-1.03l3.58-6.49c.08-.14.12-.31.12-.48 0-.55-.45-1-1-1H5.21l-.94-2H1zm16 16c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2z"})})}),c.jsxs("div",{className:"merchandise-info",children:[c.jsx("span",{className:"merchandise-title",children:"Official Merchandise"}),c.jsxs("span",{className:"merchandise-subtitle",children:["Shop ",e," on ",s.name]})]}),c.jsx("div",{className:"merchandise-arrow",children:c.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"})})})]})})},Ape=n=>{const{url:e,source:t,id:s}=n;switch(t){case"youtube":return`https://www.youtube.com/embed/${s}?autoplay=1&rel=0&modestbranding=1`;case"vimeo":return`https://player.vimeo.com/video/${s}?autoplay=1`;case"dailymotion":return`https://www.dailymotion.com/embed/video/${s}?autoplay=1`}return jpe(e,s)},jpe=(n,e)=>{if(n.includes("youtube.com")||n.includes("youtu.be")){const t=n.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/|embed\/)([^&\n?#]+)/);return`https://www.youtube.com/embed/${(t==null?void 0:t[1])||e}?autoplay=1&rel=0&modestbranding=1`}if(n.includes("vimeo.com")){const t=n.match(/vimeo\.com\/(\d+)/);return`https://player.vimeo.com/video/${(t==null?void 0:t[1])||e}?autoplay=1`}if(n.includes("dailymotion.com")){const t=n.match(/dailymotion\.com\/video\/([a-zA-Z0-9]+)/);return`https://www.dailymotion.com/embed/video/${(t==null?void 0:t[1])||e}?autoplay=1`}return null},Rpe=n=>({youtube:"YouTube",vimeo:"Vimeo",dailymotion:"Dailymotion"})[n]||n.charAt(0).toUpperCase()+n.slice(1),bM=({video:n,onClose:e})=>{const t=j.useCallback(o=>{o.key==="Escape"&&e()},[e]);if(j.useEffect(()=>{if(n)return document.addEventListener("keydown",t),document.body.style.overflow="hidden",()=>{document.removeEventListener("keydown",t),document.body.style.overflow=""}},[n,t]),!n)return null;const s=Ape(n),r=o=>{o.target===o.currentTarget&&e()},i=()=>{window.open(n.url,"_blank","noopener,noreferrer"),e()};return c.jsx("div",{className:"video-player-modal",onClick:r,children:c.jsxs("div",{className:"video-player-modal-content",children:[c.jsxs("header",{className:"video-player-modal-header",children:[c.jsxs("div",{className:"video-player-modal-title",children:[c.jsx("h3",{children:n.title}),c.jsx("span",{className:"video-player-modal-source",children:Rpe(n.source)})]}),c.jsx("button",{className:"video-player-modal-close",onClick:e,"aria-label":"Close video",children:c.jsx(an,{size:24})})]}),c.jsx("div",{className:"video-player-modal-player",children:s?c.jsx("iframe",{src:s,title:n.title,frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",allowFullScreen:!0,referrerPolicy:"no-referrer-when-downgrade",sandbox:"allow-scripts allow-same-origin allow-presentation allow-popups"}):c.jsxs("div",{className:"video-player-modal-fallback",children:[c.jsx("p",{children:"Unable to embed this video."}),c.jsx("button",{onClick:i,children:"Open in Browser"})]})})]})})},q0=({label:n,isActive:e,onClick:t,count:s})=>c.jsxs("button",{className:`discography-pill-tab ${e?"active":""}`,onClick:t,role:"tab","aria-selected":e,children:[n,s!==void 0&&s>0&&c.jsx("span",{className:"pill-tab-count",children:s})]}),WI=({album:n,onClick:e,onContextMenu:t})=>c.jsxs("div",{className:"album-card-minimal",onClick:e,onContextMenu:t,role:"button",tabIndex:0,onKeyDown:s=>s.key==="Enter"&&e(),children:[c.jsxs("div",{className:"album-card-minimal-artwork",children:[n.artwork?c.jsx("img",{src:n.artwork,alt:n.title,loading:"lazy"}):c.jsx("div",{className:"album-card-minimal-placeholder",children:c.jsx(qe,{size:32})}),c.jsx("div",{className:"album-card-minimal-play",children:c.jsx(Et,{size:20})})]}),c.jsx("span",{className:"album-card-minimal-title",children:n.title}),n.year&&c.jsx("span",{className:"album-card-minimal-year",children:n.year})]}),Dpe=({artist:n,onClick:e})=>c.jsxs("div",{className:"similar-artist-card-circular",onClick:e,role:"button",tabIndex:0,onKeyDown:t=>t.key==="Enter"&&(e==null?void 0:e()),children:[c.jsx("div",{className:"similar-artist-image-circular",children:n.image?c.jsx("img",{src:n.image,alt:n.name,loading:"lazy"}):c.jsx("div",{className:"similar-artist-placeholder-circular",children:c.jsx(qe,{size:32})})}),c.jsx("span",{className:"similar-artist-name",children:n.name})]}),Ppe=()=>{var pe,ge,he,we,Pe;const{selectedArtistId:n,selectedArtistData:e,goBack:t,openAlbum:s,openArtist:r}=Wt(),{play:i,setQueue:o,currentTrack:a}=Ke(),{likedTracks:l}=Xt(),{startRadio:u}=dl(),{fetchArtist:d,getArtist:f,loadingArtistId:p,error:g}=bpe(),{showContextMenu:x}=pt(),{showContextMenu:y}=Fh(),[b,k]=j.useState(Da()),[w,N]=j.useState("albums"),[C,S]=j.useState(null),T=j.useRef(null),A=j.useRef(null),E=f(n||""),M=E||e,P=p===n,R=Spe((E==null?void 0:E.name)||(e==null?void 0:e.name),{enabled:!P&&!!(E!=null&&E.name||e!=null&&e.name),mbid:E==null?void 0:E.mbid});if(j.useEffect(()=>{M!=null&&M.image&&yM(M.image).then(k)},[M==null?void 0:M.image]),j.useEffect(()=>{n&&(e!=null&&e.name)&&d(n,e.name,{image:e.image,followers:e.followers,source:e.source})},[n,e==null?void 0:e.name]),j.useEffect(()=>{N("albums")},[n]),!n)return c.jsx("div",{className:"artist-detail-view-spotify",children:c.jsxs("div",{className:"artist-not-found",children:[c.jsx("p",{children:"Artist not found"}),c.jsx("button",{onClick:t,children:"Go Back"})]})});const L=()=>{if(E!=null&&E.topTracks&&E.topTracks.length>0){const ue=E.topTracks[0];o(E.topTracks,0),ue&&i(ue)}},_=()=>{if(E!=null&&E.topTracks&&E.topTracks.length>0){const ue=[...E.topTracks].sort(()=>Math.random()-.5),Te=ue[0];o(ue,0),Te&&i(Te)}},O=async()=>{const ue=(E==null?void 0:E.name)||(e==null?void 0:e.name)||"Artist",Te=(E==null?void 0:E.id)||n||"",ke={type:"artist",id:Te,name:`${ue} Radio`,artwork:E==null?void 0:E.image,artistIds:[Te],genres:E==null?void 0:E.genres};await u(ke,[...l,...(E==null?void 0:E.topTracks)||[]]),tc(`Started ${ue} Radio`)},U=(ue,Te)=>{E!=null&&E.topTracks&&(o(E.topTracks,Te),i(ue))},W=ue=>{s(ue.id,ue)},H=ue=>{r(ue.id,{id:ue.id,name:ue.name,image:ue.image,source:E==null?void 0:E.source})},G=ue=>{S(ue)},q=ue=>{if(!ue)return"--:--";const Te=Math.floor(ue/60),ke=Math.floor(ue%60);return`${Te}:${ke.toString().padStart(2,"0")}`},Q=ue=>ue?ue>=1e6?`${(ue/1e6).toFixed(1)}M followers`:ue>=1e3?`${Math.floor(ue/1e3)}K followers`:`${ue} followers`:"",K=(()=>{switch(w){case"albums":return(E==null?void 0:E.albums)||[];case"singles":return(E==null?void 0:E.singles)||[];case"eps":return(E==null?void 0:E.eps)||[];default:return[]}})(),Y=((pe=E==null?void 0:E.albums)==null?void 0:pe.length)||0,B=((ge=E==null?void 0:E.singles)==null?void 0:ge.length)||0,J=((he=E==null?void 0:E.eps)==null?void 0:he.length)||0,ae=Y>0||B>0||J>0;return c.jsxs("div",{className:"artist-detail-view-spotify",style:{"--ambient-color":b.dominant,"--ambient-muted":b.muted,"--ambient-vibrant":b.vibrant},children:[c.jsxs("div",{className:"artist-header-magazine",children:[c.jsx("div",{className:"artist-header-ambient"}),c.jsx("button",{className:"back-btn-round artist-back-btn-pos",onClick:t,"aria-label":"Go back",children:c.jsx(gb,{size:20})}),c.jsxs("div",{className:"artist-header-split",children:[c.jsx("div",{className:"artist-header-image-container",children:M!=null&&M.image?c.jsx("img",{className:"artist-header-image",src:M.image,alt:(M==null?void 0:M.name)||"Artist"}):c.jsx("div",{className:"artist-header-image-placeholder",children:c.jsx(qe,{size:80})})}),c.jsxs("div",{className:"artist-header-info",children:[c.jsxs("div",{className:"artist-header-meta",children:[(E==null?void 0:E.verified)&&c.jsxs("span",{className:"artist-verified-pill",children:[c.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10 10-4.5 10-10S17.5 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"})}),"Verified"]}),c.jsx("span",{className:"artist-type-label",children:"Artist"})]}),c.jsx("h1",{className:"artist-name-magazine",children:(M==null?void 0:M.name)||"Unknown Artist"}),(E==null?void 0:E.genres)&&E.genres.length>0&&c.jsx("div",{className:"artist-genres-magazine",children:E.genres.slice(0,3).map(ue=>c.jsx("span",{className:"artist-genre-tag",children:ue},ue))}),(E==null?void 0:E.bio)&&c.jsx("p",{className:"artist-bio-excerpt",children:E.bio.length>150?`${E.bio.substring(0,150)}...`:E.bio}),c.jsxs("div",{className:"artist-stats-row",children:[(E==null?void 0:E.followers)&&E.followers>0&&c.jsxs("div",{className:"artist-stat",children:[c.jsx("span",{className:"artist-stat-value",children:Q(E.followers).replace(" followers","")}),c.jsx("span",{className:"artist-stat-label",children:"Followers"})]}),(E==null?void 0:E.topTracks)&&E.topTracks.length>0&&c.jsxs("div",{className:"artist-stat",children:[c.jsx("span",{className:"artist-stat-value",children:E.topTracks.length}),c.jsx("span",{className:"artist-stat-label",children:"Top Tracks"})]}),Y>0&&c.jsxs("div",{className:"artist-stat",children:[c.jsx("span",{className:"artist-stat-value",children:Y}),c.jsx("span",{className:"artist-stat-label",children:"Albums"})]}),B>0&&c.jsxs("div",{className:"artist-stat",children:[c.jsx("span",{className:"artist-stat-value",children:B}),c.jsx("span",{className:"artist-stat-label",children:"Singles"})]})]}),c.jsxs("div",{className:"artist-actions-magazine",children:[c.jsxs("button",{className:"artist-play-btn-magazine",onClick:L,disabled:!((we=E==null?void 0:E.topTracks)!=null&&we.length),"aria-label":"Play all tracks",children:[c.jsx(Et,{size:18}),c.jsx("span",{children:"Play"})]}),c.jsxs("button",{className:"artist-shuffle-btn-magazine",onClick:_,disabled:!((Pe=E==null?void 0:E.topTracks)!=null&&Pe.length),"aria-label":"Shuffle play",children:[c.jsx(oo,{size:16}),c.jsx("span",{children:"Shuffle"})]}),c.jsxs("button",{className:"artist-radio-btn-magazine",onClick:O,"aria-label":"Start artist radio",children:[c.jsx(rc,{size:16}),c.jsx("span",{children:"Radio"})]})]})]})]})]}),c.jsxs("div",{className:"artist-content-spotify",children:[(E==null?void 0:E.latestRelease)&&c.jsxs("section",{className:"artist-section-latest-release",children:[c.jsx("h2",{className:"section-title-spotify",children:"Latest Release"}),c.jsxs("div",{className:"latest-release-card",onClick:()=>W(E.latestRelease),onContextMenu:ue=>y(ue,E.latestRelease),role:"button",tabIndex:0,onKeyDown:ue=>ue.key==="Enter"&&W(E.latestRelease),children:[c.jsxs("div",{className:"latest-release-artwork",children:[E.latestRelease.artwork?c.jsx("img",{src:E.latestRelease.artwork,alt:E.latestRelease.title}):c.jsx("div",{className:"latest-release-artwork-placeholder",children:c.jsx(qe,{size:48})}),c.jsx("span",{className:"latest-release-badge",children:"NEW"}),c.jsx("div",{className:"latest-release-play",children:c.jsx(Et,{size:28})})]}),c.jsxs("div",{className:"latest-release-info",children:[c.jsx("span",{className:"latest-release-title",children:E.latestRelease.title}),c.jsxs("span",{className:"latest-release-meta",children:[E.latestRelease.year,E.latestRelease.trackCount&&`  ${E.latestRelease.trackCount} songs`]})]})]})]}),c.jsxs("section",{className:"artist-section-popular",children:[c.jsx("h2",{className:"section-title-spotify",children:"Popular"}),c.jsx("div",{className:"popular-tracks-list",children:P?c.jsx("div",{className:"popular-tracks-loading",children:Array.from({length:5}).map((ue,Te)=>c.jsx("div",{className:"track-row-skeleton skeleton"},Te))}):g?c.jsx("p",{className:"section-error",children:g}):E!=null&&E.topTracks&&E.topTracks.length>0?E.topTracks.slice(0,5).map((ue,Te)=>{var ke;return c.jsxs("div",{className:`track-row-clean ${(a==null?void 0:a.id)===ue.id?"playing":""}`,onClick:()=>U(ue,Te),onContextMenu:ye=>x(ye,ue),role:"button",tabIndex:0,onKeyDown:ye=>ye.key==="Enter"&&U(ue,Te),children:[c.jsxs("div",{className:"track-number-cell",children:[c.jsx("span",{className:"track-number",children:Te+1}),c.jsx("span",{className:"track-play-icon",children:c.jsx(Et,{size:16})})]}),c.jsx("div",{className:"track-artwork-cell",children:(ke=ue.artwork)!=null&&ke.small?c.jsx("img",{src:ue.artwork.small,alt:ue.title}):c.jsx("div",{className:"track-artwork-placeholder",children:c.jsx(qe,{size:16})})}),c.jsxs("div",{className:"track-info-cell",children:[c.jsx("span",{className:"track-title-clean",children:ue.title}),ue.album&&c.jsx("span",{className:"track-album-clean",children:ue.album.title})]}),ue.explicit&&c.jsx("span",{className:"explicit-badge-small",children:"E"}),c.jsx("span",{className:"track-duration-cell",children:q(ue.duration)})]},ue.id)}):c.jsx("p",{className:"section-placeholder",children:"No tracks available"})})]}),ae&&c.jsxs("section",{className:"artist-section-discography",children:[c.jsx("h2",{className:"section-title-spotify",children:"Discography"}),c.jsxs("div",{className:"discography-tabs-pills",role:"tablist",children:[Y>0&&c.jsx(q0,{label:"Albums",isActive:w==="albums",onClick:()=>N("albums"),count:Y}),B>0&&c.jsx(q0,{label:"Singles",isActive:w==="singles",onClick:()=>N("singles"),count:B}),J>0&&c.jsx(q0,{label:"EPs",isActive:w==="eps",onClick:()=>N("eps"),count:J})]}),c.jsx("div",{className:"discography-scroll-container",ref:T,children:P?c.jsx("div",{className:"discography-scroll-loading",children:Array.from({length:6}).map((ue,Te)=>c.jsx("div",{className:"album-card-skeleton skeleton"},Te))}):K.length>0?c.jsx("div",{className:"discography-scroll",children:K.map(ue=>c.jsx(WI,{album:ue,onClick:()=>W(ue),onContextMenu:Te=>y(Te,ue)},ue.id))}):c.jsxs("p",{className:"section-placeholder",children:["No ",w," found"]})})]}),(E==null?void 0:E.appearsOn)&&E.appearsOn.length>0&&c.jsxs("section",{className:"artist-section-appears-on",children:[c.jsx("h2",{className:"section-title-spotify",children:"Appears On"}),c.jsx("div",{className:"discography-scroll-container",children:c.jsx("div",{className:"discography-scroll",children:E.appearsOn.map(ue=>c.jsx(WI,{album:ue,onClick:()=>W(ue),onContextMenu:Te=>y(Te,ue)},ue.id))})})]}),(E==null?void 0:E.similarArtists)&&E.similarArtists.length>0&&c.jsxs("section",{className:"artist-section-similar",children:[c.jsx("h2",{className:"section-title-spotify",children:"Fans Also Like"}),c.jsx("div",{className:"similar-artists-scroll-container",ref:A,children:c.jsx("div",{className:"similar-artists-scroll",children:E.similarArtists.map(ue=>c.jsx(Dpe,{artist:ue,onClick:()=>H(ue)},ue.id))})})]}),(R.loading.concerts||R.data.concerts.length>0)&&c.jsx(Ia,{title:"Upcoming Shows",sectionId:`artist-concerts-${n}`,className:"artist-section-enrichment",loading:R.loading.concerts,children:c.jsx(Npe,{concerts:R.data.concerts})}),(R.loading.videos||R.data.videos.length>0)&&c.jsx(Ia,{title:"Music Videos",sectionId:`artist-videos-${n}`,className:"artist-section-enrichment",loading:R.loading.videos,children:c.jsx(vM,{videos:R.data.videos,onVideoClick:G})}),(R.loading.timeline||R.data.timeline.length>0)&&c.jsx(Ia,{title:"Timeline",sectionId:`artist-timeline-${n}`,className:"artist-section-enrichment",loading:R.loading.timeline,children:c.jsx(Tpe,{timeline:R.data.timeline})}),(R.loading.gallery||R.data.gallery)&&c.jsx(Ia,{title:"Gallery",sectionId:`artist-gallery-${n}`,className:"artist-section-enrichment",loading:R.loading.gallery,children:R.data.gallery&&c.jsx($pe,{gallery:R.data.gallery})}),(R.loading.setlists||R.data.setlists.length>0)&&c.jsx(Ia,{title:"Recent Setlists",sectionId:`artist-setlists-${n}`,className:"artist-section-enrichment",loading:R.loading.setlists,children:c.jsx(Ipe,{setlists:R.data.setlists})}),(R.loading.merchandise||R.data.merchandiseUrl)&&c.jsx(Ia,{title:"Merchandise",sectionId:`artist-merch-${n}`,className:"artist-section-enrichment",loading:R.loading.merchandise,children:R.data.merchandiseUrl&&c.jsx(Epe,{merchandiseUrl:R.data.merchandiseUrl,artistName:(E==null?void 0:E.name)||(e==null?void 0:e.name)||"Artist"})}),(E==null?void 0:E.bio)&&c.jsxs("section",{className:"artist-section-about",children:[c.jsx("h2",{className:"section-title-spotify",children:"About"}),c.jsxs("div",{className:"artist-about-card",children:[(M==null?void 0:M.image)&&c.jsx("div",{className:"artist-about-image",children:c.jsx("img",{src:M.image,alt:M.name})}),c.jsxs("div",{className:"artist-about-content",children:[c.jsx("p",{className:"artist-bio-text",children:E.bio}),E.externalUrls&&Object.keys(E.externalUrls).length>0&&c.jsxs("div",{className:"artist-external-links",children:[E.externalUrls.spotify&&c.jsx("a",{href:E.externalUrls.spotify,target:"_blank",rel:"noopener noreferrer",className:"artist-external-link",children:"Spotify"}),E.externalUrls.instagram&&c.jsx("a",{href:E.externalUrls.instagram,target:"_blank",rel:"noopener noreferrer",className:"artist-external-link",children:"Instagram"}),E.externalUrls.twitter&&c.jsx("a",{href:E.externalUrls.twitter,target:"_blank",rel:"noopener noreferrer",className:"artist-external-link",children:"Twitter"}),E.externalUrls.website&&c.jsx("a",{href:E.externalUrls.website,target:"_blank",rel:"noopener noreferrer",className:"artist-external-link",children:"Website"})]})]})]})]})]}),c.jsx(bM,{video:C,onClose:()=>S(null)})]})},Mpe=An((n,e)=>({albumCache:new Map,loadingAlbumId:null,error:null,fetchAlbum:async(t,s)=>{var i,o,a,l,u,d,f,p,g,x,y,b,k;const r=e().albumCache.get(t);if(r&&r.tracks.length>0)return r;n({loadingAlbumId:t,error:null});try{if(!window.api)throw new Error("API not available");if(window.api.getAlbum)try{const P=await window.api.getAlbum(t,s.source);if(P){const R=(P.tracks||[]).map(q=>({...q,streamSources:[],_meta:{metadataProvider:s.source||"addon",matchConfidence:1,externalIds:{},lastUpdated:new Date}})),L=(P.moreByArtist||[]).map(q=>{var Q,z,K,Y;return{id:q.id,title:q.title,artist:((z=(Q=q.artists)==null?void 0:Q[0])==null?void 0:z.name)||s.artist,artwork:((K=q.artwork)==null?void 0:K.medium)||((Y=q.artwork)==null?void 0:Y.small),year:q.releaseDate?parseInt(q.releaseDate.substring(0,4)):void 0,trackCount:q.trackCount,source:s.source}}),_=R.reduce((q,Q)=>q+(Q.duration||0),0);let O=[];if((i=window.api)!=null&&i.getSimilarAlbums)try{O=(await window.api.getSimilarAlbums(t,s.source)||[]).filter(Q=>Q.id!==t).slice(0,8).map(Q=>{var z,K,Y,B;return{id:Q.id,title:Q.title,artist:((K=(z=Q.artists)==null?void 0:z[0])==null?void 0:K.name)||"",artwork:((Y=Q.artwork)==null?void 0:Y.medium)||((B=Q.artwork)==null?void 0:B.small),year:Q.releaseDate?parseInt(Q.releaseDate.substring(0,4)):void 0,trackCount:Q.trackCount,source:s.source}})}catch(q){console.warn("Failed to fetch similar albums:",q)}let U;const W=(o=P.artists)==null?void 0:o[0];if(W!=null&&W.id&&((a=window.api)!=null&&a.getArtist))try{const q=await window.api.getArtist(W.id,s.source);q&&(U={id:q.id,name:q.name,image:((l=q.artwork)==null?void 0:l.large)||((u=q.artwork)==null?void 0:u.medium),followers:q.followers,verified:q.verified,genres:q.genres,bio:q.bio})}catch(q){console.warn("Failed to fetch artist info:",q)}const H={id:t,title:P.title||s.title,artist:((f=(d=P.artists)==null?void 0:d[0])==null?void 0:f.name)||s.artist,artistId:(g=(p=P.artists)==null?void 0:p[0])==null?void 0:g.id,artwork:((x=P.artwork)==null?void 0:x.large)||((y=P.artwork)==null?void 0:y.medium)||s.artwork,year:P.releaseDate?parseInt(P.releaseDate.substring(0,4)):s.year,releaseDate:P.releaseDate,trackCount:R.length||P.trackCount||s.trackCount,albumType:P.albumType,label:P.label,copyright:P.copyright,credits:P.credits,explicit:P.explicit,genres:P.genres,totalDuration:P.totalDuration||_,description:P.description,source:s.source,tracks:R,moreByArtist:L,similarAlbums:O,artistInfo:U},G=new Map(e().albumCache);return G.set(t,H),n({albumCache:G,loadingAlbumId:null}),H}}catch(P){console.warn("getAlbum API failed, falling back to search:",P)}const w=`${s.title} ${s.artist}`,N=await window.api.search({query:w,type:"track"}),C=(N||[]).filter(P=>P.album?P.album.id===t||P.album.title.toLowerCase()===s.title.toLowerCase():!1);C.sort((P,R)=>{const L=P.trackNumber||999,_=R.trackNumber||999;return L-_});const T=(await window.api.search({query:s.artist,type:"album"}).catch(()=>[])||[]).filter(P=>{var L,_;if(P.id===t)return!1;const R=(_=(L=P.artists)==null?void 0:L[0])==null?void 0:_.name;return R&&R.toLowerCase()===s.artist.toLowerCase()}).slice(0,8).map(P=>{var R,L,_;return{id:P.id,title:P.title,artist:((L=(R=P.artists)==null?void 0:R[0])==null?void 0:L.name)||s.artist,artwork:(_=P.artwork)==null?void 0:_.medium,year:P.releaseDate?parseInt(P.releaseDate.substring(0,4)):void 0,trackCount:P.trackCount,source:"addon"}});if(T.length<4){const P=new Map;for(const L of N||[])L.album&&L.album.id!==t&&L.artists.some(O=>O.name.toLowerCase()===s.artist.toLowerCase())&&!P.has(L.album.id)&&P.set(L.album.id,{id:L.album.id,title:L.album.title,artist:s.artist,artwork:(b=L.album.artwork)==null?void 0:b.medium,year:L.album.releaseDate?parseInt(L.album.releaseDate.substring(0,4)):void 0,trackCount:L.album.trackCount,source:((k=L._meta)==null?void 0:k.metadataProvider)||"unknown"});const R=new Set(T.map(L=>L.id));for(const L of P.values())!R.has(L.id)&&T.length<8&&T.push(L)}const A=C.reduce((P,R)=>P+(R.duration||0),0),E={id:t,title:s.title,artist:s.artist,artwork:s.artwork,year:s.year,releaseDate:void 0,trackCount:C.length||s.trackCount,albumType:void 0,label:void 0,copyright:void 0,credits:void 0,explicit:void 0,genres:void 0,totalDuration:A,description:void 0,source:s.source,tracks:C,moreByArtist:T,similarAlbums:[],artistInfo:void 0},M=new Map(e().albumCache);return M.set(t,E),n({albumCache:M,loadingAlbumId:null}),E}catch(w){return n({error:w instanceof Error?w.message:"Failed to fetch album",loadingAlbumId:null}),null}},getAlbum:t=>e().albumCache.get(t)||null,clearCache:()=>{n({albumCache:new Map})}})),Lpe=({credits:n,albumTitle:e,onClose:t})=>{const s=i=>{i.target===i.currentTarget&&t()};gt.useEffect(()=>{const i=o=>{o.key==="Escape"&&t()};return document.addEventListener("keydown",i),()=>document.removeEventListener("keydown",i)},[t]);const r=[];return n.producers&&n.producers.length>0&&r.push({role:"Producers",names:n.producers}),n.writers&&n.writers.length>0&&r.push({role:"Writers",names:n.writers}),n.engineers&&n.engineers.length>0&&r.push({role:"Engineers",names:n.engineers}),n.label&&r.push({role:"Label",names:[n.label]}),n.copyright&&r.push({role:"Copyright",names:[n.copyright]}),c.jsx("div",{className:"modal-overlay",onClick:s,children:c.jsxs("div",{className:"modal credits-modal",children:[c.jsxs("div",{className:"modal-header",children:[c.jsx("h2",{children:"Credits"}),c.jsx("p",{className:"modal-subtitle",children:e}),c.jsx("button",{className:"modal-close",onClick:t,"aria-label":"Close",children:c.jsx(an,{size:20})})]}),c.jsxs("div",{className:"modal-content",children:[r.map(({role:i,names:o})=>c.jsxs("div",{className:"credit-group",children:[c.jsx("h3",{className:"credit-role",children:i}),c.jsx("ul",{className:"credit-names",children:o.map((a,l)=>c.jsx("li",{className:"credit-name",children:a},`${i}-${l}`))})]},i)),r.length===0&&c.jsx("p",{className:"credits-empty",children:"No credits available"})]}),c.jsx("div",{className:"modal-footer",children:c.jsx("button",{className:"modal-button secondary",onClick:t,children:"Close"})})]})})},VI={videos:[]},UI={videos:!1},GI={videos:null};function Fpe(n,e,t={}){const{enabled:s=!0,trackNames:r,limit:i=8}=t,[o,a]=j.useState(VI),[l,u]=j.useState(UI),[d,f]=j.useState(GI),p=j.useRef(!0),g=j.useRef(0),x=j.useRef(r),y=j.useRef(i);x.current=r,y.current=i;const b=j.useMemo(()=>n&&e?`${n}-${e}`:null,[n,e]),k=j.useRef(null),w=j.useCallback(async()=>{var C,S;if(!n||!e||!((S=(C=window.api)==null?void 0:C.enrichment)!=null&&S.getAlbumVideos)||k.current===b)return;const N=++g.current;k.current=b,u(T=>({...T,videos:!0})),f(T=>({...T,videos:null}));try{const T=await window.api.enrichment.getAlbumVideos(n,e,x.current,y.current);if(N!==g.current||!p.current)return;T.success&&T.data?a(A=>({...A,videos:T.data})):T.error&&f(A=>({...A,videos:T.error||null}))}catch(T){N===g.current&&p.current&&f(A=>({...A,videos:T instanceof Error?T.message:"Failed to fetch videos"}))}finally{N===g.current&&p.current&&u(T=>({...T,videos:!1}))}},[n,e,b]);return j.useEffect(()=>(p.current=!0,s&&n&&e&&(k.current!==b&&(a(VI),u(UI),f(GI)),w()),()=>{p.current=!1}),[s,n,e,b,w]),{data:o,loading:l,errors:d}}function Ope(n){return!!(n.producers&&n.producers.length>0||n.writers&&n.writers.length>0||n.engineers&&n.engineers.length>0||n.label||n.copyright)}const _pe=()=>{var z,K,Y;const{selectedAlbumId:n,selectedAlbumData:e,goBack:t,openArtist:s,openAlbum:r}=Wt(),{play:i,setQueue:o,currentTrack:a}=Ke(),{fetchAlbum:l,getAlbum:u,loadingAlbumId:d,error:f}=Mpe(),{showContextMenu:p}=pt(),{showContextMenu:g}=Fh(),[x,y]=j.useState(Da()),[b,k]=j.useState(!1),[w,N]=j.useState(null),C=u(n||""),S=C||e,T=d===n,A=j.useMemo(()=>{var B;return((B=C==null?void 0:C.tracks)==null?void 0:B.map(J=>J.title))||[]},[C==null?void 0:C.tracks]),E=Fpe(S==null?void 0:S.title,S==null?void 0:S.artist,{enabled:!T&&!!(S!=null&&S.title&&(S!=null&&S.artist)),trackNames:A,limit:8}),M=B=>{N(B)};if(j.useEffect(()=>{S!=null&&S.artwork&&yM(S.artwork).then(y)},[S==null?void 0:S.artwork]),j.useEffect(()=>{n&&e&&l(n,e)},[n,e==null?void 0:e.title]),!n)return c.jsx("div",{className:"album-detail-view",children:c.jsxs("div",{className:"album-not-found",children:[c.jsx("p",{children:"Album not found"}),c.jsx("button",{onClick:t,children:"Go Back"})]})});const P=()=>{if(C!=null&&C.tracks&&C.tracks.length>0){const B=C.tracks[0];o(C.tracks,0),B&&i(B)}},R=()=>{if(C!=null&&C.tracks&&C.tracks.length>0){const B=[...C.tracks].sort(()=>Math.random()-.5),J=B[0];o(B,0),J&&i(J)}},L=(B,J)=>{C!=null&&C.tracks&&(o(C.tracks,J),i(B))},_=()=>{S!=null&&S.artist&&s(`artist-${S.artist}`,{id:`artist-${S.artist}`,name:S.artist,image:S.artwork,source:S.source||"unknown"})},O=B=>{r(B.id,B)},U=B=>{if(!B)return"--:--";const J=Math.floor(B/60),ae=Math.floor(B%60);return`${J}:${ae.toString().padStart(2,"0")}`},W=B=>{if(!B)return"";try{return new Date(B).getFullYear().toString()}catch{return B.substring(0,4)}},H=B=>{if(!B)return"";try{return new Date(B).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}catch{return B.substring(0,4)}},G=B=>{switch(B){case"album":return"ALBUM";case"single":return"SINGLE";case"ep":return"EP";case"compilation":return"COMPILATION";default:return"ALBUM"}},q=C!=null&&C.releaseDate?W(C.releaseDate):S==null?void 0:S.year,Q=(C==null?void 0:C.trackCount)||((z=C==null?void 0:C.tracks)==null?void 0:z.length);return c.jsxs("div",{className:"album-detail-view album-detail-centered",style:{"--ambient-color":x.dominant},children:[(S==null?void 0:S.artwork)&&c.jsx("div",{className:"album-ambient-bg-centered",style:{backgroundImage:`url(${S.artwork})`}}),c.jsx("button",{className:"back-btn-round album-back-btn",onClick:t,"aria-label":"Go back",children:c.jsx(Cc,{size:20})}),c.jsxs("div",{className:"album-hero-centered",children:[c.jsxs("div",{className:"album-artwork-centered",children:[S!=null&&S.artwork?c.jsx("img",{className:"album-artwork-img-centered",src:S.artwork,alt:S.title}):c.jsx("div",{className:"album-artwork-placeholder-centered",children:c.jsx(qe,{size:80})}),c.jsx("div",{className:"album-artwork-glow",style:{background:`radial-gradient(ellipse at center, ${x.dominant}40 0%, transparent 70%)`}})]}),c.jsxs("div",{className:"album-info-centered",children:[c.jsx("span",{className:"album-type-badge-centered",children:G(C==null?void 0:C.albumType)}),c.jsx("h1",{className:"album-title-centered",children:(S==null?void 0:S.title)||"Unknown Album"}),c.jsxs("div",{className:"album-meta-centered",children:[c.jsx("span",{className:"album-artist-link-centered",onClick:_,children:(S==null?void 0:S.artist)||"Unknown Artist"}),q&&c.jsxs(c.Fragment,{children:[c.jsx("span",{className:"album-meta-dot",children:""}),c.jsx("span",{children:q})]}),Q&&c.jsxs(c.Fragment,{children:[c.jsx("span",{className:"album-meta-dot",children:""}),c.jsxs("span",{children:[Q," ",Q===1?"song":"songs"]})]})]}),c.jsxs("div",{className:"album-actions-centered",children:[c.jsxs("button",{className:"album-play-btn-pill",onClick:P,disabled:!((K=C==null?void 0:C.tracks)!=null&&K.length),children:[c.jsx(Et,{size:20}),c.jsx("span",{children:"Play"})]}),c.jsxs("button",{className:"album-shuffle-btn-pill",onClick:R,disabled:!((Y=C==null?void 0:C.tracks)!=null&&Y.length),children:[c.jsx(oo,{size:18}),c.jsx("span",{children:"Shuffle"})]}),c.jsx("button",{className:"album-more-btn-pill",onClick:B=>S&&g(B,S),children:c.jsx(K4,{size:20})})]})]})]}),c.jsxs("section",{className:"album-tracks-clean",children:[c.jsxs("div",{className:"album-tracks-header-clean",children:[c.jsx("span",{className:"track-col-num",children:"#"}),c.jsx("span",{className:"track-col-title",children:"Title"}),c.jsx("span",{className:"track-col-dur",children:"Duration"})]}),T?c.jsxs("div",{className:"album-loading",children:[c.jsx("div",{className:"album-loading-spinner"}),c.jsx("span",{children:"Loading tracks..."})]}):f?c.jsx("div",{className:"album-section-placeholder",children:f}):C!=null&&C.tracks&&C.tracks.length>0?c.jsx("div",{className:"album-tracks-list-clean",children:C.tracks.map((B,J)=>{const ae=(a==null?void 0:a.id)===B.id;return c.jsxs("div",{className:`album-track-row-clean ${ae?"playing":""}`,onClick:()=>L(B,J),onContextMenu:pe=>p(pe,B),children:[ae&&c.jsx("div",{className:"track-playing-bar"}),c.jsx("span",{className:"album-track-num-clean",children:ae?c.jsxs("span",{className:"track-playing-indicator",children:[c.jsx("span",{className:"bar"}),c.jsx("span",{className:"bar"}),c.jsx("span",{className:"bar"})]}):B.trackNumber||J+1}),c.jsxs("div",{className:"album-track-info-clean",children:[c.jsx("span",{className:"album-track-title-clean",children:B.title}),(B.artists.length>1||B.explicit)&&c.jsxs("div",{className:"album-track-subtitle-clean",children:[B.explicit&&c.jsx("span",{className:"explicit-badge-small",children:"E"}),B.artists.length>1&&c.jsx("span",{className:"album-track-artists-clean",children:B.artists.map(pe=>pe.name).join(", ")})]})]}),c.jsx("span",{className:"album-track-dur-clean",children:U(B.duration)})]},B.id)})}):c.jsx("div",{className:"album-section-placeholder",children:"No tracks found for this album"})]}),(E.loading.videos||E.data.videos.length>0)&&c.jsx(Ia,{title:"Music Videos",sectionId:`album-videos-${n}`,className:"album-section-videos",loading:E.loading.videos,children:c.jsx(vM,{videos:E.data.videos,onVideoClick:M})}),(C==null?void 0:C.artistInfo)&&c.jsxs("section",{className:"album-artist-section",children:[c.jsx("h2",{className:"album-section-title",children:"About the Artist"}),c.jsxs("div",{className:"album-artist-card",onClick:()=>s(C.artistInfo.id,{id:C.artistInfo.id,name:C.artistInfo.name,image:C.artistInfo.image,source:(S==null?void 0:S.source)||"addon"}),children:[c.jsx("div",{className:"album-artist-card-image",children:C.artistInfo.image?c.jsx("img",{src:C.artistInfo.image,alt:C.artistInfo.name}):c.jsx("div",{className:"album-artist-card-placeholder",children:c.jsx(qe,{size:48})})}),c.jsxs("div",{className:"album-artist-card-info",children:[c.jsx("h3",{className:"album-artist-card-name",children:C.artistInfo.name}),C.artistInfo.followers&&c.jsxs("span",{className:"album-artist-card-followers",children:[C.artistInfo.followers.toLocaleString()," followers"]}),C.artistInfo.genres&&C.artistInfo.genres.length>0&&c.jsx("span",{className:"album-artist-card-genres",children:C.artistInfo.genres.slice(0,3).join("  ")}),C.artistInfo.bio&&c.jsx("p",{className:"album-artist-card-bio",children:C.artistInfo.bio.length>200?`${C.artistInfo.bio.substring(0,200)}...`:C.artistInfo.bio}),c.jsx("button",{className:"album-artist-card-btn",children:"View Artist"})]})]})]}),(C==null?void 0:C.moreByArtist)&&C.moreByArtist.length>0&&c.jsxs("section",{className:"album-more-section-clean",children:[c.jsxs("h2",{className:"album-more-title",children:["More by ",(S==null?void 0:S.artist)||"Artist"]}),c.jsx("div",{className:"album-more-scroll-clean",children:C.moreByArtist.map(B=>c.jsxs("div",{className:"album-card-clean",onClick:()=>O(B),onContextMenu:J=>g(J,B),children:[c.jsxs("div",{className:"album-card-image-clean",children:[B.artwork?c.jsx("img",{src:B.artwork,alt:B.title,loading:"lazy"}):c.jsx("div",{className:"album-card-placeholder-clean",children:c.jsx(qe,{size:32})}),c.jsx("div",{className:"album-card-play-clean",children:c.jsx(Et,{size:24})})]}),c.jsxs("div",{className:"album-card-info-clean",children:[c.jsx("span",{className:"album-card-title-clean",children:B.title}),B.year&&c.jsx("span",{className:"album-card-year-clean",children:B.year})]})]},B.id))})]}),(C==null?void 0:C.similarAlbums)&&C.similarAlbums.length>0&&c.jsxs("section",{className:"album-more-section-clean album-similar-section",children:[c.jsx("h2",{className:"album-more-title",children:"You Might Also Like"}),c.jsx("div",{className:"album-more-scroll-clean",children:C.similarAlbums.map(B=>c.jsxs("div",{className:"album-card-clean",onClick:()=>O(B),onContextMenu:J=>g(J,B),children:[c.jsxs("div",{className:"album-card-image-clean",children:[B.artwork?c.jsx("img",{src:B.artwork,alt:B.title,loading:"lazy"}):c.jsx("div",{className:"album-card-placeholder-clean",children:c.jsx(qe,{size:32})}),c.jsx("div",{className:"album-card-play-clean",children:c.jsx(Et,{size:24})})]}),c.jsxs("div",{className:"album-card-info-clean",children:[c.jsx("span",{className:"album-card-title-clean",children:B.title}),c.jsx("span",{className:"album-card-artist-clean",children:B.artist})]})]},B.id))})]}),c.jsxs("footer",{className:"album-footer-clean",children:[c.jsx("div",{className:"album-footer-divider"}),c.jsxs("div",{className:"album-footer-content",children:[(C==null?void 0:C.releaseDate)&&c.jsx("p",{className:"album-footer-text",children:H(C.releaseDate)}),(C==null?void 0:C.label)&&c.jsx("p",{className:"album-footer-text",children:C.label}),(C==null?void 0:C.copyright)&&c.jsx("p",{className:"album-footer-text album-footer-copyright",children:C.copyright}),(C==null?void 0:C.credits)&&Ope(C.credits)&&c.jsx("button",{className:"album-credits-link",onClick:()=>k(!0),children:"Show Credits"})]})]}),b&&(C==null?void 0:C.credits)&&c.jsx(Lpe,{credits:C.credits,albumTitle:(S==null?void 0:S.title)||"",onClose:()=>k(!1)}),c.jsx(bM,{video:w,onClose:()=>N(null)})]})};function HI(n){return(n.strategy==="embedding"||n.strategy==="hybrid")&&n.embedding!==void 0}const zpe=({overrideQuery:n})=>{const{selectedSectionData:e,goBack:t}=Wt(),{search:s,results:r,isSearching:i}=la(),{play:o,setQueue:a}=Ke(),l=dn(B=>B.userProfile),{showContextMenu:u}=pt(),{generateMoodPlaylist:d,generateGenrePlaylist:f,generateArtistRadio:p,generateSeedPlaylist:g,generateDiscoveryPlaylist:x,generatePersonalizedPlaylist:y,findSimilarTracks:b,getTracksFromPlaylist:k,isReady:w,tracksIndexed:N}=YP(),[C,S]=j.useState([]),[T,A]=j.useState(!0),[E,M]=j.useState(0),[P,R]=j.useState(null),[L,_]=j.useState(null),O=n??(e==null?void 0:e.structuredQuery),U=j.useCallback((B,J)=>{var ge,he;const ae={limit:J,exploration:B.exploration,includeCollaborative:B.includeCollaborative,excludeTrackIds:B.excludeTrackIds,excludeArtistIds:B.excludeArtistIds};let pe=null;switch(B.method){case"mood":B.mood&&(pe=d(B.mood,ae));break;case"genre":B.genre&&(pe=f(B.genre,ae));break;case"artist-radio":B.seedArtistId&&(pe=p(B.seedArtistId,ae));break;case"seed":(ge=B.seedTrackIds)!=null&&ge.length&&(pe=g(B.seedTrackIds,ae));break;case"discovery":pe=x({...ae,exploration:B.exploration??.7});break;case"personalized":pe=y(ae);break;case"similar":if((he=B.seedTrackIds)!=null&&he[0]){const we=b(B.seedTrackIds[0],J);return k({tracks:we,method:"seed-tracks",queryVector:new Float32Array(128),stats:{candidatesConsidered:J,embeddingSearchTime:0,collaborativeBoost:0,avgSimilarity:0}})}break}return pe?k(pe):[]},[d,f,p,g,x,y,b,k]),W=j.useCallback(async(B,J)=>{const ae=Oa.getStats();if(ae.transformers===0&&ae.providers===0&&ae.enhancers===0)return B;const pe=new Date().getHours(),ge=new Date().getDay();try{const he=await Oa.executePipeline(B,J,{userProfile:l,hour:pe,dayOfWeek:ge});return _({appliedTransformers:he.appliedTransformers,contributingProviders:he.contributingProviders,appliedEnhancers:he.appliedEnhancers,executionTime:he.executionTime}),console.log(`[EmbeddingSectionDetailView] Pipeline executed in ${he.executionTime.toFixed(1)}ms:`,`${he.appliedEnhancers.length} enhancers,`,`${he.contributingProviders.length} providers,`,`${he.appliedTransformers.length} transformers`),he.tracks}catch(he){return console.error("[EmbeddingSectionDetailView] Pipeline error:",he),B}},[l]),H=j.useCallback(async B=>{var ae,pe;const J=B.limit??50;A(!0),R(null),_(null);try{let ge=[];switch(B.strategy){case"embedding":if(B.embedding){if(!w){R("ML system not ready");return}if(N<1){R("No tracks indexed for ML recommendations");return}ge=U(B.embedding,J)}break;case"search":if((ae=B.search)!=null&&ae.query){await s(B.search.query);return}break;case"hybrid":if(B.embedding&&w&&N>0&&(ge=U(B.embedding,J)),ge.length===0&&((pe=B.search)!=null&&pe.query)){await s(B.search.query);return}break;case"plugin":ge=[];break}const he=await W(ge,B);S(he),M(he.length)}catch(ge){console.error("[EmbeddingSectionDetailView] Error generating results:",ge),R(ge instanceof Error?ge.message:"Failed to load results")}finally{A(!1)}},[w,N,U,s,W]);j.useEffect(()=>{O&&H(O)},[O,H]),j.useEffect(()=>{(async()=>{if(O&&(O.strategy==="search"||O.strategy==="hybrid"&&C.length===0)&&r!=null&&r.tracks){const J=await W(r.tracks,O);S(J),M(J.length),A(!1)}})()},[r==null?void 0:r.tracks,O,C.length,W]);const G=j.useCallback((B,J)=>{a(C,J),o(B)},[C,a,o]),q=j.useCallback(async()=>{if(!O||!HI(O))return;const J=(O.limit??50)+50,ae=U(O.embedding,J),pe=await W(ae,{...O,limit:J});S(pe),M(pe.length)},[O,U,W]),Q=T||(O==null?void 0:O.strategy)==="search"&&i,z=(O==null?void 0:O.title)??(e==null?void 0:e.title)??"Results",K=(O==null?void 0:O.subtitle)??(e==null?void 0:e.subtitle),Y=j.useMemo(()=>{var B;if(!O)return null;switch(O.strategy){case"embedding":return(B=O.embedding)!=null&&B.method?`ML: ${O.embedding.method}`:"ML-enhanced";case"hybrid":return"Smart results";case"search":return"Search results";case"plugin":return"Plugin results";default:return null}},[O]);return!e&&!n?c.jsx("div",{className:"section-detail-view",children:c.jsxs("div",{className:"section-detail-empty",children:[c.jsx("p",{children:"Section not found"}),c.jsx("button",{onClick:t,children:"Go back"})]})}):c.jsxs("div",{className:"section-detail-view",children:[c.jsxs("header",{className:"section-detail-header",children:[c.jsx("button",{className:"back-btn-round",onClick:t,"aria-label":"Go back",children:c.jsx(Cc,{size:20})}),c.jsxs("div",{className:"section-detail-title-area",children:[c.jsx("h1",{className:"section-detail-title",children:z}),K&&c.jsx("p",{className:"section-detail-subtitle",children:K}),Y&&c.jsx("span",{className:"section-detail-strategy-badge",children:Y})]})]}),c.jsx("div",{className:"section-detail-content",children:P?c.jsxs("div",{className:"section-detail-empty",children:[c.jsx("p",{children:P}),c.jsx("button",{onClick:t,children:"Go back"})]}):Q?c.jsx("div",{className:"section-detail-grid",children:Array.from({length:20}).map((B,J)=>c.jsx("div",{className:"discover-card-skeleton"},J))}):C.length>0?c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"section-detail-grid",children:C.map((B,J)=>c.jsx(ln,{track:B,onClick:()=>G(B,J),onContextMenu:u},B.id))}),HI(O)&&E>=((O==null?void 0:O.limit)??50)&&c.jsx("div",{className:"section-detail-load-more",children:c.jsx("button",{className:"section-detail-load-more-btn",onClick:q,children:"Load More"})})]}):c.jsxs("div",{className:"section-detail-empty",children:[c.jsx("p",{children:"No tracks found"}),(O==null?void 0:O.strategy)==="embedding"&&N<1&&c.jsx("p",{className:"section-detail-empty-hint",children:"Play some music to enable ML recommendations"})]})})]})},Bpe=()=>{const{selectedSectionData:n,goBack:e,openArtist:t}=Wt(),{showContextMenu:s}=mx(),[r,i]=j.useState([]),[o,a]=j.useState(!0);j.useEffect(()=>{let u=!0;return(async()=>{var f,p,g,x,y,b,k;a(!0);try{if((f=window.api)!=null&&f.getTrending){const w=await window.api.getTrending();if(u&&((p=w==null?void 0:w.artists)==null?void 0:p.length)>0){const N=w.artists.map(C=>{var S,T,A;return{id:C.id,name:C.name,image:((S=C.artwork)==null?void 0:S.medium)||((T=C.artwork)==null?void 0:T.small)||((A=C.artwork)==null?void 0:A.large),source:"trending"}});i(N),a(!1);return}}if((g=window.api)!=null&&g.search){const w=await window.api.search({query:"top hits 2024 popular",type:"track"});if(u&&(w==null?void 0:w.length)>0){const N=new Map;for(const C of w)for(const S of C.artists)N.has(S.id)||N.set(S.id,{id:S.id,name:S.name,image:((x=S.artwork)==null?void 0:x.medium)||((y=S.artwork)==null?void 0:y.small)||((b=S.artwork)==null?void 0:b.large),source:((k=C._meta)==null?void 0:k.metadataProvider)||"search"});i(Array.from(N.values()))}}}catch(w){Lh("[ArtistSectionDetailView]","Failed to fetch artists:",w)}finally{u&&a(!1)}})(),()=>{u=!1}},[]);const l=u=>{t(u.id,{id:u.id,name:u.name,image:u.image,source:u.source})};return n?c.jsxs("div",{className:"section-detail-view",children:[c.jsxs("header",{className:"section-detail-header",children:[c.jsx("button",{className:"back-btn-round",onClick:e,"aria-label":"Go back",children:c.jsx(Cc,{size:20})}),c.jsxs("div",{className:"section-detail-title-area",children:[c.jsx("h1",{className:"section-detail-title",children:n.title}),n.subtitle&&c.jsx("p",{className:"section-detail-subtitle",children:n.subtitle})]})]}),c.jsx("div",{className:"section-detail-content",children:o?c.jsx("div",{className:"artist-detail-grid",children:Array.from({length:20}).map((u,d)=>c.jsx("div",{className:"artist-card-skeleton circular"},d))}):r.length>0?c.jsx("div",{className:"artist-detail-grid",children:r.map(u=>c.jsxs("div",{className:"artist-card circular",onClick:()=>l(u),onContextMenu:d=>s(d,{id:u.id,name:u.name,image:u.image,source:u.source}),children:[c.jsx("div",{className:"artist-card-image",children:u.image?c.jsx("img",{src:u.image,alt:u.name}):c.jsx("div",{className:"artist-card-placeholder",children:c.jsx(qe,{size:32})})}),c.jsx("div",{className:"artist-card-name",children:u.name}),c.jsx("div",{className:"artist-card-type",children:"Artist"})]},u.id))}):c.jsx("div",{className:"section-detail-empty",children:c.jsx("p",{children:"No artists found"})})})]}):c.jsx("div",{className:"section-detail-view",children:c.jsxs("div",{className:"section-detail-empty",children:[c.jsx("p",{children:"Section not found"}),c.jsx("button",{onClick:e,children:"Go back"})]})})},Wpe=["trending-artists","similar-artists"],Vpe=()=>{const{selectedSectionData:n}=Wt();return n!=null&&n.type&&Wpe.includes(n.type)?c.jsx(Bpe,{}):n!=null&&n.structuredQuery?c.jsx(zpe,{}):c.jsx(Upe,{})},Upe=()=>{const{selectedSectionData:n,goBack:e}=Wt(),{search:t,results:s,isSearching:r}=la(),{play:i,setQueue:o}=Ke(),{showContextMenu:a}=pt(),[l,u]=j.useState([]);j.useEffect(()=>{n!=null&&n.query&&t(n.query)},[n==null?void 0:n.query,t]),j.useEffect(()=>{s!=null&&s.tracks&&u(s.tracks)},[s==null?void 0:s.tracks]);const d=(f,p)=>{o(l,p),i(f)};return n?c.jsxs("div",{className:"section-detail-view",children:[c.jsxs("header",{className:"section-detail-header",children:[c.jsx("button",{className:"back-btn-round",onClick:e,"aria-label":"Go back",children:c.jsx(Cc,{size:20})}),c.jsxs("div",{className:"section-detail-title-area",children:[c.jsx("h1",{className:"section-detail-title",children:n.title}),n.subtitle&&c.jsx("p",{className:"section-detail-subtitle",children:n.subtitle})]})]}),c.jsx("div",{className:"section-detail-content",children:r?c.jsx("div",{className:"section-detail-grid",children:Array.from({length:20}).map((f,p)=>c.jsx("div",{className:"discover-card-skeleton"},p))}):l.length>0?c.jsx("div",{className:"section-detail-grid",children:l.map((f,p)=>c.jsx(ln,{track:f,onClick:()=>d(f,p),onContextMenu:a},f.id))}):c.jsx("div",{className:"section-detail-empty",children:c.jsx("p",{children:"No tracks found"})})})]}):c.jsx("div",{className:"section-detail-view",children:c.jsxs("div",{className:"section-detail-empty",children:[c.jsx("p",{children:"Section not found"}),c.jsx("button",{onClick:e,children:"Go back"})]})})},gp=({label:n,value:e,icon:t,subtitle:s,trend:r})=>c.jsxs("div",{className:"stat-card",children:[c.jsx("div",{className:"stat-card-icon",children:t}),c.jsxs("div",{className:"stat-card-content",children:[c.jsx("div",{className:"stat-card-value",children:e}),c.jsx("div",{className:"stat-card-label",children:n}),s&&c.jsx("div",{className:"stat-card-subtitle",children:s}),r&&c.jsxs("div",{className:`stat-card-trend ${r.value>=0?"positive":"negative"}`,children:[c.jsx("span",{className:"trend-arrow",children:r.value>=0?"+":""}),c.jsxs("span",{className:"trend-value",children:[r.value,"%"]}),c.jsx("span",{className:"trend-label",children:r.label})]})]})]}),Gpe=({artists:n,onArtistClick:e})=>{var s;if(n.length===0)return c.jsx("div",{className:"top-list-empty",children:c.jsx("p",{children:"No listening data yet"})});const t=((s=n[0])==null?void 0:s.playCount)||1;return c.jsx("div",{className:"top-list",children:n.map((r,i)=>c.jsxs("div",{className:"top-list-item",onClick:()=>e==null?void 0:e(r.artistId),children:[c.jsx("span",{className:"top-list-rank",children:i+1}),c.jsx("div",{className:"top-list-artwork",children:r.artwork?c.jsx("img",{src:r.artwork,alt:r.artistName}):c.jsx("div",{className:"top-list-artwork-placeholder",children:c.jsx(qe,{size:20})})}),c.jsxs("div",{className:"top-list-info",children:[c.jsx("span",{className:"top-list-name",children:r.artistName}),c.jsxs("span",{className:"top-list-meta",children:[r.playCount," plays  ",l$(r.totalDuration)]})]}),c.jsx("div",{className:"top-list-bar-container",children:c.jsx("div",{className:"top-list-bar",style:{width:`${r.playCount/t*100}%`}})})]},r.artistId))})},Hpe=({genres:n})=>{var t;if(n.length===0)return c.jsx("div",{className:"top-list-empty",children:c.jsx("p",{children:"No listening data yet"})});const e=((t=n[0])==null?void 0:t.playCount)||1;return c.jsx("div",{className:"top-list genres",children:n.map((s,r)=>c.jsxs("div",{className:"top-list-item genre-item",children:[c.jsx("span",{className:"top-list-rank",children:r+1}),c.jsxs("div",{className:"top-list-info",children:[c.jsx("span",{className:"top-list-name",children:s.genre}),c.jsxs("span",{className:"top-list-meta",children:[s.playCount," plays"]})]}),c.jsx("div",{className:"top-list-bar-container",children:c.jsx("div",{className:"top-list-bar",style:{width:`${s.playCount/e*100}%`}})})]},s.genre))})},qpe=({data:n,maxBars:e=10,height:t=120,showLabels:s=!0,showValues:r=!0,formatValue:i=o=>o.toString()})=>{const o=n.slice(0,e),a=Math.max(...o.map(l=>l.value),1);return c.jsx("div",{className:"bar-chart",style:{height:t},children:c.jsx("div",{className:"bar-chart-bars",children:o.map((l,u)=>c.jsxs("div",{className:"bar-chart-bar-container",children:[c.jsx("div",{className:"bar-chart-bar",style:{height:`${l.value/a*100}%`},children:r&&l.value>0&&c.jsx("span",{className:"bar-chart-value",children:i(l.value)})}),s&&c.jsx("span",{className:"bar-chart-label",children:l.label})]},u))})})},Kpe=["12a","1a","2a","3a","4a","5a","6a","7a","8a","9a","10a","11a","12p","1p","2p","3p","4p","5p","6p","7p","8p","9p","10p","11p"],Qpe=({data:n})=>{const e=Math.max(...n.map(t=>t.playCount),1);return c.jsxs("div",{className:"heatmap hourly-heatmap",children:[c.jsx("div",{className:"heatmap-grid",children:n.map((t,s)=>c.jsx("div",{className:"heatmap-cell",style:{opacity:.2+t.playCount/e*.8},title:`${Kpe[s]}: ${t.playCount} plays`,children:t.playCount>0&&c.jsx("span",{className:"heatmap-cell-value",children:t.playCount})},s))}),c.jsx("div",{className:"heatmap-labels",children:["12a","6a","12p","6p","12a"].map((t,s)=>c.jsx("span",{className:"heatmap-label",children:t},s))})]})},qI=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],Xpe=({data:n})=>{const e=Math.max(...n.map(t=>t.playCount),1);return c.jsx("div",{className:"heatmap day-heatmap",children:c.jsx("div",{className:"heatmap-grid",children:n.map((t,s)=>c.jsxs("div",{className:"heatmap-cell day-cell",style:{opacity:.2+t.playCount/e*.8},title:`${qI[s]}: ${t.playCount} plays`,children:[c.jsx("span",{className:"heatmap-cell-label",children:qI[s]}),c.jsx("span",{className:"heatmap-cell-value",children:t.playCount})]},s))})})},KI={week:"This Week",month:"This Month",year:"This Year",all:"All Time"},Ype=()=>{const[n,e]=j.useState("week"),{getStats:t}=a$(),{navigateTo:s}=Wt(),r=j.useMemo(()=>t(n),[n,t]),i=a=>{s("artist-detail",{artistId:a})},o=j.useMemo(()=>r.dailyStats.slice(-7).map(a=>({label:new Date(a.date).toLocaleDateString("en-US",{weekday:"short"}),value:a.playCount})),[r.dailyStats]);return c.jsxs("div",{className:"stats-view",children:[c.jsxs("header",{className:"stats-header",children:[c.jsx("button",{className:"stats-back-btn",onClick:()=>s("home"),children:c.jsx(gb,{size:20})}),c.jsxs("div",{className:"stats-header-content",children:[c.jsx("h1",{className:"stats-title",children:"Your Listening Stats"}),c.jsx("p",{className:"stats-subtitle",children:"Insights into your music habits"})]}),c.jsx("div",{className:"stats-period-selector",children:Object.keys(KI).map(a=>c.jsx("button",{className:`period-btn ${n===a?"active":""}`,onClick:()=>e(a),children:KI[a]},a))})]}),c.jsxs("div",{className:"stats-content",children:[c.jsxs("section",{className:"stats-section stats-summary",children:[c.jsx(gp,{icon:"clock",label:"Listen Time",value:l$(r.totalListenTime),subtitle:`${r.totalTracks} total plays`}),c.jsx(gp,{icon:"disc",label:"Unique Tracks",value:r.uniqueTracks}),c.jsx(gp,{icon:"mic",label:"Artists",value:r.uniqueArtists}),c.jsx(gp,{icon:"fire",label:"Current Streak",value:`${r.currentStreak} days`,subtitle:r.longestStreak>r.currentStreak?`Best: ${r.longestStreak} days`:"Your best streak!"})]}),c.jsxs("div",{className:"stats-columns",children:[c.jsxs("section",{className:"stats-section",children:[c.jsx("h2",{className:"stats-section-title",children:"Top Artists"}),c.jsx(Gpe,{artists:r.topArtists,onArtistClick:i})]}),c.jsxs("section",{className:"stats-section",children:[c.jsx("h2",{className:"stats-section-title",children:"Top Genres"}),c.jsx(Hpe,{genres:r.topGenres})]})]}),c.jsxs("section",{className:"stats-section",children:[c.jsx("h2",{className:"stats-section-title",children:"Daily Activity"}),c.jsx("div",{className:"stats-chart-container",children:o.length>0?c.jsx(qpe,{data:o,height:140,showLabels:!0,showValues:!0}):c.jsx("div",{className:"stats-empty",children:c.jsx("p",{children:"No activity data for this period"})})})]}),c.jsxs("section",{className:"stats-section",children:[c.jsx("h2",{className:"stats-section-title",children:"Listening Patterns"}),c.jsxs("div",{className:"stats-patterns",children:[c.jsxs("div",{className:"stats-pattern-group",children:[c.jsx("h3",{className:"stats-pattern-label",children:"By Hour of Day"}),c.jsx(Qpe,{data:r.hourlyDistribution})]}),c.jsxs("div",{className:"stats-pattern-group",children:[c.jsx("h3",{className:"stats-pattern-label",children:"By Day of Week"}),c.jsx(Xpe,{data:r.dayOfWeekDistribution})]})]})]})]})]})};function Zpe({availableTracks:n,enabled:e=!0}){const{queue:t,queueIndex:s,currentTrack:r}=Ke(),{mode:i,config:o,checkAndReplenish:a,recordTrackPlayed:l}=dl(),u=j.useRef(null);return j.useEffect(()=>{if(!e||i==="manual"&&!o.autoQueueEnabled||!r)return;r.id!==u.current&&(u.current=r.id,l(r)),t.length-s-1<=o.autoQueueThreshold&&a(n)},[s,r==null?void 0:r.id,i,o.autoQueueEnabled,e]),j.useEffect(()=>{if(!e)return;const d=()=>{(i!=="manual"||o.autoQueueEnabled)&&a(n)};return window.addEventListener("audiio:check-auto-queue",d),()=>window.removeEventListener("audiio:check-auto-queue",d)},[n,a,i,o.autoQueueEnabled,e]),{isActive:i!=="manual"||o.autoQueueEnabled,mode:i,config:o}}const Nm=new Map;let QI=!1;function Jpe(n,e=100){return sk(n,e,{async getAudioFeatures(t){var r;const s=Nm.get(t);if(s)return s;try{if((r=window.api)!=null&&r.getAudioFeatures){const i=await window.api.getAudioFeatures(t);if(i){const o={bpm:i.tempo||i.bpm,energy:i.energy,danceability:i.danceability,acousticness:i.acousticness,instrumentalness:i.instrumentalness,valence:i.valence,loudness:i.loudness,speechiness:i.speechiness,key:i.key?typeof i.key=="number"?Ace(i.key,i.mode):i.key:void 0,mode:typeof i.mode=="number"?i.mode===1?"major":"minor":i.mode};return Nm.set(t,o),o}}}catch(i){console.warn(`[${n}] Failed to get audio features:`,i)}return null},async getSimilarTracks(t,s){var r;try{if((r=window.api)!=null&&r.getSimilarTracks){const i=await window.api.getSimilarTracks(t,s);if(i&&Array.isArray(i))return i.map(o=>typeof o=="string"?o:o.id)}}catch(i){console.warn(`[${n}] Failed to get similar tracks:`,i)}return[]}})}function eme(n,e=75){return sk(n,e,{async getAudioFeatures(t){return null},async getSimilarTracks(t,s){var r;try{if((r=window.api)!=null&&r.getSimilarTracks)return await window.api.getSimilarTracks(t,s)||[]}catch(i){console.warn(`[${n}] Failed to get similar tracks:`,i)}return[]},async getArtistSimilarity(t,s){var r;try{if((r=window.api)!=null&&r.getArtistSimilarity)return await window.api.getArtistSimilarity(t,s)}catch(i){console.warn(`[${n}] Failed to get artist similarity:`,i)}return 0}})}function tme(){return sk("local-audio-analysis",25,{async getAudioFeatures(n){var t;const e=Nm.get(n);if(e)return e;try{if((t=window.api)!=null&&t.getAudioFeatures){const s=await window.api.getAudioFeatures(n);if(s){const r={bpm:s.bpm,energy:s.energy,danceability:s.danceability,acousticness:s.acousticness,instrumentalness:s.instrumentalness,valence:s.valence,loudness:s.loudness,speechiness:s.speechiness,key:s.key,mode:s.mode};return Nm.set(n,r),r}}}catch(s){console.warn("[LocalAnalysisProvider] Failed to get audio features:",s)}return null},async getSimilarTracks(n,e){return[]}})}async function nme(){var n;if(!QI)try{if((n=window.api)!=null&&n.checkAudioAnalyzer){const e=await window.api.checkAudioAnalyzer();if(e!=null&&e.available){const t=tme();QP(t),QI=!0,console.log("[PluginAudioFeatures] Registered local audio analysis provider")}else console.log("[PluginAudioFeatures] Local audio analysis not available (FFmpeg missing)")}}catch(e){console.warn("[PluginAudioFeatures] Failed to initialize local analysis:",e)}}function sme(){const n=ii(t=>t.plugins),e=j.useRef(new Set);j.useEffect(()=>{nme()},[]),j.useEffect(()=>{var s,r;const t=e.current;for(const i of n){const o=(s=i.roles)==null?void 0:s.includes("metadata-provider"),a=(r=i.roles)==null?void 0:r.includes("scrobbler");if(!(o||a))continue;const u=i.enabled&&i.installed,d=t.has(i.id);if(u&&!d){let f;o?f=Jpe(i.id,100):a&&(f=eme(i.id,75)),f&&(QP(f),t.add(i.id),console.log(`[PluginAudioFeatures] Registered provider: ${i.id}`))}else!u&&d&&(dI(i.id),t.delete(i.id),console.log(`[PluginAudioFeatures] Unregistered provider: ${i.id}`))}},[n]),j.useEffect(()=>()=>{const t=e.current;for(const s of t)dI(s);t.clear()},[])}function rme(){const{updateDownloadProgress:n,completeDownload:e,failDownload:t}=Xt();j.useEffect(()=>{var r;if(!((r=window.api)!=null&&r.onDownloadProgress)){console.log("[useDownloadProgress] Download progress API not available");return}console.log("[useDownloadProgress] Setting up download progress listener");const s=window.api.onDownloadProgress(i=>{switch(console.log("[useDownloadProgress] Progress event:",i),i.status){case"downloading":n(i.trackId,i.progress);break;case"completed":e(i.trackId,i.filePath||"");break;case"failed":t(i.trackId,i.error||"Download failed");break}});return()=>{console.log("[useDownloadProgress] Cleaning up download progress listener"),s()}},[n,e,t])}function ime(){const n=Xt.getState,e=dn.getState,t=j.useRef([]),s=j.useRef([]);j.useEffect(()=>{var o,a,l,u;if(!((o=window.api)!=null&&o.onLibraryDataRequest))return;const r=window.api.onLibraryDataRequest(()=>{var b;const d=n(),f=e(),p=d.likedTracks,g=d.playlists,x=Object.keys(f.dislikedTracks||{}),y=Object.values(f.dislikedTracks||{}).map(k=>k.track).filter(k=>k!==void 0);(b=window.api)==null||b.sendLibraryData({likedTracks:p,playlists:g,dislikedTrackIds:x,dislikedTracks:y})}),i=[];return(a=window.api)!=null&&a.onLibraryAction&&(i.push(window.api.onLibraryAction("like",d=>{const f=d,p=n();f&&!p.isLiked(f.id)&&p.likeTrack(f)})),i.push(window.api.onLibraryAction("unlike",d=>{const f=d,p=n();f&&p.isLiked(f)&&p.unlikeTrack(f)})),i.push(window.api.onLibraryAction("dislike",d=>{const{track:f,reasons:p}=d;f&&e().recordDislike(f,p)})),i.push(window.api.onLibraryAction("remove-dislike",d=>{const f=d;f&&e().removeDislike(f)})),i.push(window.api.onLibraryAction("create-playlist",d=>{var g;const{name:f,description:p}=d;if(f){const x=n().createPlaylist(f,p);(g=window.api)==null||g.notifyLibraryChange("library-playlist-created",x)}})),i.push(window.api.onLibraryAction("delete-playlist",d=>{const f=d;f&&n().deletePlaylist(f)})),i.push(window.api.onLibraryAction("rename-playlist",d=>{const{playlistId:f,name:p}=d;f&&p&&n().renamePlaylist(f,p)})),i.push(window.api.onLibraryAction("add-to-playlist",d=>{const{playlistId:f,track:p}=d;f&&p&&n().addToPlaylist(f,p)})),i.push(window.api.onLibraryAction("remove-from-playlist",d=>{const{playlistId:f,trackId:p}=d;f&&p&&n().removeFromPlaylist(f,p)}))),(u=(l=window.api)==null?void 0:l.signalLibraryBridgeReady)==null||u.call(l),()=>{r(),i.forEach(d=>d())}},[]),j.useEffect(()=>{var o;if(!((o=window.api)!=null&&o.notifyLibraryChange))return;const r=n();return t.current=r.likedTracks.map(a=>a.track.id),s.current=r.playlists.map(a=>a.id),Xt.subscribe(a=>{const l=a.likedTracks.map(x=>x.track.id),u=a.playlists.map(x=>x.id),d=l.filter(x=>!t.current.includes(x)),f=t.current.filter(x=>!l.includes(x));d.forEach(x=>{var b;const y=a.likedTracks.find(k=>k.track.id===x);y&&((b=window.api)==null||b.notifyLibraryChange("library-track-liked",y.track))}),f.forEach(x=>{var y;(y=window.api)==null||y.notifyLibraryChange("library-track-unliked",x)});const p=u.filter(x=>!s.current.includes(x)),g=s.current.filter(x=>!u.includes(x));p.forEach(x=>{var b;const y=a.playlists.find(k=>k.id===x);y&&((b=window.api)==null||b.notifyLibraryChange("library-playlist-created",y))}),g.forEach(x=>{var y;(y=window.api)==null||y.notifyLibraryChange("library-playlist-deleted",x)}),t.current=l,s.current=u})},[])}const Zv={playPause:["Space"],seekBackward5:["ArrowLeft"],seekForward5:["ArrowRight"],seekBackward10:["j"],seekForward10:["l"],next:["n"],previous:["p"],toggleShuffle:["s"],cycleRepeat:["r"],volumeUp:["ArrowUp"],volumeDown:["ArrowDown"],toggleMute:["m"],toggleFullPlayer:["f"],toggleQueue:["q"],toggleLyricsPanel:["y"],focusSearch:["/"],focusSearchAlt:["Control","k"],focusSearchMac:["Meta","k"],closeOverlay:["Escape"]},ome=An()(Er((n,e)=>({customMappings:{},disabledShortcuts:[],showHints:!0,setCustomMapping:(t,s)=>{n(r=>({customMappings:{...r.customMappings,[t]:s}}))},resetMapping:t=>{n(s=>{const{[t]:r,...i}=s.customMappings;return{customMappings:i}})},resetAllMappings:()=>{n({customMappings:{},disabledShortcuts:[]})},toggleShortcut:t=>{n(s=>({disabledShortcuts:s.disabledShortcuts.includes(t)?s.disabledShortcuts.filter(i=>i!==t):[...s.disabledShortcuts,t]}))},setShowHints:t=>{n({showHints:t})},getEffectiveKeys:t=>{const{customMappings:s}=e();return s[t]||Zv[t]||[]},isShortcutEnabled:t=>{const{disabledShortcuts:s}=e();return!s.includes(t)}}),{name:"audiio-shortcuts",partialize:n=>({customMappings:n.customMappings,disabledShortcuts:n.disabledShortcuts,showHints:n.showHints})})),XI=.05,YI=5e3,ZI=1e4;function ame(n){if(!n||!(n instanceof HTMLElement))return!1;const e=n.tagName.toLowerCase();return!!(e==="input"||e==="textarea"||e==="select"||n.isContentEditable||n.getAttribute("role")==="textbox")}function Pn(n,e){if(e.length===0)return!1;const t={control:e.includes("Control"),meta:e.includes("Meta"),alt:e.includes("Alt"),shift:e.includes("Shift")};if(n.ctrlKey!==t.control||n.metaKey!==t.meta||n.altKey!==t.alt||n.shiftKey!==t.shift)return!1;const s=e.find(i=>!["Control","Meta","Alt","Shift"].includes(i));if(!s)return!1;const r=n.key;return r.toLowerCase()===s.toLowerCase()||r===s}function lme(){const{isPlaying:n,currentTrack:e,position:t,duration:s,volume:r,pause:i,resume:o,seek:a,next:l,previous:u,setVolume:d,toggleMute:f,toggleShuffle:p,cycleRepeat:g}=Ke(),{playerMode:x,isQueueOpen:y,isLyricsPanelOpen:b,expandPlayer:k,collapsePlayer:w,togglePlayer:N,closeQueue:C,toggleLyricsPanel:S,closeLyricsPanel:T}=el(),{currentView:A,navigate:E,goBack:M,setSearchActive:P}=Wt(),{getEffectiveKeys:R,isShortcutEnabled:L}=ome(),_=j.useRef(null),O=j.useCallback(W=>L(W)?R(W):[],[R,L]),U=j.useCallback(W=>{if(ame(W.target)){W.key==="Escape"&&W.target instanceof HTMLElement&&W.target.blur();return}let H=!1;if(Pn(W,O("closeOverlay")))x==="full"?(w(),H=!0):y?(C(),H=!0):b?(T(),H=!0):A!=="home"&&(M(),H=!0);else if(Pn(W,O("playPause")))e&&(n?i():o(),H=!0);else if(Pn(W,O("seekBackward5"))){if(e){const G=Math.max(0,t-YI);a(G),H=!0}}else if(Pn(W,O("seekForward5"))){if(e){const G=Math.min(s,t+YI);a(G),H=!0}}else if(Pn(W,O("seekBackward10"))){if(e){const G=Math.max(0,t-ZI);a(G),H=!0}}else if(Pn(W,O("seekForward10"))){if(e){const G=Math.min(s,t+ZI);a(G),H=!0}}else Pn(W,O("next"))?e&&(l(),H=!0):Pn(W,O("previous"))?e&&(u(),H=!0):Pn(W,O("toggleShuffle"))?(p(),H=!0):Pn(W,O("cycleRepeat"))?(g(),H=!0):Pn(W,O("volumeUp"))?(d(Math.min(1,r+XI)),H=!0):Pn(W,O("volumeDown"))?(d(Math.max(0,r-XI)),H=!0):Pn(W,O("toggleMute"))?(f(),H=!0):Pn(W,O("toggleFullPlayer"))?e&&(N(),H=!0):Pn(W,O("toggleQueue"))?(y?C():window.dispatchEvent(new CustomEvent("audiio:toggle-queue-shortcut")),H=!0):Pn(W,O("toggleLyricsPanel"))?(S(),H=!0):(Pn(W,O("focusSearch"))||Pn(W,Zv.focusSearchAlt||[])||Pn(W,Zv.focusSearchMac||[]))&&(A!=="home"&&E("home"),P(!0),setTimeout(()=>{const G=document.querySelector(".floating-search-input");G==null||G.focus()},50),H=!0);H&&(W.preventDefault(),W.stopPropagation())},[e,n,t,s,r,x,y,b,A,i,o,a,l,u,d,f,p,g,k,w,N,C,S,T,M,E,P,O]);j.useEffect(()=>(document.addEventListener("keydown",U),()=>{document.removeEventListener("keydown",U),_.current&&clearTimeout(_.current)}),[U])}const cme=()=>(lme(),null),JI=.8,eT=1e3;function ume(n={}){const{enabled:e=!0,onSkip:t}=n,{currentTrack:s,position:r,duration:i,isPlaying:o}=Ke(),{recordSkip:a}=dn(),l=j.useRef(null),u=j.useCallback((d,f,p)=>{if(!e||f<eT||p<=0)return;const g=f/p;if(g>=JI)return;const x=g<.25;a(d,{skipPosition:Math.floor(f/1e3),skipPercentage:g,earlySkip:x}),t==null||t(d,g,x),console.debug("[SkipTracking] Recorded skip:",{trackId:d,skipPercentage:`${(g*100).toFixed(1)}%`,earlySkip:x})},[e,a,t]);j.useEffect(()=>{const d=l.current;d&&s&&d.id!==s.id&&d.wasPlaying&&d.duration>0&&u(d.id,d.position,d.duration),s?l.current={id:s.id,position:r,duration:i,wasPlaying:o}:l.current=null},[s==null?void 0:s.id,r,i,o,u]),j.useEffect(()=>()=>{const d=l.current;d&&d.wasPlaying&&d.duration>0&&d.position/d.duration<JI&&d.position>=eT&&console.debug("[SkipTracking] Component unmounting with incomplete track")},[])}const dme=()=>(ume({enabled:!0}),null),Gi=new Map;function hme({trackId:n,audioUrl:e,onInstrumentalReady:t,onFullTrackReady:s,onProgress:r,upcomingTracks:i}){const{isAvailable:o,isEnabled:a,isProcessing:l,processedTracks:u,currentInstrumentalUrl:d,setAvailable:f,setProcessing:p,addProcessedTrack:g,setCurrentInstrumentalUrl:x}=cd(),y=j.useRef(null),b=j.useRef(null),[k,w]=j.useState(!1),[N,C]=j.useState(0),[S,T]=j.useState(""),[A,E]=j.useState(void 0),M=j.useRef(new Map),P=j.useRef(s);P.current=s;const R=j.useRef(r);R.current=r;const L=j.useRef(t);L.current=t,j.useEffect(()=>{var Q,z,K,Y,B,J,ae,pe;(async()=>{try{const ge=await window.api.karaoke.isAvailable();f(ge.available)}catch{f(!1)}})();const U=window.api.karaoke.onAvailabilityChange(({available:ge})=>{f(ge)});let W;typeof((z=(Q=window.api)==null?void 0:Q.karaoke)==null?void 0:z.onFirstChunkReady)=="function"&&(W=window.api.karaoke.onFirstChunkReady(({trackId:ge,url:he})=>{ge===y.current&&he&&fetch(he,{method:"HEAD",signal:AbortSignal.timeout(3e3)}).then(we=>{var Pe;we.ok&&(Gi.set(ge,{url:he,isComplete:!1}),w(!0),x(he),(Pe=L.current)==null||Pe.call(L,he))}).catch(()=>{var we;Gi.set(ge,{url:he,isComplete:!1}),w(!0),x(he),(we=L.current)==null||we.call(L,he)})}));let H;typeof((Y=(K=window.api)==null?void 0:K.karaoke)==null?void 0:Y.onFullTrackReady)=="function"&&(H=window.api.karaoke.onFullTrackReady(({trackId:ge,result:he})=>{var we;ge===y.current&&(he!=null&&he.instrumentalUrl)&&(Gi.set(ge,{url:he.instrumentalUrl,isComplete:!0}),w(!1),C(100),T("Complete"),E(void 0),x(he.instrumentalUrl),(we=P.current)==null||we.call(P,he.instrumentalUrl))}));let G;typeof((J=(B=window.api)==null?void 0:B.karaoke)==null?void 0:J.onProgress)=="function"&&(G=window.api.karaoke.onProgress(({trackId:ge,progress:he,stage:we,eta:Pe})=>{var ue;ge===y.current&&(C(he),T(we),E(Pe),(ue=R.current)==null||ue.call(R,he,we,Pe))}));let q;return typeof((pe=(ae=window.api)==null?void 0:ae.karaoke)==null?void 0:pe.onChunkUpdated)=="function"&&(q=window.api.karaoke.onChunkUpdated(({trackId:ge,url:he,chunkNumber:we})=>{var Pe;if(ge===y.current&&he){const ue=`${he}?chunk=${we}&t=${Date.now()}`;Gi.set(ge,{url:ue,isComplete:!1}),x(ue),(Pe=L.current)==null||Pe.call(L,ue)}})),()=>{U(),W==null||W(),H==null||H(),G==null||G(),q==null||q()}},[f,x]);const _=j.useCallback(async()=>{var W;if(!n||!e||!a||!o)return;const O=M.current.get(n);if(O&&Date.now()-O<3e4)return;const U=Gi.get(n);if(U!=null&&U.isComplete){x(U.url),w(!1),C(100),T("Complete"),E(void 0),t==null||t(U.url);return}if(u.has(n))try{const H=await window.api.karaoke.getCached(n);if(H.success&&((W=H.result)!=null&&W.instrumentalUrl)){const G=!H.result.isPartial;if(H.result.isFirstChunk&&!G)return;Gi.set(n,{url:H.result.instrumentalUrl,isComplete:G}),x(H.result.instrumentalUrl),w(!G),G&&(C(100),T("Complete")),t==null||t(H.result.instrumentalUrl);return}}catch{}b.current||(p(!0),x(null),w(!1),C(0),T("Starting..."),E(void 0),b.current=(async()=>{try{const H=await window.api.karaoke.processTrack(n,e);if(H.success&&H.result){if(g(n),H.result.instrumentalUrl){const G=!H.result.isPartial,q=H.result.isFirstChunk;G?(Gi.set(n,{url:H.result.instrumentalUrl,isComplete:!0}),x(H.result.instrumentalUrl),w(!1),C(100),T("Complete"),t==null||t(H.result.instrumentalUrl)):q?(w(!0),C(10),T("Processing..."),H.result.eta&&E(H.result.eta)):(Gi.set(n,{url:H.result.instrumentalUrl,isComplete:!1}),x(H.result.instrumentalUrl),w(!0),C(10),T("Processing..."),H.result.eta&&E(H.result.eta),t==null||t(H.result.instrumentalUrl))}}else M.current.set(n,Date.now())}catch{M.current.set(n,Date.now())}finally{p(!1),b.current=null}})(),await b.current)},[n,e,a,o,u,p,g,x,t]);return j.useEffect(()=>{n!==y.current?(y.current&&M.current.delete(y.current),y.current=n,x(null),w(!1),C(0),T(""),E(void 0),b.current=null,a&&n&&e&&_()):a&&n&&e&&!d&&!l&&_()},[n,a,e,_,d,l,x]),j.useEffect(()=>{var U,W;if(!a||!o||!(i!=null&&i.length))return;const O=i.filter(H=>!Gi.has(H.id)&&!u.has(H.id)).slice(0,3);O.length>0&&typeof((W=(U=window.api)==null?void 0:U.karaoke)==null?void 0:W.predictivePrefetch)=="function"&&window.api.karaoke.predictivePrefetch(O).catch(()=>{})},[a,o,i,u]),j.useEffect(()=>{a||(x(null),w(!1),C(0),T(""),E(void 0))},[a,x]),{isAvailable:o,isEnabled:a,isProcessing:l,isPartial:k,progress:N,stage:S,eta:A,instrumentalUrl:d,toggle:cd.getState().toggle}}const Pu=new WeakMap;function fme({originalAudio:n,instrumentalUrl:e,isEnabled:t}){const{vocalReduction:s}=cd(),r=j.useRef(null),i=j.useRef(!1),[o,a]=j.useState(!1),[l,u]=j.useState(!1),[d,f]=j.useState(!1),[p,g]=j.useState(!1),x=j.useCallback(()=>{if(!n)return null;let b=Pu.get(n);if(!b)try{const k=new AudioContext,w=k.createMediaElementSource(n),N=k.createGain();w.connect(N),N.connect(k.destination),N.gain.value=1,b={context:k,source:w,originalGain:N},Pu.set(n,b)}catch{return null}return b.context.state==="suspended"&&b.context.resume(),b},[n]),y=j.useCallback(()=>{if(!n)return;const b=Pu.get(n);(b==null?void 0:b.context.state)==="suspended"&&b.context.resume()},[n]);return j.useEffect(()=>{!n||!t||x()},[n,t,x]),j.useEffect(()=>{if(!e||!t||!n){a(!1),u(!1),f(!1),g(!1);return}const b=x();if(!b)return;let k=r.current;if(!k){const C=new Audio;C.crossOrigin="anonymous",C.addEventListener("error",()=>{u(!0),a(!1),g(!1)}),C.addEventListener("ended",()=>{(C.src.includes("_stream")||C.src.includes("chunk="))&&n&&!n.paused||f(!0),g(!1)}),C.addEventListener("play",()=>{g(!0),f(!1)}),C.addEventListener("pause",()=>{g(!1)});try{const S=b.context.createMediaElementSource(C),T=b.context.createGain();S.connect(T),T.connect(b.context.destination),T.gain.value=0,k={audio:C,source:S,gain:T},r.current=k}catch{u(!0);return}}const w=k.audio.src;let N=w===e;if(!N&&w&&e)try{const C=w.split("?")[0],S=e.split("?")[0];if(C===S){const T=new URLSearchParams(w.split("?")[1]||""),A=new URLSearchParams(e.split("?")[1]||""),E=T.get("chunk"),M=A.get("chunk");E!==M?N=!1:N=!0}}catch{N=w.includes(e)||e.includes(w)}if(N)l||a(!0);else{a(!1),u(!1),f(!1);let C=0;const S=3,T=()=>{C++;const A=()=>{a(!0),u(!1),n&&!n.paused&&k&&(k.audio.currentTime=n.currentTime,k.audio.play().catch(()=>{}))},E=M=>{var L;const R=(L=M.target.error)==null?void 0:L.code;C<S&&(R===2||R===4)?setTimeout(()=>{k!=null&&k.audio&&e&&(k.audio.removeEventListener("canplaythrough",A),k.audio.removeEventListener("error",E),T())},1e3):(u(!0),a(!1))};k&&(k.audio.addEventListener("canplaythrough",A,{once:!0}),k.audio.addEventListener("error",E,{once:!0}),k.audio.src=e,k.audio.load())};return T(),()=>{k!=null&&k.audio&&(k.audio.src="")}}},[e,t,n,x,l]),j.useEffect(()=>{const b=r.current;if(!t||!n||!b||!o)return;const k=()=>{if(!b.audio||b.audio.paused||b.audio.ended)return;Math.abs(b.audio.currentTime-n.currentTime)>.15&&n.currentTime<b.audio.duration&&(b.audio.currentTime=n.currentTime)},w=async()=>{if(!(!b.audio||!o)&&!(b.audio.duration&&n.currentTime>=b.audio.duration)){b.audio.currentTime=n.currentTime;try{await b.audio.play()}catch{}}},N=()=>{b==null||b.audio.pause()},C=()=>{b!=null&&b.audio&&(!b.audio.duration||n.currentTime<b.audio.duration)&&(b.audio.currentTime=n.currentTime)};!n.paused&&o&&w(),n.addEventListener("play",w),n.addEventListener("pause",N),n.addEventListener("seeking",C),n.addEventListener("seeked",C);const S=setInterval(k,500);return()=>{n.removeEventListener("play",w),n.removeEventListener("pause",N),n.removeEventListener("seeking",C),n.removeEventListener("seeked",C),clearInterval(S)}},[t,n,o]),j.useEffect(()=>{if(!n)return;y();const b=Pu.get(n),k=r.current;if(!b)return;const w=b.context.currentTime,N=.05,C=k&&o&&!l&&!d,S=s,T=S<.5?2*S*S:1-Math.pow(-2*S+2,2)/2,A=.75,E=1+.4*Math.sin(S*Math.PI);let M=(1-T)*E,P=T*E*A;const R=Math.max(M,P);if(R>1&&(M/=R,P/=R),t&&C){const L=p&&!k.audio.paused&&k.audio.currentTime>0;P>.1&&!L?(b.originalGain.gain.setTargetAtTime(1,w,N),k.audio.paused&&!n.paused&&(!k.audio.duration||n.currentTime<k.audio.duration)&&(k.audio.currentTime=n.currentTime,k.audio.play().catch(()=>{}))):(b.originalGain.gain.setTargetAtTime(M,w,N),k.gain.gain.setTargetAtTime(P,w,N),P>0&&k.audio.paused&&!n.paused&&(!k.audio.duration||n.currentTime<k.audio.duration)&&(k.audio.currentTime=n.currentTime,k.audio.play().catch(()=>{})))}else b.originalGain.gain.setTargetAtTime(1,w,N),k&&(k.gain.gain.setTargetAtTime(0,w,N),setTimeout(()=>{k!=null&&k.audio&&!k.audio.paused&&k.audio.pause()},100))},[s,t,n,o,l,d,p,y]),j.useEffect(()=>{if(i.current===t||(i.current=t,!n))return;y();const b=Pu.get(n),k=r.current;if(!b)return;const w=b.context.currentTime,N=k&&o&&!l&&!d;if(t)if(N){const C=s,S=C<.5?2*C*C:1-Math.pow(-2*C+2,2)/2,T=1+.4*Math.sin(C*Math.PI),A=.75;let E=(1-S)*T,M=S*T*A;const P=Math.max(E,M);P>1&&(E/=P,M/=P);const R=p?E:1;b.originalGain.gain.setTargetAtTime(R,w,.1),k.gain.gain.setTargetAtTime(M,w,.1),!n.paused&&M>0&&(k.audio.currentTime=n.currentTime,k.audio.play().catch(()=>{}))}else b.originalGain.gain.setTargetAtTime(1,w,.1);else b.originalGain.gain.setTargetAtTime(1,w,.1),k&&(k.gain.gain.setTargetAtTime(0,w,.1),setTimeout(()=>{k==null||k.audio.pause()},150))},[t,n,s,o,l,d,p,y]),j.useEffect(()=>()=>{const b=r.current;b&&(b.audio.pause(),b.audio.src="",r.current=null),a(!1),u(!1),f(!1),g(!1)},[]),j.useEffect(()=>{e&&f(!1)},[e]),{isReady:o,hasError:l,hasEnded:d,isPlaying:p}}function pme(n,e,t,s){var r,i,o;if(t)return t.type==="artist"&&n.artists.some(a=>a.name===t.name)?{type:"artist",label:t.name}:{type:"radio",label:`${t.name} Radio`};if(e&&s){const a=(r=e.artists[0])==null?void 0:r.name;if(a&&n.artists.some(l=>l.name===a))return{type:"artist",label:a};if((i=e.genres)!=null&&i.length&&((o=n.genres)!=null&&o.length)){const l=e.genres.find(u=>{var d;return(d=n.genres)==null?void 0:d.some(f=>f.toLowerCase()===u.toLowerCase())});if(l)return{type:"genre",label:l}}return{type:"auto",label:"For You"}}return null}const mme=({id:n,track:e,index:t,onPlay:s,onRemove:r,onContextMenu:i,sourceHint:o})=>{const{attributes:a,listeners:l,setNodeRef:u,transform:d,transition:f,isDragging:p}=Rm({id:n}),g={transform:ei.Transform.toString(d),transition:f,opacity:p?.5:1,zIndex:p?1e3:"auto"};return c.jsxs("div",{ref:u,style:g,className:`queue-popover-item ${p?"dragging":""}`,children:[c.jsx("button",{className:"queue-popover-item-drag",...a,...l,title:"Drag to reorder",children:c.jsx(Mm,{size:14})}),c.jsx(Oh,{track:e,index:t+1,isPlaying:!1,onClick:s,onContextMenu:i,compact:!0}),o&&c.jsxs("span",{className:`queue-source-badge queue-source-${o.type}`,title:`Added because: ${o.label}`,children:[o.type==="artist"&&"Artist",o.type==="genre"&&"Genre",o.type==="similar"&&"Similar",o.type==="radio"&&"Radio",o.type==="auto"&&"For You"]}),c.jsx("button",{className:"queue-popover-item-remove",onClick:r,title:"Remove from queue",children:c.jsx(an,{size:14})})]})},gme=()=>{var Q,z,K;const n=j.useRef(null),e=j.useRef(null),[t,s]=j.useState(15),{currentTrack:r,queue:i,queueIndex:o,play:a,setQueue:l,reorderQueue:u}=Ke(),{recordReorder:d}=dn(),{isQueueOpen:f,queueAnchorRect:p,closeQueue:g}=el(),{showContextMenu:x}=pt(),{rankTracks:y,isMLReady:b}=XP(),{isRadioMode:k,seed:w}=lM(),{isEnabled:N,isFetching:C}=Gue(),{stopRadio:S,toggleAutoQueue:T}=dl(),A=k||N,[E,M]=j.useState(!1),P=i.slice(o+1),R=j.useCallback(async()=>{if(!(P.length<2||E)){M(!0);try{const Y=await y(P,{enabled:!0,explorationMode:"balanced",shuffle:!0,shuffleIntensity:.15}),B=i.slice(0,o+1),J=Y.map(pe=>pe.track),ae=[...B,...J];l(ae,o),console.log("[QueuePopover] Re-ranked queue using ML preferences")}catch(Y){console.error("[QueuePopover] Re-ranking failed:",Y)}finally{M(!1)}}},[P,i,o,y,l,E]),L=ib(sc(pd,{activationConstraint:{distance:8}}),sc(fd,{coordinateGetter:pb})),_=j.useCallback(Y=>{const{active:B,over:J}=Y;if(J&&B.id!==J.id){const ae=P.slice(0,t),pe=ae.findIndex(he=>`queue-${he.id}`===B.id),ge=ae.findIndex(he=>`queue-${he.id}`===J.id);if(pe!==-1&&ge!==-1){const he=ae[pe];u(pe,ge),he&&d(he,pe,ge)}}},[P,t,u,d]);j.useEffect(()=>{if(!f)return;const Y=J=>{n.current&&!n.current.contains(J.target)&&g()},B=J=>{J.key==="Escape"&&g()};return setTimeout(()=>{document.addEventListener("mousedown",Y),document.addEventListener("keydown",B)},0),()=>{document.removeEventListener("mousedown",Y),document.removeEventListener("keydown",B)}},[f,g]);const O=j.useCallback(()=>{const Y=e.current;if(!Y)return;Y.scrollHeight-Y.scrollTop-Y.clientHeight<100&&t<P.length&&s(J=>Math.min(J+10,P.length))},[t,P.length]);if(j.useEffect(()=>{f||s(15)},[f]),!f||!p)return null;const U=(Y,B)=>{Y.stopPropagation();const J=o+1+B,ae=[...i];ae.splice(J,1),l(ae,o)},W=Y=>{const B=o+1+Y,J=i[B];J&&a(J)},H=()=>{const Y=i.slice(0,o+1);l(Y,o)},G={position:"fixed",bottom:`calc(100vh - ${p.top}px + 8px)`,right:`calc(100vw - ${p.right}px)`},q=((Q=r==null?void 0:r.artwork)==null?void 0:Q.medium)??((K=(z=r==null?void 0:r.album)==null?void 0:z.artwork)==null?void 0:K.medium);return c.jsxs("div",{className:"queue-popover",ref:n,style:G,children:[c.jsxs("header",{className:"queue-popover-header",children:[c.jsxs("div",{className:"queue-popover-title",children:[c.jsx(Bp,{size:20}),c.jsx("h3",{children:"Queue"})]}),c.jsxs("div",{className:"queue-popover-actions",children:[c.jsx("button",{className:`queue-smart-toggle ${A?"active":""}`,onClick:k?S:T,title:k?`Radio: ${(w==null?void 0:w.name)||"Active"} (click to stop)`:A?"Disable Smart Queue":"Enable Smart Queue",children:k?c.jsx(rc,{size:18}):c.jsx(nO,{size:18})}),c.jsx("button",{className:"queue-popover-close",onClick:g,children:c.jsx(an,{size:18})})]})]}),c.jsxs("div",{className:"queue-popover-content",ref:e,onScroll:O,children:[k&&w&&c.jsx("div",{className:"queue-radio-banner",children:c.jsxs("div",{className:"queue-radio-info",children:[c.jsx("span",{className:"queue-radio-label",children:"Playing from"}),c.jsx("span",{className:"queue-radio-seed",children:w.name})]})}),!k&&N&&c.jsx("div",{className:"queue-auto-banner",children:c.jsx("span",{className:"queue-auto-label",children:"Automatically adding tracks when queue runs low"})}),r&&c.jsxs("section",{className:"queue-popover-section",children:[c.jsx("h4",{className:"queue-popover-section-title",children:"Now Playing"}),c.jsxs("div",{className:"queue-popover-now-playing",children:[c.jsxs("div",{className:"queue-popover-artwork",children:[q?c.jsx("img",{src:q,alt:r.title}):c.jsx("div",{className:"queue-popover-artwork-placeholder",children:c.jsx(qe,{size:20})}),c.jsxs("span",{className:"queue-popover-playing-indicator",children:[c.jsx("span",{}),c.jsx("span",{}),c.jsx("span",{})]})]}),c.jsxs("div",{className:"queue-popover-track-info",children:[c.jsx("div",{className:"queue-popover-track-title",children:r.title}),c.jsx("div",{className:"queue-popover-track-artist",children:r.artists.map(Y=>Y.name).join(", ")})]})]})]}),c.jsxs("section",{className:"queue-popover-section",children:[c.jsxs("div",{className:"queue-popover-section-header",children:[c.jsx("h4",{className:"queue-popover-section-title",children:"Up Next"}),c.jsxs("div",{className:"queue-popover-section-actions",children:[P.length>=2&&c.jsxs("button",{className:`queue-popover-rerank ${E?"loading":""}`,onClick:R,disabled:E,title:b?"Re-order based on your preferences":"Learning your preferences...",children:[E?c.jsx(fS,{size:14}):c.jsx(oo,{size:14}),c.jsx("span",{children:"Optimize"})]}),P.length>0&&c.jsx("button",{className:"queue-popover-clear",onClick:H,children:"Clear"})]})]}),P.length===0?c.jsx("div",{className:"queue-popover-empty",children:c.jsx("p",{children:"No tracks in queue"})}):c.jsx(ub,{sensors:L,collisionDetection:ob,onDragEnd:_,children:c.jsx(fb,{items:P.slice(0,t).map(Y=>`queue-${Y.id}`),strategy:hb,children:c.jsxs("div",{className:"queue-popover-list",children:[P.slice(0,t).map((Y,B)=>c.jsx(mme,{id:`queue-${Y.id}`,track:Y,index:B,onPlay:()=>W(B),onRemove:J=>U(J,B),onContextMenu:x,sourceHint:A?pme(Y,r,w,N):null},`queue-${Y.id}`)),P.length>t&&c.jsxs("div",{className:"queue-popover-more",children:["Scroll for ",P.length-t," more tracks"]})]})})}),C&&c.jsxs("div",{className:"queue-loading",children:[c.jsx(fS,{size:16}),c.jsx("span",{children:"Finding more music..."})]})]})]})]})},wM=({track:n,onClose:e})=>{var f,p,g;const[t,s]=j.useState([]),{recordDislike:r}=dn(),{dislikeTrack:i}=Xt(),o=x=>{s(y=>y.includes(x)?y.filter(b=>b!==x):[...y,x])},a=()=>{t.length>0&&(r(n,t),i(n),e())},l=()=>{r(n,["not_my_taste"]),i(n),e()},u=((f=n.artwork)==null?void 0:f.medium)??((g=(p=n.album)==null?void 0:p.artwork)==null?void 0:g.medium),d=n.artists.map(x=>x.name).join(", ");return c.jsx("div",{className:"modal-overlay",onClick:e,children:c.jsxs("div",{className:"dislike-modal",onClick:x=>x.stopPropagation(),children:[c.jsxs("header",{className:"dislike-modal-header",children:[c.jsx("h2",{children:"Not for you?"}),c.jsx("button",{className:"dislike-modal-close",onClick:e,children:c.jsx(an,{size:20})})]}),c.jsxs("div",{className:"dislike-modal-track",children:[u?c.jsx("img",{className:"dislike-modal-artwork",src:u,alt:""}):c.jsx("div",{className:"dislike-modal-artwork dislike-modal-artwork-placeholder",children:c.jsx(qe,{size:24})}),c.jsxs("div",{className:"dislike-modal-track-info",children:[c.jsx("span",{className:"dislike-modal-title",children:n.title}),c.jsx("span",{className:"dislike-modal-artist",children:d})]})]}),c.jsxs("div",{className:"dislike-modal-content",children:[c.jsx("p",{className:"dislike-modal-prompt",children:"Help us understand why so we can improve your recommendations:"}),c.jsx("div",{className:"dislike-reasons-grid",children:rv.map(({value:x,label:y})=>c.jsx("button",{className:`dislike-reason-button ${t.includes(x)?"selected":""}`,onClick:()=>o(x),children:y},x))})]}),c.jsxs("footer",{className:"dislike-modal-footer",children:[c.jsx("button",{className:"dislike-modal-skip",onClick:l,children:"Just hide it"}),c.jsx("button",{className:"dislike-modal-submit",onClick:a,disabled:t.length===0,children:"Submit Feedback"})]})]})})},xme=()=>{var Zn,Yt,Dr,ur,Di;const n=j.useRef(null),e=j.useRef(null),[t,s]=j.useState(null),{currentTrack:r,isPlaying:i,position:o,duration:a,volume:l,isMuted:u,isLoading:d,shuffle:f,repeat:p,pause:g,resume:x,seek:y,next:b,previous:k,setVolume:w,toggleMute:N,setPosition:C,setIsPlaying:S,toggleShuffle:T,cycleRepeat:A}=Ke(),{isQueueOpen:E,toggleQueue:M,expandPlayer:P,isLyricsPanelOpen:R,toggleLyricsPanel:L}=el(),{recordListen:_}=dn(),{openAlbum:O,openArtist:U}=Wt(),{showContextMenu:W}=pt(),{isEnabled:H,instrumentalUrl:G}=hme({trackId:(r==null?void 0:r.id)||null,audioUrl:((Zn=r==null?void 0:r.streamInfo)==null?void 0:Zn.url)||null});fme({originalAudio:t,instrumentalUrl:G,isEnabled:H&&!!G});const q=j.useCallback(Xe=>{n.current=Xe,s(Xe)},[]),Q=j.useRef(0),z=j.useRef(null),K=j.useCallback(async Xe=>{if(e.current)try{await e.current}catch{}e.current=Xe.play();try{await e.current}catch(yt){yt.name!=="AbortError"&&console.error("Audio playback error:",yt)}e.current=null},[]),Y=j.useCallback(async Xe=>{if(e.current){try{await e.current}catch{}e.current=null}Xe.pause()},[]);j.useEffect(()=>{const Xe=n.current;Xe&&(i&&(r!=null&&r.streamInfo)?K(Xe):Y(Xe))},[i,r==null?void 0:r.streamInfo,K,Y]),j.useEffect(()=>{const Xe=n.current;Xe&&(Xe.volume=u?0:l)},[l,u]),j.useEffect(()=>{const Xe=n.current;if(!Xe||!(r!=null&&r.streamInfo))return;const yt=r.streamInfo.url;if(Xe.src!==yt){const Gt=!Xe.paused;Xe.src=yt,(i||Gt)&&K(Xe)}},[(Yt=r==null?void 0:r.streamInfo)==null?void 0:Yt.url,i,K]),j.useEffect(()=>{r&&(z.current&&z.current!==r.id&&(Date.now()-Q.current,z.current),Q.current=Date.now(),z.current=r.id)},[r==null?void 0:r.id]);const B=j.useCallback(()=>{n.current&&C(n.current.currentTime*1e3)},[C]),J=j.useRef(0);j.useEffect(()=>{const Xe=n.current;if(!Xe)return;const yt=Xe.currentTime*1e3;Math.abs(o-yt)>500&&Math.abs(o-J.current)>100&&(Xe.currentTime=o/1e3,J.current=o)},[o]);const ae=j.useCallback(()=>{if(r){const Xe=Date.now()-Q.current;_(r,Xe,!0,!1)}b()},[b,r,_]),pe=j.useCallback(()=>{S(!1),console.error("Audio playback error")},[S]),ge=j.useRef(null),he=j.useRef(!1),we=j.useCallback(Xe=>{if(!ge.current)return;const yt=ge.current.getBoundingClientRect(),Cs=Math.max(0,Math.min(1,(Xe-yt.left)/yt.width))*a;y(Cs),n.current&&(n.current.currentTime=Cs/1e3)},[a,y]),Pe=j.useCallback(Xe=>{he.current=!0,we(Xe.clientX);const yt=Cs=>{he.current&&we(Cs.clientX)},Gt=()=>{he.current=!1,document.removeEventListener("mousemove",yt),document.removeEventListener("mouseup",Gt)};document.addEventListener("mousemove",yt),document.addEventListener("mouseup",Gt)},[we]),ue=j.useRef(null),Te=j.useRef(!1),ke=j.useCallback(Xe=>{if(!ue.current)return;const yt=ue.current.getBoundingClientRect(),Gt=Math.max(0,Math.min(1,(Xe-yt.left)/yt.width));w(Gt)},[w]),ye=j.useCallback(Xe=>{Te.current=!0,ke(Xe.clientX);const yt=Cs=>{Te.current&&ke(Cs.clientX)},Gt=()=>{Te.current=!1,document.removeEventListener("mousemove",yt),document.removeEventListener("mouseup",Gt)};document.addEventListener("mousemove",yt),document.addEventListener("mouseup",Gt)},[ke]),Ce=Xe=>{const yt=Math.floor(Xe/1e3),Gt=Math.floor(yt/60),Cs=yt%60;return`${Gt}:${Cs.toString().padStart(2,"0")}`},Ae=a>0?o/a*100:0,{isLiked:Be,toggleLike:mt}=Xt(),le=r?Be(r.id):!1,[je,De]=j.useState(!1),_e=j.useCallback(()=>{r&&De(!0)},[r]),it=j.useCallback(()=>{De(!1),b()},[b]),St=j.useCallback(Xe=>{var yt,Gt;Xe.stopPropagation(),r!=null&&r.album&&O(r.album.id,{id:r.album.id,title:r.album.title,artist:((yt=r.artists[0])==null?void 0:yt.name)||"Unknown Artist",artwork:(Gt=r.album.artwork)==null?void 0:Gt.medium,source:r.source})},[r,O]),cn=j.useCallback(Xe=>{var Gt;Xe.stopPropagation();const yt=r==null?void 0:r.artists[0];yt&&U(yt.id,{id:yt.id,name:yt.name,image:(Gt=r==null?void 0:r.artwork)==null?void 0:Gt.medium,source:(r==null?void 0:r.source)||"unknown"})},[r,U]),Ut=u||l===0?G4:l<.5?U4:V4;if(!r)return c.jsx("div",{className:"player",children:c.jsxs("div",{className:"player-empty",children:[c.jsx(qe,{size:20}),c.jsx("span",{children:"Select a track to play"})]})});const ut=((Dr=r.artwork)==null?void 0:Dr.medium)??((Di=(ur=r.album)==null?void 0:ur.artwork)==null?void 0:Di.medium),yn=r.artists.map(Xe=>Xe.name).join(", ");return c.jsxs("div",{className:"player",children:[c.jsx("audio",{ref:q,crossOrigin:"anonymous",onTimeUpdate:B,onEnded:ae,onError:pe}),c.jsxs("div",{className:"player-track",onClick:P,onContextMenu:Xe=>W(Xe,r),role:"button",tabIndex:0,children:[ut?c.jsx("img",{className:"player-artwork",src:ut,alt:r.title}):c.jsx("div",{className:"player-artwork player-artwork-placeholder",children:c.jsx(qe,{size:24})}),c.jsxs("div",{className:"player-track-info",children:[c.jsx("div",{className:`player-track-title ${r.album?"clickable":""}`,onClick:r.album?St:void 0,title:r.album?`Go to ${r.album.title}`:void 0,children:r.title}),c.jsx("div",{className:`player-track-artist ${r.artists.length>0?"clickable":""}`,onClick:r.artists.length>0?cn:void 0,title:r.artists.length>0?`Go to ${r.artists[0].name}`:void 0,children:yn})]}),c.jsx("button",{className:`player-like-button ${le?"liked":""}`,onClick:Xe=>{Xe.stopPropagation(),mt(r)},title:le?"Remove from Liked Songs":"Add to Liked Songs",children:le?c.jsx(Sc,{size:18}):c.jsx(ic,{size:18})}),c.jsx("button",{className:"player-dislike-button",onClick:Xe=>{Xe.stopPropagation(),_e()},title:"Not for me",children:c.jsx(ql,{size:18})})]}),c.jsxs("div",{className:"player-controls",children:[c.jsxs("div",{className:"player-buttons",children:[c.jsx("button",{className:`player-button small ${f?"active":""}`,onClick:T,title:f?"Disable shuffle":"Enable shuffle",children:c.jsx(oo,{size:18})}),c.jsx("button",{className:"player-button",onClick:k,title:"Previous",children:c.jsx(mb,{size:20})}),c.jsx("button",{className:"player-button play",onClick:i?g:x,disabled:d,title:i?"Pause":"Play",children:d?c.jsx("span",{className:"player-loading"}):i?c.jsx(gd,{size:24}):c.jsx(Et,{size:24})}),c.jsx("button",{className:"player-button",onClick:b,title:"Next",children:c.jsx(Dm,{size:20})}),c.jsx("button",{className:`player-button small ${p!=="off"?"active":""}`,onClick:A,title:p==="off"?"Enable repeat":p==="all"?"Repeat one":"Disable repeat",children:p==="one"?c.jsx(QT,{size:18}):c.jsx(KT,{size:18})})]}),c.jsxs("div",{className:"progress-container",children:[c.jsx("span",{className:"progress-time",children:Ce(o)}),c.jsx("div",{className:"progress-bar",ref:ge,onMouseDown:Pe,children:c.jsx("div",{className:"progress-bar-fill",style:{width:`${Ae}%`}})}),c.jsx("span",{className:"progress-time",children:Ce(a)})]})]}),c.jsxs("div",{className:"player-extra",children:[c.jsx("button",{className:`player-button small ${R?"active":""}`,onClick:L,title:"Lyrics",children:c.jsx(xb,{size:18})}),c.jsx("button",{className:`player-button small ${E?"active":""}`,onClick:Xe=>M(Xe.currentTarget.getBoundingClientRect()),title:"Queue",children:c.jsx(Bp,{size:18})}),c.jsxs("div",{className:"player-volume",children:[c.jsx("button",{className:"player-button small",onClick:N,title:u?"Unmute":"Mute",children:c.jsx(Ut,{size:18})}),c.jsx("div",{className:"volume-slider",ref:ue,onMouseDown:ye,children:c.jsx("div",{className:"volume-slider-fill",style:{width:`${(u?0:l)*100}%`}})})]})]}),je&&r&&Ul.createPortal(c.jsx(wM,{track:r,onClose:it}),document.body)]})},yme="audiio-lyrics",vme=1,Un="lyrics",tT=30;class bme{constructor(){Mt(this,"db",null);Mt(this,"initPromise",null);Mt(this,"memoryCache",new Map);Mt(this,"MAX_MEMORY_ENTRIES",50)}async initialize(){if(!this.db)return this.initPromise?this.initPromise:(this.initPromise=new Promise((e,t)=>{const s=indexedDB.open(yme,vme);s.onerror=()=>{console.error("[LyricsCache] Failed to open:",s.error),t(s.error)},s.onsuccess=()=>{this.db=s.result,console.log("[LyricsCache] Initialized"),e()},s.onupgradeneeded=r=>{const i=r.target.result;if(!i.objectStoreNames.contains(Un)){const o=i.createObjectStore(Un,{keyPath:"id"});o.createIndex("createdAt","createdAt",{unique:!1}),o.createIndex("accessedAt","accessedAt",{unique:!1}),o.createIndex("artistTitle",["artist","title"],{unique:!1})}}}),this.initPromise)}async ensureDb(){if(await this.initialize(),!this.db)throw new Error("Lyrics cache not initialized");return this.db}async get(e){const t=this.memoryCache.get(e);if(t&&!this.isExpired(t.createdAt))return t;try{const s=await this.ensureDb();return new Promise((r,i)=>{const a=s.transaction(Un,"readwrite").objectStore(Un),l=a.get(e);l.onerror=()=>i(l.error),l.onsuccess=()=>{const u=l.result;u&&!this.isExpired(u.createdAt)?(u.accessedAt=Date.now(),a.put(u),this.addToMemoryCache(u),r(u)):r(null)}})}catch(s){return console.error("[LyricsCache] Get error:",s),null}}async getByArtistTitle(e,t){try{const s=await this.ensureDb(),r=e.toLowerCase().trim(),i=t.toLowerCase().trim();return new Promise((o,a)=>{const f=s.transaction(Un,"readonly").objectStore(Un).index("artistTitle").get([r,i]);f.onerror=()=>a(f.error),f.onsuccess=()=>{const p=f.result;p&&!this.isExpired(p.createdAt)?o(p):o(null)}})}catch(s){return console.error("[LyricsCache] GetByArtistTitle error:",s),null}}async set(e){try{const t=await this.ensureDb(),s=Date.now(),r={...e,artist:e.artist.toLowerCase().trim(),title:e.title.toLowerCase().trim(),createdAt:s,accessedAt:s};return new Promise((i,o)=>{const u=t.transaction(Un,"readwrite").objectStore(Un).put(r);u.onerror=()=>o(u.error),u.onsuccess=()=>{this.addToMemoryCache(r),console.log(`[LyricsCache] Cached lyrics for: ${e.artist} - ${e.title}`),i()}})}catch(t){console.error("[LyricsCache] Set error:",t)}}async has(e){if(this.memoryCache.has(e))return!0;try{const t=await this.ensureDb();return new Promise((s,r)=>{const a=t.transaction(Un,"readonly").objectStore(Un).count(IDBKeyRange.only(e));a.onerror=()=>r(a.error),a.onsuccess=()=>s(a.result>0)})}catch{return!1}}async delete(e){this.memoryCache.delete(e);try{const t=await this.ensureDb();return new Promise((s,r)=>{const a=t.transaction(Un,"readwrite").objectStore(Un).delete(e);a.onerror=()=>r(a.error),a.onsuccess=()=>s()})}catch(t){console.error("[LyricsCache] Delete error:",t)}}async clearExpired(){try{const e=await this.ensureDb(),t=Date.now()-tT*24*60*60*1e3;let s=0;return new Promise((r,i)=>{const u=e.transaction(Un,"readwrite").objectStore(Un).index("createdAt").openCursor(IDBKeyRange.upperBound(t));u.onerror=()=>i(u.error),u.onsuccess=()=>{const d=u.result;if(d){const f=d.value;this.memoryCache.delete(f.id),d.delete(),s++,d.continue()}else console.log(`[LyricsCache] Cleared ${s} expired entries`),r(s)}})}catch(e){return console.error("[LyricsCache] ClearExpired error:",e),0}}async getStats(){try{const e=await this.ensureDb();return new Promise((t,s)=>{const o=e.transaction(Un,"readonly").objectStore(Un).count();o.onerror=()=>s(o.error),o.onsuccess=()=>{t({entries:o.result,memoryEntries:this.memoryCache.size})}})}catch{return{entries:0,memoryEntries:this.memoryCache.size}}}async clearAll(){this.memoryCache.clear();try{const e=await this.ensureDb();return new Promise((t,s)=>{const o=e.transaction(Un,"readwrite").objectStore(Un).clear();o.onerror=()=>s(o.error),o.onsuccess=()=>{console.log("[LyricsCache] Cleared all entries"),t()}})}catch(e){console.error("[LyricsCache] ClearAll error:",e)}}addToMemoryCache(e){if(this.memoryCache.size>=this.MAX_MEMORY_ENTRIES){const t=this.memoryCache.keys().next().value;t&&this.memoryCache.delete(t)}this.memoryCache.set(e.id,e)}isExpired(e){const t=tT*24*60*60*1e3;return Date.now()-e>t}async close(){this.db&&(this.db.close(),this.db=null,this.initPromise=null),this.memoryCache.clear()}}const _l=new bme;function wme(n){const e=n.toLowerCase().replace(/[^a-z]/g,"");if(e.length===0||e.length<=2)return 1;const t={the:1,love:1,have:1,give:1,live:1,come:1,some:1,done:1,gone:1,one:1,were:1,where:1,there:1,here:1,fire:1,hire:1,wire:1,tire:1,like:1,time:1,life:1,wife:1,make:1,take:1,wake:1,sake:1,eye:1,dye:1,bye:1,rye:1,being:2,doing:2,going:2,seeing:2,every:2,different:3,beautiful:4,heaven:2,seven:2,even:2,over:2,ever:2,never:2,only:2,lonely:2,away:2,today:2,okay:2,maybe:2,baby:2,crazy:2,lazy:2,really:2,finally:3,usually:4,everything:3,anything:3,something:2,nothing:2,"i'm":1,"you're":1,"we're":1,"they're":1,"don't":1,"won't":1,"can't":1,"isn't":2,"wasn't":2,"weren't":1,"hasn't":2,"haven't":2,"i'll":1,"you'll":1,"we'll":1,"he'll":1,"she'll":1,"i've":1,"you've":1,"we've":1,"they've":1,"i'd":1,"you'd":1,"we'd":1,"he'd":1,"she'd":1,"let's":1,"that's":1,"what's":1,"it's":1,gonna:2,wanna:2,gotta:2,kinda:2,sorta:2};if(t[e]!==void 0)return t[e];let s=0;const r="aeiouy";let i=!1;for(let o=0;o<e.length;o++){const a=e[o],l=r.includes(a);l&&!i&&s++,i=l}if(e.endsWith("e")&&s>1){const o=e[e.length-2];o&&!"aeiou".includes(o)&&s--}if(e.endsWith("le")&&e.length>2){const o=e[e.length-3];o&&!"aeiou".includes(o)&&s++}return e.endsWith("ed")&&e.length>2&&e[e.length-3],Math.max(1,s)}function kme(n){const e=n.toLowerCase().replace(/[^a-z]/g,"");if(e.length===0)return 1;const t="aeiou";let s=0,r=0;for(const a of e)t.includes(a)?s++:r++;return(s*1.5+r*.5)/e.length/.9}function Cme(n,e,t){const s=n.toLowerCase().replace(/[^a-z]/g,"");if(e||t)return!0;const r=["a","e","i","o","ay","ey","ow","oo","ee","ie","ue"];for(const o of r)if(s.endsWith(o))return!0;return!!["oh","yeah","hey","no","so","go","know","you","me","we","be","see","free"].includes(s)}function Sme(n,e){switch(n.trim().slice(-1)){case".":case"!":case"?":return e*4;case",":case";":return e*2.5;case":":return e*2;case"-":case"":return e*1.5;case"...":return e*3;default:return e}}function Nme(n){return Math.max(120,n*150)}const gx={minMsPerSyllable:150,baseWordGap:40,heldWordMultiplier:1.4,useVowelWeighting:!0};function ok(n,e,t,s=gx){const r=n.trim().split(/\s+/);if(r.length===0)return[];const i=r.map((p,g)=>{const x=p.replace(/[^a-zA-Z'']/g,""),y=wme(x),b=s.useVowelWeighting?kme(x):1,k=g===r.length-1,w=/[,;:!?.-]$/.test(p),N=Cme(x,k,w),C=k?0:Sme(p,s.baseWordGap);return{word:p,syllables:y,weight:b,isHeld:N,pauseAfter:C,duration:0,startTime:0,endTime:0}});let o=0;for(const p of i){let g=p.syllables*p.weight;p.isHeld&&(g*=s.heldWordMultiplier),o+=g}const a=i.reduce((p,g)=>p+g.pauseAfter,0),u=Math.max(t-a,t*.7)/o;let d=e;for(const p of i){let g=p.syllables*p.weight;p.isHeld&&(g*=s.heldWordMultiplier);let x=g*u;const y=Nme(p.syllables);x=Math.max(x,y),p.startTime=d,p.duration=x,p.endTime=d+x,d=p.endTime+p.pauseAfter}const f=i[i.length-1];if(f&&f.endTime>e+t){const p=f.endTime-(e+t),g=f.endTime-e,x=(g-p)/g;d=e;for(const y of i)y.startTime=d,y.duration*=x,y.pauseAfter*=x,y.endTime=d+y.duration,d=y.endTime+y.pauseAfter}return i}function xp(n){const e=/(\d{2}):(\d{2})\.(\d{2,3})/.exec(n);if(!e||!e[1]||!e[2]||!e[3])return-1;const t=parseInt(e[1],10),s=parseInt(e[2],10);let r=parseInt(e[3],10);return e[3].length===2&&(r*=10),(t*60+s)*1e3+r}function Ime(n){const e=/(\d{2}):(\d{2}):(\d{2}),(\d{3})/.exec(n);if(!e||!e[1]||!e[2]||!e[3]||!e[4])return-1;const t=parseInt(e[1],10),s=parseInt(e[2],10),r=parseInt(e[3],10),i=parseInt(e[4],10);return(t*3600+s*60+r)*1e3+i}function Tme(n){const e=n.split(`
`).slice(0,20);return e.some(t=>/^\d+$/.test(t.trim()))&&e.some(t=>t.includes("-->"))?"srt":e.some(t=>/<\d{2}:\d{2}\.\d{2,3}>/.test(t))?"elrc":e.some(t=>/^\[\d{2}:\d{2}\.\d{2,3}\]/.test(t))||e.some(t=>/^\[(ar|ti|al|au|by|offset|length):/i.test(t))?"lrc":"plain"}function $me(n,e){const t=[],s=[],r=/^\[(\d{2}:\d{2}\.\d{2,3})\](.*)$/,i=/<(\d{2}:\d{2}\.\d{2,3})>([^<]*)/g,o=n.split(`
`);for(let a=0;a<o.length;a++){const l=o[a];if(!l)continue;const u=l.trim(),d=r.exec(u);if(!d||!d[1]||!d[2])continue;const f=xp(d[1]),p=d[2];if(/<\d{2}:\d{2}\.\d{2,3}>/.test(p)){const x=[];let y="",b,k=0;for(i.lastIndex=0;(b=i.exec(p))!==null;){if(!b[1]||!b[2])continue;const w=xp(b[1]),N=b[2].trim();if(N){y+=(y?" ":"")+N;const C=i.exec(p);let S;if(C&&C[1])S=xp(C[1]),i.lastIndex=b.index+b[0].length;else{const T=o.slice(a+1).find(A=>A&&r.test(A.trim()));if(T){const A=r.exec(T.trim());A&&A[1]?S=xp(A[1]):S=w+1e3}else S=e||w+1e3}x.push({word:N,startTime:w,endTime:S,lineIndex:t.length,wordIndex:k++})}}t.push({time:f,text:y}),s.push({time:f,text:y,words:x})}else{const x=p.replace(/<[^>]+>/g,"").trim();t.push({time:f,text:x}),s.push({time:f,text:x,words:[]})}}t.sort((a,l)=>a.time-l.time),s.sort((a,l)=>a.time-l.time);for(let a=0;a<s.length;a++){const l=s[a];if(l&&l.words.length===0&&l.text.trim()){const u=s[a+1],d=u?u.time:e||l.time+5e3,f=Math.min(d-l.time,1e4),p=ok(l.text,l.time,f,gx);l.words=p.map((g,x)=>({word:g.word,startTime:g.startTime,endTime:g.endTime,lineIndex:a,wordIndex:x}))}}return{format:"elrc",lines:t,linesWithWords:s,hasNativeWordTiming:!0}}function Eme(n,e){var i;const t=[],s=/\[(\d{2}):(\d{2})\.(\d{2,3})\](.*)$/;for(const o of n.split(`
`)){const a=s.exec(o.trim());if(a&&a[1]&&a[2]&&a[3]){const l=parseInt(a[1],10),u=parseInt(a[2],10);let d=parseInt(a[3],10);a[3].length===2&&(d*=10);const f=((i=a[4])==null?void 0:i.trim())??"",p=(l*60+u)*1e3+d;t.push({time:p,text:f})}}t.sort((o,a)=>o.time-a.time);const r=t.map((o,a)=>{const l=t[a+1],u=l?l.time:e||o.time+5e3,d=Math.min(u-o.time,1e4);if(!o.text.trim())return{...o,words:[]};const f=ok(o.text,o.time,d,gx);return{...o,words:f.map((p,g)=>({word:p.word,startTime:p.startTime,endTime:p.endTime,lineIndex:a,wordIndex:g}))}});return{format:"lrc",lines:t,linesWithWords:r,hasNativeWordTiming:!1}}function Ame(n,e){const t=[],s=n.split(/\n\s*\n/);for(const i of s){const o=i.trim().split(`
`);if(o.length<2)continue;const a=o.findIndex(g=>g.includes("-->"));if(a===-1)continue;const l=o[a];if(!l)continue;const u=/(\d{2}:\d{2}:\d{2},\d{3})\s*-->\s*(\d{2}:\d{2}:\d{2},\d{3})/.exec(l);if(!u||!u[1]||!u[2])continue;const d=Ime(u[1]),p=o.slice(a+1).join(" ").replace(/<[^>]+>/g,"").replace(/\{[^}]+\}/g,"").trim();p&&t.push({time:d,text:p})}t.sort((i,o)=>i.time-o.time);const r=t.map((i,o)=>{const a=t[o+1],l=a?a.time:e||i.time+5e3,u=Math.min(l-i.time,1e4);if(!i.text.trim())return{...i,words:[]};const d=ok(i.text,i.time,u,gx);return{...i,words:d.map((f,p)=>({word:f.word,startTime:f.startTime,endTime:f.endTime,lineIndex:o,wordIndex:p}))}});return{format:"srt",lines:t,linesWithWords:r,hasNativeWordTiming:!1}}function jme(n){const t=n.split(`
`).filter(s=>s.trim()).map(s=>({time:-1,text:s.trim()}));return{format:"plain",lines:t,linesWithWords:t.map(s=>({...s,words:[]})),hasNativeWordTiming:!1}}function nT(n,e){if(!n||!n.trim())return{format:"unknown",lines:[],linesWithWords:[],hasNativeWordTiming:!1};switch(Tme(n)){case"elrc":return $me(n,e);case"lrc":return Eme(n,e);case"srt":return Ame(n,e);case"plain":default:return jme(n)}}function sT(n,e){if(n.length===0)return-1;for(let s=0;s<n.length;s++){const r=n[s];if(r&&e>=r.startTime&&e<r.endTime)return s}const t=n[n.length-1];return t&&e>=t.endTime?n.length-1:-1}function rT(n,e){if(n.length===0)return-1;let t=0,s=n.length-1,r=-1;for(;t<=s;){const i=Math.floor((t+s)/2),o=n[i];o&&o.time<=e?(r=i,t=i+1):s=i-1}return r}const Wc=An((n,e)=>({lyrics:null,plainLyrics:null,currentLineIndex:-1,nextLineIndex:-1,isLoading:!1,error:null,currentTrackId:null,offset:0,lyricsFormat:null,hasNativeWordTiming:!1,singAlongEnabled:!1,linesWithWords:null,currentWordIndex:-1,fetchLyrics:async(t,s,r)=>{var i,o;if(!(e().currentTrackId===r&&e().lyrics)){n({isLoading:!0,error:null,lyrics:null,plainLyrics:null,currentTrackId:r});try{const a=await _l.get(r);if(a&&(a.lyrics||a.plainLyrics)){console.log("[LyricsStore] Cache hit - instant load"),n({lyrics:a.lyrics,linesWithWords:a.linesWithWords,plainLyrics:a.plainLyrics,isLoading:!1,currentLineIndex:-1,currentWordIndex:-1});return}let l=null;if((o=(i=window.api)==null?void 0:i.lyrics)!=null&&o.search)try{const u=await window.api.lyrics.search(t,s);u&&(l=u)}catch(u){console.log("[LyricsStore] Lyrics search failed:",u),n({isLoading:!1,error:"No lyrics provider available"});return}else{n({isLoading:!1,error:"No lyrics provider installed"});return}if(!l){n({isLoading:!1,error:"No lyrics available"});return}if(l.syncedLyrics){const u=l.duration?l.duration*1e3:void 0,d=nT(l.syncedLyrics,u);console.log(`[LyricsStore] Parsed ${d.format} format, native word timing: ${d.hasNativeWordTiming}`),_l.set({id:r,artist:t,title:s,syncedLyrics:l.syncedLyrics,plainLyrics:l.plainLyrics||null,lyrics:d.lines,linesWithWords:d.linesWithWords,duration:l.duration||null}).catch(f=>console.warn("[LyricsStore] Cache write failed:",f)),n({lyrics:d.lines,linesWithWords:d.linesWithWords,lyricsFormat:d.format,hasNativeWordTiming:d.hasNativeWordTiming,plainLyrics:l.plainLyrics||null,isLoading:!1,currentLineIndex:-1,currentWordIndex:-1})}else l.plainLyrics?(_l.set({id:r,artist:t,title:s,syncedLyrics:null,plainLyrics:l.plainLyrics,lyrics:null,linesWithWords:null,duration:l.duration||null}).catch(u=>console.warn("[LyricsStore] Cache write failed:",u)),n({lyrics:null,plainLyrics:l.plainLyrics,lyricsFormat:"plain",hasNativeWordTiming:!1,isLoading:!1})):n({isLoading:!1,error:"No lyrics available"})}catch(a){n({isLoading:!1,error:a instanceof Error?a.message:"Failed to fetch lyrics"})}}},prefetchLyrics:async(t,s,r)=>{var o,a;if(await _l.has(r)){console.log("[LyricsStore] Prefetch skipped - already cached");return}try{if(!((a=(o=window.api)==null?void 0:o.lyrics)!=null&&a.search))return;console.log("[LyricsStore] Prefetching lyrics in background...");const l=await window.api.lyrics.search(t,s);if(l!=null&&l.syncedLyrics){const u=l.duration?l.duration*1e3:void 0,d=nT(l.syncedLyrics,u);await _l.set({id:r,artist:t,title:s,syncedLyrics:l.syncedLyrics,plainLyrics:l.plainLyrics||null,lyrics:d.lines,linesWithWords:d.linesWithWords,duration:l.duration||null}),console.log(`[LyricsStore] Prefetch complete (${d.format}) - cached for instant load`)}else l!=null&&l.plainLyrics&&(await _l.set({id:r,artist:t,title:s,syncedLyrics:null,plainLyrics:l.plainLyrics,lyrics:null,linesWithWords:null,duration:l.duration||null}),console.log("[LyricsStore] Prefetch complete (plain lyrics)"))}catch(l){console.log("[LyricsStore] Prefetch failed (silent):",l)}},updateCurrentLine:t=>{const{lyrics:s,offset:r}=e();if(!s)return;const i=t+r,o=rT(s,i),{currentLineIndex:a}=e(),l=o<s.length-1?o+1:-1;o!==a&&n({currentLineIndex:o,nextLineIndex:l})},clearLyrics:()=>{n({lyrics:null,plainLyrics:null,linesWithWords:null,lyricsFormat:null,hasNativeWordTiming:!1,currentLineIndex:-1,nextLineIndex:-1,currentWordIndex:-1,error:null,currentTrackId:null})},seekToLine:t=>{const{lyrics:s,offset:r}=e();if(!s||t<0||t>=s.length)return 0;const i=s[t];return i?Math.max(0,i.time-r):0},setOffset:t=>{n({offset:t})},adjustOffset:t=>{n(s=>({offset:s.offset+t}))},resetOffset:()=>{n({offset:0})},setSingAlongEnabled:t=>{n({singAlongEnabled:t})},updateCurrentWord:t=>{const{linesWithWords:s,currentLineIndex:r,offset:i,singAlongEnabled:o}=e();if(!o||!s||r<0){e().currentWordIndex!==-1&&n({currentWordIndex:-1});return}const a=s[r];if(!a||!a.words.length){e().currentWordIndex!==-1&&n({currentWordIndex:-1});return}const l=t+i,u=sT(a.words,l);u!==e().currentWordIndex&&n({currentWordIndex:u})},getWordTimingsForLine:t=>{var r;const{linesWithWords:s}=e();return!s||t<0||t>=s.length?[]:((r=s[t])==null?void 0:r.words)??[]},updatePositionAtomic:t=>{const{lyrics:s,linesWithWords:r,offset:i,singAlongEnabled:o}=e();if(!s)return;const a=t+i,l=rT(s,a),u=l<s.length-1?l+1:-1;let d=-1;if(o&&r&&l>=0){const f=r[l];f!=null&&f.words.length&&(d=sT(f.words,a))}n({currentLineIndex:l,nextLineIndex:u,currentWordIndex:d})}})),Rme="audiio-translations",Dme=1,Gn="translations",iT=30;class Pme{constructor(){Mt(this,"db",null);Mt(this,"initPromise",null)}async initialize(){if(!this.db)return this.initPromise?this.initPromise:(this.initPromise=new Promise((e,t)=>{const s=indexedDB.open(Rme,Dme);s.onerror=()=>{console.error("Failed to open translation cache:",s.error),t(s.error)},s.onsuccess=()=>{this.db=s.result,e()},s.onupgradeneeded=r=>{const i=r.target.result;if(!i.objectStoreNames.contains(Gn)){const o=i.createObjectStore(Gn,{keyPath:"id"});o.createIndex("trackId","trackId",{unique:!1}),o.createIndex("createdAt","createdAt",{unique:!1})}}}),this.initPromise)}async ensureDb(){if(await this.initialize(),!this.db)throw new Error("Translation cache not initialized");return this.db}generateId(e,t){return`${e}-${t}`}async getTranslation(e,t){const s=await this.ensureDb();return new Promise((r,i)=>{const l=s.transaction(Gn,"readonly").objectStore(Gn).get(this.generateId(e,t));l.onerror=()=>i(l.error),l.onsuccess=()=>{const u=l.result;u&&!this.isExpired(u.createdAt)?r(u.translatedText):r(null)}})}async getBatchTranslations(e){const t=await this.ensureDb(),s=new Map;return new Promise((r,i)=>{const u=t.transaction(Gn,"readonly").objectStore(Gn).index("trackId").openCursor(IDBKeyRange.only(e));u.onerror=()=>i(u.error),u.onsuccess=()=>{const d=u.result;if(d){const f=d.value;this.isExpired(f.createdAt)||s.set(f.lineIndex,f.translatedText),d.continue()}else r(s)}})}async setTranslation(e,t,s,r,i,o="en",a="libre-translate"){const l=await this.ensureDb(),u={id:this.generateId(e,t),trackId:e,lineIndex:t,originalText:s,translatedText:r,sourceLanguage:i,targetLanguage:o,createdAt:Date.now(),provider:a};return new Promise((d,f)=>{const x=l.transaction(Gn,"readwrite").objectStore(Gn).put(u);x.onerror=()=>f(x.error),x.onsuccess=()=>d()})}async setBatchTranslations(e){const t=await this.ensureDb();return new Promise((s,r)=>{const i=t.transaction(Gn,"readwrite"),o=i.objectStore(Gn);i.onerror=()=>r(i.error),i.oncomplete=()=>s();for(const a of e){const l={...a,id:this.generateId(a.trackId,a.lineIndex),createdAt:Date.now()};o.put(l)}})}async hasTrack(e){return(await this.getBatchTranslations(e)).size>0}async clearTrack(e){const t=await this.ensureDb();return new Promise((s,r)=>{const l=t.transaction(Gn,"readwrite").objectStore(Gn).index("trackId").openCursor(IDBKeyRange.only(e));l.onerror=()=>r(l.error),l.onsuccess=()=>{const u=l.result;u?(u.delete(),u.continue()):s()}})}async clearAll(){const e=await this.ensureDb();return new Promise((t,s)=>{const o=e.transaction(Gn,"readwrite").objectStore(Gn).clear();o.onerror=()=>s(o.error),o.onsuccess=()=>t()})}async clearExpired(){const e=await this.ensureDb(),t=Date.now()-iT*24*60*60*1e3;let s=0;return new Promise((r,i)=>{const u=e.transaction(Gn,"readwrite").objectStore(Gn).index("createdAt").openCursor(IDBKeyRange.upperBound(t));u.onerror=()=>i(u.error),u.onsuccess=()=>{const d=u.result;d?(d.delete(),s++,d.continue()):r(s)}})}async getCacheStats(){const e=await this.ensureDb();return new Promise((t,s)=>{const r=e.transaction(Gn,"readonly"),i=r.objectStore(Gn),o=i.count();let a=0,l=null;o.onsuccess=()=>{a=o.result};const d=i.index("createdAt").openCursor();d.onsuccess=()=>{const f=d.result;f&&l===null&&(l=f.value.createdAt)},r.oncomplete=()=>t({entries:a,oldestEntry:l}),r.onerror=()=>s(r.error)})}isExpired(e){const t=iT*24*60*60*1e3;return Date.now()-e>t}async close(){this.db&&(this.db.close(),this.db=null,this.initPromise=null)}}const Hi=new Pme,kM=/[\u3040-\u309F]/,CM=/[\u30A0-\u30FF]/,SM=/[\u4E00-\u9FFF]/,NM=/[\uAC00-\uD7AF]/,IM=/[\u1100-\u11FF]/,TM=/[\u0400-\u04FF]/,Mme=/[]/i,$M=/\b(el|la|los|las|de|que|es|en|un|una|por|con|para|como|pero|su|sus|del|al|yo|tu|mi|te|me|se|nos|muy|ms|tambin|sin|sobre|todo|porque|cuando|donde|qu|cmo|s|ya|as|aqu|ahora|siempre|nunca|nada|algo|cada|otro|misma|bien|mal|mucho|poco)\b/i,Lme=/[]/i,EM=/\b(le|la|les|de|du|des|un|une|et|est|en|que|qui|pour|dans|ce|cette|pas|sur|avec|plus|tout|tous|bien|mais|ou|o|si|non|oui|je|tu|il|elle|nous|vous|ils|elles|mon|ma|mes|ton|ta|tes|son|sa|ses|notre|votre|leur|comme|quand|trs|aussi|mme|ici|l|encore|toujours|jamais|rien|quelque|autre|aprs|avant|entre|sans)\b/i,Fme=/[]/i,AM=/\b(der|die|das|den|dem|des|ein|eine|einer|eines|und|ist|in|zu|nicht|mit|auf|fr|von|an|bei|als|nach|aus|es|sich|auch|so|wie|aber|oder|wenn|nur|noch|mehr|schon|immer|wieder|kann|muss|will|soll|werden|wurde|haben|hat|sein|sind|war|wir|ihr|sie|er|ich|du|mein|dein|sein|ihr|unser|euer)\b/i,Ome=/[]/i,jM=/\b(o|a|os|as|de|da|do|das|dos|em|na|no|nas|nos|um|uma|uns|umas|que||est|so|para|com|por|como|mas|ou|se|no|sim|eu|tu|ele|ela|ns|vs|eles|elas|meu|minha|teu|tua|seu|sua|nosso|nossa|mais|muito|bem|quando|onde|aqui|l|agora|sempre|nunca|tudo|nada|algo|cada|outro|outra|mesmo|ainda|j)\b/i,_me=/[]/i,RM=/\b(il|lo|la|i|gli|le|di|del|della|dei|delle|da|dal|dalla|in|nel|nella|un|uno|una|e||che|per|con|su|come|ma|se|non|s|io|tu|lui|lei|noi|voi|loro|mio|mia|tuo|tua|suo|sua|nostro|nostra|vostro|vostra|pi|molto|bene|quando|dove|qui|adesso|sempre|mai|tutto|nulla|qualcosa|ogni|altro|altra|stesso|stessa|ancora|gi)\b/i,zme=/\b(|||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||)\b/i,Bme=5,oT=3,Wme=/\b(the|and|is|are|was|were|be|been|being|have|has|had|do|does|did|will|would|could|should|can|may|might|must|shall|a|an|to|of|in|for|on|with|at|by|from|as|into|through|during|before|after|above|below|between|under|again|further|then|once|here|there|when|where|why|how|all|each|few|more|most|other|some|such|no|nor|not|only|own|same|so|than|too|very|just|also|now|i|you|he|she|it|we|they|me|him|her|us|them|my|your|his|its|our|their|this|that|these|those|what|which|who|whom|whose|am|oh|yeah|baby|love|know|want|need|feel|think|say|said|like|got|get|go|come|make|take|see|look|give|find|tell|ask|use|seem|try|leave|call|keep|let|begin|show|hear|play|run|move|live|believe|hold|bring|happen|write|sit|stand|lose|pay|meet|include|continue|set|learn|change|lead|understand|watch|follow|stop|create|speak|read|allow|add|spend|grow|open|walk|win|offer|remember|consider|appear|buy|wait|serve|die|send|expect|build|stay|fall|cut|reach|kill|remain|suggest|raise|pass|sell|require|report|decide|pull)\b/gi;function Vme(n){const e=n.filter(r=>r.trim().length>0).slice(0,Bme);if(e.length===0)return null;const t=e.join(" "),s=DM(t);return s.confidence<.3?null:s.language}function Ume(n){return{ja:"Japanese",ko:"Korean",zh:"Chinese",es:"Spanish",fr:"French",de:"German",pt:"Portuguese",it:"Italian",ru:"Russian"}[n]}function DM(n){const e={japanese:0,korean:0,chinese:0,russian:0,spanish:0,french:0,german:0,portuguese:0,italian:0},t=n.match(new RegExp(kM.source,"g"))||[],s=n.match(new RegExp(CM.source,"g"))||[];e.japanese=t.length+s.length;const r=n.match(new RegExp(SM.source,"g"))||[];e.japanese>0?e.japanese+=r.length:r.length>0&&(e.chinese=r.length);const i=n.match(new RegExp(NM.source,"g"))||[],o=n.match(new RegExp(IM.source,"g"))||[];e.korean=i.length+o.length;const a=n.match(new RegExp(TM.source,"g"))||[];if(a.length>0){const x=n.match(zme)||[];e.russian=a.length+x.length*2}if(!(e.japanese>0||e.korean>0||e.chinese>0||e.russian>0)){const x=n.match(Mme)||[],y=n.match($M)||[];e.spanish=x.length*3+y.length*2;const b=n.match(Lme)||[],k=n.match(EM)||[];e.french=b.length*3+k.length*2;const w=n.match(Fme)||[],N=n.match(AM)||[];e.german=w.length*3+N.length*2;const C=n.match(Ome)||[],S=n.match(jM)||[];e.portuguese=C.length*3+S.length*2;const T=n.match(_me)||[],A=n.match(RM)||[];e.italian=T.length*3+A.length*2}const d=Object.values(e).reduce((x,y)=>x+y,0);if(d<oT)return{language:null,confidence:0,scriptCounts:e};if(e.japanese>0&&e.korean===0)return{language:"ja",confidence:e.japanese/Math.max(d,n.length*.1),scriptCounts:e};if(e.korean>0&&e.japanese===0)return{language:"ko",confidence:e.korean/Math.max(d,n.length*.1),scriptCounts:e};if(e.chinese>0)return{language:"zh",confidence:e.chinese/Math.max(d,n.length*.1),scriptCounts:e};if(e.russian>0)return{language:"ru",confidence:e.russian/Math.max(d,n.length*.1),scriptCounts:e};const f=[["es",e.spanish],["fr",e.french],["de",e.german],["pt",e.portuguese],["it",e.italian]],[p,g]=f.reduce((x,y)=>y[1]>x[1]?y:x);return g>=oT&&(n.match(/[a-zA-Z]/g)||[]).length>n.length*.4?{language:p,confidence:Math.min(g/15,1),scriptCounts:e}:{language:null,confidence:0,scriptCounts:e}}function Gme(n){if(!n||n.trim().length===0)return!0;if(kM.test(n)||CM.test(n)||SM.test(n)||NM.test(n)||IM.test(n)||TM.test(n))return!1;const e=n.match(Wme)||[],t=n.split(/\s+/).filter(o=>o.length>1);if(t.length===0||e.length/t.length>.3)return!0;const r=n.match(/[a-zA-Z]/g)||[],i=n.match(/[^a-zA-Z0-9\s.,!?'"()-]/g)||[];return r.length>0&&i.length===0&&!($M.test(n)||EM.test(n)||AM.test(n)||jM.test(n)||RM.test(n))}function Dp(n){return n.map((e,t)=>{if(!e||e.trim().length===0)return{lineIndex:t,language:null,needsTranslation:!1,isEnglish:!0,confidence:1};if(Gme(e))return{lineIndex:t,language:null,needsTranslation:!1,isEnglish:!0,confidence:.8};const r=DM(e);return{lineIndex:t,language:r.language,needsTranslation:r.language!==null,isEnglish:!1,confidence:r.confidence}})}function aT(n){const e=Dp(n),t={};for(const i of e)i.language&&(t[i.language]=(t[i.language]||0)+1);let s=null,r=0;for(const[i,o]of Object.entries(t))o>r&&(r=o,s=i);return s}var yT;const lT=typeof window<"u"&&"api"in window&&typeof((yT=window.api)==null?void 0:yT.translateText)=="function",cT=5,Hme=50;class qme{async translate(e,t,s="en"){if(lT){const r=await window.api.translateText(e,t,s);if(r.success&&r.translatedText)return r.translatedText;throw new Error(r.error||"Translation failed")}throw new Error("Translation requires Electron - not available in browser dev mode")}async translateBatch(e,t,s="en",r){const i=new Array(e.length).fill(""),o=e.length;let a=0;const l=[];for(let f=0;f<e.length;f++){const p=e[f];p&&p.trim().length>0?l.push({index:f,text:p}):a++}r==null||r(a,o);const u=async f=>{try{const p=await this.translate(f.text,t,s);i[f.index]=p}catch(p){console.warn(`[Translation] Failed for line ${f.index}:`,p),i[f.index]=""}a++,r==null||r(a,o)},d=[];for(let f=0;f<l.length;f+=cT)d.push(l.slice(f,f+cT));for(const f of d)await Promise.all(f.map(u)),d.indexOf(f)<d.length-1&&await this.sleep(Hme);return i}isAvailable(){return lT}sleep(e){return new Promise(t=>setTimeout(t,e))}}const Kme=new qme;class Qme{constructor(){Mt(this,"initialized",!1)}async initialize(){if(this.initialized)return;await Hi.initialize();const e=await Hi.clearExpired();e>0&&console.log(`Translation cache: cleaned ${e} expired entries`),this.initialized=!0}async translateLyrics(e,t,s){await this.initialize();const r=t.map(y=>y.text),o=Dp(r).filter(y=>y.needsTranslation&&y.language!==null);if(o.length===0)return console.log("[Translation] No non-English lines detected, skipping translation"),null;const a=aT(r);if(!a)return null;console.log(`[Translation] Detected ${o.length}/${t.length} non-English lines`);const l=await Hi.getBatchTranslations(e),u=new Map(l);let d=0;for(const y of o)l.has(y.lineIndex)&&d++;if(d===o.length)return{translations:u,sourceLanguage:a,fromCache:!0,linesTranslated:0,linesCached:d};const f=[];for(const y of o){const b=t[y.lineIndex];b&&!l.has(y.lineIndex)&&b.text.trim().length>0&&f.push({index:y.lineIndex,text:b.text,language:y.language})}if(f.length===0)return{translations:u,sourceLanguage:a,fromCache:!0,linesTranslated:0,linesCached:d};const p=new Map;for(const y of f){const b=p.get(y.language)||[];b.push(y),p.set(y.language,b)}let g=0;const x=f.length;for(const[y,b]of p){const k=b.map(N=>N.text);console.log(`[Translation] Translating ${b.length} lines from ${y}`);const w=await Kme.translateBatch(k,y,"en",(N,C)=>{const S=(d+g+N)/(d+x)*100;s==null||s(Math.round(S))});for(let N=0;N<b.length;N++){const C=b[N],S=w[N];if(C&&S&&S.length>0){const T=t[C.index];T&&(u.set(C.index,S),g++,await Hi.setTranslation(e,C.index,T.text,S,y))}}}return s==null||s(100),{translations:u,sourceLanguage:a,fromCache:!1,linesTranslated:g,linesCached:d}}shouldTranslate(e){const t=e.map(r=>r.text);return Dp(t).some(r=>r.needsTranslation)}detectLanguage(e){const t=e.map(s=>s.text);return aT(t)}analyzeLineLanguages(e){const t=e.map(s=>s.text);return Dp(t)}async getCachedTranslations(e){await this.initialize();const t=await Hi.getBatchTranslations(e);return t.size>0?t:null}async hasCachedTranslations(e){return await this.initialize(),Hi.hasTrack(e)}async clearTrackTranslations(e){await this.initialize(),await Hi.clearTrack(e)}async clearAllTranslations(){await this.initialize(),await Hi.clearAll()}async getCacheStats(){return await this.initialize(),Hi.getCacheStats()}}const K0=new Qme,uT=An()(Er((n,e)=>({translationEnabled:!1,currentTrackId:null,translations:new Map,sourceLanguage:null,isDetecting:!1,isTranslating:!1,translationProgress:0,error:null,setTranslationEnabled:t=>{n({translationEnabled:t})},translateLyrics:async(t,s)=>{const r=e();if(!(r.currentTrackId===t&&r.translations.size>0)){n({currentTrackId:t,translations:new Map,sourceLanguage:null,isDetecting:!0,isTranslating:!1,translationProgress:0,error:null});try{const i=K0.detectLanguage(s);if(!i){n({isDetecting:!1,sourceLanguage:null});return}n({isDetecting:!1,sourceLanguage:i,isTranslating:!0});const o=await K0.translateLyrics(t,s,a=>{n({translationProgress:a})});n(o?{translations:o.translations,isTranslating:!1,translationProgress:100}:{isTranslating:!1,error:"Translation failed"})}catch(i){console.error("Translation error:",i),n({isDetecting:!1,isTranslating:!1,error:i instanceof Error?i.message:"Translation failed"})}}},clearTranslations:()=>{n({currentTrackId:null,translations:new Map,sourceLanguage:null,isDetecting:!1,isTranslating:!1,translationProgress:0,error:null})},getTranslation:t=>e().translations.get(t),detectLanguage:t=>K0.detectLanguage(t)}),{name:"audiio-translation-settings",partialize:n=>({translationEnabled:n.translationEnabled}),storage:{getItem:n=>{const e=localStorage.getItem(n);if(!e)return null;const t=JSON.parse(e);return{state:{...t.state,currentTrackId:null,translations:new Map,sourceLanguage:null,isDetecting:!1,isTranslating:!1,translationProgress:0,error:null},version:t.version}},setItem:(n,e)=>{localStorage.setItem(n,JSON.stringify(e))},removeItem:n=>{localStorage.removeItem(n)}}}));function ak(){const{lyrics:n,plainLyrics:e,currentLineIndex:t,nextLineIndex:s,offset:r,seekToLine:i,adjustOffset:o,resetOffset:a}=Wc(),{translationEnabled:l,translations:u,sourceLanguage:d,isTranslating:f,translationProgress:p,error:g,currentTrackId:x,setTranslationEnabled:y,translateLyrics:b,clearTranslations:k}=uT(),w=Ke(T=>T.currentTrack),N=(w==null?void 0:w.id)??null;j.useEffect(()=>{!l||!n||!N||(N!==x||u.size===0)&&(console.log("[Translation] Starting translation for track:",N),b(N,n))},[l,n,N,x,u.size,b]),j.useEffect(()=>{if(n&&n.length>0){const T=uT.getState().detectLanguage(n);console.log("[Translation] Language detected:",T||"none (probably English)")}},[n]),j.useEffect(()=>{N&&N!==x&&!l&&k()},[N,x,l,k]);const C=j.useMemo(()=>n?n.map((T,A)=>({...T,translation:l?u.get(A):void 0})):null,[n,u,l]),S=j.useCallback(()=>{const T=!l;y(T),T&&n&&N&&b(N,n)},[l,y,n,N,b]);return{lyrics:C,plainLyrics:e,currentLineIndex:t,nextLineIndex:s,translationEnabled:l,isTranslating:f,translationProgress:p,sourceLanguage:d,translationError:g,toggleTranslation:S,setTranslationEnabled:y,seekToLine:i,offset:r,adjustOffset:o,resetOffset:a}}const Jv=({compact:n=!1})=>{const{translationEnabled:e,isTranslating:t,translationProgress:s,sourceLanguage:r,toggleTranslation:i}=ak(),a=ii(g=>g.hasCapability("lyrics-provider")),l=Wc(g=>g.lyrics),u=j.useMemo(()=>{if(!a||!l||l.length===0)return null;const g=l.map(x=>x.text);return Vme(g)},[l,a]),d=r||u;if(!a||!d)return null;const f=Ume(d),p=e?`Hide ${f} translations`:`Translate ${f} to English`;return c.jsxs("button",{className:`translation-toggle ${n?"compact":""} ${e?"active":""}`,onClick:i,title:p,disabled:t,children:[c.jsx(H4,{size:n?14:16}),!n&&c.jsx("span",{className:"translation-toggle-label",children:t?`${s}%`:"Translate"}),t&&c.jsx("span",{className:"translation-progress-indicator"})]})},dT=800,hT=1500;function Xme(n,e){if(!n)return"none";const t=e?dT*.7:dT,s=e?hT*.8:hT;return n>=s?"held-long":n>=t?"held":"none"}const PM=j.memo(({word:n,state:e,isNext:t,duration:s,isLastInLine:r=!1})=>{const i=e==="active"&&s?{"--word-duration":`${s}ms`}:void 0,o=e==="active"?Xme(s,r):"none",a=["sal-word",`sal-word--${e}`,t&&"sal-word--next",o==="held"&&"sal-word--held",o==="held-long"&&"sal-word--held-long"].filter(Boolean).join(" "),l=e==="active"||e==="sung";return c.jsxs("span",{className:a,style:i,children:[c.jsx("span",{className:"sal-word__text",children:n}),l&&c.jsx("span",{className:"sal-word__fill",children:n})]})});PM.displayName="Word";const xx=j.memo(({words:n,currentWordIndex:e,isActive:t})=>n.length===0?null:c.jsx("div",{className:`sal-line ${t?"sal-line--active":""}`,children:n.map((s,r)=>{let i;r<e?i="sung":r===e?i="active":i="upcoming";const o=r===e+1,a=r===n.length-1,l=i==="active"?s.endTime-s.startTime:void 0;return c.jsxs(gt.Fragment,{children:[c.jsx(PM,{word:s.word,state:i,isNext:o,duration:l,isLastInLine:a}),r<n.length-1&&" "]},r)})}));xx.displayName="SingAlongLine";const MM=j.memo(({linesWithWords:n,currentLineIndex:e,currentWordIndex:t,onLineClick:s,showTranslations:r=!1})=>{const i=gt.useRef(null),o=gt.useRef(null);gt.useEffect(()=>{if(!o.current||!i.current)return;const l=i.current,u=o.current,d=l.clientHeight,f=u.offsetTop,p=u.clientHeight,g=f-d/2+p/2;l.scrollTo({top:Math.max(0,g),behavior:"smooth"})},[e]);const a=j.useCallback(l=>{s==null||s(l)},[s]);return c.jsx("div",{className:"sal-container",ref:i,children:c.jsx("div",{className:"sal-lyrics",children:n.map((l,u)=>{const d=u===e,f=u<e;let p;f?p="past":d?p="active":p="upcoming";const g=f?l.words.length:d?t:-1;return c.jsxs("div",{ref:d?o:null,className:`sal-lyrics__line sal-lyrics__line--${p}`,onClick:()=>a(u),children:[l.words.length>0?c.jsx(xx,{words:l.words,currentWordIndex:g,isActive:d}):c.jsx("span",{className:"sal-lyrics__instrumental",children:""}),r&&l.translation&&c.jsx("div",{className:"sal-lyrics__translation",children:l.translation})]},u)})})})});MM.displayName="SingAlongLyrics";const Yme=({onSeek:n,compact:e=!1})=>{const t=j.useRef(null),s=j.useRef(null),[r,i]=j.useState(!1),o=j.useRef(),{isLoading:a,error:l,singAlongEnabled:u,setSingAlongEnabled:d,currentWordIndex:f,getWordTimingsForLine:p}=Wc(),{position:g}=Ke(),{lyrics:x,plainLyrics:y,currentLineIndex:b,nextLineIndex:k,offset:w,seekToLine:N,adjustOffset:C,resetOffset:S,translationEnabled:T}=ak(),A=ii(P=>P.hasCapability("lyrics-provider")),E=j.useCallback(()=>{i(!0),o.current&&clearTimeout(o.current),o.current=setTimeout(()=>{i(!1)},3e3)},[]);j.useEffect(()=>{if(!r&&s.current&&t.current){const P=t.current,R=s.current,L=P.getBoundingClientRect(),_=R.getBoundingClientRect(),U=_.top-L.top+P.scrollTop-L.height*.4+_.height/2;P.scrollTo({top:Math.max(0,U),behavior:"smooth"})}},[b,r]),j.useEffect(()=>()=>{o.current&&clearTimeout(o.current)},[]);const M=j.useCallback(P=>{const R=N(P);R>=0&&n(R)},[N,n]);return A?a?c.jsxs("div",{className:"lyrics-display lyrics-loading",children:[c.jsx("div",{className:"lyrics-loading-spinner"}),c.jsx("span",{children:"Loading lyrics..."})]}):l?c.jsx("div",{className:"lyrics-display lyrics-error",children:c.jsx("span",{children:l})}):x&&x.length>0?c.jsxs("div",{className:`lyrics-display lyrics-synced ${e?"compact":""} ${u?"sing-along-mode":""}`,children:[!e&&c.jsxs("div",{className:"lyrics-controls",children:[c.jsxs("div",{className:"lyrics-offset-controls",children:[c.jsx("button",{className:"lyrics-offset-btn",onClick:()=>C(-200),title:"Lyrics earlier",children:c.jsx(XT,{size:16})}),c.jsx("span",{className:"lyrics-offset-label",onClick:S,title:"Click to reset",children:w===0?"Synced":`${w>0?"+":""}${w}ms`}),c.jsx("button",{className:"lyrics-offset-btn",onClick:()=>C(200),title:"Lyrics later",children:c.jsx(Fa,{size:16})})]}),c.jsx("button",{className:`lyrics-singalong-btn ${u?"active":""}`,onClick:()=>d(!u),title:u?"Disable Sing-Along":"Enable Sing-Along",children:c.jsx(nv,{size:16})}),c.jsx(Jv,{})]}),c.jsx("div",{className:"lyrics-scroll-container",ref:t,onScroll:E,children:c.jsx("div",{className:"lyrics-content",children:x.map((P,R)=>{const L=R===b,_=R<b,O=R===k,U=u?p(R):[];return c.jsxs("div",{ref:L?s:null,className:`lyrics-line ${L?"active":""} ${_?"past":""} ${O?"upcoming":""}`,onClick:()=>M(R),children:[u&&U.length>0?c.jsx(xx,{words:U,currentWordIndex:L?f:_?U.length:-1,isActive:L}):c.jsx("span",{className:"lyrics-line-original",children:P.text||""}),T&&P.translation&&c.jsx("span",{className:"lyrics-line-translation",children:P.translation})]},R)})})})]}):y?c.jsx("div",{className:`lyrics-display lyrics-plain ${e?"compact":""}`,ref:t,children:c.jsx("div",{className:"lyrics-content",children:y.split(`
`).map((P,R)=>c.jsx("div",{className:"lyrics-line plain",children:P||""},R))})}):c.jsx("div",{className:"lyrics-display lyrics-empty",children:c.jsx("span",{children:"No lyrics available"})}):c.jsxs("div",{className:"lyrics-display lyrics-disabled",children:[c.jsx(JT,{size:32}),c.jsx("span",{children:"Lyrics Disabled"})]})},Q0=new Map;async function Zme(n){return Q0.has(n)?Q0.get(n):new Promise(e=>{const t=new Image;t.crossOrigin="Anonymous",t.onload=()=>{try{const s=document.createElement("canvas"),r=s.getContext("2d");if(!r){e(Pp());return}const i=50;s.width=i,s.height=i,r.drawImage(t,0,0,i,i);const o=r.getImageData(0,0,i,i),a=Jme(o);Q0.set(n,a),e(a)}catch{e(Pp())}},t.onerror=()=>{e(Pp())},t.src=n})}function Jme(n){const{data:e}=n,t=new Map;for(let u=0;u<e.length;u+=16){const d=e[u],f=e[u+1],p=e[u+2];if(e[u+3]<128)continue;const x=Math.floor(d/32)*32,y=Math.floor(f/32)*32,b=Math.floor(p/32)*32,k=`${x},${y},${b}`,w=t.get(k);w?(w.r+=d,w.g+=f,w.b+=p,w.count++):t.set(k,{r:d,g:f,b:p,count:1})}const s=Array.from(t.values()).filter(u=>{const d=(u.r+u.g+u.b)/(3*u.count);return d>30&&d<220}).sort((u,d)=>d.count-u.count).map(u=>({r:Math.round(u.r/u.count),g:Math.round(u.g/u.count),b:Math.round(u.b/u.count),count:u.count}));if(s.length===0)return Pp();const r=s[0],i=s[Math.min(1,s.length-1)],o=ege(s)||s[Math.min(2,s.length-1)],l=(r.r*.299+r.g*.587+r.b*.114)/255<.5;return{primary:X0(r.r,r.g,r.b),secondary:X0(i.r,i.g,i.b),accent:X0(o.r,o.g,o.b),isDark:l}}function ege(n){let e=0,t=null;for(const s of n.slice(0,10)){const r=Math.max(s.r,s.g,s.b),i=Math.min(s.r,s.g,s.b),o=r===0?0:(r-i)/r;o>e&&o>.3&&(e=o,t=s)}return t}function X0(n,e,t){return"#"+[n,e,t].map(s=>s.toString(16).padStart(2,"0")).join("")}function Pp(){return{primary:"#1a1a2e",secondary:"#16213e",accent:"#1db954",isDark:!0}}const tge=()=>{var we,Pe,ue,Te,ke,ye,Ce,Ae,Be,mt;const n=j.useRef(null),e=j.useRef(null),t=j.useRef(null),[s,r]=j.useState(null),{currentTrack:i,isPlaying:o,position:a,duration:l,isLoading:u,shuffle:d,repeat:f,pause:p,resume:g,seek:x,next:y,previous:b,toggleShuffle:k,cycleRepeat:w}=Ke(),{playerMode:N,collapsePlayer:C,isLyricsVisible:S,toggleLyrics:T}=el(),{isLiked:A,toggleLike:E}=Xt(),{fetchLyrics:M,updateCurrentLine:P,updatePositionAtomic:R,singAlongEnabled:L,clearLyrics:_}=Wc(),{openAlbum:O,openArtist:U}=Wt(),W=i?A(i.id):!1,H=j.useCallback(()=>{var le,je;i!=null&&i.album&&(C(),O(i.album.id,{id:i.album.id,title:i.album.title,artist:((le=i.artists[0])==null?void 0:le.name)||"Unknown Artist",artwork:(je=i.album.artwork)==null?void 0:je.medium,source:i.source}))},[i,O,C]),G=j.useCallback(()=>{var je;const le=i==null?void 0:i.artists[0];le&&(C(),U(le.id,{id:le.id,name:le.name,image:(je=i==null?void 0:i.artwork)==null?void 0:je.medium,source:(i==null?void 0:i.source)||"unknown"}))},[i,U,C]);j.useEffect(()=>{var le;if(i&&N==="full"){const je=((le=i.artists[0])==null?void 0:le.name)||"";M(je,i.title,i.id)}},[i==null?void 0:i.id,N,M]),j.useEffect(()=>{N==="mini"&&_()},[N,_]),j.useEffect(()=>{var je,De,_e,it,St,cn;const le=((je=i==null?void 0:i.artwork)==null?void 0:je.large)??((De=i==null?void 0:i.artwork)==null?void 0:De.medium)??((it=(_e=i==null?void 0:i.album)==null?void 0:_e.artwork)==null?void 0:it.large)??((cn=(St=i==null?void 0:i.album)==null?void 0:St.artwork)==null?void 0:cn.medium);le&&N==="full"&&Zme(le).then(r)},[i==null?void 0:i.id,N]),j.useEffect(()=>{S&&(L?R(a):P(a))},[a,S,L,P,R]);const q=((we=i==null?void 0:i.artwork)==null?void 0:we.animated)??((ue=(Pe=i==null?void 0:i.album)==null?void 0:Pe.artwork)==null?void 0:ue.animated),Q=q==null?void 0:q.videoUrl;j.useEffect(()=>{const le=e.current;if(!le||!Q||N!=="full")return;const je=async()=>{if(t.current)try{await t.current}catch{}t.current=le.play();try{await t.current}catch(De){De.name!=="AbortError"&&console.error("Video playback failed:",De)}t.current=null};return le.readyState>=2?je():le.addEventListener("canplay",je,{once:!0}),()=>{le.removeEventListener("canplay",je)}},[Q,N]);const z=j.useRef(null),K=j.useRef(!1),Y=j.useCallback(le=>{if(!z.current)return;const je=z.current.getBoundingClientRect(),_e=Math.max(0,Math.min(1,(le-je.left)/je.width))*l;x(_e)},[l,x]),B=j.useCallback(le=>{K.current=!0,Y(le.clientX);const je=_e=>{K.current&&Y(_e.clientX)},De=()=>{K.current=!1,document.removeEventListener("mousemove",je),document.removeEventListener("mouseup",De)};document.addEventListener("mousemove",je),document.addEventListener("mouseup",De)},[Y]),J=le=>{const je=Math.floor(le/1e3),De=Math.floor(je/60),_e=je%60;return`${De}:${_e.toString().padStart(2,"0")}`};if(N!=="full"||!i)return null;const ae=l>0?a/l*100:0,pe=((Te=i.artwork)==null?void 0:Te.large)??((ke=i.artwork)==null?void 0:ke.medium)??((Ce=(ye=i.album)==null?void 0:ye.artwork)==null?void 0:Ce.large)??((Be=(Ae=i.album)==null?void 0:Ae.artwork)==null?void 0:Be.medium),ge=i.artists.map(le=>le.name).join(", "),he=!!Q;return c.jsxs("div",{className:"full-player",ref:n,children:[c.jsx("div",{className:"full-player-animated-bg",style:{"--bg-primary":(s==null?void 0:s.primary)||"#1a1a2e","--bg-secondary":(s==null?void 0:s.secondary)||"#16213e","--bg-accent":(s==null?void 0:s.accent)||"#1db954"}}),pe&&c.jsx("div",{className:"full-player-bg",style:{backgroundImage:`url(${pe})`}}),c.jsxs("header",{className:"full-player-header",children:[c.jsx("button",{className:"full-player-collapse",onClick:C,title:"Collapse (Esc)",children:c.jsx(Fa,{size:28})}),c.jsxs("div",{className:"full-player-header-info",children:[c.jsx("span",{className:"full-player-from",children:"Playing from"}),c.jsx("span",{className:`full-player-source ${i.album?"clickable":""}`,onClick:i.album?H:void 0,title:i.album?`Go to ${i.album.title}`:void 0,children:((mt=i.album)==null?void 0:mt.title)||"Unknown Album"})]}),c.jsx("button",{className:`full-player-lyrics-toggle ${S?"active":""}`,onClick:T,title:S?"Hide lyrics":"Show lyrics",children:c.jsx(xb,{size:22})})]}),c.jsxs("div",{className:`full-player-content ${S?"with-lyrics":""}`,children:[c.jsx("div",{className:"full-player-artwork-container",children:he&&q?c.jsx("video",{ref:e,className:"full-player-artwork full-player-video",src:q.videoUrl,poster:q.previewFrame||pe,loop:!0,muted:!q.hasAudio,playsInline:!0}):pe?c.jsx("img",{className:"full-player-artwork",src:pe,alt:i.title}):c.jsx("div",{className:"full-player-artwork full-player-artwork-placeholder",children:c.jsx(qe,{size:80})})}),S&&c.jsx("div",{className:"full-player-lyrics-container",children:c.jsx(Yme,{onSeek:x})})]}),c.jsxs("footer",{className:"full-player-footer",children:[c.jsxs("div",{className:"full-player-track-info",children:[c.jsx("h2",{className:`full-player-title ${i.album?"clickable":""}`,onClick:i.album?H:void 0,title:i.album?`Go to ${i.album.title}`:void 0,children:i.title}),c.jsx("p",{className:`full-player-artist ${i.artists.length>0?"clickable":""}`,onClick:i.artists.length>0?G:void 0,title:i.artists.length>0?`Go to ${i.artists[0].name}`:void 0,children:ge})]}),c.jsxs("div",{className:"full-player-progress",children:[c.jsx("span",{className:"full-player-time",children:J(a)}),c.jsx("div",{className:"full-player-progress-bar",ref:z,onMouseDown:B,children:c.jsx("div",{className:"full-player-progress-fill",style:{width:`${ae}%`}})}),c.jsx("span",{className:"full-player-time",children:J(l)})]}),c.jsxs("div",{className:"full-player-controls",children:[c.jsx("button",{className:`full-player-btn secondary ${d?"active":""}`,onClick:k,title:d?"Disable shuffle":"Enable shuffle",children:c.jsx(oo,{size:24})}),c.jsx("button",{className:"full-player-btn",onClick:b,title:"Previous",children:c.jsx(mb,{size:32})}),c.jsx("button",{className:"full-player-btn primary",onClick:o?p:g,disabled:u,title:o?"Pause":"Play",children:u?c.jsx("span",{className:"full-player-loading"}):o?c.jsx(gd,{size:36}):c.jsx(Et,{size:36})}),c.jsx("button",{className:"full-player-btn",onClick:y,title:"Next",children:c.jsx(Dm,{size:32})}),c.jsx("button",{className:`full-player-btn secondary ${f!=="off"?"active":""}`,onClick:w,title:f==="off"?"Enable repeat":f==="all"?"Repeat one":"Disable repeat",children:f==="one"?c.jsx(QT,{size:24}):c.jsx(KT,{size:24})})]}),c.jsx("div",{className:"full-player-actions",children:c.jsx("button",{className:`full-player-action ${W?"active":""}`,onClick:()=>E(i),title:W?"Remove from Liked Songs":"Add to Liked Songs",children:W?c.jsx(Sc,{size:24}):c.jsx(ic,{size:24})})})]})]})},nge=()=>{var Pe,ue,Te,ke;const n=j.useRef(null),e=j.useRef(null),{isLyricsPanelOpen:t,isLyricsPanelExpanded:s,closeLyricsPanel:r,toggleLyricsPanelExpanded:i}=el(),{currentTrack:o,position:a,seek:l,isPlaying:u,pause:d,resume:f,next:p,previous:g}=Ke(),{isAvailable:x,isEnabled:y,isProcessing:b,vocalReduction:k,setVocalReduction:w,toggle:N}=cd(),{isLoading:C,error:S,fetchLyrics:T,updateCurrentLine:A,clearLyrics:E,singAlongEnabled:M,setSingAlongEnabled:P,linesWithWords:R,currentWordIndex:L,updateCurrentWord:_,getWordTimingsForLine:O,offset:U,updatePositionAtomic:W}=Wc(),{lyrics:H,plainLyrics:G,currentLineIndex:q,nextLineIndex:Q,seekToLine:z,adjustOffset:K,resetOffset:Y,translationEnabled:B}=ak(),J=j.useRef(null),ae=j.useRef(null);j.useEffect(()=>{var ye;if(t&&o){const Ce=((ye=o.artists[0])==null?void 0:ye.name)||"";T(Ce,o.title,o.id)}},[t,o==null?void 0:o.id,T]),j.useEffect(()=>{t&&(M||s?W(a):A(a))},[a,t,M,s,W,A]),j.useEffect(()=>{if(e.current&&n.current&&!s){const ye=n.current,Ce=e.current,Ae=ye.clientHeight,Be=Ce.offsetTop,mt=Ce.clientHeight,le=Be-Ae*.4+mt/2;ye.scrollTo({top:le,behavior:"smooth"})}},[q,s]),j.useEffect(()=>{if(ae.current&&J.current&&s&&!M){const ye=J.current,Ce=ae.current,Ae=ye.clientHeight,Be=Ce.offsetTop,mt=Ce.clientHeight,le=Be-Ae*.4+mt/2;ye.scrollTo({top:le,behavior:"smooth"})}},[q,s,M]),j.useEffect(()=>{if(!t)return;const ye=Ce=>{Ce.key==="Escape"?s?i():r():Ce.key===" "&&s?(Ce.preventDefault(),u?d():f()):Ce.key==="ArrowUp"&&Ce.altKey?K(-200):Ce.key==="ArrowDown"&&Ce.altKey?K(200):Ce.key==="0"&&Ce.altKey?Y():Ce.key==="ArrowRight"&&s?p():Ce.key==="ArrowLeft"&&s&&g()};return document.addEventListener("keydown",ye),()=>document.removeEventListener("keydown",ye)},[t,s,r,i,K,Y,u,d,f,p,g]);const pe=j.useCallback(ye=>{const Ce=z(ye);Ce>=0&&l(Ce)},[z,l]),ge=j.useCallback(ye=>{w(1-parseFloat(ye.target.value))},[w]),he=j.useCallback(()=>{s&&i(),r()},[s,i,r]);if(!t)return null;const we=((Pe=o==null?void 0:o.artwork)==null?void 0:Pe.large)??((ue=o==null?void 0:o.artwork)==null?void 0:ue.medium)??((ke=(Te=o==null?void 0:o.album)==null?void 0:Te.artwork)==null?void 0:ke.large);return s?c.jsxs("div",{className:"lyrics-fullscreen",children:[c.jsx("div",{className:"lyrics-fullscreen-bg",style:we?{backgroundImage:`url(${we})`}:void 0}),c.jsx("div",{className:"lyrics-fullscreen-overlay"}),c.jsxs("header",{className:"lyrics-fullscreen-header",children:[c.jsx("button",{className:"lyrics-fullscreen-close",onClick:he,title:"Close (Esc)",children:c.jsx(an,{size:24})}),c.jsxs("div",{className:"lyrics-fullscreen-track",children:[we?c.jsx("img",{className:"lyrics-fullscreen-artwork",src:we,alt:""}):c.jsx("div",{className:"lyrics-fullscreen-artwork lyrics-fullscreen-artwork-placeholder",children:c.jsx(qe,{size:24})}),c.jsxs("div",{className:"lyrics-fullscreen-meta",children:[c.jsx("span",{className:"lyrics-fullscreen-title",children:(o==null?void 0:o.title)||"No track"}),c.jsx("span",{className:"lyrics-fullscreen-artist",children:(o==null?void 0:o.artists.map(ye=>ye.name).join(", "))||"Unknown artist"})]})]}),c.jsxs("div",{className:"lyrics-fullscreen-controls",children:[c.jsxs("button",{className:`lyrics-fullscreen-btn ${M?"":"active"}`,onClick:()=>P(!M),title:M?"Switch to Basic Lyrics":"Switch to Sing-Along Mode",children:[M?c.jsx(nv,{size:20}):c.jsx(xb,{size:20}),c.jsx("span",{children:M?"Sing-Along":"Lyrics"})]}),x&&c.jsxs(c.Fragment,{children:[c.jsxs("button",{className:`lyrics-fullscreen-btn ${y?"active":""} ${b?"processing":""}`,onClick:N,title:y?b?"Processing...":"Disable Karaoke":"Enable Karaoke",children:[c.jsx(dS,{size:20}),c.jsx("span",{children:b?"Processing...":y?"Sing":"Karaoke"})]}),y&&!b&&c.jsxs("div",{className:"lyrics-fullscreen-slider karaoke-slider",children:[c.jsx("span",{className:"karaoke-slider-label karaoke-slider-label-min",children:"Karaoke"}),c.jsx("input",{type:"range",min:"0",max:"1",step:"0.05",value:1-k,onChange:ge,title:`Vocals: ${Math.round((1-k)*100)}%`}),c.jsx("span",{className:"karaoke-slider-label karaoke-slider-label-max",children:"Original"})]})]}),c.jsx(Jv,{}),c.jsx("button",{className:"lyrics-fullscreen-collapse",onClick:i,title:"Exit Full Screen",children:c.jsx(eO,{size:20})})]})]}),c.jsxs("div",{className:"lyrics-fullscreen-content",children:[C&&c.jsxs("div",{className:"lyrics-fullscreen-message",children:[c.jsx("div",{className:"lyrics-fullscreen-spinner"}),c.jsx("span",{children:"Loading lyrics..."})]}),!C&&!H&&!R&&c.jsxs("div",{className:"lyrics-fullscreen-message",children:[c.jsx(qe,{size:64}),c.jsx("span",{children:"No synced lyrics available"}),c.jsx("span",{className:"lyrics-fullscreen-hint",children:"Play a track with lyrics to get started"})]}),!C&&M&&R&&R.length>0&&c.jsx(MM,{linesWithWords:B&&H?R.map((ye,Ce)=>{var Ae;return{...ye,translation:(Ae=H[Ce])==null?void 0:Ae.translation}}):R,currentLineIndex:q,currentWordIndex:L,onLineClick:pe,showTranslations:B}),!C&&!M&&H&&H.length>0&&c.jsx("div",{className:"lyrics-fullscreen-basic",ref:J,children:H.map((ye,Ce)=>{const Ae=Ce===q,Be=Ce<q,mt=Ce===Q;return c.jsxs("div",{ref:Ae?ae:null,className:`lyrics-fullscreen-line ${Ae?"active":""} ${Be?"past":""} ${mt?"upcoming":""}`,onClick:()=>pe(Ce),children:[c.jsx("span",{className:"lyrics-fullscreen-line-text",children:ye.text||""}),B&&ye.translation&&c.jsx("span",{className:"lyrics-fullscreen-line-translation",children:ye.translation})]},Ce)})})]}),c.jsx("footer",{className:"lyrics-fullscreen-footer",children:c.jsxs("div",{className:"lyrics-fullscreen-playback",children:[c.jsx("button",{className:"lyrics-playback-btn",onClick:g,title:"Previous",children:c.jsx(mb,{size:28})}),c.jsx("button",{className:"lyrics-playback-btn play",onClick:u?d:f,title:u?"Pause":"Play",children:u?c.jsx(gd,{size:36}):c.jsx(Et,{size:36})}),c.jsx("button",{className:"lyrics-playback-btn",onClick:p,title:"Next",children:c.jsx(Dm,{size:28})})]})})]}):c.jsxs("div",{className:"lyrics-panel",children:[c.jsxs("header",{className:"lyrics-panel-header",children:[c.jsxs("div",{className:"lyrics-panel-header-info",children:[we?c.jsx("img",{className:"lyrics-panel-artwork",src:we,alt:""}):c.jsx("div",{className:"lyrics-panel-artwork lyrics-panel-artwork-placeholder",children:c.jsx(qe,{size:20})}),c.jsxs("div",{className:"lyrics-panel-track-info",children:[c.jsx("span",{className:"lyrics-panel-title",children:(o==null?void 0:o.title)||"No track"}),c.jsx("span",{className:"lyrics-panel-artist",children:(o==null?void 0:o.artists.map(ye=>ye.name).join(", "))||"Unknown artist"})]})]}),c.jsxs("div",{className:"lyrics-panel-header-actions",children:[x&&c.jsx("button",{className:`lyrics-panel-karaoke ${y?"active":""} ${b?"processing":""}`,onClick:N,title:y?b?"Processing...":"Disable Karaoke":"Enable Karaoke (Vocal Removal)",children:c.jsx(dS,{size:18})}),H&&H.length>0&&c.jsx("button",{className:`lyrics-panel-singalong ${M?"active":""}`,onClick:()=>P(!M),title:M?"Disable Sing-Along":"Enable Sing-Along",children:c.jsx(nv,{size:18})}),c.jsx(Jv,{compact:!0}),c.jsx("button",{className:"lyrics-panel-expand",onClick:i,title:"Full-Screen Karaoke",children:c.jsx(J4,{size:18})}),c.jsx("button",{className:"lyrics-panel-close",onClick:r,title:"Close (Esc)",children:c.jsx(an,{size:20})})]})]}),H&&H.length>0&&c.jsxs("div",{className:"lyrics-panel-offset",children:[c.jsx("button",{className:"lyrics-offset-button",onClick:()=>K(-200),title:"Lyrics earlier (Alt+Up)",children:c.jsx(XT,{size:16})}),c.jsx("span",{className:"lyrics-offset-value",onClick:Y,title:"Click to reset",children:U===0?"Synced":`${U>0?"+":""}${U}ms`}),c.jsx("button",{className:"lyrics-offset-button",onClick:()=>K(200),title:"Lyrics later (Alt+Down)",children:c.jsx(Fa,{size:16})})]}),c.jsxs("div",{className:"lyrics-panel-content",ref:n,children:[C&&c.jsxs("div",{className:"lyrics-panel-state",children:[c.jsx("div",{className:"lyrics-panel-spinner"}),c.jsx("span",{children:"Loading lyrics..."})]}),S&&c.jsx("div",{className:"lyrics-panel-state",children:c.jsx("span",{className:"lyrics-panel-error",children:S})}),!C&&!S&&H&&H.length>0&&c.jsx("div",{className:`lyrics-panel-synced ${M?"sing-along-mode":""}`,children:H.map((ye,Ce)=>{const Ae=Ce===q,Be=Ce<q,mt=Ce===Q,le=M?O(Ce):[];return c.jsxs("div",{ref:Ae?e:null,className:`lyrics-panel-line ${Ae?"active":""} ${Be?"past":""} ${mt?"upcoming":""}`,onClick:()=>pe(Ce),children:[M&&le.length>0?c.jsx(xx,{words:le,currentWordIndex:Ae?L:Be?le.length:-1,isActive:Ae}):c.jsx("span",{className:"lyrics-panel-line-original",children:ye.text||""}),B&&ye.translation&&c.jsx("span",{className:"lyrics-panel-line-translation",children:ye.translation})]},Ce)})}),!C&&!S&&!H&&G&&c.jsx("div",{className:"lyrics-panel-plain",children:G.split(`
`).map((ye,Ce)=>c.jsx("div",{className:"lyrics-panel-line plain",children:ye||""},Ce))}),!C&&!S&&!H&&!G&&c.jsxs("div",{className:"lyrics-panel-state",children:[c.jsx(qe,{size:48}),c.jsx("span",{children:"No lyrics available"}),c.jsx("span",{className:"lyrics-panel-hint",children:o?"Lyrics not found for this track":"Play a track to see lyrics"})]})]})]})},sge=({track:n,onClose:e})=>{var b,k,w;const[t,s]=j.useState(!1),[r,i]=j.useState(""),[o,a]=j.useState(new Set),l=j.useRef(null),u=j.useRef(null),{playlists:d,createPlaylist:f,addToPlaylist:p}=Xt();j.useEffect(()=>{const N=S=>{S.key==="Escape"&&e()},C=S=>{u.current&&!u.current.contains(S.target)&&e()};return document.addEventListener("keydown",N),document.addEventListener("mousedown",C),()=>{document.removeEventListener("keydown",N),document.removeEventListener("mousedown",C)}},[e]),j.useEffect(()=>{t&&l.current&&l.current.focus()},[t]),j.useEffect(()=>{const N=new Set;d.forEach(C=>{C.tracks.some(S=>S.id===n.id)&&N.add(C.id)}),a(N)},[d,n.id]);const g=()=>{if(r.trim()){const N=f(r.trim());p(N.id,n),a(C=>new Set(C).add(N.id)),i(""),s(!1)}},x=N=>{o.has(N)||(p(N,n),a(C=>new Set(C).add(N)))},y=((b=n.artwork)==null?void 0:b.medium)??((w=(k=n.album)==null?void 0:k.artwork)==null?void 0:w.medium);return c.jsx("div",{className:"modal-overlay",children:c.jsxs("div",{className:"modal",ref:u,children:[c.jsxs("header",{className:"modal-header",children:[c.jsx("h2",{children:"Add to Playlist"}),c.jsx("button",{className:"modal-close",onClick:e,children:c.jsx(an,{size:20})})]}),c.jsxs("div",{className:"modal-track-preview",children:[y?c.jsx("img",{src:y,alt:n.title}):c.jsx("div",{className:"modal-track-placeholder",children:c.jsx(yi,{size:24})}),c.jsxs("div",{className:"modal-track-info",children:[c.jsx("div",{className:"modal-track-title",children:n.title}),c.jsx("div",{className:"modal-track-artist",children:n.artists.map(N=>N.name).join(", ")})]})]}),c.jsxs("div",{className:"modal-content",children:[t?c.jsxs("div",{className:"modal-create-form",children:[c.jsx("input",{ref:l,type:"text",placeholder:"Playlist name",value:r,onChange:N=>i(N.target.value),onKeyDown:N=>{N.key==="Enter"&&g(),N.key==="Escape"&&s(!1)}}),c.jsxs("div",{className:"modal-create-buttons",children:[c.jsx("button",{className:"modal-button secondary",onClick:()=>s(!1),children:"Cancel"}),c.jsx("button",{className:"modal-button primary",onClick:g,disabled:!r.trim(),children:"Create"})]})]}):c.jsxs("button",{className:"modal-create-playlist",onClick:()=>s(!0),children:[c.jsx(Zi,{size:20}),c.jsx("span",{children:"New Playlist"})]}),c.jsx("div",{className:"modal-playlist-list",children:d.length===0?c.jsx("div",{className:"modal-empty",children:"No playlists yet. Create one above!"}):d.map(N=>{const C=o.has(N.id);return c.jsxs("button",{className:`modal-playlist-item ${C?"added":""}`,onClick:()=>x(N.id),disabled:C,children:[c.jsx(yi,{size:20}),c.jsx("span",{className:"modal-playlist-name",children:N.name}),c.jsxs("span",{className:"modal-playlist-count",children:[N.tracks.length," songs"]}),C&&c.jsx(Ji,{size:18})]},N.id)})})]})]})})},rge=({toast:n,onRemove:e})=>{const[t,s]=j.useState(!1),r=()=>{s(!0),setTimeout(e,200)},i=()=>{switch(n.type){case"success":return c.jsx(Ji,{size:18});case"error":return c.jsx(hS,{size:18});case"warning":return c.jsx(e$,{size:18});default:return c.jsx(Y4,{size:18})}};return c.jsxs("div",{className:`toast toast-${n.type} ${t?"toast-exit":""}`,children:[c.jsx("div",{className:"toast-icon",children:c.jsx(i,{})}),c.jsxs("div",{className:"toast-content",children:[c.jsx("span",{className:"toast-message",children:n.message}),n.action&&c.jsx("button",{className:"toast-action",onClick:n.action.onClick,children:n.action.label})]}),c.jsx("button",{className:"toast-close",onClick:r,children:c.jsx(hS,{size:14})})]})},ige=()=>{const{toasts:n,removeToast:e}=cM();return n.length===0?null:c.jsx("div",{className:"toast-container",children:n.map(t=>c.jsx(rge,{toast:t,onRemove:()=>e(t.id)},t.id))})};function oge(n){const e=new Set;return n.filter(t=>e.has(t.id)?!1:(e.add(t.id),!0))}const age=()=>{const{indexTracks:n,recordPlay:e,recordLike:t,recordSession:s,isReady:r,tracksIndexed:i}=YP(),{likedTracks:o,playlists:a}=Xt(),l=j.useRef(null),u=j.useRef(0),d=j.useRef(0),f=j.useRef([]);return j.useEffect(()=>{if(console.log("[EmbeddingManager] Index effect running:",{isReady:r,likedTracksCount:o.length,playlistsCount:a.length,tracksIndexed:i}),!r){console.log("[EmbeddingManager] Not ready yet, skipping index");return}const p=o.map(x=>x.track);for(const x of a)x.tracks&&p.push(...x.tracks);const g=oge(p);g.length>0?(n(g),console.log(`[EmbeddingManager] Indexed ${g.length} library tracks (total: ${i})`)):(console.log("[EmbeddingManager] No library tracks to index - library is empty"),console.log("[EmbeddingManager] Tracks will be indexed as you play music or search"))},[r,o,a,n,i]),j.useEffect(()=>{const p=Ke.subscribe(g=>{var w;const{currentTrack:x,isPlaying:y,position:b,duration:k}=g;if(x&&y&&x.id!==((w=l.current)==null?void 0:w.id)){if(l.current&&u.current>0){const N=Date.now()-u.current,C=l.current.duration*1e3,S=N>=C*.8;e(l.current,N/1e3,S),f.current.push(l.current.id),f.current.length>=5&&(s(f.current),f.current=f.current.slice(-2))}l.current=x,u.current=Date.now(),n([x])}if(l.current&&!y&&u.current>0){const N=Date.now()-u.current;if(N>5e3){const C=l.current.duration*1e3,S=N>=C*.8;e(l.current,N/1e3,S)}u.current=0}});return()=>p()},[n,e,s]),j.useEffect(()=>{if(!r)return;const p=o.length,g=d.current;if(p>g){const x=o.slice(g);for(const y of x)t(y),console.log(`[EmbeddingManager] Recorded like for: ${y.title}`)}d.current=p},[r,o,t]),j.useEffect(()=>{const p=g=>{var x,y;if(((y=(x=g.detail)==null?void 0:x.tracks)==null?void 0:y.length)>0){const b=i;n(g.detail.tracks),console.log(`[EmbeddingManager] Indexed ${g.detail.tracks.length} tracks from search (was: ${b}, now: ${i})`)}};return window.addEventListener("audiio:search-results",p),()=>{window.removeEventListener("audiio:search-results",p)}},[n,i]),j.useEffect(()=>{r&&console.log(`[EmbeddingManager] Ready. Tracks indexed: ${i}`)},[r,i]),null},lge=n=>{const e=document.documentElement;Object.entries({bgPrimary:"--bg-primary",bgSecondary:"--bg-secondary",bgTertiary:"--bg-tertiary",bgHover:"--bg-hover",bgElevated:"--bg-elevated",bgSurface:"--bg-surface",bgOverlay:"--bg-overlay",textPrimary:"--text-primary",textSecondary:"--text-secondary",textMuted:"--text-muted",textInverse:"--text-inverse",accent:"--accent",accentHover:"--accent-hover",accentGlow:"--accent-glow",accentSoft:"--accent-soft",accentMuted:"--accent-muted",borderColor:"--border-color",borderLight:"--border-light",borderStrong:"--border-strong",colorSuccess:"--color-success",colorWarning:"--color-warning",colorError:"--color-error",colorInfo:"--color-info"}).forEach(([s,r])=>{const i=n[s];i&&e.style.setProperty(r,i)})},cge=n=>{if(!n)return;const e=document.documentElement;Object.entries({accent:"--gradient-accent",surface:"--gradient-surface",purple:"--gradient-purple",pink:"--gradient-pink",blue:"--gradient-blue",orange:"--gradient-orange",red:"--gradient-red",teal:"--gradient-teal"}).forEach(([s,r])=>{const i=n[s];i&&e.style.setProperty(r,i)})},uge=n=>{if(!n)return;const e=document.documentElement;Object.entries({xs:"--shadow-xs",sm:"--shadow-sm",md:"--shadow-md",lg:"--shadow-lg",xl:"--shadow-xl",glow:"--shadow-glow",module:"--shadow-module",card:"--shadow-card",elevated:"--shadow-elevated"}).forEach(([s,r])=>{const i=n[s];i&&e.style.setProperty(r,i)})},dge=n=>{if(!n)return;const e=document.documentElement;Object.entries({bg:"--glass-bg",bgLight:"--glass-bg-light",border:"--glass-border",borderStrong:"--glass-border-strong",blur:"--glass-blur",blurStrong:"--glass-blur-strong"}).forEach(([s,r])=>{const i=n[s];i&&e.style.setProperty(r,i)})},hge=n=>{if(!n)return;const e=document.documentElement;Object.entries({xs:"--radius-xs",sm:"--radius-sm",md:"--radius-md",lg:"--radius-lg",xl:"--radius-xl","2xl":"--radius-2xl",full:"--radius-full",module:"--radius-module",card:"--radius-card",button:"--radius-button"}).forEach(([s,r])=>{const i=n[s];i&&e.style.setProperty(r,i)})},fge=n=>{if(!n)return;const e=document.documentElement;n.sans&&e.style.setProperty("--font-sans",n.sans),n.mono&&e.style.setProperty("--font-mono",n.mono)},fT="audiio-theme-custom-css",pge=(n,e)=>{const t=document.getElementById(fT);if(t&&t.remove(),!e)return;const s=mge(e);if(s){const r=document.createElement("style");r.id=fT,r.setAttribute("data-theme-id",n),r.textContent=s,document.head.appendChild(r)}},mge=n=>{const e=[/expression\s*\(/gi,/javascript\s*:/gi,/behavior\s*:/gi,/@import/gi,/url\s*\(\s*["']?data:/gi,/-moz-binding/gi,/vbscript\s*:/gi];let t=n;e.forEach(s=>{t=t.replace(s,"/* blocked */")}),t.length>5e4&&(console.warn("Custom CSS exceeds 50KB limit, truncating"),t=t.substring(0,5e4));try{return t.replace(/([^\r\n,{}]+)(\s*\{)/g,(r,i,o)=>i.trim().startsWith(".app")||i.trim().startsWith("@")||i.trim().startsWith(":root")||i.trim().startsWith("from")||i.trim().startsWith("to")||/^\d+%$/.test(i.trim())?r:`.app ${i.trim()}${o}`)}catch{return t}},gge=()=>{const n=document.documentElement;["--bg-primary","--bg-secondary","--bg-tertiary","--bg-hover","--bg-elevated","--bg-surface","--bg-overlay","--text-primary","--text-secondary","--text-muted","--text-inverse","--accent","--accent-hover","--accent-glow","--accent-soft","--accent-muted","--border-color","--border-light","--border-strong","--color-success","--color-warning","--color-error","--color-info","--gradient-accent","--gradient-surface","--gradient-purple","--gradient-pink","--gradient-blue","--gradient-orange","--gradient-red","--gradient-teal","--shadow-xs","--shadow-sm","--shadow-md","--shadow-lg","--shadow-xl","--shadow-glow","--shadow-module","--shadow-card","--shadow-elevated","--glass-bg","--glass-bg-light","--glass-border","--glass-border-strong","--glass-blur","--glass-blur-strong","--radius-xs","--radius-sm","--radius-md","--radius-lg","--radius-xl","--radius-2xl","--radius-full","--radius-module","--radius-card","--radius-button","--font-sans","--font-mono","--color-mode"].forEach(t=>{n.style.removeProperty(t)})},xge=n=>{const e=document.documentElement;gge(),e.setAttribute("data-theme",n.mode),e.style.setProperty("--color-mode",n.mode),lge(n.colors),cge(n.gradients),uge(n.shadows),dge(n.glass),hge(n.radius),fge(n.fonts),pge(n.id,n.customCSS)},yge=({children:n})=>{const e=nc(o=>o.getActiveTheme),t=nc(o=>o.activeThemeId),s=nc(o=>o.systemMode),r=j.useRef(null),i=j.useCallback((o=!1)=>{const a=e(),l=`${a.id}-${a.mode}`;(o||r.current!==l)&&(xge(a),r.current=l)},[e]);return j.useEffect(()=>{i(!0)},[]),j.useEffect(()=>{i(!0)},[t,s]),j.useEffect(()=>{if(s!=="auto")return;const o=window.matchMedia("(prefers-color-scheme: dark)"),a=()=>{i(!0)};return o.addEventListener("change",a),()=>{o.removeEventListener("change",a)}},[s,i]),c.jsx(c.Fragment,{children:n})};function yx(n){var e,t;return!n.artists||!Array.isArray(n.artists)||n.artists.length===0?"unknown":((e=n.artists[0])==null?void 0:e.id)||((t=n.artists[0])==null?void 0:t.name)||"unknown"}function LM(n){var e;return((e=n.genres)==null?void 0:e[0])||""}const vge={id:"builtin:artist-diversity",pluginId:"builtin",priority:90,name:"Artist Diversity",description:"Ensures variety of artists in results (max 4 per artist)",enabledByDefault:!0,canTransform(){return!0},async transform(n,e){const s=new Map,r=[],i=[];for(const a of n){const l=yx(a),u=s.get(l)||0;u<4?(r.push(a),s.set(l,u+1)):i.push(a)}return[...bge(r),...i]}};function bge(n){if(n.length<=2)return n;const e=new Map;for(const i of n){const o=yx(i),a=e.get(o)||[];a.push(i),e.set(o,a)}const t=[],s=Array.from(e.keys());let r=0;for(;t.length<n.length&&s.length>0;){const i=r%s.length,o=s[i];if(!o)break;const a=e.get(o);if(!a||a.length===0){s.splice(i,1);continue}const l=a.shift();l&&t.push(l),a.length===0?s.splice(i,1):r++}return t}const wge={id:"builtin:duplicate-remover",pluginId:"builtin",priority:100,name:"Duplicate Remover",description:"Removes duplicate tracks and similar titles",enabledByDefault:!0,canTransform(){return!0},async transform(n,e){const t=new Set,s=new Map,r=[];for(const i of n){if(t.has(i.id))continue;const o=kge(i.title),a=`${yx(i)}:${o}`;s.has(a)||(t.add(i.id),s.set(a,i.id),r.push(i))}return r}};function kge(n){return!n||typeof n!="string"?"":n.toLowerCase().replace(/\s*\(.*?\)\s*/g,"").replace(/\s*\[.*?\]\s*/g,"").replace(/\s*-\s*(remaster|remix|edit|version|live).*$/i,"").replace(/[^\w\s]/g,"").replace(/\s+/g," ").trim()}const Cge={id:"builtin:recency-boost",pluginId:"builtin",priority:70,name:"Recency Boost",description:"Boosts recently interacted tracks in personalized results",enabledByDefault:!0,canTransform(n){var e;return n.sectionType==="personalized"||n.sectionType==="weekly-rotation"||((e=n.embedding)==null?void 0:e.method)==="personalized"},async transform(n,e){const t=Object.entries(e.userProfile.artistPreferences).filter(([,u])=>u.totalListenTime>0).sort(([,u],[,d])=>d.totalListenTime-u.totalListenTime).slice(0,10).map(([u])=>u);if(t.length===0)return n;const s=new Set(t),r=[],i=[];for(const u of n){const d=yx(u);s.has(d)?r.push(u):i.push(u)}const o=[];let a=0,l=0;for(;a<r.length||l<i.length;){if(a<r.length){const u=r[a++];u&&o.push(u)}for(let u=0;u<2&&l<i.length;u++){const d=i[l++];d&&o.push(d)}}return o}},Sge={id:"builtin:time-energy",pluginId:"builtin",priority:60,name:"Time-Aware Energy",description:"Adjusts track energy based on time of day",enabledByDefault:!0,canTransform(n){var e,t,s;return((e=n.embedding)==null?void 0:e.method)==="mood"||((t=n.embedding)==null?void 0:t.method)==="discovery"||((s=n.embedding)==null?void 0:s.method)==="personalized"},async transform(n,e){const t=e.hour;let s=!1,r=!1;if(t>=6&&t<10?r=t<8:t>=10&&t<18?s=!0:t>=18&&t<22||(r=!0),!s&&!r)return n;const i=n.map(o=>({track:o,energyScore:Nge(o)}));return s?i.sort((o,a)=>a.energyScore-o.energyScore):r&&i.sort((o,a)=>o.energyScore-a.energyScore),i.map(o=>o.track)}};function Nge(n){let e=.5;const t=(n.title||"").toLowerCase(),s=LM(n).toLowerCase();/rock|metal|punk|edm|dance|party|hype|power|energy/.test(t+s)&&(e+=.3),/remix|club|dj/.test(t)&&(e+=.2),/chill|relax|calm|sleep|ambient|acoustic|ballad|slow/.test(t+s)&&(e-=.3),/piano|classical|jazz/.test(s)&&(e-=.15);const r=n.duration||0;return r>0&&(r<150&&(e+=.1),r>360&&(e-=.1)),Math.max(0,Math.min(1,e))}const Ige={id:"builtin:mood-consistency",pluginId:"builtin",priority:75,name:"Mood Consistency",description:"Removes tracks that don't match the requested mood",enabledByDefault:!0,canTransform(n){var e;return!!((e=n.embedding)!=null&&e.mood)},async transform(n,e){var o,a;const t=(a=(o=e.query.embedding)==null?void 0:o.mood)==null?void 0:a.toLowerCase();if(!t)return n;const r={happy:["sad","cry","tears","heartbreak","lonely"],sad:["happy","party","celebrate","fun"],energetic:["chill","relax","calm","slow","sleep"],chill:["hype","rage","party","scream","metal"],romantic:["angry","rage","hate","fight"]}[t]||[],i=n.filter(l=>{var x,y,b;const u=((y=(x=l.artists)==null?void 0:x[0])==null?void 0:y.name)||"",d=((b=l.album)==null?void 0:b.title)||"",f=LM(l),p=`${l.title||""} ${u} ${d} ${f}`.toLowerCase();return!r.some(k=>p.includes(k))});return i.length<n.length*.5?n:i}},pT=[wge,vge,Ige,Cge,Sge];let mT=!1;function Tge(n){if(!mT){for(const e of pT)n.registerTransformer(e);mT=!0,console.log(`[BuiltinTransformers] Registered ${pT.length} built-in transformers`)}}const en="core",eb=new Map,$ge=3e4;function Ege(n){const e=eb.get(n);return e&&Date.now()-e.timestamp<$ge?e.data:(eb.delete(n),null)}function Age(n,e){eb.set(n,{data:e,timestamp:Date.now()})}const yp=new Map;async function vx(n,e){const t=Ege(n);if(t)return console.log(`[CoreProviders] Cache hit for: ${n}`),t;const s=yp.get(n);if(s)return console.log(`[CoreProviders] Deduped request for: ${n}`),s;const r=e().then(i=>(Age(n,i),yp.delete(n),i)).catch(i=>{throw yp.delete(n),i});return yp.set(n,r),r}const jge={id:`${en}:trending`,pluginId:en,priority:100,name:"Trending Provider",description:"Fetches trending/chart tracks from metadata providers",canProvide(n){return["trending-tracks","trending","charts","chart-list","top-charts","popular"].includes(n.sectionType)},async provide(n){var e;try{if(!((e=window.api)!=null&&e.getTrending))return console.warn("[TrendingProvider] getTrending API not available"),[];const t=await vx("trending",async()=>{console.log("[TrendingProvider] Calling getTrending...");const i=await window.api.getTrending();return console.log("[TrendingProvider] Response:",JSON.stringify({hasTracks:!!(i!=null&&i.tracks),tracksLength:Array.isArray(i==null?void 0:i.tracks)?i.tracks.length:0,isArray:Array.isArray(i==null?void 0:i.tracks),error:i==null?void 0:i.error,keys:i?Object.keys(i):[]})),i}),s=Array.isArray(t==null?void 0:t.tracks)?t.tracks:[];return s.length===0?(console.log("[TrendingProvider] No trending tracks returned"),[]):(console.log(`[TrendingProvider] Got ${s.length} trending tracks`),s.map(i=>{var o,a;return{...i,id:(a=(o=i.id)==null?void 0:o.startsWith)!=null&&a.call(o,"deezer:")?i.id:`deezer:${i.id}`,streamSources:i.streamSources||[],_meta:{metadataProvider:i._provider||"trending",matchConfidence:1,externalIds:i.externalIds||{},lastUpdated:new Date().toISOString()}}}).slice(0,n.query.limit||50))}catch(t){return console.error("[TrendingProvider] Error:",t),[]}}},Rge={id:`${en}:search`,pluginId:en,priority:80,name:"Search Provider",description:"Searches for tracks using the search orchestrator",canProvide(n){var e;return!!((e=n.search)!=null&&e.query||n.strategy==="search")},async provide(n){var t,s;const e=(t=n.query.search)==null?void 0:t.query;if(!e)return[];try{if(!((s=window.api)!=null&&s.search))return console.warn("[SearchProvider] search API not available"),[];console.log(`[SearchProvider] Searching for: ${e}`);const r=await window.api.search({query:e,type:"track",limit:n.query.limit||50});return r!=null&&r.length?(console.log(`[SearchProvider] Got ${r.length} search results`),r):(console.log("[SearchProvider] No search results"),[])}catch(r){return console.error("[SearchProvider] Error:",r),[]}}},Dge={id:`${en}:artist-radio`,pluginId:en,priority:90,name:"Artist Radio Provider",description:"Fetches artist radio/similar tracks",canProvide(n){var t,s;return["artist-radio","because-you-like","similar-artists"].includes(n.sectionType)||!!(((t=n.embedding)==null?void 0:t.method)==="artist-radio"&&((s=n.embedding)!=null&&s.seedArtistId))},async provide(n){var t,s;const e=n.query.embedding;try{if(e!=null&&e.seedArtistId&&((t=window.api)!=null&&t.getArtistRadio)){console.log(`[ArtistRadioProvider] Getting radio for artist: ${e.seedArtistId}`);const r=await window.api.getArtistRadio({artistId:e.seedArtistId,limit:n.query.limit||30});if(r!=null&&r.length)return console.log(`[ArtistRadioProvider] Got ${r.length} artist radio tracks`),r}if(e!=null&&e.artistName&&((s=window.api)!=null&&s.search)){console.log(`[ArtistRadioProvider] Searching for artist: ${e.artistName}`);const r=await window.api.search({query:`${e.artistName} similar`,type:"track",limit:n.query.limit||30});if(r!=null&&r.length)return r}return[]}catch(r){return console.error("[ArtistRadioProvider] Error:",r),[]}}},Pge={id:`${en}:similar-tracks`,pluginId:en,priority:85,name:"Similar Tracks Provider",description:"Fetches tracks similar to seed tracks",canProvide(n){var e,t,s;return n.sectionType==="similar-tracks"||!!(((e=n.embedding)==null?void 0:e.method)==="similar"&&((s=(t=n.embedding)==null?void 0:t.seedTrackIds)!=null&&s.length))},async provide(n){var t,s;const e=(t=n.query.embedding)==null?void 0:t.seedTrackIds;if(!(e!=null&&e.length))return[];try{if(!((s=window.api)!=null&&s.getSimilarTracks))return[];console.log(`[SimilarTracksProvider] Getting similar to: ${e[0]}`);const r=await window.api.getSimilarTracks({trackId:e[0],limit:n.query.limit||20});return r!=null&&r.length?(console.log(`[SimilarTracksProvider] Got ${r.length} similar tracks`),r):[]}catch(r){return console.error("[SimilarTracksProvider] Error:",r),[]}}},Mge={id:`${en}:genre`,pluginId:en,priority:75,name:"Genre Provider",description:"Fetches tracks by genre",canProvide(n){var e,t;return n.sectionType==="genre-explorer"||((e=n.embedding)==null?void 0:e.method)==="genre"||!!((t=n.embedding)!=null&&t.genre)},async provide(n){var t,s;const e=(t=n.query.embedding)==null?void 0:t.genre;if(!e)return[];try{return(s=window.api)!=null&&s.search?(console.log(`[GenreProvider] Searching for genre: ${e}`),await window.api.search({query:`${e} music best hits`,type:"track",limit:n.query.limit||30})||[]):[]}catch(r){return console.error("[GenreProvider] Error:",r),[]}}},Lge={id:`${en}:mood`,pluginId:en,priority:70,name:"Mood Provider",description:"Fetches tracks by mood for activities, seasons, and playlists",canProvide(n){var t,s;return["mood-playlist","activity","seasonal","focus-mode"].includes(n.sectionType)||((t=n.embedding)==null?void 0:t.method)==="mood"||!!((s=n.embedding)!=null&&s.mood)},async provide(n){var i,o,a;const{query:e}=n;let t=(i=e.embedding)==null?void 0:i.mood,s="";const r={chill:"chill relaxing lofi ambient calm",energetic:"upbeat energetic workout dance edm",happy:"happy feel good positive uplifting",sad:"sad emotional melancholy acoustic",focus:"focus concentration instrumental ambient study",party:"party dance club hits electronic",romantic:"romantic love songs ballads",uplifting:"uplifting motivational inspiring positive",workout:"workout gym training high energy electronic",running:"running cardio high bpm energetic",cooking:"cooking jazz soul feel good",gaming:"gaming electronic intense epic",study:"study focus lo-fi instrumental concentration",relaxing:"relaxing calm peaceful ambient",winter:"winter cozy acoustic warm indie",spring:"spring fresh uplifting indie pop",summer:"summer hits beach party tropical",autumn:"autumn fall chill acoustic indie"};if((o=e.search)!=null&&o.query)s=e.search.query;else if(t)s=r[t.toLowerCase()]||`${t} music`;else return[];try{if(!((a=window.api)!=null&&a.search))return[];console.log(`[MoodProvider] Searching: "${s}" for ${e.sectionType}`);const l=await window.api.search({query:s,type:"track",limit:e.limit||30});return l!=null&&l.length?(console.log(`[MoodProvider] Got ${l.length} tracks for ${t||e.sectionType}`),l):[]}catch(l){return console.error("[MoodProvider] Error:",l),[]}}},Fge={id:`${en}:decade`,pluginId:en,priority:75,name:"Decade Provider",description:"Fetches tracks by decade/era",canProvide(n){var e;return n.sectionType==="decade-mix"||!!((e=n.embedding)!=null&&e.yearRange)},async provide(n){var r,i,o;const{query:e}=n,t=(r=e.search)==null?void 0:r.query,s=(i=e.embedding)==null?void 0:i.yearRange;if(!t&&!s)return[];try{if(!((o=window.api)!=null&&o.search))return[];let a=t||"";if(s){const[u,d]=s;a.includes(String(u).slice(0,3))||(a+=` ${u}s hits`)}console.log(`[DecadeProvider] Searching: "${a}"`);const l=await window.api.search({query:a,type:"track",limit:e.limit||30});if(l!=null&&l.length){if(console.log(`[DecadeProvider] Got ${l.length} tracks`),s){const[u,d]=s;return l.sort((f,p)=>{var k,w;const g=(k=f.album)!=null&&k.releaseDate?new Date(f.album.releaseDate).getFullYear():0,x=(w=p.album)!=null&&w.releaseDate?new Date(p.album.releaseDate).getFullYear():0,y=g>=u&&g<=d?1:0;return(x>=u&&x<=d?1:0)-y})}return l}return[]}catch(a){return console.error("[DecadeProvider] Error:",a),[]}}},Oge={id:`${en}:personalized`,pluginId:en,priority:80,name:"Personalized Provider",description:"Provides personalized recommendations via ML",canProvide(n){var t;return["top-mix","weekly-rotation","time-greeting","on-repeat","rediscover","personalized","similar-tracks"].includes(n.sectionType)||((t=n.embedding)==null?void 0:t.method)==="personalized"},async provide(n){var e;try{if((e=window.api)!=null&&e.algoGetRecommendations){console.log("[PersonalizedProvider] Getting ML recommendations...");const t=await window.api.algoGetRecommendations(n.query.limit||30);if(t!=null&&t.length)return console.log(`[PersonalizedProvider] Got ${t.length} ML recommendations`),t}return console.log("[PersonalizedProvider] No ML data available, section will hide"),[]}catch(t){return console.error("[PersonalizedProvider] Error:",t),[]}}},_ge={id:`${en}:discovery`,pluginId:en,priority:65,name:"Discovery Provider",description:"Provides fresh discovery tracks",canProvide(n){var t;return["fresh-finds","deep-cuts","blind-picks","discover-weekly","discovery"].includes(n.sectionType)||((t=n.embedding)==null?void 0:t.method)==="discovery"},async provide(n){var e;try{if((e=window.api)!=null&&e.getTrending){const t=await vx("trending",async()=>await window.api.getTrending()),s=Array.isArray(t==null?void 0:t.tracks)?t.tracks:[];if(s.length>0)return[...s].sort(()=>Math.random()-.5).map(o=>{var a,l;return{...o,id:(l=(a=o.id)==null?void 0:a.startsWith)!=null&&l.call(a,"deezer:")?o.id:`deezer:${o.id}`,streamSources:o.streamSources||[],_meta:{metadataProvider:o._provider||"discovery",matchConfidence:1,externalIds:o.externalIds||{},lastUpdated:new Date().toISOString()}}}).slice(0,n.query.limit||30)}return console.log("[DiscoveryProvider] No trending data available, section will hide"),[]}catch(t){return console.error("[DiscoveryProvider] Error:",t),[]}}},zge={id:`${en}:new-releases`,pluginId:en,priority:75,name:"New Releases Provider",description:"Fetches new music releases",canProvide(n){return n.sectionType==="new-releases"},async provide(n){var e,t,s;try{if((e=window.api)!=null&&e.getNewReleases){console.log("[NewReleasesProvider] Using getNewReleases API...");const r=await window.api.getNewReleases({genre:(t=n.query.embedding)==null?void 0:t.genre,limit:n.query.limit||30});if(r!=null&&r.length)return console.log(`[NewReleasesProvider] Got ${r.length} new releases`),r}if((s=window.api)!=null&&s.getTrending){const r=await vx("trending",async()=>await window.api.getTrending()),i=Array.isArray(r==null?void 0:r.tracks)?r.tracks:[];if(i.length>0)return i.map(a=>{var l,u;return{...a,id:(u=(l=a.id)==null?void 0:l.startsWith)!=null&&u.call(l,"deezer:")?a.id:`deezer:${a.id}`,streamSources:a.streamSources||[],_meta:{metadataProvider:a._provider||"new-releases",matchConfidence:1,externalIds:a.externalIds||{},lastUpdated:new Date().toISOString()}}}).slice(0,n.query.limit||30)}return console.log("[NewReleasesProvider] No new releases data, section will hide"),[]}catch(r){return console.error("[NewReleasesProvider] Error:",r),[]}}},Bge={id:`${en}:layout`,pluginId:en,priority:50,name:"Layout Provider",description:"Handles layout sections with explicit queries",canProvide(n){var t,s,r;return["horizontal","grid","hero","masonry","banner","compact-list","large-cards","quick-picks","artist-spotlight","mood-gradient"].includes(n.sectionType)&&!!((t=n.search)!=null&&t.query||(s=n.embedding)!=null&&s.genre||(r=n.embedding)!=null&&r.mood)},async provide(n){var e,t,s,r;try{let o=((e=n.query.search)==null?void 0:e.query)||"";if(!o&&((t=n.query.embedding)!=null&&t.genre)&&(o=`${n.query.embedding.genre} music`),!o&&((s=n.query.embedding)!=null&&s.mood)&&(o=`${n.query.embedding.mood} music`),!o.trim())return console.log("[LayoutProvider] No explicit query, section will hide"),[];if(!((r=window.api)!=null&&r.search))return console.warn("[LayoutProvider] search API not available"),[];console.log(`[LayoutProvider] Searching for: ${o}`);const a=await vx(`layout:${n.query.sectionType}:${o}`,async()=>await window.api.search({query:o,type:"track",limit:n.query.limit||30}));return a!=null&&a.length?(console.log(`[LayoutProvider] Got ${a.length} results`),a):[]}catch(i){return console.error("[LayoutProvider] Error:",i),[]}}},Wge={id:`${en}:embedding`,pluginId:en,priority:95,canProvide(n){var t,s,r,i,o,a;return!!(["quick-picks","time-greeting","on-repeat","top-mix","rediscover","discover-weekly","mood-playlist","focus-mode","activity","seasonal","genre-explorer","decade-mix","hero","artist-radio","fresh-finds","deep-cuts","blind-picks"].includes(n.sectionType)||((t=n.embedding)==null?void 0:t.method)==="personalized"||((s=n.embedding)==null?void 0:s.method)==="mood"||((r=n.embedding)==null?void 0:r.method)==="genre"||((i=n.embedding)==null?void 0:i.method)==="discovery"||((o=n.embedding)==null?void 0:o.method)==="artist-radio"||((a=n.embedding)==null?void 0:a.method)==="similar")},async provide(n){var s,r,i,o,a,l,u,d,f,p,g,x,y;const{query:e}=n;if(!Kce())return console.log(`[EmbeddingProvider] Not ready (${mI()} tracks indexed)`),[];const t=mI();console.log(`[EmbeddingProvider] Generating for ${e.sectionType} (${t} tracks indexed)`);try{let b="personalized",k,w,N=.2;switch(e.sectionType){case"quick-picks":case"on-repeat":case"top-mix":b="personalized",N=.1;break;case"time-greeting":b="mood";const S=n.hour;S>=5&&S<12?k="uplifting":S>=12&&S<17?k="focus":(S>=17&&S<21,k="chill");break;case"mood-playlist":case"focus-mode":b="mood",k=((s=e.embedding)==null?void 0:s.mood)||"chill";break;case"activity":b="mood",k=((r=e.embedding)==null?void 0:r.mood)||"energetic",N=.25;break;case"seasonal":b="mood",k=((i=e.embedding)==null?void 0:i.mood)||"chill",N=.4;break;case"genre-explorer":b="genre",w=(o=e.embedding)==null?void 0:o.genre,N=.5;break;case"decade-mix":b="discovery",N=.3;break;case"discover-weekly":case"rediscover":case"fresh-finds":case"deep-cuts":case"blind-picks":b="discovery",N=((a=e.embedding)==null?void 0:a.exploration)||.6;break;case"hero":b="personalized",N=.3;break;case"artist-radio":b="artist-radio",N=((l=e.embedding)==null?void 0:l.exploration)||.3;break;default:((u=e.embedding)==null?void 0:u.method)==="mood"&&e.embedding.mood?(b="mood",k=e.embedding.mood):((d=e.embedding)==null?void 0:d.method)==="genre"&&e.embedding.genre?(b="genre",w=e.embedding.genre):((f=e.embedding)==null?void 0:f.method)==="discovery"?(b="discovery",N=e.embedding.exploration||.6):((p=e.embedding)==null?void 0:p.method)==="artist-radio"?(b="artist-radio",N=e.embedding.exploration||.3):((g=e.embedding)==null?void 0:g.method)==="similar"?(b="similar",N=e.embedding.exploration||.5):b="personalized"}const C=Xce(b,{mood:k,genre:w,artistId:(x=e.embedding)==null?void 0:x.seedArtistId,seedTrackIds:(y=e.embedding)==null?void 0:y.seedTrackIds,limit:e.limit||20,exploration:N});return C.length>0?(console.log(`[EmbeddingProvider] Generated ${C.length} tracks via ${b}`),C):(console.log("[EmbeddingProvider] No tracks generated, falling back"),[])}catch(b){return console.error("[EmbeddingProvider] Error:",b),[]}}},gT=[jge,Wge,Dge,Pge,Rge,Oge,Fge,zge,Mge,Lge,_ge,Bge];let xT=!1;function Vge(){if(!xT){for(const n of gT)Oa.registerProvider(n);xT=!0,console.log(`[CoreProviders] Registered ${gT.length} core providers`)}}const Uge=()=>{const{likedTracks:n,playlists:e}=Xt(),t=gt.useMemo(()=>{const s=n.map(i=>i.track);for(const i of e)s.push(...i.tracks);const r=new Set;return s.filter(i=>r.has(i.id)?!1:(r.add(i.id),!0))},[n,e]);return Zpe({availableTracks:t,enabled:!0}),null},Gge=()=>(sme(),null),Hge=()=>(rme(),null),qge=()=>(ime(),null),Kge=()=>{const n=Ke(t=>t.currentTrack),e=Wc(t=>t.prefetchLyrics);return j.useEffect(()=>{var t;if(n){const s=((t=n.artists[0])==null?void 0:t.name)||"";e(s,n.title,n.id)}},[n==null?void 0:n.id,e]),null},Qge=()=>(j.useEffect(()=>{Vge(),Tge(Oa);const n=Oa.getStats();console.log(`[PipelineManager] Initialized with ${n.transformers} transformers, ${n.providers} providers, ${n.enhancers} enhancers`)},[]),null),Xge=()=>{const{currentView:n,isSearchActive:e,searchQuery:t,setSearchQuery:s,clearSearch:r}=Wt(),{search:i,clear:o}=la(),a=qT(),l=()=>{r(),o()};if(n.startsWith("plugin-view-")){const u=n.replace("plugin-view-",""),d=a.getView(u);if(d){const f=d.component;return c.jsx(f,{})}return c.jsx(z0,{})}if(n==="home"){const u=e&&t;return c.jsxs("div",{className:`home-view ${u?"searching":""}`,children:[c.jsx(sfe,{onSearch:d=>{s(d),d&&i(d)},onClose:l,isSearchActive:!!u}),c.jsx("div",{className:"home-content",children:u?c.jsx(rfe,{}):c.jsx(z0,{})})]})}switch(n){case"likes":return c.jsx(lfe,{});case"dislikes":return c.jsx(dfe,{});case"playlists":return c.jsx(ffe,{});case"playlist-detail":return c.jsx(gfe,{});case"downloads":return c.jsx(yfe,{});case"plugins":return c.jsx(Ife,{});case"plugin-detail":return c.jsx(Rfe,{});case"settings":return c.jsx(vpe,{});case"stats":return c.jsx(Ype,{});case"artist-detail":return c.jsx(Ppe,{});case"album-detail":return c.jsx(_pe,{});case"section-detail":return c.jsx(Vpe,{});default:return c.jsx(z0,{})}},Yge=()=>{const[n,e]=j.useState(null),[t,s]=j.useState(null);return j.useEffect(()=>{z4()},[]),c.jsx(yge,{children:c.jsx(Que,{onAddToPlaylist:e,onDislike:s,children:c.jsxs(xde,{children:[c.jsx(W3,{}),c.jsxs("div",{className:"app",children:[c.jsx(Uge,{}),c.jsx(Gge,{}),c.jsx(Hge,{}),c.jsx(qge,{}),c.jsx(Kge,{}),c.jsx(Qge,{}),c.jsx(cme,{}),c.jsx(dme,{}),c.jsx(age,{}),c.jsx(gO,{}),c.jsx("main",{className:"main-content",children:c.jsx(Xge,{})}),c.jsx(xme,{}),c.jsx(gme,{}),c.jsx(nge,{}),c.jsx(tge,{})]}),n&&c.jsx(sge,{track:n,onClose:()=>e(null)}),t&&c.jsx(wM,{track:t,onClose:()=>s(null)}),c.jsx(ige,{})]})})})};B3.createRoot(document.getElementById("root")).render(c.jsx(gt.StrictMode,{children:c.jsx(Yge,{})}));
//# sourceMappingURL=index-D6eImHp3.js.map
