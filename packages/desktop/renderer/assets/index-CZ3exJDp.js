var f4=Object.defineProperty;var p4=(n,e,t)=>e in n?f4(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var Oc=(n,e,t)=>p4(n,typeof e!="symbol"?e+"":e,t);function m4(n,e){for(var t=0;t<e.length;t++){const s=e[t];if(typeof s!="string"&&!Array.isArray(s)){for(const r in s)if(r!=="default"&&!(r in n)){const o=Object.getOwnPropertyDescriptor(s,r);o&&Object.defineProperty(n,r,o.get?o:{enumerable:!0,get:()=>s[r]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function t(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(r){if(r.ep)return;r.ep=!0;const o=t(r);fetch(r.href,o)}})();function by(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function g4(n){if(Object.prototype.hasOwnProperty.call(n,"__esModule"))return n;var e=n.default;if(typeof e=="function"){var t=function s(){return this instanceof s?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(s){var r=Object.getOwnPropertyDescriptor(n,s);Object.defineProperty(t,s,r.get?r:{enumerable:!0,get:function(){return n[s]}})}),t}var Wx={exports:{}},_c={},Ux={exports:{}},it={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Yk;function x4(){if(Yk)return it;Yk=1;var n=Symbol.for("react.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),o=Symbol.for("react.provider"),i=Symbol.for("react.context"),a=Symbol.for("react.forward_ref"),l=Symbol.for("react.suspense"),u=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),f=Symbol.iterator;function m(O){return O===null||typeof O!="object"?null:(O=f&&O[f]||O["@@iterator"],typeof O=="function"?O:null)}var g={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},y=Object.assign,w={};function b(O,B,Y){this.props=O,this.context=B,this.refs=w,this.updater=Y||g}b.prototype.isReactComponent={},b.prototype.setState=function(O,B){if(typeof O!="object"&&typeof O!="function"&&O!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,O,B,"setState")},b.prototype.forceUpdate=function(O){this.updater.enqueueForceUpdate(this,O,"forceUpdate")};function k(){}k.prototype=b.prototype;function v(O,B,Y){this.props=O,this.context=B,this.refs=w,this.updater=Y||g}var N=v.prototype=new k;N.constructor=v,y(N,b.prototype),N.isPureReactComponent=!0;var S=Array.isArray,$=Object.prototype.hasOwnProperty,R={current:null},M={key:!0,ref:!0,__self:!0,__source:!0};function A(O,B,Y){var oe,Q={},ce=null,me=null;if(B!=null)for(oe in B.ref!==void 0&&(me=B.ref),B.key!==void 0&&(ce=""+B.key),B)$.call(B,oe)&&!M.hasOwnProperty(oe)&&(Q[oe]=B[oe]);var ge=arguments.length-2;if(ge===1)Q.children=Y;else if(1<ge){for(var ve=Array(ge),Ne=0;Ne<ge;Ne++)ve[Ne]=arguments[Ne+2];Q.children=ve}if(O&&O.defaultProps)for(oe in ge=O.defaultProps,ge)Q[oe]===void 0&&(Q[oe]=ge[oe]);return{$$typeof:n,type:O,key:ce,ref:me,props:Q,_owner:R.current}}function P(O,B){return{$$typeof:n,type:O.type,key:B,ref:O.ref,props:O.props,_owner:O._owner}}function D(O){return typeof O=="object"&&O!==null&&O.$$typeof===n}function E(O){var B={"=":"=0",":":"=2"};return"$"+O.replace(/[=:]/g,function(Y){return B[Y]})}var j=/\/+/g;function V(O,B){return typeof O=="object"&&O!==null&&O.key!=null?E(""+O.key):B.toString(36)}function W(O,B,Y,oe,Q){var ce=typeof O;(ce==="undefined"||ce==="boolean")&&(O=null);var me=!1;if(O===null)me=!0;else switch(ce){case"string":case"number":me=!0;break;case"object":switch(O.$$typeof){case n:case e:me=!0}}if(me)return me=O,Q=Q(me),O=oe===""?"."+V(me,0):oe,S(Q)?(Y="",O!=null&&(Y=O.replace(j,"$&/")+"/"),W(Q,B,Y,"",function(Ne){return Ne})):Q!=null&&(D(Q)&&(Q=P(Q,Y+(!Q.key||me&&me.key===Q.key?"":(""+Q.key).replace(j,"$&/")+"/")+O)),B.push(Q)),1;if(me=0,oe=oe===""?".":oe+":",S(O))for(var ge=0;ge<O.length;ge++){ce=O[ge];var ve=oe+V(ce,ge);me+=W(ce,B,Y,ve,Q)}else if(ve=m(O),typeof ve=="function")for(O=ve.call(O),ge=0;!(ce=O.next()).done;)ce=ce.value,ve=oe+V(ce,ge++),me+=W(ce,B,Y,ve,Q);else if(ce==="object")throw B=String(O),Error("Objects are not valid as a React child (found: "+(B==="[object Object]"?"object with keys {"+Object.keys(O).join(", ")+"}":B)+"). If you meant to render a collection of children, use an array instead.");return me}function U(O,B,Y){if(O==null)return O;var oe=[],Q=0;return W(O,oe,"","",function(ce){return B.call(Y,ce,Q++)}),oe}function X(O){if(O._status===-1){var B=O._result;B=B(),B.then(function(Y){(O._status===0||O._status===-1)&&(O._status=1,O._result=Y)},function(Y){(O._status===0||O._status===-1)&&(O._status=2,O._result=Y)}),O._status===-1&&(O._status=0,O._result=B)}if(O._status===1)return O._result.default;throw O._result}var ee={current:null},G={transition:null},z={ReactCurrentDispatcher:ee,ReactCurrentBatchConfig:G,ReactCurrentOwner:R};function H(){throw Error("act(...) is not supported in production builds of React.")}return it.Children={map:U,forEach:function(O,B,Y){U(O,function(){B.apply(this,arguments)},Y)},count:function(O){var B=0;return U(O,function(){B++}),B},toArray:function(O){return U(O,function(B){return B})||[]},only:function(O){if(!D(O))throw Error("React.Children.only expected to receive a single React element child.");return O}},it.Component=b,it.Fragment=t,it.Profiler=r,it.PureComponent=v,it.StrictMode=s,it.Suspense=l,it.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=z,it.act=H,it.cloneElement=function(O,B,Y){if(O==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+O+".");var oe=y({},O.props),Q=O.key,ce=O.ref,me=O._owner;if(B!=null){if(B.ref!==void 0&&(ce=B.ref,me=R.current),B.key!==void 0&&(Q=""+B.key),O.type&&O.type.defaultProps)var ge=O.type.defaultProps;for(ve in B)$.call(B,ve)&&!M.hasOwnProperty(ve)&&(oe[ve]=B[ve]===void 0&&ge!==void 0?ge[ve]:B[ve])}var ve=arguments.length-2;if(ve===1)oe.children=Y;else if(1<ve){ge=Array(ve);for(var Ne=0;Ne<ve;Ne++)ge[Ne]=arguments[Ne+2];oe.children=ge}return{$$typeof:n,type:O.type,key:Q,ref:ce,props:oe,_owner:me}},it.createContext=function(O){return O={$$typeof:i,_currentValue:O,_currentValue2:O,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},O.Provider={$$typeof:o,_context:O},O.Consumer=O},it.createElement=A,it.createFactory=function(O){var B=A.bind(null,O);return B.type=O,B},it.createRef=function(){return{current:null}},it.forwardRef=function(O){return{$$typeof:a,render:O}},it.isValidElement=D,it.lazy=function(O){return{$$typeof:d,_payload:{_status:-1,_result:O},_init:X}},it.memo=function(O,B){return{$$typeof:u,type:O,compare:B===void 0?null:B}},it.startTransition=function(O){var B=G.transition;G.transition={};try{O()}finally{G.transition=B}},it.unstable_act=H,it.useCallback=function(O,B){return ee.current.useCallback(O,B)},it.useContext=function(O){return ee.current.useContext(O)},it.useDebugValue=function(){},it.useDeferredValue=function(O){return ee.current.useDeferredValue(O)},it.useEffect=function(O,B){return ee.current.useEffect(O,B)},it.useId=function(){return ee.current.useId()},it.useImperativeHandle=function(O,B,Y){return ee.current.useImperativeHandle(O,B,Y)},it.useInsertionEffect=function(O,B){return ee.current.useInsertionEffect(O,B)},it.useLayoutEffect=function(O,B){return ee.current.useLayoutEffect(O,B)},it.useMemo=function(O,B){return ee.current.useMemo(O,B)},it.useReducer=function(O,B,Y){return ee.current.useReducer(O,B,Y)},it.useRef=function(O){return ee.current.useRef(O)},it.useState=function(O){return ee.current.useState(O)},it.useSyncExternalStore=function(O,B,Y){return ee.current.useSyncExternalStore(O,B,Y)},it.useTransition=function(){return ee.current.useTransition()},it.version="18.3.1",it}var Jk;function wy(){return Jk||(Jk=1,Ux.exports=x4()),Ux.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Zk;function y4(){if(Zk)return _c;Zk=1;var n=wy(),e=Symbol.for("react.element"),t=Symbol.for("react.fragment"),s=Object.prototype.hasOwnProperty,r=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,o={key:!0,ref:!0,__self:!0,__source:!0};function i(a,l,u){var d,f={},m=null,g=null;u!==void 0&&(m=""+u),l.key!==void 0&&(m=""+l.key),l.ref!==void 0&&(g=l.ref);for(d in l)s.call(l,d)&&!o.hasOwnProperty(d)&&(f[d]=l[d]);if(a&&a.defaultProps)for(d in l=a.defaultProps,l)f[d]===void 0&&(f[d]=l[d]);return{$$typeof:e,type:a,key:m,ref:g,props:f,_owner:r.current}}return _c.Fragment=t,_c.jsx=i,_c.jsxs=i,_c}var e2;function v4(){return e2||(e2=1,Wx.exports=y4()),Wx.exports}var p=v4(),L=wy();const Xt=by(L);var tf={},Gx={exports:{}},Is={},Hx={exports:{}},qx={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var t2;function b4(){return t2||(t2=1,(function(n){function e(G,z){var H=G.length;G.push(z);e:for(;0<H;){var O=H-1>>>1,B=G[O];if(0<r(B,z))G[O]=z,G[H]=B,H=O;else break e}}function t(G){return G.length===0?null:G[0]}function s(G){if(G.length===0)return null;var z=G[0],H=G.pop();if(H!==z){G[0]=H;e:for(var O=0,B=G.length,Y=B>>>1;O<Y;){var oe=2*(O+1)-1,Q=G[oe],ce=oe+1,me=G[ce];if(0>r(Q,H))ce<B&&0>r(me,Q)?(G[O]=me,G[ce]=H,O=ce):(G[O]=Q,G[oe]=H,O=oe);else if(ce<B&&0>r(me,H))G[O]=me,G[ce]=H,O=ce;else break e}}return z}function r(G,z){var H=G.sortIndex-z.sortIndex;return H!==0?H:G.id-z.id}if(typeof performance=="object"&&typeof performance.now=="function"){var o=performance;n.unstable_now=function(){return o.now()}}else{var i=Date,a=i.now();n.unstable_now=function(){return i.now()-a}}var l=[],u=[],d=1,f=null,m=3,g=!1,y=!1,w=!1,b=typeof setTimeout=="function"?setTimeout:null,k=typeof clearTimeout=="function"?clearTimeout:null,v=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function N(G){for(var z=t(u);z!==null;){if(z.callback===null)s(u);else if(z.startTime<=G)s(u),z.sortIndex=z.expirationTime,e(l,z);else break;z=t(u)}}function S(G){if(w=!1,N(G),!y)if(t(l)!==null)y=!0,X($);else{var z=t(u);z!==null&&ee(S,z.startTime-G)}}function $(G,z){y=!1,w&&(w=!1,k(A),A=-1),g=!0;var H=m;try{for(N(z),f=t(l);f!==null&&(!(f.expirationTime>z)||G&&!E());){var O=f.callback;if(typeof O=="function"){f.callback=null,m=f.priorityLevel;var B=O(f.expirationTime<=z);z=n.unstable_now(),typeof B=="function"?f.callback=B:f===t(l)&&s(l),N(z)}else s(l);f=t(l)}if(f!==null)var Y=!0;else{var oe=t(u);oe!==null&&ee(S,oe.startTime-z),Y=!1}return Y}finally{f=null,m=H,g=!1}}var R=!1,M=null,A=-1,P=5,D=-1;function E(){return!(n.unstable_now()-D<P)}function j(){if(M!==null){var G=n.unstable_now();D=G;var z=!0;try{z=M(!0,G)}finally{z?V():(R=!1,M=null)}}else R=!1}var V;if(typeof v=="function")V=function(){v(j)};else if(typeof MessageChannel<"u"){var W=new MessageChannel,U=W.port2;W.port1.onmessage=j,V=function(){U.postMessage(null)}}else V=function(){b(j,0)};function X(G){M=G,R||(R=!0,V())}function ee(G,z){A=b(function(){G(n.unstable_now())},z)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(G){G.callback=null},n.unstable_continueExecution=function(){y||g||(y=!0,X($))},n.unstable_forceFrameRate=function(G){0>G||125<G?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):P=0<G?Math.floor(1e3/G):5},n.unstable_getCurrentPriorityLevel=function(){return m},n.unstable_getFirstCallbackNode=function(){return t(l)},n.unstable_next=function(G){switch(m){case 1:case 2:case 3:var z=3;break;default:z=m}var H=m;m=z;try{return G()}finally{m=H}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(G,z){switch(G){case 1:case 2:case 3:case 4:case 5:break;default:G=3}var H=m;m=G;try{return z()}finally{m=H}},n.unstable_scheduleCallback=function(G,z,H){var O=n.unstable_now();switch(typeof H=="object"&&H!==null?(H=H.delay,H=typeof H=="number"&&0<H?O+H:O):H=O,G){case 1:var B=-1;break;case 2:B=250;break;case 5:B=1073741823;break;case 4:B=1e4;break;default:B=5e3}return B=H+B,G={id:d++,callback:z,priorityLevel:G,startTime:H,expirationTime:B,sortIndex:-1},H>O?(G.sortIndex=H,e(u,G),t(l)===null&&G===t(u)&&(w?(k(A),A=-1):w=!0,ee(S,H-O))):(G.sortIndex=B,e(l,G),y||g||(y=!0,X($))),G},n.unstable_shouldYield=E,n.unstable_wrapCallback=function(G){var z=m;return function(){var H=m;m=z;try{return G.apply(this,arguments)}finally{m=H}}}})(qx)),qx}var n2;function w4(){return n2||(n2=1,Hx.exports=b4()),Hx.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var s2;function k4(){if(s2)return Is;s2=1;var n=wy(),e=w4();function t(c){for(var h="https://reactjs.org/docs/error-decoder.html?invariant="+c,x=1;x<arguments.length;x++)h+="&args[]="+encodeURIComponent(arguments[x]);return"Minified React error #"+c+"; visit "+h+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var s=new Set,r={};function o(c,h){i(c,h),i(c+"Capture",h)}function i(c,h){for(r[c]=h,c=0;c<h.length;c++)s.add(h[c])}var a=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),l=Object.prototype.hasOwnProperty,u=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,d={},f={};function m(c){return l.call(f,c)?!0:l.call(d,c)?!1:u.test(c)?f[c]=!0:(d[c]=!0,!1)}function g(c,h,x,C){if(x!==null&&x.type===0)return!1;switch(typeof h){case"function":case"symbol":return!0;case"boolean":return C?!1:x!==null?!x.acceptsBooleans:(c=c.toLowerCase().slice(0,5),c!=="data-"&&c!=="aria-");default:return!1}}function y(c,h,x,C){if(h===null||typeof h>"u"||g(c,h,x,C))return!0;if(C)return!1;if(x!==null)switch(x.type){case 3:return!h;case 4:return h===!1;case 5:return isNaN(h);case 6:return isNaN(h)||1>h}return!1}function w(c,h,x,C,I,T,F){this.acceptsBooleans=h===2||h===3||h===4,this.attributeName=C,this.attributeNamespace=I,this.mustUseProperty=x,this.propertyName=c,this.type=h,this.sanitizeURL=T,this.removeEmptyString=F}var b={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(c){b[c]=new w(c,0,!1,c,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(c){var h=c[0];b[h]=new w(h,1,!1,c[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(c){b[c]=new w(c,2,!1,c.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(c){b[c]=new w(c,2,!1,c,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(c){b[c]=new w(c,3,!1,c.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(c){b[c]=new w(c,3,!0,c,null,!1,!1)}),["capture","download"].forEach(function(c){b[c]=new w(c,4,!1,c,null,!1,!1)}),["cols","rows","size","span"].forEach(function(c){b[c]=new w(c,6,!1,c,null,!1,!1)}),["rowSpan","start"].forEach(function(c){b[c]=new w(c,5,!1,c.toLowerCase(),null,!1,!1)});var k=/[\-:]([a-z])/g;function v(c){return c[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(c){var h=c.replace(k,v);b[h]=new w(h,1,!1,c,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(c){var h=c.replace(k,v);b[h]=new w(h,1,!1,c,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(c){var h=c.replace(k,v);b[h]=new w(h,1,!1,c,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(c){b[c]=new w(c,1,!1,c.toLowerCase(),null,!1,!1)}),b.xlinkHref=new w("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(c){b[c]=new w(c,1,!1,c.toLowerCase(),null,!0,!0)});function N(c,h,x,C){var I=b.hasOwnProperty(h)?b[h]:null;(I!==null?I.type!==0:C||!(2<h.length)||h[0]!=="o"&&h[0]!=="O"||h[1]!=="n"&&h[1]!=="N")&&(y(h,x,I,C)&&(x=null),C||I===null?m(h)&&(x===null?c.removeAttribute(h):c.setAttribute(h,""+x)):I.mustUseProperty?c[I.propertyName]=x===null?I.type===3?!1:"":x:(h=I.attributeName,C=I.attributeNamespace,x===null?c.removeAttribute(h):(I=I.type,x=I===3||I===4&&x===!0?"":""+x,C?c.setAttributeNS(C,h,x):c.setAttribute(h,x))))}var S=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,$=Symbol.for("react.element"),R=Symbol.for("react.portal"),M=Symbol.for("react.fragment"),A=Symbol.for("react.strict_mode"),P=Symbol.for("react.profiler"),D=Symbol.for("react.provider"),E=Symbol.for("react.context"),j=Symbol.for("react.forward_ref"),V=Symbol.for("react.suspense"),W=Symbol.for("react.suspense_list"),U=Symbol.for("react.memo"),X=Symbol.for("react.lazy"),ee=Symbol.for("react.offscreen"),G=Symbol.iterator;function z(c){return c===null||typeof c!="object"?null:(c=G&&c[G]||c["@@iterator"],typeof c=="function"?c:null)}var H=Object.assign,O;function B(c){if(O===void 0)try{throw Error()}catch(x){var h=x.stack.trim().match(/\n( *(at )?)/);O=h&&h[1]||""}return`
`+O+c}var Y=!1;function oe(c,h){if(!c||Y)return"";Y=!0;var x=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(h)if(h=function(){throw Error()},Object.defineProperty(h.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(h,[])}catch(he){var C=he}Reflect.construct(c,[],h)}else{try{h.call()}catch(he){C=he}c.call(h.prototype)}else{try{throw Error()}catch(he){C=he}c()}}catch(he){if(he&&C&&typeof he.stack=="string"){for(var I=he.stack.split(`
`),T=C.stack.split(`
`),F=I.length-1,q=T.length-1;1<=F&&0<=q&&I[F]!==T[q];)q--;for(;1<=F&&0<=q;F--,q--)if(I[F]!==T[q]){if(F!==1||q!==1)do if(F--,q--,0>q||I[F]!==T[q]){var J=`
`+I[F].replace(" at new "," at ");return c.displayName&&J.includes("<anonymous>")&&(J=J.replace("<anonymous>",c.displayName)),J}while(1<=F&&0<=q);break}}}finally{Y=!1,Error.prepareStackTrace=x}return(c=c?c.displayName||c.name:"")?B(c):""}function Q(c){switch(c.tag){case 5:return B(c.type);case 16:return B("Lazy");case 13:return B("Suspense");case 19:return B("SuspenseList");case 0:case 2:case 15:return c=oe(c.type,!1),c;case 11:return c=oe(c.type.render,!1),c;case 1:return c=oe(c.type,!0),c;default:return""}}function ce(c){if(c==null)return null;if(typeof c=="function")return c.displayName||c.name||null;if(typeof c=="string")return c;switch(c){case M:return"Fragment";case R:return"Portal";case P:return"Profiler";case A:return"StrictMode";case V:return"Suspense";case W:return"SuspenseList"}if(typeof c=="object")switch(c.$$typeof){case E:return(c.displayName||"Context")+".Consumer";case D:return(c._context.displayName||"Context")+".Provider";case j:var h=c.render;return c=c.displayName,c||(c=h.displayName||h.name||"",c=c!==""?"ForwardRef("+c+")":"ForwardRef"),c;case U:return h=c.displayName||null,h!==null?h:ce(c.type)||"Memo";case X:h=c._payload,c=c._init;try{return ce(c(h))}catch{}}return null}function me(c){var h=c.type;switch(c.tag){case 24:return"Cache";case 9:return(h.displayName||"Context")+".Consumer";case 10:return(h._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return c=h.render,c=c.displayName||c.name||"",h.displayName||(c!==""?"ForwardRef("+c+")":"ForwardRef");case 7:return"Fragment";case 5:return h;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return ce(h);case 8:return h===A?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof h=="function")return h.displayName||h.name||null;if(typeof h=="string")return h}return null}function ge(c){switch(typeof c){case"boolean":case"number":case"string":case"undefined":return c;case"object":return c;default:return""}}function ve(c){var h=c.type;return(c=c.nodeName)&&c.toLowerCase()==="input"&&(h==="checkbox"||h==="radio")}function Ne(c){var h=ve(c)?"checked":"value",x=Object.getOwnPropertyDescriptor(c.constructor.prototype,h),C=""+c[h];if(!c.hasOwnProperty(h)&&typeof x<"u"&&typeof x.get=="function"&&typeof x.set=="function"){var I=x.get,T=x.set;return Object.defineProperty(c,h,{configurable:!0,get:function(){return I.call(this)},set:function(F){C=""+F,T.call(this,F)}}),Object.defineProperty(c,h,{enumerable:x.enumerable}),{getValue:function(){return C},setValue:function(F){C=""+F},stopTracking:function(){c._valueTracker=null,delete c[h]}}}}function Me(c){c._valueTracker||(c._valueTracker=Ne(c))}function Ue(c){if(!c)return!1;var h=c._valueTracker;if(!h)return!0;var x=h.getValue(),C="";return c&&(C=ve(c)?c.checked?"true":"false":c.value),c=C,c!==x?(h.setValue(c),!0):!1}function Qe(c){if(c=c||(typeof document<"u"?document:void 0),typeof c>"u")return null;try{return c.activeElement||c.body}catch{return c.body}}function ye(c,h){var x=h.checked;return H({},h,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:x??c._wrapperState.initialChecked})}function Ce(c,h){var x=h.defaultValue==null?"":h.defaultValue,C=h.checked!=null?h.checked:h.defaultChecked;x=ge(h.value!=null?h.value:x),c._wrapperState={initialChecked:C,initialValue:x,controlled:h.type==="checkbox"||h.type==="radio"?h.checked!=null:h.value!=null}}function be(c,h){h=h.checked,h!=null&&N(c,"checked",h,!1)}function xe(c,h){be(c,h);var x=ge(h.value),C=h.type;if(x!=null)C==="number"?(x===0&&c.value===""||c.value!=x)&&(c.value=""+x):c.value!==""+x&&(c.value=""+x);else if(C==="submit"||C==="reset"){c.removeAttribute("value");return}h.hasOwnProperty("value")?Dt(c,h.type,x):h.hasOwnProperty("defaultValue")&&Dt(c,h.type,ge(h.defaultValue)),h.checked==null&&h.defaultChecked!=null&&(c.defaultChecked=!!h.defaultChecked)}function Be(c,h,x){if(h.hasOwnProperty("value")||h.hasOwnProperty("defaultValue")){var C=h.type;if(!(C!=="submit"&&C!=="reset"||h.value!==void 0&&h.value!==null))return;h=""+c._wrapperState.initialValue,x||h===c.value||(c.value=h),c.defaultValue=h}x=c.name,x!==""&&(c.name=""),c.defaultChecked=!!c._wrapperState.initialChecked,x!==""&&(c.name=x)}function Dt(c,h,x){(h!=="number"||Qe(c.ownerDocument)!==c)&&(x==null?c.defaultValue=""+c._wrapperState.initialValue:c.defaultValue!==""+x&&(c.defaultValue=""+x))}var at=Array.isArray;function Ht(c,h,x,C){if(c=c.options,h){h={};for(var I=0;I<x.length;I++)h["$"+x[I]]=!0;for(x=0;x<c.length;x++)I=h.hasOwnProperty("$"+c[x].value),c[x].selected!==I&&(c[x].selected=I),I&&C&&(c[x].defaultSelected=!0)}else{for(x=""+ge(x),h=null,I=0;I<c.length;I++){if(c[I].value===x){c[I].selected=!0,C&&(c[I].defaultSelected=!0);return}h!==null||c[I].disabled||(h=c[I])}h!==null&&(h.selected=!0)}}function Mt(c,h){if(h.dangerouslySetInnerHTML!=null)throw Error(t(91));return H({},h,{value:void 0,defaultValue:void 0,children:""+c._wrapperState.initialValue})}function is(c,h){var x=h.value;if(x==null){if(x=h.children,h=h.defaultValue,x!=null){if(h!=null)throw Error(t(92));if(at(x)){if(1<x.length)throw Error(t(93));x=x[0]}h=x}h==null&&(h=""),x=h}c._wrapperState={initialValue:ge(x)}}function ln(c,h){var x=ge(h.value),C=ge(h.defaultValue);x!=null&&(x=""+x,x!==c.value&&(c.value=x),h.defaultValue==null&&c.defaultValue!==x&&(c.defaultValue=x)),C!=null&&(c.defaultValue=""+C)}function Fn(c){var h=c.textContent;h===c._wrapperState.initialValue&&h!==""&&h!==null&&(c.value=h)}function Gn(c){switch(c){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function qt(c,h){return c==null||c==="http://www.w3.org/1999/xhtml"?Gn(h):c==="http://www.w3.org/2000/svg"&&h==="foreignObject"?"http://www.w3.org/1999/xhtml":c}var Le,et=(function(c){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(h,x,C,I){MSApp.execUnsafeLocalFunction(function(){return c(h,x,C,I)})}:c})(function(c,h){if(c.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in c)c.innerHTML=h;else{for(Le=Le||document.createElement("div"),Le.innerHTML="<svg>"+h.valueOf().toString()+"</svg>",h=Le.firstChild;c.firstChild;)c.removeChild(c.firstChild);for(;h.firstChild;)c.appendChild(h.firstChild)}});function vt(c,h){if(h){var x=c.firstChild;if(x&&x===c.lastChild&&x.nodeType===3){x.nodeValue=h;return}}c.textContent=h}var Nt={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Ia=["Webkit","ms","Moz","O"];Object.keys(Nt).forEach(function(c){Ia.forEach(function(h){h=h+c.charAt(0).toUpperCase()+c.substring(1),Nt[h]=Nt[c]})});function io(c,h,x){return h==null||typeof h=="boolean"||h===""?"":x||typeof h!="number"||h===0||Nt.hasOwnProperty(c)&&Nt[c]?(""+h).trim():h+"px"}function $a(c,h){c=c.style;for(var x in h)if(h.hasOwnProperty(x)){var C=x.indexOf("--")===0,I=io(x,h[x],C);x==="float"&&(x="cssFloat"),C?c.setProperty(x,I):c[x]=I}}var Si=H({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Ta(c,h){if(h){if(Si[c]&&(h.children!=null||h.dangerouslySetInnerHTML!=null))throw Error(t(137,c));if(h.dangerouslySetInnerHTML!=null){if(h.children!=null)throw Error(t(60));if(typeof h.dangerouslySetInnerHTML!="object"||!("__html"in h.dangerouslySetInnerHTML))throw Error(t(61))}if(h.style!=null&&typeof h.style!="object")throw Error(t(62))}}function tc(c,h){if(c.indexOf("-")===-1)return typeof h.is=="string";switch(c){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Ea=null;function nc(c){return c=c.target||c.srcElement||window,c.correspondingUseElement&&(c=c.correspondingUseElement),c.nodeType===3?c.parentNode:c}var sc=null,Ro=null,Vt=null;function Hn(c){if(c=Cc(c)){if(typeof sc!="function")throw Error(t(280));var h=c.stateNode;h&&(h=gh(h),sc(c.stateNode,c.type,h))}}function qn(c){Ro?Vt?Vt.push(c):Vt=[c]:Ro=c}function fr(){if(Ro){var c=Ro,h=Vt;if(Vt=Ro=null,Hn(c),h)for(c=0;c<h.length;c++)Hn(h[c])}}function as(c,h){return c(h)}function Kn(){}var bs=!1;function ao(c,h,x){if(bs)return c(h,x);bs=!0;try{return as(c,h,x)}finally{bs=!1,(Ro!==null||Vt!==null)&&(Kn(),fr())}}function Wt(c,h){var x=c.stateNode;if(x===null)return null;var C=gh(x);if(C===null)return null;x=C[h];e:switch(h){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(C=!C.disabled)||(c=c.type,C=!(c==="button"||c==="input"||c==="select"||c==="textarea")),c=!C;break e;default:c=!1}if(c)return null;if(x&&typeof x!="function")throw Error(t(231,h,typeof x));return x}var qs=!1;if(a)try{var Xn={};Object.defineProperty(Xn,"passive",{get:function(){qs=!0}}),window.addEventListener("test",Xn,Xn),window.removeEventListener("test",Xn,Xn)}catch{qs=!1}function pr(c,h,x,C,I,T,F,q,J){var he=Array.prototype.slice.call(arguments,3);try{h.apply(x,he)}catch(Se){this.onError(Se)}}var mr=!1,Lr=null,Ls=!1,lo=null,rc={onError:function(c){mr=!0,Lr=c}};function wD(c,h,x,C,I,T,F,q,J){mr=!1,Lr=null,pr.apply(rc,arguments)}function kD(c,h,x,C,I,T,F,q,J){if(wD.apply(this,arguments),mr){if(mr){var he=Lr;mr=!1,Lr=null}else throw Error(t(198));Ls||(Ls=!0,lo=he)}}function Ni(c){var h=c,x=c;if(c.alternate)for(;h.return;)h=h.return;else{c=h;do h=c,(h.flags&4098)!==0&&(x=h.return),c=h.return;while(c)}return h.tag===3?x:null}function bb(c){if(c.tag===13){var h=c.memoizedState;if(h===null&&(c=c.alternate,c!==null&&(h=c.memoizedState)),h!==null)return h.dehydrated}return null}function wb(c){if(Ni(c)!==c)throw Error(t(188))}function CD(c){var h=c.alternate;if(!h){if(h=Ni(c),h===null)throw Error(t(188));return h!==c?null:c}for(var x=c,C=h;;){var I=x.return;if(I===null)break;var T=I.alternate;if(T===null){if(C=I.return,C!==null){x=C;continue}break}if(I.child===T.child){for(T=I.child;T;){if(T===x)return wb(I),c;if(T===C)return wb(I),h;T=T.sibling}throw Error(t(188))}if(x.return!==C.return)x=I,C=T;else{for(var F=!1,q=I.child;q;){if(q===x){F=!0,x=I,C=T;break}if(q===C){F=!0,C=I,x=T;break}q=q.sibling}if(!F){for(q=T.child;q;){if(q===x){F=!0,x=T,C=I;break}if(q===C){F=!0,C=T,x=I;break}q=q.sibling}if(!F)throw Error(t(189))}}if(x.alternate!==C)throw Error(t(190))}if(x.tag!==3)throw Error(t(188));return x.stateNode.current===x?c:h}function kb(c){return c=CD(c),c!==null?Cb(c):null}function Cb(c){if(c.tag===5||c.tag===6)return c;for(c=c.child;c!==null;){var h=Cb(c);if(h!==null)return h;c=c.sibling}return null}var Sb=e.unstable_scheduleCallback,Nb=e.unstable_cancelCallback,SD=e.unstable_shouldYield,ND=e.unstable_requestPaint,nn=e.unstable_now,ID=e.unstable_getCurrentPriorityLevel,cg=e.unstable_ImmediatePriority,Ib=e.unstable_UserBlockingPriority,Qd=e.unstable_NormalPriority,$D=e.unstable_LowPriority,$b=e.unstable_IdlePriority,Yd=null,jr=null;function TD(c){if(jr&&typeof jr.onCommitFiberRoot=="function")try{jr.onCommitFiberRoot(Yd,c,void 0,(c.current.flags&128)===128)}catch{}}var gr=Math.clz32?Math.clz32:AD,ED=Math.log,RD=Math.LN2;function AD(c){return c>>>=0,c===0?32:31-(ED(c)/RD|0)|0}var Jd=64,Zd=4194304;function oc(c){switch(c&-c){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return c&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return c&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return c}}function eh(c,h){var x=c.pendingLanes;if(x===0)return 0;var C=0,I=c.suspendedLanes,T=c.pingedLanes,F=x&268435455;if(F!==0){var q=F&~I;q!==0?C=oc(q):(T&=F,T!==0&&(C=oc(T)))}else F=x&~I,F!==0?C=oc(F):T!==0&&(C=oc(T));if(C===0)return 0;if(h!==0&&h!==C&&(h&I)===0&&(I=C&-C,T=h&-h,I>=T||I===16&&(T&4194240)!==0))return h;if((C&4)!==0&&(C|=x&16),h=c.entangledLanes,h!==0)for(c=c.entanglements,h&=C;0<h;)x=31-gr(h),I=1<<x,C|=c[x],h&=~I;return C}function DD(c,h){switch(c){case 1:case 2:case 4:return h+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return h+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function MD(c,h){for(var x=c.suspendedLanes,C=c.pingedLanes,I=c.expirationTimes,T=c.pendingLanes;0<T;){var F=31-gr(T),q=1<<F,J=I[F];J===-1?((q&x)===0||(q&C)!==0)&&(I[F]=DD(q,h)):J<=h&&(c.expiredLanes|=q),T&=~q}}function ug(c){return c=c.pendingLanes&-1073741825,c!==0?c:c&1073741824?1073741824:0}function Tb(){var c=Jd;return Jd<<=1,(Jd&4194240)===0&&(Jd=64),c}function dg(c){for(var h=[],x=0;31>x;x++)h.push(c);return h}function ic(c,h,x){c.pendingLanes|=h,h!==536870912&&(c.suspendedLanes=0,c.pingedLanes=0),c=c.eventTimes,h=31-gr(h),c[h]=x}function PD(c,h){var x=c.pendingLanes&~h;c.pendingLanes=h,c.suspendedLanes=0,c.pingedLanes=0,c.expiredLanes&=h,c.mutableReadLanes&=h,c.entangledLanes&=h,h=c.entanglements;var C=c.eventTimes;for(c=c.expirationTimes;0<x;){var I=31-gr(x),T=1<<I;h[I]=0,C[I]=-1,c[I]=-1,x&=~T}}function hg(c,h){var x=c.entangledLanes|=h;for(c=c.entanglements;x;){var C=31-gr(x),I=1<<C;I&h|c[C]&h&&(c[C]|=h),x&=~I}}var kt=0;function Eb(c){return c&=-c,1<c?4<c?(c&268435455)!==0?16:536870912:4:1}var Rb,fg,Ab,Db,Mb,pg=!1,th=[],Ao=null,Do=null,Mo=null,ac=new Map,lc=new Map,Po=[],FD="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Pb(c,h){switch(c){case"focusin":case"focusout":Ao=null;break;case"dragenter":case"dragleave":Do=null;break;case"mouseover":case"mouseout":Mo=null;break;case"pointerover":case"pointerout":ac.delete(h.pointerId);break;case"gotpointercapture":case"lostpointercapture":lc.delete(h.pointerId)}}function cc(c,h,x,C,I,T){return c===null||c.nativeEvent!==T?(c={blockedOn:h,domEventName:x,eventSystemFlags:C,nativeEvent:T,targetContainers:[I]},h!==null&&(h=Cc(h),h!==null&&fg(h)),c):(c.eventSystemFlags|=C,h=c.targetContainers,I!==null&&h.indexOf(I)===-1&&h.push(I),c)}function LD(c,h,x,C,I){switch(h){case"focusin":return Ao=cc(Ao,c,h,x,C,I),!0;case"dragenter":return Do=cc(Do,c,h,x,C,I),!0;case"mouseover":return Mo=cc(Mo,c,h,x,C,I),!0;case"pointerover":var T=I.pointerId;return ac.set(T,cc(ac.get(T)||null,c,h,x,C,I)),!0;case"gotpointercapture":return T=I.pointerId,lc.set(T,cc(lc.get(T)||null,c,h,x,C,I)),!0}return!1}function Fb(c){var h=Ii(c.target);if(h!==null){var x=Ni(h);if(x!==null){if(h=x.tag,h===13){if(h=bb(x),h!==null){c.blockedOn=h,Mb(c.priority,function(){Ab(x)});return}}else if(h===3&&x.stateNode.current.memoizedState.isDehydrated){c.blockedOn=x.tag===3?x.stateNode.containerInfo:null;return}}}c.blockedOn=null}function nh(c){if(c.blockedOn!==null)return!1;for(var h=c.targetContainers;0<h.length;){var x=gg(c.domEventName,c.eventSystemFlags,h[0],c.nativeEvent);if(x===null){x=c.nativeEvent;var C=new x.constructor(x.type,x);Ea=C,x.target.dispatchEvent(C),Ea=null}else return h=Cc(x),h!==null&&fg(h),c.blockedOn=x,!1;h.shift()}return!0}function Lb(c,h,x){nh(c)&&x.delete(h)}function jD(){pg=!1,Ao!==null&&nh(Ao)&&(Ao=null),Do!==null&&nh(Do)&&(Do=null),Mo!==null&&nh(Mo)&&(Mo=null),ac.forEach(Lb),lc.forEach(Lb)}function uc(c,h){c.blockedOn===h&&(c.blockedOn=null,pg||(pg=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,jD)))}function dc(c){function h(I){return uc(I,c)}if(0<th.length){uc(th[0],c);for(var x=1;x<th.length;x++){var C=th[x];C.blockedOn===c&&(C.blockedOn=null)}}for(Ao!==null&&uc(Ao,c),Do!==null&&uc(Do,c),Mo!==null&&uc(Mo,c),ac.forEach(h),lc.forEach(h),x=0;x<Po.length;x++)C=Po[x],C.blockedOn===c&&(C.blockedOn=null);for(;0<Po.length&&(x=Po[0],x.blockedOn===null);)Fb(x),x.blockedOn===null&&Po.shift()}var Ra=S.ReactCurrentBatchConfig,sh=!0;function OD(c,h,x,C){var I=kt,T=Ra.transition;Ra.transition=null;try{kt=1,mg(c,h,x,C)}finally{kt=I,Ra.transition=T}}function _D(c,h,x,C){var I=kt,T=Ra.transition;Ra.transition=null;try{kt=4,mg(c,h,x,C)}finally{kt=I,Ra.transition=T}}function mg(c,h,x,C){if(sh){var I=gg(c,h,x,C);if(I===null)Mg(c,h,C,rh,x),Pb(c,C);else if(LD(I,c,h,x,C))C.stopPropagation();else if(Pb(c,C),h&4&&-1<FD.indexOf(c)){for(;I!==null;){var T=Cc(I);if(T!==null&&Rb(T),T=gg(c,h,x,C),T===null&&Mg(c,h,C,rh,x),T===I)break;I=T}I!==null&&C.stopPropagation()}else Mg(c,h,C,null,x)}}var rh=null;function gg(c,h,x,C){if(rh=null,c=nc(C),c=Ii(c),c!==null)if(h=Ni(c),h===null)c=null;else if(x=h.tag,x===13){if(c=bb(h),c!==null)return c;c=null}else if(x===3){if(h.stateNode.current.memoizedState.isDehydrated)return h.tag===3?h.stateNode.containerInfo:null;c=null}else h!==c&&(c=null);return rh=c,null}function jb(c){switch(c){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(ID()){case cg:return 1;case Ib:return 4;case Qd:case $D:return 16;case $b:return 536870912;default:return 16}default:return 16}}var Fo=null,xg=null,oh=null;function Ob(){if(oh)return oh;var c,h=xg,x=h.length,C,I="value"in Fo?Fo.value:Fo.textContent,T=I.length;for(c=0;c<x&&h[c]===I[c];c++);var F=x-c;for(C=1;C<=F&&h[x-C]===I[T-C];C++);return oh=I.slice(c,1<C?1-C:void 0)}function ih(c){var h=c.keyCode;return"charCode"in c?(c=c.charCode,c===0&&h===13&&(c=13)):c=h,c===10&&(c=13),32<=c||c===13?c:0}function ah(){return!0}function _b(){return!1}function js(c){function h(x,C,I,T,F){this._reactName=x,this._targetInst=I,this.type=C,this.nativeEvent=T,this.target=F,this.currentTarget=null;for(var q in c)c.hasOwnProperty(q)&&(x=c[q],this[q]=x?x(T):T[q]);return this.isDefaultPrevented=(T.defaultPrevented!=null?T.defaultPrevented:T.returnValue===!1)?ah:_b,this.isPropagationStopped=_b,this}return H(h.prototype,{preventDefault:function(){this.defaultPrevented=!0;var x=this.nativeEvent;x&&(x.preventDefault?x.preventDefault():typeof x.returnValue!="unknown"&&(x.returnValue=!1),this.isDefaultPrevented=ah)},stopPropagation:function(){var x=this.nativeEvent;x&&(x.stopPropagation?x.stopPropagation():typeof x.cancelBubble!="unknown"&&(x.cancelBubble=!0),this.isPropagationStopped=ah)},persist:function(){},isPersistent:ah}),h}var Aa={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(c){return c.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},yg=js(Aa),hc=H({},Aa,{view:0,detail:0}),zD=js(hc),vg,bg,fc,lh=H({},hc,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:kg,button:0,buttons:0,relatedTarget:function(c){return c.relatedTarget===void 0?c.fromElement===c.srcElement?c.toElement:c.fromElement:c.relatedTarget},movementX:function(c){return"movementX"in c?c.movementX:(c!==fc&&(fc&&c.type==="mousemove"?(vg=c.screenX-fc.screenX,bg=c.screenY-fc.screenY):bg=vg=0,fc=c),vg)},movementY:function(c){return"movementY"in c?c.movementY:bg}}),zb=js(lh),BD=H({},lh,{dataTransfer:0}),VD=js(BD),WD=H({},hc,{relatedTarget:0}),wg=js(WD),UD=H({},Aa,{animationName:0,elapsedTime:0,pseudoElement:0}),GD=js(UD),HD=H({},Aa,{clipboardData:function(c){return"clipboardData"in c?c.clipboardData:window.clipboardData}}),qD=js(HD),KD=H({},Aa,{data:0}),Bb=js(KD),XD={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},QD={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},YD={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function JD(c){var h=this.nativeEvent;return h.getModifierState?h.getModifierState(c):(c=YD[c])?!!h[c]:!1}function kg(){return JD}var ZD=H({},hc,{key:function(c){if(c.key){var h=XD[c.key]||c.key;if(h!=="Unidentified")return h}return c.type==="keypress"?(c=ih(c),c===13?"Enter":String.fromCharCode(c)):c.type==="keydown"||c.type==="keyup"?QD[c.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:kg,charCode:function(c){return c.type==="keypress"?ih(c):0},keyCode:function(c){return c.type==="keydown"||c.type==="keyup"?c.keyCode:0},which:function(c){return c.type==="keypress"?ih(c):c.type==="keydown"||c.type==="keyup"?c.keyCode:0}}),e3=js(ZD),t3=H({},lh,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Vb=js(t3),n3=H({},hc,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:kg}),s3=js(n3),r3=H({},Aa,{propertyName:0,elapsedTime:0,pseudoElement:0}),o3=js(r3),i3=H({},lh,{deltaX:function(c){return"deltaX"in c?c.deltaX:"wheelDeltaX"in c?-c.wheelDeltaX:0},deltaY:function(c){return"deltaY"in c?c.deltaY:"wheelDeltaY"in c?-c.wheelDeltaY:"wheelDelta"in c?-c.wheelDelta:0},deltaZ:0,deltaMode:0}),a3=js(i3),l3=[9,13,27,32],Cg=a&&"CompositionEvent"in window,pc=null;a&&"documentMode"in document&&(pc=document.documentMode);var c3=a&&"TextEvent"in window&&!pc,Wb=a&&(!Cg||pc&&8<pc&&11>=pc),Ub=" ",Gb=!1;function Hb(c,h){switch(c){case"keyup":return l3.indexOf(h.keyCode)!==-1;case"keydown":return h.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function qb(c){return c=c.detail,typeof c=="object"&&"data"in c?c.data:null}var Da=!1;function u3(c,h){switch(c){case"compositionend":return qb(h);case"keypress":return h.which!==32?null:(Gb=!0,Ub);case"textInput":return c=h.data,c===Ub&&Gb?null:c;default:return null}}function d3(c,h){if(Da)return c==="compositionend"||!Cg&&Hb(c,h)?(c=Ob(),oh=xg=Fo=null,Da=!1,c):null;switch(c){case"paste":return null;case"keypress":if(!(h.ctrlKey||h.altKey||h.metaKey)||h.ctrlKey&&h.altKey){if(h.char&&1<h.char.length)return h.char;if(h.which)return String.fromCharCode(h.which)}return null;case"compositionend":return Wb&&h.locale!=="ko"?null:h.data;default:return null}}var h3={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Kb(c){var h=c&&c.nodeName&&c.nodeName.toLowerCase();return h==="input"?!!h3[c.type]:h==="textarea"}function Xb(c,h,x,C){qn(C),h=fh(h,"onChange"),0<h.length&&(x=new yg("onChange","change",null,x,C),c.push({event:x,listeners:h}))}var mc=null,gc=null;function f3(c){fw(c,0)}function ch(c){var h=ja(c);if(Ue(h))return c}function p3(c,h){if(c==="change")return h}var Qb=!1;if(a){var Sg;if(a){var Ng="oninput"in document;if(!Ng){var Yb=document.createElement("div");Yb.setAttribute("oninput","return;"),Ng=typeof Yb.oninput=="function"}Sg=Ng}else Sg=!1;Qb=Sg&&(!document.documentMode||9<document.documentMode)}function Jb(){mc&&(mc.detachEvent("onpropertychange",Zb),gc=mc=null)}function Zb(c){if(c.propertyName==="value"&&ch(gc)){var h=[];Xb(h,gc,c,nc(c)),ao(f3,h)}}function m3(c,h,x){c==="focusin"?(Jb(),mc=h,gc=x,mc.attachEvent("onpropertychange",Zb)):c==="focusout"&&Jb()}function g3(c){if(c==="selectionchange"||c==="keyup"||c==="keydown")return ch(gc)}function x3(c,h){if(c==="click")return ch(h)}function y3(c,h){if(c==="input"||c==="change")return ch(h)}function v3(c,h){return c===h&&(c!==0||1/c===1/h)||c!==c&&h!==h}var xr=typeof Object.is=="function"?Object.is:v3;function xc(c,h){if(xr(c,h))return!0;if(typeof c!="object"||c===null||typeof h!="object"||h===null)return!1;var x=Object.keys(c),C=Object.keys(h);if(x.length!==C.length)return!1;for(C=0;C<x.length;C++){var I=x[C];if(!l.call(h,I)||!xr(c[I],h[I]))return!1}return!0}function ew(c){for(;c&&c.firstChild;)c=c.firstChild;return c}function tw(c,h){var x=ew(c);c=0;for(var C;x;){if(x.nodeType===3){if(C=c+x.textContent.length,c<=h&&C>=h)return{node:x,offset:h-c};c=C}e:{for(;x;){if(x.nextSibling){x=x.nextSibling;break e}x=x.parentNode}x=void 0}x=ew(x)}}function nw(c,h){return c&&h?c===h?!0:c&&c.nodeType===3?!1:h&&h.nodeType===3?nw(c,h.parentNode):"contains"in c?c.contains(h):c.compareDocumentPosition?!!(c.compareDocumentPosition(h)&16):!1:!1}function sw(){for(var c=window,h=Qe();h instanceof c.HTMLIFrameElement;){try{var x=typeof h.contentWindow.location.href=="string"}catch{x=!1}if(x)c=h.contentWindow;else break;h=Qe(c.document)}return h}function Ig(c){var h=c&&c.nodeName&&c.nodeName.toLowerCase();return h&&(h==="input"&&(c.type==="text"||c.type==="search"||c.type==="tel"||c.type==="url"||c.type==="password")||h==="textarea"||c.contentEditable==="true")}function b3(c){var h=sw(),x=c.focusedElem,C=c.selectionRange;if(h!==x&&x&&x.ownerDocument&&nw(x.ownerDocument.documentElement,x)){if(C!==null&&Ig(x)){if(h=C.start,c=C.end,c===void 0&&(c=h),"selectionStart"in x)x.selectionStart=h,x.selectionEnd=Math.min(c,x.value.length);else if(c=(h=x.ownerDocument||document)&&h.defaultView||window,c.getSelection){c=c.getSelection();var I=x.textContent.length,T=Math.min(C.start,I);C=C.end===void 0?T:Math.min(C.end,I),!c.extend&&T>C&&(I=C,C=T,T=I),I=tw(x,T);var F=tw(x,C);I&&F&&(c.rangeCount!==1||c.anchorNode!==I.node||c.anchorOffset!==I.offset||c.focusNode!==F.node||c.focusOffset!==F.offset)&&(h=h.createRange(),h.setStart(I.node,I.offset),c.removeAllRanges(),T>C?(c.addRange(h),c.extend(F.node,F.offset)):(h.setEnd(F.node,F.offset),c.addRange(h)))}}for(h=[],c=x;c=c.parentNode;)c.nodeType===1&&h.push({element:c,left:c.scrollLeft,top:c.scrollTop});for(typeof x.focus=="function"&&x.focus(),x=0;x<h.length;x++)c=h[x],c.element.scrollLeft=c.left,c.element.scrollTop=c.top}}var w3=a&&"documentMode"in document&&11>=document.documentMode,Ma=null,$g=null,yc=null,Tg=!1;function rw(c,h,x){var C=x.window===x?x.document:x.nodeType===9?x:x.ownerDocument;Tg||Ma==null||Ma!==Qe(C)||(C=Ma,"selectionStart"in C&&Ig(C)?C={start:C.selectionStart,end:C.selectionEnd}:(C=(C.ownerDocument&&C.ownerDocument.defaultView||window).getSelection(),C={anchorNode:C.anchorNode,anchorOffset:C.anchorOffset,focusNode:C.focusNode,focusOffset:C.focusOffset}),yc&&xc(yc,C)||(yc=C,C=fh($g,"onSelect"),0<C.length&&(h=new yg("onSelect","select",null,h,x),c.push({event:h,listeners:C}),h.target=Ma)))}function uh(c,h){var x={};return x[c.toLowerCase()]=h.toLowerCase(),x["Webkit"+c]="webkit"+h,x["Moz"+c]="moz"+h,x}var Pa={animationend:uh("Animation","AnimationEnd"),animationiteration:uh("Animation","AnimationIteration"),animationstart:uh("Animation","AnimationStart"),transitionend:uh("Transition","TransitionEnd")},Eg={},ow={};a&&(ow=document.createElement("div").style,"AnimationEvent"in window||(delete Pa.animationend.animation,delete Pa.animationiteration.animation,delete Pa.animationstart.animation),"TransitionEvent"in window||delete Pa.transitionend.transition);function dh(c){if(Eg[c])return Eg[c];if(!Pa[c])return c;var h=Pa[c],x;for(x in h)if(h.hasOwnProperty(x)&&x in ow)return Eg[c]=h[x];return c}var iw=dh("animationend"),aw=dh("animationiteration"),lw=dh("animationstart"),cw=dh("transitionend"),uw=new Map,dw="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Lo(c,h){uw.set(c,h),o(h,[c])}for(var Rg=0;Rg<dw.length;Rg++){var Ag=dw[Rg],k3=Ag.toLowerCase(),C3=Ag[0].toUpperCase()+Ag.slice(1);Lo(k3,"on"+C3)}Lo(iw,"onAnimationEnd"),Lo(aw,"onAnimationIteration"),Lo(lw,"onAnimationStart"),Lo("dblclick","onDoubleClick"),Lo("focusin","onFocus"),Lo("focusout","onBlur"),Lo(cw,"onTransitionEnd"),i("onMouseEnter",["mouseout","mouseover"]),i("onMouseLeave",["mouseout","mouseover"]),i("onPointerEnter",["pointerout","pointerover"]),i("onPointerLeave",["pointerout","pointerover"]),o("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),o("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),o("onBeforeInput",["compositionend","keypress","textInput","paste"]),o("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),o("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),o("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var vc="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),S3=new Set("cancel close invalid load scroll toggle".split(" ").concat(vc));function hw(c,h,x){var C=c.type||"unknown-event";c.currentTarget=x,kD(C,h,void 0,c),c.currentTarget=null}function fw(c,h){h=(h&4)!==0;for(var x=0;x<c.length;x++){var C=c[x],I=C.event;C=C.listeners;e:{var T=void 0;if(h)for(var F=C.length-1;0<=F;F--){var q=C[F],J=q.instance,he=q.currentTarget;if(q=q.listener,J!==T&&I.isPropagationStopped())break e;hw(I,q,he),T=J}else for(F=0;F<C.length;F++){if(q=C[F],J=q.instance,he=q.currentTarget,q=q.listener,J!==T&&I.isPropagationStopped())break e;hw(I,q,he),T=J}}}if(Ls)throw c=lo,Ls=!1,lo=null,c}function Pt(c,h){var x=h[_g];x===void 0&&(x=h[_g]=new Set);var C=c+"__bubble";x.has(C)||(pw(h,c,2,!1),x.add(C))}function Dg(c,h,x){var C=0;h&&(C|=4),pw(x,c,C,h)}var hh="_reactListening"+Math.random().toString(36).slice(2);function bc(c){if(!c[hh]){c[hh]=!0,s.forEach(function(x){x!=="selectionchange"&&(S3.has(x)||Dg(x,!1,c),Dg(x,!0,c))});var h=c.nodeType===9?c:c.ownerDocument;h===null||h[hh]||(h[hh]=!0,Dg("selectionchange",!1,h))}}function pw(c,h,x,C){switch(jb(h)){case 1:var I=OD;break;case 4:I=_D;break;default:I=mg}x=I.bind(null,h,x,c),I=void 0,!qs||h!=="touchstart"&&h!=="touchmove"&&h!=="wheel"||(I=!0),C?I!==void 0?c.addEventListener(h,x,{capture:!0,passive:I}):c.addEventListener(h,x,!0):I!==void 0?c.addEventListener(h,x,{passive:I}):c.addEventListener(h,x,!1)}function Mg(c,h,x,C,I){var T=C;if((h&1)===0&&(h&2)===0&&C!==null)e:for(;;){if(C===null)return;var F=C.tag;if(F===3||F===4){var q=C.stateNode.containerInfo;if(q===I||q.nodeType===8&&q.parentNode===I)break;if(F===4)for(F=C.return;F!==null;){var J=F.tag;if((J===3||J===4)&&(J=F.stateNode.containerInfo,J===I||J.nodeType===8&&J.parentNode===I))return;F=F.return}for(;q!==null;){if(F=Ii(q),F===null)return;if(J=F.tag,J===5||J===6){C=T=F;continue e}q=q.parentNode}}C=C.return}ao(function(){var he=T,Se=nc(x),$e=[];e:{var ke=uw.get(c);if(ke!==void 0){var De=yg,je=c;switch(c){case"keypress":if(ih(x)===0)break e;case"keydown":case"keyup":De=e3;break;case"focusin":je="focus",De=wg;break;case"focusout":je="blur",De=wg;break;case"beforeblur":case"afterblur":De=wg;break;case"click":if(x.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":De=zb;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":De=VD;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":De=s3;break;case iw:case aw:case lw:De=GD;break;case cw:De=o3;break;case"scroll":De=zD;break;case"wheel":De=a3;break;case"copy":case"cut":case"paste":De=qD;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":De=Vb}var _e=(h&4)!==0,sn=!_e&&c==="scroll",ae=_e?ke!==null?ke+"Capture":null:ke;_e=[];for(var ne=he,ue;ne!==null;){ue=ne;var Te=ue.stateNode;if(ue.tag===5&&Te!==null&&(ue=Te,ae!==null&&(Te=Wt(ne,ae),Te!=null&&_e.push(wc(ne,Te,ue)))),sn)break;ne=ne.return}0<_e.length&&(ke=new De(ke,je,null,x,Se),$e.push({event:ke,listeners:_e}))}}if((h&7)===0){e:{if(ke=c==="mouseover"||c==="pointerover",De=c==="mouseout"||c==="pointerout",ke&&x!==Ea&&(je=x.relatedTarget||x.fromElement)&&(Ii(je)||je[co]))break e;if((De||ke)&&(ke=Se.window===Se?Se:(ke=Se.ownerDocument)?ke.defaultView||ke.parentWindow:window,De?(je=x.relatedTarget||x.toElement,De=he,je=je?Ii(je):null,je!==null&&(sn=Ni(je),je!==sn||je.tag!==5&&je.tag!==6)&&(je=null)):(De=null,je=he),De!==je)){if(_e=zb,Te="onMouseLeave",ae="onMouseEnter",ne="mouse",(c==="pointerout"||c==="pointerover")&&(_e=Vb,Te="onPointerLeave",ae="onPointerEnter",ne="pointer"),sn=De==null?ke:ja(De),ue=je==null?ke:ja(je),ke=new _e(Te,ne+"leave",De,x,Se),ke.target=sn,ke.relatedTarget=ue,Te=null,Ii(Se)===he&&(_e=new _e(ae,ne+"enter",je,x,Se),_e.target=ue,_e.relatedTarget=sn,Te=_e),sn=Te,De&&je)t:{for(_e=De,ae=je,ne=0,ue=_e;ue;ue=Fa(ue))ne++;for(ue=0,Te=ae;Te;Te=Fa(Te))ue++;for(;0<ne-ue;)_e=Fa(_e),ne--;for(;0<ue-ne;)ae=Fa(ae),ue--;for(;ne--;){if(_e===ae||ae!==null&&_e===ae.alternate)break t;_e=Fa(_e),ae=Fa(ae)}_e=null}else _e=null;De!==null&&mw($e,ke,De,_e,!1),je!==null&&sn!==null&&mw($e,sn,je,_e,!0)}}e:{if(ke=he?ja(he):window,De=ke.nodeName&&ke.nodeName.toLowerCase(),De==="select"||De==="input"&&ke.type==="file")var ze=p3;else if(Kb(ke))if(Qb)ze=y3;else{ze=g3;var He=m3}else(De=ke.nodeName)&&De.toLowerCase()==="input"&&(ke.type==="checkbox"||ke.type==="radio")&&(ze=x3);if(ze&&(ze=ze(c,he))){Xb($e,ze,x,Se);break e}He&&He(c,ke,he),c==="focusout"&&(He=ke._wrapperState)&&He.controlled&&ke.type==="number"&&Dt(ke,"number",ke.value)}switch(He=he?ja(he):window,c){case"focusin":(Kb(He)||He.contentEditable==="true")&&(Ma=He,$g=he,yc=null);break;case"focusout":yc=$g=Ma=null;break;case"mousedown":Tg=!0;break;case"contextmenu":case"mouseup":case"dragend":Tg=!1,rw($e,x,Se);break;case"selectionchange":if(w3)break;case"keydown":case"keyup":rw($e,x,Se)}var qe;if(Cg)e:{switch(c){case"compositionstart":var Je="onCompositionStart";break e;case"compositionend":Je="onCompositionEnd";break e;case"compositionupdate":Je="onCompositionUpdate";break e}Je=void 0}else Da?Hb(c,x)&&(Je="onCompositionEnd"):c==="keydown"&&x.keyCode===229&&(Je="onCompositionStart");Je&&(Wb&&x.locale!=="ko"&&(Da||Je!=="onCompositionStart"?Je==="onCompositionEnd"&&Da&&(qe=Ob()):(Fo=Se,xg="value"in Fo?Fo.value:Fo.textContent,Da=!0)),He=fh(he,Je),0<He.length&&(Je=new Bb(Je,c,null,x,Se),$e.push({event:Je,listeners:He}),qe?Je.data=qe:(qe=qb(x),qe!==null&&(Je.data=qe)))),(qe=c3?u3(c,x):d3(c,x))&&(he=fh(he,"onBeforeInput"),0<he.length&&(Se=new Bb("onBeforeInput","beforeinput",null,x,Se),$e.push({event:Se,listeners:he}),Se.data=qe))}fw($e,h)})}function wc(c,h,x){return{instance:c,listener:h,currentTarget:x}}function fh(c,h){for(var x=h+"Capture",C=[];c!==null;){var I=c,T=I.stateNode;I.tag===5&&T!==null&&(I=T,T=Wt(c,x),T!=null&&C.unshift(wc(c,T,I)),T=Wt(c,h),T!=null&&C.push(wc(c,T,I))),c=c.return}return C}function Fa(c){if(c===null)return null;do c=c.return;while(c&&c.tag!==5);return c||null}function mw(c,h,x,C,I){for(var T=h._reactName,F=[];x!==null&&x!==C;){var q=x,J=q.alternate,he=q.stateNode;if(J!==null&&J===C)break;q.tag===5&&he!==null&&(q=he,I?(J=Wt(x,T),J!=null&&F.unshift(wc(x,J,q))):I||(J=Wt(x,T),J!=null&&F.push(wc(x,J,q)))),x=x.return}F.length!==0&&c.push({event:h,listeners:F})}var N3=/\r\n?/g,I3=/\u0000|\uFFFD/g;function gw(c){return(typeof c=="string"?c:""+c).replace(N3,`
`).replace(I3,"")}function ph(c,h,x){if(h=gw(h),gw(c)!==h&&x)throw Error(t(425))}function mh(){}var Pg=null,Fg=null;function Lg(c,h){return c==="textarea"||c==="noscript"||typeof h.children=="string"||typeof h.children=="number"||typeof h.dangerouslySetInnerHTML=="object"&&h.dangerouslySetInnerHTML!==null&&h.dangerouslySetInnerHTML.__html!=null}var jg=typeof setTimeout=="function"?setTimeout:void 0,$3=typeof clearTimeout=="function"?clearTimeout:void 0,xw=typeof Promise=="function"?Promise:void 0,T3=typeof queueMicrotask=="function"?queueMicrotask:typeof xw<"u"?function(c){return xw.resolve(null).then(c).catch(E3)}:jg;function E3(c){setTimeout(function(){throw c})}function Og(c,h){var x=h,C=0;do{var I=x.nextSibling;if(c.removeChild(x),I&&I.nodeType===8)if(x=I.data,x==="/$"){if(C===0){c.removeChild(I),dc(h);return}C--}else x!=="$"&&x!=="$?"&&x!=="$!"||C++;x=I}while(x);dc(h)}function jo(c){for(;c!=null;c=c.nextSibling){var h=c.nodeType;if(h===1||h===3)break;if(h===8){if(h=c.data,h==="$"||h==="$!"||h==="$?")break;if(h==="/$")return null}}return c}function yw(c){c=c.previousSibling;for(var h=0;c;){if(c.nodeType===8){var x=c.data;if(x==="$"||x==="$!"||x==="$?"){if(h===0)return c;h--}else x==="/$"&&h++}c=c.previousSibling}return null}var La=Math.random().toString(36).slice(2),Or="__reactFiber$"+La,kc="__reactProps$"+La,co="__reactContainer$"+La,_g="__reactEvents$"+La,R3="__reactListeners$"+La,A3="__reactHandles$"+La;function Ii(c){var h=c[Or];if(h)return h;for(var x=c.parentNode;x;){if(h=x[co]||x[Or]){if(x=h.alternate,h.child!==null||x!==null&&x.child!==null)for(c=yw(c);c!==null;){if(x=c[Or])return x;c=yw(c)}return h}c=x,x=c.parentNode}return null}function Cc(c){return c=c[Or]||c[co],!c||c.tag!==5&&c.tag!==6&&c.tag!==13&&c.tag!==3?null:c}function ja(c){if(c.tag===5||c.tag===6)return c.stateNode;throw Error(t(33))}function gh(c){return c[kc]||null}var zg=[],Oa=-1;function Oo(c){return{current:c}}function Ft(c){0>Oa||(c.current=zg[Oa],zg[Oa]=null,Oa--)}function Et(c,h){Oa++,zg[Oa]=c.current,c.current=h}var _o={},Qn=Oo(_o),ws=Oo(!1),$i=_o;function _a(c,h){var x=c.type.contextTypes;if(!x)return _o;var C=c.stateNode;if(C&&C.__reactInternalMemoizedUnmaskedChildContext===h)return C.__reactInternalMemoizedMaskedChildContext;var I={},T;for(T in x)I[T]=h[T];return C&&(c=c.stateNode,c.__reactInternalMemoizedUnmaskedChildContext=h,c.__reactInternalMemoizedMaskedChildContext=I),I}function ks(c){return c=c.childContextTypes,c!=null}function xh(){Ft(ws),Ft(Qn)}function vw(c,h,x){if(Qn.current!==_o)throw Error(t(168));Et(Qn,h),Et(ws,x)}function bw(c,h,x){var C=c.stateNode;if(h=h.childContextTypes,typeof C.getChildContext!="function")return x;C=C.getChildContext();for(var I in C)if(!(I in h))throw Error(t(108,me(c)||"Unknown",I));return H({},x,C)}function yh(c){return c=(c=c.stateNode)&&c.__reactInternalMemoizedMergedChildContext||_o,$i=Qn.current,Et(Qn,c),Et(ws,ws.current),!0}function ww(c,h,x){var C=c.stateNode;if(!C)throw Error(t(169));x?(c=bw(c,h,$i),C.__reactInternalMemoizedMergedChildContext=c,Ft(ws),Ft(Qn),Et(Qn,c)):Ft(ws),Et(ws,x)}var uo=null,vh=!1,Bg=!1;function kw(c){uo===null?uo=[c]:uo.push(c)}function D3(c){vh=!0,kw(c)}function zo(){if(!Bg&&uo!==null){Bg=!0;var c=0,h=kt;try{var x=uo;for(kt=1;c<x.length;c++){var C=x[c];do C=C(!0);while(C!==null)}uo=null,vh=!1}catch(I){throw uo!==null&&(uo=uo.slice(c+1)),Sb(cg,zo),I}finally{kt=h,Bg=!1}}return null}var za=[],Ba=0,bh=null,wh=0,Ks=[],Xs=0,Ti=null,ho=1,fo="";function Ei(c,h){za[Ba++]=wh,za[Ba++]=bh,bh=c,wh=h}function Cw(c,h,x){Ks[Xs++]=ho,Ks[Xs++]=fo,Ks[Xs++]=Ti,Ti=c;var C=ho;c=fo;var I=32-gr(C)-1;C&=~(1<<I),x+=1;var T=32-gr(h)+I;if(30<T){var F=I-I%5;T=(C&(1<<F)-1).toString(32),C>>=F,I-=F,ho=1<<32-gr(h)+I|x<<I|C,fo=T+c}else ho=1<<T|x<<I|C,fo=c}function Vg(c){c.return!==null&&(Ei(c,1),Cw(c,1,0))}function Wg(c){for(;c===bh;)bh=za[--Ba],za[Ba]=null,wh=za[--Ba],za[Ba]=null;for(;c===Ti;)Ti=Ks[--Xs],Ks[Xs]=null,fo=Ks[--Xs],Ks[Xs]=null,ho=Ks[--Xs],Ks[Xs]=null}var Os=null,_s=null,Ot=!1,yr=null;function Sw(c,h){var x=Zs(5,null,null,0);x.elementType="DELETED",x.stateNode=h,x.return=c,h=c.deletions,h===null?(c.deletions=[x],c.flags|=16):h.push(x)}function Nw(c,h){switch(c.tag){case 5:var x=c.type;return h=h.nodeType!==1||x.toLowerCase()!==h.nodeName.toLowerCase()?null:h,h!==null?(c.stateNode=h,Os=c,_s=jo(h.firstChild),!0):!1;case 6:return h=c.pendingProps===""||h.nodeType!==3?null:h,h!==null?(c.stateNode=h,Os=c,_s=null,!0):!1;case 13:return h=h.nodeType!==8?null:h,h!==null?(x=Ti!==null?{id:ho,overflow:fo}:null,c.memoizedState={dehydrated:h,treeContext:x,retryLane:1073741824},x=Zs(18,null,null,0),x.stateNode=h,x.return=c,c.child=x,Os=c,_s=null,!0):!1;default:return!1}}function Ug(c){return(c.mode&1)!==0&&(c.flags&128)===0}function Gg(c){if(Ot){var h=_s;if(h){var x=h;if(!Nw(c,h)){if(Ug(c))throw Error(t(418));h=jo(x.nextSibling);var C=Os;h&&Nw(c,h)?Sw(C,x):(c.flags=c.flags&-4097|2,Ot=!1,Os=c)}}else{if(Ug(c))throw Error(t(418));c.flags=c.flags&-4097|2,Ot=!1,Os=c}}}function Iw(c){for(c=c.return;c!==null&&c.tag!==5&&c.tag!==3&&c.tag!==13;)c=c.return;Os=c}function kh(c){if(c!==Os)return!1;if(!Ot)return Iw(c),Ot=!0,!1;var h;if((h=c.tag!==3)&&!(h=c.tag!==5)&&(h=c.type,h=h!=="head"&&h!=="body"&&!Lg(c.type,c.memoizedProps)),h&&(h=_s)){if(Ug(c))throw $w(),Error(t(418));for(;h;)Sw(c,h),h=jo(h.nextSibling)}if(Iw(c),c.tag===13){if(c=c.memoizedState,c=c!==null?c.dehydrated:null,!c)throw Error(t(317));e:{for(c=c.nextSibling,h=0;c;){if(c.nodeType===8){var x=c.data;if(x==="/$"){if(h===0){_s=jo(c.nextSibling);break e}h--}else x!=="$"&&x!=="$!"&&x!=="$?"||h++}c=c.nextSibling}_s=null}}else _s=Os?jo(c.stateNode.nextSibling):null;return!0}function $w(){for(var c=_s;c;)c=jo(c.nextSibling)}function Va(){_s=Os=null,Ot=!1}function Hg(c){yr===null?yr=[c]:yr.push(c)}var M3=S.ReactCurrentBatchConfig;function Sc(c,h,x){if(c=x.ref,c!==null&&typeof c!="function"&&typeof c!="object"){if(x._owner){if(x=x._owner,x){if(x.tag!==1)throw Error(t(309));var C=x.stateNode}if(!C)throw Error(t(147,c));var I=C,T=""+c;return h!==null&&h.ref!==null&&typeof h.ref=="function"&&h.ref._stringRef===T?h.ref:(h=function(F){var q=I.refs;F===null?delete q[T]:q[T]=F},h._stringRef=T,h)}if(typeof c!="string")throw Error(t(284));if(!x._owner)throw Error(t(290,c))}return c}function Ch(c,h){throw c=Object.prototype.toString.call(h),Error(t(31,c==="[object Object]"?"object with keys {"+Object.keys(h).join(", ")+"}":c))}function Tw(c){var h=c._init;return h(c._payload)}function Ew(c){function h(ae,ne){if(c){var ue=ae.deletions;ue===null?(ae.deletions=[ne],ae.flags|=16):ue.push(ne)}}function x(ae,ne){if(!c)return null;for(;ne!==null;)h(ae,ne),ne=ne.sibling;return null}function C(ae,ne){for(ae=new Map;ne!==null;)ne.key!==null?ae.set(ne.key,ne):ae.set(ne.index,ne),ne=ne.sibling;return ae}function I(ae,ne){return ae=Ko(ae,ne),ae.index=0,ae.sibling=null,ae}function T(ae,ne,ue){return ae.index=ue,c?(ue=ae.alternate,ue!==null?(ue=ue.index,ue<ne?(ae.flags|=2,ne):ue):(ae.flags|=2,ne)):(ae.flags|=1048576,ne)}function F(ae){return c&&ae.alternate===null&&(ae.flags|=2),ae}function q(ae,ne,ue,Te){return ne===null||ne.tag!==6?(ne=jx(ue,ae.mode,Te),ne.return=ae,ne):(ne=I(ne,ue),ne.return=ae,ne)}function J(ae,ne,ue,Te){var ze=ue.type;return ze===M?Se(ae,ne,ue.props.children,Te,ue.key):ne!==null&&(ne.elementType===ze||typeof ze=="object"&&ze!==null&&ze.$$typeof===X&&Tw(ze)===ne.type)?(Te=I(ne,ue.props),Te.ref=Sc(ae,ne,ue),Te.return=ae,Te):(Te=qh(ue.type,ue.key,ue.props,null,ae.mode,Te),Te.ref=Sc(ae,ne,ue),Te.return=ae,Te)}function he(ae,ne,ue,Te){return ne===null||ne.tag!==4||ne.stateNode.containerInfo!==ue.containerInfo||ne.stateNode.implementation!==ue.implementation?(ne=Ox(ue,ae.mode,Te),ne.return=ae,ne):(ne=I(ne,ue.children||[]),ne.return=ae,ne)}function Se(ae,ne,ue,Te,ze){return ne===null||ne.tag!==7?(ne=ji(ue,ae.mode,Te,ze),ne.return=ae,ne):(ne=I(ne,ue),ne.return=ae,ne)}function $e(ae,ne,ue){if(typeof ne=="string"&&ne!==""||typeof ne=="number")return ne=jx(""+ne,ae.mode,ue),ne.return=ae,ne;if(typeof ne=="object"&&ne!==null){switch(ne.$$typeof){case $:return ue=qh(ne.type,ne.key,ne.props,null,ae.mode,ue),ue.ref=Sc(ae,null,ne),ue.return=ae,ue;case R:return ne=Ox(ne,ae.mode,ue),ne.return=ae,ne;case X:var Te=ne._init;return $e(ae,Te(ne._payload),ue)}if(at(ne)||z(ne))return ne=ji(ne,ae.mode,ue,null),ne.return=ae,ne;Ch(ae,ne)}return null}function ke(ae,ne,ue,Te){var ze=ne!==null?ne.key:null;if(typeof ue=="string"&&ue!==""||typeof ue=="number")return ze!==null?null:q(ae,ne,""+ue,Te);if(typeof ue=="object"&&ue!==null){switch(ue.$$typeof){case $:return ue.key===ze?J(ae,ne,ue,Te):null;case R:return ue.key===ze?he(ae,ne,ue,Te):null;case X:return ze=ue._init,ke(ae,ne,ze(ue._payload),Te)}if(at(ue)||z(ue))return ze!==null?null:Se(ae,ne,ue,Te,null);Ch(ae,ue)}return null}function De(ae,ne,ue,Te,ze){if(typeof Te=="string"&&Te!==""||typeof Te=="number")return ae=ae.get(ue)||null,q(ne,ae,""+Te,ze);if(typeof Te=="object"&&Te!==null){switch(Te.$$typeof){case $:return ae=ae.get(Te.key===null?ue:Te.key)||null,J(ne,ae,Te,ze);case R:return ae=ae.get(Te.key===null?ue:Te.key)||null,he(ne,ae,Te,ze);case X:var He=Te._init;return De(ae,ne,ue,He(Te._payload),ze)}if(at(Te)||z(Te))return ae=ae.get(ue)||null,Se(ne,ae,Te,ze,null);Ch(ne,Te)}return null}function je(ae,ne,ue,Te){for(var ze=null,He=null,qe=ne,Je=ne=0,$n=null;qe!==null&&Je<ue.length;Je++){qe.index>Je?($n=qe,qe=null):$n=qe.sibling;var pt=ke(ae,qe,ue[Je],Te);if(pt===null){qe===null&&(qe=$n);break}c&&qe&&pt.alternate===null&&h(ae,qe),ne=T(pt,ne,Je),He===null?ze=pt:He.sibling=pt,He=pt,qe=$n}if(Je===ue.length)return x(ae,qe),Ot&&Ei(ae,Je),ze;if(qe===null){for(;Je<ue.length;Je++)qe=$e(ae,ue[Je],Te),qe!==null&&(ne=T(qe,ne,Je),He===null?ze=qe:He.sibling=qe,He=qe);return Ot&&Ei(ae,Je),ze}for(qe=C(ae,qe);Je<ue.length;Je++)$n=De(qe,ae,Je,ue[Je],Te),$n!==null&&(c&&$n.alternate!==null&&qe.delete($n.key===null?Je:$n.key),ne=T($n,ne,Je),He===null?ze=$n:He.sibling=$n,He=$n);return c&&qe.forEach(function(Xo){return h(ae,Xo)}),Ot&&Ei(ae,Je),ze}function _e(ae,ne,ue,Te){var ze=z(ue);if(typeof ze!="function")throw Error(t(150));if(ue=ze.call(ue),ue==null)throw Error(t(151));for(var He=ze=null,qe=ne,Je=ne=0,$n=null,pt=ue.next();qe!==null&&!pt.done;Je++,pt=ue.next()){qe.index>Je?($n=qe,qe=null):$n=qe.sibling;var Xo=ke(ae,qe,pt.value,Te);if(Xo===null){qe===null&&(qe=$n);break}c&&qe&&Xo.alternate===null&&h(ae,qe),ne=T(Xo,ne,Je),He===null?ze=Xo:He.sibling=Xo,He=Xo,qe=$n}if(pt.done)return x(ae,qe),Ot&&Ei(ae,Je),ze;if(qe===null){for(;!pt.done;Je++,pt=ue.next())pt=$e(ae,pt.value,Te),pt!==null&&(ne=T(pt,ne,Je),He===null?ze=pt:He.sibling=pt,He=pt);return Ot&&Ei(ae,Je),ze}for(qe=C(ae,qe);!pt.done;Je++,pt=ue.next())pt=De(qe,ae,Je,pt.value,Te),pt!==null&&(c&&pt.alternate!==null&&qe.delete(pt.key===null?Je:pt.key),ne=T(pt,ne,Je),He===null?ze=pt:He.sibling=pt,He=pt);return c&&qe.forEach(function(h4){return h(ae,h4)}),Ot&&Ei(ae,Je),ze}function sn(ae,ne,ue,Te){if(typeof ue=="object"&&ue!==null&&ue.type===M&&ue.key===null&&(ue=ue.props.children),typeof ue=="object"&&ue!==null){switch(ue.$$typeof){case $:e:{for(var ze=ue.key,He=ne;He!==null;){if(He.key===ze){if(ze=ue.type,ze===M){if(He.tag===7){x(ae,He.sibling),ne=I(He,ue.props.children),ne.return=ae,ae=ne;break e}}else if(He.elementType===ze||typeof ze=="object"&&ze!==null&&ze.$$typeof===X&&Tw(ze)===He.type){x(ae,He.sibling),ne=I(He,ue.props),ne.ref=Sc(ae,He,ue),ne.return=ae,ae=ne;break e}x(ae,He);break}else h(ae,He);He=He.sibling}ue.type===M?(ne=ji(ue.props.children,ae.mode,Te,ue.key),ne.return=ae,ae=ne):(Te=qh(ue.type,ue.key,ue.props,null,ae.mode,Te),Te.ref=Sc(ae,ne,ue),Te.return=ae,ae=Te)}return F(ae);case R:e:{for(He=ue.key;ne!==null;){if(ne.key===He)if(ne.tag===4&&ne.stateNode.containerInfo===ue.containerInfo&&ne.stateNode.implementation===ue.implementation){x(ae,ne.sibling),ne=I(ne,ue.children||[]),ne.return=ae,ae=ne;break e}else{x(ae,ne);break}else h(ae,ne);ne=ne.sibling}ne=Ox(ue,ae.mode,Te),ne.return=ae,ae=ne}return F(ae);case X:return He=ue._init,sn(ae,ne,He(ue._payload),Te)}if(at(ue))return je(ae,ne,ue,Te);if(z(ue))return _e(ae,ne,ue,Te);Ch(ae,ue)}return typeof ue=="string"&&ue!==""||typeof ue=="number"?(ue=""+ue,ne!==null&&ne.tag===6?(x(ae,ne.sibling),ne=I(ne,ue),ne.return=ae,ae=ne):(x(ae,ne),ne=jx(ue,ae.mode,Te),ne.return=ae,ae=ne),F(ae)):x(ae,ne)}return sn}var Wa=Ew(!0),Rw=Ew(!1),Sh=Oo(null),Nh=null,Ua=null,qg=null;function Kg(){qg=Ua=Nh=null}function Xg(c){var h=Sh.current;Ft(Sh),c._currentValue=h}function Qg(c,h,x){for(;c!==null;){var C=c.alternate;if((c.childLanes&h)!==h?(c.childLanes|=h,C!==null&&(C.childLanes|=h)):C!==null&&(C.childLanes&h)!==h&&(C.childLanes|=h),c===x)break;c=c.return}}function Ga(c,h){Nh=c,qg=Ua=null,c=c.dependencies,c!==null&&c.firstContext!==null&&((c.lanes&h)!==0&&(Cs=!0),c.firstContext=null)}function Qs(c){var h=c._currentValue;if(qg!==c)if(c={context:c,memoizedValue:h,next:null},Ua===null){if(Nh===null)throw Error(t(308));Ua=c,Nh.dependencies={lanes:0,firstContext:c}}else Ua=Ua.next=c;return h}var Ri=null;function Yg(c){Ri===null?Ri=[c]:Ri.push(c)}function Aw(c,h,x,C){var I=h.interleaved;return I===null?(x.next=x,Yg(h)):(x.next=I.next,I.next=x),h.interleaved=x,po(c,C)}function po(c,h){c.lanes|=h;var x=c.alternate;for(x!==null&&(x.lanes|=h),x=c,c=c.return;c!==null;)c.childLanes|=h,x=c.alternate,x!==null&&(x.childLanes|=h),x=c,c=c.return;return x.tag===3?x.stateNode:null}var Bo=!1;function Jg(c){c.updateQueue={baseState:c.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Dw(c,h){c=c.updateQueue,h.updateQueue===c&&(h.updateQueue={baseState:c.baseState,firstBaseUpdate:c.firstBaseUpdate,lastBaseUpdate:c.lastBaseUpdate,shared:c.shared,effects:c.effects})}function mo(c,h){return{eventTime:c,lane:h,tag:0,payload:null,callback:null,next:null}}function Vo(c,h,x){var C=c.updateQueue;if(C===null)return null;if(C=C.shared,(ft&2)!==0){var I=C.pending;return I===null?h.next=h:(h.next=I.next,I.next=h),C.pending=h,po(c,x)}return I=C.interleaved,I===null?(h.next=h,Yg(C)):(h.next=I.next,I.next=h),C.interleaved=h,po(c,x)}function Ih(c,h,x){if(h=h.updateQueue,h!==null&&(h=h.shared,(x&4194240)!==0)){var C=h.lanes;C&=c.pendingLanes,x|=C,h.lanes=x,hg(c,x)}}function Mw(c,h){var x=c.updateQueue,C=c.alternate;if(C!==null&&(C=C.updateQueue,x===C)){var I=null,T=null;if(x=x.firstBaseUpdate,x!==null){do{var F={eventTime:x.eventTime,lane:x.lane,tag:x.tag,payload:x.payload,callback:x.callback,next:null};T===null?I=T=F:T=T.next=F,x=x.next}while(x!==null);T===null?I=T=h:T=T.next=h}else I=T=h;x={baseState:C.baseState,firstBaseUpdate:I,lastBaseUpdate:T,shared:C.shared,effects:C.effects},c.updateQueue=x;return}c=x.lastBaseUpdate,c===null?x.firstBaseUpdate=h:c.next=h,x.lastBaseUpdate=h}function $h(c,h,x,C){var I=c.updateQueue;Bo=!1;var T=I.firstBaseUpdate,F=I.lastBaseUpdate,q=I.shared.pending;if(q!==null){I.shared.pending=null;var J=q,he=J.next;J.next=null,F===null?T=he:F.next=he,F=J;var Se=c.alternate;Se!==null&&(Se=Se.updateQueue,q=Se.lastBaseUpdate,q!==F&&(q===null?Se.firstBaseUpdate=he:q.next=he,Se.lastBaseUpdate=J))}if(T!==null){var $e=I.baseState;F=0,Se=he=J=null,q=T;do{var ke=q.lane,De=q.eventTime;if((C&ke)===ke){Se!==null&&(Se=Se.next={eventTime:De,lane:0,tag:q.tag,payload:q.payload,callback:q.callback,next:null});e:{var je=c,_e=q;switch(ke=h,De=x,_e.tag){case 1:if(je=_e.payload,typeof je=="function"){$e=je.call(De,$e,ke);break e}$e=je;break e;case 3:je.flags=je.flags&-65537|128;case 0:if(je=_e.payload,ke=typeof je=="function"?je.call(De,$e,ke):je,ke==null)break e;$e=H({},$e,ke);break e;case 2:Bo=!0}}q.callback!==null&&q.lane!==0&&(c.flags|=64,ke=I.effects,ke===null?I.effects=[q]:ke.push(q))}else De={eventTime:De,lane:ke,tag:q.tag,payload:q.payload,callback:q.callback,next:null},Se===null?(he=Se=De,J=$e):Se=Se.next=De,F|=ke;if(q=q.next,q===null){if(q=I.shared.pending,q===null)break;ke=q,q=ke.next,ke.next=null,I.lastBaseUpdate=ke,I.shared.pending=null}}while(!0);if(Se===null&&(J=$e),I.baseState=J,I.firstBaseUpdate=he,I.lastBaseUpdate=Se,h=I.shared.interleaved,h!==null){I=h;do F|=I.lane,I=I.next;while(I!==h)}else T===null&&(I.shared.lanes=0);Mi|=F,c.lanes=F,c.memoizedState=$e}}function Pw(c,h,x){if(c=h.effects,h.effects=null,c!==null)for(h=0;h<c.length;h++){var C=c[h],I=C.callback;if(I!==null){if(C.callback=null,C=x,typeof I!="function")throw Error(t(191,I));I.call(C)}}}var Nc={},_r=Oo(Nc),Ic=Oo(Nc),$c=Oo(Nc);function Ai(c){if(c===Nc)throw Error(t(174));return c}function Zg(c,h){switch(Et($c,h),Et(Ic,c),Et(_r,Nc),c=h.nodeType,c){case 9:case 11:h=(h=h.documentElement)?h.namespaceURI:qt(null,"");break;default:c=c===8?h.parentNode:h,h=c.namespaceURI||null,c=c.tagName,h=qt(h,c)}Ft(_r),Et(_r,h)}function Ha(){Ft(_r),Ft(Ic),Ft($c)}function Fw(c){Ai($c.current);var h=Ai(_r.current),x=qt(h,c.type);h!==x&&(Et(Ic,c),Et(_r,x))}function ex(c){Ic.current===c&&(Ft(_r),Ft(Ic))}var Ut=Oo(0);function Th(c){for(var h=c;h!==null;){if(h.tag===13){var x=h.memoizedState;if(x!==null&&(x=x.dehydrated,x===null||x.data==="$?"||x.data==="$!"))return h}else if(h.tag===19&&h.memoizedProps.revealOrder!==void 0){if((h.flags&128)!==0)return h}else if(h.child!==null){h.child.return=h,h=h.child;continue}if(h===c)break;for(;h.sibling===null;){if(h.return===null||h.return===c)return null;h=h.return}h.sibling.return=h.return,h=h.sibling}return null}var tx=[];function nx(){for(var c=0;c<tx.length;c++)tx[c]._workInProgressVersionPrimary=null;tx.length=0}var Eh=S.ReactCurrentDispatcher,sx=S.ReactCurrentBatchConfig,Di=0,Gt=null,xn=null,Nn=null,Rh=!1,Tc=!1,Ec=0,P3=0;function Yn(){throw Error(t(321))}function rx(c,h){if(h===null)return!1;for(var x=0;x<h.length&&x<c.length;x++)if(!xr(c[x],h[x]))return!1;return!0}function ox(c,h,x,C,I,T){if(Di=T,Gt=h,h.memoizedState=null,h.updateQueue=null,h.lanes=0,Eh.current=c===null||c.memoizedState===null?O3:_3,c=x(C,I),Tc){T=0;do{if(Tc=!1,Ec=0,25<=T)throw Error(t(301));T+=1,Nn=xn=null,h.updateQueue=null,Eh.current=z3,c=x(C,I)}while(Tc)}if(Eh.current=Mh,h=xn!==null&&xn.next!==null,Di=0,Nn=xn=Gt=null,Rh=!1,h)throw Error(t(300));return c}function ix(){var c=Ec!==0;return Ec=0,c}function zr(){var c={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Nn===null?Gt.memoizedState=Nn=c:Nn=Nn.next=c,Nn}function Ys(){if(xn===null){var c=Gt.alternate;c=c!==null?c.memoizedState:null}else c=xn.next;var h=Nn===null?Gt.memoizedState:Nn.next;if(h!==null)Nn=h,xn=c;else{if(c===null)throw Error(t(310));xn=c,c={memoizedState:xn.memoizedState,baseState:xn.baseState,baseQueue:xn.baseQueue,queue:xn.queue,next:null},Nn===null?Gt.memoizedState=Nn=c:Nn=Nn.next=c}return Nn}function Rc(c,h){return typeof h=="function"?h(c):h}function ax(c){var h=Ys(),x=h.queue;if(x===null)throw Error(t(311));x.lastRenderedReducer=c;var C=xn,I=C.baseQueue,T=x.pending;if(T!==null){if(I!==null){var F=I.next;I.next=T.next,T.next=F}C.baseQueue=I=T,x.pending=null}if(I!==null){T=I.next,C=C.baseState;var q=F=null,J=null,he=T;do{var Se=he.lane;if((Di&Se)===Se)J!==null&&(J=J.next={lane:0,action:he.action,hasEagerState:he.hasEagerState,eagerState:he.eagerState,next:null}),C=he.hasEagerState?he.eagerState:c(C,he.action);else{var $e={lane:Se,action:he.action,hasEagerState:he.hasEagerState,eagerState:he.eagerState,next:null};J===null?(q=J=$e,F=C):J=J.next=$e,Gt.lanes|=Se,Mi|=Se}he=he.next}while(he!==null&&he!==T);J===null?F=C:J.next=q,xr(C,h.memoizedState)||(Cs=!0),h.memoizedState=C,h.baseState=F,h.baseQueue=J,x.lastRenderedState=C}if(c=x.interleaved,c!==null){I=c;do T=I.lane,Gt.lanes|=T,Mi|=T,I=I.next;while(I!==c)}else I===null&&(x.lanes=0);return[h.memoizedState,x.dispatch]}function lx(c){var h=Ys(),x=h.queue;if(x===null)throw Error(t(311));x.lastRenderedReducer=c;var C=x.dispatch,I=x.pending,T=h.memoizedState;if(I!==null){x.pending=null;var F=I=I.next;do T=c(T,F.action),F=F.next;while(F!==I);xr(T,h.memoizedState)||(Cs=!0),h.memoizedState=T,h.baseQueue===null&&(h.baseState=T),x.lastRenderedState=T}return[T,C]}function Lw(){}function jw(c,h){var x=Gt,C=Ys(),I=h(),T=!xr(C.memoizedState,I);if(T&&(C.memoizedState=I,Cs=!0),C=C.queue,cx(zw.bind(null,x,C,c),[c]),C.getSnapshot!==h||T||Nn!==null&&Nn.memoizedState.tag&1){if(x.flags|=2048,Ac(9,_w.bind(null,x,C,I,h),void 0,null),In===null)throw Error(t(349));(Di&30)!==0||Ow(x,h,I)}return I}function Ow(c,h,x){c.flags|=16384,c={getSnapshot:h,value:x},h=Gt.updateQueue,h===null?(h={lastEffect:null,stores:null},Gt.updateQueue=h,h.stores=[c]):(x=h.stores,x===null?h.stores=[c]:x.push(c))}function _w(c,h,x,C){h.value=x,h.getSnapshot=C,Bw(h)&&Vw(c)}function zw(c,h,x){return x(function(){Bw(h)&&Vw(c)})}function Bw(c){var h=c.getSnapshot;c=c.value;try{var x=h();return!xr(c,x)}catch{return!0}}function Vw(c){var h=po(c,1);h!==null&&kr(h,c,1,-1)}function Ww(c){var h=zr();return typeof c=="function"&&(c=c()),h.memoizedState=h.baseState=c,c={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Rc,lastRenderedState:c},h.queue=c,c=c.dispatch=j3.bind(null,Gt,c),[h.memoizedState,c]}function Ac(c,h,x,C){return c={tag:c,create:h,destroy:x,deps:C,next:null},h=Gt.updateQueue,h===null?(h={lastEffect:null,stores:null},Gt.updateQueue=h,h.lastEffect=c.next=c):(x=h.lastEffect,x===null?h.lastEffect=c.next=c:(C=x.next,x.next=c,c.next=C,h.lastEffect=c)),c}function Uw(){return Ys().memoizedState}function Ah(c,h,x,C){var I=zr();Gt.flags|=c,I.memoizedState=Ac(1|h,x,void 0,C===void 0?null:C)}function Dh(c,h,x,C){var I=Ys();C=C===void 0?null:C;var T=void 0;if(xn!==null){var F=xn.memoizedState;if(T=F.destroy,C!==null&&rx(C,F.deps)){I.memoizedState=Ac(h,x,T,C);return}}Gt.flags|=c,I.memoizedState=Ac(1|h,x,T,C)}function Gw(c,h){return Ah(8390656,8,c,h)}function cx(c,h){return Dh(2048,8,c,h)}function Hw(c,h){return Dh(4,2,c,h)}function qw(c,h){return Dh(4,4,c,h)}function Kw(c,h){if(typeof h=="function")return c=c(),h(c),function(){h(null)};if(h!=null)return c=c(),h.current=c,function(){h.current=null}}function Xw(c,h,x){return x=x!=null?x.concat([c]):null,Dh(4,4,Kw.bind(null,h,c),x)}function ux(){}function Qw(c,h){var x=Ys();h=h===void 0?null:h;var C=x.memoizedState;return C!==null&&h!==null&&rx(h,C[1])?C[0]:(x.memoizedState=[c,h],c)}function Yw(c,h){var x=Ys();h=h===void 0?null:h;var C=x.memoizedState;return C!==null&&h!==null&&rx(h,C[1])?C[0]:(c=c(),x.memoizedState=[c,h],c)}function Jw(c,h,x){return(Di&21)===0?(c.baseState&&(c.baseState=!1,Cs=!0),c.memoizedState=x):(xr(x,h)||(x=Tb(),Gt.lanes|=x,Mi|=x,c.baseState=!0),h)}function F3(c,h){var x=kt;kt=x!==0&&4>x?x:4,c(!0);var C=sx.transition;sx.transition={};try{c(!1),h()}finally{kt=x,sx.transition=C}}function Zw(){return Ys().memoizedState}function L3(c,h,x){var C=Ho(c);if(x={lane:C,action:x,hasEagerState:!1,eagerState:null,next:null},ek(c))tk(h,x);else if(x=Aw(c,h,x,C),x!==null){var I=cs();kr(x,c,C,I),nk(x,h,C)}}function j3(c,h,x){var C=Ho(c),I={lane:C,action:x,hasEagerState:!1,eagerState:null,next:null};if(ek(c))tk(h,I);else{var T=c.alternate;if(c.lanes===0&&(T===null||T.lanes===0)&&(T=h.lastRenderedReducer,T!==null))try{var F=h.lastRenderedState,q=T(F,x);if(I.hasEagerState=!0,I.eagerState=q,xr(q,F)){var J=h.interleaved;J===null?(I.next=I,Yg(h)):(I.next=J.next,J.next=I),h.interleaved=I;return}}catch{}finally{}x=Aw(c,h,I,C),x!==null&&(I=cs(),kr(x,c,C,I),nk(x,h,C))}}function ek(c){var h=c.alternate;return c===Gt||h!==null&&h===Gt}function tk(c,h){Tc=Rh=!0;var x=c.pending;x===null?h.next=h:(h.next=x.next,x.next=h),c.pending=h}function nk(c,h,x){if((x&4194240)!==0){var C=h.lanes;C&=c.pendingLanes,x|=C,h.lanes=x,hg(c,x)}}var Mh={readContext:Qs,useCallback:Yn,useContext:Yn,useEffect:Yn,useImperativeHandle:Yn,useInsertionEffect:Yn,useLayoutEffect:Yn,useMemo:Yn,useReducer:Yn,useRef:Yn,useState:Yn,useDebugValue:Yn,useDeferredValue:Yn,useTransition:Yn,useMutableSource:Yn,useSyncExternalStore:Yn,useId:Yn,unstable_isNewReconciler:!1},O3={readContext:Qs,useCallback:function(c,h){return zr().memoizedState=[c,h===void 0?null:h],c},useContext:Qs,useEffect:Gw,useImperativeHandle:function(c,h,x){return x=x!=null?x.concat([c]):null,Ah(4194308,4,Kw.bind(null,h,c),x)},useLayoutEffect:function(c,h){return Ah(4194308,4,c,h)},useInsertionEffect:function(c,h){return Ah(4,2,c,h)},useMemo:function(c,h){var x=zr();return h=h===void 0?null:h,c=c(),x.memoizedState=[c,h],c},useReducer:function(c,h,x){var C=zr();return h=x!==void 0?x(h):h,C.memoizedState=C.baseState=h,c={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:c,lastRenderedState:h},C.queue=c,c=c.dispatch=L3.bind(null,Gt,c),[C.memoizedState,c]},useRef:function(c){var h=zr();return c={current:c},h.memoizedState=c},useState:Ww,useDebugValue:ux,useDeferredValue:function(c){return zr().memoizedState=c},useTransition:function(){var c=Ww(!1),h=c[0];return c=F3.bind(null,c[1]),zr().memoizedState=c,[h,c]},useMutableSource:function(){},useSyncExternalStore:function(c,h,x){var C=Gt,I=zr();if(Ot){if(x===void 0)throw Error(t(407));x=x()}else{if(x=h(),In===null)throw Error(t(349));(Di&30)!==0||Ow(C,h,x)}I.memoizedState=x;var T={value:x,getSnapshot:h};return I.queue=T,Gw(zw.bind(null,C,T,c),[c]),C.flags|=2048,Ac(9,_w.bind(null,C,T,x,h),void 0,null),x},useId:function(){var c=zr(),h=In.identifierPrefix;if(Ot){var x=fo,C=ho;x=(C&~(1<<32-gr(C)-1)).toString(32)+x,h=":"+h+"R"+x,x=Ec++,0<x&&(h+="H"+x.toString(32)),h+=":"}else x=P3++,h=":"+h+"r"+x.toString(32)+":";return c.memoizedState=h},unstable_isNewReconciler:!1},_3={readContext:Qs,useCallback:Qw,useContext:Qs,useEffect:cx,useImperativeHandle:Xw,useInsertionEffect:Hw,useLayoutEffect:qw,useMemo:Yw,useReducer:ax,useRef:Uw,useState:function(){return ax(Rc)},useDebugValue:ux,useDeferredValue:function(c){var h=Ys();return Jw(h,xn.memoizedState,c)},useTransition:function(){var c=ax(Rc)[0],h=Ys().memoizedState;return[c,h]},useMutableSource:Lw,useSyncExternalStore:jw,useId:Zw,unstable_isNewReconciler:!1},z3={readContext:Qs,useCallback:Qw,useContext:Qs,useEffect:cx,useImperativeHandle:Xw,useInsertionEffect:Hw,useLayoutEffect:qw,useMemo:Yw,useReducer:lx,useRef:Uw,useState:function(){return lx(Rc)},useDebugValue:ux,useDeferredValue:function(c){var h=Ys();return xn===null?h.memoizedState=c:Jw(h,xn.memoizedState,c)},useTransition:function(){var c=lx(Rc)[0],h=Ys().memoizedState;return[c,h]},useMutableSource:Lw,useSyncExternalStore:jw,useId:Zw,unstable_isNewReconciler:!1};function vr(c,h){if(c&&c.defaultProps){h=H({},h),c=c.defaultProps;for(var x in c)h[x]===void 0&&(h[x]=c[x]);return h}return h}function dx(c,h,x,C){h=c.memoizedState,x=x(C,h),x=x==null?h:H({},h,x),c.memoizedState=x,c.lanes===0&&(c.updateQueue.baseState=x)}var Ph={isMounted:function(c){return(c=c._reactInternals)?Ni(c)===c:!1},enqueueSetState:function(c,h,x){c=c._reactInternals;var C=cs(),I=Ho(c),T=mo(C,I);T.payload=h,x!=null&&(T.callback=x),h=Vo(c,T,I),h!==null&&(kr(h,c,I,C),Ih(h,c,I))},enqueueReplaceState:function(c,h,x){c=c._reactInternals;var C=cs(),I=Ho(c),T=mo(C,I);T.tag=1,T.payload=h,x!=null&&(T.callback=x),h=Vo(c,T,I),h!==null&&(kr(h,c,I,C),Ih(h,c,I))},enqueueForceUpdate:function(c,h){c=c._reactInternals;var x=cs(),C=Ho(c),I=mo(x,C);I.tag=2,h!=null&&(I.callback=h),h=Vo(c,I,C),h!==null&&(kr(h,c,C,x),Ih(h,c,C))}};function sk(c,h,x,C,I,T,F){return c=c.stateNode,typeof c.shouldComponentUpdate=="function"?c.shouldComponentUpdate(C,T,F):h.prototype&&h.prototype.isPureReactComponent?!xc(x,C)||!xc(I,T):!0}function rk(c,h,x){var C=!1,I=_o,T=h.contextType;return typeof T=="object"&&T!==null?T=Qs(T):(I=ks(h)?$i:Qn.current,C=h.contextTypes,T=(C=C!=null)?_a(c,I):_o),h=new h(x,T),c.memoizedState=h.state!==null&&h.state!==void 0?h.state:null,h.updater=Ph,c.stateNode=h,h._reactInternals=c,C&&(c=c.stateNode,c.__reactInternalMemoizedUnmaskedChildContext=I,c.__reactInternalMemoizedMaskedChildContext=T),h}function ok(c,h,x,C){c=h.state,typeof h.componentWillReceiveProps=="function"&&h.componentWillReceiveProps(x,C),typeof h.UNSAFE_componentWillReceiveProps=="function"&&h.UNSAFE_componentWillReceiveProps(x,C),h.state!==c&&Ph.enqueueReplaceState(h,h.state,null)}function hx(c,h,x,C){var I=c.stateNode;I.props=x,I.state=c.memoizedState,I.refs={},Jg(c);var T=h.contextType;typeof T=="object"&&T!==null?I.context=Qs(T):(T=ks(h)?$i:Qn.current,I.context=_a(c,T)),I.state=c.memoizedState,T=h.getDerivedStateFromProps,typeof T=="function"&&(dx(c,h,T,x),I.state=c.memoizedState),typeof h.getDerivedStateFromProps=="function"||typeof I.getSnapshotBeforeUpdate=="function"||typeof I.UNSAFE_componentWillMount!="function"&&typeof I.componentWillMount!="function"||(h=I.state,typeof I.componentWillMount=="function"&&I.componentWillMount(),typeof I.UNSAFE_componentWillMount=="function"&&I.UNSAFE_componentWillMount(),h!==I.state&&Ph.enqueueReplaceState(I,I.state,null),$h(c,x,I,C),I.state=c.memoizedState),typeof I.componentDidMount=="function"&&(c.flags|=4194308)}function qa(c,h){try{var x="",C=h;do x+=Q(C),C=C.return;while(C);var I=x}catch(T){I=`
Error generating stack: `+T.message+`
`+T.stack}return{value:c,source:h,stack:I,digest:null}}function fx(c,h,x){return{value:c,source:null,stack:x??null,digest:h??null}}function px(c,h){try{console.error(h.value)}catch(x){setTimeout(function(){throw x})}}var B3=typeof WeakMap=="function"?WeakMap:Map;function ik(c,h,x){x=mo(-1,x),x.tag=3,x.payload={element:null};var C=h.value;return x.callback=function(){Bh||(Bh=!0,Ex=C),px(c,h)},x}function ak(c,h,x){x=mo(-1,x),x.tag=3;var C=c.type.getDerivedStateFromError;if(typeof C=="function"){var I=h.value;x.payload=function(){return C(I)},x.callback=function(){px(c,h)}}var T=c.stateNode;return T!==null&&typeof T.componentDidCatch=="function"&&(x.callback=function(){px(c,h),typeof C!="function"&&(Uo===null?Uo=new Set([this]):Uo.add(this));var F=h.stack;this.componentDidCatch(h.value,{componentStack:F!==null?F:""})}),x}function lk(c,h,x){var C=c.pingCache;if(C===null){C=c.pingCache=new B3;var I=new Set;C.set(h,I)}else I=C.get(h),I===void 0&&(I=new Set,C.set(h,I));I.has(x)||(I.add(x),c=t4.bind(null,c,h,x),h.then(c,c))}function ck(c){do{var h;if((h=c.tag===13)&&(h=c.memoizedState,h=h!==null?h.dehydrated!==null:!0),h)return c;c=c.return}while(c!==null);return null}function uk(c,h,x,C,I){return(c.mode&1)===0?(c===h?c.flags|=65536:(c.flags|=128,x.flags|=131072,x.flags&=-52805,x.tag===1&&(x.alternate===null?x.tag=17:(h=mo(-1,1),h.tag=2,Vo(x,h,1))),x.lanes|=1),c):(c.flags|=65536,c.lanes=I,c)}var V3=S.ReactCurrentOwner,Cs=!1;function ls(c,h,x,C){h.child=c===null?Rw(h,null,x,C):Wa(h,c.child,x,C)}function dk(c,h,x,C,I){x=x.render;var T=h.ref;return Ga(h,I),C=ox(c,h,x,C,T,I),x=ix(),c!==null&&!Cs?(h.updateQueue=c.updateQueue,h.flags&=-2053,c.lanes&=~I,go(c,h,I)):(Ot&&x&&Vg(h),h.flags|=1,ls(c,h,C,I),h.child)}function hk(c,h,x,C,I){if(c===null){var T=x.type;return typeof T=="function"&&!Lx(T)&&T.defaultProps===void 0&&x.compare===null&&x.defaultProps===void 0?(h.tag=15,h.type=T,fk(c,h,T,C,I)):(c=qh(x.type,null,C,h,h.mode,I),c.ref=h.ref,c.return=h,h.child=c)}if(T=c.child,(c.lanes&I)===0){var F=T.memoizedProps;if(x=x.compare,x=x!==null?x:xc,x(F,C)&&c.ref===h.ref)return go(c,h,I)}return h.flags|=1,c=Ko(T,C),c.ref=h.ref,c.return=h,h.child=c}function fk(c,h,x,C,I){if(c!==null){var T=c.memoizedProps;if(xc(T,C)&&c.ref===h.ref)if(Cs=!1,h.pendingProps=C=T,(c.lanes&I)!==0)(c.flags&131072)!==0&&(Cs=!0);else return h.lanes=c.lanes,go(c,h,I)}return mx(c,h,x,C,I)}function pk(c,h,x){var C=h.pendingProps,I=C.children,T=c!==null?c.memoizedState:null;if(C.mode==="hidden")if((h.mode&1)===0)h.memoizedState={baseLanes:0,cachePool:null,transitions:null},Et(Xa,zs),zs|=x;else{if((x&1073741824)===0)return c=T!==null?T.baseLanes|x:x,h.lanes=h.childLanes=1073741824,h.memoizedState={baseLanes:c,cachePool:null,transitions:null},h.updateQueue=null,Et(Xa,zs),zs|=c,null;h.memoizedState={baseLanes:0,cachePool:null,transitions:null},C=T!==null?T.baseLanes:x,Et(Xa,zs),zs|=C}else T!==null?(C=T.baseLanes|x,h.memoizedState=null):C=x,Et(Xa,zs),zs|=C;return ls(c,h,I,x),h.child}function mk(c,h){var x=h.ref;(c===null&&x!==null||c!==null&&c.ref!==x)&&(h.flags|=512,h.flags|=2097152)}function mx(c,h,x,C,I){var T=ks(x)?$i:Qn.current;return T=_a(h,T),Ga(h,I),x=ox(c,h,x,C,T,I),C=ix(),c!==null&&!Cs?(h.updateQueue=c.updateQueue,h.flags&=-2053,c.lanes&=~I,go(c,h,I)):(Ot&&C&&Vg(h),h.flags|=1,ls(c,h,x,I),h.child)}function gk(c,h,x,C,I){if(ks(x)){var T=!0;yh(h)}else T=!1;if(Ga(h,I),h.stateNode===null)Lh(c,h),rk(h,x,C),hx(h,x,C,I),C=!0;else if(c===null){var F=h.stateNode,q=h.memoizedProps;F.props=q;var J=F.context,he=x.contextType;typeof he=="object"&&he!==null?he=Qs(he):(he=ks(x)?$i:Qn.current,he=_a(h,he));var Se=x.getDerivedStateFromProps,$e=typeof Se=="function"||typeof F.getSnapshotBeforeUpdate=="function";$e||typeof F.UNSAFE_componentWillReceiveProps!="function"&&typeof F.componentWillReceiveProps!="function"||(q!==C||J!==he)&&ok(h,F,C,he),Bo=!1;var ke=h.memoizedState;F.state=ke,$h(h,C,F,I),J=h.memoizedState,q!==C||ke!==J||ws.current||Bo?(typeof Se=="function"&&(dx(h,x,Se,C),J=h.memoizedState),(q=Bo||sk(h,x,q,C,ke,J,he))?($e||typeof F.UNSAFE_componentWillMount!="function"&&typeof F.componentWillMount!="function"||(typeof F.componentWillMount=="function"&&F.componentWillMount(),typeof F.UNSAFE_componentWillMount=="function"&&F.UNSAFE_componentWillMount()),typeof F.componentDidMount=="function"&&(h.flags|=4194308)):(typeof F.componentDidMount=="function"&&(h.flags|=4194308),h.memoizedProps=C,h.memoizedState=J),F.props=C,F.state=J,F.context=he,C=q):(typeof F.componentDidMount=="function"&&(h.flags|=4194308),C=!1)}else{F=h.stateNode,Dw(c,h),q=h.memoizedProps,he=h.type===h.elementType?q:vr(h.type,q),F.props=he,$e=h.pendingProps,ke=F.context,J=x.contextType,typeof J=="object"&&J!==null?J=Qs(J):(J=ks(x)?$i:Qn.current,J=_a(h,J));var De=x.getDerivedStateFromProps;(Se=typeof De=="function"||typeof F.getSnapshotBeforeUpdate=="function")||typeof F.UNSAFE_componentWillReceiveProps!="function"&&typeof F.componentWillReceiveProps!="function"||(q!==$e||ke!==J)&&ok(h,F,C,J),Bo=!1,ke=h.memoizedState,F.state=ke,$h(h,C,F,I);var je=h.memoizedState;q!==$e||ke!==je||ws.current||Bo?(typeof De=="function"&&(dx(h,x,De,C),je=h.memoizedState),(he=Bo||sk(h,x,he,C,ke,je,J)||!1)?(Se||typeof F.UNSAFE_componentWillUpdate!="function"&&typeof F.componentWillUpdate!="function"||(typeof F.componentWillUpdate=="function"&&F.componentWillUpdate(C,je,J),typeof F.UNSAFE_componentWillUpdate=="function"&&F.UNSAFE_componentWillUpdate(C,je,J)),typeof F.componentDidUpdate=="function"&&(h.flags|=4),typeof F.getSnapshotBeforeUpdate=="function"&&(h.flags|=1024)):(typeof F.componentDidUpdate!="function"||q===c.memoizedProps&&ke===c.memoizedState||(h.flags|=4),typeof F.getSnapshotBeforeUpdate!="function"||q===c.memoizedProps&&ke===c.memoizedState||(h.flags|=1024),h.memoizedProps=C,h.memoizedState=je),F.props=C,F.state=je,F.context=J,C=he):(typeof F.componentDidUpdate!="function"||q===c.memoizedProps&&ke===c.memoizedState||(h.flags|=4),typeof F.getSnapshotBeforeUpdate!="function"||q===c.memoizedProps&&ke===c.memoizedState||(h.flags|=1024),C=!1)}return gx(c,h,x,C,T,I)}function gx(c,h,x,C,I,T){mk(c,h);var F=(h.flags&128)!==0;if(!C&&!F)return I&&ww(h,x,!1),go(c,h,T);C=h.stateNode,V3.current=h;var q=F&&typeof x.getDerivedStateFromError!="function"?null:C.render();return h.flags|=1,c!==null&&F?(h.child=Wa(h,c.child,null,T),h.child=Wa(h,null,q,T)):ls(c,h,q,T),h.memoizedState=C.state,I&&ww(h,x,!0),h.child}function xk(c){var h=c.stateNode;h.pendingContext?vw(c,h.pendingContext,h.pendingContext!==h.context):h.context&&vw(c,h.context,!1),Zg(c,h.containerInfo)}function yk(c,h,x,C,I){return Va(),Hg(I),h.flags|=256,ls(c,h,x,C),h.child}var xx={dehydrated:null,treeContext:null,retryLane:0};function yx(c){return{baseLanes:c,cachePool:null,transitions:null}}function vk(c,h,x){var C=h.pendingProps,I=Ut.current,T=!1,F=(h.flags&128)!==0,q;if((q=F)||(q=c!==null&&c.memoizedState===null?!1:(I&2)!==0),q?(T=!0,h.flags&=-129):(c===null||c.memoizedState!==null)&&(I|=1),Et(Ut,I&1),c===null)return Gg(h),c=h.memoizedState,c!==null&&(c=c.dehydrated,c!==null)?((h.mode&1)===0?h.lanes=1:c.data==="$!"?h.lanes=8:h.lanes=1073741824,null):(F=C.children,c=C.fallback,T?(C=h.mode,T=h.child,F={mode:"hidden",children:F},(C&1)===0&&T!==null?(T.childLanes=0,T.pendingProps=F):T=Kh(F,C,0,null),c=ji(c,C,x,null),T.return=h,c.return=h,T.sibling=c,h.child=T,h.child.memoizedState=yx(x),h.memoizedState=xx,c):vx(h,F));if(I=c.memoizedState,I!==null&&(q=I.dehydrated,q!==null))return W3(c,h,F,C,q,I,x);if(T){T=C.fallback,F=h.mode,I=c.child,q=I.sibling;var J={mode:"hidden",children:C.children};return(F&1)===0&&h.child!==I?(C=h.child,C.childLanes=0,C.pendingProps=J,h.deletions=null):(C=Ko(I,J),C.subtreeFlags=I.subtreeFlags&14680064),q!==null?T=Ko(q,T):(T=ji(T,F,x,null),T.flags|=2),T.return=h,C.return=h,C.sibling=T,h.child=C,C=T,T=h.child,F=c.child.memoizedState,F=F===null?yx(x):{baseLanes:F.baseLanes|x,cachePool:null,transitions:F.transitions},T.memoizedState=F,T.childLanes=c.childLanes&~x,h.memoizedState=xx,C}return T=c.child,c=T.sibling,C=Ko(T,{mode:"visible",children:C.children}),(h.mode&1)===0&&(C.lanes=x),C.return=h,C.sibling=null,c!==null&&(x=h.deletions,x===null?(h.deletions=[c],h.flags|=16):x.push(c)),h.child=C,h.memoizedState=null,C}function vx(c,h){return h=Kh({mode:"visible",children:h},c.mode,0,null),h.return=c,c.child=h}function Fh(c,h,x,C){return C!==null&&Hg(C),Wa(h,c.child,null,x),c=vx(h,h.pendingProps.children),c.flags|=2,h.memoizedState=null,c}function W3(c,h,x,C,I,T,F){if(x)return h.flags&256?(h.flags&=-257,C=fx(Error(t(422))),Fh(c,h,F,C)):h.memoizedState!==null?(h.child=c.child,h.flags|=128,null):(T=C.fallback,I=h.mode,C=Kh({mode:"visible",children:C.children},I,0,null),T=ji(T,I,F,null),T.flags|=2,C.return=h,T.return=h,C.sibling=T,h.child=C,(h.mode&1)!==0&&Wa(h,c.child,null,F),h.child.memoizedState=yx(F),h.memoizedState=xx,T);if((h.mode&1)===0)return Fh(c,h,F,null);if(I.data==="$!"){if(C=I.nextSibling&&I.nextSibling.dataset,C)var q=C.dgst;return C=q,T=Error(t(419)),C=fx(T,C,void 0),Fh(c,h,F,C)}if(q=(F&c.childLanes)!==0,Cs||q){if(C=In,C!==null){switch(F&-F){case 4:I=2;break;case 16:I=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:I=32;break;case 536870912:I=268435456;break;default:I=0}I=(I&(C.suspendedLanes|F))!==0?0:I,I!==0&&I!==T.retryLane&&(T.retryLane=I,po(c,I),kr(C,c,I,-1))}return Fx(),C=fx(Error(t(421))),Fh(c,h,F,C)}return I.data==="$?"?(h.flags|=128,h.child=c.child,h=n4.bind(null,c),I._reactRetry=h,null):(c=T.treeContext,_s=jo(I.nextSibling),Os=h,Ot=!0,yr=null,c!==null&&(Ks[Xs++]=ho,Ks[Xs++]=fo,Ks[Xs++]=Ti,ho=c.id,fo=c.overflow,Ti=h),h=vx(h,C.children),h.flags|=4096,h)}function bk(c,h,x){c.lanes|=h;var C=c.alternate;C!==null&&(C.lanes|=h),Qg(c.return,h,x)}function bx(c,h,x,C,I){var T=c.memoizedState;T===null?c.memoizedState={isBackwards:h,rendering:null,renderingStartTime:0,last:C,tail:x,tailMode:I}:(T.isBackwards=h,T.rendering=null,T.renderingStartTime=0,T.last=C,T.tail=x,T.tailMode=I)}function wk(c,h,x){var C=h.pendingProps,I=C.revealOrder,T=C.tail;if(ls(c,h,C.children,x),C=Ut.current,(C&2)!==0)C=C&1|2,h.flags|=128;else{if(c!==null&&(c.flags&128)!==0)e:for(c=h.child;c!==null;){if(c.tag===13)c.memoizedState!==null&&bk(c,x,h);else if(c.tag===19)bk(c,x,h);else if(c.child!==null){c.child.return=c,c=c.child;continue}if(c===h)break e;for(;c.sibling===null;){if(c.return===null||c.return===h)break e;c=c.return}c.sibling.return=c.return,c=c.sibling}C&=1}if(Et(Ut,C),(h.mode&1)===0)h.memoizedState=null;else switch(I){case"forwards":for(x=h.child,I=null;x!==null;)c=x.alternate,c!==null&&Th(c)===null&&(I=x),x=x.sibling;x=I,x===null?(I=h.child,h.child=null):(I=x.sibling,x.sibling=null),bx(h,!1,I,x,T);break;case"backwards":for(x=null,I=h.child,h.child=null;I!==null;){if(c=I.alternate,c!==null&&Th(c)===null){h.child=I;break}c=I.sibling,I.sibling=x,x=I,I=c}bx(h,!0,x,null,T);break;case"together":bx(h,!1,null,null,void 0);break;default:h.memoizedState=null}return h.child}function Lh(c,h){(h.mode&1)===0&&c!==null&&(c.alternate=null,h.alternate=null,h.flags|=2)}function go(c,h,x){if(c!==null&&(h.dependencies=c.dependencies),Mi|=h.lanes,(x&h.childLanes)===0)return null;if(c!==null&&h.child!==c.child)throw Error(t(153));if(h.child!==null){for(c=h.child,x=Ko(c,c.pendingProps),h.child=x,x.return=h;c.sibling!==null;)c=c.sibling,x=x.sibling=Ko(c,c.pendingProps),x.return=h;x.sibling=null}return h.child}function U3(c,h,x){switch(h.tag){case 3:xk(h),Va();break;case 5:Fw(h);break;case 1:ks(h.type)&&yh(h);break;case 4:Zg(h,h.stateNode.containerInfo);break;case 10:var C=h.type._context,I=h.memoizedProps.value;Et(Sh,C._currentValue),C._currentValue=I;break;case 13:if(C=h.memoizedState,C!==null)return C.dehydrated!==null?(Et(Ut,Ut.current&1),h.flags|=128,null):(x&h.child.childLanes)!==0?vk(c,h,x):(Et(Ut,Ut.current&1),c=go(c,h,x),c!==null?c.sibling:null);Et(Ut,Ut.current&1);break;case 19:if(C=(x&h.childLanes)!==0,(c.flags&128)!==0){if(C)return wk(c,h,x);h.flags|=128}if(I=h.memoizedState,I!==null&&(I.rendering=null,I.tail=null,I.lastEffect=null),Et(Ut,Ut.current),C)break;return null;case 22:case 23:return h.lanes=0,pk(c,h,x)}return go(c,h,x)}var kk,wx,Ck,Sk;kk=function(c,h){for(var x=h.child;x!==null;){if(x.tag===5||x.tag===6)c.appendChild(x.stateNode);else if(x.tag!==4&&x.child!==null){x.child.return=x,x=x.child;continue}if(x===h)break;for(;x.sibling===null;){if(x.return===null||x.return===h)return;x=x.return}x.sibling.return=x.return,x=x.sibling}},wx=function(){},Ck=function(c,h,x,C){var I=c.memoizedProps;if(I!==C){c=h.stateNode,Ai(_r.current);var T=null;switch(x){case"input":I=ye(c,I),C=ye(c,C),T=[];break;case"select":I=H({},I,{value:void 0}),C=H({},C,{value:void 0}),T=[];break;case"textarea":I=Mt(c,I),C=Mt(c,C),T=[];break;default:typeof I.onClick!="function"&&typeof C.onClick=="function"&&(c.onclick=mh)}Ta(x,C);var F;x=null;for(he in I)if(!C.hasOwnProperty(he)&&I.hasOwnProperty(he)&&I[he]!=null)if(he==="style"){var q=I[he];for(F in q)q.hasOwnProperty(F)&&(x||(x={}),x[F]="")}else he!=="dangerouslySetInnerHTML"&&he!=="children"&&he!=="suppressContentEditableWarning"&&he!=="suppressHydrationWarning"&&he!=="autoFocus"&&(r.hasOwnProperty(he)?T||(T=[]):(T=T||[]).push(he,null));for(he in C){var J=C[he];if(q=I!=null?I[he]:void 0,C.hasOwnProperty(he)&&J!==q&&(J!=null||q!=null))if(he==="style")if(q){for(F in q)!q.hasOwnProperty(F)||J&&J.hasOwnProperty(F)||(x||(x={}),x[F]="");for(F in J)J.hasOwnProperty(F)&&q[F]!==J[F]&&(x||(x={}),x[F]=J[F])}else x||(T||(T=[]),T.push(he,x)),x=J;else he==="dangerouslySetInnerHTML"?(J=J?J.__html:void 0,q=q?q.__html:void 0,J!=null&&q!==J&&(T=T||[]).push(he,J)):he==="children"?typeof J!="string"&&typeof J!="number"||(T=T||[]).push(he,""+J):he!=="suppressContentEditableWarning"&&he!=="suppressHydrationWarning"&&(r.hasOwnProperty(he)?(J!=null&&he==="onScroll"&&Pt("scroll",c),T||q===J||(T=[])):(T=T||[]).push(he,J))}x&&(T=T||[]).push("style",x);var he=T;(h.updateQueue=he)&&(h.flags|=4)}},Sk=function(c,h,x,C){x!==C&&(h.flags|=4)};function Dc(c,h){if(!Ot)switch(c.tailMode){case"hidden":h=c.tail;for(var x=null;h!==null;)h.alternate!==null&&(x=h),h=h.sibling;x===null?c.tail=null:x.sibling=null;break;case"collapsed":x=c.tail;for(var C=null;x!==null;)x.alternate!==null&&(C=x),x=x.sibling;C===null?h||c.tail===null?c.tail=null:c.tail.sibling=null:C.sibling=null}}function Jn(c){var h=c.alternate!==null&&c.alternate.child===c.child,x=0,C=0;if(h)for(var I=c.child;I!==null;)x|=I.lanes|I.childLanes,C|=I.subtreeFlags&14680064,C|=I.flags&14680064,I.return=c,I=I.sibling;else for(I=c.child;I!==null;)x|=I.lanes|I.childLanes,C|=I.subtreeFlags,C|=I.flags,I.return=c,I=I.sibling;return c.subtreeFlags|=C,c.childLanes=x,h}function G3(c,h,x){var C=h.pendingProps;switch(Wg(h),h.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Jn(h),null;case 1:return ks(h.type)&&xh(),Jn(h),null;case 3:return C=h.stateNode,Ha(),Ft(ws),Ft(Qn),nx(),C.pendingContext&&(C.context=C.pendingContext,C.pendingContext=null),(c===null||c.child===null)&&(kh(h)?h.flags|=4:c===null||c.memoizedState.isDehydrated&&(h.flags&256)===0||(h.flags|=1024,yr!==null&&(Dx(yr),yr=null))),wx(c,h),Jn(h),null;case 5:ex(h);var I=Ai($c.current);if(x=h.type,c!==null&&h.stateNode!=null)Ck(c,h,x,C,I),c.ref!==h.ref&&(h.flags|=512,h.flags|=2097152);else{if(!C){if(h.stateNode===null)throw Error(t(166));return Jn(h),null}if(c=Ai(_r.current),kh(h)){C=h.stateNode,x=h.type;var T=h.memoizedProps;switch(C[Or]=h,C[kc]=T,c=(h.mode&1)!==0,x){case"dialog":Pt("cancel",C),Pt("close",C);break;case"iframe":case"object":case"embed":Pt("load",C);break;case"video":case"audio":for(I=0;I<vc.length;I++)Pt(vc[I],C);break;case"source":Pt("error",C);break;case"img":case"image":case"link":Pt("error",C),Pt("load",C);break;case"details":Pt("toggle",C);break;case"input":Ce(C,T),Pt("invalid",C);break;case"select":C._wrapperState={wasMultiple:!!T.multiple},Pt("invalid",C);break;case"textarea":is(C,T),Pt("invalid",C)}Ta(x,T),I=null;for(var F in T)if(T.hasOwnProperty(F)){var q=T[F];F==="children"?typeof q=="string"?C.textContent!==q&&(T.suppressHydrationWarning!==!0&&ph(C.textContent,q,c),I=["children",q]):typeof q=="number"&&C.textContent!==""+q&&(T.suppressHydrationWarning!==!0&&ph(C.textContent,q,c),I=["children",""+q]):r.hasOwnProperty(F)&&q!=null&&F==="onScroll"&&Pt("scroll",C)}switch(x){case"input":Me(C),Be(C,T,!0);break;case"textarea":Me(C),Fn(C);break;case"select":case"option":break;default:typeof T.onClick=="function"&&(C.onclick=mh)}C=I,h.updateQueue=C,C!==null&&(h.flags|=4)}else{F=I.nodeType===9?I:I.ownerDocument,c==="http://www.w3.org/1999/xhtml"&&(c=Gn(x)),c==="http://www.w3.org/1999/xhtml"?x==="script"?(c=F.createElement("div"),c.innerHTML="<script><\/script>",c=c.removeChild(c.firstChild)):typeof C.is=="string"?c=F.createElement(x,{is:C.is}):(c=F.createElement(x),x==="select"&&(F=c,C.multiple?F.multiple=!0:C.size&&(F.size=C.size))):c=F.createElementNS(c,x),c[Or]=h,c[kc]=C,kk(c,h,!1,!1),h.stateNode=c;e:{switch(F=tc(x,C),x){case"dialog":Pt("cancel",c),Pt("close",c),I=C;break;case"iframe":case"object":case"embed":Pt("load",c),I=C;break;case"video":case"audio":for(I=0;I<vc.length;I++)Pt(vc[I],c);I=C;break;case"source":Pt("error",c),I=C;break;case"img":case"image":case"link":Pt("error",c),Pt("load",c),I=C;break;case"details":Pt("toggle",c),I=C;break;case"input":Ce(c,C),I=ye(c,C),Pt("invalid",c);break;case"option":I=C;break;case"select":c._wrapperState={wasMultiple:!!C.multiple},I=H({},C,{value:void 0}),Pt("invalid",c);break;case"textarea":is(c,C),I=Mt(c,C),Pt("invalid",c);break;default:I=C}Ta(x,I),q=I;for(T in q)if(q.hasOwnProperty(T)){var J=q[T];T==="style"?$a(c,J):T==="dangerouslySetInnerHTML"?(J=J?J.__html:void 0,J!=null&&et(c,J)):T==="children"?typeof J=="string"?(x!=="textarea"||J!=="")&&vt(c,J):typeof J=="number"&&vt(c,""+J):T!=="suppressContentEditableWarning"&&T!=="suppressHydrationWarning"&&T!=="autoFocus"&&(r.hasOwnProperty(T)?J!=null&&T==="onScroll"&&Pt("scroll",c):J!=null&&N(c,T,J,F))}switch(x){case"input":Me(c),Be(c,C,!1);break;case"textarea":Me(c),Fn(c);break;case"option":C.value!=null&&c.setAttribute("value",""+ge(C.value));break;case"select":c.multiple=!!C.multiple,T=C.value,T!=null?Ht(c,!!C.multiple,T,!1):C.defaultValue!=null&&Ht(c,!!C.multiple,C.defaultValue,!0);break;default:typeof I.onClick=="function"&&(c.onclick=mh)}switch(x){case"button":case"input":case"select":case"textarea":C=!!C.autoFocus;break e;case"img":C=!0;break e;default:C=!1}}C&&(h.flags|=4)}h.ref!==null&&(h.flags|=512,h.flags|=2097152)}return Jn(h),null;case 6:if(c&&h.stateNode!=null)Sk(c,h,c.memoizedProps,C);else{if(typeof C!="string"&&h.stateNode===null)throw Error(t(166));if(x=Ai($c.current),Ai(_r.current),kh(h)){if(C=h.stateNode,x=h.memoizedProps,C[Or]=h,(T=C.nodeValue!==x)&&(c=Os,c!==null))switch(c.tag){case 3:ph(C.nodeValue,x,(c.mode&1)!==0);break;case 5:c.memoizedProps.suppressHydrationWarning!==!0&&ph(C.nodeValue,x,(c.mode&1)!==0)}T&&(h.flags|=4)}else C=(x.nodeType===9?x:x.ownerDocument).createTextNode(C),C[Or]=h,h.stateNode=C}return Jn(h),null;case 13:if(Ft(Ut),C=h.memoizedState,c===null||c.memoizedState!==null&&c.memoizedState.dehydrated!==null){if(Ot&&_s!==null&&(h.mode&1)!==0&&(h.flags&128)===0)$w(),Va(),h.flags|=98560,T=!1;else if(T=kh(h),C!==null&&C.dehydrated!==null){if(c===null){if(!T)throw Error(t(318));if(T=h.memoizedState,T=T!==null?T.dehydrated:null,!T)throw Error(t(317));T[Or]=h}else Va(),(h.flags&128)===0&&(h.memoizedState=null),h.flags|=4;Jn(h),T=!1}else yr!==null&&(Dx(yr),yr=null),T=!0;if(!T)return h.flags&65536?h:null}return(h.flags&128)!==0?(h.lanes=x,h):(C=C!==null,C!==(c!==null&&c.memoizedState!==null)&&C&&(h.child.flags|=8192,(h.mode&1)!==0&&(c===null||(Ut.current&1)!==0?yn===0&&(yn=3):Fx())),h.updateQueue!==null&&(h.flags|=4),Jn(h),null);case 4:return Ha(),wx(c,h),c===null&&bc(h.stateNode.containerInfo),Jn(h),null;case 10:return Xg(h.type._context),Jn(h),null;case 17:return ks(h.type)&&xh(),Jn(h),null;case 19:if(Ft(Ut),T=h.memoizedState,T===null)return Jn(h),null;if(C=(h.flags&128)!==0,F=T.rendering,F===null)if(C)Dc(T,!1);else{if(yn!==0||c!==null&&(c.flags&128)!==0)for(c=h.child;c!==null;){if(F=Th(c),F!==null){for(h.flags|=128,Dc(T,!1),C=F.updateQueue,C!==null&&(h.updateQueue=C,h.flags|=4),h.subtreeFlags=0,C=x,x=h.child;x!==null;)T=x,c=C,T.flags&=14680066,F=T.alternate,F===null?(T.childLanes=0,T.lanes=c,T.child=null,T.subtreeFlags=0,T.memoizedProps=null,T.memoizedState=null,T.updateQueue=null,T.dependencies=null,T.stateNode=null):(T.childLanes=F.childLanes,T.lanes=F.lanes,T.child=F.child,T.subtreeFlags=0,T.deletions=null,T.memoizedProps=F.memoizedProps,T.memoizedState=F.memoizedState,T.updateQueue=F.updateQueue,T.type=F.type,c=F.dependencies,T.dependencies=c===null?null:{lanes:c.lanes,firstContext:c.firstContext}),x=x.sibling;return Et(Ut,Ut.current&1|2),h.child}c=c.sibling}T.tail!==null&&nn()>Qa&&(h.flags|=128,C=!0,Dc(T,!1),h.lanes=4194304)}else{if(!C)if(c=Th(F),c!==null){if(h.flags|=128,C=!0,x=c.updateQueue,x!==null&&(h.updateQueue=x,h.flags|=4),Dc(T,!0),T.tail===null&&T.tailMode==="hidden"&&!F.alternate&&!Ot)return Jn(h),null}else 2*nn()-T.renderingStartTime>Qa&&x!==1073741824&&(h.flags|=128,C=!0,Dc(T,!1),h.lanes=4194304);T.isBackwards?(F.sibling=h.child,h.child=F):(x=T.last,x!==null?x.sibling=F:h.child=F,T.last=F)}return T.tail!==null?(h=T.tail,T.rendering=h,T.tail=h.sibling,T.renderingStartTime=nn(),h.sibling=null,x=Ut.current,Et(Ut,C?x&1|2:x&1),h):(Jn(h),null);case 22:case 23:return Px(),C=h.memoizedState!==null,c!==null&&c.memoizedState!==null!==C&&(h.flags|=8192),C&&(h.mode&1)!==0?(zs&1073741824)!==0&&(Jn(h),h.subtreeFlags&6&&(h.flags|=8192)):Jn(h),null;case 24:return null;case 25:return null}throw Error(t(156,h.tag))}function H3(c,h){switch(Wg(h),h.tag){case 1:return ks(h.type)&&xh(),c=h.flags,c&65536?(h.flags=c&-65537|128,h):null;case 3:return Ha(),Ft(ws),Ft(Qn),nx(),c=h.flags,(c&65536)!==0&&(c&128)===0?(h.flags=c&-65537|128,h):null;case 5:return ex(h),null;case 13:if(Ft(Ut),c=h.memoizedState,c!==null&&c.dehydrated!==null){if(h.alternate===null)throw Error(t(340));Va()}return c=h.flags,c&65536?(h.flags=c&-65537|128,h):null;case 19:return Ft(Ut),null;case 4:return Ha(),null;case 10:return Xg(h.type._context),null;case 22:case 23:return Px(),null;case 24:return null;default:return null}}var jh=!1,Zn=!1,q3=typeof WeakSet=="function"?WeakSet:Set,Pe=null;function Ka(c,h){var x=c.ref;if(x!==null)if(typeof x=="function")try{x(null)}catch(C){Kt(c,h,C)}else x.current=null}function kx(c,h,x){try{x()}catch(C){Kt(c,h,C)}}var Nk=!1;function K3(c,h){if(Pg=sh,c=sw(),Ig(c)){if("selectionStart"in c)var x={start:c.selectionStart,end:c.selectionEnd};else e:{x=(x=c.ownerDocument)&&x.defaultView||window;var C=x.getSelection&&x.getSelection();if(C&&C.rangeCount!==0){x=C.anchorNode;var I=C.anchorOffset,T=C.focusNode;C=C.focusOffset;try{x.nodeType,T.nodeType}catch{x=null;break e}var F=0,q=-1,J=-1,he=0,Se=0,$e=c,ke=null;t:for(;;){for(var De;$e!==x||I!==0&&$e.nodeType!==3||(q=F+I),$e!==T||C!==0&&$e.nodeType!==3||(J=F+C),$e.nodeType===3&&(F+=$e.nodeValue.length),(De=$e.firstChild)!==null;)ke=$e,$e=De;for(;;){if($e===c)break t;if(ke===x&&++he===I&&(q=F),ke===T&&++Se===C&&(J=F),(De=$e.nextSibling)!==null)break;$e=ke,ke=$e.parentNode}$e=De}x=q===-1||J===-1?null:{start:q,end:J}}else x=null}x=x||{start:0,end:0}}else x=null;for(Fg={focusedElem:c,selectionRange:x},sh=!1,Pe=h;Pe!==null;)if(h=Pe,c=h.child,(h.subtreeFlags&1028)!==0&&c!==null)c.return=h,Pe=c;else for(;Pe!==null;){h=Pe;try{var je=h.alternate;if((h.flags&1024)!==0)switch(h.tag){case 0:case 11:case 15:break;case 1:if(je!==null){var _e=je.memoizedProps,sn=je.memoizedState,ae=h.stateNode,ne=ae.getSnapshotBeforeUpdate(h.elementType===h.type?_e:vr(h.type,_e),sn);ae.__reactInternalSnapshotBeforeUpdate=ne}break;case 3:var ue=h.stateNode.containerInfo;ue.nodeType===1?ue.textContent="":ue.nodeType===9&&ue.documentElement&&ue.removeChild(ue.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(t(163))}}catch(Te){Kt(h,h.return,Te)}if(c=h.sibling,c!==null){c.return=h.return,Pe=c;break}Pe=h.return}return je=Nk,Nk=!1,je}function Mc(c,h,x){var C=h.updateQueue;if(C=C!==null?C.lastEffect:null,C!==null){var I=C=C.next;do{if((I.tag&c)===c){var T=I.destroy;I.destroy=void 0,T!==void 0&&kx(h,x,T)}I=I.next}while(I!==C)}}function Oh(c,h){if(h=h.updateQueue,h=h!==null?h.lastEffect:null,h!==null){var x=h=h.next;do{if((x.tag&c)===c){var C=x.create;x.destroy=C()}x=x.next}while(x!==h)}}function Cx(c){var h=c.ref;if(h!==null){var x=c.stateNode;switch(c.tag){case 5:c=x;break;default:c=x}typeof h=="function"?h(c):h.current=c}}function Ik(c){var h=c.alternate;h!==null&&(c.alternate=null,Ik(h)),c.child=null,c.deletions=null,c.sibling=null,c.tag===5&&(h=c.stateNode,h!==null&&(delete h[Or],delete h[kc],delete h[_g],delete h[R3],delete h[A3])),c.stateNode=null,c.return=null,c.dependencies=null,c.memoizedProps=null,c.memoizedState=null,c.pendingProps=null,c.stateNode=null,c.updateQueue=null}function $k(c){return c.tag===5||c.tag===3||c.tag===4}function Tk(c){e:for(;;){for(;c.sibling===null;){if(c.return===null||$k(c.return))return null;c=c.return}for(c.sibling.return=c.return,c=c.sibling;c.tag!==5&&c.tag!==6&&c.tag!==18;){if(c.flags&2||c.child===null||c.tag===4)continue e;c.child.return=c,c=c.child}if(!(c.flags&2))return c.stateNode}}function Sx(c,h,x){var C=c.tag;if(C===5||C===6)c=c.stateNode,h?x.nodeType===8?x.parentNode.insertBefore(c,h):x.insertBefore(c,h):(x.nodeType===8?(h=x.parentNode,h.insertBefore(c,x)):(h=x,h.appendChild(c)),x=x._reactRootContainer,x!=null||h.onclick!==null||(h.onclick=mh));else if(C!==4&&(c=c.child,c!==null))for(Sx(c,h,x),c=c.sibling;c!==null;)Sx(c,h,x),c=c.sibling}function Nx(c,h,x){var C=c.tag;if(C===5||C===6)c=c.stateNode,h?x.insertBefore(c,h):x.appendChild(c);else if(C!==4&&(c=c.child,c!==null))for(Nx(c,h,x),c=c.sibling;c!==null;)Nx(c,h,x),c=c.sibling}var Ln=null,br=!1;function Wo(c,h,x){for(x=x.child;x!==null;)Ek(c,h,x),x=x.sibling}function Ek(c,h,x){if(jr&&typeof jr.onCommitFiberUnmount=="function")try{jr.onCommitFiberUnmount(Yd,x)}catch{}switch(x.tag){case 5:Zn||Ka(x,h);case 6:var C=Ln,I=br;Ln=null,Wo(c,h,x),Ln=C,br=I,Ln!==null&&(br?(c=Ln,x=x.stateNode,c.nodeType===8?c.parentNode.removeChild(x):c.removeChild(x)):Ln.removeChild(x.stateNode));break;case 18:Ln!==null&&(br?(c=Ln,x=x.stateNode,c.nodeType===8?Og(c.parentNode,x):c.nodeType===1&&Og(c,x),dc(c)):Og(Ln,x.stateNode));break;case 4:C=Ln,I=br,Ln=x.stateNode.containerInfo,br=!0,Wo(c,h,x),Ln=C,br=I;break;case 0:case 11:case 14:case 15:if(!Zn&&(C=x.updateQueue,C!==null&&(C=C.lastEffect,C!==null))){I=C=C.next;do{var T=I,F=T.destroy;T=T.tag,F!==void 0&&((T&2)!==0||(T&4)!==0)&&kx(x,h,F),I=I.next}while(I!==C)}Wo(c,h,x);break;case 1:if(!Zn&&(Ka(x,h),C=x.stateNode,typeof C.componentWillUnmount=="function"))try{C.props=x.memoizedProps,C.state=x.memoizedState,C.componentWillUnmount()}catch(q){Kt(x,h,q)}Wo(c,h,x);break;case 21:Wo(c,h,x);break;case 22:x.mode&1?(Zn=(C=Zn)||x.memoizedState!==null,Wo(c,h,x),Zn=C):Wo(c,h,x);break;default:Wo(c,h,x)}}function Rk(c){var h=c.updateQueue;if(h!==null){c.updateQueue=null;var x=c.stateNode;x===null&&(x=c.stateNode=new q3),h.forEach(function(C){var I=s4.bind(null,c,C);x.has(C)||(x.add(C),C.then(I,I))})}}function wr(c,h){var x=h.deletions;if(x!==null)for(var C=0;C<x.length;C++){var I=x[C];try{var T=c,F=h,q=F;e:for(;q!==null;){switch(q.tag){case 5:Ln=q.stateNode,br=!1;break e;case 3:Ln=q.stateNode.containerInfo,br=!0;break e;case 4:Ln=q.stateNode.containerInfo,br=!0;break e}q=q.return}if(Ln===null)throw Error(t(160));Ek(T,F,I),Ln=null,br=!1;var J=I.alternate;J!==null&&(J.return=null),I.return=null}catch(he){Kt(I,h,he)}}if(h.subtreeFlags&12854)for(h=h.child;h!==null;)Ak(h,c),h=h.sibling}function Ak(c,h){var x=c.alternate,C=c.flags;switch(c.tag){case 0:case 11:case 14:case 15:if(wr(h,c),Br(c),C&4){try{Mc(3,c,c.return),Oh(3,c)}catch(_e){Kt(c,c.return,_e)}try{Mc(5,c,c.return)}catch(_e){Kt(c,c.return,_e)}}break;case 1:wr(h,c),Br(c),C&512&&x!==null&&Ka(x,x.return);break;case 5:if(wr(h,c),Br(c),C&512&&x!==null&&Ka(x,x.return),c.flags&32){var I=c.stateNode;try{vt(I,"")}catch(_e){Kt(c,c.return,_e)}}if(C&4&&(I=c.stateNode,I!=null)){var T=c.memoizedProps,F=x!==null?x.memoizedProps:T,q=c.type,J=c.updateQueue;if(c.updateQueue=null,J!==null)try{q==="input"&&T.type==="radio"&&T.name!=null&&be(I,T),tc(q,F);var he=tc(q,T);for(F=0;F<J.length;F+=2){var Se=J[F],$e=J[F+1];Se==="style"?$a(I,$e):Se==="dangerouslySetInnerHTML"?et(I,$e):Se==="children"?vt(I,$e):N(I,Se,$e,he)}switch(q){case"input":xe(I,T);break;case"textarea":ln(I,T);break;case"select":var ke=I._wrapperState.wasMultiple;I._wrapperState.wasMultiple=!!T.multiple;var De=T.value;De!=null?Ht(I,!!T.multiple,De,!1):ke!==!!T.multiple&&(T.defaultValue!=null?Ht(I,!!T.multiple,T.defaultValue,!0):Ht(I,!!T.multiple,T.multiple?[]:"",!1))}I[kc]=T}catch(_e){Kt(c,c.return,_e)}}break;case 6:if(wr(h,c),Br(c),C&4){if(c.stateNode===null)throw Error(t(162));I=c.stateNode,T=c.memoizedProps;try{I.nodeValue=T}catch(_e){Kt(c,c.return,_e)}}break;case 3:if(wr(h,c),Br(c),C&4&&x!==null&&x.memoizedState.isDehydrated)try{dc(h.containerInfo)}catch(_e){Kt(c,c.return,_e)}break;case 4:wr(h,c),Br(c);break;case 13:wr(h,c),Br(c),I=c.child,I.flags&8192&&(T=I.memoizedState!==null,I.stateNode.isHidden=T,!T||I.alternate!==null&&I.alternate.memoizedState!==null||(Tx=nn())),C&4&&Rk(c);break;case 22:if(Se=x!==null&&x.memoizedState!==null,c.mode&1?(Zn=(he=Zn)||Se,wr(h,c),Zn=he):wr(h,c),Br(c),C&8192){if(he=c.memoizedState!==null,(c.stateNode.isHidden=he)&&!Se&&(c.mode&1)!==0)for(Pe=c,Se=c.child;Se!==null;){for($e=Pe=Se;Pe!==null;){switch(ke=Pe,De=ke.child,ke.tag){case 0:case 11:case 14:case 15:Mc(4,ke,ke.return);break;case 1:Ka(ke,ke.return);var je=ke.stateNode;if(typeof je.componentWillUnmount=="function"){C=ke,x=ke.return;try{h=C,je.props=h.memoizedProps,je.state=h.memoizedState,je.componentWillUnmount()}catch(_e){Kt(C,x,_e)}}break;case 5:Ka(ke,ke.return);break;case 22:if(ke.memoizedState!==null){Pk($e);continue}}De!==null?(De.return=ke,Pe=De):Pk($e)}Se=Se.sibling}e:for(Se=null,$e=c;;){if($e.tag===5){if(Se===null){Se=$e;try{I=$e.stateNode,he?(T=I.style,typeof T.setProperty=="function"?T.setProperty("display","none","important"):T.display="none"):(q=$e.stateNode,J=$e.memoizedProps.style,F=J!=null&&J.hasOwnProperty("display")?J.display:null,q.style.display=io("display",F))}catch(_e){Kt(c,c.return,_e)}}}else if($e.tag===6){if(Se===null)try{$e.stateNode.nodeValue=he?"":$e.memoizedProps}catch(_e){Kt(c,c.return,_e)}}else if(($e.tag!==22&&$e.tag!==23||$e.memoizedState===null||$e===c)&&$e.child!==null){$e.child.return=$e,$e=$e.child;continue}if($e===c)break e;for(;$e.sibling===null;){if($e.return===null||$e.return===c)break e;Se===$e&&(Se=null),$e=$e.return}Se===$e&&(Se=null),$e.sibling.return=$e.return,$e=$e.sibling}}break;case 19:wr(h,c),Br(c),C&4&&Rk(c);break;case 21:break;default:wr(h,c),Br(c)}}function Br(c){var h=c.flags;if(h&2){try{e:{for(var x=c.return;x!==null;){if($k(x)){var C=x;break e}x=x.return}throw Error(t(160))}switch(C.tag){case 5:var I=C.stateNode;C.flags&32&&(vt(I,""),C.flags&=-33);var T=Tk(c);Nx(c,T,I);break;case 3:case 4:var F=C.stateNode.containerInfo,q=Tk(c);Sx(c,q,F);break;default:throw Error(t(161))}}catch(J){Kt(c,c.return,J)}c.flags&=-3}h&4096&&(c.flags&=-4097)}function X3(c,h,x){Pe=c,Dk(c)}function Dk(c,h,x){for(var C=(c.mode&1)!==0;Pe!==null;){var I=Pe,T=I.child;if(I.tag===22&&C){var F=I.memoizedState!==null||jh;if(!F){var q=I.alternate,J=q!==null&&q.memoizedState!==null||Zn;q=jh;var he=Zn;if(jh=F,(Zn=J)&&!he)for(Pe=I;Pe!==null;)F=Pe,J=F.child,F.tag===22&&F.memoizedState!==null?Fk(I):J!==null?(J.return=F,Pe=J):Fk(I);for(;T!==null;)Pe=T,Dk(T),T=T.sibling;Pe=I,jh=q,Zn=he}Mk(c)}else(I.subtreeFlags&8772)!==0&&T!==null?(T.return=I,Pe=T):Mk(c)}}function Mk(c){for(;Pe!==null;){var h=Pe;if((h.flags&8772)!==0){var x=h.alternate;try{if((h.flags&8772)!==0)switch(h.tag){case 0:case 11:case 15:Zn||Oh(5,h);break;case 1:var C=h.stateNode;if(h.flags&4&&!Zn)if(x===null)C.componentDidMount();else{var I=h.elementType===h.type?x.memoizedProps:vr(h.type,x.memoizedProps);C.componentDidUpdate(I,x.memoizedState,C.__reactInternalSnapshotBeforeUpdate)}var T=h.updateQueue;T!==null&&Pw(h,T,C);break;case 3:var F=h.updateQueue;if(F!==null){if(x=null,h.child!==null)switch(h.child.tag){case 5:x=h.child.stateNode;break;case 1:x=h.child.stateNode}Pw(h,F,x)}break;case 5:var q=h.stateNode;if(x===null&&h.flags&4){x=q;var J=h.memoizedProps;switch(h.type){case"button":case"input":case"select":case"textarea":J.autoFocus&&x.focus();break;case"img":J.src&&(x.src=J.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(h.memoizedState===null){var he=h.alternate;if(he!==null){var Se=he.memoizedState;if(Se!==null){var $e=Se.dehydrated;$e!==null&&dc($e)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(t(163))}Zn||h.flags&512&&Cx(h)}catch(ke){Kt(h,h.return,ke)}}if(h===c){Pe=null;break}if(x=h.sibling,x!==null){x.return=h.return,Pe=x;break}Pe=h.return}}function Pk(c){for(;Pe!==null;){var h=Pe;if(h===c){Pe=null;break}var x=h.sibling;if(x!==null){x.return=h.return,Pe=x;break}Pe=h.return}}function Fk(c){for(;Pe!==null;){var h=Pe;try{switch(h.tag){case 0:case 11:case 15:var x=h.return;try{Oh(4,h)}catch(J){Kt(h,x,J)}break;case 1:var C=h.stateNode;if(typeof C.componentDidMount=="function"){var I=h.return;try{C.componentDidMount()}catch(J){Kt(h,I,J)}}var T=h.return;try{Cx(h)}catch(J){Kt(h,T,J)}break;case 5:var F=h.return;try{Cx(h)}catch(J){Kt(h,F,J)}}}catch(J){Kt(h,h.return,J)}if(h===c){Pe=null;break}var q=h.sibling;if(q!==null){q.return=h.return,Pe=q;break}Pe=h.return}}var Q3=Math.ceil,_h=S.ReactCurrentDispatcher,Ix=S.ReactCurrentOwner,Js=S.ReactCurrentBatchConfig,ft=0,In=null,cn=null,jn=0,zs=0,Xa=Oo(0),yn=0,Pc=null,Mi=0,zh=0,$x=0,Fc=null,Ss=null,Tx=0,Qa=1/0,xo=null,Bh=!1,Ex=null,Uo=null,Vh=!1,Go=null,Wh=0,Lc=0,Rx=null,Uh=-1,Gh=0;function cs(){return(ft&6)!==0?nn():Uh!==-1?Uh:Uh=nn()}function Ho(c){return(c.mode&1)===0?1:(ft&2)!==0&&jn!==0?jn&-jn:M3.transition!==null?(Gh===0&&(Gh=Tb()),Gh):(c=kt,c!==0||(c=window.event,c=c===void 0?16:jb(c.type)),c)}function kr(c,h,x,C){if(50<Lc)throw Lc=0,Rx=null,Error(t(185));ic(c,x,C),((ft&2)===0||c!==In)&&(c===In&&((ft&2)===0&&(zh|=x),yn===4&&qo(c,jn)),Ns(c,C),x===1&&ft===0&&(h.mode&1)===0&&(Qa=nn()+500,vh&&zo()))}function Ns(c,h){var x=c.callbackNode;MD(c,h);var C=eh(c,c===In?jn:0);if(C===0)x!==null&&Nb(x),c.callbackNode=null,c.callbackPriority=0;else if(h=C&-C,c.callbackPriority!==h){if(x!=null&&Nb(x),h===1)c.tag===0?D3(jk.bind(null,c)):kw(jk.bind(null,c)),T3(function(){(ft&6)===0&&zo()}),x=null;else{switch(Eb(C)){case 1:x=cg;break;case 4:x=Ib;break;case 16:x=Qd;break;case 536870912:x=$b;break;default:x=Qd}x=Gk(x,Lk.bind(null,c))}c.callbackPriority=h,c.callbackNode=x}}function Lk(c,h){if(Uh=-1,Gh=0,(ft&6)!==0)throw Error(t(327));var x=c.callbackNode;if(Ya()&&c.callbackNode!==x)return null;var C=eh(c,c===In?jn:0);if(C===0)return null;if((C&30)!==0||(C&c.expiredLanes)!==0||h)h=Hh(c,C);else{h=C;var I=ft;ft|=2;var T=_k();(In!==c||jn!==h)&&(xo=null,Qa=nn()+500,Fi(c,h));do try{Z3();break}catch(q){Ok(c,q)}while(!0);Kg(),_h.current=T,ft=I,cn!==null?h=0:(In=null,jn=0,h=yn)}if(h!==0){if(h===2&&(I=ug(c),I!==0&&(C=I,h=Ax(c,I))),h===1)throw x=Pc,Fi(c,0),qo(c,C),Ns(c,nn()),x;if(h===6)qo(c,C);else{if(I=c.current.alternate,(C&30)===0&&!Y3(I)&&(h=Hh(c,C),h===2&&(T=ug(c),T!==0&&(C=T,h=Ax(c,T))),h===1))throw x=Pc,Fi(c,0),qo(c,C),Ns(c,nn()),x;switch(c.finishedWork=I,c.finishedLanes=C,h){case 0:case 1:throw Error(t(345));case 2:Li(c,Ss,xo);break;case 3:if(qo(c,C),(C&130023424)===C&&(h=Tx+500-nn(),10<h)){if(eh(c,0)!==0)break;if(I=c.suspendedLanes,(I&C)!==C){cs(),c.pingedLanes|=c.suspendedLanes&I;break}c.timeoutHandle=jg(Li.bind(null,c,Ss,xo),h);break}Li(c,Ss,xo);break;case 4:if(qo(c,C),(C&4194240)===C)break;for(h=c.eventTimes,I=-1;0<C;){var F=31-gr(C);T=1<<F,F=h[F],F>I&&(I=F),C&=~T}if(C=I,C=nn()-C,C=(120>C?120:480>C?480:1080>C?1080:1920>C?1920:3e3>C?3e3:4320>C?4320:1960*Q3(C/1960))-C,10<C){c.timeoutHandle=jg(Li.bind(null,c,Ss,xo),C);break}Li(c,Ss,xo);break;case 5:Li(c,Ss,xo);break;default:throw Error(t(329))}}}return Ns(c,nn()),c.callbackNode===x?Lk.bind(null,c):null}function Ax(c,h){var x=Fc;return c.current.memoizedState.isDehydrated&&(Fi(c,h).flags|=256),c=Hh(c,h),c!==2&&(h=Ss,Ss=x,h!==null&&Dx(h)),c}function Dx(c){Ss===null?Ss=c:Ss.push.apply(Ss,c)}function Y3(c){for(var h=c;;){if(h.flags&16384){var x=h.updateQueue;if(x!==null&&(x=x.stores,x!==null))for(var C=0;C<x.length;C++){var I=x[C],T=I.getSnapshot;I=I.value;try{if(!xr(T(),I))return!1}catch{return!1}}}if(x=h.child,h.subtreeFlags&16384&&x!==null)x.return=h,h=x;else{if(h===c)break;for(;h.sibling===null;){if(h.return===null||h.return===c)return!0;h=h.return}h.sibling.return=h.return,h=h.sibling}}return!0}function qo(c,h){for(h&=~$x,h&=~zh,c.suspendedLanes|=h,c.pingedLanes&=~h,c=c.expirationTimes;0<h;){var x=31-gr(h),C=1<<x;c[x]=-1,h&=~C}}function jk(c){if((ft&6)!==0)throw Error(t(327));Ya();var h=eh(c,0);if((h&1)===0)return Ns(c,nn()),null;var x=Hh(c,h);if(c.tag!==0&&x===2){var C=ug(c);C!==0&&(h=C,x=Ax(c,C))}if(x===1)throw x=Pc,Fi(c,0),qo(c,h),Ns(c,nn()),x;if(x===6)throw Error(t(345));return c.finishedWork=c.current.alternate,c.finishedLanes=h,Li(c,Ss,xo),Ns(c,nn()),null}function Mx(c,h){var x=ft;ft|=1;try{return c(h)}finally{ft=x,ft===0&&(Qa=nn()+500,vh&&zo())}}function Pi(c){Go!==null&&Go.tag===0&&(ft&6)===0&&Ya();var h=ft;ft|=1;var x=Js.transition,C=kt;try{if(Js.transition=null,kt=1,c)return c()}finally{kt=C,Js.transition=x,ft=h,(ft&6)===0&&zo()}}function Px(){zs=Xa.current,Ft(Xa)}function Fi(c,h){c.finishedWork=null,c.finishedLanes=0;var x=c.timeoutHandle;if(x!==-1&&(c.timeoutHandle=-1,$3(x)),cn!==null)for(x=cn.return;x!==null;){var C=x;switch(Wg(C),C.tag){case 1:C=C.type.childContextTypes,C!=null&&xh();break;case 3:Ha(),Ft(ws),Ft(Qn),nx();break;case 5:ex(C);break;case 4:Ha();break;case 13:Ft(Ut);break;case 19:Ft(Ut);break;case 10:Xg(C.type._context);break;case 22:case 23:Px()}x=x.return}if(In=c,cn=c=Ko(c.current,null),jn=zs=h,yn=0,Pc=null,$x=zh=Mi=0,Ss=Fc=null,Ri!==null){for(h=0;h<Ri.length;h++)if(x=Ri[h],C=x.interleaved,C!==null){x.interleaved=null;var I=C.next,T=x.pending;if(T!==null){var F=T.next;T.next=I,C.next=F}x.pending=C}Ri=null}return c}function Ok(c,h){do{var x=cn;try{if(Kg(),Eh.current=Mh,Rh){for(var C=Gt.memoizedState;C!==null;){var I=C.queue;I!==null&&(I.pending=null),C=C.next}Rh=!1}if(Di=0,Nn=xn=Gt=null,Tc=!1,Ec=0,Ix.current=null,x===null||x.return===null){yn=1,Pc=h,cn=null;break}e:{var T=c,F=x.return,q=x,J=h;if(h=jn,q.flags|=32768,J!==null&&typeof J=="object"&&typeof J.then=="function"){var he=J,Se=q,$e=Se.tag;if((Se.mode&1)===0&&($e===0||$e===11||$e===15)){var ke=Se.alternate;ke?(Se.updateQueue=ke.updateQueue,Se.memoizedState=ke.memoizedState,Se.lanes=ke.lanes):(Se.updateQueue=null,Se.memoizedState=null)}var De=ck(F);if(De!==null){De.flags&=-257,uk(De,F,q,T,h),De.mode&1&&lk(T,he,h),h=De,J=he;var je=h.updateQueue;if(je===null){var _e=new Set;_e.add(J),h.updateQueue=_e}else je.add(J);break e}else{if((h&1)===0){lk(T,he,h),Fx();break e}J=Error(t(426))}}else if(Ot&&q.mode&1){var sn=ck(F);if(sn!==null){(sn.flags&65536)===0&&(sn.flags|=256),uk(sn,F,q,T,h),Hg(qa(J,q));break e}}T=J=qa(J,q),yn!==4&&(yn=2),Fc===null?Fc=[T]:Fc.push(T),T=F;do{switch(T.tag){case 3:T.flags|=65536,h&=-h,T.lanes|=h;var ae=ik(T,J,h);Mw(T,ae);break e;case 1:q=J;var ne=T.type,ue=T.stateNode;if((T.flags&128)===0&&(typeof ne.getDerivedStateFromError=="function"||ue!==null&&typeof ue.componentDidCatch=="function"&&(Uo===null||!Uo.has(ue)))){T.flags|=65536,h&=-h,T.lanes|=h;var Te=ak(T,q,h);Mw(T,Te);break e}}T=T.return}while(T!==null)}Bk(x)}catch(ze){h=ze,cn===x&&x!==null&&(cn=x=x.return);continue}break}while(!0)}function _k(){var c=_h.current;return _h.current=Mh,c===null?Mh:c}function Fx(){(yn===0||yn===3||yn===2)&&(yn=4),In===null||(Mi&268435455)===0&&(zh&268435455)===0||qo(In,jn)}function Hh(c,h){var x=ft;ft|=2;var C=_k();(In!==c||jn!==h)&&(xo=null,Fi(c,h));do try{J3();break}catch(I){Ok(c,I)}while(!0);if(Kg(),ft=x,_h.current=C,cn!==null)throw Error(t(261));return In=null,jn=0,yn}function J3(){for(;cn!==null;)zk(cn)}function Z3(){for(;cn!==null&&!SD();)zk(cn)}function zk(c){var h=Uk(c.alternate,c,zs);c.memoizedProps=c.pendingProps,h===null?Bk(c):cn=h,Ix.current=null}function Bk(c){var h=c;do{var x=h.alternate;if(c=h.return,(h.flags&32768)===0){if(x=G3(x,h,zs),x!==null){cn=x;return}}else{if(x=H3(x,h),x!==null){x.flags&=32767,cn=x;return}if(c!==null)c.flags|=32768,c.subtreeFlags=0,c.deletions=null;else{yn=6,cn=null;return}}if(h=h.sibling,h!==null){cn=h;return}cn=h=c}while(h!==null);yn===0&&(yn=5)}function Li(c,h,x){var C=kt,I=Js.transition;try{Js.transition=null,kt=1,e4(c,h,x,C)}finally{Js.transition=I,kt=C}return null}function e4(c,h,x,C){do Ya();while(Go!==null);if((ft&6)!==0)throw Error(t(327));x=c.finishedWork;var I=c.finishedLanes;if(x===null)return null;if(c.finishedWork=null,c.finishedLanes=0,x===c.current)throw Error(t(177));c.callbackNode=null,c.callbackPriority=0;var T=x.lanes|x.childLanes;if(PD(c,T),c===In&&(cn=In=null,jn=0),(x.subtreeFlags&2064)===0&&(x.flags&2064)===0||Vh||(Vh=!0,Gk(Qd,function(){return Ya(),null})),T=(x.flags&15990)!==0,(x.subtreeFlags&15990)!==0||T){T=Js.transition,Js.transition=null;var F=kt;kt=1;var q=ft;ft|=4,Ix.current=null,K3(c,x),Ak(x,c),b3(Fg),sh=!!Pg,Fg=Pg=null,c.current=x,X3(x),ND(),ft=q,kt=F,Js.transition=T}else c.current=x;if(Vh&&(Vh=!1,Go=c,Wh=I),T=c.pendingLanes,T===0&&(Uo=null),TD(x.stateNode),Ns(c,nn()),h!==null)for(C=c.onRecoverableError,x=0;x<h.length;x++)I=h[x],C(I.value,{componentStack:I.stack,digest:I.digest});if(Bh)throw Bh=!1,c=Ex,Ex=null,c;return(Wh&1)!==0&&c.tag!==0&&Ya(),T=c.pendingLanes,(T&1)!==0?c===Rx?Lc++:(Lc=0,Rx=c):Lc=0,zo(),null}function Ya(){if(Go!==null){var c=Eb(Wh),h=Js.transition,x=kt;try{if(Js.transition=null,kt=16>c?16:c,Go===null)var C=!1;else{if(c=Go,Go=null,Wh=0,(ft&6)!==0)throw Error(t(331));var I=ft;for(ft|=4,Pe=c.current;Pe!==null;){var T=Pe,F=T.child;if((Pe.flags&16)!==0){var q=T.deletions;if(q!==null){for(var J=0;J<q.length;J++){var he=q[J];for(Pe=he;Pe!==null;){var Se=Pe;switch(Se.tag){case 0:case 11:case 15:Mc(8,Se,T)}var $e=Se.child;if($e!==null)$e.return=Se,Pe=$e;else for(;Pe!==null;){Se=Pe;var ke=Se.sibling,De=Se.return;if(Ik(Se),Se===he){Pe=null;break}if(ke!==null){ke.return=De,Pe=ke;break}Pe=De}}}var je=T.alternate;if(je!==null){var _e=je.child;if(_e!==null){je.child=null;do{var sn=_e.sibling;_e.sibling=null,_e=sn}while(_e!==null)}}Pe=T}}if((T.subtreeFlags&2064)!==0&&F!==null)F.return=T,Pe=F;else e:for(;Pe!==null;){if(T=Pe,(T.flags&2048)!==0)switch(T.tag){case 0:case 11:case 15:Mc(9,T,T.return)}var ae=T.sibling;if(ae!==null){ae.return=T.return,Pe=ae;break e}Pe=T.return}}var ne=c.current;for(Pe=ne;Pe!==null;){F=Pe;var ue=F.child;if((F.subtreeFlags&2064)!==0&&ue!==null)ue.return=F,Pe=ue;else e:for(F=ne;Pe!==null;){if(q=Pe,(q.flags&2048)!==0)try{switch(q.tag){case 0:case 11:case 15:Oh(9,q)}}catch(ze){Kt(q,q.return,ze)}if(q===F){Pe=null;break e}var Te=q.sibling;if(Te!==null){Te.return=q.return,Pe=Te;break e}Pe=q.return}}if(ft=I,zo(),jr&&typeof jr.onPostCommitFiberRoot=="function")try{jr.onPostCommitFiberRoot(Yd,c)}catch{}C=!0}return C}finally{kt=x,Js.transition=h}}return!1}function Vk(c,h,x){h=qa(x,h),h=ik(c,h,1),c=Vo(c,h,1),h=cs(),c!==null&&(ic(c,1,h),Ns(c,h))}function Kt(c,h,x){if(c.tag===3)Vk(c,c,x);else for(;h!==null;){if(h.tag===3){Vk(h,c,x);break}else if(h.tag===1){var C=h.stateNode;if(typeof h.type.getDerivedStateFromError=="function"||typeof C.componentDidCatch=="function"&&(Uo===null||!Uo.has(C))){c=qa(x,c),c=ak(h,c,1),h=Vo(h,c,1),c=cs(),h!==null&&(ic(h,1,c),Ns(h,c));break}}h=h.return}}function t4(c,h,x){var C=c.pingCache;C!==null&&C.delete(h),h=cs(),c.pingedLanes|=c.suspendedLanes&x,In===c&&(jn&x)===x&&(yn===4||yn===3&&(jn&130023424)===jn&&500>nn()-Tx?Fi(c,0):$x|=x),Ns(c,h)}function Wk(c,h){h===0&&((c.mode&1)===0?h=1:(h=Zd,Zd<<=1,(Zd&130023424)===0&&(Zd=4194304)));var x=cs();c=po(c,h),c!==null&&(ic(c,h,x),Ns(c,x))}function n4(c){var h=c.memoizedState,x=0;h!==null&&(x=h.retryLane),Wk(c,x)}function s4(c,h){var x=0;switch(c.tag){case 13:var C=c.stateNode,I=c.memoizedState;I!==null&&(x=I.retryLane);break;case 19:C=c.stateNode;break;default:throw Error(t(314))}C!==null&&C.delete(h),Wk(c,x)}var Uk;Uk=function(c,h,x){if(c!==null)if(c.memoizedProps!==h.pendingProps||ws.current)Cs=!0;else{if((c.lanes&x)===0&&(h.flags&128)===0)return Cs=!1,U3(c,h,x);Cs=(c.flags&131072)!==0}else Cs=!1,Ot&&(h.flags&1048576)!==0&&Cw(h,wh,h.index);switch(h.lanes=0,h.tag){case 2:var C=h.type;Lh(c,h),c=h.pendingProps;var I=_a(h,Qn.current);Ga(h,x),I=ox(null,h,C,c,I,x);var T=ix();return h.flags|=1,typeof I=="object"&&I!==null&&typeof I.render=="function"&&I.$$typeof===void 0?(h.tag=1,h.memoizedState=null,h.updateQueue=null,ks(C)?(T=!0,yh(h)):T=!1,h.memoizedState=I.state!==null&&I.state!==void 0?I.state:null,Jg(h),I.updater=Ph,h.stateNode=I,I._reactInternals=h,hx(h,C,c,x),h=gx(null,h,C,!0,T,x)):(h.tag=0,Ot&&T&&Vg(h),ls(null,h,I,x),h=h.child),h;case 16:C=h.elementType;e:{switch(Lh(c,h),c=h.pendingProps,I=C._init,C=I(C._payload),h.type=C,I=h.tag=o4(C),c=vr(C,c),I){case 0:h=mx(null,h,C,c,x);break e;case 1:h=gk(null,h,C,c,x);break e;case 11:h=dk(null,h,C,c,x);break e;case 14:h=hk(null,h,C,vr(C.type,c),x);break e}throw Error(t(306,C,""))}return h;case 0:return C=h.type,I=h.pendingProps,I=h.elementType===C?I:vr(C,I),mx(c,h,C,I,x);case 1:return C=h.type,I=h.pendingProps,I=h.elementType===C?I:vr(C,I),gk(c,h,C,I,x);case 3:e:{if(xk(h),c===null)throw Error(t(387));C=h.pendingProps,T=h.memoizedState,I=T.element,Dw(c,h),$h(h,C,null,x);var F=h.memoizedState;if(C=F.element,T.isDehydrated)if(T={element:C,isDehydrated:!1,cache:F.cache,pendingSuspenseBoundaries:F.pendingSuspenseBoundaries,transitions:F.transitions},h.updateQueue.baseState=T,h.memoizedState=T,h.flags&256){I=qa(Error(t(423)),h),h=yk(c,h,C,x,I);break e}else if(C!==I){I=qa(Error(t(424)),h),h=yk(c,h,C,x,I);break e}else for(_s=jo(h.stateNode.containerInfo.firstChild),Os=h,Ot=!0,yr=null,x=Rw(h,null,C,x),h.child=x;x;)x.flags=x.flags&-3|4096,x=x.sibling;else{if(Va(),C===I){h=go(c,h,x);break e}ls(c,h,C,x)}h=h.child}return h;case 5:return Fw(h),c===null&&Gg(h),C=h.type,I=h.pendingProps,T=c!==null?c.memoizedProps:null,F=I.children,Lg(C,I)?F=null:T!==null&&Lg(C,T)&&(h.flags|=32),mk(c,h),ls(c,h,F,x),h.child;case 6:return c===null&&Gg(h),null;case 13:return vk(c,h,x);case 4:return Zg(h,h.stateNode.containerInfo),C=h.pendingProps,c===null?h.child=Wa(h,null,C,x):ls(c,h,C,x),h.child;case 11:return C=h.type,I=h.pendingProps,I=h.elementType===C?I:vr(C,I),dk(c,h,C,I,x);case 7:return ls(c,h,h.pendingProps,x),h.child;case 8:return ls(c,h,h.pendingProps.children,x),h.child;case 12:return ls(c,h,h.pendingProps.children,x),h.child;case 10:e:{if(C=h.type._context,I=h.pendingProps,T=h.memoizedProps,F=I.value,Et(Sh,C._currentValue),C._currentValue=F,T!==null)if(xr(T.value,F)){if(T.children===I.children&&!ws.current){h=go(c,h,x);break e}}else for(T=h.child,T!==null&&(T.return=h);T!==null;){var q=T.dependencies;if(q!==null){F=T.child;for(var J=q.firstContext;J!==null;){if(J.context===C){if(T.tag===1){J=mo(-1,x&-x),J.tag=2;var he=T.updateQueue;if(he!==null){he=he.shared;var Se=he.pending;Se===null?J.next=J:(J.next=Se.next,Se.next=J),he.pending=J}}T.lanes|=x,J=T.alternate,J!==null&&(J.lanes|=x),Qg(T.return,x,h),q.lanes|=x;break}J=J.next}}else if(T.tag===10)F=T.type===h.type?null:T.child;else if(T.tag===18){if(F=T.return,F===null)throw Error(t(341));F.lanes|=x,q=F.alternate,q!==null&&(q.lanes|=x),Qg(F,x,h),F=T.sibling}else F=T.child;if(F!==null)F.return=T;else for(F=T;F!==null;){if(F===h){F=null;break}if(T=F.sibling,T!==null){T.return=F.return,F=T;break}F=F.return}T=F}ls(c,h,I.children,x),h=h.child}return h;case 9:return I=h.type,C=h.pendingProps.children,Ga(h,x),I=Qs(I),C=C(I),h.flags|=1,ls(c,h,C,x),h.child;case 14:return C=h.type,I=vr(C,h.pendingProps),I=vr(C.type,I),hk(c,h,C,I,x);case 15:return fk(c,h,h.type,h.pendingProps,x);case 17:return C=h.type,I=h.pendingProps,I=h.elementType===C?I:vr(C,I),Lh(c,h),h.tag=1,ks(C)?(c=!0,yh(h)):c=!1,Ga(h,x),rk(h,C,I),hx(h,C,I,x),gx(null,h,C,!0,c,x);case 19:return wk(c,h,x);case 22:return pk(c,h,x)}throw Error(t(156,h.tag))};function Gk(c,h){return Sb(c,h)}function r4(c,h,x,C){this.tag=c,this.key=x,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=h,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=C,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Zs(c,h,x,C){return new r4(c,h,x,C)}function Lx(c){return c=c.prototype,!(!c||!c.isReactComponent)}function o4(c){if(typeof c=="function")return Lx(c)?1:0;if(c!=null){if(c=c.$$typeof,c===j)return 11;if(c===U)return 14}return 2}function Ko(c,h){var x=c.alternate;return x===null?(x=Zs(c.tag,h,c.key,c.mode),x.elementType=c.elementType,x.type=c.type,x.stateNode=c.stateNode,x.alternate=c,c.alternate=x):(x.pendingProps=h,x.type=c.type,x.flags=0,x.subtreeFlags=0,x.deletions=null),x.flags=c.flags&14680064,x.childLanes=c.childLanes,x.lanes=c.lanes,x.child=c.child,x.memoizedProps=c.memoizedProps,x.memoizedState=c.memoizedState,x.updateQueue=c.updateQueue,h=c.dependencies,x.dependencies=h===null?null:{lanes:h.lanes,firstContext:h.firstContext},x.sibling=c.sibling,x.index=c.index,x.ref=c.ref,x}function qh(c,h,x,C,I,T){var F=2;if(C=c,typeof c=="function")Lx(c)&&(F=1);else if(typeof c=="string")F=5;else e:switch(c){case M:return ji(x.children,I,T,h);case A:F=8,I|=8;break;case P:return c=Zs(12,x,h,I|2),c.elementType=P,c.lanes=T,c;case V:return c=Zs(13,x,h,I),c.elementType=V,c.lanes=T,c;case W:return c=Zs(19,x,h,I),c.elementType=W,c.lanes=T,c;case ee:return Kh(x,I,T,h);default:if(typeof c=="object"&&c!==null)switch(c.$$typeof){case D:F=10;break e;case E:F=9;break e;case j:F=11;break e;case U:F=14;break e;case X:F=16,C=null;break e}throw Error(t(130,c==null?c:typeof c,""))}return h=Zs(F,x,h,I),h.elementType=c,h.type=C,h.lanes=T,h}function ji(c,h,x,C){return c=Zs(7,c,C,h),c.lanes=x,c}function Kh(c,h,x,C){return c=Zs(22,c,C,h),c.elementType=ee,c.lanes=x,c.stateNode={isHidden:!1},c}function jx(c,h,x){return c=Zs(6,c,null,h),c.lanes=x,c}function Ox(c,h,x){return h=Zs(4,c.children!==null?c.children:[],c.key,h),h.lanes=x,h.stateNode={containerInfo:c.containerInfo,pendingChildren:null,implementation:c.implementation},h}function i4(c,h,x,C,I){this.tag=h,this.containerInfo=c,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=dg(0),this.expirationTimes=dg(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=dg(0),this.identifierPrefix=C,this.onRecoverableError=I,this.mutableSourceEagerHydrationData=null}function _x(c,h,x,C,I,T,F,q,J){return c=new i4(c,h,x,q,J),h===1?(h=1,T===!0&&(h|=8)):h=0,T=Zs(3,null,null,h),c.current=T,T.stateNode=c,T.memoizedState={element:C,isDehydrated:x,cache:null,transitions:null,pendingSuspenseBoundaries:null},Jg(T),c}function a4(c,h,x){var C=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:R,key:C==null?null:""+C,children:c,containerInfo:h,implementation:x}}function Hk(c){if(!c)return _o;c=c._reactInternals;e:{if(Ni(c)!==c||c.tag!==1)throw Error(t(170));var h=c;do{switch(h.tag){case 3:h=h.stateNode.context;break e;case 1:if(ks(h.type)){h=h.stateNode.__reactInternalMemoizedMergedChildContext;break e}}h=h.return}while(h!==null);throw Error(t(171))}if(c.tag===1){var x=c.type;if(ks(x))return bw(c,x,h)}return h}function qk(c,h,x,C,I,T,F,q,J){return c=_x(x,C,!0,c,I,T,F,q,J),c.context=Hk(null),x=c.current,C=cs(),I=Ho(x),T=mo(C,I),T.callback=h??null,Vo(x,T,I),c.current.lanes=I,ic(c,I,C),Ns(c,C),c}function Xh(c,h,x,C){var I=h.current,T=cs(),F=Ho(I);return x=Hk(x),h.context===null?h.context=x:h.pendingContext=x,h=mo(T,F),h.payload={element:c},C=C===void 0?null:C,C!==null&&(h.callback=C),c=Vo(I,h,F),c!==null&&(kr(c,I,F,T),Ih(c,I,F)),F}function Qh(c){if(c=c.current,!c.child)return null;switch(c.child.tag){case 5:return c.child.stateNode;default:return c.child.stateNode}}function Kk(c,h){if(c=c.memoizedState,c!==null&&c.dehydrated!==null){var x=c.retryLane;c.retryLane=x!==0&&x<h?x:h}}function zx(c,h){Kk(c,h),(c=c.alternate)&&Kk(c,h)}function l4(){return null}var Xk=typeof reportError=="function"?reportError:function(c){console.error(c)};function Bx(c){this._internalRoot=c}Yh.prototype.render=Bx.prototype.render=function(c){var h=this._internalRoot;if(h===null)throw Error(t(409));Xh(c,h,null,null)},Yh.prototype.unmount=Bx.prototype.unmount=function(){var c=this._internalRoot;if(c!==null){this._internalRoot=null;var h=c.containerInfo;Pi(function(){Xh(null,c,null,null)}),h[co]=null}};function Yh(c){this._internalRoot=c}Yh.prototype.unstable_scheduleHydration=function(c){if(c){var h=Db();c={blockedOn:null,target:c,priority:h};for(var x=0;x<Po.length&&h!==0&&h<Po[x].priority;x++);Po.splice(x,0,c),x===0&&Fb(c)}};function Vx(c){return!(!c||c.nodeType!==1&&c.nodeType!==9&&c.nodeType!==11)}function Jh(c){return!(!c||c.nodeType!==1&&c.nodeType!==9&&c.nodeType!==11&&(c.nodeType!==8||c.nodeValue!==" react-mount-point-unstable "))}function Qk(){}function c4(c,h,x,C,I){if(I){if(typeof C=="function"){var T=C;C=function(){var he=Qh(F);T.call(he)}}var F=qk(h,C,c,0,null,!1,!1,"",Qk);return c._reactRootContainer=F,c[co]=F.current,bc(c.nodeType===8?c.parentNode:c),Pi(),F}for(;I=c.lastChild;)c.removeChild(I);if(typeof C=="function"){var q=C;C=function(){var he=Qh(J);q.call(he)}}var J=_x(c,0,!1,null,null,!1,!1,"",Qk);return c._reactRootContainer=J,c[co]=J.current,bc(c.nodeType===8?c.parentNode:c),Pi(function(){Xh(h,J,x,C)}),J}function Zh(c,h,x,C,I){var T=x._reactRootContainer;if(T){var F=T;if(typeof I=="function"){var q=I;I=function(){var J=Qh(F);q.call(J)}}Xh(h,F,c,I)}else F=c4(x,h,c,I,C);return Qh(F)}Rb=function(c){switch(c.tag){case 3:var h=c.stateNode;if(h.current.memoizedState.isDehydrated){var x=oc(h.pendingLanes);x!==0&&(hg(h,x|1),Ns(h,nn()),(ft&6)===0&&(Qa=nn()+500,zo()))}break;case 13:Pi(function(){var C=po(c,1);if(C!==null){var I=cs();kr(C,c,1,I)}}),zx(c,1)}},fg=function(c){if(c.tag===13){var h=po(c,134217728);if(h!==null){var x=cs();kr(h,c,134217728,x)}zx(c,134217728)}},Ab=function(c){if(c.tag===13){var h=Ho(c),x=po(c,h);if(x!==null){var C=cs();kr(x,c,h,C)}zx(c,h)}},Db=function(){return kt},Mb=function(c,h){var x=kt;try{return kt=c,h()}finally{kt=x}},sc=function(c,h,x){switch(h){case"input":if(xe(c,x),h=x.name,x.type==="radio"&&h!=null){for(x=c;x.parentNode;)x=x.parentNode;for(x=x.querySelectorAll("input[name="+JSON.stringify(""+h)+'][type="radio"]'),h=0;h<x.length;h++){var C=x[h];if(C!==c&&C.form===c.form){var I=gh(C);if(!I)throw Error(t(90));Ue(C),xe(C,I)}}}break;case"textarea":ln(c,x);break;case"select":h=x.value,h!=null&&Ht(c,!!x.multiple,h,!1)}},as=Mx,Kn=Pi;var u4={usingClientEntryPoint:!1,Events:[Cc,ja,gh,qn,fr,Mx]},jc={findFiberByHostInstance:Ii,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},d4={bundleType:jc.bundleType,version:jc.version,rendererPackageName:jc.rendererPackageName,rendererConfig:jc.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:S.ReactCurrentDispatcher,findHostInstanceByFiber:function(c){return c=kb(c),c===null?null:c.stateNode},findFiberByHostInstance:jc.findFiberByHostInstance||l4,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var ef=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ef.isDisabled&&ef.supportsFiber)try{Yd=ef.inject(d4),jr=ef}catch{}}return Is.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=u4,Is.createPortal=function(c,h){var x=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Vx(h))throw Error(t(200));return a4(c,h,null,x)},Is.createRoot=function(c,h){if(!Vx(c))throw Error(t(299));var x=!1,C="",I=Xk;return h!=null&&(h.unstable_strictMode===!0&&(x=!0),h.identifierPrefix!==void 0&&(C=h.identifierPrefix),h.onRecoverableError!==void 0&&(I=h.onRecoverableError)),h=_x(c,1,!1,null,null,x,!1,C,I),c[co]=h.current,bc(c.nodeType===8?c.parentNode:c),new Bx(h)},Is.findDOMNode=function(c){if(c==null)return null;if(c.nodeType===1)return c;var h=c._reactInternals;if(h===void 0)throw typeof c.render=="function"?Error(t(188)):(c=Object.keys(c).join(","),Error(t(268,c)));return c=kb(h),c=c===null?null:c.stateNode,c},Is.flushSync=function(c){return Pi(c)},Is.hydrate=function(c,h,x){if(!Jh(h))throw Error(t(200));return Zh(null,c,h,!0,x)},Is.hydrateRoot=function(c,h,x){if(!Vx(c))throw Error(t(405));var C=x!=null&&x.hydratedSources||null,I=!1,T="",F=Xk;if(x!=null&&(x.unstable_strictMode===!0&&(I=!0),x.identifierPrefix!==void 0&&(T=x.identifierPrefix),x.onRecoverableError!==void 0&&(F=x.onRecoverableError)),h=qk(h,null,c,1,x??null,I,!1,T,F),c[co]=h.current,bc(c),C)for(c=0;c<C.length;c++)x=C[c],I=x._getVersion,I=I(x._source),h.mutableSourceEagerHydrationData==null?h.mutableSourceEagerHydrationData=[x,I]:h.mutableSourceEagerHydrationData.push(x,I);return new Yh(h)},Is.render=function(c,h,x){if(!Jh(h))throw Error(t(200));return Zh(null,c,h,!1,x)},Is.unmountComponentAtNode=function(c){if(!Jh(c))throw Error(t(40));return c._reactRootContainer?(Pi(function(){Zh(null,null,c,!1,function(){c._reactRootContainer=null,c[co]=null})}),!0):!1},Is.unstable_batchedUpdates=Mx,Is.unstable_renderSubtreeIntoContainer=function(c,h,x,C){if(!Jh(x))throw Error(t(200));if(c==null||c._reactInternals===void 0)throw Error(t(38));return Zh(c,h,x,!1,C)},Is.version="18.3.1-next-f1338f8080-20240426",Is}var r2;function LS(){if(r2)return Gx.exports;r2=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),Gx.exports=k4(),Gx.exports}var o2;function C4(){if(o2)return tf;o2=1;var n=LS();return tf.createRoot=n.createRoot,tf.hydrateRoot=n.hydrateRoot,tf}var S4=C4();const N4=by(S4),i2=n=>{let e;const t=new Set,s=(u,d)=>{const f=typeof u=="function"?u(e):u;if(!Object.is(f,e)){const m=e;e=d??(typeof f!="object"||f===null)?f:Object.assign({},e,f),t.forEach(g=>g(e,m))}},r=()=>e,a={setState:s,getState:r,getInitialState:()=>l,subscribe:u=>(t.add(u),()=>t.delete(u))},l=e=n(s,r,a);return a},I4=(n=>n?i2(n):i2),$4=n=>n;function T4(n,e=$4){const t=Xt.useSyncExternalStore(n.subscribe,Xt.useCallback(()=>e(n.getState()),[n,e]),Xt.useCallback(()=>e(n.getInitialState()),[n,e]));return Xt.useDebugValue(t),t}const a2=n=>{const e=I4(n),t=s=>T4(e,s);return Object.assign(t,e),t},Ps=(n=>n?a2(n):a2),on=Ps((n,e)=>({currentView:"home",selectedPlaylistId:null,selectedPluginId:null,selectedArtistId:null,selectedAlbumId:null,selectedArtistData:null,selectedAlbumData:null,searchQuery:"",isSearchActive:!1,navigate:t=>{n({currentView:t,selectedPlaylistId:null,selectedPluginId:null,selectedArtistId:null,selectedAlbumId:null,selectedArtistData:null,selectedAlbumData:null})},openPlaylist:t=>{n({currentView:"playlist-detail",selectedPlaylistId:t})},openPlugin:t=>{n({currentView:"plugin-detail",selectedPluginId:t})},openArtist:(t,s)=>{n({currentView:"artist-detail",selectedArtistId:t,selectedArtistData:s||null})},openAlbum:(t,s)=>{n({currentView:"album-detail",selectedAlbumId:t,selectedAlbumData:s||null})},setSearchQuery:t=>{n({searchQuery:t,isSearchActive:t.length>0})},setSearchActive:t=>{n({isSearchActive:t})},clearSearch:()=>{n({searchQuery:"",isSearchActive:!1})},goBack:()=>{const{currentView:t}=e(),s={searchQuery:"",isSearchActive:!1};n(t==="playlist-detail"?{...s,currentView:"playlists",selectedPlaylistId:null}:t==="plugin-detail"?{...s,currentView:"plugins",selectedPluginId:null}:t==="artist-detail"?{...s,currentView:"home",selectedArtistId:null,selectedArtistData:null}:t==="album-detail"?{...s,currentView:"home",selectedAlbumId:null,selectedAlbumData:null}:{...s,currentView:"home"})}}));function E4(n,e){let t;try{t=n()}catch{return}return{getItem:r=>{var o;const i=l=>l===null?null:JSON.parse(l,void 0),a=(o=t.getItem(r))!=null?o:null;return a instanceof Promise?a.then(i):i(a)},setItem:(r,o)=>t.setItem(r,JSON.stringify(o,void 0)),removeItem:r=>t.removeItem(r)}}const R0=n=>e=>{try{const t=n(e);return t instanceof Promise?t:{then(s){return R0(s)(t)},catch(s){return this}}}catch(t){return{then(s){return this},catch(s){return R0(s)(t)}}}},R4=(n,e)=>(t,s,r)=>{let o={storage:E4(()=>localStorage),partialize:w=>w,version:0,merge:(w,b)=>({...b,...w}),...e},i=!1;const a=new Set,l=new Set;let u=o.storage;if(!u)return n((...w)=>{console.warn(`[zustand persist middleware] Unable to update item '${o.name}', the given storage is currently unavailable.`),t(...w)},s,r);const d=()=>{const w=o.partialize({...s()});return u.setItem(o.name,{state:w,version:o.version})},f=r.setState;r.setState=(w,b)=>(f(w,b),d());const m=n((...w)=>(t(...w),d()),s,r);r.getInitialState=()=>m;let g;const y=()=>{var w,b;if(!u)return;i=!1,a.forEach(v=>{var N;return v((N=s())!=null?N:m)});const k=((b=o.onRehydrateStorage)==null?void 0:b.call(o,(w=s())!=null?w:m))||void 0;return R0(u.getItem.bind(u))(o.name).then(v=>{if(v)if(typeof v.version=="number"&&v.version!==o.version){if(o.migrate){const N=o.migrate(v.state,v.version);return N instanceof Promise?N.then(S=>[!0,S]):[!0,N]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,v.state];return[!1,void 0]}).then(v=>{var N;const[S,$]=v;if(g=o.merge($,(N=s())!=null?N:m),t(g,!0),S)return d()}).then(()=>{k==null||k(g,void 0),g=s(),i=!0,l.forEach(v=>v(g))}).catch(v=>{k==null||k(void 0,v)})};return r.persist={setOptions:w=>{o={...o,...w},w.storage&&(u=w.storage)},clearStorage:()=>{u==null||u.removeItem(o.name)},getOptions:()=>o,rehydrate:()=>y(),hasHydrated:()=>i,onHydrate:w=>(a.add(w),()=>{a.delete(w)}),onFinishHydration:w=>(l.add(w),()=>{l.delete(w)})},o.skipHydration||y(),g||m},fa=R4,gs=Ps()(fa((n,e)=>({likedTracks:[],playlists:[],downloads:[],likeTrack:t=>{n(s=>s.likedTracks.some(r=>r.id===t.id)?s:{likedTracks:[t,...s.likedTracks]})},unlikeTrack:t=>{n(s=>({likedTracks:s.likedTracks.filter(r=>r.id!==t)}))},isLiked:t=>e().likedTracks.some(s=>s.id===t),toggleLike:t=>{const{isLiked:s,likeTrack:r,unlikeTrack:o}=e();s(t.id)?o(t.id):r(t)},createPlaylist:(t,s)=>{const r={id:crypto.randomUUID(),name:t,description:s,tracks:[],createdAt:new Date,updatedAt:new Date};return n(o=>({playlists:[r,...o.playlists]})),r},deletePlaylist:t=>{n(s=>({playlists:s.playlists.filter(r=>r.id!==t)}))},renamePlaylist:(t,s)=>{n(r=>({playlists:r.playlists.map(o=>o.id===t?{...o,name:s,updatedAt:new Date}:o)}))},addToPlaylist:(t,s)=>{n(r=>({playlists:r.playlists.map(o=>o.id!==t||o.tracks.some(i=>i.id===s.id)?o:{...o,tracks:[...o.tracks,s],updatedAt:new Date})}))},removeFromPlaylist:(t,s)=>{n(r=>({playlists:r.playlists.map(o=>o.id===t?{...o,tracks:o.tracks.filter(i=>i.id!==s),updatedAt:new Date}:o)}))},reorderPlaylist:(t,s,r)=>{n(o=>({playlists:o.playlists.map(i=>{if(i.id!==t)return i;const a=[...i.tracks],[l]=a.splice(s,1);return l&&a.splice(r,0,l),{...i,tracks:a,updatedAt:new Date}})}))},startDownload:t=>{var s;n(r=>r.downloads.some(i=>i.track.id===t.id)?r:{downloads:[{track:t,status:"pending",progress:0,startedAt:new Date},...r.downloads]}),(s=window.api)!=null&&s.downloadTrack&&window.api.downloadTrack(t)},updateDownloadProgress:(t,s)=>{n(r=>({downloads:r.downloads.map(o=>o.track.id===t?{...o,status:"downloading",progress:s}:o)}))},completeDownload:(t,s)=>{n(r=>({downloads:r.downloads.map(o=>o.track.id===t?{...o,status:"completed",progress:100,filePath:s,completedAt:new Date}:o)}))},failDownload:(t,s)=>{n(r=>({downloads:r.downloads.map(o=>o.track.id===t?{...o,status:"failed",error:s}:o)}))},removeDownload:t=>{n(s=>({downloads:s.downloads.filter(r=>r.track.id!==t)}))},retryDownload:t=>{var r;const s=e().downloads.find(o=>o.track.id===t);s&&(n(o=>({downloads:o.downloads.map(i=>i.track.id===t?{...i,status:"pending",progress:0,error:void 0}:i)})),(r=window.api)!=null&&r.downloadTrack&&window.api.downloadTrack(s.track))},getDownload:t=>e().downloads.find(s=>s.track.id===t)}),{name:"audiio-library",partialize:n=>({likedTracks:n.likedTracks,playlists:n.playlists,downloads:n.downloads.filter(e=>e.status==="completed")})})),au={"deezer-metadata":"deezer","youtube-music":"youtube-music","lrclib-lyrics":"lrclib-lyrics","lastfm-scrobbler":"lastfm-scrobbler","spotify-metadata":"spotify-metadata","applemusic-artwork":"applemusic-artwork"},Kx=async(n,e)=>{var s;const t=au[n]||n;if((s=window.api)!=null&&s.setAddonEnabled)try{await window.api.setAddonEnabled(t,e),console.log(`Plugin ${n} (addon: ${t}) ${e?"enabled":"disabled"}`)}catch(r){console.error(`Failed to ${e?"enable":"disable"} plugin ${n}:`,r)}},A4=async(n,e)=>{var t,s;if((t=window.api)!=null&&t.setAddonEnabled){console.log("Syncing plugin states with main process...");for(const r of n)if(r.installed){const o=au[r.id]||r.id;try{await window.api.setAddonEnabled(o,r.enabled)}catch(i){console.error(`Failed to sync plugin ${r.id}:`,i)}}if(e.length>0&&((s=window.api)!=null&&s.setAddonOrder))try{const r=e.map(o=>au[o]||o);await window.api.setAddonOrder(r),console.log("Plugin order synced")}catch(r){console.error("Failed to sync plugin order:",r)}console.log("Plugin states synced")}},l2=async n=>{var e;if((e=window.api)!=null&&e.setAddonOrder)try{const t=n.map(s=>au[s]||s);await window.api.setAddonOrder(t),console.log("Plugin order updated:",t)}catch(t){console.error("Failed to update plugin order:",t)}},D4=async(n,e)=>{var s;const t=au[n]||n;if((s=window.api)!=null&&s.updateAddonSettings)try{await window.api.updateAddonSettings(t,e),console.log(`Plugin ${n} settings updated`)}catch(r){console.error(`Failed to update plugin ${n} settings:`,r)}},jS=[{id:"deezer-metadata",name:"Deezer Metadata",description:"Provides high-quality metadata, album artwork, and track information from Deezer's extensive music database.",version:"1.0.0",author:"Audiio Team",category:"metadata",enabled:!0,installed:!0,privacyAccess:[{type:"network",label:"Network Access",description:"Connects to Deezer API to fetch track metadata and artwork",required:!0},{type:"playback",label:"Playback Info",description:"Reads current track info to search for metadata",required:!0}],settingsDefinitions:[{key:"fetchArtwork",label:"Fetch Artwork",description:"Fetch album and artist artwork from Deezer",type:"boolean",default:!0},{key:"fetchArtistInfo",label:"Fetch Artist Info",description:"Fetch detailed artist information and artwork",type:"boolean",default:!0},{key:"fetchAlbumInfo",label:"Fetch Album Info",description:"Fetch album metadata (release date, track count)",type:"boolean",default:!0},{key:"fetchExternalIds",label:"Fetch External IDs",description:"Fetch ISRC and other external identifiers",type:"boolean",default:!0}],settings:{fetchArtwork:!0,fetchArtistInfo:!0,fetchAlbumInfo:!0,fetchExternalIds:!0}},{id:"applemusic-artwork",name:"Apple Music Artwork",description:"Fetches animated album artwork from Apple Music. Disable Deezer artwork fetching to see animated artwork.",version:"1.0.0",author:"Audiio Team",category:"metadata",enabled:!1,installed:!0,privacyAccess:[{type:"network",label:"Network Access",description:"Connects to iTunes API to search for albums and fetch artwork",required:!0},{type:"playback",label:"Playback Info",description:"Reads current track info to search for matching artwork",required:!0}],settingsDefinitions:[{key:"artworkType",label:"Artwork Type",description:"Prefer animated or static artwork",type:"select",default:"animated",options:[{value:"animated",label:"Animated (Video)"},{value:"static",label:"Static (Image)"}]},{key:"aspectRatio",label:"Aspect Ratio",description:"Preferred aspect ratio for animated artwork",type:"select",default:"tall",options:[{value:"tall",label:"Tall (Portrait)"},{value:"square",label:"Square"}]},{key:"loopCount",label:"Loop Count",description:"Number of times to loop animated artwork",type:"number",default:2,min:1,max:10},{key:"includeAudio",label:"Include Audio",description:"Include audio track in animated artwork",type:"boolean",default:!1}],settings:{artworkType:"animated",aspectRatio:"tall",loopCount:2,includeAudio:!1}},{id:"youtube-music",name:"YouTube Music",description:"Stream audio from YouTube Music. Access millions of tracks, official releases, and exclusive content.",version:"1.2.0",author:"Audiio Team",category:"streaming",enabled:!0,installed:!0,privacyAccess:[{type:"network",label:"Network Access",description:"Streams audio content from YouTube servers",required:!0},{type:"playback",label:"Playback Control",description:"Controls audio playback and manages stream quality",required:!0},{type:"storage",label:"Cache Storage",description:"Caches audio data for smoother playback",required:!1}]},{id:"lrclib-lyrics",name:"LRCLIB Lyrics",description:"Displays synchronized lyrics from LRCLIB, the open lyrics database. Supports both synced and plain lyrics.",version:"1.0.0",author:"Audiio Team",category:"lyrics",enabled:!0,installed:!0,privacyAccess:[{type:"network",label:"Network Access",description:"Fetches lyrics from LRCLIB servers",required:!0},{type:"playback",label:"Playback Info",description:"Reads current track and position for lyrics sync",required:!0}]},{id:"lastfm-scrobbler",name:"Last.fm Scrobbler",description:"Scrobble your listening history to Last.fm. Track your music taste and get personalized recommendations.",version:"2.0.0",author:"Community",category:"scrobbling",enabled:!1,installed:!0,privacyAccess:[{type:"network",label:"Network Access",description:"Sends listening data to Last.fm servers",required:!0},{type:"playback",label:"Playback History",description:"Tracks what songs you listen to and for how long",required:!0},{type:"library",label:"Library Access",description:"Reads your liked songs for recommendations",required:!1}]},{id:"spotify-metadata",name:"Spotify Metadata",description:"Enhanced metadata from Spotify including popularity scores, audio features (BPM, energy, key), and related artists for better ML recommendations.",version:"1.2.0",author:"Audiio Team",category:"metadata",enabled:!1,installed:!0,privacyAccess:[{type:"network",label:"Network Access",description:"Connects to Spotify API for metadata and audio features",required:!0},{type:"playback",label:"Playback Info",description:"Reads current track for metadata lookup",required:!0}],settingsDefinitions:[{key:"fetchAudioFeatures",label:"Fetch Audio Features",description:"Get BPM, energy, key, danceability for ML recommendations",type:"boolean",default:!0},{key:"fetchPopularity",label:"Fetch Popularity",description:"Get track popularity scores from Spotify",type:"boolean",default:!0},{key:"fetchSimilarTracks",label:"Fetch Similar Tracks",description:"Use Spotify recommendations for similar track discovery",type:"boolean",default:!0},{key:"fetchArtistInfo",label:"Fetch Artist Info",description:"Get related artists and genre information",type:"boolean",default:!0},{key:"cacheResults",label:"Cache Results",description:"Cache audio features locally for faster access",type:"boolean",default:!0}],settings:{fetchAudioFeatures:!0,fetchPopularity:!0,fetchSimilarTracks:!0,fetchArtistInfo:!0,cacheResults:!0}},{id:"local-audio-analysis",name:"Local Audio Analysis",description:"Analyze audio files locally for BPM, key, energy, and other features using FFmpeg. Works offline with no external API calls.",version:"1.0.0",author:"Audiio Team",category:"analysis",enabled:!0,installed:!0,privacyAccess:[{type:"playback",label:"Playback Info",description:"Analyzes currently playing audio for features",required:!0}],settingsDefinitions:[{key:"analyzeOnPlay",label:"Analyze On Play",description:"Automatically analyze tracks when they start playing",type:"boolean",default:!0},{key:"analyzeBpm",label:"Detect BPM",description:"Detect tempo using beat detection algorithms",type:"boolean",default:!0},{key:"analyzeKey",label:"Detect Key",description:"Detect musical key using chromagram analysis",type:"boolean",default:!0},{key:"analyzeEnergy",label:"Analyze Energy",description:"Calculate energy, loudness, and danceability",type:"boolean",default:!0},{key:"cacheResults",label:"Cache Results",description:"Store analysis results for faster access",type:"boolean",default:!0}],settings:{analyzeOnPlay:!0,analyzeBpm:!0,analyzeKey:!0,analyzeEnergy:!0,cacheResults:!0}}],M4=jS.map(n=>n.id),pa=Ps()(fa((n,e)=>({plugins:jS,pluginOrder:M4,addPlugin:t=>{const s={...t,enabled:!1,installed:!0};n(r=>({plugins:[...r.plugins,s],pluginOrder:[...r.pluginOrder,s.id]}))},removePlugin:t=>{n(s=>({plugins:s.plugins.filter(r=>r.id!==t),pluginOrder:s.pluginOrder.filter(r=>r!==t)}))},togglePlugin:t=>{const s=e().plugins.find(o=>o.id===t),r=s?!s.enabled:!1;n(o=>({plugins:o.plugins.map(i=>i.id===t?{...i,enabled:r}:i)})),Kx(t,r)},enablePlugin:t=>{n(s=>({plugins:s.plugins.map(r=>r.id===t?{...r,enabled:!0}:r)})),Kx(t,!0)},disablePlugin:t=>{n(s=>({plugins:s.plugins.map(r=>r.id===t?{...r,enabled:!1}:r)})),Kx(t,!1)},getPlugin:t=>e().plugins.find(s=>s.id===t),updatePluginSetting:(t,s,r)=>{n(i=>({plugins:i.plugins.map(a=>{if(a.id===t){const l={...a.settings,[s]:r};return{...a,settings:l}}return a})}));const o=e().plugins.find(i=>i.id===t);o!=null&&o.settings&&D4(t,o.settings)},getPluginSettings:t=>{const s=e().plugins.find(r=>r.id===t);return s==null?void 0:s.settings},reorderPlugins:(t,s)=>{n(r=>{const o=[...r.pluginOrder],[i]=o.splice(t,1);return i&&o.splice(s,0,i),l2(o),{pluginOrder:o}})},getOrderedPlugins:()=>{const{plugins:t,pluginOrder:s}=e();return[...t].sort((o,i)=>{const a=s.indexOf(o.id),l=s.indexOf(i.id);return a===-1&&l===-1?0:a===-1?1:l===-1?-1:a-l})},setPluginOrder:t=>{n({pluginOrder:t}),l2(t)}}),{name:"audiio-plugins",partialize:n=>({plugins:n.plugins.map(e=>({id:e.id,enabled:e.enabled,installed:e.installed,settings:e.settings})),pluginOrder:n.pluginOrder}),merge:(n,e)=>{const t=n;return{...e,plugins:e.plugins.map(s=>{var o;const r=(o=t==null?void 0:t.plugins)==null?void 0:o.find(i=>i.id===s.id);return r?{...s,enabled:r.enabled,installed:r.installed,settings:r.settings??s.settings}:s}),pluginOrder:(t==null?void 0:t.pluginOrder)??e.pluginOrder}},onRehydrateStorage:()=>n=>{n!=null&&n.plugins&&setTimeout(()=>{A4(n.plugins,n.pluginOrder)},100)}})),At=({size:n=24,className:e})=>p.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,children:p.jsx("path",{d:"M8 5v14l11-7z"})}),bp=({size:n=24,className:e})=>p.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,children:p.jsx("path",{d:"M6 19h4V5H6v14zm8-14v14h4V5h-4z"})}),OS=({size:n=24,className:e})=>p.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,children:p.jsx("path",{d:"M6 18l8.5-6L6 6v12zM16 6v12h2V6h-2z"})}),_S=({size:n=24,className:e})=>p.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,children:p.jsx("path",{d:"M6 6h2v12H6zm3.5 6l8.5 6V6z"})}),Dl=({size:n=24,className:e})=>p.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,children:p.jsx("path",{d:"M10.59 9.17L5.41 4 4 5.41l5.17 5.17 1.42-1.41zM14.5 4l2.04 2.04L4 18.59 5.41 20 17.96 7.46 20 9.5V4h-5.5zm.33 9.41l-1.41 1.41 3.13 3.13L14.5 20H20v-5.5l-2.04 2.04-3.13-3.13z"})}),zS=({size:n=24,className:e})=>p.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,children:p.jsx("path",{d:"M7 7h10v3l4-4-4-4v3H5v6h2V7zm10 10H7v-3l-4 4 4 4v-3h12v-6h-2v4z"})}),P4=({size:n=24,className:e})=>p.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,children:p.jsx("path",{d:"M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"})}),F4=({size:n=24,className:e})=>p.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,children:p.jsx("path",{d:"M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L9.91 6.09 12 8.18V4z"})}),L4=({size:n=24,className:e})=>p.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,children:p.jsx("path",{d:"M18.5 12c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM5 9v6h4l5 5V4L9 9H5z"})}),Ml=({size:n=24,className:e})=>p.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,children:p.jsx("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"})}),Su=({size:n=24,className:e})=>p.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,children:p.jsx("path",{d:"M16.5 3c-1.74 0-3.41.81-4.5 2.09C10.91 3.81 9.24 3 7.5 3 4.42 3 2 5.42 2 8.5c0 3.78 3.4 6.86 8.55 11.54L12 21.35l1.45-1.32C18.6 15.36 22 12.28 22 8.5 22 5.42 19.58 3 16.5 3zm-4.4 15.55l-.1.1-.1-.1C7.14 14.24 4 11.39 4 8.5 4 6.5 5.5 5 7.5 5c1.54 0 3.04.99 3.57 2.36h1.87C13.46 5.99 14.96 5 16.5 5c2 0 3.5 1.5 3.5 3.5 0 2.89-3.14 5.74-7.9 10.05z"})}),j4=({size:n=24,className:e})=>p.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,children:p.jsx("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"})}),O4=({size:n=24,className:e})=>p.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,children:p.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-5.5-2.5l7.51-3.49L17.5 6.5 9.99 9.99 6.5 17.5zm5.5-6.6c.61 0 1.1.49 1.1 1.1s-.49 1.1-1.1 1.1-1.1-.49-1.1-1.1.49-1.1 1.1-1.1z"})}),Yi=({size:n=24,className:e})=>p.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,children:p.jsx("path",{d:"M15 6H3v2h12V6zm0 4H3v2h12v-2zM3 16h8v-2H3v2zM17 6v8.18c-.31-.11-.65-.18-1-.18-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3V8h3V6h-5z"})}),gl=({size:n=24,className:e})=>p.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,children:p.jsx("path",{d:"M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"})}),Mf=({size:n=24,className:e})=>p.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,children:p.jsx("path",{d:"M15 6H3v2h12V6zm0 4H3v2h12v-2zM3 16h8v-2H3v2zM17 6v8.18c-.31-.11-.65-.18-1-.18-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3V8h3V6h-5z"})}),xl=({size:n=24,className:e})=>p.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,children:p.jsx("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"})}),_4=({size:n=24,className:e})=>p.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,children:p.jsx("path",{d:"M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"})}),ar=({size:n=24,className:e})=>p.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,children:p.jsx("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})}),ky=({size:n=24,className:e})=>p.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,children:p.jsx("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"})}),Ye=({size:n=24,className:e})=>p.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,children:p.jsx("path",{d:"M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"})}),wp=({size:n=24,className:e})=>p.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,children:p.jsx("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"})}),z4=({size:n=24,className:e})=>p.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,children:p.jsx("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"})}),B4=({size:n=24,className:e})=>p.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,children:p.jsx("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"})}),Pf=({size:n=24,className:e})=>p.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,children:p.jsx("path",{d:"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"})}),BS=({size:n=24,className:e})=>p.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,children:p.jsx("path",{d:"M7 7h10v3l4-4-4-4v3H5v6h2V7zm10 10H7v-3l-4 4 4 4v-3h12v-6h-2v4zm-4-2V9h-1l-2 1v1h1.5v4H13z"})}),kp=({size:n=24,className:e})=>p.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,children:p.jsx("path",{d:"M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"})}),VS=({size:n=24,className:e})=>p.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,children:p.jsx("path",{d:"M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6 1.41 1.41z"})}),WS=({size:n=24,className:e})=>p.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,children:p.jsx("path",{d:"M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6zm4 18H6V4h7v5h5v11zm-3-5H7v-2h8v2zm0-4H7V9h8v2z"})}),lu=({size:n=24,className:e})=>p.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,children:p.jsx("path",{d:"M20.5 11H19V7c0-1.1-.9-2-2-2h-4V3.5C13 2.12 11.88 1 10.5 1S8 2.12 8 3.5V5H4c-1.1 0-1.99.9-1.99 2v3.8H3.5c1.49 0 2.7 1.21 2.7 2.7s-1.21 2.7-2.7 2.7H2V20c0 1.1.9 2 2 2h3.8v-1.5c0-1.49 1.21-2.7 2.7-2.7 1.49 0 2.7 1.21 2.7 2.7V22H17c1.1 0 2-.9 2-2v-4h1.5c1.38 0 2.5-1.12 2.5-2.5S21.88 11 20.5 11z"})}),V4=({size:n=24,className:e})=>p.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,children:p.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"})}),W4=({size:n=24,className:e})=>p.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,children:p.jsx("path",{d:"M2 20h20v-4H2v4zm2-3h2v2H4v-2zM2 4v4h20V4H2zm4 3H4V5h2v2zm-4 7h20v-4H2v4zm2-3h2v2H4v-2z"})}),U4=({size:n=24,className:e})=>p.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,children:p.jsx("path",{d:"M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"})}),G4=({size:n=24,className:e})=>p.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,children:p.jsx("path",{d:"M4 6H2v14c0 1.1.9 2 2 2h14v-2H4V6zm16-4H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-1 9h-4v4h-2v-4H9V9h4V5h2v4h4v2z"})}),US=({size:n=24,className:e})=>p.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,children:p.jsx("path",{d:"M19.14 12.94c.04-.31.06-.63.06-.94 0-.31-.02-.63-.06-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.04.31-.06.63-.06.94s.02.63.06.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"})}),c2=({size:n=24,className:e})=>p.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,children:p.jsx("path",{d:"M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm0 10.99h7c-.53 4.12-3.28 7.79-7 8.94V12H5V6.3l7-3.11v8.8z"})}),yl=({size:n=24,className:e})=>p.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,children:p.jsx("path",{d:"M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"})}),GS=({size:n=24,className:e})=>p.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,children:p.jsx("path",{d:"M15 3H6c-.83 0-1.54.5-1.84 1.22l-3.02 7.05c-.09.23-.14.47-.14.73v2c0 1.1.9 2 2 2h6.31l-.95 4.57-.03.32c0 .41.17.79.44 1.06L9.83 23l6.59-6.59c.36-.36.58-.86.58-1.41V5c0-1.1-.9-2-2-2zm4 0v12h4V3h-4z"})}),Cy=({size:n=24,className:e})=>p.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,children:p.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zM4 12c0-4.42 3.58-8 8-8 1.85 0 3.55.63 4.9 1.69L5.69 16.9C4.63 15.55 4 13.85 4 12zm8 8c-1.85 0-3.55-.63-4.9-1.69L18.31 7.1C19.37 8.45 20 10.15 20 12c0 4.42-3.58 8-8 8z"})}),Sy=({size:n=24,className:e})=>p.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,children:p.jsx("path",{d:"M19.14 12.94c.04-.31.06-.63.06-.94 0-.31-.02-.63-.06-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.04.31-.06.63-.06.94s.02.63.06.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"})}),H4=({size:n=24,className:e})=>p.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,children:p.jsx("path",{d:"M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"})}),HS=({size:n=24,className:e})=>p.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,children:p.jsx("path",{d:"M6.76 4.84l-1.8-1.79-1.41 1.41 1.79 1.79 1.42-1.41zM4 10.5H1v2h3v-2zm9-9.95h-2V3.5h2V.55zm7.45 3.91l-1.41-1.41-1.79 1.79 1.41 1.41 1.79-1.79zm-3.21 13.7l1.79 1.8 1.41-1.41-1.8-1.79-1.4 1.4zM20 10.5v2h3v-2h-3zm-8-5c-3.31 0-6 2.69-6 6s2.69 6 6 6 6-2.69 6-6-2.69-6-6-6zm-1 16.95h2V19.5h-2v2.95zm-7.45-3.91l1.41 1.41 1.79-1.8-1.41-1.41-1.79 1.8z"})}),qS=({size:n=24,className:e})=>p.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,children:p.jsx("path",{d:"M12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9 9-4.03 9-9c0-.46-.04-.92-.1-1.36-.98 1.37-2.58 2.26-4.4 2.26-2.98 0-5.4-2.42-5.4-5.4 0-1.81.89-3.42 2.26-4.4-.44-.06-.9-.1-1.36-.1z"})}),q4=({size:n=24,className:e})=>p.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,children:p.jsx("path",{d:"M21 2H3c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h7v2H8v2h8v-2h-2v-2h7c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H3V4h18v12z"})}),K4=({size:n=24,className:e})=>p.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,children:p.jsx("path",{d:"M12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9c.83 0 1.5-.67 1.5-1.5 0-.39-.15-.74-.39-1.01-.23-.26-.38-.61-.38-.99 0-.83.67-1.5 1.5-1.5H16c2.76 0 5-2.24 5-5 0-4.42-4.03-8-9-8zm-5.5 9c-.83 0-1.5-.67-1.5-1.5S5.67 9 6.5 9 8 9.67 8 10.5 7.33 12 6.5 12zm3-4C8.67 8 8 7.33 8 6.5S8.67 5 9.5 5s1.5.67 1.5 1.5S10.33 8 9.5 8zm5 0c-.83 0-1.5-.67-1.5-1.5S13.67 5 14.5 5s1.5.67 1.5 1.5S15.33 8 14.5 8zm3 4c-.83 0-1.5-.67-1.5-1.5S16.67 9 17.5 9s1.5.67 1.5 1.5-.67 1.5-1.5 1.5z"})}),X4=({size:n=24,className:e})=>p.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,children:p.jsx("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"})}),Q4=({size:n=24,className:e})=>p.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,children:p.jsx("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"})}),Y4=({size:n=24,className:e})=>p.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,children:p.jsx("path",{d:"M9 16h6v-6h4l-7-7-7 7h4zm-4 2h14v2H5z"})}),Xx=({size:n=24,className:e})=>p.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,children:p.jsx("path",{d:"M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z"})}),J4=({size:n=24,className:e})=>p.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,children:p.jsx("path",{d:"M12 4V2C6.48 2 2 6.48 2 12h2c0-4.42 3.58-8 8-8z",children:p.jsx("animateTransform",{attributeName:"transform",type:"rotate",from:"0 12 12",to:"360 12 12",dur:"1s",repeatCount:"indefinite"})})}),u2=({size:n=24,className:e})=>p.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,children:p.jsx("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"})}),Z4=({size:n=24,className:e})=>p.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,children:p.jsx("path",{d:"M16 6l2.29 2.29-4.88 4.88-4-4L2 16.59 3.41 18l6-6 4 4 6.3-6.29L22 12V6z"})}),eM=({size:n=24,className:e})=>p.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,children:p.jsx("path",{d:"M16 18l2.29-2.29-4.88-4.88-4 4L2 7.41 3.41 6l6 6 4-4 6.3 6.29L22 12v6z"})}),tM=({size:n=24,className:e})=>p.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,children:p.jsx("path",{d:"M19 13H5v-2h14v2z"})}),KS=({size:n=24,className:e})=>p.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,children:p.jsx("path",{d:"M11 18c0 1.1-.9 2-2 2s-2-.9-2-2 .9-2 2-2 2 .9 2 2zm-2-8c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0-6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm6 4c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"})}),A0=({size:n=24,className:e})=>p.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,children:p.jsx("path",{d:"M3.24 6.15C2.51 6.43 2 7.17 2 8v12c0 1.1.89 2 2 2h16c1.11 0 2-.9 2-2V8c0-1.11-.89-2-2-2H8.3l8.26-3.34-.37-.91-13 5.4zm.76 8.35c0-1.93 1.57-3.5 3.5-3.5s3.5 1.57 3.5 3.5-1.57 3.5-3.5 3.5-3.5-1.57-3.5-3.5zm10 0c0-1.93 1.57-3.5 3.5-3.5s3.5 1.57 3.5 3.5-1.57 3.5-3.5 3.5-3.5-1.57-3.5-3.5z"})}),nM=({size:n=24,className:e})=>p.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,children:p.jsx("path",{d:"M18.6 6.62c-1.44 0-2.8.56-3.77 1.53L12 10.66 10.48 12h.01L7.8 14.39c-.64.64-1.49.99-2.4.99-1.87 0-3.39-1.51-3.39-3.38S3.53 8.62 5.4 8.62c.91 0 1.76.35 2.44 1.03l1.13 1 1.51-1.34L9.22 8.2C8.2 7.18 6.84 6.62 5.4 6.62 2.42 6.62 0 9.04 0 12s2.42 5.38 5.4 5.38c1.44 0 2.8-.56 3.77-1.53l2.83-2.5.01.01L13.52 12h-.01l2.69-2.39c.64-.64 1.49-.99 2.4-.99 1.87 0 3.39 1.51 3.39 3.38s-1.52 3.38-3.39 3.38c-.9 0-1.76-.35-2.44-1.03l-1.14-1.01-1.51 1.34 1.27 1.12c1.02 1.01 2.37 1.57 3.82 1.57 2.98 0 5.4-2.41 5.4-5.38s-2.42-5.37-5.4-5.37z"})}),d2=({size:n=24,className:e})=>p.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:`spinner-icon ${e||""}`,children:p.jsx("path",{d:"M12 4V2C6.48 2 2 6.48 2 12h2c0-4.42 3.58-8 8-8z",children:p.jsx("animateTransform",{attributeName:"transform",type:"rotate",from:"0 12 12",to:"360 12 12",dur:"1s",repeatCount:"indefinite"})})}),Ja=({icon:n,label:e,isActive:t,onClick:s,badge:r})=>p.jsxs("button",{className:`sidebar-nav-item ${t?"active":""}`,onClick:s,children:[p.jsx("span",{className:"sidebar-nav-icon",children:n}),p.jsx("span",{className:"sidebar-nav-label",children:e}),r!==void 0&&r>0&&p.jsx("span",{className:"sidebar-nav-badge",children:r>99?"99+":r})]}),sM=()=>{const{currentView:n,navigate:e}=on(),{likedTracks:t,playlists:s,downloads:r}=gs(),{plugins:o}=pa(),i=r.filter(l=>l.status!=="completed").length,a=o.filter(l=>l.enabled).length;return p.jsxs("aside",{className:"sidebar",children:[p.jsxs("div",{className:"sidebar-logo",children:[p.jsx("span",{className:"sidebar-logo-icon",children:p.jsx(Ye,{size:20})}),p.jsx("span",{className:"sidebar-logo-text",children:"audiio"})]}),p.jsxs("nav",{className:"sidebar-nav",children:[p.jsx("div",{className:"sidebar-section",children:p.jsx(Ja,{icon:p.jsx(O4,{size:20}),label:"Discover",view:"home",isActive:n==="home",onClick:()=>e("home")})}),p.jsxs("div",{className:"sidebar-section",children:[p.jsx("div",{className:"sidebar-section-header",children:"Your Library"}),p.jsx(Ja,{icon:p.jsx(Ml,{size:20}),label:"Liked Songs",view:"likes",isActive:n==="likes",onClick:()=>e("likes"),badge:t.length}),p.jsx(Ja,{icon:p.jsx(Yi,{size:20}),label:"Playlists",view:"playlists",isActive:n==="playlists"||n==="playlist-detail",onClick:()=>e("playlists"),badge:s.length}),p.jsx(Ja,{icon:p.jsx(gl,{size:20}),label:"Downloads",view:"downloads",isActive:n==="downloads",onClick:()=>e("downloads"),badge:i})]}),p.jsxs("div",{className:"sidebar-section",children:[p.jsx("div",{className:"sidebar-section-header",children:"Settings"}),p.jsx(Ja,{icon:p.jsx(lu,{size:20}),label:"Plugins",view:"plugins",isActive:n==="plugins"||n==="plugin-detail",onClick:()=>e("plugins"),badge:a}),p.jsx(Ja,{icon:p.jsx(Sy,{size:20}),label:"Appearance",view:"settings",isActive:n==="settings",onClick:()=>e("settings")})]})]}),p.jsxs("div",{className:"sidebar-playlists",children:[p.jsxs("div",{className:"sidebar-section-header",children:["Playlists",p.jsx("button",{className:"sidebar-add-button",onClick:()=>{const l=prompt("Playlist name:");l!=null&&l.trim()&&gs.getState().createPlaylist(l.trim())},title:"Create Playlist",children:p.jsx(xl,{size:18})})]}),p.jsx("div",{className:"sidebar-playlist-list",children:s.length===0?p.jsx("div",{className:"sidebar-empty",children:"No playlists yet"}):s.slice(0,10).map(l=>p.jsxs("button",{className:`sidebar-playlist-item ${n==="playlist-detail"&&on.getState().selectedPlaylistId===l.id?"active":""}`,onClick:()=>on.getState().openPlaylist(l.id),children:[p.jsx("span",{className:"sidebar-playlist-name",children:l.name}),p.jsx("span",{className:"sidebar-playlist-count",children:l.tracks.length})]},l.id))})]})]})},ma=Ps(n=>({query:"",results:{tracks:[],artists:[],albums:[]},isSearching:!1,error:null,activeFilter:"all",setQuery:e=>{n({query:e})},setActiveFilter:e=>{n({activeFilter:e})},search:async e=>{var t,s,r,o,i,a,l,u,d,f,m,g,y,w;if(!e.trim()){n({results:{tracks:[],artists:[],albums:[]},isSearching:!1});return}n({isSearching:!0,error:null,query:e});try{if(window.api){const[b,k,v]=await Promise.all([window.api.search({query:e,type:"track"}),window.api.search({query:e,type:"artist"}).catch(()=>[]),window.api.search({query:e,type:"album"}).catch(()=>[])]),N=[],S=new Set;for(const P of b||[])for(const D of P.artists||[]){const E=D.name.toLowerCase().trim();S.has(E)||(S.add(E),N.push({id:D.id||`artist-${E.replace(/\s+/g,"-")}`,name:D.name,image:((t=D.artwork)==null?void 0:t.medium)||((s=P.artwork)==null?void 0:s.medium),source:((r=P._meta)==null?void 0:r.metadataProvider)||"unknown"}))}const $=[],R=new Set;for(const P of b||[])if(P.album&&P.album.title){const D=`${P.album.title.toLowerCase().trim()}-${(((o=P.artists[0])==null?void 0:o.name)||"").toLowerCase().trim()}`;R.has(D)||(R.add(D),$.push({id:P.album.id||`album-${D.replace(/\s+/g,"-")}`,title:P.album.title,artist:((i=P.artists[0])==null?void 0:i.name)||"Unknown",artwork:((a=P.album.artwork)==null?void 0:a.medium)||((l=P.artwork)==null?void 0:l.medium),year:P.album.releaseDate?parseInt(P.album.releaseDate.substring(0,4)):void 0,trackCount:P.album.trackCount,source:((u=P._meta)==null?void 0:u.metadataProvider)||"unknown"}))}let M=N,A=$;if(Array.isArray(k)&&k.length>0){const P=k[0];if(P&&typeof P.name=="string"&&P.name.trim()){const D=[],E=new Set;for(const j of k)j.name&&!E.has(j.name.toLowerCase().trim())&&(E.add(j.name.toLowerCase().trim()),D.push({id:j.id,name:j.name,image:(d=j.artwork)==null?void 0:d.medium,source:"addon"}));D.length>0&&(M=D)}}if(Array.isArray(v)&&v.length>0){const P=v[0];if(P&&typeof P.title=="string"&&P.title.trim()){const D=[],E=new Set;for(const j of v)if(j.title){const V=`${j.title.toLowerCase().trim()}-${(((m=(f=j.artists)==null?void 0:f[0])==null?void 0:m.name)||"").toLowerCase().trim()}`;E.has(V)||(E.add(V),D.push({id:j.id,title:j.title,artist:((y=(g=j.artists)==null?void 0:g[0])==null?void 0:y.name)||"Unknown Artist",artwork:(w=j.artwork)==null?void 0:w.medium,year:j.releaseDate?parseInt(j.releaseDate.substring(0,4)):void 0,trackCount:j.trackCount,source:"addon"}))}D.length>0&&(A=D)}}n({results:{tracks:b||[],artists:M.slice(0,12),albums:A.slice(0,12)},isSearching:!1})}else await new Promise(b=>setTimeout(b,500)),n({results:{tracks:[],artists:[],albums:[]},isSearching:!1,error:"Search not available in development mode"})}catch(b){n({error:b instanceof Error?b.message:"Search failed",isSearching:!1})}},clear:()=>{n({query:"",results:{tracks:[],artists:[],albums:[]},error:null,activeFilter:"all"})}})),rM=[{value:"not_my_taste",label:"Not my taste"},{value:"heard_too_much",label:"Heard it too much"},{value:"bad_audio_quality",label:"Bad audio quality"},{value:"wrong_mood",label:"Wrong mood/vibe"},{value:"dont_like_artist",label:"Don't like this artist"},{value:"too_long",label:"Too long"},{value:"too_short",label:"Too short"},{value:"explicit_content",label:"Explicit content"},{value:"other",label:"Other reason"}],oM={ambient:10,sleep:5,meditation:5,"new age":15,classical:20,drone:10,lofi:25,"lo-fi":25,chill:30,jazz:35,acoustic:30,folk:35,soul:40,"r&b":40,blues:35,ballad:25,pop:55,indie:50,alternative:50,rock:55,country:45,reggae:45,funk:55,disco:60,"hip hop":65,"hip-hop":65,rap:70,electronic:70,dance:75,house:70,techno:75,punk:75,metal:80,edm:85,dubstep:85,"drum and bass":90,dnb:90,hardcore:95,hardstyle:95,workout:90,party:85},$s={COMPLETED_LISTEN:10,DISLIKE_BASE:-20,DISLIKE_REASON_MULTIPLIERS:{not_my_taste:1.5,heard_too_much:.5,bad_audio_quality:.3,wrong_mood:.3,dont_like_artist:2,too_long:.5,too_short:.5,explicit_content:1,other:1},SKIP:-5,ARTIST_SIMILARITY:40,GENRE_SIMILARITY:30,DURATION_SIMILARITY:10,TEMPORAL_MATCH:20,MIN_LISTENS_FOR_PATTERN:5};function Oi(n){return Math.max(-100,Math.min(100,n))}function Qx(){return new Date().getHours()}function iM(n){return(Date.now()-n)/(1e3*60*60*24)}function aM(n,e,t){return n*Math.pow(t,e)}function Za(n){return n.genres&&n.genres.length>0?n.genres:[]}function nf(n){return n.artists.map(e=>({id:e.id||e.name.toLowerCase().replace(/\s+/g,"-"),name:e.name}))}function Ff(n){const e=n.genres||[];let t=50,s=0;for(const l of e){const u=l.toLowerCase();for(const[d,f]of Object.entries(oM))if(u.includes(d)||d.includes(u)){t+=f,s++;break}}const r=s>0?Math.round(t/(s+1)):50;let o;r<=20?o="very-low":r<=40?o="low":r<=60?o="medium":r<=80?o="high":o="very-high";let i;r<=15?i="calm":r<=35?i="chill":r<=55?i="neutral":r<=75?i="upbeat":r<=90?i="energetic":i="intense";const a=r>50?Math.min(r+10,100):Math.max(r-10,0);return{energy:r,energyLevel:o,mood:i,valence:a}}const h2={artistPreferences:{},genrePreferences:{},timePatterns:Array.from({length:24},(n,e)=>({hour:e,genres:{},energy:"medium"})),avgSessionLength:0,preferredDuration:{min:12e4,max:3e5},totalListens:0,totalListenTime:0,uniqueArtists:0,uniqueTracks:0},On=Ps()(fa((n,e)=>({listenHistory:[],dislikedTracks:{},userProfile:h2,lastUpdated:Date.now(),recordListen:(t,s,r,o)=>{const i={trackId:t.id,timestamp:Date.now(),duration:s,totalDuration:t.duration,completed:r,skipped:o};n(a=>{const l=[i,...a.listenHistory].slice(0,1e3),u={...a.userProfile.artistPreferences};for(const y of nf(t)){const w=u[y.id]||{artistId:y.id,artistName:y.name,score:0,playCount:0,totalListenTime:0,likeCount:0,dislikeCount:0};let b=0;r&&(b+=$s.COMPLETED_LISTEN),o&&(b+=$s.SKIP),u[y.id]={...w,score:Oi(w.score+b),playCount:w.playCount+1,totalListenTime:w.totalListenTime+s}}const d={...a.userProfile.genrePreferences};for(const y of Za(t)){const w=d[y]||{genre:y,score:0,playCount:0,likeCount:0,dislikeCount:0};let b=0;r&&(b+=$s.COMPLETED_LISTEN*.5),o&&(b+=$s.SKIP*.5),d[y]={...w,score:Oi(w.score+b),playCount:w.playCount+1}}const f=Qx(),m=[...a.userProfile.timePatterns],g=m[f];for(const y of Za(t))g.genres[y]=(g.genres[y]||0)+1;return{listenHistory:l,userProfile:{...a.userProfile,artistPreferences:u,genrePreferences:d,timePatterns:m,totalListens:a.userProfile.totalListens+1,totalListenTime:a.userProfile.totalListenTime+s},lastUpdated:Date.now()}})},recordDislike:(t,s)=>{n(r=>{const o={trackId:t.id,reasons:s,timestamp:Date.now(),trackData:{title:t.title,artists:t.artists.map(u=>u.name),genres:Za(t)}},i={...r.userProfile.artistPreferences},a=s.includes("dont_like_artist");for(const u of nf(t)){const d=i[u.id]||{artistId:u.id,artistName:u.name,score:0,playCount:0,totalListenTime:0,likeCount:0,dislikeCount:0};let f=$s.DISLIKE_BASE;for(const m of s)f*=$s.DISLIKE_REASON_MULTIPLIERS[m]||1;a&&(f*=1.5),i[u.id]={...d,score:Oi(d.score+f),dislikeCount:d.dislikeCount+1}}const l={...r.userProfile.genrePreferences};for(const u of Za(t)){const d=l[u]||{genre:u,score:0,playCount:0,likeCount:0,dislikeCount:0};l[u]={...d,score:Oi(d.score+$s.DISLIKE_BASE*.3),dislikeCount:d.dislikeCount+1}}return{dislikedTracks:{...r.dislikedTracks,[t.id]:o},userProfile:{...r.userProfile,artistPreferences:i,genrePreferences:l},lastUpdated:Date.now()}})},recordReorder:(t,s,r)=>{const o=s-r,i=o>0,a=Math.min(Math.abs(o)*2,15);n(l=>{const u={...l.userProfile.artistPreferences},d={...l.userProfile.genrePreferences};for(const f of nf(t)){const m=u[f.id]||{artistId:f.id,artistName:f.name,score:0,playCount:0,totalListenTime:0,likeCount:0,dislikeCount:0},g=i?a:-a*.3;u[f.id]={...m,score:Oi(m.score+g)}}for(const f of Za(t)){const m=d[f]||{genre:f,score:0,playCount:0,likeCount:0,dislikeCount:0},g=i?a*.5:-a*.15;d[f]={...m,score:Oi(m.score+g)}}return{userProfile:{...l.userProfile,artistPreferences:u,genrePreferences:d},lastUpdated:Date.now()}})},removeDislike:t=>{n(s=>{const{[t]:r,...o}=s.dislikedTracks;return{dislikedTracks:o}})},isDisliked:t=>t in e().dislikedTracks,getDislikeReasons:t=>{const s=e().dislikedTracks[t];return s?s.reasons:null},calculateTrackScore:(t,s={})=>{const r=e(),{userProfile:o,dislikedTracks:i,listenHistory:a}=r,l=s.hour??Qx();if(i[t.id]){const w=i[t.id];let b=$s.DISLIKE_BASE;for(const v of w.reasons)b*=$s.DISLIKE_REASON_MULTIPLIERS[v]||1;const k=iM(w.timestamp);return b=aM(b,k,.99),b}let u=50;const d=nf(t);for(const w of d){const b=o.artistPreferences[w.id];b&&(u+=b.score/100*$s.ARTIST_SIMILARITY)}const f=Za(t);for(const w of f){const b=o.genrePreferences[w];b&&(u+=b.score/100*$s.GENRE_SIMILARITY)}const m=o.timePatterns[l];if(m&&Object.keys(m.genres).length>0){const w=Object.values(m.genres).reduce((b,k)=>b+k,0);for(const b of f){const v=(m.genres[b]||0)/w;u+=v*$s.TEMPORAL_MATCH}}const{preferredDuration:g}=o;t.duration>=g.min&&t.duration<=g.max&&(u+=$s.DURATION_SIMILARITY);const y=a.filter(w=>w.trackId===t.id).slice(0,5);for(const w of y){const b=(Date.now()-w.timestamp)/36e5;b<1?u-=20:b<24?u-=10:b<72&&(u-=5)}return y.length===0&&(u+=5),Oi(u)},getRecommendedTracks:(t,s=20,r={})=>{const o=e(),{calculateTrackScore:i,dislikedTracks:a}=o,u=t.filter(d=>!a[d.id]).map(d=>({track:d,score:i(d,r)}));return u.sort((d,f)=>f.score-d.score),u.slice(0,s).map(d=>d.track)},getMLEnhancedRecommendations:(t,s=20,r={})=>{const{useMLStore:o}=require("./ml-store");return o.getState().getHybridRecommendations(t,s,r.hour)},getTopGenres:(t=5)=>{const{genrePreferences:s}=e().userProfile;return Object.values(s).filter(r=>r.playCount>0).sort((r,o)=>o.score-r.score).slice(0,t).map(r=>r.genre)},getTopArtists:(t=5)=>{const{artistPreferences:s}=e().userProfile;return Object.values(s).filter(r=>r.playCount>0).sort((r,o)=>o.score-r.score).slice(0,t).map(r=>r.artistName)},getPersonalizedQueries:()=>{const t=e(),s=t.getTopGenres(3),r=t.getTopArtists(3),o=Qx(),i=[];let a="",l="";return o>=6&&o<12?(a="upbeat energizing",l="Morning Energy"):o>=12&&o<18?(a="popular trending",l="Afternoon Vibes"):o>=18&&o<22?(a="chill relaxing",l="Evening Wind Down"):(a="ambient calm lofi",l="Night Mode"),i.push({id:"mood-time",title:l,query:`${a} ${s[0]||"music"}`}),s.length>0&&i.push({id:"top-genre",title:`More ${s[0]}`,query:`${s[0]} best 2024`}),r.length>0&&(i.push({id:"top-artist",title:`Because you like ${r[0]}`,query:`${r[0]} similar artists`}),i.push({id:"artist-mix",title:`${r[0]} Radio`,query:`${r[0]}`})),s.length>=2&&i.push({id:"genre-mix",title:`${s[0]} x ${s[1]}`,query:`${s[0]} ${s[1]}`}),r.length>=2&&i.push({id:"discover-artist",title:`Discover: ${r[1]}`,query:`${r[1]} discography`}),i.length<4&&i.push({id:"trending",title:"Trending Now",query:"top hits 2024"},{id:"chill",title:"Chill Vibes",query:"chill lofi beats"}),i.slice(0,6)},sortTracksByEnergy:(t,s="asc")=>[...t].sort((r,o)=>{const i=Ff(r),a=Ff(o);return s==="asc"?i.energy-a.energy:a.energy-i.energy}),updateUserProfile:()=>{const t=e(),{listenHistory:s,userProfile:r}=t,o=s.filter(i=>i.completed).map(i=>i.totalDuration);if(o.length>=$s.MIN_LISTENS_FOR_PATTERN){o.sort((l,u)=>l-u);const i=o[Math.floor(o.length*.25)]||12e4,a=o[Math.floor(o.length*.75)]||3e5;n({userProfile:{...r,preferredDuration:{min:i,max:a},uniqueTracks:new Set(s.map(l=>l.trackId)).size}})}},clearHistory:()=>{n({listenHistory:[],dislikedTracks:{},userProfile:h2,lastUpdated:Date.now()})},exportData:()=>{const t=e();return{listenHistory:t.listenHistory,dislikedTracks:t.dislikedTracks,userProfile:t.userProfile,exportedAt:new Date().toISOString()}},getArtistHistory:()=>{const t=e(),s=new Set;return Object.keys(t.userProfile.artistPreferences).forEach(r=>{s.add(r.toLowerCase())}),t.listenHistory.forEach(r=>{r.artistId&&s.add(r.artistId.toLowerCase())}),s},getGenreHistory:()=>{const t=e(),s=new Set;return Object.keys(t.userProfile.genrePreferences).forEach(r=>{s.add(r.toLowerCase())}),t.userProfile.timePatterns.forEach(r=>{Object.keys(r.genres).forEach(o=>{s.add(o.toLowerCase())})}),s},getTimePatternsForScoring:()=>{const t=e(),s=new Map;for(let r=0;r<24;r++)s.set(r,{genres:{},energy:.5});return t.userProfile.timePatterns.forEach(r=>{const o={low:.3,medium:.5,high:.75};s.set(r.hour,{genres:r.genres,energy:o[r.energy]||.5})}),t.listenHistory.slice(0,200).forEach(r=>{const o=new Date(r.timestamp).getHours(),i=s.get(o);if(r.genres)for(const a of r.genres){const l=a.toLowerCase();i.genres[l]=(i.genres[l]||0)+1}}),s},getPlayCounts:()=>{const t=e(),s=new Map;return t.listenHistory.forEach(r=>{s.set(r.trackId,(s.get(r.trackId)||0)+1)}),s}}),{name:"audiio-recommendations",partialize:n=>({listenHistory:n.listenHistory.slice(0,500),dislikedTracks:n.dislikedTracks,userProfile:n.userProfile,lastUpdated:n.lastUpdated})})),lM=12,XS=5;class cM{constructor(){Oc(this,"sections",new Map);Oc(this,"disabledSections",new Set)}register(e){this.sections.has(e.type)&&console.warn(`[SectionRegistry] Overwriting existing section: ${e.type}`),this.sections.set(e.type,e)}unregister(e){this.sections.delete(e),this.disabledSections.delete(e)}setEnabled(e,t){t?this.disabledSections.delete(e):this.disabledSections.add(e)}get(e){if(!this.disabledSections.has(e))return this.sections.get(e)}getAll(){return Array.from(this.sections.values())}getEnabled(){return Array.from(this.sections.values()).filter(e=>!this.disabledSections.has(e.type))}meetsRequirements(e,t){const{requirements:s}=e;return!(s.minListens!==void 0&&t.userProfile.totalListens<s.minListens||s.minLikedTracks!==void 0&&t.likedTracksCount<s.minLikedTracks||s.requiresLyrics&&!t.hasLyrics||s.requiresPlaylists&&!t.hasPlaylists||s.requiresHistory&&t.userProfile.totalListens<1||s.minTopArtists!==void 0&&t.topArtists.length<s.minTopArtists||s.minTopGenres!==void 0&&t.topGenres.length<s.minTopGenres||s.minPlaylistCount!==void 0&&t.playlistCount<s.minPlaylistCount||s.newUserOnly&&!t.isNewUser||s.returningUserOnly&&t.isNewUser)}meetsConstraints(e,t,s){var o;const{constraints:r}=e;if(r.maxPerPage!==void 0&&t.filter(a=>a.type===e.type).length>=r.maxPerPage)return!1;if(r.cooldownSections!==void 0&&t.length>0){const i=t.length-1;for(let a=i;a>=Math.max(0,i-r.cooldownSections);a--)if(((o=t[a])==null?void 0:o.type)===e.type)return!1}if(r.incompatibleWith){for(const i of r.incompatibleWith)if(s.has(i))return!1}return!(r.minSectionsBefore!==void 0&&t.length<r.minSectionsBefore)}calculateWeight(e,t){const{weights:s}=e;let r=s.base;return!t.isNewUser&&s.personalizedBoost&&(r+=s.personalizedBoost),t.isNewUser&&s.newUserBoost&&(r+=s.newUserBoost),s.timeRelevance&&(r+=s.timeRelevance(t.hour)),s.dayRelevance&&(r+=s.dayRelevance(t.dayOfWeek)),t.recentSections.includes(e.type)&&(r*=.5),r}createSectionConfig(e,t,s){var o;const r=((o=e.generateConfig)==null?void 0:o.call(e,t))??{};return{id:`${e.type}-${Date.now()}-${Math.random().toString(36).slice(2,7)}`,type:e.type,title:r.title??e.displayName,subtitle:r.subtitle,query:r.query,isPersonalized:!t.isNewUser&&(r.isPersonalized??!1),priority:s}}selectSections(e,t=lM){const s={...e,isNewUser:e.userProfile.totalListens<XS},o=this.getEnabled().filter(m=>this.meetsRequirements(m,s)).map(m=>({def:m,weight:this.calculateWeight(m,s)}));o.sort((m,g)=>{const y=(Math.random()-.5)*15;return g.weight+y-(m.weight+y)});const i=[],a=new Set;let l=0;const u=o.filter(m=>m.def.constraints.preferredPosition==="top"),d=o.filter(m=>m.def.constraints.preferredPosition==="bottom"),f=o.filter(m=>!m.def.constraints.preferredPosition||m.def.constraints.preferredPosition==="middle");for(const{def:m}of u){if(i.length>=t)break;this.meetsConstraints(m,i,a)&&(i.push(this.createSectionConfig(m,s,l++)),a.add(m.type))}for(const{def:m}of f){if(i.length>=t-d.length)break;this.meetsConstraints(m,i,a)&&(i.push(this.createSectionConfig(m,s,l++)),a.add(m.type))}for(const{def:m}of d){if(i.length>=t)break;this.meetsConstraints(m,i,a)&&(i.push(this.createSectionConfig(m,s,l++)),a.add(m.type))}return i}}const _t=new cM;function uM(n){const e=new Date;return{...n,hour:e.getHours(),dayOfWeek:e.getDay(),recentSections:n.recentSections??[],isNewUser:n.userProfile.totalListens<XS}}const Nu=({id:n,title:e,subtitle:t,isPersonalized:s,children:r,isLoading:o,error:i,className:a="",showHeader:l=!0,animationDelay:u=0,onSeeAll:d})=>i?null:p.jsxs("section",{id:n,className:`discover-section ${s?"personalized":""} ${a}`,style:{animationDelay:`${u}ms`},children:[l&&p.jsxs("div",{className:"discover-section-header",children:[p.jsxs("div",{className:"discover-section-title-row",children:[p.jsx("h2",{className:"discover-section-title",children:e}),t&&p.jsx("span",{className:"discover-section-subtitle",children:t}),s&&p.jsx("span",{className:"discover-section-personalized-tag",children:"For You"})]}),d&&p.jsx("button",{className:"discover-section-more",onClick:d,children:"See all"})]}),o?p.jsx("div",{className:"discover-section-loading",children:p.jsx("div",{className:"discover-loading-cards",children:[1,2,3,4].map(f=>p.jsx("div",{className:"track-card skeleton",style:{animationDelay:`${f*100}ms`}},f))})}):r]});function QS(n,e={}){const[t,s]=L.useState([]),[r,o]=L.useState(!0),[i,a]=L.useState(null),{limit:l=12,shuffle:u=!1}=e;return L.useEffect(()=>{if(!n){s([]),o(!1);return}let d=!0;return(async()=>{o(!0),a(null);try{if(window.api){let m=await window.api.search({query:n,type:"track"});u&&(m=[...m].sort(()=>Math.random()-.5)),d&&s(m.slice(0,l))}}catch(m){console.error("[Section] Track fetch failed:",m),d&&a(m instanceof Error?m.message:"Failed to load tracks")}finally{d&&o(!1)}})(),()=>{d=!1}},[n,l,u]),{tracks:t,isLoading:r,error:i}}const yt=Ps((n,e)=>({currentTrack:null,queue:[],queueIndex:-1,isPlaying:!1,position:0,duration:0,volume:1,isMuted:!1,isLoading:!1,error:null,shuffle:!1,repeat:"off",play:async t=>{n({isLoading:!0,error:null});try{if(window.api){const s=await window.api.playTrack(t),r={...t,streamInfo:s};n({currentTrack:r,isPlaying:!0,duration:t.duration*1e3,position:0,isLoading:!1});const{queue:o}=e(),i=o.findIndex(a=>a.id===t.id);i!==-1&&(n({queueIndex:i}),setTimeout(()=>{window.dispatchEvent(new CustomEvent("audiio:check-auto-queue"))},100))}else{n({currentTrack:t,isPlaying:!0,duration:t.duration*1e3,position:0,isLoading:!1});const{queue:s}=e(),r=s.findIndex(o=>o.id===t.id);r!==-1&&(n({queueIndex:r}),setTimeout(()=>{window.dispatchEvent(new CustomEvent("audiio:check-auto-queue"))},100))}}catch(s){n({error:s instanceof Error?s.message:"Playback failed",isLoading:!1})}},pause:()=>{n({isPlaying:!1}),window.api&&window.api.pause()},resume:()=>{const{currentTrack:t}=e();t&&(n({isPlaying:!0}),window.api&&window.api.resume())},stop:()=>{n({isPlaying:!1,position:0})},seek:t=>{n({position:t}),window.api&&window.api.seek(t)},next:async()=>{const{queue:t,queueIndex:s,play:r,shuffle:o,repeat:i}=e();if(i==="one"){const l=t[s];l&&await r(l);return}let a=s+1;if(o){const l=t.map((u,d)=>d).filter(u=>u!==s);l.length>0&&(a=l[Math.floor(Math.random()*l.length)])}if(a<t.length){const l=t[a];l&&await r(l)}else if(i==="all"&&t.length>0){const l=t[0];l&&await r(l)}setTimeout(()=>{window.dispatchEvent(new CustomEvent("audiio:check-auto-queue"))},100)},previous:async()=>{const{queue:t,queueIndex:s,position:r,play:o,seek:i}=e();if(r>3e3){i(0);return}if(s>0){const a=t[s-1];a&&await o(a)}},setVolume:t=>{n({volume:Math.max(0,Math.min(1,t)),isMuted:!1})},toggleMute:()=>{n(t=>({isMuted:!t.isMuted}))},setQueue:(t,s=0)=>{n({queue:t,queueIndex:s})},addToQueue:t=>{n(s=>({queue:[...s.queue,t]}))},setPosition:t=>{n({position:t})},setIsPlaying:t=>{n({isPlaying:t})},setStreamInfo:(t,s)=>{n(r=>{var o;return((o=r.currentTrack)==null?void 0:o.id)===t.id?{currentTrack:{...r.currentTrack,streamInfo:s}}:r})},clearError:()=>{n({error:null})},toggleShuffle:()=>{n(t=>({shuffle:!t.shuffle}))},cycleRepeat:()=>{n(t=>{const s=["off","all","one"],o=(s.indexOf(t.repeat)+1)%s.length;return{repeat:s[o]}})},reorderQueue:(t,s)=>{n(r=>{const o=r.queueIndex+1+t,i=r.queueIndex+1+s,a=[...r.queue],[l]=a.splice(o,1);return l&&a.splice(i,0,l),{queue:a}})}})),f2=n=>Symbol.iterator in n,p2=n=>"entries"in n,m2=(n,e)=>{const t=n instanceof Map?n:new Map(n.entries()),s=e instanceof Map?e:new Map(e.entries());if(t.size!==s.size)return!1;for(const[r,o]of t)if(!s.has(r)||!Object.is(o,s.get(r)))return!1;return!0},dM=(n,e)=>{const t=n[Symbol.iterator](),s=e[Symbol.iterator]();let r=t.next(),o=s.next();for(;!r.done&&!o.done;){if(!Object.is(r.value,o.value))return!1;r=t.next(),o=s.next()}return!!r.done&&!!o.done};function hM(n,e){return Object.is(n,e)?!0:typeof n!="object"||n===null||typeof e!="object"||e===null||Object.getPrototypeOf(n)!==Object.getPrototypeOf(e)?!1:f2(n)&&f2(e)?p2(n)&&p2(e)?m2(n,e):dM(n,e):m2({entries:()=>Object.entries(n)},{entries:()=>Object.entries(e)})}function YS(n){const e=Xt.useRef(void 0);return t=>{const s=n(t);return hM(e.current,s)?e.current:e.current=s}}const sf=["pop","rock","hip-hop","electronic","r&b","jazz","classical","other"],fM=18,pM=4,mM=fM+pM;function gM(n){const e=new Array(sf.length).fill(0);for(const t of n){const s=t.toLowerCase(),r=sf.findIndex(o=>o==="hip-hop"?s.includes("hip")||s.includes("rap"):o==="r&b"?s.includes("r&b")||s.includes("rnb")||s.includes("soul"):o==="electronic"?s.includes("electro")||s.includes("edm")||s.includes("house")||s.includes("techno")||s.includes("dance"):s.includes(o)||o.includes(s));r!==-1?e[r]=1:e[sf.length-1]=1}return e.every(t=>t===0)&&(e[sf.length-1]=1),e}function g2(n,e,t){return t===e?.5:Math.max(0,Math.min(1,(n-e)/(t-e)))}function xM(n){return n.length===0?.5:n.filter(t=>t.skipped).length/n.length}function yM(n){return n.length===0?.5:n.filter(t=>t.completed).length/n.length}function vM(n){if(n.length===0)return 0;const e=Math.max(...n.map(s=>s.timestamp)),t=(Date.now()-e)/(1e3*60*60);return Math.exp(-t/48)}function bM(n,e){let t=0;for(const s of n.artists){const r=s.id||s.name.toLowerCase().replace(/\s+/g,"-"),o=e.artistPreferences[r];if(o){const i=(o.score+100)/200;t=Math.max(t,i)}}return t}function wM(n,e,t,s){const r=gM(n.genres||[]),o=Ff(n),i=o.energy/100,a=o.valence/100,l=g2(n.duration,s.duration.min,s.duration.max),u=n.explicit?1:0,d=n.releaseDate?new Date(n.releaseDate).getFullYear():2020,f=g2(d,s.releaseYear.min,s.releaseYear.max),m=t.filter(N=>N.trackId===n.id),g=Math.log1p(m.length)/Math.log1p(100),y=xM(m),w=yM(m),b=vM(m),k=bM(n,e),v=[...r,i,a,l,u,f,g,y,w,b,k];return{raw:v,normalized:v}}function JS(n){const e=n??new Date().getHours(),t=new Date().getDay(),s=Math.sin(e*2*Math.PI/24),r=Math.cos(e*2*Math.PI/24),o=Math.sin(t*2*Math.PI/7),i=Math.cos(t*2*Math.PI/7);return[s,r,o,i]}function Lf(n,e,t,s,r){const o=wM(n,e,t,s),i=JS(r);return{trackFeatures:o.normalized,contextFeatures:i,combined:[...o.normalized,...i]}}function kM(n){if(n.length===0)return 1;const e=n.reduce((r,o)=>r+o,0)/n.length,s=n.map(r=>Math.pow(r-e,2)).reduce((r,o)=>r+o,0)/n.length;return Math.sqrt(s)||1}function x2(n){const e=n.map(r=>r.duration).filter(r=>r>0),t=n.map(r=>r.releaseDate?new Date(r.releaseDate).getFullYear():null).filter(r=>r!==null&&r>1900&&r<=new Date().getFullYear()+1),s=e.length>0?e.reduce((r,o)=>r+o,0)/e.length:18e4;return{duration:{min:Math.min(...e,3e4),max:Math.max(...e,6e5),mean:s,std:kM(e)},playCount:{min:0,max:100},releaseYear:{min:Math.min(...t,1950),max:Math.max(...t,new Date().getFullYear())}}}function Yx(){return{duration:{min:3e4,max:6e5,mean:18e4,std:6e4},playCount:{min:0,max:100},releaseYear:{min:1950,max:new Date().getFullYear()}}}const CM={not_my_taste:.95,dont_like_artist:.9,explicit_content:.85,heard_too_much:.4,bad_audio_quality:.3,wrong_mood:.35,too_long:.5,too_short:.5,other:.6};function SM(n){return n.completed?1:n.skipped?0:n.totalDuration>0?Math.min(1,n.duration/n.totalDuration):.5}function NM(n){if(n.length===0)return .1;let e=0,t=0;for(const r of n){const o=CM[r]||.6;e+=1,t+=o}const s=t/e;return Math.max(0,.2*(1-s))}function IM(n,e,t,s,r){const o=[],i=[];for(const a of e){const l=n.get(a.trackId);if(!l||r&&r[a.trackId])continue;const u=new Date(a.timestamp).getHours(),d=Lf(l,t,e,s,u);o.push(d.combined),i.push(SM(a))}if(r)for(const[a,l]of Object.entries(r)){let u=n.get(a);if(!u&&l.trackData&&(u={id:a,title:l.trackData.title,artists:l.trackData.artists.map(g=>({name:g,id:g})),genres:l.trackData.genres,duration:0,streamSources:[],_meta:{metadataProvider:"dislike-data",matchConfidence:1,externalIds:{},lastUpdated:new Date}}),!u)continue;const d=new Date(l.timestamp).getHours(),f=Lf(u,t,e,s,d),m=NM(l.reasons);o.push(f.combined),i.push(m),console.log(`[MLTraining] Added disliked track "${l.trackData.title}" with label ${m.toFixed(3)} (reasons: ${l.reasons.join(", ")})`)}return{inputs:o,labels:i}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $M=1e-7,TM=1e-4;class ZS{constructor(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}get(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}set(e,t){this.dataIdsCount++,this.data.set(e,t)}has(e){return this.data.has(e)}delete(e){return this.dataIdsCount--,this.data.delete(e)}numDataIds(){return this.dataIdsCount}}class Ny{refCount(e){return Ts("refCount")}incRef(e){return Ts("incRef")}timerAvailable(){return!0}time(e){return Ts("time")}read(e){return Ts("read")}readSync(e){return Ts("readSync")}readToGPU(e,t){return Ts("readToGPU")}numDataIds(){return Ts("numDataIds")}disposeData(e,t){return Ts("disposeData")}write(e,t,s){return Ts("write")}move(e,t,s,r,o){return Ts("move")}createTensorFromGPUData(e,t,s){return Ts("createTensorFromGPUData")}memory(){return Ts("memory")}floatPrecision(){return Ts("floatPrecision")}epsilon(){return this.floatPrecision()===32?$M:TM}dispose(){return Ts("dispose")}}function Ts(n){throw new Error(`'${n}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EM(n){let e=n.length,t=0;for(;e>0;)t=Math.random()*e|0,e--,sl(n,e,t)}function Ji(n,e,t){return Math.max(n,Math.min(e,t))}function Iy(n){return n%2===0?n:n+1}function sl(n,e,t){const s=n[e];n[e]=n[t],n[t]=s}function RM(n){let e=0;for(let t=0;t<n.length;t++)e+=n[t];return e}function _(n,e){if(!n)throw new Error(typeof e=="string"?e:e())}function $y(n,e,t=""){_(xt(n,e),()=>t+` Shapes ${n} and ${e} must match`)}function eN(n){_(n!=null,()=>"The input to the tensor constructor must be a non-null value.")}function pe(n){if(n.length===0)return 1;let e=n[0];for(let t=1;t<n.length;t++)e*=n[t];return e}function xt(n,e){if(n===e)return!0;if(n==null||e==null||n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function vl(n){return n%1===0}function D0(n){const e=Math.ceil(Math.sqrt(n));return[e,Math.ceil(n/e)]}function al(n,e){return e<=n.length?n:n+" ".repeat(e-n.length)}function y2(n,e=r=>0,t,s){return new Promise((r,o)=>{let i=0;const a=()=>{if(n()){r();return}i++;const l=e(i);if(t!=null&&i>=t){o();return}s!=null?s(a,l):setTimeout(a,l)};a()})}function tN(n,e){let t=1,s=-1;for(let o=0;o<n.length;++o)if(n[o]>=0)t*=n[o];else if(n[o]===-1){if(s!==-1)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${s} and dim ${o}`);s=o}else if(n[o]<0)throw Error(`Shapes can not be < 0. Found ${n[o]} at dim ${o}`);if(s===-1){if(e>0&&e!==t)throw Error(`Size(${e}) must match the product of shape ${n}`);return n}if(t===0)throw Error(`Cannot infer the missing size in [${n}] when there are 0 elements`);if(e%t!==0)throw Error(`The implicit shape can't be a fractional number. Got ${e} / ${t}`);const r=n.slice();return r[s]=e/t,r}function rt(n,e){const t=e.length;return n=n==null?e.map((s,r)=>r):[].concat(n),_(n.every(s=>s>=-t&&s<t),()=>`All values in axis param must be in range [-${t}, ${t}) but got axis ${n}`),_(n.every(s=>vl(s)),()=>`All values in axis param must be integers but got axis ${n}`),n.map(s=>s<0?t+s:s)}function fi(n,e){const t=[],s=[],r=e!=null&&Array.isArray(e)&&e.length===0,o=e==null||r?null:rt(e,n).sort();let i=0;for(let a=0;a<n.length;++a){if(o!=null){if(o[i]===a&&n[a]!==1)throw new Error(`Can't squeeze axis ${a} since its dim '${n[a]}' is not 1`);(o[i]==null||o[i]>a)&&n[a]===1&&(t.push(n[a]),s.push(a)),o[i]<=a&&i++}n[a]!==1&&(t.push(n[a]),s.push(a))}return{newShape:t,keptDims:s}}function _n(n,e){return Qt(n,e)}function Qt(n,e){let t=null;if(n==null||n==="float32")t=new Float32Array(e);else if(n==="int32")t=new Int32Array(e);else if(n==="bool")t=new Uint8Array(e);else if(n==="string")t=new Array(e);else throw new Error(`Unknown data type ${n}`);return t}function AM(n,e){for(let t=0;t<n.length;t++){const s=n[t];if(isNaN(s)||!isFinite(s))throw Error(`A tensor of type ${e} being uploaded contains ${s}.`)}}function DM(n){return n==="bool"||n==="complex64"||n==="float32"||n==="int32"||n==="string"}function nN(n,e){return!(e==="complex64"||e==="float32"&&n!=="complex64"||e==="int32"&&n!=="float32"&&n!=="complex64"||e==="bool"&&n==="bool")}function jf(n){if(n==="float32"||n==="int32")return 4;if(n==="complex64")return 8;if(n==="bool")return 1;throw new Error(`Unknown dtype ${n}`)}function MM(n){if(n==null)return 0;let e=0;return n.forEach(t=>e+=t.length),e}function Iu(n){return typeof n=="string"||n instanceof String}function PM(n){return typeof n=="boolean"}function M0(n){return typeof n=="number"}function Pl(n){return Array.isArray(n)?Pl(n[0]):n instanceof Float32Array?"float32":n instanceof Int32Array||n instanceof Uint8Array||n instanceof Uint8ClampedArray?"int32":M0(n)?"float32":Iu(n)?"string":PM(n)?"bool":"float32"}function P0(n){return!!(n&&n.constructor&&n.call&&n.apply)}function F0(n,e){for(let t=e;t<n;++t)if(n%t===0)return t;return n}function Ve(n){const e=n.length;if(e<2)return[];const t=new Array(e-1);t[e-2]=n[e-1];for(let s=e-3;s>=0;--s)t[s]=t[s+1]*n[s+1];return t}function sN(n,e,t,s=!1){const r=new Array;if(e.length===1){const o=e[0]*(s?2:1);for(let i=0;i<o;i++)r[i]=t[n+i]}else{const o=e[0],i=e.slice(1),a=i.reduce((l,u)=>l*u)*(s?2:1);for(let l=0;l<o;l++)r[l]=sN(n+l*a,i,t,s)}return r}function Tr(n,e,t=!1){if(n.length===0)return e[0];const s=n.reduce((r,o)=>r*o)*(t?2:1);if(s===0)return[];if(s!==e.length)throw new Error(`[${n}] does not match the input size ${e.length}${t?" for a complex tensor":""}.`);return sN(0,n,e,t)}function FM(n,e){if(Array.isArray(n))return n;if(e==="float32")return n instanceof Float32Array?n:new Float32Array(n);if(e==="int32")return n instanceof Int32Array?n:new Int32Array(n);if(e==="bool"||e==="string")return Uint8Array.from(new Int32Array(n));throw new Error(`Unknown dtype ${e}`)}function Ty(n,e){const t=zn(n,e);for(let s=0;s<t.length;s++)t[s]=1;return t}function zn(n,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool")return new Uint8Array(n);throw new Error(`Unknown data type ${e}`)}function rN(n,e){const t=n.reduce((s,r)=>s*r,1);if(e==null||e==="float32")return Tr(n,new Float32Array(t));if(e==="int32")return Tr(n,new Int32Array(t));if(e==="bool")return Tr(n,new Uint8Array(t));throw new Error(`Unknown data type ${e}`)}function Io(n){n.forEach(e=>{_(Number.isInteger(e)&&e>=0,()=>`Tensor must have a shape comprised of positive integers but got shape [${n}].`)})}function qr(n,e,t){if(e===0)return 0;if(e===1)return n[0];let s=n[n.length-1];for(let r=0;r<n.length-1;++r)s+=t[r]*n[r];return s}function Fl(n,e,t){if(e===0)return[];if(e===1)return[n];const s=new Array(e);for(let r=0;r<s.length-1;++r)s[r]=Math.floor(n/t[r]),n-=s[r]*t[r];return s[s.length-1]=n,s}function Ey(n){return n&&n.then&&typeof n.then=="function"}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const v2="tfjsflags";class LM{constructor(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=jM,this.populateURLFlags()}setPlatform(e,t){this.platform!=null&&(de().getBool("IS_TEST")||de().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${e}.`)),this.platformName=e,this.platform=t}registerFlag(e,t,s){if(this.flagRegistry[e]={evaluationFn:t,setHook:s},this.urlFlags[e]!=null){const r=this.urlFlags[e];de().getBool("IS_TEST")||de().getBool("PROD")||console.warn(`Setting feature override from URL ${e}: ${r}.`),this.set(e,r)}}async getAsync(e){return e in this.flags?this.flags[e]:(this.flags[e]=await this.evaluateFlag(e),this.flags[e])}get(e){if(e in this.flags)return this.flags[e];const t=this.evaluateFlag(e);if(Ey(t))throw new Error(`Flag ${e} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[e]=t,this.flags[e]}getNumber(e){return this.get(e)}getBool(e){return this.get(e)}getString(e){return this.get(e)}getFlags(){return this.flags}get features(){return this.flags}set(e,t){if(this.flagRegistry[e]==null)throw new Error(`Cannot set flag ${e} as it has not been registered.`);this.flags[e]=t,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(t)}evaluateFlag(e){if(this.flagRegistry[e]==null)throw new Error(`Cannot evaluate flag '${e}': no evaluation function found.`);return this.flagRegistry[e].evaluationFn()}setFlags(e){this.flags=Object.assign({},e)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")return;const e=this.getQueryParams(this.global.location.search);v2 in e&&e[v2].split(",").forEach(s=>{const[r,o]=s.split(":");this.urlFlags[r]=_M(r,o)})}}function jM(n){const e={};return n.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(t,...s)=>(OM(e,s[0],s[1]),s.join("="))),e}function OM(n,e,t){n[decodeURIComponent(e)]=decodeURIComponent(t||"")}function _M(n,e){const t=e.toLowerCase();return t==="true"||t==="false"?t==="true":`${+t}`===t?+t:e}function de(){return oN}let oN=null;function zM(n){oN=n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let Jx;function iN(){if(Jx==null){let n;if(typeof window<"u")n=window;else if(typeof global<"u")n=global;else if(typeof process<"u")n=process;else if(typeof self<"u")n=self;else throw new Error("Could not find a global object");Jx=n}return Jx}function BM(){const n=iN();return n._tfGlobals==null&&(n._tfGlobals=new Map),n._tfGlobals}function Ry(n,e){const t=BM();if(t.has(n))return t.get(n);{const s=e();return t.set(n,s),t.get(n)}}const Cp="Abs",$u="Acos",Tu="Acosh",Ll="Add",Ay="AddN",Dy="All",My="Any",Sp="ArgMax",Np="ArgMin",Eu="Asin",Ru="Asinh",Au="Atan",Du="Atanh",Mu="Atan2",Ip="AvgPool",Py="AvgPoolGrad",$p="AvgPool3D",Fy="AvgPool3DGrad",Tp="BatchMatMul",Ep="BatchToSpaceND",Ly="Bincount",jy="BitwiseAnd",VM="BroadcastTo",aN="BroadcastArgs",Pu="Cast",Fu="Ceil",Lu="ClipByValue",Oy="Complex",Rp="ComplexAbs",Ap="Concat",Dp="Conv2D",_y="Conv2DBackpropFilter",Mp="Conv2DBackpropInput",Pp="Conv3D",zy="Conv3DBackpropFilterV2",By="Conv3DBackpropInputV2",ju="Cos",Ou="Cosh",Vy="Cumprod",Fp="Cumsum",Wy="CropAndResize",Uy="DenseBincount",Gy="DepthToSpace",Lp="DepthwiseConv2dNative",Hy="DepthwiseConv2dNativeBackpropFilter",qy="DepthwiseConv2dNativeBackpropInput",lN="Diag",jp="Dilation2D",L0="Dilation2DBackpropInput",j0="Dilation2DBackpropFilter",WM="Draw",_u="RealDiv",Ky="Einsum",zu="Elu",Xy="EluGrad",Bu="Erf",Op="Equal",Vu="Exp",_p="ExpandDims",Wu="Expm1",Qy="FFT",Yy="Fill",Jy="FlipLeftRight",Uu="Floor",Gu="FloorDiv",zp="FusedBatchNorm",Bp="GatherV2",cN="GatherNd",Vp="Greater",Hu="GreaterEqual",qu="Identity",Zy="IFFT",e1="Imag",Ku="IsFinite",Xu="IsInf",Qu="IsNan",Wp="LeakyRelu",Up="Less",Gp="LessEqual",uN="LinSpace",Yu="Log",Ju="Log1p",Hp="LogicalAnd",qp="LogicalNot",Kp="LogicalOr",UM="LogSoftmax",Xp="LRN",t1="LRNGrad",Qp="Max",Zu="Maximum",Yp="MaxPool",n1="MaxPoolGrad",Jp="MaxPool3D",s1="MaxPool3DGrad",dN="MaxPoolWithArgmax",Zp="Mean",em="Min",ed="Minimum",tm="MirrorPad",td="Mod",hN="Multinomial",nd="Multiply",nm="Neg",sm="NotEqual",r1="NonMaxSuppressionV3",o1="NonMaxSuppressionV4",i1="NonMaxSuppressionV5",rm="OnesLike",om="OneHot",im="Pack",am="PadV2",sd="Pow",lm="Prelu",cm="Prod",fN="RaggedGather",pN="RaggedRange",mN="RaggedTensorToTensor",a1="Range",l1="Real",rd="Reciprocal",od="Relu",um="Reshape",dm="ResizeNearestNeighbor",c1="ResizeNearestNeighborGrad",hm="ResizeBilinear",u1="ResizeBilinearGrad",id="Relu6",fm="Reverse",ad="Round",ld="Rsqrt",gN="ScatterNd",xN="TensorScatterUpdate",yN="SearchSorted",pm="Select",cd="Selu",mm="Slice",ud="Sin",dd="Sinh",hd="Sign",fd="Sigmoid",pd="Softplus",md="Sqrt",gm="Sum",xm="SpaceToBatchND",ym="SplitV",vm="Softmax",vN="SparseFillEmptyRows",bN="SparseReshape",wN="SparseSegmentMean",kN="SparseSegmentSum",CN="SparseToDense",gd="SquaredDifference",d1="Square",h1="StaticRegexReplace",f1="StridedSlice",SN="StringNGrams",NN="StringSplit",IN="StringToHashBucketFast",xd="Sub",yd="Tan",vd="Tanh",bd="Tile",p1="TopK",m1="Transform",ll="Transpose",g1="Unique",bm="Unpack",wm="UnsortedSegmentSum",km="ZerosLike",wd="Step",GM="FromPixels",x1="RotateWithOffset",Of="_FusedMatMul",_f="FusedConv2D",$N="FusedDepthwiseConv2D";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bs(...n){de().getBool("IS_TEST")||de().getBool("PROD")||console.warn(...n)}function HM(...n){de().getBool("IS_TEST")||de().getBool("PROD")||console.log(...n)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zf=Ry("kernelRegistry",()=>new Map),O0=Ry("gradRegistry",()=>new Map);function b2(n,e){const t=EN(n,e);return zf.get(t)}function w2(n){return O0.get(n)}function k2(n){const e=zf.entries(),t=[];for(;;){const{done:s,value:r}=e.next();if(s)break;const[o,i]=r,[a]=o.split("_");a===n&&t.push(i)}return t}function TN(n){const{kernelName:e,backendName:t}=n,s=EN(e,t);zf.has(s)&&Bs(`The kernel '${e}' for backend '${t}' is already registered`),zf.set(s,n)}function qM(n){const{kernelName:e}=n;O0.has(e)&&de().getBool("DEBUG")&&Bs(`Overriding the gradient for '${e}'`),O0.set(e,n)}function EN(n,e){return`${e}_${n}`}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RN(n){return n instanceof Float32Array||n instanceof Int32Array||n instanceof Uint8Array||n instanceof Uint8ClampedArray}var Zx,C2;function KM(){if(C2)return Zx;C2=1,Zx=e;var n=null;try{n=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function e(D,E,j){this.low=D|0,this.high=E|0,this.unsigned=!!j}e.prototype.__isLong__,Object.defineProperty(e.prototype,"__isLong__",{value:!0});function t(D){return(D&&D.__isLong__)===!0}e.isLong=t;var s={},r={};function o(D,E){var j,V,W;return E?(D>>>=0,(W=0<=D&&D<256)&&(V=r[D],V)?V:(j=a(D,(D|0)<0?-1:0,!0),W&&(r[D]=j),j)):(D|=0,(W=-128<=D&&D<128)&&(V=s[D],V)?V:(j=a(D,D<0?-1:0,!1),W&&(s[D]=j),j))}e.fromInt=o;function i(D,E){if(isNaN(D))return E?v:k;if(E){if(D<0)return v;if(D>=y)return M}else{if(D<=-w)return A;if(D+1>=w)return R}return D<0?i(-D,E).neg():a(D%g|0,D/g|0,E)}e.fromNumber=i;function a(D,E,j){return new e(D,E,j)}e.fromBits=a;var l=Math.pow;function u(D,E,j){if(D.length===0)throw Error("empty string");if(D==="NaN"||D==="Infinity"||D==="+Infinity"||D==="-Infinity")return k;if(typeof E=="number"?(j=E,E=!1):E=!!E,j=j||10,j<2||36<j)throw RangeError("radix");var V;if((V=D.indexOf("-"))>0)throw Error("interior hyphen");if(V===0)return u(D.substring(1),E,j).neg();for(var W=i(l(j,8)),U=k,X=0;X<D.length;X+=8){var ee=Math.min(8,D.length-X),G=parseInt(D.substring(X,X+ee),j);if(ee<8){var z=i(l(j,ee));U=U.mul(z).add(i(G))}else U=U.mul(W),U=U.add(i(G))}return U.unsigned=E,U}e.fromString=u;function d(D,E){return typeof D=="number"?i(D,E):typeof D=="string"?u(D,E):a(D.low,D.high,typeof E=="boolean"?E:D.unsigned)}e.fromValue=d;var f=65536,m=1<<24,g=f*f,y=g*g,w=y/2,b=o(m),k=o(0);e.ZERO=k;var v=o(0,!0);e.UZERO=v;var N=o(1);e.ONE=N;var S=o(1,!0);e.UONE=S;var $=o(-1);e.NEG_ONE=$;var R=a(-1,2147483647,!1);e.MAX_VALUE=R;var M=a(-1,-1,!0);e.MAX_UNSIGNED_VALUE=M;var A=a(0,-2147483648,!1);e.MIN_VALUE=A;var P=e.prototype;return P.toInt=function(){return this.unsigned?this.low>>>0:this.low},P.toNumber=function(){return this.unsigned?(this.high>>>0)*g+(this.low>>>0):this.high*g+(this.low>>>0)},P.toString=function(E){if(E=E||10,E<2||36<E)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(A)){var j=i(E),V=this.div(j),W=V.mul(j).sub(this);return V.toString(E)+W.toInt().toString(E)}else return"-"+this.neg().toString(E);for(var U=i(l(E,6),this.unsigned),X=this,ee="";;){var G=X.div(U),z=X.sub(G.mul(U)).toInt()>>>0,H=z.toString(E);if(X=G,X.isZero())return H+ee;for(;H.length<6;)H="0"+H;ee=""+H+ee}},P.getHighBits=function(){return this.high},P.getHighBitsUnsigned=function(){return this.high>>>0},P.getLowBits=function(){return this.low},P.getLowBitsUnsigned=function(){return this.low>>>0},P.getNumBitsAbs=function(){if(this.isNegative())return this.eq(A)?64:this.neg().getNumBitsAbs();for(var E=this.high!=0?this.high:this.low,j=31;j>0&&(E&1<<j)==0;j--);return this.high!=0?j+33:j+1},P.isZero=function(){return this.high===0&&this.low===0},P.eqz=P.isZero,P.isNegative=function(){return!this.unsigned&&this.high<0},P.isPositive=function(){return this.unsigned||this.high>=0},P.isOdd=function(){return(this.low&1)===1},P.isEven=function(){return(this.low&1)===0},P.equals=function(E){return t(E)||(E=d(E)),this.unsigned!==E.unsigned&&this.high>>>31===1&&E.high>>>31===1?!1:this.high===E.high&&this.low===E.low},P.eq=P.equals,P.notEquals=function(E){return!this.eq(E)},P.neq=P.notEquals,P.ne=P.notEquals,P.lessThan=function(E){return this.comp(E)<0},P.lt=P.lessThan,P.lessThanOrEqual=function(E){return this.comp(E)<=0},P.lte=P.lessThanOrEqual,P.le=P.lessThanOrEqual,P.greaterThan=function(E){return this.comp(E)>0},P.gt=P.greaterThan,P.greaterThanOrEqual=function(E){return this.comp(E)>=0},P.gte=P.greaterThanOrEqual,P.ge=P.greaterThanOrEqual,P.compare=function(E){if(t(E)||(E=d(E)),this.eq(E))return 0;var j=this.isNegative(),V=E.isNegative();return j&&!V?-1:!j&&V?1:this.unsigned?E.high>>>0>this.high>>>0||E.high===this.high&&E.low>>>0>this.low>>>0?-1:1:this.sub(E).isNegative()?-1:1},P.comp=P.compare,P.negate=function(){return!this.unsigned&&this.eq(A)?A:this.not().add(N)},P.neg=P.negate,P.add=function(E){t(E)||(E=d(E));var j=this.high>>>16,V=this.high&65535,W=this.low>>>16,U=this.low&65535,X=E.high>>>16,ee=E.high&65535,G=E.low>>>16,z=E.low&65535,H=0,O=0,B=0,Y=0;return Y+=U+z,B+=Y>>>16,Y&=65535,B+=W+G,O+=B>>>16,B&=65535,O+=V+ee,H+=O>>>16,O&=65535,H+=j+X,H&=65535,a(B<<16|Y,H<<16|O,this.unsigned)},P.subtract=function(E){return t(E)||(E=d(E)),this.add(E.neg())},P.sub=P.subtract,P.multiply=function(E){if(this.isZero())return k;if(t(E)||(E=d(E)),n){var j=n.mul(this.low,this.high,E.low,E.high);return a(j,n.get_high(),this.unsigned)}if(E.isZero())return k;if(this.eq(A))return E.isOdd()?A:k;if(E.eq(A))return this.isOdd()?A:k;if(this.isNegative())return E.isNegative()?this.neg().mul(E.neg()):this.neg().mul(E).neg();if(E.isNegative())return this.mul(E.neg()).neg();if(this.lt(b)&&E.lt(b))return i(this.toNumber()*E.toNumber(),this.unsigned);var V=this.high>>>16,W=this.high&65535,U=this.low>>>16,X=this.low&65535,ee=E.high>>>16,G=E.high&65535,z=E.low>>>16,H=E.low&65535,O=0,B=0,Y=0,oe=0;return oe+=X*H,Y+=oe>>>16,oe&=65535,Y+=U*H,B+=Y>>>16,Y&=65535,Y+=X*z,B+=Y>>>16,Y&=65535,B+=W*H,O+=B>>>16,B&=65535,B+=U*z,O+=B>>>16,B&=65535,B+=X*G,O+=B>>>16,B&=65535,O+=V*H+W*z+U*G+X*ee,O&=65535,a(Y<<16|oe,O<<16|B,this.unsigned)},P.mul=P.multiply,P.divide=function(E){if(t(E)||(E=d(E)),E.isZero())throw Error("division by zero");if(n){if(!this.unsigned&&this.high===-2147483648&&E.low===-1&&E.high===-1)return this;var j=(this.unsigned?n.div_u:n.div_s)(this.low,this.high,E.low,E.high);return a(j,n.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?v:k;var V,W,U;if(this.unsigned){if(E.unsigned||(E=E.toUnsigned()),E.gt(this))return v;if(E.gt(this.shru(1)))return S;U=v}else{if(this.eq(A)){if(E.eq(N)||E.eq($))return A;if(E.eq(A))return N;var X=this.shr(1);return V=X.div(E).shl(1),V.eq(k)?E.isNegative()?N:$:(W=this.sub(E.mul(V)),U=V.add(W.div(E)),U)}else if(E.eq(A))return this.unsigned?v:k;if(this.isNegative())return E.isNegative()?this.neg().div(E.neg()):this.neg().div(E).neg();if(E.isNegative())return this.div(E.neg()).neg();U=k}for(W=this;W.gte(E);){V=Math.max(1,Math.floor(W.toNumber()/E.toNumber()));for(var ee=Math.ceil(Math.log(V)/Math.LN2),G=ee<=48?1:l(2,ee-48),z=i(V),H=z.mul(E);H.isNegative()||H.gt(W);)V-=G,z=i(V,this.unsigned),H=z.mul(E);z.isZero()&&(z=N),U=U.add(z),W=W.sub(H)}return U},P.div=P.divide,P.modulo=function(E){if(t(E)||(E=d(E)),n){var j=(this.unsigned?n.rem_u:n.rem_s)(this.low,this.high,E.low,E.high);return a(j,n.get_high(),this.unsigned)}return this.sub(this.div(E).mul(E))},P.mod=P.modulo,P.rem=P.modulo,P.not=function(){return a(~this.low,~this.high,this.unsigned)},P.and=function(E){return t(E)||(E=d(E)),a(this.low&E.low,this.high&E.high,this.unsigned)},P.or=function(E){return t(E)||(E=d(E)),a(this.low|E.low,this.high|E.high,this.unsigned)},P.xor=function(E){return t(E)||(E=d(E)),a(this.low^E.low,this.high^E.high,this.unsigned)},P.shiftLeft=function(E){return t(E)&&(E=E.toInt()),(E&=63)===0?this:E<32?a(this.low<<E,this.high<<E|this.low>>>32-E,this.unsigned):a(0,this.low<<E-32,this.unsigned)},P.shl=P.shiftLeft,P.shiftRight=function(E){return t(E)&&(E=E.toInt()),(E&=63)===0?this:E<32?a(this.low>>>E|this.high<<32-E,this.high>>E,this.unsigned):a(this.high>>E-32,this.high>=0?0:-1,this.unsigned)},P.shr=P.shiftRight,P.shiftRightUnsigned=function(E){if(t(E)&&(E=E.toInt()),E&=63,E===0)return this;var j=this.high;if(E<32){var V=this.low;return a(V>>>E|j<<32-E,j>>>E,this.unsigned)}else return E===32?a(j,0,this.unsigned):a(j>>>E-32,0,this.unsigned)},P.shru=P.shiftRightUnsigned,P.shr_u=P.shiftRightUnsigned,P.toSigned=function(){return this.unsigned?a(this.low,this.high,!1):this},P.toUnsigned=function(){return this.unsigned?this:a(this.low,this.high,!0)},P.toBytes=function(E){return E?this.toBytesLE():this.toBytesBE()},P.toBytesLE=function(){var E=this.high,j=this.low;return[j&255,j>>>8&255,j>>>16&255,j>>>24,E&255,E>>>8&255,E>>>16&255,E>>>24]},P.toBytesBE=function(){var E=this.high,j=this.low;return[E>>>24,E>>>16&255,E>>>8&255,E&255,j>>>24,j>>>16&255,j>>>8&255,j&255]},e.fromBytes=function(E,j,V){return V?e.fromBytesLE(E,j):e.fromBytesBE(E,j)},e.fromBytesLE=function(E,j){return new e(E[0]|E[1]<<8|E[2]<<16|E[3]<<24,E[4]|E[5]<<8|E[6]<<16|E[7]<<24,j)},e.fromBytesBE=function(E,j){return new e(E[4]<<24|E[5]<<16|E[6]<<8|E[7],E[0]<<24|E[1]<<16|E[2]<<8|E[3],j)},Zx}var AN=KM();const DN=by(AN),XM=m4({__proto__:null,default:DN},[AN]);/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vi=DN||XM;function Cm(n){return Vi.fromString(n,!0,16)}const MN=Cm("c3a5c85c97cb3127"),Bi=Cm("b492b66fbe98f273"),ts=Cm("9ae16a3b2f90404f");function _0(n){return n.xor(n.shru(47))}function PN(n,e,t){const s=n.slice(e,e+t);return Vi.fromBytes(Array.from(s),!0,!0)}function It(n,e){return PN(n,e,8)}function S2(n,e){return PN(n,e,4)}function wn(n,e){return e===0?n:n.shru(e).or(n.shl(64-e))}function si(n,e,t=Cm("9ddfea08eb382d69")){let s=n.xor(e).mul(t);s=s.xor(s.shru(47));let r=e.xor(s).mul(t);return r=r.xor(r.shru(47)),r=r.mul(t),r}function QM(n,e,t,s,r,o){r=r.add(n),o=wn(o.add(r).add(s),21);const i=r;return r=r.add(e),r=r.add(t),o=o.add(wn(r,44)),[r.add(s),o.add(i)]}function rf(n,e,t,s){return QM(It(n,e),It(n,e+8),It(n,e+16),It(n,e+24),t,s)}function YM(n,e=n.length){if(e>=8){const t=ts.add(e*2),s=It(n,0).add(ts),r=It(n,e-8),o=wn(r,37).mul(t).add(s),i=wn(s,25).add(r).mul(t);return si(o,i,t)}if(e>=4){const t=ts.add(e*2),s=S2(n,0);return si(s.shl(3).add(e),S2(n,e-4),t)}if(e>0){const t=n[0],s=n[e>>1],r=n[e-1],o=t+(s<<8),i=e+(r<<2);return _0(ts.mul(o).xor(MN.mul(i))).mul(ts)}return ts}function JM(n,e=n.length){const t=ts.add(e*2),s=It(n,0).mul(Bi),r=It(n,8),o=It(n,e-8).mul(t),i=It(n,e-16).mul(ts);return si(wn(s.add(r),43).add(wn(o,30)).add(i),s.add(wn(r.add(ts),18)).add(o),t)}function ZM(n,e=n.length){const t=ts.add(e*2),s=It(n,0).mul(ts),r=It(n,8),o=It(n,e-8).mul(t),i=It(n,e-16).mul(ts),a=wn(s.add(r),43).add(wn(o,30)).add(i),l=si(a,s.add(wn(r.add(ts),18)).add(o),t),u=It(n,16).mul(t),d=It(n,24),f=a.add(It(n,e-32)).mul(t),m=l.add(It(n,e-24)).mul(t);return si(wn(u.add(d),43).add(wn(f,30)).add(m),u.add(wn(d.add(s),18)).add(f),t)}function eP(n,e=n.length){const t=Vi.fromNumber(81,!0);if(e<=32)return e<=16?YM(n,e):JM(n,e);if(e<=64)return ZM(n,e);let s=t,r=t.mul(Bi).add(113),o=_0(r.mul(ts).add(113)).mul(ts),i=[Vi.UZERO,Vi.UZERO],a=[Vi.UZERO,Vi.UZERO];s=s.mul(ts).add(It(n,0));let l=0;const u=(e-1>>6)*64,d=u+(e-1&63)-63;do s=wn(s.add(r).add(i[0]).add(It(n,l+8)),37).mul(Bi),r=wn(r.add(i[1]).add(It(n,l+48)),42).mul(Bi),s=s.xor(a[1]),r=r.add(i[0]).add(It(n,l+40)),o=wn(o.add(a[0]),33).mul(Bi),i=rf(n,l,i[1].mul(Bi),s.add(a[0])),a=rf(n,l+32,o.add(a[1]),r.add(It(n,l+16))),[o,s]=[s,o],l+=64;while(l!==u);const f=Bi.add(o.and(255).shl(1));return l=d,a[0]=a[0].add(e-1&63),i[0]=i[0].add(a[0]),a[0]=a[0].add(i[0]),s=wn(s.add(r).add(i[0]).add(It(n,l+8)),37).mul(f),r=wn(r.add(i[1]).add(It(n,l+48)),42).mul(f),s=s.xor(a[1].mul(9)),r=r.add(i[0].mul(9).add(It(n,l+40))),o=wn(o.add(a[0]),33).mul(f),i=rf(n,l,i[1].mul(f),s.add(a[0])),a=rf(n,l+32,o.add(a[1]),r.add(It(n,l+16))),[o,s]=[s,o],si(si(i[0],a[0],f).add(_0(r).mul(MN)).add(o),si(i[1],a[1],f).add(s),f)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pi(n,e){return e==="string"?ri(n):ga([n],e)}function tP(n,e){return n instanceof Float32Array&&e==="float32"||n instanceof Int32Array&&e==="int32"||n instanceof Uint8Array&&e==="bool"}function ga(n,e){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(n)&&(n=Zi(n)),de().getBool("DEBUG")&&AM(n,e),tP(n,e))return n;if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool"){const t=new Uint8Array(n.length);for(let s=0;s<t.length;++s)Math.round(n[s])!==0&&(t[s]=1);return t}else throw new Error(`Unknown data type ${e}`)}function ds(){return de().platform.now()}function ri(n,e="utf-8"){return e=e||"utf-8",de().platform.encode(n,e)}function ai(n,e="utf-8"){return e=e||"utf-8",de().platform.decode(n,e)}function lr(n){return de().platform.isTypedArray!=null?de().platform.isTypedArray(n):RN(n)}function Zi(n,e=[],t=!1){if(e==null&&(e=[]),typeof n=="boolean"||typeof n=="number"||typeof n=="string"||Ey(n)||n==null||lr(n)&&t)e.push(n);else if(Array.isArray(n)||lr(n))for(let s=0;s<n.length;++s)Zi(n[s],e,t);else{let s=-1;for(const r of Object.keys(n))/^([1-9]+[0-9]*|0)$/.test(r)&&(s=Math.max(s,Number(r)));for(let r=0;r<=s;r++)Zi(n[r],e,t)}return e}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class nP{constructor(e,t){this.backendTimer=e,this.logger=t,t==null&&(this.logger=new rP)}profileKernel(e,t,s){let r;const o=()=>{r=s()};let i;const a=ds();if(this.backendTimer.timerAvailable())i=this.backendTimer.time(o);else{o();for(const u of r)u.dataSync();i=Promise.resolve({kernelMs:ds()-a})}if(de().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let u=0;u<r.length;u++){const d=r[u];d.data().then(f=>{sP(f,d.dtype,e)})}return{kernelName:e,outputs:r,inputs:t,timeMs:i.then(u=>u.kernelMs),extraInfo:i.then(u=>u.getExtraProfileInfo!=null?u.getExtraProfileInfo():"")}}logKernelProfile(e){const{kernelName:t,outputs:s,timeMs:r,inputs:o,extraInfo:i}=e;s.forEach(a=>{Promise.all([a.data(),r,i]).then(l=>{this.logger.logKernelProfile(t,a,l[0],l[1],o,l[2])})})}}function sP(n,e,t){if(e!=="float32")return!1;for(let s=0;s<n.length;s++){const r=n[s];if(isNaN(r)||!isFinite(r))return console.warn(`Found ${r} in the result of '${t}'`),!0}return!1}class rP{logKernelProfile(e,t,s,r,o,i){const a=typeof r=="number"?al(`${r}ms`,9):r.error,l=al(e,25),u=t.rank,d=t.size,f=al(t.shape.toString(),14);let m="";for(const g in o){const y=o[g];if(y!=null){const w=y.shape||t.shape,b=w.length;m+=`${g}: ${b}D ${b>0?w:""} `}}console.log(`%c${l}	%c${a}	%c${u}D ${f}	%c${d}	%c${m}	%c${i}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oP(n,e,t){const s={},r={};for(let l=0;l<e.length;l++)s[e[l].id]=!0;for(let l=0;l<n.length;l++){const u=n[l],d=u.inputs;for(const f in d){const m=d[f];let g=!1;for(let y=0;y<e.length;y++)if(s[m.id]){u.outputs.forEach(w=>s[w.id]=!0),g=!0,r[u.id]=!0;break}if(g)break}}const o={};o[t.id]=!0;const i={};for(let l=n.length-1;l>=0;l--){const u=n[l],d=u.inputs;for(let f=0;f<u.outputs.length;f++)if(o[u.outputs[f].id]){for(const m in d)o[d[m].id]=!0,i[u.id]=!0;break}}const a=[];for(let l=0;l<n.length;l++){const u=n[l];if(r[u.id]&&i[u.id]){const d={};for(const m in u.inputs){const g=u.inputs[m];s[g.id]&&(d[m]=g)}const f=Object.assign({},u);f.inputs=d,f.outputs=u.outputs,a.push(f)}}return a}function iP(n,e,t,s){for(let r=e.length-1;r>=0;r--){const o=e[r],i=[];if(o.outputs.forEach(l=>{const u=n[l.id];u!=null?i.push(u):i.push(null)}),o.gradient==null)throw new Error(`Cannot compute gradient: gradient function not found for ${o.kernelName}.`);const a=o.gradient(i);for(const l in o.inputs){if(!(l in a))throw new Error(`Cannot backprop through input ${l}. Available gradients found: ${Object.keys(a)}.`);const u=t(()=>a[l]());if(u.dtype!=="float32")throw new Error(`Error in gradient for op ${o.kernelName}. The gradient of input ${l} must have 'float32' dtype, but has '${u.dtype}'`);const d=o.inputs[l];if(!xt(u.shape,d.shape))throw new Error(`Error in gradient for op ${o.kernelName}. The gradient of input '${l}' has shape '${u.shape}', which does not match the shape of the input '${d.shape}'`);if(n[d.id]==null)n[d.id]=u;else{const f=n[d.id];n[d.id]=s(f,u),f.dispose()}}}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const N2=20,zc=3,e0=7;function aP(n,e,t,s){const r=Ve(e),o=lP(n,e,t,r),i=e.length,a=kf(n,e,t,r,o),l=["Tensor"];return s&&(l.push(`  dtype: ${t}`),l.push(`  rank: ${i}`),l.push(`  shape: [${e}]`),l.push("  values:")),l.push(a.map(u=>"    "+u).join(`
`)),l.join(`
`)}function lP(n,e,t,s){const r=pe(e),o=s[s.length-1],i=new Array(o).fill(0),a=e.length,l=t==="complex64"?Xc(n):n;if(a>1)for(let u=0;u<r/o;u++){const d=u*o;for(let f=0;f<o;f++)i[f]=Math.max(i[f],Kc(l[d+f],0,t).length)}return i}function Kc(n,e,t){let s;return Array.isArray(n)?s=`${parseFloat(n[0].toFixed(e0))} + ${parseFloat(n[1].toFixed(e0))}j`:Iu(n)?s=`'${n}'`:t==="bool"?s=FN(n):s=parseFloat(n.toFixed(e0)).toString(),al(s,e)}function FN(n){return n===0?"false":"true"}function kf(n,e,t,s,r,o=!0){const i=t==="complex64"?2:1,a=e[0],l=e.length;if(l===0){if(t==="complex64"){const w=Xc(n);return[Kc(w[0],0,t)]}return t==="bool"?[FN(n[0])]:[n[0].toString()]}if(l===1){if(a>N2){const b=zc*i;let k=Array.from(n.slice(0,b)),v=Array.from(n.slice((a-zc)*i,a*i));return t==="complex64"&&(k=Xc(k),v=Xc(v)),["["+k.map((N,S)=>Kc(N,r[S],t)).join(", ")+", ..., "+v.map((N,S)=>Kc(N,r[a-zc+S],t)).join(", ")+"]"]}return["["+(t==="complex64"?Xc(n):Array.from(n)).map((b,k)=>Kc(b,r[k],t)).join(", ")+"]"]}const u=e.slice(1),d=s.slice(1),f=s[0]*i,m=[];if(a>N2){for(let w=0;w<zc;w++){const b=w*f,k=b+f;m.push(...kf(n.slice(b,k),u,t,d,r,!1))}m.push("...");for(let w=a-zc;w<a;w++){const b=w*f,k=b+f;m.push(...kf(n.slice(b,k),u,t,d,r,w===a-1))}}else for(let w=0;w<a;w++){const b=w*f,k=b+f;m.push(...kf(n.slice(b,k),u,t,d,r,w===a-1))}const g=l===2?",":"";m[0]="["+(a>0?m[0]+g:"");for(let w=1;w<m.length-1;w++)m[w]=" "+m[w]+g;let y=`,
`;for(let w=2;w<l;w++)y+=`
`;return m[m.length-1]=" "+m[m.length-1]+"]"+(o?"":y),m}function Xc(n){const e=[];for(let t=0;t<n.length;t+=2)e.push([n[t],n[t+1]]);return e}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Rn{constructor(e,t,s){if(this.dtype=t,this.shape=e.slice(),this.size=pe(e),s!=null){const r=s.length;_(r===this.size,()=>`Length of values '${r}' does not match the size inferred by the shape '${this.size}'.`)}if(t==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=s||Qt(t,this.size),this.strides=Ve(e)}set(e,...t){t.length===0&&(t=[0]),_(t.length===this.rank,()=>`The number of provided coordinates (${t.length}) must match the rank (${this.rank})`);const s=this.locToIndex(t);this.values[s]=e}get(...e){e.length===0&&(e=[0]);let t=0;for(const r of e){if(r<0||r>=this.shape[t]){const o=`Requested out of range element at ${e}.   Buffer shape=${this.shape}`;throw new Error(o)}t++}let s=e[e.length-1];for(let r=0;r<e.length-1;++r)s+=this.strides[r]*e[r];return this.values[s]}locToIndex(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];let t=e[e.length-1];for(let s=0;s<e.length-1;++s)t+=this.strides[s]*e[s];return t}indexToLoc(e){if(this.rank===0)return[];if(this.rank===1)return[e];const t=new Array(this.shape.length);for(let s=0;s<t.length-1;++s)t[s]=Math.floor(e/this.strides[s]),e-=t[s]*this.strides[s];return t[t.length-1]=e,t}get rank(){return this.shape.length}toTensor(){return Nr().makeTensor(this.values,this.shape,this.dtype)}}let Nr=null,rl=null;function cP(n){Nr=n}function uP(n){rl=n}class un{constructor(e,t,s,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=pe(e),this.strides=Ve(e),this.dataId=s,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const e=await this.data();return rl.buffer(this.shape,this.dtype,e)}bufferSync(){return rl.buffer(this.shape,this.dtype,this.dataSync())}async array(){const e=await this.data();return Tr(this.shape,e,this.dtype==="complex64")}arraySync(){return Tr(this.shape,this.dataSync(),this.dtype==="complex64")}async data(){this.throwIfDisposed();const e=Nr().read(this.dataId);if(this.dtype==="string"){const t=await e;try{return t.map(s=>ai(s))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return e}dataToGPU(e){return this.throwIfDisposed(),Nr().readToGPU(this.dataId,e)}dataSync(){this.throwIfDisposed();const e=Nr().readSync(this.dataId);if(this.dtype==="string")try{return e.map(t=>ai(t))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}async bytes(){this.throwIfDisposed();const e=await Nr().read(this.dataId);return this.dtype==="string"?e:new Uint8Array(e.buffer)}dispose(){this.isDisposed||(this.kerasMask&&this.kerasMask.dispose(),Nr().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(e=!1){return rl.print(this,e)}clone(){return this.throwIfDisposed(),rl.clone(this)}toString(e=!1){const t=this.dataSync();return aP(t,this.shape,this.dtype,e)}cast(e){return this.throwIfDisposed(),rl.cast(this,e)}variable(e=!0,t,s){return this.throwIfDisposed(),Nr().makeVariable(this,e,t,s)}}Object.defineProperty(un,Symbol.hasInstance,{value:n=>!!n&&n.data!=null&&n.dataSync!=null&&n.throwIfDisposed!=null});function fe(){return Ry("Tensor",()=>un)}fe();class Bf extends un{constructor(e,t,s,r){super(e.shape,e.dtype,e.dataId,r),this.trainable=t,this.name=s}assign(e){if(e.dtype!==this.dtype)throw new Error(`dtype of the new value (${e.dtype}) and previous value (${this.dtype}) must match`);if(!xt(e.shape,this.shape))throw new Error(`shape of the new value (${e.shape}) and previous value (${this.shape}) must match`);Nr().disposeTensor(this),this.dataId=e.dataId,Nr().incRef(this,null)}dispose(){Nr().disposeVariable(this),this.isDisposedInternal=!0}}Object.defineProperty(Bf,Symbol.hasInstance,{value:n=>n instanceof un&&n.assign!=null&&n.assign instanceof Function});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var I2;(function(n){n.R0="R0",n.R1="R1",n.R2="R2",n.R3="R3",n.R4="R4",n.R5="R5",n.R6="R6"})(I2||(I2={}));var z0;(function(n){n.float32="float32",n.int32="int32",n.bool="int32",n.complex64="complex64"})(z0||(z0={}));var B0;(function(n){n.float32="float32",n.int32="int32",n.bool="bool",n.complex64="complex64"})(B0||(B0={}));var V0;(function(n){n.float32="float32",n.int32="float32",n.bool="float32",n.complex64="complex64"})(V0||(V0={}));var W0;(function(n){n.float32="complex64",n.int32="complex64",n.bool="complex64",n.complex64="complex64"})(W0||(W0={}));const dP={float32:V0,int32:z0,bool:B0,complex64:W0};function As(n,e){if(n==="string"||e==="string"){if(n==="string"&&e==="string")return"string";throw new Error(`Can not upcast ${n} with ${e}`)}return dP[n][e]}function y1(n){return As(n,"int32")}function LN(n){return n!=null&&typeof n=="object"&&"texture"in n&&n.texture instanceof WebGLTexture}function jN(n){return typeof GPUBuffer<"u"&&n!=null&&typeof n=="object"&&"buffer"in n&&n.buffer instanceof GPUBuffer}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jt(n,e){if(n.dtype===e.dtype)return[n,e];const t=As(n.dtype,e.dtype);return[n.cast(t),e.cast(t)]}function ON(n){const e=[];return _N(n,e,new Set),e}function _N(n,e,t){if(n==null)return;if(n instanceof un){e.push(n);return}if(!hP(n))return;const s=n;for(const r in s){const o=s[r];t.has(o)||(t.add(o),_N(o,e,t))}}function hP(n){return Array.isArray(n)||typeof n=="object"}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function t0(n){return n.kernelName!=null}class $2{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(e=>e.name)))}}}dispose(){for(const e in this.registeredVariables)this.registeredVariables[e].dispose()}}class bl{constructor(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new $2}async ready(){if(this.pendingBackendInit!=null)return this.pendingBackendInit.then(()=>{});if(this.backendInstance!=null)return;const e=this.getSortedBackends();for(let t=0;t<e.length;t++){const s=e[t];if(await this.initializeBackend(s).success){await this.setBackend(s);return}}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(this.pendingBackendInit!=null)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(this.backendInstance==null){const{name:e,asyncInit:t}=this.initializeBackendsAndReturnBest();if(t)throw new Error(`The highest priority backend '${e}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(e)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(e){if(!(e in this.registry))if(e in this.registryFactory){const{asyncInit:t}=this.initializeBackend(e);if(t)return null}else return null;return this.registry[e]}findBackendFactory(e){return e in this.registryFactory?this.registryFactory[e].factory:null}registerBackend(e,t,s=1){return e in this.registryFactory?(Bs(`${e} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[e]={factory:t,priority:s},!0)}async setBackend(e){if(this.registryFactory[e]==null)throw new Error(`Backend name '${e}' not found in registry`);if(this.backendName=e,this.registry[e]==null){this.backendInstance=null;const{success:t,asyncInit:s}=this.initializeBackend(e);if(!(s?await t:t))return!1}return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new nP(this.backendInstance),!0}setupRegisteredKernels(){k2(this.backendName).forEach(t=>{t.setupFunc!=null&&t.setupFunc(this.backendInstance)})}disposeRegisteredKernels(e){k2(e).forEach(s=>{s.disposeFunc!=null&&s.disposeFunc(this.registry[e])})}initializeBackend(e){const t=this.registryFactory[e];if(t==null)throw new Error(`Cannot initialize backend ${e}, no registration found.`);try{const s=t.factory();if(s&&!(s instanceof Ny)&&typeof s.then=="function"){const r=++this.pendingBackendInitId,o=s.then(i=>r<this.pendingBackendInitId?!1:(this.registry[e]=i,this.pendingBackendInit=null,!0)).catch(i=>(r<this.pendingBackendInitId||(this.pendingBackendInit=null,Bs(`Initialization of backend ${e} failed`),Bs(i.stack||i.message)),!1));return this.pendingBackendInit=o,{success:o,asyncInit:!0}}else return this.registry[e]=s,{success:!0,asyncInit:!1}}catch(s){return Bs(`Initialization of backend ${e} failed`),Bs(s.stack||s.message),{success:!1,asyncInit:!1}}}removeBackend(e){if(!(e in this.registryFactory))throw new Error(`${e} backend not found in registry`);this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((e,t)=>this.registryFactory[t].priority-this.registryFactory[e].priority)}initializeBackendsAndReturnBest(){const e=this.getSortedBackends();for(let t=0;t<e.length;t++){const s=e[t],{success:r,asyncInit:o}=this.initializeBackend(s);if(o||r)return{name:s,asyncInit:o}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(e,t){const s=this.state.tensorInfo.get(t),r=s.backend,o=this.readSync(t),i=r.refCount(t);r.disposeData(t,!0),s.backend=e,e.move(t,o,s.shape,s.dtype,i),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(e,t){let s=null;if(t==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");t=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof t!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");s=e}let r;return this.scopedRun(()=>this.startScope(s),()=>this.endScope(r),()=>(r=t(),r instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),r))}scopedRun(e,t,s){e();try{const r=s();return t(),r}catch(r){throw t(),r}}nextTensorId(){return bl.nextTensorId++}nextVariableId(){return bl.nextVariableId++}clone(e){const t=se.runKernel(qu,{x:e}),s={x:e},r=i=>({x:()=>{const a="float32",l={x:i},u={dtype:a};return se.runKernel(Pu,l,u)}}),o=[];return this.addTapeNode(this.state.activeScope.name,s,[t],r,o,{}),t}runKernel(e,t,s){if(this.backendName==null&&this.backend,!(b2(e,this.backendName)!=null))throw new Error(`Kernel '${e}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:e,inputs:t,attrs:s})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(e,t,s){const r=this.backend.numDataIds();let o=0;s.forEach(l=>{o+=l.dtype==="complex64"?3:1});const i=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],a=r-t-o-i;if(a>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${a} data ids) after running '${e}'`)}runKernelFunc(e){let t,s=[];const r=this.isTapeOn(),o=this.state.numBytes,i=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);let a;this.backendName==null&&this.backend;let l;const u=t0(e)?e.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(t0(e)){const{kernelName:y,inputs:w,attrs:b}=e;this.backendName==null&&this.backend;const k=b2(y,this.backendName);_(k!=null,()=>`Cannot find registered kernel '${y}' for backend '${this.backendName}'`),a=()=>{const v=this.backend.numDataIds();l=k.kernelFunc({inputs:w,attrs:b,backend:this.backend});const N=Array.isArray(l)?l:[l];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(y,v,N);const S=N.map($=>$.rank!=null?$:this.makeTensorFromTensorInfo($));if(r){const $=this.getTensorsForGradient(y,w,S);s=this.saveTensorsForBackwardMode($)}return S}}else{const{forwardFunc:y}=e,w=b=>{r&&(s=b.map(k=>this.keep(this.clone(k))))};a=()=>{const b=this.backend.numDataIds();l=this.tidy(()=>y(this.backend,w));const k=Array.isArray(l)?l:[l];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(u,b,k),k}}const{inputs:d,attrs:f}=e,m=t0(e)?null:e.backwardsFunc;let g;return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{!this.ENV.getBool("DEBUG")&&!this.state.profiling?t=a():(g=this.profiler.profileKernel(u,d,()=>a()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(g),t=g.outputs)}),r&&this.addTapeNode(u,d,t,m,s,f),this.state.profiling&&this.state.activeProfile.kernels.push({name:u,bytesAdded:this.state.numBytes-o,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-i,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(d).map(y=>d[y]!=null?d[y].shape:null),outputShapes:t.map(y=>y.shape),kernelTimeMs:g.timeMs,extraInfo:g.extraInfo}),Array.isArray(l)?t:t[0]}saveTensorsForBackwardMode(e){return e.map(s=>this.keep(this.clone(s)))}getTensorsForGradient(e,t,s){const r=w2(e);if(r!=null){const o=r.inputsToSave||[],i=r.outputsToSave||[];let a;r.saveAllInputs?(_(Array.isArray(t),()=>"saveAllInputs is true, expected inputs to be an array."),a=Object.keys(t).map(u=>t[u])):a=o.map(u=>t[u]);const l=s.filter((u,d)=>i[d]);return a.concat(l)}return[]}makeTensor(e,t,s,r){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");s=s||"float32",r=r||this.backend;let o=e;s==="string"&&Iu(e[0])&&(o=e.map(l=>ri(l)));const i=r.write(o,t,s),a=new un(t,s,i,this.nextTensorId());if(this.trackTensor(a,r),s==="string"){const l=this.state.tensorInfo.get(i),u=MM(o);this.state.numBytes+=u-l.bytes,l.bytes=u}return a}makeTensorFromDataId(e,t,s,r){s=s||"float32";const o={dataId:e,shape:t,dtype:s};return this.makeTensorFromTensorInfo(o,r)}makeTensorFromTensorInfo(e,t){const{dataId:s,shape:r,dtype:o}=e,i=new un(r,o,s,this.nextTensorId());return this.trackTensor(i,t),i}makeVariable(e,t=!0,s,r){s=s||this.nextVariableId().toString(),r!=null&&r!==e.dtype&&(e=e.cast(r));const o=new Bf(e,t,s,this.nextTensorId());if(this.state.registeredVariables[o.name]!=null)throw new Error(`Variable with name ${o.name} was already registered`);return this.state.registeredVariables[o.name]=o,this.incRef(o,this.backend),o}trackTensor(e,t){this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++;let s=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(s=e.size*jf(e.dtype)),this.state.numBytes+=s,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:s})),e instanceof Bf||this.track(e)}incRef(e,t){this.trackTensor(e,t),this.backend.incRef(e.dataId)}removeDataId(e,t){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===t&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}disposeTensor(e){if(!this.state.tensorInfo.has(e.dataId))return;const t=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,e.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=t.bytes),e.dtype!=="complex64"&&e.dtype!=="string"){const s=e.size*jf(e.dtype);this.state.numBytes-=s}t.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,t.backend)}disposeVariables(){for(const e in this.state.registeredVariables){const t=this.state.registeredVariables[e];this.disposeVariable(t)}}disposeVariable(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]}memory(){const e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}async profile(e){this.state.profiling=!0;const t=this.state.numBytes,s=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(r=>r.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-s;for(const r of this.state.activeProfile.kernels)r.kernelTimeMs=await r.kernelTimeMs,r.extraInfo=await r.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&this.state.kernelDepth===0}addTapeNode(e,t,s,r,o,i){const a={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:s,saved:o},l=w2(e);l!=null&&(r=l.gradFunc),r!=null&&(a.gradient=u=>(u=u.map((d,f)=>{if(d==null){const m=s[f],g=zn(m.size,m.dtype);return this.makeTensor(g,m.shape,m.dtype)}return d}),r(u.length>1?u:u[0],o,i))),this.state.activeTape.push(a)}keep(e){return e.kept=!0,e}startTape(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(e){const t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t}endScope(e){const t=ON(e),s=new Set(t.map(o=>o.id));for(let o=0;o<this.state.activeScope.track.length;o++){const i=this.state.activeScope.track[o];!i.kept&&!s.has(i.id)&&i.dispose()}const r=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],t.forEach(o=>{!o.kept&&o.scopeId===r.id&&this.track(o)})}gradients(e,t,s,r=!1){if(_(t.length>0,()=>"gradients() received an empty list of xs."),s!=null&&s.dtype!=="float32")throw new Error(`dy must have 'float32' dtype, but has '${s.dtype}'`);const o=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",e));_(o instanceof un,()=>"The result y returned by f() must be a tensor.");const i=oP(this.state.activeTape,t,o);if(!r&&i.length===0&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{const a={};a[o.id]=s??fP(o.shape),iP(a,i,u=>this.tidy(u),pP);const l=t.map(u=>a[u.id]);return this.state.gradientDepth===0&&(this.state.activeTape.forEach(u=>{for(const d of u.saved)d.dispose()}),this.state.activeTape=null),{value:o,grads:l}})}customGrad(e){return _(P0(e),()=>"The f passed in customGrad(f) must be a function."),(...t)=>{_(t.every(a=>a instanceof un),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");let s;const r={};t.forEach((a,l)=>{r[l]=a});const o=(a,l)=>(s=e(...t,l),_(s.value instanceof un,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),_(P0(s.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),s.value),i=(a,l)=>{const u=s.gradFunc(a,l),d=Array.isArray(u)?u:[u];_(d.length===t.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),_(d.every(m=>m instanceof un),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");const f={};return d.forEach((m,g)=>{f[g]=()=>m}),f};return this.runKernelFunc({forwardFunc:o,backwardsFunc:i,inputs:r})}}readSync(e){return this.state.tensorInfo.get(e).backend.readSync(e)}read(e){return this.state.tensorInfo.get(e).backend.read(e)}readToGPU(e,t){return this.state.tensorInfo.get(e).backend.readToGPU(e,t)}async time(e){const t=ds(),s=await this.backend.time(e);return s.wallMs=ds()-t,s}track(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new $2;for(const e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}bl.nextTensorId=0;bl.nextVariableId=0;function fP(n){const e=Ty(pe(n),"float32");return se.makeTensor(e,n,"float32")}function zN(){const n=iN();if(n._tfengine==null){const e=new LM(n);n._tfengine=new bl(e)}return zM(n._tfengine.ENV),cP(()=>n._tfengine),n._tfengine}const se=zN();function pP(n,e){const t={a:n,b:e};return se.runKernel(Ll,t)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mP(){return typeof navigator<"u"&&navigator!=null}function BN(n){if(n||mP()){if(n||(n=navigator),n.product==="ReactNative")return!0;const e=n.userAgent||n.vendor||(typeof window<"u"?window.opera:"");if(!e){const t=n;return t.userAgentData&&t.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}return!1}function VN(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xs=de();xs.registerFlag("DEBUG",()=>!1,n=>{n&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});xs.registerFlag("IS_BROWSER",()=>VN());xs.registerFlag("IS_NODE",()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u");xs.registerFlag("IS_CHROME",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor));xs.registerFlag("IS_SAFARI",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor));xs.registerFlag("PROD",()=>!1);xs.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>xs.getBool("DEBUG"));xs.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0);xs.registerFlag("IS_TEST",()=>!1);xs.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",()=>xs.getBool("DEBUG"));xs.registerFlag("WRAP_TO_IMAGEBITMAP",()=>!1);xs.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",()=>!1);xs.registerFlag("USE_SETTIMEOUTCUSTOM",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sm(n,e){let t=n;if(lr(n))return e==="string"?[]:[n.length];if(LN(n)){const r=n.channels||"RGBA";return[n.height,n.width*r.length]}else if(jN(n))return[n.buffer.size/(e==null?4:jf(e))];if(!Array.isArray(n))return[];const s=[];for(;Array.isArray(t)||lr(t)&&e!=="string";)s.push(t.length),t=t[0];return Array.isArray(n)&&de().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&WN(n,s,[]),s}function WN(n,e,t){if(t=t||[],!Array.isArray(n)&&!lr(n)){_(e.length===0,()=>`Element arr[${t.join("][")}] is a primitive, but should be an array/TypedArray of ${e[0]} elements`);return}_(e.length>0,()=>`Element arr[${t.join("][")}] should be a primitive, but is an array of ${n.length} elements`),_(n.length===e[0],()=>`Element arr[${t.join("][")}] should have ${e[0]} elements, but has ${n.length} elements`);const s=e.slice(1);for(let r=0;r<n.length;++r)WN(n[r],s,t.concat(r))}function T2(n,e,t,s){if(n!=="string_or_numeric"){if(n==null)throw new Error("Expected dtype cannot be null.");if(n!=="numeric"&&n!==e||n==="numeric"&&e==="string")throw new Error(`Argument '${t}' passed to '${s}' must be ${n} tensor, but got ${e} tensor`)}}function K(n,e,t,s="numeric"){if(n instanceof fe())return T2(s,n.dtype,e,t),n;let r=Pl(n);if(r!=="string"&&["bool","int32","float32"].indexOf(s)>=0&&(r=s),T2(s,r,e,t),n==null||!lr(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string"){const l=n==null?"null":n.constructor.name;throw new Error(`Argument '${e}' passed to '${t}' must be a Tensor or TensorLike, but got '${l}'`)}const o=Sm(n,r);!lr(n)&&!Array.isArray(n)&&(n=[n]);const a=r!=="string"?ga(n,r):Zi(n,[],!0);return se.makeTensor(a,o,r)}function UN(n,e,t,s="numeric"){if(!Array.isArray(n))throw new Error(`Argument ${e} passed to ${t} must be a \`Tensor[]\` or \`TensorLike[]\``);return n.map((o,i)=>K(o,`${e}[${i}]`,t,s))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gP="__op";function ie(n){const e=Object.keys(n);if(e.length!==1)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${e.length} keys.`);let t=e[0];const s=n[t];t.endsWith("_")&&(t=t.substring(0,t.length-1)),t=t+gP;const r=(...o)=>{se.startScope(t);try{const i=s(...o);return Ey(i)&&console.error("Cannot return a Promise inside of tidy."),se.endScope(i),i}catch(i){throw se.endScope(null),i}};return Object.defineProperty(r,"name",{value:t,configurable:!0}),r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xP(n,e){const t=K(n,"real","complex"),s=K(e,"imag","complex");$y(t.shape,s.shape,`real and imag shapes, ${t.shape} and ${s.shape}, must match in call to tf.complex().`);const r={real:t,imag:s};return se.runKernel(Oy,r)}const ea=ie({complex_:xP});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nm(n,e,t,s){if(s==null)s=Pl(n);else if(s==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(jN(n)||LN(n)){if(s!=="float32"&&s!=="int32")throw new Error(`Creating tensor from GPU data only supports 'float32'|'int32' dtype, while the dtype is ${s}.`);return se.backend.createTensorFromGPUData(n,e||t,s)}if(!lr(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){Io(e);const r=pe(e),o=pe(t);_(r===o,()=>`Based on the provided shape, [${e}], the tensor should have ${r} values but has ${o}`);for(let i=0;i<t.length;++i){const a=t[i],l=i===t.length-1?a!==pe(e.slice(i)):!0;_(t[i]===e[i]||!l,()=>`Error creating a new Tensor. Inferred shape (${t}) does not match the provided shape (${e}). `)}}return!lr(n)&&!Array.isArray(n)&&(n=[n]),e=e||t,n=s!=="string"?ga(n,s):Zi(n,[],!0),se.makeTensor(n,e,s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tu(n,e,t){const s=Sm(n,t);return Nm(n,e,s,t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vf={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8};class mi{static join(e){return new mi(e).slice()}constructor(e){if(this.shards=[],this.previousShardIndex=0,e==null||(e instanceof Array||(e=[e]),e=e.map(s=>lr(s)?s.buffer:s),e.length===0))return;this.bufferUniformSize=e[0].byteLength;let t=0;for(let s=0;s<e.length;s++){const r=e[s];s!==e.length-1&&r.byteLength!==this.bufferUniformSize&&(this.bufferUniformSize=void 0);const o=t+r.byteLength;this.shards.push({buffer:r,start:t,end:o}),t=o}this.shards.length===0&&(this.byteLength=0),this.byteLength=this.shards[this.shards.length-1].end}slice(e=0,t=this.byteLength){if(this.shards.length===0)return new ArrayBuffer(0);if(e=isNaN(Number(e))?0:e,t=isNaN(Number(t))?0:t,e=Math.max(0,e),t=Math.min(this.byteLength,t),t<=e)return new ArrayBuffer(0);const s=this.findShardForByte(e);if(s===-1)throw new Error(`Could not find start shard for byte ${e}`);const r=t-e,o=new ArrayBuffer(r),i=new Uint8Array(o);let a=0;for(let l=s;l<this.shards.length;l++){const u=this.shards[l],f=e+a-u.start,m=a,y=Math.min(t,u.end)-u.start,w=new Uint8Array(u.buffer,f,y-f);if(i.set(w,m),a+=w.length,t<u.end)break}return o}findShardForByte(e){if(this.shards.length===0||e<0||e>=this.byteLength)return-1;if(this.bufferUniformSize!=null)return this.previousShardIndex=Math.floor(e/this.bufferUniformSize),this.previousShardIndex;function t(r){return e<r.start?-1:e>=r.end?1:0}if(t(this.shards[this.previousShardIndex])===0)return this.previousShardIndex;const s=yP(this.shards,t);return s===-1?-1:(this.previousShardIndex=s,this.previousShardIndex)}}function yP(n,e){let t=0,s=n.length;for(;t<=s;){const r=Math.floor((s-t)/2)+t,o=e(n[r]);if(o===0)return r;o<0?s=r:t=r+1}return-1}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vr(){return se}function E2(){return se.memory()}function le(n,e){return se.tidy(n,e)}function nt(n){ON(n).forEach(t=>t.dispose())}function Kr(n){return se.keep(n)}function GN(n,e,t=1){return se.registerBackend(n,e,t)}function vP(){return se.backend}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wl=4;async function R2(n,e){const t=[],s=[],r=Array.isArray(n)?n.map(i=>i.name):Object.keys(n);for(let i=0;i<r.length;++i){const a=r[i],l=Array.isArray(n)?n[i].tensor:n[a];if(l.dtype!=="float32"&&l.dtype!=="int32"&&l.dtype!=="bool"&&l.dtype!=="string"&&l.dtype!=="complex64")throw new Error(`Unsupported dtype in weight '${a}': ${l.dtype}`);const u={name:a,shape:l.shape,dtype:l.dtype};if(l.dtype==="string"){const d=new Promise(async f=>{const m=await l.bytes(),g=m.reduce((b,k)=>b+k.length,0)+wl*m.length,y=new Uint8Array(g);let w=0;for(let b=0;b<m.length;b++){const k=m[b],v=new Uint8Array(new Uint32Array([k.length]).buffer);y.set(v,w),w+=wl,y.set(k,w),w+=k.length}f(y)});s.push(d)}else s.push(l.data());e!=null&&(u.group=e),t.push(u)}const o=await Promise.all(s);return{data:CP(o),specs:t}}function bP(n,e){const t=new mi(n),s={};let r=0;for(const o of e){const i=wP(o,(a,l)=>t.slice(r+a,r+l));s[o.name]=kP(o,t.slice(r,r+i)),r+=i}return s}function wP(n,e){const t=pe(n.shape);let s;if("quantization"in n){const r=n.quantization;s=Vf[r.dtype]}else if(n.dtype==="string"){let r=0;for(let o=0;o<t;o++)r+=wl+new Uint32Array(e(r,r+wl))[0];return r}else s=Vf[n.dtype];return t*s}function kP(n,e){const t=n.name,s=n.dtype,r=n.shape,o=pe(r);let i,a=0;if("quantization"in n){const l=n.quantization;if(l.dtype==="uint8"||l.dtype==="uint16"){if(!("min"in l&&"scale"in l))throw new Error(`Weight ${n.name} with quantization ${l.dtype} doesn't have corresponding metadata min and scale.`)}else if(l.dtype==="float16"){if(s!=="float32")throw new Error(`Weight ${n.name} is quantized with ${l.dtype} which only supports weights of type float32 not ${s}.`)}else throw new Error(`Weight ${n.name} has unknown quantization dtype ${l.dtype}. Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.`);const u=Vf[l.dtype],d=l.dtype==="uint8"?new Uint8Array(e):new Uint16Array(e);if(s==="float32")if(l.dtype==="uint8"||l.dtype==="uint16"){i=new Float32Array(d.length);for(let f=0;f<d.length;f++){const m=d[f];i[f]=m*l.scale+l.min}}else if(l.dtype==="float16")i=MP()(d);else throw new Error(`Unsupported quantization type ${l.dtype} for weight type float32.`);else if(s==="int32"){if(l.dtype!=="uint8"&&l.dtype!=="uint16")throw new Error(`Unsupported quantization type ${l.dtype} for weight type int32.`);i=new Int32Array(d.length);for(let f=0;f<d.length;f++){const m=d[f];i[f]=Math.round(m*l.scale+l.min)}}else throw new Error(`Unsupported dtype in weight '${t}': ${s}`);a+=o*u}else if(s==="string"){const l=pe(n.shape);i=[];for(let u=0;u<l;u++){const d=new Uint32Array(e.slice(a,a+wl))[0];a+=wl;const f=new Uint8Array(e.slice(a,a+d));i.push(f),a+=d}}else{const l=Vf[s];if(s==="float32")i=new Float32Array(e);else if(s==="int32")i=new Int32Array(e);else if(s==="bool")i=new Uint8Array(e);else if(s==="complex64"){i=new Float32Array(e);const u=new Float32Array(i.length/2),d=new Float32Array(i.length/2);for(let y=0;y<u.length;y++)u[y]=i[y*2],d[y]=i[y*2+1];const f=tu(u,r,"float32"),m=tu(d,r,"float32"),g=ea(f,m);return f.dispose(),m.dispose(),g}else throw new Error(`Unsupported dtype in weight '${t}': ${s}`);a+=o*l}return tu(i,r,s)}function CP(n){if(n===null)throw new Error(`Invalid input value: ${JSON.stringify(n)}`);let e=0;const t=[];n.forEach(o=>{if(e+=o.byteLength,t.push(o.byteLength===o.buffer.byteLength?o:new o.constructor(o)),!(o instanceof Float32Array||o instanceof Int32Array||o instanceof Uint8Array))throw new Error(`Unsupported TypedArray subtype: ${o.constructor.name}`)});const s=new Uint8Array(e);let r=0;return t.forEach(o=>{s.set(new Uint8Array(o.buffer),r),r+=o.byteLength}),s.buffer}const v1=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function A2(n){return v1?Buffer.byteLength(n,"utf8"):new Blob([n]).size}function SP(n){if(v1)return Buffer.from(n).toString("base64");const e=new Uint8Array(n);let t="";for(let s=0,r=e.length;s<r;s++)t+=String.fromCharCode(e[s]);return btoa(t)}function NP(n){if(v1){const s=Buffer.from(n,"base64");return s.buffer.slice(s.byteOffset,s.byteOffset+s.byteLength)}const e=atob(n),t=new Uint8Array(e.length);for(let s=0;s<e.length;++s)t.set([e.charCodeAt(s)],s);return t.buffer}function IP(n){return mi.join(n)}function $P(n,e){const t={modelTopology:n.modelTopology,format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy,weightsManifest:e};return n.signature!=null&&(t.signature=n.signature),n.userDefinedMetadata!=null&&(t.userDefinedMetadata=n.userDefinedMetadata),n.modelInitializer!=null&&(t.modelInitializer=n.modelInitializer),n.initializerSignature!=null&&(t.initializerSignature=n.initializerSignature),n.trainingConfig!=null&&(t.trainingConfig=n.trainingConfig),t}function TP(n,e,t){const s={modelTopology:n.modelTopology,format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy};if(n.trainingConfig!=null&&(s.trainingConfig=n.trainingConfig),n.weightsManifest!=null){if(!e)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!t)throw new Error("modelJSON has weightsManifest but weightData is null");s.weightSpecs=e,s.weightData=t}return n.signature!=null&&(s.signature=n.signature),n.userDefinedMetadata!=null&&(s.userDefinedMetadata=n.userDefinedMetadata),n.modelInitializer!=null&&(s.modelInitializer=n.modelInitializer),n.initializerSignature!=null&&(s.initializerSignature=n.initializerSignature),s}async function EP(n,e){let t,s;return n.weightsManifest!=null&&([t,s]=await e(n.weightsManifest)),TP(n,t,s)}function b1(n){if(n.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:n.modelTopology==null?0:A2(JSON.stringify(n.modelTopology)),weightSpecsBytes:n.weightSpecs==null?0:A2(JSON.stringify(n.weightSpecs)),weightDataBytes:n.weightData==null?0:new mi(n.weightData).byteLength}}function D2(n){const e=[];for(const t of n)e.push(...t.weights);return e}function RP(){const n=t=>{let s=t<<13,r=0;for(;(s&8388608)===0;)r-=8388608,s<<=1;return s&=-8388609,r+=947912704,s|r},e=new Uint32Array(2048);e[0]=0;for(let t=1;t<1024;t++)e[t]=n(t);for(let t=1024;t<2048;t++)e[t]=939524096+(t-1024<<13);return e}function AP(){const n=new Uint32Array(64);n[0]=0,n[31]=1199570944,n[32]=2147483648,n[63]=3347054592;for(let e=1;e<31;e++)n[e]=e<<23;for(let e=33;e<63;e++)n[e]=2147483648+(e-32<<23);return n}function DP(){const n=new Uint32Array(64);for(let e=0;e<64;e++)n[e]=1024;return n[0]=n[32]=0,n}function MP(){const n=RP(),e=AP(),t=DP();return s=>{const r=new ArrayBuffer(4*s.length),o=new Uint32Array(r);for(let i=0;i<s.length;i++){const a=s[i],l=n[t[a>>10]+(a&1023)]+e[a>>10];o[i]=l}return new Float32Array(r)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class vn{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return vn.instance==null&&(vn.instance=new vn),vn.instance}static registerSaveRouter(e){vn.getInstance().saveRouters.push(e)}static registerLoadRouter(e){vn.getInstance().loadRouters.push(e)}static getSaveHandlers(e){return vn.getHandlers(e,"save")}static getLoadHandlers(e,t){return vn.getHandlers(e,"load",t)}static getHandlers(e,t,s){const r=[];return(t==="load"?vn.getInstance().loadRouters:vn.getInstance().saveRouters).forEach(i=>{const a=i(e,s);a!==null&&r.push(a)}),r}}const PP=n=>vn.getSaveHandlers(n),FP=(n,e)=>vn.getLoadHandlers(n,e);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const U0="tensorflowjs",G0=1,Gi="models_store",Zo="model_info_store";function HN(){if(!de().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");const n=typeof window>"u"?self:window,e=n.indexedDB||n.mozIndexedDB||n.webkitIndexedDB||n.msIndexedDB||n.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function H0(n){const e=n.result;e.createObjectStore(Gi,{keyPath:"modelPath"}),e.createObjectStore(Zo,{keyPath:"modelPath"})}class ta{constructor(e){if(this.indexedDB=HN(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,e)}async load(){return this.databaseAction(this.modelPath)}databaseAction(e,t){return new Promise((s,r)=>{const o=this.indexedDB.open(U0,G0);o.onupgradeneeded=()=>H0(o),o.onsuccess=()=>{const i=o.result;if(t==null){const a=i.transaction(Gi,"readonly"),u=a.objectStore(Gi).get(this.modelPath);u.onsuccess=()=>{if(u.result==null)return i.close(),r(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));s(u.result.modelArtifacts)},u.onerror=d=>(i.close(),r(u.error)),a.oncomplete=()=>i.close()}else{t.weightData=mi.join(t.weightData);const a=b1(t),l=i.transaction(Zo,"readwrite");let u=l.objectStore(Zo),d;try{d=u.put({modelPath:this.modelPath,modelArtifactsInfo:a})}catch(m){return r(m)}let f;d.onsuccess=()=>{f=i.transaction(Gi,"readwrite");const m=f.objectStore(Gi);let g;try{g=m.put({modelPath:this.modelPath,modelArtifacts:t,modelArtifactsInfo:a})}catch(y){return r(y)}g.onsuccess=()=>s({modelArtifactsInfo:a}),g.onerror=y=>{u=l.objectStore(Zo);const w=u.delete(this.modelPath);w.onsuccess=()=>(i.close(),r(g.error)),w.onerror=b=>(i.close(),r(g.error))}},d.onerror=m=>(i.close(),r(d.error)),l.oncomplete=()=>{f==null?i.close():f.oncomplete=()=>i.close()}}},o.onerror=i=>r(o.error)})}}ta.URL_SCHEME="indexeddb://";const qN=n=>de().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(ta.URL_SCHEME)?LP(n.slice(ta.URL_SCHEME.length)):null;vn.registerSaveRouter(qN);vn.registerLoadRouter(qN);function LP(n){return new ta(n)}function jP(n){return n.startsWith(ta.URL_SCHEME)?n.slice(ta.URL_SCHEME.length):n}class OP{constructor(){this.indexedDB=HN()}async listModels(){return new Promise((e,t)=>{const s=this.indexedDB.open(U0,G0);s.onupgradeneeded=()=>H0(s),s.onsuccess=()=>{const r=s.result,o=r.transaction(Zo,"readonly"),a=o.objectStore(Zo).getAll();a.onsuccess=()=>{const l={};for(const u of a.result)l[u.modelPath]=u.modelArtifactsInfo;e(l)},a.onerror=l=>(r.close(),t(a.error)),o.oncomplete=()=>r.close()},s.onerror=r=>t(s.error)})}async removeModel(e){return e=jP(e),new Promise((t,s)=>{const r=this.indexedDB.open(U0,G0);r.onupgradeneeded=()=>H0(r),r.onsuccess=()=>{const o=r.result,i=o.transaction(Zo,"readwrite"),a=i.objectStore(Zo),l=a.get(e);let u;l.onsuccess=()=>{if(l.result==null)return o.close(),s(new Error(`Cannot find model with path '${e}' in IndexedDB.`));{const d=a.delete(e),f=()=>{u=o.transaction(Gi,"readwrite");const g=u.objectStore(Gi).delete(e);g.onsuccess=()=>t(l.result.modelArtifactsInfo),g.onerror=y=>s(l.error)};d.onsuccess=f,d.onerror=m=>(f(),o.close(),s(l.error))}},l.onerror=d=>(o.close(),s(l.error)),i.oncomplete=()=>{u==null?o.close():u.oncomplete=()=>o.close()}},r.onerror=o=>s(r.error)})}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bo="/",ol="tensorflowjs_models",KN="info",_P="model_topology",zP="weight_specs",BP="weight_data",VP="model_metadata";function XN(n){return{info:[ol,n,KN].join(bo),topology:[ol,n,_P].join(bo),weightSpecs:[ol,n,zP].join(bo),weightData:[ol,n,BP].join(bo),modelMetadata:[ol,n,VP].join(bo)}}function QN(n){for(const e of Object.values(n))window.localStorage.removeItem(e)}function WP(n){const e=n.split(bo);if(e.length<3)throw new Error(`Invalid key format: ${n}`);return e.slice(1,e.length-1).join(bo)}function UP(n){return n.startsWith(na.URL_SCHEME)?n.slice(na.URL_SCHEME.length):n}class na{constructor(e){if(!de().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=XN(this.modelPath)}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{const t=JSON.stringify(e.modelTopology),s=JSON.stringify(e.weightSpecs),r=b1(e),o=mi.join(e.weightData);try{this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,s),this.LS.setItem(this.keys.weightData,SP(o));const i={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:e.signature!=null?e.signature:void 0,userDefinedMetadata:e.userDefinedMetadata!=null?e.userDefinedMetadata:void 0,modelInitializer:e.modelInitializer!=null?e.modelInitializer:void 0,initializerSignature:e.initializerSignature!=null?e.initializerSignature:void 0,trainingConfig:e.trainingConfig!=null?e.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(i)),{modelArtifactsInfo:r}}catch{throw QN(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${r.modelTopologyBytes}, weightSpecsBytes=${r.weightSpecsBytes}, weightDataBytes=${r.weightDataBytes}.`)}}}async load(){const e=JSON.parse(this.LS.getItem(this.keys.info));if(e==null)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");const t={},s=JSON.parse(this.LS.getItem(this.keys.topology));if(s==null)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);t.modelTopology=s;const r=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(r==null)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);t.weightSpecs=r;const o=this.LS.getItem(this.keys.modelMetadata);if(o!=null){const a=JSON.parse(o);t.format=a.format,t.generatedBy=a.generatedBy,t.convertedBy=a.convertedBy,a.signature!=null&&(t.signature=a.signature),a.userDefinedMetadata!=null&&(t.userDefinedMetadata=a.userDefinedMetadata),a.modelInitializer!=null&&(t.modelInitializer=a.modelInitializer),a.initializerSignature!=null&&(t.initializerSignature=a.initializerSignature),a.trainingConfig!=null&&(t.trainingConfig=a.trainingConfig)}const i=this.LS.getItem(this.keys.weightData);if(i==null)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return t.weightData=NP(i),t}}na.URL_SCHEME="localstorage://";const YN=n=>de().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(na.URL_SCHEME)?GP(n.slice(na.URL_SCHEME.length)):null;vn.registerSaveRouter(YN);vn.registerLoadRouter(YN);function GP(n){return new na(n)}class HP{constructor(){_(de().getBool("IS_BROWSER"),()=>"Current environment is not a web browser"),_(typeof window>"u"||typeof window.localStorage<"u",()=>"Current browser does not appear to support localStorage"),this.LS=window.localStorage}async listModels(){const e={},t=ol+bo,s=bo+KN;for(let r=0;r<this.LS.length;++r){const o=this.LS.key(r);if(o.startsWith(t)&&o.endsWith(s)){const i=WP(o);e[i]=JSON.parse(this.LS.getItem(o))}}return e}async removeModel(e){e=UP(e);const t=XN(e);if(this.LS.getItem(t.info)==null)throw new Error(`Cannot find model at path '${e}'`);const s=JSON.parse(this.LS.getItem(t.info));return QN(t),s}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cl="://";class Es{constructor(){this.managers={}}static getInstance(){return Es.instance==null&&(Es.instance=new Es),Es.instance}static registerManager(e,t){_(e!=null,()=>"scheme must not be undefined or null."),e.endsWith(cl)&&(e=e.slice(0,e.indexOf(cl))),_(e.length>0,()=>"scheme must not be an empty string.");const s=Es.getInstance();_(s.managers[e]==null,()=>`A model store manager is already registered for scheme '${e}'.`),s.managers[e]=t}static getManager(e){const t=Es.getInstance().managers[e];if(t==null)throw new Error(`Cannot find model manager for scheme '${e}'`);return t}static getSchemes(){return Object.keys(Es.getInstance().managers)}}function qP(n){if(n.indexOf(cl)===-1)throw new Error(`The url string provided does not contain a scheme. Supported schemes are: ${Es.getSchemes().join(",")}`);return{scheme:n.split(cl)[0],path:n.split(cl)[1]}}async function KP(){const n=Es.getSchemes(),e={};for(const t of n){const s=await Es.getManager(t).listModels();for(const r in s){const o=t+cl+r;e[o]=s[r]}}return e}async function XP(n){const e=qP(n);return Es.getManager(e.scheme).removeModel(e.path)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class QP{constructor(){this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}fetch(e,t){return fetch(e,t)}now(){return performance.now()}encode(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error(`Browser's encoder only supports utf-8, but got ${t}`);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}decode(e,t){return new TextDecoder(t).decode(e)}setTimeoutCustom(e,t){if(typeof window>"u"||!de().getBool("USE_SETTIMEOUTCUSTOM")){setTimeout(e,t);return}this.functionRefs.push(e),setTimeout(()=>{window.postMessage({name:this.messageName,index:this.functionRefs.length-1},"*")},t),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",s=>{if(s.source===window&&s.data.name===this.messageName){s.stopPropagation();const r=this.functionRefs[s.data.index];r(),this.handledMessageCount++,this.handledMessageCount===this.functionRefs.length&&(this.functionRefs=[],this.handledMessageCount=0)}},!0))}isTypedArray(e){return RN(e)}}if(de().get("IS_BROWSER")){de().setPlatform("browser",new QP);try{Es.registerManager(na.URL_SCHEME,new HP)}catch{}try{Es.registerManager(ta.URL_SCHEME,new OP)}catch{}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YP={importFetch:()=>require("node-fetch")};let n0;class JP{constructor(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}fetch(e,t){return de().global.fetch!=null?de().global.fetch(e,t):(n0==null&&(n0=YP.importFetch()),n0(e,t))}now(){const e=process.hrtime();return e[0]*1e3+e[1]/1e6}encode(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error(`Node built-in encoder only supports utf-8, but got ${t}`);return this.textEncoder.encode(e)}decode(e,t){return e.length===0?"":new this.util.TextDecoder(t).decode(e)}isTypedArray(e){return this.util.types.isFloat32Array(e)||this.util.types.isInt32Array(e)||this.util.types.isUint8Array(e)||this.util.types.isUint8ClampedArray(e)}}de().get("IS_NODE")&&!de().get("IS_BROWSER")&&de().setPlatform("node",new JP);/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function st(n,e="float32",t){return e=e||"float32",Io(n),new Rn(n,e,t)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZP(n,e){const t=K(n,"x","cast");if(!DM(e))throw new Error(`Failed to cast to unknown dtype ${e}`);if(e==="string"&&t.dtype!=="string"||e!=="string"&&t.dtype==="string")throw new Error("Only strings can be casted to strings");const s={x:t},r={dtype:e};return se.runKernel(Pu,s,r)}const Ae=ie({cast_:ZP});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eF(n){const t={x:K(n,"x","clone","string_or_numeric")};return se.runKernel(qu,t)}const Ki=ie({clone_:eF});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tF(n,e=!1){console.log(n.toString(e))}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */zN();const nF={buffer:st,cast:Ae,clone:Ki,print:tF};uP(nF);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sF(n,e){let t=K(n,"a","add"),s=K(e,"b","add");[t,s]=Jt(t,s);const r={a:t,b:s};return se.runKernel(Ll,r)}const Ie=ie({add_:sF});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rF(n,e){let t=K(n,"a","floorDiv"),s=K(e,"b","floorDiv");[t,s]=Jt(t,s);const r={a:t,b:s};return se.runKernel(Gu,r)}const JN=ie({floorDiv_:rF});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oF(n,e){let t=K(n,"a","div"),s=K(e,"b","div");if([t,s]=Jt(t,s),t.dtype==="int32"&&s.dtype==="int32")return JN(t,s);const r={a:t,b:s},o={};return se.runKernel(_u,r,o)}const Ge=ie({div_:oF});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iF(n,e){let t=K(n,"a","mul"),s=K(e,"b","mul");[t,s]=Jt(t,s);const r={a:t,b:s};return se.runKernel(nd,r)}const te=ie({mul_:iF});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aF(n){const e=K(n,"x","abs");if(e.dtype==="complex64"){const t={x:e};return se.runKernel(Rp,t)}else{const t={x:e};return se.runKernel(Cp,t)}}const es=ie({abs_:aF});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lF(n){const t={x:K(n,"x","acos")};return se.runKernel($u,t)}const cF=ie({acos_:lF});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uF(n){const t={x:K(n,"x","acosh")};return se.runKernel(Tu,t)}const dF=ie({acosh_:uF});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hF(n,e=null,t=!1){const r={x:K(n,"x","all","bool")},o={axis:e,keepDims:t};return se.runKernel(Dy,r,o)}const ZN=ie({all_:hF});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fF(n,e=null,t=!1){const r={x:K(n,"x","any","bool")},o={axis:e,keepDims:t};return se.runKernel(My,r,o)}const q0=ie({any_:fF});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pF(n,e=0){const s={x:K(n,"x","argMax")},r={axis:e};return se.runKernel(Sp,s,r)}const cu=ie({argMax_:pF});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mF(n,e=0){const s={x:K(n,"x","argMin")},r={axis:e};return se.runKernel(Np,s,r)}const gF=ie({argMin_:mF});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xF(n){const t={x:K(n,"x","asin")};return se.runKernel(Eu,t)}const yF=ie({asin_:xF});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vF(n){const t={x:K(n,"x","asinh")};return se.runKernel(Ru,t)}const bF=ie({asinh_:vF});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wF(n){const t={x:K(n,"x","atan")};return se.runKernel(Au,t)}const kF=ie({atan_:wF});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CF(n,e){let t=K(n,"a","atan2"),s=K(e,"b","atan2");[t,s]=Jt(t,s);const r={a:t,b:s};return se.runKernel(Mu,r)}const SF=ie({atan2_:CF});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NF(n){const t={x:K(n,"x","atanh")};return se.runKernel(Du,t)}const IF=ie({atanh_:NF});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kd(n,e,t,s,r="NHWC",o){const i=n[3],a=[...e,i],l=To(r);return An(n,a,t,o,s,null,null,l)}function ur(n,e,t,s,r,o,i="channelsLast"){const[a,l]=uu(e);let u;if(i==="channelsLast")u=[a,l,n[3],n[3]];else if(i==="channelsFirst")u=[a,l,n[1],n[1]];else throw new Error(`Unknown dataFormat ${i}`);return An(n,u,t,s,r,o,!1,i)}function $o(n,e,t,s,r,o,i="NDHWC"){const[a,l,u]=K0(e);let d,f;if(i==="NDHWC")f="channelsLast",d=[a,l,u,n[4],n[4]];else if(i==="NCDHW")f="channelsFirst",d=[a,l,u,n[1],n[1]];else throw new Error(`Unknown dataFormat ${i}`);return gi(n,d,t,s,r,!1,f,o)}function An(n,e,t,s,r,o,i=!1,a="channelsLast"){let[l,u,d,f]=[-1,-1,-1,-1];if(a==="channelsLast")[l,u,d,f]=n;else if(a==="channelsFirst")[l,f,u,d]=n;else throw new Error(`Unknown dataFormat ${a}`);const[m,g,,y]=e,[w,b]=uu(t),[k,v]=uu(s),N=ul(m,k),S=ul(g,v),{padInfo:$,outHeight:R,outWidth:M}=EF(r,u,d,w,b,N,S,o,a),A=i?y*f:y;let P;return a==="channelsFirst"?P=[l,A,R,M]:a==="channelsLast"&&(P=[l,R,M,A]),{batchSize:l,dataFormat:a,inHeight:u,inWidth:d,inChannels:f,outHeight:R,outWidth:M,outChannels:A,padInfo:$,strideHeight:w,strideWidth:b,filterHeight:m,filterWidth:g,effectiveFilterHeight:N,effectiveFilterWidth:S,dilationHeight:k,dilationWidth:v,inShape:n,outShape:P,filterShape:e}}function gi(n,e,t,s,r,o=!1,i="channelsLast",a){let[l,u,d,f,m]=[-1,-1,-1,-1,-1];if(i==="channelsLast")[l,u,d,f,m]=n;else if(i==="channelsFirst")[l,m,u,d,f]=n;else throw new Error(`Unknown dataFormat ${i}`);const[g,y,w,,b]=e,[k,v,N]=K0(t),[S,$,R]=K0(s),M=ul(g,S),A=ul(y,$),P=ul(w,R),{padInfo:D,outDepth:E,outHeight:j,outWidth:V}=RF(r,u,d,f,k,v,N,M,A,P,a),W=o?b*m:b;let U;return i==="channelsFirst"?U=[l,W,E,j,V]:i==="channelsLast"&&(U=[l,E,j,V,W]),{batchSize:l,dataFormat:i,inDepth:u,inHeight:d,inWidth:f,inChannels:m,outDepth:E,outHeight:j,outWidth:V,outChannels:W,padInfo:D,strideDepth:k,strideHeight:v,strideWidth:N,filterDepth:g,filterHeight:y,filterWidth:w,effectiveFilterDepth:M,effectiveFilterHeight:A,effectiveFilterWidth:P,dilationDepth:S,dilationHeight:$,dilationWidth:R,inShape:n,outShape:U,filterShape:e}}function $F(n,e,t,s,r){s==null&&(s=w1(n,e,t));const o=n[0],i=n[1],a=du((o-e+2*s)/t+1,r),l=du((i-e+2*s)/t+1,r);return[a,l]}function TF(n,e,t,s,r,o){r==null&&(r=w1(n,e[0],s[0]));const i=[0,0,0,t];for(let a=0;a<3;a++)n[a]+2*r>=e[a]&&(i[a]=du((n[a]-e[a]+2*r)/s[a]+1,o));return i}function w1(n,e,t,s=1){const r=ul(e,s);return Math.floor((n[0]*(t-1)-t+r)/2)}function uu(n){return typeof n=="number"?[n,n,n]:n.length===2?[n[0],n[1],1]:n}function K0(n){return typeof n=="number"?[n,n,n]:n}function ul(n,e){return e<=1?n:n+(n-1)*(e-1)}function EF(n,e,t,s,r,o,i,a,l){let u,d,f;if(typeof n=="number"){u={top:n,bottom:n,left:n,right:n,type:n===0?"VALID":"NUMBER"};const g=$F([e,t],o,s,n,a);d=g[0],f=g[1]}else if(n==="same"){d=Math.ceil(e/s),f=Math.ceil(t/r);const m=Math.max(0,(d-1)*s+o-e),g=Math.max(0,(f-1)*r+i-t),y=Math.floor(m/2),w=m-y,b=Math.floor(g/2),k=g-b;u={top:y,bottom:w,left:b,right:k,type:"SAME"}}else if(n==="valid")u={top:0,bottom:0,left:0,right:0,type:"VALID"},d=Math.ceil((e-o+1)/s),f=Math.ceil((t-i+1)/r);else if(typeof n=="object"){const m=l==="channelsLast"?n[1][0]:n[2][0],g=l==="channelsLast"?n[1][1]:n[2][1],y=l==="channelsLast"?n[2][0]:n[3][0],w=l==="channelsLast"?n[2][1]:n[3][1];u={top:m,bottom:g,left:y,right:w,type:m===0&&g===0&&y===0&&w===0?"VALID":"EXPLICIT"},d=du((e-o+m+g)/s+1,a),f=du((t-i+y+w)/r+1,a)}else throw Error(`Unknown padding parameter: ${n}`);return{padInfo:u,outHeight:d,outWidth:f}}function RF(n,e,t,s,r,o,i,a,l,u,d){let f,m,g,y;if(n==="valid"&&(n=0),typeof n=="number"){f={top:n,bottom:n,left:n,right:n,front:n,back:n,type:n===0?"VALID":"NUMBER"};const b=TF([e,t,s,1],[a,l,u],1,[r,o,i],n,d);m=b[0],g=b[1],y=b[2]}else if(n==="same"){m=Math.ceil(e/r),g=Math.ceil(t/o),y=Math.ceil(s/i);const w=(m-1)*r+a-e,b=(g-1)*o+l-t,k=(y-1)*i+u-s,v=Math.floor(w/2),N=w-v,S=Math.floor(b/2),$=b-S,R=Math.floor(k/2),M=k-R;f={top:S,bottom:$,left:R,right:M,front:v,back:N,type:"SAME"}}else throw Error(`Unknown padding parameter: ${n}`);return{padInfo:f,outDepth:m,outHeight:g,outWidth:y}}function du(n,e){if(!e)return Math.trunc(n);switch(e){case"round":return Math.round(n);case"ceil":return Math.ceil(n);case"floor":return Math.floor(n);default:throw new Error(`Unknown roundingMode ${e}`)}}function sa(n){const[e,t,s]=uu(n);return e===1&&t===1&&s===1}function Vn(n,e){return sa(n)||sa(e)}function ra(n){return uu(n).every(e=>e>0)}function To(n){if(n==="NHWC")return"channelsLast";if(n==="NCHW")return"channelsFirst";throw new Error(`Unknown dataFormat ${n}`)}function vs(n,e,t){if(t!=null){if(typeof e=="string")throw Error(`Error in ${n}: pad must be an integer when using dimRoundingMode ${t} but got pad ${e}.`);if(typeof e=="number")_(vl(e),()=>`Error in ${n}: pad must be an integer when using dimRoundingMode ${t} but got pad ${e}.`);else if(typeof e=="object")e.forEach(s=>{s.forEach(r=>{_(vl(r),()=>`Error in ${n}: pad must be an integer when using dimRoundingMode ${t} but got pad ${r}.`)})});else throw Error(`Error in ${n}: Unknown padding parameter: ${e}`)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AF(n,e){const s={x:K(n,"x","reshape","string_or_numeric")},r={shape:e};return se.runKernel(um,s,r)}const re=ie({reshape_:AF});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DF(n,e,t,s,r){const o=K(n,"x","avgPool","float32"),i=1;_(Vn(t,i),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${t} and dilations '${i}'`);let a=o,l=!1;o.rank===3&&(l=!0,a=re(o,[1,o.shape[0],o.shape[1],o.shape[2]])),_(a.rank===4,()=>`Error in avgPool: x must be rank 4 but got rank ${a.rank}.`),vs("avgPool",s,r);const u={x:a},d={filterSize:e,strides:t,pad:s,dimRoundingMode:r};let f=se.runKernel(Ip,u,d);return f=Ae(f,o.dtype),l?re(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const k1=ie({avgPool_:DF});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MF(n,e,t,s,r,o="NDHWC"){const i=K(n,"x","avgPool3d","float32");let a=i,l=!1;i.rank===4&&(l=!0,a=re(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),_(a.rank===5,()=>`Error in avgPool3d: x must be rank 5 but got rank ${a.rank}.`),_(o==="NDHWC",()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${o}`),_(typeof t=="number"&&t>0||Array.isArray(t)&&t[0]>0&&t[1]>0&&t[2]>0,()=>`Error in avgPool3d: Stride must be > 0, but got '${t}'`),vs("avgPool3d",s,r);const u={x:a},d={filterSize:e,strides:t,pad:s,dimRoundingMode:r,dataFormat:o};let f=se.runKernel($p,u,d);return f=Ae(f,a.dtype),l?re(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}const PF=ie({avgPool3d_:MF});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FF(n,e=0){_(n.length>=1,()=>"Pass at least one tensor to concat");const t=UN(n,"tensors","concat","string_or_numeric");if(t[0].dtype==="complex64"&&t.forEach(o=>{if(o.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype ${o.dtype}. `)}),t.length===1)return Ki(t[0]);const s=t,r={axis:e};return se.runKernel(Ap,s,r)}const ms=ie({concat_:FF});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LF(n,e,t=!1,s=!1){let r=K(n,"a","matMul"),o=K(e,"b","matMul");[r,o]=Jt(r,o);const i={a:r,b:o},a={transposeA:t,transposeB:s};return se.runKernel(Tp,i,a)}const mt=ie({matMul_:LF});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jF(n){const t={x:K(n,"x","sigmoid","float32")};return se.runKernel(fd,t)}const jl=ie({sigmoid_:jF});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OF(n,e,t){const s=K(n,"x","slice","string_or_numeric");if(s.rank===0)throw new Error("Slicing scalar is not possible");const r={x:s},o={begin:e,size:t};return se.runKernel(mm,r,o)}const $t=ie({slice_:OF});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _F(n){const t={x:K(n,"x","tanh","float32")};return se.runKernel(vd,t)}const Im=ie({tanh_:_F});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zF(n,e,t){const s=K(n,"x","batchToSpaceND"),r=e.reduce((a,l)=>a*l);_(s.rank>=1+e.length,()=>`input rank is ${s.rank} but should be > than blockShape.length ${e.length}`),_(t.length===e.length,()=>`crops.length is ${t.length} but should be equal to blockShape.length  ${e.length}`),_(s.shape[0]%r===0,()=>`input tensor batch is ${s.shape[0]} but is not divisible by the product of the elements of blockShape ${e.join(" * ")} === ${r}`);const o={x:s},i={blockShape:e,crops:t};return se.runKernel(Ep,o,i)}const C1=ie({batchToSpaceND_:zF});function BF(n){let e;return n.rank===0||n.rank===1?e=re(n,[1,1,1,n.size]):n.rank===2?e=re(n,[1,1,n.shape[0],n.shape[1]]):n.rank===3?e=re(n,[1,n.shape[0],n.shape[1],n.shape[2]]):e=n,e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VF(n,e,t,s,r,o){o==null&&(o=.001);const i=K(n,"x","batchNorm"),a=K(e,"mean","batchNorm"),l=K(t,"variance","batchNorm");let u;r!=null&&(u=K(r,"scale","batchNorm"));let d;s!=null&&(d=K(s,"offset","batchNorm")),_(a.rank===l.rank,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),_(d==null||a.rank===d.rank,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),_(u==null||a.rank===u.rank,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");const m={x:BF(i),scale:u,offset:d,mean:a,variance:l},g={varianceEpsilon:o},y=se.runKernel(zp,m,g);return re(y,i.shape)}const $m=ie({batchNorm_:VF});function WF(n,e,t,s,r,o){const i=K(n,"x","batchNorm"),a=K(e,"mean","batchNorm"),l=K(t,"variance","batchNorm");let u;r!=null&&(u=K(r,"scale","batchNorm"));let d;return s!=null&&(d=K(s,"offset","batchNorm")),_(i.rank===2,()=>`Error in batchNorm2D: x must be rank 2 but got rank ${i.rank}.`),_(a.rank===2||a.rank===1,()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${a.rank}.`),_(l.rank===2||l.rank===1,()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${l.rank}.`),u!=null&&_(u.rank===2||u.rank===1,()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${u.rank}.`),d!=null&&_(d.rank===2||d.rank===1,()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${d.rank}.`),$m(i,a,l,d,u,o)}const UF=ie({batchNorm2d_:WF});function GF(n,e,t,s,r,o){const i=K(n,"x","batchNorm"),a=K(e,"mean","batchNorm"),l=K(t,"variance","batchNorm");let u;r!=null&&(u=K(r,"scale","batchNorm"));let d;return s!=null&&(d=K(s,"offset","batchNorm")),_(i.rank===3,()=>`Error in batchNorm3D: x must be rank 3 but got rank ${i.rank}.`),_(a.rank===3||a.rank===1,()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${a.rank}.`),_(l.rank===3||l.rank===1,()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${l.rank}.`),u!=null&&_(u.rank===3||u.rank===1,()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${u.rank}.`),d!=null&&_(d.rank===3||d.rank===1,()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${d.rank}.`),$m(i,a,l,d,u,o)}const HF=ie({batchNorm3d_:GF});function qF(n,e,t,s,r,o){const i=K(n,"x","batchNorm"),a=K(e,"mean","batchNorm"),l=K(t,"variance","batchNorm");let u;r!=null&&(u=K(r,"scale","batchNorm"));let d;return s!=null&&(d=K(s,"offset","batchNorm")),_(i.rank===4,()=>`Error in batchNorm4D: x must be rank 4 but got rank ${i.rank}.`),_(a.rank===4||a.rank===1,()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${a.rank}.`),_(l.rank===4||l.rank===1,()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${l.rank}.`),u!=null&&_(u.rank===4||u.rank===1,()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${u.rank}.`),d!=null&&_(d.rank===4||d.rank===1,()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${d.rank}.`),$m(i,a,l,d,u,o)}const KF=ie({batchNorm4d_:qF});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XF(n,e,t){const s=K(n,"x","bincount"),r=K(e,"weights","bincount");_(s.dtype==="int32",()=>`Error in bincount: input dtype must be int32, but got ${s.dtype}`),_(t>=0,()=>`size must be non-negative, but got ${t}.`),_(r.size===s.size||r.size===0,()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${s.shape}, weights shape: ${r.shape}.`);const o={x:s,weights:r},i={size:t};return se.runKernel(Ly,o,i)}const QF=ie({bincount_:XF});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YF(n,e){let t=K(n,"broadcastTo","x");const s=t.shape;if(Io(e),e.length<t.rank)throw new Error(`broadcastTo(): shape.length=${e.length} < input.rank=${t.rank}.`);if(e.length>t.rank){const u=t.shape.slice();for(;u.length<e.length;)u.unshift(1);t=re(t,u)}const r=t.shape,o=Array.from(e);for(let u=e.length-1;u>=0;u--)if(r[u]===e[u])o[u]=1;else if(t.shape[u]!==1)throw new Error(`broadcastTo(): [${s}] cannot be broadcast to [${e}].`);if(o.map((u,d)=>u>1?d:-1).filter(u=>u>=0).length===0)return Ki(t);const a={x:t},l={reps:o};return se.runKernel(bd,a,l)}const nu=ie({broadcastTo_:YF});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JF(n){const t={x:K(n,"x","ceil","float32")};return se.runKernel(Fu,t)}const ZF=ie({ceil_:JF});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tm(n,e,t){Io(n),t=t||Pl(e);const s={shape:n,value:e,dtype:t};return se.runKernel(Yy,{},s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eL(n,e,t){const s=K(n,"x","clipByValue");if(_(e<=t,()=>`Error in clip: min (${e}) must be less than or equal to max (${t}).`),e===t)return Tm(s.shape,e,s.dtype);const r={x:s},o={clipValueMin:e,clipValueMax:t};return se.runKernel(Lu,r,o)}const Us=ie({clipByValue_:eL});function tL(n){return ms(n,0)}const nL=ie({concat1d_:tL});function sL(n,e){return ms(n,e)}const rL=ie({concat2d_:sL});function oL(n,e){return ms(n,e)}const iL=ie({concat3d_:oL});function aL(n,e){return ms(n,e)}const lL=ie({concat4d_:aL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cL(n,e,t,s,r="NHWC",o=[1,1],i){const a=K(n,"x","conv2d","float32"),l=K(e,"filter","conv2d","float32");let u=a,d=!1;a.rank===3&&(d=!0,u=re(a,[1,a.shape[0],a.shape[1],a.shape[2]])),_(u.rank===4,()=>`Error in conv2d: input must be rank 4, but got rank ${u.rank}.`),_(l.rank===4,()=>`Error in conv2d: filter must be rank 4, but got rank ${l.rank}.`),vs("conv2d",s,i);const f=r==="NHWC"?u.shape[3]:u.shape[1];_(f===l.shape[2],()=>`Error in conv2d: depth of input (${f}) must match input depth for filter ${l.shape[2]}.`),_(Vn(t,o),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${t} and dilations '${o}'`),_(ra(o),()=>"Error in conv2D: Dilated rates should be larger than 0."),_(ra(t),()=>"Error in conv2D: Strides should be larger than 0.");const m={x:u,filter:l},g={strides:t,pad:s,dataFormat:r,dilations:o,dimRoundingMode:i},y=se.runKernel(Dp,m,g);return d?re(y,[y.shape[1],y.shape[2],y.shape[3]]):y}const oa=ie({conv2d_:cL});function uL(n,e,t,s,r="NWC",o=1,i){const a=K(n,"x","conv1d"),l=K(e,"filter","conv1d");let u=a,d=!1;a.rank===2&&(d=!0,u=re(a,[1,a.shape[0],a.shape[1]])),_(u.rank===3,()=>`Error in conv1d: input must be rank 3, but got rank ${u.rank}.`),_(l.rank===3,()=>`Error in conv1d: filter must be rank 3, but got rank ${l.rank}.`),vs("conv1d",s,i),_(u.shape[2]===l.shape[1],()=>`Error in conv1d: depth of input (${u.shape[2]}) must match input depth for filter ${l.shape[1]}.`),_(Vn(t,o),()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${t} and dilation '${o}'`),_(ra(o),()=>"Error in conv1D: Dilated rates should be larger than 0."),_(ra(t),()=>"Error in conv1D: Stride should be larger than 0."),_(r==="NWC",()=>`Error in conv1d: got dataFormat of ${r} but only NWC is currently supported.`);const f=re(l,[1,l.shape[0],l.shape[1],l.shape[2]]),m=re(u,[u.shape[0],1,u.shape[1],u.shape[2]]),b=oa(m,f,[1,t],s,"NHWC",[1,o],i);return d?re(b,[b.shape[2],b.shape[3]]):re(b,[b.shape[0],b.shape[2],b.shape[3]])}const eI=ie({conv1d_:uL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dL(n,e,t,s,r,o="NHWC",i){_(n.length===e.rank,()=>`Length of inShape (${n.length}) and rank of dy (${e.rank}) must match`);let a=n,l=e,u=!1;e.rank===3&&(u=!0,l=re(e,[1,e.shape[0],e.shape[1],e.shape[2]]),a=[1,n[0],n[1],n[2]]),_(a.length===4,()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${a.length}.`),_(l.rank===4,()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${l.rank}`),_(t.rank===4,()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${t.rank}`);const d=o==="NHWC"?a[3]:a[1],f=o==="NHWC"?l.shape[3]:l.shape[1];_(d===t.shape[2],()=>`Error in conv2dDerInput: depth of input (${d}) must match input depth for filter ${t.shape[2]}.`),_(f===t.shape[3],()=>`Error in conv2dDerInput: depth of output (${f}) must match output depth for filter ${t.shape[3]}.`),vs("conv2dDerInput",r,i);const m={dy:l,filter:t},g={strides:s,pad:r,dataFormat:o,dimRoundingMode:i,inputShape:a},y=se.runKernel(Mp,m,g);return u?re(y,[y.shape[1],y.shape[2],y.shape[3]]):y}const S1=ie({conv2DBackpropInput_:dL});function hL(n,e,t,s,r,o){const i=K(n,"x","conv2dTranspose"),a=K(e,"filter","conv2dTranspose");return S1(t,i,a,s,r,"NHWC",o)}const tI=ie({conv2dTranspose_:hL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fL(n,e,t,s,r="NDHWC",o=[1,1,1]){const i=K(n,"x","conv3d"),a=K(e,"filter","conv3d");let l=i,u=!1;i.rank===4&&(u=!0,l=re(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),_(l.rank===5,()=>`Error in conv3d: input must be rank 5, but got rank ${l.rank}.`),_(a.rank===5,()=>`Error in conv3d: filter must be rank 5, but got rank ${a.rank}.`),_(l.shape[4]===a.shape[3],()=>`Error in conv3d: depth of input (${l.shape[4]}) must match input depth for filter ${a.shape[3]}.`),_(Vn(t,o),()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${t} and dilations '${o}'`),_(r==="NDHWC",()=>`Error in conv3d: got dataFormat of ${r} but only NDHWC is currently supported.`),_(ra(o),()=>"Error in conv3D: Dilated rates should be larger than 0."),_(ra(t),()=>"Error in conv3D: Strides should be larger than 0.");const d={x:l,filter:a},f={strides:t,pad:s,dataFormat:r,dilations:o},m=se.runKernel(Pp,d,f);return u?re(m,[m.shape[1],m.shape[2],m.shape[3],m.shape[4]]):m}const pL=ie({conv3d_:fL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mL(n,e,t,s,r){_(n.length===e.rank,()=>`Length of inShape (${n.length}) and rank of dy (${e.rank}) must match`);let o=n,i=e,a=!1;e.rank===4&&(a=!0,i=re(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),o=[1,n[0],n[1],n[2],n[3]]);const l=o[4],u=i.shape[4];_(o.length===5,()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${o.length}.`),_(i.rank===5,()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${i.rank}`),_(t.rank===5,()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${t.rank}`),_(l===t.shape[3],()=>`Error in conv3dDerInput: depth of input (${l}) must match input depth for filter ${t.shape[3]}.`),_(u===t.shape[4],()=>`Error in conv3dDerInput: depth of output (${u}) must match output depth for filter ${t.shape[4]}.`);const d={dy:i,filter:t},f={pad:r,strides:s,inputShape:o},m=se.runKernel(By,d,f);return a?re(m,[m.shape[1],m.shape[2],m.shape[3],m.shape[4]]):m}const nI=ie({conv3DBackpropInput_:mL});function gL(n,e,t,s,r){const o=K(n,"x","conv3dTranspose"),i=K(e,"filter","conv3dTranspose");return nI(t,o,i,s,r)}const xL=ie({conv3dTranspose_:gL});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yL(n){const t={x:K(n,"x","cos","float32")};return se.runKernel(ju,t)}const N1=ie({cos_:yL});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vL(n){const t={x:K(n,"x","cosh","float32")};return se.runKernel(Ou,t)}const sI=ie({cosh_:vL});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bL(n,e=0,t=!1,s=!1){const o={x:K(n,"x","cumprod")},i={axis:e,exclusive:t,reverse:s};return se.runKernel(Vy,o,i)}const X0=ie({cumprod_:bL});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wL(n,e=0,t=!1,s=!1){const o={x:K(n,"x","cumsum")},i={axis:e,exclusive:t,reverse:s};return se.runKernel(Fp,o,i)}const rI=ie({cumsum_:wL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kL(n,e,t,s=!1){const r=K(n,"x","denseBincount"),o=K(e,"weights","denseBincount");_(r.dtype==="int32",()=>`Error in denseBincount: input dtype must be int32, but got ${r.dtype}`),_(r.rank<=2,()=>`Error in denseBincount: input must be at most rank 2, but got rank ${r.rank}.`),_(t>=0,()=>`size must be non-negative, but got ${t}.`),_(o.size===r.size||o.size===0,()=>`Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ${r.shape}, weights shape: ${o.shape}.`);const i={x:r,weights:o},a={size:t,binaryOutput:s};return se.runKernel(Uy,i,a)}const M2=ie({denseBincount_:kL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CL(n,e,t="NHWC"){const s=K(n,"x","depthToSpace","float32"),r=t==="NHWC"?s.shape[1]:s.shape[2],o=t==="NHWC"?s.shape[2]:s.shape[3],i=t==="NHWC"?s.shape[3]:s.shape[1];_(e>1,()=>`blockSize should be > 1 for depthToSpace, but was: ${e}`),_(r*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${r} and ${e}  for depthToSpace with input shape
    ${s.shape}`),_(o*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${o} and ${e} for depthToSpace with input shape
        ${s.shape}`),_(i%(e*e)===0,()=>`Dimension size must be evenly divisible by ${e*e} but is ${i} for depthToSpace with input shape ${s.shape}`);const a={x:s},l={blockSize:e,dataFormat:t};return se.runKernel(Gy,a,l)}const SL=ie({depthToSpace_:CL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NL(n,e,t,s,r="NHWC",o=[1,1],i){const a=K(n,"x","depthwiseConv2d","float32"),l=K(e,"filter","depthwiseConv2d","float32");let u=a,d=!1;a.rank===3&&(d=!0,u=re(a,[1,a.shape[0],a.shape[1],a.shape[2]])),_(u.rank===4,()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${u.rank}.`),_(l.rank===4,()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${l.rank}.`);const f=r==="NHWC"?u.shape[3]:u.shape[1];_(f===l.shape[2],()=>`Error in depthwiseConv2d: number of input channels (${f}) must match the inChannels dimension in filter ${l.shape[2]}.`),vs("depthwiseConv2d",s,i);const m={x:u,filter:l},g={strides:t,pad:s,dataFormat:r,dilations:o,dimRoundingMode:i},y=se.runKernel(Lp,m,g);return d?re(y,[y.shape[1],y.shape[2],y.shape[3]]):y}const I1=ie({depthwiseConv2d_:NL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IL(n,e,t,s,r=[1,1],o="NHWC"){const i=K(n,"x","dilation2d"),a=K(e,"filter","dilation2d");_(i.rank===3||i.rank===4,()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${i.rank}.`),_(a.rank===3,()=>`Error in dilation2d: filter must be rank 3, but got rank ${a.rank}.`),_(o==="NHWC",()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${o}`);let l=i,u=!1;i.rank===3&&(l=re(i,[1,i.shape[0],i.shape[1],i.shape[2]]),u=!0),_(l.shape[3]===a.shape[2],()=>`Error in dilation2d:  input and filter must have the same depth: ${l.shape[3]} vs ${a.shape[2]}`);const d={x:l,filter:a},f={strides:t,pad:s,dilations:r},m=se.runKernel(jp,d,f);return u?re(m,[m.shape[1],m.shape[2],m.shape[3]]):m}const $L=ie({dilation2d_:IL});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kl(n,e){const t=n.length,s=[];for(let r=0;r<t;r++){const o=t-1-r,i=n[o]||1;(e[e.length-1-r]||1)>1&&i===1&&s.unshift(o)}return s}function mn(n,e){const t=[];for(let s=0;s<e.length;s++){const r=n[n.length-s-1],o=e.length-s-1,i=e[o];(r==null||r===1&&i>1)&&t.unshift(o)}return t}function Ze(n,e){const t=Math.max(n.length,e.length),s=new Array(t);for(let r=0;r<t;r++){let o=n[n.length-r-1];o==null&&(o=1);let i=e[e.length-r-1];if(i==null&&(i=1),o===1)s[t-r-1]=i;else if(i===1)s[t-r-1]=o;else if(o!==i){const a=`Operands could not be broadcast together with shapes ${n} and ${e}.`;throw Error(a)}else s[t-r-1]=o}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TL(n,e){let t=K(n,"a","equal","string_or_numeric"),s=K(e,"b","equal","string_or_numeric");[t,s]=Jt(t,s),Ze(t.shape,s.shape);const r={a:t,b:s};return se.runKernel(Op,r)}const Zr=ie({equal_:TL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EL(n,e,t){const s=K(e,"a","where"),r=K(t,"b","where"),o=K(n,"condition","where","bool"),i=Ze(Ze(o.shape,s.shape),r.shape),a=nu(o,i),l=nu(s,i),u=nu(r,i),d={condition:a,t:l,e:u};return se.runKernel(pm,d)}const ss=ie({where_:EL});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RL(n){const t={x:K(n,"x","zerosLike")};return se.runKernel(km,t)}const ut=ie({zerosLike_:RL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AL(n,e){let t=K(n,"a","div"),s=K(e,"b","div");[t,s]=Jt(t,s);const r=Ge(t,s),o=ut(r),i=Zr(s,o);return ss(i,o,r)}const DL=ie({divNoNan_:AL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ML(n,e){const t=K(n,"t1","dot"),s=K(e,"t2","dot");_((t.rank===1||t.rank===2)&&(s.rank===1||s.rank===2),()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${t.rank} and ${s.rank}.`);const r=t.rank===1?t.size:t.shape[1],o=s.rank===1?s.size:s.shape[0];if(_(r===o,()=>`Error in dot: inner dimensions of inputs must match, but got ${r} and ${o}.`),t.rank===1&&s.rank===1){const i=re(t,[1,-1]),a=re(s,[-1,1]),l=mt(i,a);return re(l,[])}else if(t.rank===1&&s.rank===2){const i=re(t,[1,-1]),a=re(s,[s.shape[0],s.shape[1]]),l=mt(i,a);return re(l,[l.size])}else if(t.rank===2&&s.rank===1){const i=re(s,[-1,1]),a=mt(t,i);return re(a,[a.size])}else{const i=re(s,[s.shape[0],s.shape[1]]);return mt(t,i)}}const PL=ie({dot_:ML});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FL(n,...e){const t=e.map((r,o)=>K(r,`tensors${o}`,"einsum")),s={equation:n};return se.runKernel(Ky,t,s)}const Bc=ie({einsum_:FL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LL(n){const t={x:K(n,"x","elu","float32")};return se.runKernel(zu,t)}const Em=ie({elu_:LL});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jL(n){let e=K(n,"x","erf");_(e.dtype==="int32"||e.dtype==="float32",()=>"Input dtype must be `int32` or `float32`."),e.dtype==="int32"&&(e=Ae(e,"float32"));const t={x:e};return se.runKernel(Bu,t)}const oI=ie({erf_:jL});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $1(n,e){for(let t=0;t<n.length;++t)if(n[n.length-t-1]!==e-1-t)return!1;return!0}function iI(n,e,t){const s=n.length+e.length,r=[];let o=0,i=0;for(let a=0;a<s;a++)t.indexOf(a)===-1?r.push(n[o++]):r.push(e[i++]);return r}function Sn(n,e){const t=[],s=n.length;for(let o=0;o<s;o++)e.indexOf(o)===-1&&t.push(n[o]);const r=e.map(o=>n[o]);return[t,r]}function an(n,e){const t=e.map(s=>1);return iI(n,t,e)}function Dn(n,e,t){_($1(e,t),()=>`${n} supports only inner-most axes for now. Got axes ${e} and rank-${t} input.`)}function Bt(n,e){if($1(n,e))return null;const t=[];for(let s=0;s<e;++s)n.indexOf(s)===-1&&t.push(s);return n.forEach(s=>t.push(s)),t}function xi(n){return n.map((e,t)=>[t,e]).sort((e,t)=>e[1]-t[1]).map(e=>e[0])}function Zt(n,e){const t=[];for(let s=e-n;s<e;++s)t.push(s);return t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OL(n,e=null,t=!1){const r={x:K(n,"x","max")},o={reductionIndices:e,keepDims:t};return se.runKernel(Qp,r,o)}const Er=ie({max_:OL});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _L(n,e=null,t=!1){const r={x:K(n,"x","min")},o={axis:e,keepDims:t};return se.runKernel(em,r,o)}const Wf=ie({min_:_L});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zL(n,e){let t=K(n,"base","pow"),s=K(e,"exp","pow");[t,s]=Jt(t,s);const r={a:t,b:s};return se.runKernel(sd,r)}const ia=ie({pow_:zL});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gt(n,e){if((lr(n)&&e!=="string"||Array.isArray(n))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&lr(n)&&!(n instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return Nm(n,[],[],e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BL(n){const t={x:K(n,"x","sqrt","float32")};return se.runKernel(md,t)}const Bn=ie({sqrt_:BL});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VL(n){const e=K(n,"x","square"),t={};return se.runKernel("Square",{x:e},t)}const Rt=ie({square_:VL});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WL(n,e=null,t=!1){let s=K(n,"x","sum");s.dtype==="bool"&&(s=Ae(s,"int32"));const r={x:s},o={axis:e,keepDims:t};return se.runKernel(gm,r,o)}const We=ie({sum_:WL});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UL(n,e="euclidean",t=null,s=!1){n=K(n,"x","norm");const r=aI(n,e,t);let o=r.shape;if(s){const i=rt(t,n.shape);o=an(r.shape,i)}return re(r,o)}function aI(n,e,t=null){if(n.rank===0)return es(n);if(n.rank!==1&&t===null)return aI(re(n,[-1]),e,t);if(n.rank===1||typeof t=="number"||Array.isArray(t)&&t.length===1){if(e===1)return We(es(n),t);if(e===1/0)return Er(es(n),t);if(e===-1/0)return Wf(es(n),t);if(e==="euclidean"||e===2)return Bn(We(ia(es(n),gt(2,"int32")),t));throw new Error(`Error in norm: invalid ord value: ${e}`)}if(Array.isArray(t)&&t.length===2){if(e===1)return Er(We(es(n),t[0]),t[1]-1);if(e===1/0)return Er(We(es(n),t[1]),t[0]);if(e===-1/0)return Wf(We(es(n),t[1]),t[0]);if(e==="fro"||e==="euclidean")return Bn(We(Rt(n),t));throw new Error(`Error in norm: invalid ord value: ${e}`)}throw new Error(`Error in norm: invalid axis: ${t}`)}const Rm=ie({norm_:UL});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GL(n,e=null,t=!1){return Rm(n,"euclidean",e,t)}const HL=ie({euclideanNorm_:GL});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qL(n){const t={x:K(n,"x","exp")};return se.runKernel(Vu,t)}const eo=ie({exp_:qL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KL(n,e=0){const t=K(n,"x","expandDims","string_or_numeric");_(e<=t.rank,()=>"Axis must be <= rank of the tensor");const s={input:t},r={dim:e};return se.runKernel(_p,s,r)}const hs=ie({expandDims_:KL});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XL(n){const t={x:K(n,"x","expm1")};return se.runKernel(Wu,t)}const QL=ie({expm1_:XL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YL(n,e){const t=K(n,"x","tile","string_or_numeric");_(t.rank===e.length,()=>`Error in transpose: rank of input ${t.rank} must match length of reps ${e}.`);const s={x:t},r={reps:e};return se.runKernel(bd,s,r)}const $r=ie({tile_:YL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JL(n,e,t,s="float32"){e==null&&(e=n);const r=st([n,e],s),o=n<=e?n:e;for(let a=0;a<o;++a)r.set(1,a,a);const i=re(r.toTensor(),[n,e]);if(t==null)return i;if(t.length===1)return $r(hs(i,0),[t[0],1,1]);if(t.length===2)return $r(hs(hs(i,0),0),[t[0],t[1],1,1]);if(t.length===3)return $r(hs(hs(hs(i,0),0),0),[t[0],t[1],t[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${t.length}D.`)}const lI=ie({eye_:JL});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZL(n){const t={x:K(n,"x","floor","float32")};return se.runKernel(Uu,t)}const Am=ie({floor_:ZL});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ej(n,e,t=0,s=0){const r=K(n,"x","gather"),o=K(e,"indices","gather","int32"),i={x:r,indices:o},a={axis:t,batchDims:s};return se.runKernel(Bp,i,a)}const T1=ie({gather_:ej});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tj(n,e){let t=K(n,"a","greater","string_or_numeric"),s=K(e,"b","greater","string_or_numeric");[t,s]=Jt(t,s),Ze(t.shape,s.shape);const r={a:t,b:s};return se.runKernel(Vp,r)}const Gs=ie({greater_:tj});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nj(n,e){let t=K(n,"a","greaterEqual","string_or_numeric"),s=K(e,"b","greaterEqual","string_or_numeric");[t,s]=Jt(t,s),Ze(t.shape,s.shape);const r={a:t,b:s};return se.runKernel(Hu,r)}const xa=ie({greaterEqual_:nj});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sj(n){const t={input:K(n,"input","imag")};return se.runKernel(e1,t)}const E1=ie({imag_:sj});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rj(n){const t={x:K(n,"x","isFinite")};return se.runKernel(Ku,t)}const oj=ie({isFinite_:rj});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ij(n){const t={x:K(n,"x","isInf")};return se.runKernel(Xu,t)}const aj=ie({isInf_:ij});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lj(n){const t={x:K(n,"x","isNaN")};return se.runKernel(Qu,t)}const cj=ie({isNaN_:lj});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uj(n,e=.2){const s={x:K(n,"x","leakyRelu")},r={alpha:e};return se.runKernel(Wp,s,r)}const R1=ie({leakyRelu_:uj});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dj(n,e){let t=K(n,"a","less","string_or_numeric"),s=K(e,"b","less","string_or_numeric");[t,s]=Jt(t,s),Ze(t.shape,s.shape);const r={a:t,b:s};return se.runKernel(Up,r)}const Uf=ie({less_:dj});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hj(n,e){let t=K(n,"a","lessEqual","string_or_numeric"),s=K(e,"b","lessEqual","string_or_numeric");[t,s]=Jt(t,s),Ze(t.shape,s.shape);const r={a:t,b:s};return se.runKernel(Gp,r)}const Ol=ie({lessEqual_:hj});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fj(n,e=5,t=1,s=1,r=.5){const o=K(n,"x","localResponseNormalization");_(o.rank===4||o.rank===3,()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank ${o.rank}.`),_(vl(e),()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${e}.`);let i=o,a=!1;o.rank===3&&(a=!0,i=re(o,[1,o.shape[0],o.shape[1],o.shape[2]]));const l={x:i},u={depthRadius:e,bias:t,alpha:s,beta:r},d=se.runKernel(Xp,l,u);return a?re(d,[d.shape[1],d.shape[2],d.shape[3]]):d}const pj=ie({localResponseNormalization_:fj});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mj(n){const t={x:K(n,"x","log","float32")};return se.runKernel(Yu,t)}const to=ie({log_:mj});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gj(n){const t={x:K(n,"x","log1p")};return se.runKernel(Ju,t)}const cI=ie({log1p_:gj});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xj(n,e){_(P0(n),()=>"The f passed in variableGrads(f) must be a function"),_(e==null||Array.isArray(e)&&e.every(u=>u instanceof Bf),()=>"The varList passed in variableGrads(f, varList) must be an array of variables");const t=e!=null;if(!t){e=[];for(const u in se.registeredVariables)e.push(se.registeredVariables[u])}const s=t?e.filter(u=>!u.trainable):null,r=e.length;e=e.filter(u=>u.trainable),_(e.length>0,()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${r} variables is trainable.`);const o=!0,{value:i,grads:a}=se.gradients(n,e,null,o);_(a.some(u=>u!=null),()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),_(i.rank===0,()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${i.rank} tensor`);const l={};return e.forEach((u,d)=>{a[d]!=null&&(l[u.name]=a[d])}),s!=null&&s.forEach(u=>l[u.name]=null),{value:i,grads:l}}function Cl(n){return se.customGrad(n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yj(n){const t={x:K(n,"x","neg")};return se.runKernel(nm,t)}const Yt=ie({neg_:yj});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vj(n){const t={x:K(n,"x","softplus")};return se.runKernel(pd,t)}const Cd=ie({softplus_:vj});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bj(n){const e=K(n,"x","logSigmoid");return Cl(s=>({value:Yt(Cd(Yt(s))),gradFunc:i=>te(i,jl(Yt(s)))}))(e)}const wj=ie({logSigmoid_:bj});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kj(n,e){let t=K(n,"a","sub"),s=K(e,"b","sub");[t,s]=Jt(t,s);const r={a:t,b:s};return se.runKernel(xd,r)}const Ke=ie({sub_:kj});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cj(n,e=-1){const t=K(n,"logits","logSoftmax");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${t.rank} and axis was ${e}`);return Cl((r,o)=>{const a=Er(r,e,!0),l=Ke(r,a),u=Ke(Ae(l,"float32"),to(We(eo(l),e,!0)));return o([u]),{value:u,gradFunc:(f,m)=>{const[g]=m,y=!0,w=eo(g);return Ke(f,te(We(f,e,y),w))}}})(t)}const uI=ie({logSoftmax_:Cj});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sj(n,e=null,t=!1){const s=K(n,"x","logSumExp"),r=rt(e,s.shape),o=Er(s,r,!0),i=Ke(s,o),a=eo(i),l=We(a,r),u=to(l),d=Ie(re(o,u.shape),u);if(t){const f=an(d.shape,r);return re(d,f)}return d}const dI=ie({logSumExp_:Sj});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nj(n,e){const t=K(n,"a","logicalAnd","bool"),s=K(e,"b","logicalAnd","bool");Ze(t.shape,s.shape);const r={a:t,b:s};return se.runKernel(Hp,r)}const ko=ie({logicalAnd_:Nj});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ij(n){const t={x:K(n,"x","logicalNot","bool")};return se.runKernel(qp,t)}const A1=ie({logicalNot_:Ij});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $j(n,e){const t=K(n,"a","logicalOr","bool"),s=K(e,"b","logicalOr","bool");Ze(t.shape,s.shape);const r={a:t,b:s};return se.runKernel(Kp,r)}const hI=ie({logicalOr_:$j});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tj(n,e){const t=K(n,"a","logicalXor","bool"),s=K(e,"b","logicalXor","bool");return Ze(t.shape,s.shape),ko(hI(n,e),A1(ko(n,e)))}const Ej=ie({logicalXor_:Tj});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rj(n,e,t,s,r){const o=K(n,"x","maxPool"),i=1;let a=o,l=!1;o.rank===3&&(l=!0,a=re(o,[1,o.shape[0],o.shape[1],o.shape[2]])),_(a.rank===4,()=>`Error in maxPool: input must be rank 4 but got rank ${a.rank}.`),_(Vn(t,i),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${t} and dilations '${i}'`),vs("maxPool",s,r);const u={x:a},d={filterSize:e,strides:t,pad:s,dimRoundingMode:r},f=se.runKernel(Yp,u,d);return l?re(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const D1=ie({maxPool_:Rj});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Aj(n,e=[1,1,1],t,s,r,o="NDHWC"){const i=K(n,"x","maxPool3d");let a=i,l=!1;i.rank===4&&(l=!0,a=re(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),_(a.rank===5,()=>`Error in maxPool3d: x must be rank 5 but got rank ${a.rank}.`),_(o==="NDHWC",()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${o}`),vs("maxPool3d",s,r);const u={x:a},d={filterSize:e,strides:t,pad:s,dimRoundingMode:r,dataFormat:o},f=se.runKernel(Jp,u,d);return l?re(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}const Dj=ie({maxPool3d_:Aj});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mj(n,e){let t=K(n,"a","maximum"),s=K(e,"b","maximum");[t,s]=Jt(t,s),t.dtype==="bool"&&(t=Ae(t,"int32"),s=Ae(s,"int32")),Ze(t.shape,s.shape);const r={a:t,b:s};return se.runKernel(Zu,r)}const yi=ie({maximum_:Mj});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pj(n,e=null,t=!1){const r={x:K(n,"x","mean")},o={axis:e,keepDims:t};return se.runKernel(Zp,r,o)}const rn=ie({mean_:Pj});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kn(n,e="float32"){if(Io(n),e==="complex64"){const s=kn(n,"float32"),r=kn(n,"float32");return ea(s,r)}const t=zn(pe(n),e);return se.makeTensor(t,n,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vi(n,e="float32"){if(Io(n),e==="complex64"){const s=vi(n,"float32"),r=kn(n,"float32");return ea(s,r)}const t=Ty(pe(n),e);return se.makeTensor(t,n,e)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fj(n,e){let t=K(n,"a","minimum"),s=K(e,"b","minimum");[t,s]=Jt(t,s),t.dtype==="bool"&&(t=Ae(t,"int32"),s=Ae(s,"int32")),Ze(t.shape,s.shape);const r={a:t,b:s};return se.runKernel(ed,r)}const hu=ie({minimum_:Fj});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lj(n,e,t){_(t==="reflect"||t==="symmetric",()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${t}.`);const s=K(n,"x","mirrorPad");if(s.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");_(e.length===s.rank,()=>`Padding doesn't match input. Must be ${s.rank}. Got ${e.length}.`);const r=t==="reflect"?1:0;for(let a=0;a<s.rank;a++)_(e[a].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),_(e[a][0]>=0&&e[a][0]<=s.shape[a]-r&&e[a][1]>=0&&e[a][1]<=s.shape[a]-r,()=>`Padding in dimension ${a} cannot be greater than or equal to ${s.shape[a]-r} or less than 0 for input of shape ${s.shape}`);const o={paddings:e,mode:t},i={x:s};return se.runKernel(tm,i,o)}const jj=ie({mirrorPad_:Lj});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Oj(n,e){let t=K(n,"a","mod"),s=K(e,"b","mod");[t,s]=Jt(t,s);const r={a:t,b:s};return se.runKernel(td,r)}const _j=ie({mod_:Oj});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zj(n,e=null,t=!1){n=K(n,"x","moments");const s=rt(e,n.shape),r=rn(n,s,t);let o=r.shape;t||(o=an(r.shape,s));const i=Rt(Ke(Ae(n,"float32"),re(r,o))),a=rn(i,s,t);return{mean:r,variance:a}}const M1=ie({moments_:zj});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bj(n,e){let t=K(n,"a","notEqual","string_or_numeric"),s=K(e,"b","notEqual","string_or_numeric");[t,s]=Jt(t,s),Ze(t.shape,s.shape);const r={a:t,b:s};return se.runKernel(sm,r)}const Gf=ie({notEqual_:Bj});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vj(n,e,t=1,s=0,r="int32"){if(e<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${e}`);const i={indices:K(n,"indices","oneHot","int32")},a={dtype:r,depth:e,onValue:t,offValue:s};return se.runKernel(om,i,a)}const fI=ie({oneHot_:Vj});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wj(n){const t={x:K(n,"x","onesLike")};return se.runKernel(rm,t)}const cr=ie({onesLike_:Wj});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uj(n,e,t=0){const s=K(n,"x","pad");if(s.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");const r={paddings:e,constantValue:t},o={x:s};return se.runKernel(am,o,r)}const P1=ie({pad_:Uj});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gj(n,e,t){const s=K(n,"x","spaceToBatchND");_(s.rank>=1+e.length,()=>`input rank ${s.rank} should be > than [blockShape] ${e.length}`),_(t.length===e.length,()=>`paddings.shape[0] ${t.length} must be equal to [blockShape] ${e.length}`),_(s.shape.reduce((i,a,l)=>l>0&&l<=e.length?i&&(a+t[l-1][0]+t[l-1][1])%e[l-1]===0:i,!0),()=>`input spatial dimensions ${s.shape.slice(1)} with paddings ${t.toString()} must be divisible by blockShapes ${e.toString()}`);const r={x:s},o={blockShape:e,paddings:t};return se.runKernel(xm,r,o)}const F1=ie({spaceToBatchND_:Gj});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hj(n,e,t,s,r,o,i){r==null&&(r=[1,1]),o==null&&(o=1),s===0&&(s="valid");const a=K(n,"x","maxPool");let l=a,u=!1;a.rank===3&&(u=!0,l=re(a,[1,a.shape[0],a.shape[1],a.shape[2]])),_(Vn(o,r),()=>`Error in pool: Either strides or dilations must be 1. Got strides ${o} and dilations '${r}'`);const d=ur(l.shape,e,o,r,s),f=[d.dilationHeight,d.dilationWidth];let m;s==="same"?m=Kj([d.filterHeight,d.filterWidth],f):m=[[0,0],[0,0]];const g=f[0]===1&&f[1]===1,[y,w]=qj([d.inHeight,d.inWidth],f,m),b=g?s:"valid",k=g?l:F1(l,f,y),N=(t==="avg"?()=>k1(k,e,o,b,i):()=>D1(k,e,o,b,i))(),S=g?N:C1(N,f,w);return u?re(S,[S.shape[1],S.shape[2],S.shape[3]]):S}function qj(n,e,t){const s=t.map(d=>d[0]),r=t.map(d=>d[1]),o=n.concat(s,r),i=e.map((d,f)=>(d-o[f]%d)%d),a=r.map((d,f)=>d+i[f]),l=e.map((d,f)=>[s[f],a[f]]),u=e.map((d,f)=>[0,i[f]]);return[l,u]}function Kj(n,e){const s=n.map((i,a)=>i+(i-1)*(e[a]-1)).map(i=>i-1),r=s.map(i=>Math.floor(i/2)),o=s.map((i,a)=>i-r[a]);return s.map((i,a)=>[r[a],o[a]])}const Xj=ie({pool_:Hj});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qj(n,e){const t=K(n,"x","prelu"),s=K(e,"alpha","prelu"),r={x:t,alpha:s};return se.runKernel(lm,r)}const L1=ie({prelu_:Qj});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yj(n,e=null,t=!1){let s=K(n,"x","prod");s.dtype==="bool"&&(s=Ae(s,"int32"));const r={x:s},o={axis:e,keepDims:t};return se.runKernel(cm,r,o)}const Jj=ie({prod_:Yj});var Cf={exports:{}},Zj=Cf.exports,P2;function eO(){return P2||(P2=1,(function(n){(function(e,t,s){function r(l){var u=this,d=a();u.next=function(){var f=2091639*u.s0+u.c*23283064365386963e-26;return u.s0=u.s1,u.s1=u.s2,u.s2=f-(u.c=f|0)},u.c=1,u.s0=d(" "),u.s1=d(" "),u.s2=d(" "),u.s0-=d(l),u.s0<0&&(u.s0+=1),u.s1-=d(l),u.s1<0&&(u.s1+=1),u.s2-=d(l),u.s2<0&&(u.s2+=1),d=null}function o(l,u){return u.c=l.c,u.s0=l.s0,u.s1=l.s1,u.s2=l.s2,u}function i(l,u){var d=new r(l),f=u&&u.state,m=d.next;return m.int32=function(){return d.next()*4294967296|0},m.double=function(){return m()+(m()*2097152|0)*11102230246251565e-32},m.quick=m,f&&(typeof f=="object"&&o(f,d),m.state=function(){return o(d,{})}),m}function a(){var l=4022871197,u=function(d){d=String(d);for(var f=0;f<d.length;f++){l+=d.charCodeAt(f);var m=.02519603282416938*l;l=m>>>0,m-=l,m*=l,l=m>>>0,m-=l,l+=m*4294967296}return(l>>>0)*23283064365386963e-26};return u}t&&t.exports?t.exports=i:this.alea=i})(Zj,n)})(Cf)),Cf.exports}var Sf={exports:{}},tO=Sf.exports,F2;function nO(){return F2||(F2=1,(function(n){(function(e,t,s){function r(a){var l=this,u="";l.x=0,l.y=0,l.z=0,l.w=0,l.next=function(){var f=l.x^l.x<<11;return l.x=l.y,l.y=l.z,l.z=l.w,l.w^=l.w>>>19^f^f>>>8},a===(a|0)?l.x=a:u+=a;for(var d=0;d<u.length+64;d++)l.x^=u.charCodeAt(d)|0,l.next()}function o(a,l){return l.x=a.x,l.y=a.y,l.z=a.z,l.w=a.w,l}function i(a,l){var u=new r(a),d=l&&l.state,f=function(){return(u.next()>>>0)/4294967296};return f.double=function(){do var m=u.next()>>>11,g=(u.next()>>>0)/4294967296,y=(m+g)/(1<<21);while(y===0);return y},f.int32=u.next,f.quick=f,d&&(typeof d=="object"&&o(d,u),f.state=function(){return o(u,{})}),f}t&&t.exports?t.exports=i:this.xor128=i})(tO,n)})(Sf)),Sf.exports}var Nf={exports:{}},sO=Nf.exports,L2;function rO(){return L2||(L2=1,(function(n){(function(e,t,s){function r(a){var l=this,u="";l.next=function(){var f=l.x^l.x>>>2;return l.x=l.y,l.y=l.z,l.z=l.w,l.w=l.v,(l.d=l.d+362437|0)+(l.v=l.v^l.v<<4^(f^f<<1))|0},l.x=0,l.y=0,l.z=0,l.w=0,l.v=0,a===(a|0)?l.x=a:u+=a;for(var d=0;d<u.length+64;d++)l.x^=u.charCodeAt(d)|0,d==u.length&&(l.d=l.x<<10^l.x>>>4),l.next()}function o(a,l){return l.x=a.x,l.y=a.y,l.z=a.z,l.w=a.w,l.v=a.v,l.d=a.d,l}function i(a,l){var u=new r(a),d=l&&l.state,f=function(){return(u.next()>>>0)/4294967296};return f.double=function(){do var m=u.next()>>>11,g=(u.next()>>>0)/4294967296,y=(m+g)/(1<<21);while(y===0);return y},f.int32=u.next,f.quick=f,d&&(typeof d=="object"&&o(d,u),f.state=function(){return o(u,{})}),f}t&&t.exports?t.exports=i:this.xorwow=i})(sO,n)})(Nf)),Nf.exports}var If={exports:{}},oO=If.exports,j2;function iO(){return j2||(j2=1,(function(n){(function(e,t,s){function r(a){var l=this;l.next=function(){var d=l.x,f=l.i,m,g;return m=d[f],m^=m>>>7,g=m^m<<24,m=d[f+1&7],g^=m^m>>>10,m=d[f+3&7],g^=m^m>>>3,m=d[f+4&7],g^=m^m<<7,m=d[f+7&7],m=m^m<<13,g^=m^m<<9,d[f]=g,l.i=f+1&7,g};function u(d,f){var m,g=[];if(f===(f|0))g[0]=f;else for(f=""+f,m=0;m<f.length;++m)g[m&7]=g[m&7]<<15^f.charCodeAt(m)+g[m+1&7]<<13;for(;g.length<8;)g.push(0);for(m=0;m<8&&g[m]===0;++m);for(m==8?g[7]=-1:g[m],d.x=g,d.i=0,m=256;m>0;--m)d.next()}u(l,a)}function o(a,l){return l.x=a.x.slice(),l.i=a.i,l}function i(a,l){a==null&&(a=+new Date);var u=new r(a),d=l&&l.state,f=function(){return(u.next()>>>0)/4294967296};return f.double=function(){do var m=u.next()>>>11,g=(u.next()>>>0)/4294967296,y=(m+g)/(1<<21);while(y===0);return y},f.int32=u.next,f.quick=f,d&&(d.x&&o(d,u),f.state=function(){return o(u,{})}),f}t&&t.exports?t.exports=i:this.xorshift7=i})(oO,n)})(If)),If.exports}var $f={exports:{}},aO=$f.exports,O2;function lO(){return O2||(O2=1,(function(n){(function(e,t,s){function r(a){var l=this;l.next=function(){var d=l.w,f=l.X,m=l.i,g,y;return l.w=d=d+1640531527|0,y=f[m+34&127],g=f[m=m+1&127],y^=y<<13,g^=g<<17,y^=y>>>15,g^=g>>>12,y=f[m]=y^g,l.i=m,y+(d^d>>>16)|0};function u(d,f){var m,g,y,w,b,k=[],v=128;for(f===(f|0)?(g=f,f=null):(f=f+"\0",g=0,v=Math.max(v,f.length)),y=0,w=-32;w<v;++w)f&&(g^=f.charCodeAt((w+32)%f.length)),w===0&&(b=g),g^=g<<10,g^=g>>>15,g^=g<<4,g^=g>>>13,w>=0&&(b=b+1640531527|0,m=k[w&127]^=g+b,y=m==0?y+1:0);for(y>=128&&(k[(f&&f.length||0)&127]=-1),y=127,w=512;w>0;--w)g=k[y+34&127],m=k[y=y+1&127],g^=g<<13,m^=m<<17,g^=g>>>15,m^=m>>>12,k[y]=g^m;d.w=b,d.X=k,d.i=y}u(l,a)}function o(a,l){return l.i=a.i,l.w=a.w,l.X=a.X.slice(),l}function i(a,l){a==null&&(a=+new Date);var u=new r(a),d=l&&l.state,f=function(){return(u.next()>>>0)/4294967296};return f.double=function(){do var m=u.next()>>>11,g=(u.next()>>>0)/4294967296,y=(m+g)/(1<<21);while(y===0);return y},f.int32=u.next,f.quick=f,d&&(d.X&&o(d,u),f.state=function(){return o(u,{})}),f}t&&t.exports?t.exports=i:this.xor4096=i})(aO,n)})($f)),$f.exports}var Tf={exports:{}},cO=Tf.exports,_2;function uO(){return _2||(_2=1,(function(n){(function(e,t,s){function r(a){var l=this,u="";l.next=function(){var f=l.b,m=l.c,g=l.d,y=l.a;return f=f<<25^f>>>7^m,m=m-g|0,g=g<<24^g>>>8^y,y=y-f|0,l.b=f=f<<20^f>>>12^m,l.c=m=m-g|0,l.d=g<<16^m>>>16^y,l.a=y-f|0},l.a=0,l.b=0,l.c=-1640531527,l.d=1367130551,a===Math.floor(a)?(l.a=a/4294967296|0,l.b=a|0):u+=a;for(var d=0;d<u.length+20;d++)l.b^=u.charCodeAt(d)|0,l.next()}function o(a,l){return l.a=a.a,l.b=a.b,l.c=a.c,l.d=a.d,l}function i(a,l){var u=new r(a),d=l&&l.state,f=function(){return(u.next()>>>0)/4294967296};return f.double=function(){do var m=u.next()>>>11,g=(u.next()>>>0)/4294967296,y=(m+g)/(1<<21);while(y===0);return y},f.int32=u.next,f.quick=f,d&&(typeof d=="object"&&o(d,u),f.state=function(){return o(u,{})}),f}t&&t.exports?t.exports=i:this.tychei=i})(cO,n)})(Tf)),Tf.exports}var Ef={exports:{}};const dO={},hO=Object.freeze(Object.defineProperty({__proto__:null,default:dO},Symbol.toStringTag,{value:"Module"})),fO=g4(hO);var pO=Ef.exports,z2;function mO(){return z2||(z2=1,(function(n){(function(e,t,s){var r=256,o=6,i=52,a="random",l=s.pow(r,o),u=s.pow(2,i),d=u*2,f=r-1,m;function g(S,$,R){var M=[];$=$==!0?{entropy:!0}:$||{};var A=k(b($.entropy?[S,N(t)]:S??v(),3),M),P=new y(M),D=function(){for(var E=P.g(o),j=l,V=0;E<u;)E=(E+V)*r,j*=r,V=P.g(1);for(;E>=d;)E/=2,j/=2,V>>>=1;return(E+V)/j};return D.int32=function(){return P.g(4)|0},D.quick=function(){return P.g(4)/4294967296},D.double=D,k(N(P.S),t),($.pass||R||function(E,j,V,W){return W&&(W.S&&w(W,P),E.state=function(){return w(P,{})}),V?(s[a]=E,j):E})(D,A,"global"in $?$.global:this==s,$.state)}function y(S){var $,R=S.length,M=this,A=0,P=M.i=M.j=0,D=M.S=[];for(R||(S=[R++]);A<r;)D[A]=A++;for(A=0;A<r;A++)D[A]=D[P=f&P+S[A%R]+($=D[A])],D[P]=$;(M.g=function(E){for(var j,V=0,W=M.i,U=M.j,X=M.S;E--;)j=X[W=f&W+1],V=V*r+X[f&(X[W]=X[U=f&U+j])+(X[U]=j)];return M.i=W,M.j=U,V})(r)}function w(S,$){return $.i=S.i,$.j=S.j,$.S=S.S.slice(),$}function b(S,$){var R=[],M=typeof S,A;if($&&M=="object")for(A in S)try{R.push(b(S[A],$-1))}catch{}return R.length?R:M=="string"?S:S+"\0"}function k(S,$){for(var R=S+"",M,A=0;A<R.length;)$[f&A]=f&(M^=$[f&A]*19)+R.charCodeAt(A++);return N($)}function v(){try{var S;return m&&(S=m.randomBytes)?S=S(r):(S=new Uint8Array(r),(e.crypto||e.msCrypto).getRandomValues(S)),N(S)}catch{var $=e.navigator,R=$&&$.plugins;return[+new Date,e,R,e.screen,N(t)]}}function N(S){return String.fromCharCode.apply(0,S)}if(k(s.random(),t),n.exports){n.exports=g;try{m=fO}catch{}}else s["seed"+a]=g})(typeof self<"u"?self:pO,[],Math)})(Ef)),Ef.exports}var s0,B2;function gO(){if(B2)return s0;B2=1;var n=eO(),e=nO(),t=rO(),s=iO(),r=lO(),o=uO(),i=mO();return i.alea=n,i.xor128=e,i.xorwow=t,i.xorshift7=s,i.xor4096=r,i.tychei=o,s0=i,s0}var j1=gO();/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class pI{constructor(e,t,s,r,o){this.mean=e,this.stdDev=t,this.dtype=s,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);const i=o||Math.random();this.random=j1.alea(i.toString())}nextValue(){if(!isNaN(this.nextVal)){const r=this.nextVal;return this.nextVal=NaN,r}let e,t,s=!1;for(;!s;){let r,o,i;do r=2*this.random()-1,o=2*this.random()-1,i=r*r+o*o;while(i>=1||i===0);const a=Math.sqrt(-2*Math.log(i)/i);e=this.mean+this.stdDev*r*a,t=this.mean+this.stdDev*o*a,(!this.truncated||this.isValidTruncated(e))&&(s=!0)}return(!this.truncated||this.isValidTruncated(t))&&(this.nextVal=this.convertValue(t)),this.convertValue(e)}convertValue(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)}isValidTruncated(e){return e<=this.upper&&e>=this.lower}}class xO{constructor(e=0,t=1,s,r){if(this.canReturnFloat=()=>this.dtype==null||this.dtype==="float32",this.min=e,this.range=t-e,this.dtype=s,r==null&&(r=Math.random()),typeof r=="number"&&(r=r.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${e} - ${t} <= 1 and dtype is not float`);this.random=j1.alea(r)}convertValue(e){return this.canReturnFloat()?e:Math.round(e)}nextValue(){return this.convertValue(this.min+this.range*this.random())}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yO(n,e=0,t=1,s,r){if(Io(n),s!=null&&s==="bool")throw new Error(`Unsupported data type ${s}`);const o=new pI(e,t,s,!1,r),i=st(n,s);for(let a=0;a<i.values.length;a++)i.values[a]=o.nextValue();return i.toTensor()}const vO=ie({randomNormal_:yO});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bO(n,e=0,t=1,s="float32",r){Io(n);const o=st(n,s),i=new xO(e,t,null,r);for(let a=0;a<o.values.length;a++)o.values[a]=i.nextValue();return o.toTensor()}const Sd=ie({randomUniform_:bO});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fu(n,e,t=1,s="float32"){if(t===0)throw new Error("Cannot have a step of zero");const r={start:n,stop:e,step:t,dtype:s};return se.runKernel(a1,{},r)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wO(n){const t={input:K(n,"input","real")};return se.runKernel(l1,t)}const Hf=ie({real_:wO});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kO(n){const t={x:K(n,"x","reciprocal")};return se.runKernel(rd,t)}const CO=ie({reciprocal_:kO});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SO(n){const t={x:K(n,"x","relu")};return se.runKernel(od,t)}const ya=ie({relu_:SO});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NO(n){const t={x:K(n,"x","relu6")};return se.runKernel(id,t)}const mI=ie({relu6_:NO});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IO(n,e){const s={x:K(n,"x","reverse")},r={dims:e};return se.runKernel(fm,s,r)}const aa=ie({reverse_:IO});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $O(n){const t={x:K(n,"x","round")};return se.runKernel(ad,t)}const gI=ie({round_:$O});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TO(n){const t={x:K(n,"x","rsqrt","float32")};return se.runKernel(ld,t)}const xI=ie({rsqrt_:TO});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EO(n){const t={x:K(n,"x","selu")};return se.runKernel(cd,t)}const yI=ie({selu_:EO});function RO(n,e,t,s,r,o=[1,1],i="NHWC"){const a=K(n,"x","separableConv2d"),l=K(e,"depthwiseFilter","separableConv2d"),u=K(t,"pointwiseFilter","separableConv2d");let d=a,f=!1;if(a.rank===3&&(f=!0,d=re(a,[1,a.shape[0],a.shape[1],a.shape[2]])),i==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");_(d.rank===4,()=>`Error in separableConv2d: input must be rank 4, but got rank ${d.rank}.`),_(l.rank===4,()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${l.rank}.`),_(u.rank===4,()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${l.rank}.`),_(u.shape[0]===1,()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${u.shape[0]}.`),_(u.shape[1]===1,()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${u.shape[1]}.`);const m=l.shape[2],g=l.shape[3];_(u.shape[2]===m*g,()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${m*g}, but got ${u.shape[2]}.`);const y=I1(d,l,s,r,i,o),b=oa(y,u,1,"valid",i);return f?re(b,[b.shape[1],b.shape[2],b.shape[3]]):b}const vI=ie({separableConv2d_:RO});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AO(n){const t={x:K(n,"x","sign")};return se.runKernel(hd,t)}const DO=ie({sign_:AO});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MO(n){const t={x:K(n,"x","sin","float32")};return se.runKernel(ud,t)}const bI=ie({sin_:MO});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PO(n){const t={x:K(n,"x","sinh")};return se.runKernel(dd,t)}const wI=ie({sinh_:PO});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FO(n,e,t){const s=K(n,"x","slice1d");return _(s.rank===1,()=>`slice1d expects a rank-1 tensor, but got a rank-${s.rank} tensor`),$t(s,[e],[t])}const O1=ie({slice1d_:FO});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LO(n,e,t){const s=K(n,"x","slice2d");return _(s.rank===2,()=>`slice2d expects a rank-2 tensor, but got a rank-${s.rank} tensor`),$t(s,e,t)}const kI=ie({slice2d_:LO});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jO(n,e,t){const s=K(n,"x","slice3d");return _(s.rank===3,()=>`slice3d expects a rank-3 tensor, but got a rank-${s.rank} tensor`),$t(s,e,t)}const _1=ie({slice3d_:jO});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OO(n,e,t){const s=K(n,"x","slice4d");return _(s.rank===4,()=>`slice4d expects a rank-4 tensor, but got a rank-${s.rank} tensor`),$t(s,e,t)}const qf=ie({slice4d_:OO});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _O(n,e=-1){const t=K(n,"logits","softmax","float32");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${t.rank} and dim was ${e}`);const s={logits:t},r={dim:e};return se.runKernel(vm,s,r)}const z1=ie({softmax_:_O});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zO(n){_(n.dtype==="complex64",()=>`The dtype for tf.spectral.fft() must be complex64 but got ${n.dtype}.`);const e={input:n};return se.runKernel(Qy,e)}const CI=ie({fft_:zO});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BO(n){_(n.dtype==="complex64",()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${n.dtype}.`);const e={input:n};return se.runKernel(Zy,e)}const Q0=ie({ifft_:BO});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VO(n){const e=n.shape[n.shape.length-1],t=n.size/e;let s;if(e<=2){const r=re(n,[t,e]);s=Q0(r)}else{const r=[t,2*(e-1)],o=re(Hf(n),[t,e]),i=re(E1(n),[t,e]),a=aa($t(o,[0,1],[t,e-2]),1),l=te(aa($t(i,[0,1],[t,e-2]),1),gt(-1)),u=ms([o,a],1),d=ms([i,l],1),f=re(ea(u,d),[r[0],r[1]]);s=Q0(f)}if(s=Hf(s),n.rank===3&&n.shape[0]!==0){const r=s,o=n.shape[0];s=re(s,[o,s.shape[0]/o,s.shape[1]]),r.dispose()}return s}const WO=ie({irfft_:VO});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UO(n,e,t=0){const r={x:K(n,"x","split")},o={numOrSizeSplits:e,axis:t};return se.runKernel(ym,r,o)}const Ws=ie({split_:UO});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GO(n,e){_(n.dtype==="float32",()=>`The dtype for rfft() must be real value but got ${n.dtype}`);let t=n.shape[n.shape.length-1];const s=n.size/t;let r;if(e!=null&&e<t){const y=n.shape.map(b=>0),w=n.shape.map(b=>b);w[n.shape.length-1]=e,r=$t(n,y,w),t=e}else if(e!=null&&e>t){const y=n.shape.map(w=>w);y[n.shape.length-1]=e-t,r=ms([n,kn(y)],n.shape.length-1),t=e}else r=n;const o=ut(r),i=re(ea(r,o),[s,t]),a=CI(i),l=Math.floor(t/2)+1,u=Hf(a),d=E1(a),f=Ws(u,[l,t-l],u.shape.length-1),m=Ws(d,[l,t-l],d.shape.length-1),g=r.shape.slice();return g[r.shape.length-1]=l,re(ea(f[0],m[0]),g)}const HO=ie({rfft_:GO});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qO(n,e){let t=K(n,"a","squaredDifference"),s=K(e,"b","squaredDifference");[t,s]=Jt(t,s),Ze(t.shape,s.shape);const r={a:t,b:s},o={};return se.runKernel(gd,r,o)}const KO=ie({squaredDifference_:qO});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XO(n,e){const t=K(n,"x","squeeze","string_or_numeric");return re(t,fi(t.shape,e).newShape)}const Nd=ie({squeeze_:XO});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QO(n,e=0){const t=UN(n,"tensors","stack","string_or_numeric");_(t.length>=1,()=>"Pass at least one tensor to tf.stack"),t.length>0&&_(e<=t[0].rank,()=>"Axis must be <= rank of the tensor");const s=t,r={axis:e};return se.runKernel(im,s,r)}const Co=ie({stack_:QO});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YO(n,e=0){const s={x:K(n,"x","step")},r={alpha:e};return se.runKernel(wd,s,r)}const Id=ie({step_:YO});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JO(n,e,t,s,r=0,o=0,i=0,a=0,l=0){const d={x:K(n,"x","stridedSlice","string_or_numeric")},f={begin:e,end:t,strides:s,beginMask:r,endMask:o,ellipsisMask:i,newAxisMask:a,shrinkAxisMask:l};return se.runKernel(f1,d,f)}const ZO=ie({stridedSlice_:JO});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function e_(n){const t={x:K(n,"x","tan","float32")};return se.runKernel(yd,t)}const t_=ie({tan_:e_});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ps(n,e){eN(n);const t=Sm(n,e);if(t.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return Nm(n,null,t,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dl(n,e,t){if(eN(n),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");const s=Sm(n,t);if(s.length!==2&&s.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(s.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Nm(n,e,s,t)}function SI(n,e,t){const s=e.rank>1?e.shape[e.rank-1]:1,r=e.rank>1?e.rank-1:1,o=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${t.shape}, indices.shape: ${e.shape}, shape: ${n}, sliceDim: ${s}, and batchDim: ${r}.`;if(t.rank<r)throw new Error(o+` update.rank < ${r}. `);if(n.length<s+(t.rank-r))throw new Error(o+` Output shape length < ${s+(t.rank-r)}`);if(t.rank!==r+n.length-s)throw new Error(o+` update.rank != ${r+n.length-s}`);for(let i=0;i<r;++i)if(t.shape[i]!==e.shape[i])throw new Error(o+` updates.shape[${i}] (${t.shape[i]}) != indices.shape[${i}] (${e.shape[i]}).`);for(let i=0;i<t.rank-r;++i)if(t.shape[i+r]!==n[i+s])throw new Error(o+` updates.shape[${i+r}] (${t.shape[i+r]}) != shape[${i+r}] (${n[i+r]})`)}function n_(n,e,t){if(e.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${e.rank}.`);if(n.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${n.rank}.`);if(e.dtype!=="int32")throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${e.dtype}`);if(t.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${t}`);if(t.length===0){if(e.size===0)throw new Error(`Indices specified for empty output. indices shape: ${e.shape}`);if(n.size===0)throw new Error(`Updates specified for empty output. updates shape: ${n.shape}`)}SI(t,e,n)}function va(n,e,t){const s=e.shape.length,r=s>1?e.shape[s-1]:1,o=t.length;let i=1;for(let f=r;f<o;++f)i*=t[f];const a=r<1?1:r,l=pe(e.shape)/a,u=[...Ve(t.slice(0,r)),1],d=pe(t);return{sliceRank:r,numUpdates:l,sliceSize:i,strides:u,outputSize:d}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function s_(n,e=1,t=!0){const s=K(n,"x","topk");if(s.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");const r=s.shape[s.shape.length-1];if(e<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${e}`);if(e>r)throw new Error(`'k' passed to topk() must be <= the last dimension (${r}) but got ${e}`);const o={x:s},i={k:e,sorted:t},[a,l]=se.runKernel(p1,o,i);return{values:a,indices:l}}const r_=ie({topk_:s_});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o_(n,e=0,t=1,s,r){if(Io(n),s!=null&&s==="bool")throw new Error("Unsupported data type $ { dtype }");const o=new pI(e,t,s,!0,r),i=st(n,s);for(let a=0;a<i.values.length;a++)i.values[a]=o.nextValue();return i.toTensor()}const NI=ie({truncatedNormal_:o_});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function i_(n,e=0){const t=K(n,"x","unique","string_or_numeric");_(t.rank>0,()=>"The input tensor must be at least 1D");const s={x:t},r={axis:e},[o,i]=se.runKernel(g1,s,r);return{values:o,indices:i}}const a_=ie({unique_:i_});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function l_(n,e,t){const s=K(n,"x","unsortedSegmentSum"),r=K(e,"segmentIds","unsortedSegmentSum","int32");_(vl(t),()=>"numSegments must be of dtype int");const o={x:s,segmentIds:r},i={numSegments:t};return se.runKernel(wm,o,i)}const II=ie({unsortedSegmentSum_:l_});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function c_(n,e=0){const t=K(n,"x","unstack","string_or_numeric");_(e>=-t.shape.length&&e<t.shape.length,()=>`Axis = ${e} is not in [-${t.shape.length}, ${t.shape.length})`);const s={value:t},r={axis:e};return se.runKernel(bm,s,r)}const la=ie({unstack_:c_});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function u_(n,e=!0,t,s){return se.makeVariable(n,e,t,s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $I(n,e){const t=[];for(let o=0;o<e.length;o++)e[o]&&t.push(o);const s=st(n,"int32"),r=st([t.length,n.length],"int32");for(let o=0;o<t.length;o++){const i=s.indexToLoc(t[o]),a=o*n.length;r.values.set(i,a)}return r.toTensor()}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d_(n,e,t){const s=K(n,"x","transpose");if(e==null&&(e=s.shape.map((i,a)=>a).reverse()),_(s.rank===e.length,()=>`Error in transpose: rank of input ${s.rank} must match length of perm ${e}.`),e.forEach(i=>{_(i>=0&&i<s.rank,()=>`All entries in 'perm' must be between 0 and ${s.rank-1} but got ${e}`)}),s.rank<=1)return s.clone();const r={x:s},o={perm:e};return s.dtype==="complex64"?le(()=>{let i=Hf(s),a=E1(s);return i=se.runKernel(ll,{x:i},o),a=se.runKernel(ll,{x:a},o),t&&(a=Yt(a)),ea(i,a)}):se.runKernel(ll,r,o)}const ct=ie({transpose_:d_});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function h_(n,e){if(e==null)return n.shape.slice();if(xt(n.shape,e))return e;if(n.shape.length===e.length){const t=[];for(let s=0;s<n.shape.length;s++)e[s]==null&&n.shape[s]!=null?t.push(n.shape[s]):t.push(e[s]);return t}return e}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f_(n,e,t,s){const r=K(n,"x","dropout");if(_(r.dtype==="float32",()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${r.dtype} tensor instead.`),_(e>=0&&e<1,()=>`rate must be a float in the range [0, 1), but got ${e}.`),e===0)return n instanceof un?r.clone():r;const o=h_(r,t),i=1-e,a=Ge(Am(Ie(Sd(o,0,1,"float32",s),i)),i);return te(r,a)}const p_=ie({dropout_:f_});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function m_(n,e,t,s,r,o="NHWC",i){let a=n;n.rank===3&&(a=re(n,[1,n.shape[0],n.shape[1],n.shape[2]]));let l=e;l.rank===3&&(l=re(e,[1,e.shape[0],e.shape[1],e.shape[2]])),_(a.rank===4,()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${a.shape}.`),_(l.rank===4,()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${l.shape}.`),_(t.length===4,()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${t}.`);const u=o==="NHWC"?a.shape[3]:a.shape[1],d=o==="NHWC"?l.shape[3]:l.shape[1];_(u===t[2],()=>`Error in conv2dDerFilter: depth of input ${u}) must match input depth in filter (${t[2]}.`),_(d===t[3],()=>`Error in conv2dDerFilter: depth of dy (${d}) must match output depth for filter (${t[3]}).`),vs("conv2dDerFilter",r,i);const f={x:a,dy:l},m={strides:s,pad:r,dataFormat:o,dimRoundingMode:i,filterShape:t};return se.runKernel(_y,f,m)}const B1=ie({conv2DBackpropFilter_:m_});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function V1(n,e,t){if(t==null||t==="linear")return n;if(t==="relu")return te(n,Id(e));throw new Error(`Cannot compute gradient for fused activation ${t}.`)}function W1(n,e){let t=e;const s=mn(n.shape,e.shape);return s.length>0&&(t=We(t,s)),re(t,n.shape)}function U1(n,e,t,s){if(e==="linear")return n;if(e==="relu")return ya(n);if(e==="elu")return Em(n);if(e==="relu6")return mI(n);if(e==="prelu")return L1(n,t);if(e==="leakyrelu")return R1(n,s);if(e==="sigmoid")return jl(n);throw new Error(`Unknown fused activation ${e}.`)}const G1=(n,e)=>!(n>0)||e==="linear";/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g_({x:n,filter:e,strides:t,pad:s,dataFormat:r="NHWC",dilations:o=[1,1],dimRoundingMode:i,bias:a,activation:l="linear",preluActivationWeights:u,leakyreluAlpha:d}){if(l=l||"linear",G1(se.state.gradientDepth,l)===!1){_(r==="NHWC",()=>`Error in fused conv2d: got dataFormat of ${r} but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.`);let R=oa(n,e,t,s,r,o,i);return a!=null&&(R=Ie(R,a)),U1(R,l,u,d)}const f=K(n,"x","conv2d","float32"),m=K(e,"filter","conv2d","float32");let g=f,y=!1;f.rank===3&&(y=!0,g=re(f,[1,f.shape[0],f.shape[1],f.shape[2]])),_(g.rank===4,()=>`Error in fused conv2d: input must be rank 4, but got rank ${g.rank}.`),_(m.rank===4,()=>`Error in fused conv2d: filter must be rank 4, but got rank ${m.rank}.`),vs("fused conv2d",s,i);const w=r==="NHWC"?g.shape[3]:g.shape[1];_(m.shape[2]===w,()=>`Error in conv2d: depth of input (${w}) must match input depth for filter ${m.shape[2]}.`),_(Vn(t,o),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${t} and dilations '${o}'`);const b=An(g.shape,m.shape,t,o,s,i);let k;a!=null&&(k=K(a,"bias","fused conv2d"),[k]=Jt(k,f),r==="NHWC"?Ze(b.outShape,k.shape):(_(k.shape.length<=1,()=>`Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-${k.shape.length}.`),_(k.shape.length===0||k.shape[0]===b.outChannels||k.shape[0]===1,()=>`Error in fused conv2d: bias shape (${k.shape}) is not compatible with the number of output channels (${b.outChannels})`)));let v;if(u!=null){const R=u.shape;if(_(R.length<=1||R.length===3,()=>`Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-${R.length}.`),R.length===1)_(R[0]===1||R[0]===b.outChannels,()=>`Error in fused conv2d: PReLU activation weights (${R}) is not compatible with the number of output channels (${b.outChannels}).`);else if(R.length===3)try{Ze(R,b.outShape)}catch{const A=`Error in fused conv2d: PReLU activation weights (${R}) is not compatible with the output shape of the conv2d (${b.outShape}).`;throw Error(A)}v=K(u,"prelu weights","fused conv2d")}const N=(R,M)=>{_(r==="NHWC",()=>`Error in gradient of fused conv2D: got dataFormat of ${r} but only NHWC is currently supported.`);const[A,P,D,E]=M,j=V1(R,D,l);_(sa(o),()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${o}'`);const V=S1(P.shape,j,A,t,s),W=B1(P,j,A.shape,t,s),U=[V,W];if(E!=null){const X=W1(E,j);U.push(X)}return U},S={x:g,filter:m,bias:k,preluActivationWeights:v},$={strides:t,pad:s,dataFormat:r,dilations:o,dimRoundingMode:i,activation:l,leakyreluAlpha:d};return a==null?Cl((M,A,P)=>{let D=se.runKernel(_f,S,$);return P([A,M,D]),y&&(D=re(D,[D.shape[1],D.shape[2],D.shape[3]])),{value:D,gradFunc:N}})(g,m):Cl((M,A,P,D)=>{let E=se.runKernel(_f,S,$);return D([A,M,E,P]),y&&(E=re(E,[E.shape[1],E.shape[2],E.shape[3]])),{value:E,gradFunc:N}})(g,m,k)}const x_=ie({fusedConv2d_:g_});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function y_(n,e,t,s,r,o=[1,1],i){let a=n;n.rank===3&&(a=re(n,[1,n.shape[0],n.shape[1],n.shape[2]]));let l=e;l.rank===3&&(l=re(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const u={x:a,dy:l},d={strides:s,pad:r,dimRoundingMode:i,dilations:o,filterShape:t};return se.runKernel(Hy,u,d)}const v_=ie({depthwiseConv2dNativeBackpropFilter_:y_});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b_(n,e,t,s,r,o=[1,1],i){let a=e,l=!1;e.rank===3&&(l=!0,a=re(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const u={dy:a,filter:t},d={strides:s,pad:r,dimRoundingMode:i,dilations:o,inputShape:n},f=se.runKernel(qy,u,d);return l?re(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const w_=ie({depthwiseConv2dNativeBackpropInput_:b_});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function k_({a:n,b:e,transposeA:t=!1,transposeB:s=!1,bias:r,activation:o="linear",preluActivationWeights:i,leakyreluAlpha:a=.2}){if(G1(se.state.gradientDepth,o)===!1){let E=mt(n,e,t,s);return r!=null&&(E=Ie(E,r)),U1(E,o,i,a)}let l=K(n,"a","fused matMul"),u=K(e,"b","fused matMul");[l,u]=Jt(l,u);const d=t?l.shape[l.rank-2]:l.shape[l.rank-1],f=s?u.shape[u.rank-1]:u.shape[u.rank-2],m=t?l.shape[l.rank-1]:l.shape[l.rank-2],g=s?u.shape[u.rank-2]:u.shape[u.rank-1],y=l.shape.slice(0,-2),w=u.shape.slice(0,-2),b=pe(y),k=pe(w);_(d===f,()=>`Error in fused matMul: inner shapes (${d}) and (${f}) of Tensors with shapes ${l.shape} and ${u.shape} and transposeA=${t} and transposeB=${s} must match.`);const N=Ze(l.shape.slice(0,-2),u.shape.slice(0,-2)).concat([m,g]),S=t?re(l,[b,d,m]):re(l,[b,m,d]),$=s?re(u,[k,g,f]):re(u,[k,f,g]);let R;r!=null&&(R=K(r,"bias","fused matMul"),[R]=Jt(R,l),Ze(N,R.shape));let M;i!=null&&(M=K(i,"prelu weights","fused matMul"));const A=(E,j)=>{const[V,W,U,X]=j,ee=V1(re(E,U.shape),U,o);let G,z;if(!t&&!s?(G=mt(ee,W,!1,!0),z=mt(V,ee,!0,!1)):!t&&s?(G=mt(ee,W,!1,!1),z=mt(ee,V,!0,!1)):t&&!s?(G=mt(W,ee,!1,!0),z=mt(V,ee,!1,!1)):(G=mt(W,ee,!0,!0),z=mt(ee,V,!0,!0)),r!=null){const H=W1(X,ee);return[G,z,H]}else return[G,z]},P={a:S,b:$,bias:R,preluActivationWeights:M},D={transposeA:t,transposeB:s,activation:o,leakyreluAlpha:a};return r==null?Cl((j,V,W)=>{const U=se.runKernel(Of,P,D);return W([j,V,U]),{value:re(U,N),gradFunc:A}})(S,$):Cl((j,V,W,U)=>{const X=se.runKernel(Of,P,D);return U([j,V,X,W]),{value:re(X,N),gradFunc:A}})(S,$,R)}const V2=ie({fusedMatMul_:k_});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function C_(n,e,t,s,r="bilinear",o=0){const i=K(n,"image","cropAndResize"),a=K(e,"boxes","cropAndResize","float32"),l=K(t,"boxInd","cropAndResize","int32"),u=a.shape[0];_(i.rank===4,()=>`Error in cropAndResize: image must be rank 4,but got rank ${i.rank}.`),_(a.rank===2&&a.shape[1]===4,()=>`Error in cropAndResize: boxes must be have size [${u},4] but had shape ${a.shape}.`),_(l.rank===1&&l.shape[0]===u,()=>`Error in cropAndResize: boxInd must be have size [${u}] but had shape ${a.shape}.`),_(s.length===2,()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${s.length}.`),_(s[0]>=1&&s[1]>=1,()=>`cropSize must be atleast [1,1], but was ${s}`),_(r==="bilinear"||r==="nearest",()=>`method must be bilinear or nearest, but was ${r}`);const d={image:i,boxes:a,boxInd:l},f={method:r,extrapolationValue:o,cropSize:s};return se.runKernel(Wy,d,f)}const S_=ie({cropAndResize_:C_});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function N_(n){const e=K(n,"image","flipLeftRight","float32");_(e.rank===4,()=>`Error in flipLeftRight: image must be rank 4,but got rank ${e.rank}.`);const t={image:e};return se.runKernel(Jy,t,{})}const I_=ie({flipLeftRight_:N_});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $_(n){const e=K(n,"image","grayscaleToRGB"),t=e.rank-1,s=e.shape[t];_(e.rank>=2,()=>`Error in grayscaleToRGB: images must be at least rank 2, but got rank ${e.rank}.`),_(s===1,()=>`Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ${s}.`);const r=new Array(e.rank);return r.fill(1,0,t),r[t]=3,$r(e,r)}const T_=ie({grayscaleToRGB_:$_});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function E_(n){const e=K(n,"image","RGBToGrayscale"),t=e.rank-1,s=e.shape[t];_(e.rank>=2,()=>`Error in RGBToGrayscale: images must be at least rank 2, but got rank ${e.rank}.`),_(s===3,()=>`Error in RGBToGrayscale: last dimension of an RGB image should be size 3, but got size ${s}.`);const r=e.dtype,o=Ae(e,"float32"),i=ps([.2989,.587,.114]);let a;switch(e.rank){case 2:a=Bc("ij,j->i",o,i);break;case 3:a=Bc("ijk,k->ij",o,i);break;case 4:a=Bc("ijkl,l->ijk",o,i);break;case 5:a=Bc("ijklm,m->ijkl",o,i);break;case 6:a=Bc("ijklmn,n->ijklm",o,i);break;default:throw new Error("Not a valid tensor rank.")}return a=hs(a,-1),Ae(a,r)}const R_=ie({rgbToGrayscale_:E_});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function A_(n,e,t=0,s=.5){const r=K(n,"image","rotateWithOffset","float32");_(r.rank===4,()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${r.rank}.`);const o={image:r},i={radians:e,fillValue:t,center:s};return se.runKernel(x1,o,i)}const D_=ie({rotateWithOffset_:A_});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _l(n,e,t,s,r,o){s==null&&(s=.5),r==null&&(r=Number.NEGATIVE_INFINITY),o==null&&(o=0);const i=n.shape[0];return t=Math.min(t,i),_(0<=s&&s<=1,()=>`iouThreshold must be in [0, 1], but was '${s}'`),_(n.rank===2,()=>`boxes must be a 2D tensor, but was of rank '${n.rank}'`),_(n.shape[1]===4,()=>`boxes must have 4 columns, but 2nd dimension was ${n.shape[1]}`),_(e.rank===1,()=>"scores must be a 1D tensor"),_(e.shape[0]===i,()=>`scores has incompatible shape with boxes. Expected ${i}, but was ${e.shape[0]}`),_(0<=o&&o<=1,()=>`softNmsSigma must be in [0, 1], but was '${o}'`),{maxOutputSize:t,iouThreshold:s,scoreThreshold:r,softNmsSigma:o}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function M_(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY){const o=K(n,"boxes","nonMaxSuppression","float32"),i=K(e,"scores","nonMaxSuppression","float32"),a=_l(o,i,t,s,r);t=a.maxOutputSize,s=a.iouThreshold,r=a.scoreThreshold;const l={maxOutputSize:t,iouThreshold:s,scoreThreshold:r};return se.runKernel(r1,{boxes:o,scores:i},l)}const P_=ie({nonMaxSuppression_:M_});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function F_(n,e,t){const s=L_(n,e,t),r=s<0?-(s+1):s;n.splice(r,0,e)}function L_(n,e,t){return O_(n,e,t||j_)}function j_(n,e){return n>e?1:n<e?-1:0}function O_(n,e,t){let s=0,r=n.length,o=0,i=!1;for(;s<r;){o=s+(r-s>>>1);const a=t(e,n[o]);a>0?s=o+1:(r=o,i=!a)}return i?s:-s-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function H1(n,e,t,s,r){return X1(n,e,t,s,r,0)}function q1(n,e,t,s,r,o){return X1(n,e,t,s,r,0,!1,o,!0)}function K1(n,e,t,s,r,o){return X1(n,e,t,s,r,o,!0)}function X1(n,e,t,s,r,o,i=!1,a=!1,l=!1){const u=[];for(let b=0;b<e.length;b++)e[b]>r&&u.push({score:e[b],boxIndex:b,suppressBeginIndex:0});u.sort(W2);const d=o>0?-.5/o:0,f=[],m=[];for(;f.length<t&&u.length>0;){const b=u.pop(),{score:k,boxIndex:v,suppressBeginIndex:N}=b;if(k<r)break;let S=!1;for(let $=f.length-1;$>=N;--$){const R=__(n,v,f[$]);if(R>=s){S=!0;break}if(b.score=b.score*z_(s,d,R),b.score<=r)break}b.suppressBeginIndex=f.length,S||(b.score===k?(f.push(v),m.push(b.score)):b.score>r&&F_(u,b,W2))}const g=f.length,y=t-g;a&&y>0&&(f.push(...new Array(y).fill(0)),m.push(...new Array(y).fill(0)));const w={selectedIndices:f};return i&&(w.selectedScores=m),l&&(w.validOutputs=g),w}function __(n,e,t){const s=n.subarray(e*4,e*4+4),r=n.subarray(t*4,t*4+4),o=Math.min(s[0],s[2]),i=Math.min(s[1],s[3]),a=Math.max(s[0],s[2]),l=Math.max(s[1],s[3]),u=Math.min(r[0],r[2]),d=Math.min(r[1],r[3]),f=Math.max(r[0],r[2]),m=Math.max(r[1],r[3]),g=(a-o)*(l-i),y=(f-u)*(m-d);if(g<=0||y<=0)return 0;const w=Math.max(o,u),b=Math.max(i,d),k=Math.min(a,f),v=Math.min(l,m),N=Math.max(k-w,0)*Math.max(v-b,0);return N/(g+y-N)}function z_(n,e,t){const s=Math.exp(e*t*t);return t<=n?s:0}function W2(n,e){return n.score-e.score||n.score===e.score&&e.boxIndex-n.boxIndex}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function B_(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY){const o=K(n,"boxes","nonMaxSuppressionAsync"),i=K(e,"scores","nonMaxSuppressionAsync"),a=_l(o,i,t,s,r);t=a.maxOutputSize,s=a.iouThreshold,r=a.scoreThreshold;const l=await Promise.all([o.data(),i.data()]),u=l[0],d=l[1],{selectedIndices:f}=H1(u,d,t,s,r);return o!==n&&o.dispose(),i!==e&&i.dispose(),ps(f,"int32")}const V_=B_;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function W_(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY,o=0){const i=K(n,"boxes","nonMaxSuppression"),a=K(e,"scores","nonMaxSuppression"),l=_l(i,a,t,s,r,o);t=l.maxOutputSize,s=l.iouThreshold,r=l.scoreThreshold,o=l.softNmsSigma;const u={boxes:i,scores:a},d={maxOutputSize:t,iouThreshold:s,scoreThreshold:r,softNmsSigma:o},f=se.runKernel(i1,u,d);return{selectedIndices:f[0],selectedScores:f[1]}}const U_=ie({nonMaxSuppressionWithScore_:W_});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function G_(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY,o=0){const i=K(n,"boxes","nonMaxSuppressionAsync"),a=K(e,"scores","nonMaxSuppressionAsync"),l=_l(i,a,t,s,r,o);t=l.maxOutputSize,s=l.iouThreshold,r=l.scoreThreshold,o=l.softNmsSigma;const u=await Promise.all([i.data(),a.data()]),d=u[0],f=u[1],{selectedIndices:m,selectedScores:g}=K1(d,f,t,s,r,o);return i!==n&&i.dispose(),a!==e&&a.dispose(),{selectedIndices:ps(m,"int32"),selectedScores:ps(g)}}const H_=G_;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function q_(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY,o=!1){const i=K(n,"boxes","nonMaxSuppression"),a=K(e,"scores","nonMaxSuppression"),l=_l(i,a,t,s,r,null),u=l.maxOutputSize,d=l.iouThreshold,f=l.scoreThreshold,m={boxes:i,scores:a},g={maxOutputSize:u,iouThreshold:d,scoreThreshold:f,padToMaxOutputSize:o},y=se.runKernel(o1,m,g);return{selectedIndices:y[0],validOutputs:y[1]}}const K_=ie({nonMaxSuppressionPadded_:q_});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function X_(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY,o=!1){const i=K(n,"boxes","nonMaxSuppressionAsync"),a=K(e,"scores","nonMaxSuppressionAsync"),l=_l(i,a,t,s,r,null),u=l.maxOutputSize,d=l.iouThreshold,f=l.scoreThreshold,[m,g]=await Promise.all([i.data(),a.data()]),{selectedIndices:y,validOutputs:w}=q1(m,g,u,d,f,o);return i!==n&&i.dispose(),a!==e&&a.dispose(),{selectedIndices:ps(y,"int32"),validOutputs:gt(w,"int32")}}const Q_=X_;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Y_(n,e,t=!1,s=!1){const r=K(n,"images","resizeBilinear");_(r.rank===3||r.rank===4,()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${r.rank}.`),_(e.length===2,()=>`Error in resizeBilinear: new shape must 2D, but got shape ${e}.`),_(s===!1||t===!1,()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false.");let o=r,i=!1;r.rank===3&&(i=!0,o=re(r,[1,r.shape[0],r.shape[1],r.shape[2]]));const a={images:o},l={alignCorners:t,halfPixelCenters:s,size:e},u=se.runKernel(hm,a,l);return i?re(u,[u.shape[1],u.shape[2],u.shape[3]]):u}const TI=ie({resizeBilinear_:Y_});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function J_(n,e,t=!1,s=!1){const r=K(n,"images","resizeNearestNeighbor");_(r.rank===3||r.rank===4,()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${r.rank}.`),_(e.length===2,()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${e}.`),_(r.dtype==="float32"||r.dtype==="int32",()=>"`images` must have `int32` or `float32` as dtype"),_(s===!1||t===!1,()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false.");let o=r,i=!1;r.rank===3&&(i=!0,o=re(r,[1,r.shape[0],r.shape[1],r.shape[2]]));const a={images:o},l={alignCorners:t,halfPixelCenters:s,size:e},u=se.runKernel(dm,a,l);return i?re(u,[u.shape[1],u.shape[2],u.shape[3]]):u}const EI=ie({resizeNearestNeighbor_:J_});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z_(n,e="binary",t=!1,s=.5){const r=K(n,"image","threshold"),o=.2989,i=.587,a=.114,l=r.shape[0]*r.shape[1];let u=te(ps([s]),255),d,f,m,g;if(_(r.rank===3,()=>`Error in threshold: image must be rank 3,but got rank ${r.rank}.`),_(r.shape[2]===3||r.shape[2]===1,()=>`Error in threshold: image color channel must be equal to 3 or 1but got ${r.shape[2]}.`),_(r.dtype==="int32"||r.dtype==="float32",()=>`Error in dtype: image dtype must be int32 or float32,but got dtype ${r.dtype}.`),_(e==="otsu"||e==="binary",()=>`Method must be binary or otsu, but was ${e}`),r.shape[2]===3){[d,f,m]=Ws(r,[1,1,1],-1);const b=te(d,o),k=te(f,i),v=te(m,a);g=Ie(Ie(b,k),v)}else g=n;if(e==="otsu"){const b=QF(Ae(gI(g),"int32"),tu([]),256);u=ez(b,l)}const y=t?Ol(g,u):Gs(g,u);return Ae(te(y,255),"int32")}function ez(n,e){let t=ps([-1]),s=ps([0]),r=ps([0]),o,i,a,l,u,d;for(let f=0;f<n.size-1;f++){o=$t(n,0,f+1),i=$t(n,f+1),u=Ge(We(o),e),d=Ge(We(i),e);const m=We(te(o,fu(0,o.size)));a=Ge(m,We(o));const g=Tm(i.shape,o.size),y=Ie(fu(0,i.size),g),w=te(i,y);l=Ge(We(w),We(i));const b=Ke(a,l),k=Ke(a,l),v=te(u,d);r=te(te(v,b),k);const N=Gs(r,s);s=ss(N,r,s),t=ss(N,ps([f]),t)}return t}const tz=ie({threshold_:Z_});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nz(n,e,t="nearest",s="constant",r=0,o){const i=K(n,"image","transform","float32"),a=K(e,"transforms","transform","float32");_(i.rank===4,()=>`Error in transform: image must be rank 4,but got rank ${i.rank}.`),_(a.rank===2&&(a.shape[0]===i.shape[0]||a.shape[0]===1)&&a.shape[1]===8,()=>"Error in transform: Input transform should be batch x 8 or 1 x 8"),_(o==null||o.length===2,()=>`Error in transform: outputShape must be [height, width] or null, but got ${o}.`);const l={image:i,transforms:a},u={interpolation:t,fillMode:s,fillValue:r,outputShape:o};return se.runKernel(m1,l,u)}const sz=ie({transform_:nz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rz(n,e,t){const s=K(n,"a","bandPart");_(s.rank>=2,()=>`bandPart(): Rank must be at least 2, got ${s.rank}.`);const r=s.shape,[o,i]=s.shape.slice(-2);let a,l;typeof e=="number"?(_(e%1===0,()=>`bandPart(): numLower must be an integer, got ${e}.`),_(e<=o,()=>`bandPart(): numLower (${e}) must not be greater than the number of rows (${o}).`),a=K(e<0?o:e,"numLower","bandPart")):(_(e.dtype==="int32",()=>"bandPart(): numLower's dtype must be an int32."),a=ss(Uf(e,0),o,hu(e,o))),typeof t=="number"?(_(t%1===0,()=>`bandPart(): numUpper must be an integer, got ${t}.`),_(t<=i,()=>`bandPart(): numUpper (${t}) must not be greater than the number of columns (${i}).`),l=K(t<0?i:t,"numUpper","bandPart")):(_(t.dtype==="int32",()=>"bandPart(): numUpper's dtype must be an int32."),l=ss(Uf(t,0),i,hu(t,i)));const u=re(fu(0,o,1,"int32"),[-1,1]),d=fu(0,i,1,"int32"),f=Ke(u,d),m=ko(Ol(f,a),xa(f,Yt(l))),g=kn([o,i],s.dtype);return re(Co(la(re(s,[-1,o,i])).map(y=>ss(m,y,g))),r)}const oz=ie({bandPart_:rz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iz(n){let e;if(Array.isArray(n)){e=!1,_(n!=null&&n.length>0,()=>"Gram-Schmidt process: input must not be null, undefined, or empty");const r=n[0].shape[0];for(let o=1;o<n.length;++o)_(n[o].shape[0]===r,()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${n[o].shape[0]} vs. ${r})`)}else e=!0,n=Ws(n,n.shape[0],0).map(r=>Nd(r,[0]));_(n.length<=n[0].shape[0],()=>`Gram-Schmidt: Number of vectors (${n.length}) exceeds number of dimensions (${n[0].shape[0]}).`);const t=[],s=n;for(let r=0;r<n.length;++r)t.push(se.tidy(()=>{let o=s[r];if(r>0)for(let i=0;i<r;++i){const a=te(We(te(t[i],o)),t[i]);o=Ke(o,a)}return Ge(o,Rm(o,"euclidean"))}));return e?Co(t,0):t}const az=ie({gramSchmidt_:iz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lz(n,e=!1){if(_(n.rank>=2,()=>`qr() requires input tensor to have a rank >= 2, but got rank ${n.rank}`),n.rank===2)return U2(n,e);{const t=n.shape.slice(0,n.shape.length-2).reduce((l,u)=>l*u),s=la(re(n,[t,n.shape[n.shape.length-2],n.shape[n.shape.length-1]]),0),r=[],o=[];s.forEach(l=>{const[u,d]=U2(l,e);r.push(u),o.push(d)});const i=re(Co(r,0),n.shape),a=re(Co(o,0),n.shape);return[i,a]}}function U2(n,e=!1){return se.tidy(()=>{_(n.shape.length===2,()=>`qr2d() requires a 2D Tensor, but got a ${n.shape.length}D Tensor.`);const t=n.shape[0],s=n.shape[1];let r=lI(t),o=Ki(n);const i=dl([[1]],[1,1]);let a=Ki(i);const l=t>=s?s:t;for(let u=0;u<l;++u){const d=o,f=a,m=r;[a,o,r]=se.tidy(()=>{const g=$t(o,[u,u],[t-u,1]),y=Rm(g),w=$t(o,[u,u],[1,1]),b=ss(Gs(w,0),dl([[-1]]),dl([[1]])),k=Ke(w,te(b,y)),v=Ge(g,k);v.shape[0]===1?a=Ki(i):a=ms([i,$t(v,[1,0],[v.shape[0]-1,v.shape[1]])],0);const N=Yt(Ge(mt(b,k),y)),S=$t(o,[u,0],[t-u,s]),$=te(N,a),R=ct(a);if(u===0)o=Ke(S,mt($,mt(R,S)));else{const P=Ke(S,mt($,mt(R,S)));o=ms([$t(o,[0,0],[u,s]),P],0)}const M=ct($),A=$t(r,[0,u],[t,r.shape[1]-u]);if(u===0)r=Ke(A,mt(mt(A,a),M));else{const P=Ke(A,mt(mt(A,a),M));r=ms([$t(r,[0,0],[t,u]),P],1)}return[a,o,r]}),nt([d,f,m])}return!e&&t>s&&(r=$t(r,[0,0],[t,s]),o=$t(o,[0,0],[s,s])),[r,o]})}const cz=ie({qr_:lz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wo={flipLeftRight:I_,grayscaleToRGB:T_,resizeNearestNeighbor:EI,resizeBilinear:TI,rgbToGrayscale:R_,rotateWithOffset:D_,cropAndResize:S_,nonMaxSuppression:P_,nonMaxSuppressionAsync:V_,nonMaxSuppressionWithScore:U_,nonMaxSuppressionWithScoreAsync:H_,nonMaxSuppressionPadded:K_,nonMaxSuppressionPaddedAsync:Q_,threshold:tz,transform:sz},uz={bandPart:oz,gramSchmidt:az,qr:cz};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dz=new Map,hz=new Map;class zl{getClassName(){return this.constructor.className}static fromConfig(e,t){return new e(t)}}class rr{constructor(){this.classNameMap={}}static getMap(){return rr.instance==null&&(rr.instance=new rr),rr.instance}static register(e){rr.getMap().classNameMap[e.className]=[e,e.fromConfig]}}function we(n,e,t){_(n.className!=null,()=>"Class being registered does not have the static className property defined."),_(typeof n.className=="string",()=>"className is required to be a string, but got type "+typeof n.className),_(n.className.length>0,()=>"Class being registered has an empty-string as its className, which is disallowed."),typeof e>"u"&&(e="Custom"),typeof t>"u"&&(t=n.className);const s=t,r=e+">"+s;return rr.register(n),dz.set(r,n),hz.set(n,r),n}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class bi extends zl{minimize(e,t=!1,s){const{value:r,grads:o}=this.computeGradients(e,s);if(s!=null){const i=s.map(a=>({name:a.name,tensor:o[a.name]}));this.applyGradients(i)}else this.applyGradients(o);return nt(o),t?r:(r.dispose(),null)}get iterations(){return this.iterations_==null&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(e,t){return xj(e,t)}dispose(){this.iterations_!=null&&nt(this.iterations_)}async saveIterations(){return this.iterations_==null&&(this.iterations_=0),{name:"iter",tensor:gt(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(e){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(e){return this.iterations_=(await e[0].tensor.data())[0],e.slice(1)}}Object.defineProperty(bi,Symbol.hasInstance,{value:n=>n.minimize!=null&&n.computeGradients!=null&&n.applyGradients!=null});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class RI extends bi{static get className(){return"Adadelta"}constructor(e,t,s=null){super(),this.learningRate=e,this.rho=t,this.epsilon=s,this.accumulatedGrads=[],this.accumulatedUpdates=[],s==null&&(this.epsilon=se.backend.epsilon())}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const o=se.registeredVariables[s],i=!1;this.accumulatedGrads[r]==null&&(this.accumulatedGrads[r]={originalName:`${s}/accum_grad`,variable:le(()=>ut(o).variable(i))}),this.accumulatedUpdates[r]==null&&(this.accumulatedUpdates[r]={originalName:`${s}/accum_var`,variable:le(()=>ut(o).variable(i))});const a=Array.isArray(e)?e[r].tensor:e[s];if(a==null)return;const l=this.accumulatedGrads[r].variable,u=this.accumulatedUpdates[r].variable;le(()=>{const d=Ie(te(l,this.rho),te(Rt(a),1-this.rho)),f=te(Ge(Bn(Ie(u,this.epsilon)),Bn(Ie(l,this.epsilon))),a),m=Ie(te(u,this.rho),te(Rt(f),1-this.rho));l.assign(d),u.assign(m);const g=Ie(te(f,-this.learningRate),o);o.assign(g)})}),this.incrementIterations()}dispose(){this.accumulatedUpdates!=null&&(nt(this.accumulatedGrads.map(e=>e.variable)),nt(this.accumulatedUpdates.map(e=>e.variable)))}async getWeights(){const e=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=e.length/2,s=!1;this.accumulatedGrads=e.slice(0,t).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedUpdates=e.slice(t,t*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)}))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.rho,t.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class AI extends bi{static get className(){return"Adagrad"}constructor(e,t=.1){super(),this.learningRate=e,this.initialAccumulatorValue=t,this.accumulatedGrads=[]}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const o=se.registeredVariables[s];this.accumulatedGrads[r]==null&&(this.accumulatedGrads[r]={originalName:`${s}/accumulator`,variable:le(()=>Tm(o.shape,this.initialAccumulatorValue).variable(!1))});const i=Array.isArray(e)?e[r].tensor:e[s];if(i==null)return;const a=this.accumulatedGrads[r].variable;le(()=>{const l=Ie(a,Rt(i));a.assign(l);const u=Ie(te(Ge(i,Bn(Ie(l,se.backend.epsilon()))),-this.learningRate),o);o.assign(u)})}),this.incrementIterations()}dispose(){this.accumulatedGrads!=null&&nt(this.accumulatedGrads.map(e=>e.variable))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=!1;this.accumulatedGrads=e.map(s=>({originalName:s.name,variable:s.tensor.variable(t)}))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(e,t){return new e(t.learningRate,t.initialAccumulatorValue)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class DI extends bi{static get className(){return"Adam"}constructor(e,t,s,r=null){super(),this.learningRate=e,this.beta1=t,this.beta2=s,this.epsilon=r,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],le(()=>{this.accBeta1=gt(t).variable(),this.accBeta2=gt(s).variable()}),r==null&&(this.epsilon=se.backend.epsilon())}applyGradients(e){const t=Array.isArray(e)?e.map(s=>s.name):Object.keys(e);le(()=>{const s=Ke(1,this.accBeta1),r=Ke(1,this.accBeta2);t.forEach((o,i)=>{const a=se.registeredVariables[o],l=!1;this.accumulatedFirstMoment[i]==null&&(this.accumulatedFirstMoment[i]={originalName:`${o}/m`,variable:le(()=>ut(a).variable(l))}),this.accumulatedSecondMoment[i]==null&&(this.accumulatedSecondMoment[i]={originalName:`${o}/v`,variable:le(()=>ut(a).variable(l))});const u=Array.isArray(e)?e[i].tensor:e[o];if(u==null)return;const d=this.accumulatedFirstMoment[i].variable,f=this.accumulatedSecondMoment[i].variable,m=Ie(te(d,this.beta1),te(u,1-this.beta1)),g=Ie(te(f,this.beta2),te(Rt(u),1-this.beta2)),y=Ge(m,s),w=Ge(g,r);d.assign(m),f.assign(g);const b=Ie(te(Ge(y,Ie(Bn(w),this.epsilon)),-this.learningRate),a);a.assign(b)}),this.accBeta1.assign(te(this.accBeta1,this.beta1)),this.accBeta2.assign(te(this.accBeta2,this.beta2))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&nt(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedSecondMoment!=null&&nt(this.accumulatedSecondMoment.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e),le(()=>{this.accBeta1.assign(ia(this.beta1,this.iterations_+1)),this.accBeta2.assign(ia(this.beta2,this.iterations_+1))});const t=e.length/2,s=!1;this.accumulatedFirstMoment=e.slice(0,t).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedSecondMoment=e.slice(t,t*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)}))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class MI extends bi{static get className(){return"Adamax"}constructor(e,t,s,r=null,o=0){super(),this.learningRate=e,this.beta1=t,this.beta2=s,this.epsilon=r,this.decay=o,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],le(()=>{this.iteration=gt(0).variable(),this.accBeta1=gt(t).variable()}),r==null&&(this.epsilon=se.backend.epsilon())}applyGradients(e){const t=Array.isArray(e)?e.map(s=>s.name):Object.keys(e);le(()=>{const s=Ke(1,this.accBeta1),r=Ge(-this.learningRate,Ie(te(this.iteration,this.decay),1));t.forEach((o,i)=>{const a=se.registeredVariables[o],l=!1;this.accumulatedFirstMoment[i]==null&&(this.accumulatedFirstMoment[i]={originalName:`${o}/m`,variable:ut(a).variable(l)}),this.accumulatedWeightedInfNorm[i]==null&&(this.accumulatedWeightedInfNorm[i]={originalName:`${o}/v`,variable:ut(a).variable(l)});const u=Array.isArray(e)?e[i].tensor:e[o];if(u==null)return;const d=this.accumulatedFirstMoment[i].variable,f=this.accumulatedWeightedInfNorm[i].variable,m=Ie(te(d,this.beta1),te(u,1-this.beta1)),g=te(f,this.beta2),y=es(u),w=yi(g,y);d.assign(m),f.assign(w);const b=Ie(te(Ge(r,s),Ge(m,Ie(w,this.epsilon))),a);a.assign(b)}),this.iteration.assign(Ie(this.iteration,1)),this.accBeta1.assign(te(this.accBeta1,this.beta1))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&nt(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedWeightedInfNorm!=null&&nt(this.accumulatedWeightedInfNorm.map(e=>e.variable))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(e){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon,t.decay)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Q1 extends bi{static get className(){return"SGD"}constructor(e){super(),this.learningRate=e,this.setLearningRate(e)}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const o=Array.isArray(e)?e[r].tensor:e[s];if(o==null)return;const i=se.registeredVariables[s];le(()=>{const a=Ie(te(this.c,o),i);i.assign(a)})}),this.incrementIterations()}setLearningRate(e){this.learningRate=e,this.c!=null&&this.c.dispose(),this.c=Kr(gt(-e))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(e){if(e=await this.extractIterations(e),e.length!==0)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(e,t){return new e(t.learningRate)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class PI extends Q1{static get className(){return"Momentum"}constructor(e,t,s=!1){super(e),this.learningRate=e,this.momentum=t,this.useNesterov=s,this.accumulations=[],this.m=gt(this.momentum)}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const o=se.registeredVariables[s];this.accumulations[r]==null&&(this.accumulations[r]={originalName:`${s}/momentum`,variable:le(()=>ut(o).variable(!1))});const i=this.accumulations[r].variable,a=Array.isArray(e)?e[r].tensor:e[s];a!=null&&le(()=>{let l;const u=Ie(te(this.m,i),a);this.useNesterov?l=Ie(te(this.c,Ie(a,te(u,this.m))),o):l=Ie(te(this.c,u),o),i.assign(u),o.assign(l)})}),this.incrementIterations()}dispose(){this.m.dispose(),this.accumulations!=null&&nt(this.accumulations.map(e=>e.variable))}setMomentum(e){this.momentum=e}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=!1;this.accumulations=e.map(s=>({originalName:s.name,variable:s.tensor.variable(t)}))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(e,t){return new e(t.learningRate,t.momentum,t.useNesterov)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class FI extends bi{static get className(){return"RMSProp"}constructor(e,t=.9,s=0,r=null,o=!1){if(super(),this.learningRate=e,this.decay=t,this.momentum=s,this.epsilon=r,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=o,r==null&&(this.epsilon=se.backend.epsilon()),e==null)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const o=se.registeredVariables[s],i=!1;this.accumulatedMeanSquares[r]==null&&(this.accumulatedMeanSquares[r]={originalName:`${s}/rms`,variable:le(()=>ut(o).variable(i))}),this.accumulatedMoments[r]==null&&(this.accumulatedMoments[r]={originalName:`${s}/momentum`,variable:le(()=>ut(o).variable(i))}),this.accumulatedMeanGrads[r]==null&&this.centered&&(this.accumulatedMeanGrads[r]={originalName:`${s}/mg`,variable:le(()=>ut(o).variable(i))});const a=Array.isArray(e)?e[r].tensor:e[s];if(a==null)return;const l=this.accumulatedMeanSquares[r].variable,u=this.accumulatedMoments[r].variable;le(()=>{const d=Ie(te(l,this.decay),te(Rt(a),1-this.decay));if(this.centered){const f=this.accumulatedMeanGrads[r].variable,m=Ie(te(f,this.decay),te(a,1-this.decay)),g=Ge(te(a,this.learningRate),Bn(Ke(d,Ie(Rt(m),this.epsilon)))),y=Ie(te(u,this.momentum),g);l.assign(d),f.assign(m),u.assign(y);const w=Ke(o,y);o.assign(w)}else{const f=Ie(te(l,this.decay),te(Rt(a),1-this.decay)),m=Ie(te(u,this.momentum),Ge(te(a,this.learningRate),Bn(Ie(f,this.epsilon))));l.assign(f),u.assign(m);const g=Ke(o,m);o.assign(g)}})}),this.incrementIterations()}dispose(){this.accumulatedMeanSquares!=null&&nt(this.accumulatedMeanSquares.map(e=>e.variable)),this.accumulatedMeanGrads!=null&&this.centered&&nt(this.accumulatedMeanGrads.map(e=>e.variable)),this.accumulatedMoments!=null&&nt(this.accumulatedMoments.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&e.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=this.centered?e.length/3:e.length/2,s=!1;this.accumulatedMeanSquares=e.slice(0,t).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedMoments=e.slice(t,t*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.centered&&(this.accumulatedMeanGrads=e.slice(t*2,t*3).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(e,t){return new e(t.learningRate,t.decay,t.momentum,t.epsilon,t.centered)}}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fz=[RI,AI,DI,MI,PI,FI,Q1];function pz(){for(const n of fz)we(n)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function G2(n,e,t,s){i(n),t=t??0,s=s??1,a(t,s);let r=0;const o=l=>(l.then(u=>{const d=t+ ++r/n.length*(s-t);return e(d),u}),l);function i(l){_(l!=null&&Array.isArray(l)&&l.length>0,()=>"promises must be a none empty array")}function a(l,u){_(l>=0&&l<=1,()=>`Progress fraction must be in range [0, 1], but got startFraction ${l}`),_(u>=0&&u<=1,()=>`Progress fraction must be in range [0, 1], but got endFraction ${u}`),_(u>=l,()=>`startFraction must be no more than endFraction, but got startFraction ${l} and endFraction ${u}`)}return Promise.all(n.map(o))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function mz(n,e){e==null&&(e={});const t=e.fetchFunc==null?de().platform.fetch:e.fetchFunc,s=n.map(f=>t(f,e.requestInit,{isBinary:!0})),a=(e.onProgress==null?await Promise.all(s):await G2(s,e.onProgress,0,.5)).map(f=>f.arrayBuffer());return e.onProgress==null?await Promise.all(a):await G2(a,e.onProgress,.5,1)}function gz(n,e){var t;const s=e.fetchFunc==null?de().platform.fetch:e.fetchFunc;let r=0,o;return(t=e.onProgress)===null||t===void 0||t.call(e,0),new ReadableStream({pull:async i=>{for(var a;r<n.length;){o||(o=(await s(n[r],e.requestInit,{isBinary:!0})).body.getReader());const{done:l,value:u}=await o.read();if(l){r++,o=void 0,(a=e.onProgress)===null||a===void 0||a.call(e,r/n.length);continue}i.enqueue(u);return}i.close()}})}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xz="application/octet-stream",yz="application/json";class Y1{constructor(e,t){if(this.DEFAULT_METHOD="POST",t==null&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.weightUrlConverter=t.weightUrlConverter,t.fetchFunc!=null?(_(typeof t.fetchFunc=="function",()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"),this.fetch=t.fetchFunc):this.fetch=de().platform.fetch,_(e!=null&&e.length>0,()=>"URL path for http must not be null, undefined or empty."),Array.isArray(e)&&_(e.length===2,()=>`URL paths for http must have a length of 2, (actual length is ${e.length}).`),this.path=e,t.requestInit!=null&&t.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{},this.loadOptions=t}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");const t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);t.body=new FormData;const s=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],r=$P(e,s);if(t.body.append("model.json",new Blob([JSON.stringify(r)],{type:yz}),"model.json"),e.weightData!=null){const i=mi.join(e.weightData);t.body.append("model.weights.bin",new Blob([i],{type:xz}),"model.weights.bin")}const o=await this.fetch(this.path,t);if(o.ok)return{modelArtifactsInfo:b1(e),responses:[o]};throw new Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${o.status}.`)}async loadModelJSON(){const e=await this.fetch(this.path,this.requestInit);if(!e.ok)throw new Error(`Request to ${this.path} failed with status code ${e.status}. Please verify this URL points to the model JSON of the model to load.`);let t;try{t=await e.json()}catch{let i=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?i+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":i+=" Please make sure the server is serving valid JSON for this request.",new Error(i)}const s=t.modelTopology,r=t.weightsManifest;if(s==null&&r==null)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);return t}async load(){if(this.loadOptions.streamWeights)return this.loadStream();const e=await this.loadModelJSON();return EP(e,t=>this.loadWeights(t))}async loadStream(){const e=await this.loadModelJSON(),t=await this.getWeightUrls(e.weightsManifest),s=D2(e.weightsManifest),r=()=>gz(t,this.loadOptions);return Object.assign(Object.assign({},e),{weightSpecs:s,getWeightStream:r})}async getWeightUrls(e){const t=Array.isArray(this.path)?this.path[1]:this.path,[s,r]=vz(t),o=this.weightPathPrefix||s,i=[],a=[];for(const l of e)for(const u of l.paths)this.weightUrlConverter!=null?a.push(this.weightUrlConverter(u)):i.push(o+u+r);return this.weightUrlConverter&&i.push(...await Promise.all(a)),i}async loadWeights(e){const t=await this.getWeightUrls(e),s=D2(e),r=await mz(t,this.loadOptions);return[s,r]}}Y1.URL_SCHEME_REGEX=/^https?:\/\//;function vz(n){const e=n.lastIndexOf("/"),t=n.lastIndexOf("?"),s=n.substring(0,e),r=t>e?n.substring(t):"";return[s+"/",r]}function H2(n){return n.match(Y1.URL_SCHEME_REGEX)!=null}const LI=(n,e)=>{if(typeof fetch>"u"&&(e==null||e.fetchFunc==null))return null;{let t=!0;if(Array.isArray(n)?t=n.every(s=>H2(s)):t=H2(n),t)return jI(n,e)}return null};vn.registerSaveRouter(LI);vn.registerLoadRouter(LI);function jI(n,e){return new Y1(n,e)}function bz(n,e){return jI(n,e)}function J1(n,e){const t=n.shape.length,s=e.shape.length;if(t<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${t}.`);if(s<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${s}.`);if(e.dtype!=="int32")throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${e.dtype}.`);if(e.shape[s-1]>t)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${e.shape[s-1]} vs. ${t}`);if(pe(n.shape)===0)throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${n.shape}.`);const r=e.shape,o=r[r.length-1];let i=1;for(let f=0;f<r.length-1;++f)i*=r[f];const a=n.shape,l=r.slice();l.pop();let u=1;for(let f=o;f<t;++f)u*=a[f],l.push(a[f]);const d=[...Ve(n.shape).map(f=>f/u),1].slice(0,o);return[l,i,u,d]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Y0=-2,wz=-1;function Z1(n,e,t){const s=n.shape.length;_(s===e.length,()=>`Error in slice${s}D: Length of begin ${e} must match the rank of the array (${s}).`),_(s===t.length,()=>`Error in slice${s}D: Length of size ${t} must match the rank of the array (${s}).`);for(let r=0;r<s;++r)_(e[r]+t[r]<=n.shape[r],()=>`Error in slice${s}D: begin[${r}] + size[${r}] (${e[r]+t[r]}) would overflow input.shape[${r}] (${n.shape[r]})`)}function kz(n){const e=[];let t=0;for(;n>0;)n&1&&e.push(t),n/=2,t++;return e}function ev(n,e,t){const s=[];for(let r=0;r<n.length;r++)s[r]=Math.ceil((e[r]-n[r])/t[r]);return s}function OI(n,e,t,s){const r=[...n];for(let o=r.length;o<s.length;o++)r.push(1);for(let o=0;o<t;o++)o===0?r[e]=1:(r.splice(e,0,1),r.pop());return r}function _I(n,e,t){return t<=n?t:t-(e-1)}function zI(n,e){const t=[];for(let s=0;s<n;s++)t.push(e+s);return t}function Cz(n,e,t,s,r,o,i,a,l){const u=n.length;let d=new Array(u),f=new Array(u),m=new Array(u);if(e.length&&t>0){const g=e[0],y=t+1;d=BI(i,g,y,s,n),f=VI(a,g,y,r,n),m=OI(o,g,y,n)}else for(let g=0;g<u;g++)d[g]=UI(i,s,o,n,g,l),f[g]=GI(a,r,o,n,g,l),m[g]=WI(o,g,l);return{begin:d,end:f,strides:m}}function BI(n,e,t,s,r){const o=[...r],i=zI(t,e);for(let a=0;a<o.length;a++)if(i.indexOf(a)>-1)o[a]=0;else{const l=_I(e,t,a);let u=s[l];n&1<<l&&(u=0),o[a]=u}return o}function VI(n,e,t,s,r){const o=[...r],i=zI(t,e);for(let a=0;a<o.length;a++)if(i.indexOf(a)>-1)o[a]=Number.MAX_SAFE_INTEGER;else{const l=_I(e,t,a);let u=s[l];n&1<<l&&(u=Number.MAX_SAFE_INTEGER),o[a]=u}for(let a=0;a<o.length;a++){const l=r[a];o[a]<0&&(o[a]+=l),o[a]=Ji(0,o[a],r[a])}return o}function WI(n,e,t){let s=n[e];return(t&1<<e||s==null)&&(s=1),s}function UI(n,e,t,s,r,o){let i=e[r];const a=t[r]||1;(n&1<<r||o&1<<r||i==null)&&(a>0?i=Number.MIN_SAFE_INTEGER:i=Number.MAX_SAFE_INTEGER);const l=s[r];return i<0&&(i+=l),i=Ji(0,i,l-1),i}function GI(n,e,t,s,r,o){let i=e[r];const a=t[r]||1;(n&1<<r||o&1<<r||i==null)&&(a>0?i=Number.MAX_SAFE_INTEGER:i=Number.MIN_SAFE_INTEGER);const l=s[r];return i<0&&(i+=l),a>0?i=Ji(0,i,l):i=Ji(-1,i,l-1),i}function tv(n,e,t){let s=t.length;for(let r=0;r<t.length;r++)if(t[r]>1){s=r;break}for(let r=s+1;r<t.length;r++)if(e[r]>0||t[r]!==n[r])return!1;return!0}function nv(n,e){let t=n.length>0?n[n.length-1]:1;for(let s=0;s<n.length-1;s++)t+=n[s]*e[s];return t}function Dm(n,e,t){let s;const r=n.shape.length;typeof e=="number"?s=[e,...new Array(r-1).fill(0)]:e.length<r?s=e.concat(new Array(r-e.length).fill(0)):s=e.slice(),s.forEach(i=>{_(i!==-1,()=>"slice() does not support negative begin indexing.")});let o;return t==null?o=new Array(r).fill(-1):typeof t=="number"?o=[t,...new Array(r-1).fill(-1)]:t.length<r?o=t.concat(new Array(r-t.length).fill(-1)):o=t,o=o.map((i,a)=>i>=0?i:(_(i===-1,()=>`Negative size values should be exactly -1 but got ${i} for the slice() size at index ${a}.`),n.shape[a]-s[a])),[s,o]}function sv(n,e,t,s,r,o,i,a,l){let u;if(s==null?(u=new Array(e.length),u.fill(1)):u=s,i!=null&&(i&i-1)!==0)throw new Error("Multiple ellipses in slice is not allowed.");let d=!1;const f={dims:u.length,numAddAxisAfterEllipsis:0,begin:e.slice(),end:t.slice(),strides:u.slice(),beginMask:r,endMask:o,ellipsisMask:i,newAxisMask:a,shrinkAxisMask:l};for(let N=0;N<f.dims;N++)d&&(1<<N&a)!==0&&f.numAddAxisAfterEllipsis++,1<<N&i&&(d=!0);d||(f.ellipsisMask|=1<<f.dims,f.dims++);const m={dims:n.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};Sz(f,m);let g=!0,y=!0,w=!0;const b=[],k=[];for(let N=0;N<n.length;++N){if(m.strides[N]===0)throw Error(`strides[${N}] must be non-zero`);const S=!!(m.shrinkAxisMask&1<<N),$=n[N];if($===-1){b.push(S?1:-1);continue}const R=[m.beginMask&1<<N,m.endMask&1<<N],M=[m.strides[N]>0?0:-1,m.strides[N]>0?$:$-1];if(S&&m.strides[N]<=0)throw Error("only stride 1 allowed on non-range indexing.");w=w&&m.strides[N]===1;const A=!!(m.beginMask&1<<N&&m.endMask&1<<N);if(m.beginValid&&m.endValid){if(S){const j=m.begin[N]<0?$+m.begin[N]:m.begin[N];if(m.begin[N]=j,m.end[N]=m.begin[N]+1,j<0||j>=$)throw Error(`slice index ${m.begin[N]} of dimension ${N} out of bounds.`)}else m.begin[N]=q2(m.begin[N],0,m.strides[N],$,R,M),m.end[N]=q2(m.end[N],1,m.strides[N],$,R,M);const E=m.strides[N]===1&&m.begin[N]===0&&m.end[N]===$;g=g&&E,y=y&&(N===0&&m.strides[N]===1||E)}else g=g&&m.strides[N]===1&&A,y=y&&(N===0&&m.strides[N]===1||A);let P,D=!1;if(m.beginValid&&m.endValid?(P=m.end[N]-m.begin[N],D=!0):S?(P=1,D=!0):A&&$>=0&&(m.strides[N]<0?P=-$:P=$,D=!0),D){let E;P===0||P<0!=m.strides[N]<0?E=0:E=Math.trunc(P/m.strides[N])+(P%m.strides[N]!==0?1:0),b.push(E)}else b.push(-1)}for(let N=0;N<m.finalShapeGatherIndices.length;++N){const S=m.finalShapeGatherIndices[N];S>=0?k.push(b[S]):S===Y0&&k.push(1)}return{finalShapeSparse:k.filter((N,S)=>m.finalShapeGatherIndices[S]!==Y0),finalShape:k,isIdentity:g,sliceDim0:y,isSimpleSlice:w,begin:m.begin,end:m.end,strides:m.strides}}function Sz(n,e){e.beginMask=0,e.endMask=0,e.shrinkAxisMask=0;let t=0;e.beginValid=n.begin!=null,e.endValid=n.end!=null,e.begin=new Array(e.dims),e.end=new Array(e.dims),e.strides=new Array(e.dims),e.finalShapeGatherIndices=[],e.finalShapeGatherIndicesSparse=[],e.inputShapeGatherIndicesSparse=new Array(e.dims);for(let s=0;s<n.dims;s++)if(1<<s&n.ellipsisMask){const r=Math.min(e.dims-(n.dims-s)+1+n.numAddAxisAfterEllipsis,e.dims);for(;t<r;t++)e.begin[t]=0,e.end[t]=0,e.strides[t]=1,e.beginMask|=1<<t,e.endMask|=1<<t,e.finalShapeGatherIndices.push(t),e.finalShapeGatherIndicesSparse.push(-1),e.inputShapeGatherIndicesSparse[t]=s}else if(1<<s&n.newAxisMask)e.finalShapeGatherIndices.push(Y0),e.finalShapeGatherIndicesSparse.push(-1);else{if(t===e.begin.length)throw Error(`Index out of range using input dim ${t}; input has only ${e.dims} dims, ${e.begin.length}.`);n.begin!=null&&(e.begin[t]=n.begin[s]),n.end!=null&&(e.end[t]=n.end[s]),e.strides[t]=n.strides[s],n.beginMask&1<<s&&(e.beginMask|=1<<t),n.endMask&1<<s&&(e.endMask|=1<<t),n.shrinkAxisMask&1<<s?(e.finalShapeGatherIndices.push(wz),e.finalShapeGatherIndicesSparse.push(-1),e.shrinkAxisMask|=1<<t):(e.finalShapeGatherIndices.push(t),e.finalShapeGatherIndicesSparse.push(s)),e.inputShapeGatherIndicesSparse[t]=s,t++}}function q2(n,e,t,s,r,o){if(r[e])return t>0?o[e]:o[e+1&1];{const i=n<0?s+n:n;return i<o[0]?o[0]:i>o[1]?o[1]:i}}const Nz=Object.freeze(Object.defineProperty({__proto__:null,assertParamsValid:Z1,computeFlatOffset:nv,computeOutShape:ev,getNormalizedAxes:Cz,isSliceContinous:tv,maskToAxes:kz,parseSliceParams:Dm,sliceInfo:sv,startForAxis:UI,startIndicesWithElidedDims:BI,stopForAxis:GI,stopIndicesWithElidedDims:VI,stridesForAxis:WI,stridesWithElidedDims:OI},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Iz{static sgd(e){return new Q1(e)}static momentum(e,t,s=!1){return new PI(e,t,s)}static rmsprop(e,t=.9,s=0,r=null,o=!1){return new FI(e,t,s,r,o)}static adam(e=.001,t=.9,s=.999,r=null){return new DI(e,t,s,r)}static adadelta(e=.001,t=.95,s=null){return new RI(e,t,s)}static adamax(e=.002,t=.9,s=.999,r=null,o=0){return new MI(e,t,s,r,o)}static adagrad(e,t=.1){return new AI(e,t)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qo=Iz;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $z=typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:n=>n();function HI(){return new Promise(n=>$z(()=>n()))}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rv(n,e){const t=n[0].length;n.forEach((r,o)=>{_(r.length===t,()=>`Error in concat${t}D: rank of tensors[${o}] must be the same as the rank of the rest (${t})`)}),_(e>=0&&e<t,()=>`Error in concat${t}D: axis must be between 0 and ${t-1}.`);const s=n[0];n.forEach((r,o)=>{for(let i=0;i<t;i++)_(i===e||r[i]===s[i],()=>`Error in concat${t}D: Shape of tensors[${o}] (${r}) does not match the shape of the rest (${s}) along the non-concatenated axis ${o}.`)})}function Xr(n,e){const t=n[0].slice();for(let s=1;s<n.length;s++)t[e]+=n[s][e];return t}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Ir;(function(n){n[n.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",n[n.VALUE_ROWIDS=1]="VALUE_ROWIDS",n[n.ROW_LENGTHS=2]="ROW_LENGTHS",n[n.ROW_SPLITS=3]="ROW_SPLITS",n[n.ROW_LIMITS=4]="ROW_LIMITS",n[n.ROW_STARTS=5]="ROW_STARTS"})(Ir||(Ir={}));function qI(n,e,t){let s=new Array;if(t==null&&e==null)return s;if(e==null)for(;s.length<n+t.length;)s.push(-1);else s=e.slice();if(t==null)return s;if(n+t.length!==s.length)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.rank = ${n+t.length}, but shape.rank = ${s.length}`);for(let r=1;r<t.length;++r){const o=t[r],i=s[s.length-t.length+r],a=s[i];if(o>=0)if(a>=0){if(a!==o)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.shape[${r+n}] = ${o} but shape[${r+n}] = ${a}`)}else s[i]=o}return s}function KI(n){const e={FIRST_DIM_SIZE:Ir.FIRST_DIM_SIZE,VALUE_ROWIDS:Ir.VALUE_ROWIDS,ROW_LENGTHS:Ir.ROW_LENGTHS,ROW_SPLITS:Ir.ROW_SPLITS,ROW_LIMITS:Ir.ROW_LIMITS,ROW_STARTS:Ir.ROW_STARTS},t=[];for(const s of n)if(s in e)t.push(e[s]);else break;return t}function XI(n){return n.length===0?0:n[0]===Ir.FIRST_DIM_SIZE?n.length-1:n.length}function QI(n,e){if(n==null||e==null)return;const t=n.length,s=e.length;if(t>=s)throw new Error(`defaultValue.shape=${n} and ragged tensor flatValues.shape=${e}, are incompatible: defaultValue.rank = ${t} must be less than ragged tensor input flatValues.rank = ${s})`);for(let r=0;r<Math.min(t,s-1);++r){const o=n[r],i=e[r+1];if(o>=0&&i>=0&&o!==1&&o!==i)throw new Error(`defaultValue.shape=${n}, and ragged tensor input flatValues.shape=${e} are incompatible: defaultValue.shape[${r-n.length}] = ${o} but ragged tensor input.flatValues.shape[${r-n.length}] = ${i}`)}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ov=30;function Mm(n){return n<=ov?n:F0(n,Math.floor(Math.sqrt(n)))}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iv(n,e,t){const s=t*(typeof n=="number"?n:n[0]),r=e*(typeof n=="number"?n:n[1]);return[s,r]}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $d(n,e,t,s=!0){let r=[];if(s)r=r.concat(e.slice(0)),r.push(n[0]/t),r=r.concat(n.slice(1));else{r=r.concat(n[0]);const o=e.length;for(let i=0;i<o;++i)r=r.concat([n[i+1]/e[i],e[i]]);r=r.concat(n.slice(o+1))}return r}function Td(n,e,t=!0){const s=[];if(t){s.push(e);for(let r=e+1;r<n;++r)r<=2*e?(s.push(r),s.push(r-(e+1))):s.push(r)}else{const r=[],o=[];for(let i=1;i<n;++i)i>=e*2+1||i%2===1?o.push(i):r.push(i);s.push(...r),s.push(0),s.push(...o)}return s}function Ed(n,e,t,s=!0){const r=[];s?r.push(n[0]/t):r.push(n[0]*t);for(let o=1;o<n.length;++o)o<=e.length?s?r.push(e[o-1]*n[o]):r.push(n[o]/e[o-1]):r.push(n[o]);return r}function av(n,e){const t=[0];for(let s=0;s<e;++s)t.push(n[s][0]);return t}function lv(n,e,t){const s=n.slice(0,1);for(let r=0;r<t;++r)s.push(n[r+1]-e[r][0]-e[r][1]);return s}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pm=1.7580993408473768,Fm=1.0507009873554805;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cv=.3275911,uv=.254829592,dv=-.284496736,hv=1.421413741,fv=-1.453152027,pv=1.061405429;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function So(n,e){if(n.length!==e.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${n.length}, imag: ${e.length}.`);const t=new Float32Array(n.length*2);for(let s=0;s<t.length;s+=2)t[s]=n[s/2],t[s+1]=e[s/2];return t}function YI(n){const e=new Float32Array(n.length/2),t=new Float32Array(n.length/2);for(let s=0;s<n.length;s+=2)e[s/2]=n[s],t[s/2]=n[s+1];return{real:e,imag:t}}function JI(n){const e=Math.ceil(n.length/4),t=new Float32Array(e),s=new Float32Array(e);for(let r=0;r<n.length;r+=4)t[Math.floor(r/4)]=n[r],s[Math.floor(r/4)]=n[r+1];return{real:t,imag:s}}function ZI(n){const e=Math.floor(n.length/4),t=new Float32Array(e),s=new Float32Array(e);for(let r=2;r<n.length;r+=4)t[Math.floor(r/4)]=n[r],s[Math.floor(r/4)]=n[r+1];return{real:t,imag:s}}function mv(n,e){const t=n[e*2],s=n[e*2+1];return{real:t,imag:s}}function e$(n,e,t,s){n[s*2]=e,n[s*2+1]=t}function t$(n,e){const t=new Float32Array(n/2),s=new Float32Array(n/2);for(let r=0;r<Math.ceil(n/2);r++){const o=(e?2:-2)*Math.PI*(r/n);t[r]=Math.cos(o),s[r]=Math.sin(o)}return{real:t,imag:s}}function n$(n,e,t){const s=(t?2:-2)*Math.PI*(n/e),r=Math.cos(s),o=Math.sin(s);return{real:r,imag:o}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const r0="->",Tz=/->/g,K2=",",X2="...";function gv(n,e){n=n.replace(/\s/g,"");const t=(n.length-n.replace(Tz,"").length)/r0.length;if(t<1)throw new Error("Equations without an arrow are not supported.");if(t>1)throw new Error(`Equation must contain exactly one arrow ("${r0}").`);const[s,r]=n.split(r0);_(s.indexOf(X2)===-1,()=>`The ellipsis notation ("${X2}") is not supported yet.`);const o=s.split(K2),i=o.length;if(e!==i)throw new Error(`Expected ${i} input tensors, received ${e}`);if(i>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");const a=[];for(let m=0;m<r.length;++m){const g=r[m];if(!o.some(y=>y.indexOf(g)!==-1))throw new Error(`Output subscripts contain the label ${g} not present in the input subscripts.`);a.indexOf(g)===-1&&a.push(g)}for(let m=0;m<s.length;++m){const g=s[m];a.indexOf(g)===-1&&g!==K2&&a.push(g)}const l=new Array(o.length);for(let m=0;m<i;++m){if(new Set(o[m].split("")).size!==o[m].length)throw new Error(`Found duplicate axes in input component ${o[m]}. Support for duplicate axes in input is not implemented yet.`);l[m]=[];for(let g=0;g<o[m].length;++g)l[m].push(a.indexOf(o[m][g]))}const u=a.length,d=r.length,f=[];for(let m=d;m<u;++m)f.push(m);return{allDims:a,summedDims:f,idDims:l}}function xv(n,e){let t=new Array(n);t.fill(-1);for(let r=0;r<e.length;++r)t[e[r]]=r;const s=[];for(let r=0;r<n;++r)t[r]===-1&&s.push(r);return t=t.filter(r=>r!==-1),{permutationIndices:t,expandDims:s}}function yv(n,e,t){const s=new Array(n);for(let r=0;r<t.length;++r){const o=t[r].shape;for(let i=0;i<e[r].length;++i)s[e[r][i]]===void 0?s[e[r][i]]=o[i]:_(s[e[r][i]]===o[i],()=>`Expected dimension ${s[e[r][i]]} at axis ${i} of input shaped ${JSON.stringify(o)}, but got dimension ${o[i]}`)}}function vv(n,e){const t=n,s=[];let r=0;n.length===0&&t.push(-1),r=n.length+1;for(let i=0;i<r;++i)s.push([]);const o=[];for(let i=0;i<t.length;++i){const a=t[i],l=Ez(e,a);for(const u of l)o.indexOf(u)===-1&&(s[i].push(u),o.push(u))}return{path:t,steps:s}}function bv(n){return n.every((e,t)=>e===t)}function Ez(n,e){const t=[];for(let s=0;s<n.length;++s)(n[s].length===0||n[s].indexOf(e)!==-1||e===-1)&&t.push(s);return t}function wv(n,e,t=0){let s=[];if(typeof e=="number")_(n.shape[t]%e===0,()=>"Number of splits must evenly divide the axis."),s=new Array(e).fill(n.shape[t]/e);else{const r=e.reduce((i,a)=>(a===-1&&(i+=1),i),0);_(r<=1,()=>"There should be only one negative value in split array.");const o=e.indexOf(-1);if(o!==-1){const i=e.reduce((a,l)=>l>0?a+l:a);e[o]=n.shape[t]-i}_(n.shape[t]===e.reduce((i,a)=>i+a),()=>"The sum of sizes must match the size of the axis dimension."),s=e}return s}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function s$(n){return`Received SparseTensor with denseShape[0] = 0 but
  indices.shape[0] = ${n}`}function r$(n,e){return`indices(${n}, 0) is invalid: ${e} < 0`}function o$(n,e,t){return`indices(${n}, 0) is invalid: ${e} >= ${t}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function i$(n,e){return`only one output dimension may be -1, not both ${n} and ${e}`}function a$(n,e){return`size ${n} must be non-negative, not ${e}`}function l$(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function c$(n,e){const t=pe(n),s=pe(e);return`Input to reshape is a SparseTensor with ${t}
  dense values, but the requested shape requires a multiple of ${s}. inputShape=${n} outputShape= ${e}`}function u$(n,e){const t=pe(n),s=pe(e);return`Input to reshape is a tensor with ${t} dense values, but the requested shape has ${s}. inputShape=${n} outputShape=${e}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function J0(){return"segment ids must be >= 0"}function d$(){return"segment ids are not increasing"}function h$(n,e){return`Segment id ${n} out of range [0, ${e}), possibly because segmentIds input is not sorted.`}function f$(n,e,t){return`Bad: indices[${n}] == ${e} out of range [0, ${t})`}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p$(n,e){let t=!1,s;for(n<=ov?(s=n,t=!0):s=F0(n,Math.floor(Math.sqrt(n)));!t;)s>e||s===n?t=!0:s=F0(n,s+1);return s}function m$(n,e,t){const s=[],r=n.length;for(let o=0;o<r;o++)o!==e?s.push(n[o]):s.push(t);return s}function kv(n,e,t,s){const r=e.shape.length,o=n.shape.length;if(s!==0&&(s<-r||s>r))throw new Error(`Expect batchDims in the range of [-${r}, ${r}], but got ${s}`);if(s<0&&(s+=r),s>o)throw new Error(`batchDims (${s}) must be less than rank(x) (
    ${o}).`);if(t<s)throw new Error(`batchDims (${s}) must be less than or equal to axis (${t}).`);for(let f=0;f<s;++f)if(n.shape[f]!==e.shape[f])throw new Error(`x.shape[${f}]: ${n.shape[f]} should be equal to indices.shape[${f}]: ${e.shape[f]}.`);const i=n.shape[t],a=[];let l=1,u=1,d=1;for(let f=0;f<s;++f)a.push(n.shape[f]),l*=n.shape[f];for(let f=s;f<t;f++)a.push(n.shape[f]),u*=n.shape[f];for(let f=s;f<r;f++)a.push(e.shape[f]);for(let f=t+1;f<o;f++)a.push(n.shape[f]),d*=n.shape[f];return{batchSize:l,sliceSize:d,outerSize:u,dimSize:i,outputShape:a}}const Rz=Object.freeze(Object.defineProperty({__proto__:null,collectGatherOpShapeInfo:kv,computeOutShape:m$,segOpComputeOptimalWindowSize:p$},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function No(n){try{return n.map(e=>ai(e))}catch(e){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${e}`)}}function g$(n){return n.map(e=>ri(e))}const Az=Object.freeze(Object.defineProperty({__proto__:null,ERF_A1:uv,ERF_A2:dv,ERF_A3:hv,ERF_A4:fv,ERF_A5:pv,ERF_P:cv,PARALLELIZE_THRESHOLD:ov,get RowPartitionType(){return Ir},SELU_SCALE:Fm,SELU_SCALEALPHA:Pm,applyActivation:U1,assertAndGetBroadcastShape:Ze,assertAxesAreInnerMostDims:Dn,assertParamsConsistent:rv,assignToTypedArray:e$,axesAreInnerMostDims:$1,calculateShapes:va,checkEinsumDimSizes:yv,checkPadOnDimRoundingMode:vs,combineLocations:iI,combineRaggedTensorToTensorShapes:qI,complexWithEvenIndex:JI,complexWithOddIndex:ZI,computeConv2DInfo:An,computeConv3DInfo:gi,computeDefaultPad:w1,computeDilation2DInfo:kd,computeOptimalWindowSize:Mm,computeOutAndReduceShapes:Sn,computeOutShape:Xr,computePool2DInfo:ur,computePool3DInfo:$o,convertConv2DDataFormat:To,decodeEinsumEquation:gv,eitherStridesOrDilationsAreOne:Vn,expandShapeToKeepDim:an,exponent:n$,exponents:t$,fromStringArrayToUint8:g$,fromUint8ToStringArray:No,getAxesPermutation:Bt,getBroadcastDims:kl,getComplexWithIndex:mv,getEinsumComputePath:vv,getEinsumPermutation:xv,getFusedBiasGradient:W1,getFusedDyActivation:V1,getImageCenter:iv,getInnerMostAxes:Zt,getPermuted:Td,getRaggedRank:XI,getReductionAxes:mn,getReshaped:$d,getReshapedPermuted:Ed,getRowPartitionTypesHelper:KI,getSliceBeginCoords:av,getSliceSize:lv,getSparseFillEmptyRowsIndicesDenseShapeMismatch:s$,getSparseFillEmptyRowsNegativeIndexErrorMessage:r$,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:o$,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:l$,getSparseReshapeInputOutputMismatchErrorMessage:u$,getSparseReshapeInputOutputMultipleErrorMessage:c$,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:i$,getSparseReshapeNegativeOutputDimErrorMessage:a$,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:f$,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:J0,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:d$,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:h$,getUndoAxesPermutation:xi,isIdentityPermutation:bv,log:HM,mergeRealAndImagArrays:So,prepareAndValidate:J1,prepareSplitSize:wv,segment_util:Rz,shouldFuse:G1,slice_util:Nz,splitRealAndImagArrays:YI,stridesOrDilationsArePositive:ra,tupleValuesAreOne:sa,upcastType:As,validateDefaultValueShape:QI,validateInput:n_,validateUpdateShape:SI,warn:Bs},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pz();/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const x$={kernelName:Cp,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>te(n,Id(Ae(t,"float32"),-1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dz={kernelName:$u,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const s=Rt(Ae(t,"float32")),r=Bn(Ke(gt(1),s));return Yt(Ge(n,r))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mz={kernelName:Tu,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const s=Bn(Ke(Rt(Ae(t,"float32")),1));return Ge(n,s)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pz={kernelName:Ll,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=Ze(t.shape,s.shape);return{a:()=>{let a=n;const l=mn(t.shape,r);return l.length>0&&(a=We(a,l)),re(a,t.shape)},b:()=>{let a=n;const l=mn(s.shape,r);return l.length>0&&(a=We(a,l)),re(a,s.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fz={kernelName:Ay,saveAllInputs:!0,gradFunc:(n,e)=>{const t={};return e.forEach((s,r)=>{t[r]=()=>n.clone()}),t}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lz={kernelName:Sp,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ut(t)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jz={kernelName:Np,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ut(t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Oz={kernelName:Eu,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Ge(n,Bn(Ke(gt(1),Rt(Ae(t,"float32")))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _z={kernelName:Ru,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const s=Bn(Ie(gt(1),Rt(Ae(t,"float32"))));return Ge(n,s)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zz={kernelName:Mu,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=Ze(t.shape,s.shape);return{a:()=>{const a=Ie(Rt(t),Rt(s));let l=te(n,Ge(s,a));const u=mn(t.shape,r);return u.length>0&&(l=We(l,u)),re(l,t.shape)},b:()=>{const a=Ie(Rt(t),Rt(s));let l=Yt(te(n,Ge(t,a)));const u=mn(s.shape,r);return u.length>0&&(l=We(l,u)),re(l,s.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bz={kernelName:Au,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Ge(n,Ie(Rt(Ae(t,"float32")),1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vz={kernelName:Du,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Ge(n,Ke(gt(1),Rt(Ae(t,"float32"))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wz(n,e,t,s,r,o){const i=K(n,"dy","avgPool3dGrad"),a=K(e,"input","avgPool3dGrad");let l=i,u=a,d=!1;a.rank===4&&(d=!0,l=re(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]]),u=re(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]])),_(l.rank===5,()=>`Error in avgPool3dGrad: dy must be rank 5 but got rank ${l.rank}.`),_(u.rank===5,()=>`Error in avgPool3dGrad: input must be rank 5 but got rank ${u.rank}.`),vs("avgPool3dGrad",r,o);const f={dy:l,input:u},m={filterSize:t,strides:s,pad:r,dimRoundingMode:o},g=se.runKernel(Fy,f,m);return d?re(g,[g.shape[1],g.shape[2],g.shape[3],g.shape[4]]):g}const Uz=ie({avgPool3dGrad_:Wz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gz={kernelName:$p,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{filterSize:r,strides:o,pad:i,dimRoundingMode:a}=t;return{x:()=>Uz(n,s,r,o,i,a)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hz(n,e,t,s,r){const o=K(n,"dy","avgPoolGrad"),i=K(e,"input","avgPoolGrad");_(i.rank===o.rank,()=>`Rank of input (${i.rank}) does not match rank of dy (${o.rank})`);let a=i,l=o,u=!1;i.rank===3&&(u=!0,a=re(i,[1,i.shape[0],i.shape[1],i.shape[2]]),l=re(o,[1,o.shape[0],o.shape[1],o.shape[2]])),_(l.rank===4,()=>`Error in avgPoolGrad: dy must be rank 4 but got rank ${l.rank}.`),_(a.rank===4,()=>`Error in avgPoolGrad: input must be rank 4 but got rank ${a.rank}.`);const d={dy:l,input:a},f={filterSize:t,strides:s,pad:r},m=se.runKernel(Py,d,f);return u?re(m,[m.shape[1],m.shape[2],m.shape[3]]):m}const qz=ie({avgPoolGrad_:Hz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kz={kernelName:Ip,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{filterSize:r,strides:o,pad:i}=t;return{x:()=>qz(n,s,r,o,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xz={kernelName:Tp,inputsToSave:["a","b"],gradFunc:(n,e,t)=>{const[s,r]=e,{transposeA:o,transposeB:i}=t;return!o&&!i?{a:()=>mt(n,r,!1,!0),b:()=>mt(s,n,!0,!1)}:!o&&i?{a:()=>mt(n,r,!1,!1),b:()=>mt(n,s,!0,!1)}:o&&!i?{a:()=>mt(r,n,!1,!0),b:()=>mt(s,n,!1,!1)}:{a:()=>mt(r,n,!0,!0),b:()=>mt(n,s,!0,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qz={kernelName:Ep,gradFunc:(n,e,t)=>{const{blockShape:s,crops:r}=t;return{x:()=>F1(n,s,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yz={kernelName:VM,gradFunc:(n,e,t)=>{const s=t,r=s.inputShape,o=s.shape,i=Array.from(o);for(let l=r.length-1;l>=0;l--)if(r[l]===o[l])i[l]=1;else if(r[l]!==1)throw new Error(`broadcastTo(): [${r}] cannot be broadcast to [${o}].`);const a=[];for(let l=0;l<i.length;l++)i[l]>1&&a.push(l);return{x:()=>We(n,a,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jz={kernelName:Pu,gradFunc:n=>({x:()=>n.clone()})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zz={kernelName:Fu,gradFunc:n=>({x:()=>ut(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const e5={kernelName:Lu,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{clipValueMin:r,clipValueMax:o}=t;return{x:()=>ss(ko(xa(s,r),Ol(s,o)),n,ut(n))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const t5={kernelName:Rp,inputsToSave:["x"],gradFunc:x$.gradFunc};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const n5={kernelName:Ap,saveAllInputs:!0,gradFunc:(n,e,t)=>{const s=e.map(l=>l.shape),{axis:r}=t,o=rt(r,e[0].shape)[0],i=s.map(l=>l[o]);return Ws(n,i,o).map(l=>()=>l)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const s5={kernelName:Dp,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const[s,r]=e,{dilations:o,strides:i,pad:a,dataFormat:l}=t;return _(sa(o),()=>`Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${o}'`),{x:()=>S1(s.shape,n,r,i,a,l),filter:()=>B1(s,n,r.shape,i,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const r5={kernelName:Mp,inputsToSave:["dy","filter"],gradFunc:(n,e,t)=>{const[s,r]=e,{strides:o,pad:i,dataFormat:a,dimRoundingMode:l}=t;return{dy:()=>oa(n,r,o,i,a,1,l),filter:()=>B1(n,s,r.shape,o,i,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o5(n,e,t,s,r){let o=n;n.rank===4&&(o=re(n,[1,n.shape[0],n.shape[1],n.shape[2],n.shape[3]]));let i=e;i.rank===4&&(i=re(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]])),_(o.rank===5,()=>`Error in conv3dDerFilter: input must be rank 5, but got shape ${o.shape}.`),_(i.rank===5,()=>`Error in conv3dDerFilter: dy must be rank 5, but got shape ${i.shape}.`),_(t.length===5,()=>`Error in conv3dDerFilter: filterShape must be length 5, but got ${t}.`),_(o.shape[4]===t[3],()=>`Error in conv3dDerFilter: depth of input ${o.shape[4]}) must match input depth in filter (${t[3]}.`),_(i.shape[4]===t[4],()=>`Error in conv3dDerFilter: depth of dy (${i.shape[4]}) must match output depth for filter (${t[4]}).`);const a={x:o,dy:i},l={strides:s,pad:r,filterShape:t};return se.runKernel(zy,a,l)}const i5=ie({conv3DBackpropFilter_:o5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const a5={kernelName:Pp,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const{dilations:s,strides:r,pad:o}=t;_(sa(s),()=>`Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${s}'`);const[i,a]=e;return{x:()=>nI(i.shape,n,a,r,o),filter:()=>i5(i,n,a.shape,r,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const l5={kernelName:ju,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>te(Yt(bI(Ae(t,"float32"))),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const c5={kernelName:Ou,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>te(wI(Ae(t,"float32")),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const u5={kernelName:Fp,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{axis:r,exclusive:o,reverse:i}=t;return{x:()=>{const a=Bt([r],s.rank);let l=rI(n,r,o,!i);return a!=null&&(l=ct(l,a)),l}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const d5={kernelName:Lp,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const{dilations:s,strides:r,pad:o,dimRoundingMode:i}=t,a=s??[1,1];_(sa(a),()=>`Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '${a}'`);const[l,u]=e;return _(l.rank===4,()=>`Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ${l.rank}.`),_(u.rank===4,()=>`Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ${u.rank}.`),_(l.shape[3]===u.shape[2],()=>`Error in gradient of depthwiseConv2d: number of input channels (${l.shape[3]}) must match the inChannels dimension in filter ${u.shape[2]}.`),_(Vn(r,a),()=>`Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ${r} and dilations '${a}'.`),vs("depthwiseConv2d",o,i),{x:()=>w_(l.shape,n,u,r,o,a,i),filter:()=>v_(l,n,u.shape,r,o,a,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const h5={kernelName:jp,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const[s,r]=e,o={x:s,filter:r,dy:n},i={x:s,filter:r,dy:n};return{x:()=>se.runKernel(L0,o,t),filter:()=>se.runKernel(j0,i,t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const f5={kernelName:zu,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e,s={dy:n,y:t};return{x:()=>se.runKernel(Xy,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const p5={kernelName:Bu,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e,s=te(eo(Yt(Rt(t))),2/Math.sqrt(Math.PI));return{x:()=>te(n,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const m5={kernelName:Vu,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e;return{x:()=>te(n,t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const g5={kernelName:_p,inputsToSave:["input"],gradFunc:(n,e)=>{const[t]=e;return{input:()=>re(n,t.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const x5={kernelName:Wu,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>te(n,eo(t))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const y5={kernelName:Uu,gradFunc:n=>({x:()=>ut(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const v5={kernelName:Gu,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=Ze(t.shape,s.shape);return{a:()=>{const a=Ge(n,Ae(s,"float32")),l=mn(t.shape,r);return l.length>0?re(We(a,l),t.shape):a},b:()=>{let a=te(n,Ae(t,"float32"));const l=mn(s.shape,r);l.length>0&&(a=re(We(a,l),s.shape));const u=Rt(s);return Yt(Ge(a,Ae(u,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const b5={kernelName:zp,inputsToSave:["x","mean","variance","scale"],gradFunc:(n,e,t)=>{const{varianceEpsilon:s}=t,[r,o,i,a]=e,l=a??gt(1),u=mn(o.shape,r.shape),d=[];if(o.rank===1){for(let S=0;S<r.shape.length-1;++S)d.push(r.shape[S]);d.push(1)}const f=Ke(r,o),m=te(n,l),g=xI(Ie(i,gt(s))),y=te(te(te(g,g),g),gt(-.5));return{x:()=>o.rank===1?re(te(te(n,$r(re(g,[1,1,1,o.shape[0]]),d)),l),r.shape):re(te(te(n,g),l),r.shape),mean:()=>{let S=te(te(g,gt(-1)),m);return o.rank===1&&(S=We(S,u)),re(S,o.shape)},variance:()=>{let S=te(te(y,f),m);return o.rank===1&&(S=We(S,u)),re(S,o.shape)},scale:()=>{const S=te(f,g);let $=te(n,S);return o.rank===1&&($=We($,u)),re($,o.shape)},offset:()=>{let S=n;return o.rank===1&&(S=We(S,u)),re(S,o.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const w5={kernelName:Bp,inputsToSave:["x","indices"],gradFunc:(n,e,t)=>{const[s,r]=e,{axis:o,batchDims:i}=t,a=rt(o,s.shape)[0],l=(u,d,f)=>()=>{const m=u.shape,g=d.size,y=m.slice(0,a),w=y.length,b=m.slice(o,m.length).slice(1),k=b.length,v=Q2(0,w),N=Q2(w+1,w+1+k),S=Y2([y,[g],b]),$=re(f,S),R=re(d,[g]),M=Y2([[w],v,N]),A=ct($,M);let P=II(A,R,u.shape[a]);const D=xi(M);return P=ct(P,D),P};if(i===1){const u=s.shape[0],d=s.split(u,0);return{x:()=>Co(d.map((g,y)=>l(g,r.slice(y,1),n.slice(y,1))())).reshape(s.shape),indices:()=>r}}else return{x:l(s,r,n),indices:()=>r}}};function Q2(n,e){const t=[];for(let s=n;s<e;++s)t.push(s);return t}function Y2(n){const e=[];for(let t=0;t<n.length;++t)for(let s=0;s<n[t].length;++s)e.push(n[t][s]);return e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const k5={kernelName:Hu,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e;return{a:()=>ut(t),b:()=>ut(s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const C5={kernelName:qu,gradFunc:n=>({x:()=>Ae(n,"float32")})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const S5={kernelName:Ku,gradFunc:n=>({x:()=>ut(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const N5={kernelName:Xu,gradFunc:n=>({x:()=>ut(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const I5={kernelName:Qu,gradFunc:n=>({x:()=>ut(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $5={kernelName:Wp,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{alpha:r}=t,o=Gs(s,0);return{x:()=>ss(o,n,te(n,r))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const T5={kernelName:Ju,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Ge(n,Ie(t,1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const E5={kernelName:Yu,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Ge(n,Ae(t,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const R5={kernelName:UM,inputsToSave:[],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[s]=e,{axis:r}=t;return{logits:()=>{const i=eo(s);return Ke(n,te(We(n,r,!0),i))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function A5(n,e,t,s=5,r=1,o=1,i=.5){const a={x:n,y:e,dy:t},l={depthRadius:s,bias:r,alpha:o,beta:i};return se.runKernel(t1,a,l)}const D5=ie({localResponseNormalizationBackprop_:A5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const M5={kernelName:Xp,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[s,r]=e,{depthRadius:o,bias:i,alpha:a,beta:l}=t;return{x:()=>D5(s,r,n,o,i,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function y$(n,e,t,s){return e.rank<t.rank&&(e=re(e,an(e.shape,s))),n.rank<t.rank&&(n=re(n,an(n.shape,s))),{x:()=>te(n,Ae(Zr(t,e),n.dtype))}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const J2={kernelName:Qp,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const s=t,{reductionIndices:r}=s,o=e[0],i=e[1],a=rt(r,o.shape),l=y$(n,i,o,a);return{x:()=>l.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const P5={kernelName:Zu,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e;return{a:()=>te(n,Ae(xa(t,s),"float32")),b:()=>te(n,Ae(Uf(t,s),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function F5(n,e,t,s,r,o,i){const a=K(n,"dy","maxPool3dGrad"),l=K(e,"input","maxPool3dGrad"),u=K(t,"output","maxPool3dGrad");let d=a,f=l,m=u,g=!1;l.rank===4&&(g=!0,d=re(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]]),f=re(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]]),m=re(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]])),_(d.rank===5,()=>`Error in maxPool3dGrad: dy must be rank 5 but got rank ${d.rank}.`),_(f.rank===5,()=>`Error in maxPool3dGrad: input must be rank 5 but got rank ${f.rank}.`),_(m.rank===5,()=>`Error in maxPool3dGrad: output must be rank 5 but got rank ${m.rank}.`),vs("maxPool3dGrad",o,i);const y={dy:d,input:f,output:m},w={filterSize:s,strides:r,pad:o,dimRoundingMode:i},b=se.runKernel(s1,y,w);return g?re(b,[b.shape[1],b.shape[2],b.shape[3],b.shape[4]]):b}const L5=ie({maxPool3dGrad_:F5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const j5={kernelName:Jp,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[s,r]=e,{filterSize:o,strides:i,pad:a,dimRoundingMode:l}=t;return{x:()=>L5(n,s,r,o,i,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function O5(n,e,t,s,r,o,i){const a=K(n,"dy","maxPoolGrad"),l=K(e,"input","maxPoolGrad"),u=K(t,"output","maxPoolGrad");_(l.rank===a.rank,()=>`Rank of input (${l.rank}) does not match rank of dy (${a.rank})`),_(a.rank===4,()=>`Error in maxPoolGrad: dy must be rank 4 but got rank ${a.rank}.`),_(l.rank===4,()=>`Error in maxPoolGrad: input must be rank 4 but got rank ${l.rank}.`),vs("maxPoolGrad",o,i);const d={dy:a,input:l,output:u},f={filterSize:s,strides:r,pad:o,dimRoundingMode:i};return se.runKernel(n1,d,f)}const _5=ie({maxPoolGrad_:O5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const z5={kernelName:Yp,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[s,r]=e,{filterSize:o,strides:i,pad:a}=t;return{x:()=>_5(n,s,r,o,i,a)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const B5={kernelName:Zp,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{axis:r}=t,o=rt(r,s.shape),a=Sn(s.shape,o)[1],l=pe(a);return{x:()=>{const d=s.shape.slice();o.forEach(g=>{d[g]=1});const f=re(n,d);return Ge(te(f,vi(s.shape,"float32")),l)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const V5={kernelName:em,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const s=t,{axis:r}=s,[o,i]=e,a=rt(r,o.shape),l=y$(n,i,o,a);return{x:()=>l.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const W5={kernelName:ed,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e;return{a:()=>te(n,Ae(Ol(t,s),"float32")),b:()=>te(n,Ae(Gs(t,s),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const U5={kernelName:tm,inputsToSave:["x"],gradFunc:(n,e,t)=>{const s=e[0],{paddings:r}=t,o=r.map(i=>i[0]);return{x:()=>$t(n,o,s.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const G5={kernelName:td,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=Ze(t.shape,s.shape);return{a:()=>{const a=mn(t.shape,r);return a.length>0?re(We(n,a),t.shape):n},b:()=>{const a=te(n,Yt(Am(Ge(t,s)))),l=mn(s.shape,r);return l.length>0?re(We(a,l),s.shape):a}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const H5={kernelName:nd,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=Ze(t.shape,s.shape);return{a:()=>{const a=te(n,Ae(s,"float32")),l=mn(t.shape,r);return l.length>0?re(We(a,l),t.shape):a},b:()=>{const a=te(n,Ae(t,"float32")),l=mn(s.shape,r);return l.length>0?re(We(a,l),s.shape):a}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const q5={kernelName:nm,gradFunc:n=>({x:()=>Yt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const K5={kernelName:om,inputsToSave:["indices"],gradFunc:(n,e)=>{const t=e[0];return{indices:()=>kn(t.shape,"float32")}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const X5={kernelName:rm,gradFunc:n=>({x:()=>ut(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Q5={kernelName:im,saveAllInputs:!0,gradFunc:(n,e,t)=>{const{axis:s}=t;return la(n,s).map(o=>()=>o)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Z2={kernelName:am,inputsToSave:["x"],gradFunc:(n,e,t)=>{const s=e[0],{paddings:r}=t,o=r.map(i=>i[0]);return{x:()=>$t(n,o,s.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Y5={kernelName:sd,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(n,e)=>{const[t,s,r]=e,o=t,i=s,a=Ze(o.shape,i.shape);return{a:()=>{const d=Ae(i,"float32");let f=te(n,te(d,ia(o,Ke(d,gt(1)))));const m=mn(o.shape,a);return m.length>0&&(f=We(f,m)),re(f,o.shape)},b:()=>{const d=Gs(o,0),f=ss(d,to(o),ut(o));let m=te(n,te(r,f));const g=mn(i.shape,a);return g.length>0&&(m=We(m,g)),re(m,i.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const J5={kernelName:lm,inputsToSave:["x","alpha"],gradFunc:(n,e)=>{const[t,s]=e,r=Gs(t,0);return{x:()=>ss(r,n,te(n,s)),alpha:()=>{let o=ss(r,ut(n),te(n,t));const i=mn(s.shape,n.shape);return i.length>0&&(o=We(o,i)),re(o,s.shape)}}}};/**
 * @license
 * Copyright 2022 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z5(n,e,t){const s=n.shape.slice();s[t]=1;const r=re(e,s),o=X0(n,t,!0,!1),i=X0(n,t,!0,!0),a=te(o,i);return te(r,a)}function eB(n,e,t){const s=n.shape.length,r=s-t.length,o=Bt(t,s);let i=n;o!=null&&(i=ct(n,o));const a=i.shape.slice(),u=a.splice(s-t.length,t.length).reduce((m,g)=>m*g,1);a.push(u);const d=i.reshape(a);let f=Z5(d,e,r);if(f=f.reshape(i.shape),o!=null){const m=xi(o);f=ct(f,m)}return f}const tB={kernelName:cm,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{axis:r}=t;let o=[];return r==null?o=s.shape.map((i,a)=>a):typeof r=="number"?o=[r]:o=r,{x:()=>eB(s,n,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nB={kernelName:_u,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=Ze(t.shape,s.shape);return{a:()=>{const a=Ge(n,Ae(s,"float32")),l=mn(t.shape,r);return l.length>0?re(We(a,l),t.shape):a},b:()=>{let a=te(n,Ae(t,"float32"));const l=mn(s.shape,r);l.length>0&&(a=re(We(a,l),s.shape));const u=Rt(s);return Yt(Ge(a,Ae(u,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sB={kernelName:rd,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Ge(n,Yt(Rt(t)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rB={kernelName:id,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e,s=te(Ol(t,6),Id(t));return{x:()=>te(n,Ae(s,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oB={kernelName:od,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>te(n,Ae(Id(t),"float32"))}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iB={kernelName:um,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>re(n,t.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aB={kernelName:hm,inputsToSave:["images"],gradFunc:(n,e,t)=>{const[s]=e,r={dy:n,images:s};return{images:()=>se.runKernel(u1,r,t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lB={kernelName:dm,inputsToSave:["images"],gradFunc:(n,e,t)=>{const[s]=e,r={dy:n,images:s};return{images:()=>se.runKernel(c1,r,t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cB={kernelName:fm,gradFunc:(n,e,t)=>{const{dims:s}=t,r=rt(s,n.shape);return{x:()=>aa(n,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uB={kernelName:ad,gradFunc:n=>({x:()=>ut(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dB={kernelName:ld,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Yt(Ge(n,te(ia(t,1.5),2)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hB={kernelName:pm,inputsToSave:["condition"],gradFunc:(n,e)=>{const[t]=e;return{condition:()=>Ae(ut(t),"float32"),t:()=>te(n,Ae(t,n.dtype)),e:()=>te(n,Ae(A1(t),n.dtype))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fB={kernelName:cd,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const s=Gs(t,gt(0)),r=gt(Pm),o=gt(Fm),i=te(n,o),a=te(te(n,r),eo(Ae(t,"float32")));return ss(s,i,a)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pB={kernelName:fd,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e;return{x:()=>te(n,te(t,Ke(gt(1),t)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mB={kernelName:hd,gradFunc:n=>({x:()=>ut(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gB={kernelName:ud,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>te(N1(Ae(t,"float32")),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xB={kernelName:dd,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>te(sI(Ae(t,"float32")),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yB={kernelName:mm,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{begin:r,size:o}=t,i=s.shape,[a,l]=Dm(s,r,o),u=[];for(let d=0;d<n.rank;d++)u.push([a[d],i[d]-a[d]-l[d]]);return{x:()=>P1(n,u)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vB={kernelName:vm,outputsToSave:[!0],gradFunc:(n,e,t)=>{const[s]=e,{dim:r}=t,o=!0,i=te(n,s);return{logits:()=>Ke(i,te(We(i,[r],o),s))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bB={kernelName:pd,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>te(n,jl(t))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eC={kernelName:xm,gradFunc:(n,e,t)=>{const{blockShape:s,paddings:r}=t;return{x:()=>C1(n,s,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tC={kernelName:ym,gradFunc:(n,e,t)=>{const{axis:s}=t;return{x:()=>ms(n,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wB={kernelName:md,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Ge(n,te(Bn(Ae(t,"float32")),2))}}};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kB={kernelName:d1,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>te(n,te(Ae(t,"float32"),2))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CB={kernelName:gd,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=gt(2);return{a:()=>te(n,te(r,Ke(t,s))),b:()=>te(n,te(r,Ke(s,t)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SB={kernelName:wd,gradFunc:n=>({x:()=>ut(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NB={kernelName:xd,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=Ze(t.shape,s.shape);return{a:()=>{let a=n;const l=mn(t.shape,r);return l.length>0&&(a=We(a,l)),re(a,t.shape)},b:()=>{let a=n;const l=mn(s.shape,r);return l.length>0&&(a=We(a,l)),re(Yt(a),s.shape)}}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IB={kernelName:gm,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,r=s.shape.slice(),{axis:o}=t;rt(o,s.shape).forEach(u=>{r[u]=1});const a=re(n,r),l=te(a,vi(s.shape,"float32"));return{x:()=>l}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $B={kernelName:yd,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Ge(n,Rt(N1(t)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TB={kernelName:vd,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e;return{x:()=>te(Ke(gt(1),Rt(t)),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EB={kernelName:bd,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{reps:r}=t;return{x:()=>{let i=ut(s);if(s.rank===1)for(let a=0;a<r[0];++a)i=Ie(i,$t(n,[a*s.shape[0]],[s.shape[0]]));else if(s.rank===2)for(let a=0;a<r[0];++a)for(let l=0;l<r[1];++l)i=Ie(i,$t(n,[a*s.shape[0],l*s.shape[1]],[s.shape[0],s.shape[1]]));else if(s.rank===3)for(let a=0;a<r[0];++a)for(let l=0;l<r[1];++l)for(let u=0;u<r[2];++u)i=Ie(i,$t(n,[a*s.shape[0],l*s.shape[1],u*s.shape[2]],[s.shape[0],s.shape[1],s.shape[2]]));else if(s.rank===4)for(let a=0;a<r[0];++a)for(let l=0;l<r[1];++l)for(let u=0;u<r[2];++u)for(let d=0;d<r[3];++d)i=Ie(i,$t(n,[a*s.shape[0],l*s.shape[1],u*s.shape[2],d*s.shape[3]],[s.shape[0],s.shape[1],s.shape[2],s.shape[3]]));else throw new Error(`Gradient for tile operation is not implemented for rank-${s.rank} tensors yet.`);return i}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RB={kernelName:ll,gradFunc:(n,e,t)=>{const s=t,{perm:r}=s,o=xi(r);return{x:()=>ct(n,o)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AB={kernelName:bm,gradFunc:(n,e,t)=>{const s=t,{axis:r}=s;return{value:()=>Co(n,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DB={kernelName:wm,inputsToSave:["segmentIds"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>MB(n,t)}}};function MB(n,e){const t=yi(e,ut(e)),s=T1(n,t);let r=xa(e,gt(0,"int32"));const o=s.rank-r.rank;for(let a=0;a<o;++a)r=hs(r,a+1);r=ko(r,vi(s.shape,"bool"));const i=ut(s);return ss(r,s,i)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PB={kernelName:km,gradFunc:n=>({x:()=>ut(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FB=[x$,Dz,Mz,Pz,Fz,Lz,jz,Oz,_z,zz,Bz,Vz,Gz,Kz,Xz,Qz,Yz,Jz,Zz,e5,t5,n5,r5,s5,a5,l5,c5,u5,d5,h5,nB,f5,p5,m5,g5,x5,v5,y5,b5,w5,k5,C5,S5,N5,I5,$5,T5,E5,R5,M5,J2,J2,P5,j5,z5,B5,V5,W5,U5,G5,H5,q5,K5,X5,Q5,Z2,Z2,Y5,J5,tB,sB,rB,oB,iB,aB,lB,cB,uB,dB,hB,fB,pB,mB,gB,xB,yB,vB,bB,eC,eC,tC,tC,wB,CB,kB,SB,NB,IB,$B,TB,EB,RB,AB,DB,PB];for(const n of FB)qM(n);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.abs=function(){return this.throwIfDisposed(),es(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.acos=function(){return this.throwIfDisposed(),cF(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.acosh=function(){return this.throwIfDisposed(),dF(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.add=function(n){return this.throwIfDisposed(),Ie(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.all=function(n,e){return this.throwIfDisposed(),ZN(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.any=function(n,e){return this.throwIfDisposed(),q0(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.argMax=function(n){return this.throwIfDisposed(),cu(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.argMin=function(n){return this.throwIfDisposed(),gF(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.asScalar=function(){return this.throwIfDisposed(),_(this.size===1,()=>"The array must have only 1 element."),re(this,[])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.asType=function(n){return this.throwIfDisposed(),Ae(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.as1D=function(){return this.throwIfDisposed(),re(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.as2D=function(n,e){return this.throwIfDisposed(),re(this,[n,e])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.as3D=function(n,e,t){return this.throwIfDisposed(),re(this,[n,e,t])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.as4D=function(n,e,t,s){return this.throwIfDisposed(),re(this,[n,e,t,s])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.as5D=function(n,e,t,s,r){return this.throwIfDisposed(),re(this,[n,e,t,s,r])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.asin=function(){return this.throwIfDisposed(),yF(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.asinh=function(){return this.throwIfDisposed(),bF(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.atan=function(){return this.throwIfDisposed(),kF(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.atan2=function(n){return this.throwIfDisposed(),SF(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.atanh=function(){return this.throwIfDisposed(),IF(this)};fe().prototype.avgPool=function(n,e,t,s){return this.throwIfDisposed(),k1(this,n,e,t,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.batchToSpaceND=function(n,e){return this.throwIfDisposed(),C1(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.batchNorm=function(n,e,t,s,r){return this.throwIfDisposed(),$m(this,n,e,t,s,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.broadcastTo=function(n){return this.throwIfDisposed(),nu(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.cast=function(n){return this.throwIfDisposed(),Ae(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.ceil=function(){return this.throwIfDisposed(),ZF(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.clipByValue=function(n,e){return this.throwIfDisposed(),Us(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.concat=function(n,e){return this.throwIfDisposed(),n instanceof un&&(n=[n]),ms([this,...n],e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.conv1d=function(n,e,t,s,r,o){return this.throwIfDisposed(),eI(this,n,e,t,s,r,o)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.conv2dTranspose=function(n,e,t,s,r){return this.throwIfDisposed(),tI(this,n,e,t,s,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.conv2d=function(n,e,t,s,r,o){return this.throwIfDisposed(),oa(this,n,e,t,s,r,o)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.cos=function(){return this.throwIfDisposed(),N1(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.cosh=function(){return this.throwIfDisposed(),sI(this)};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.cumprod=function(n,e,t){return this.throwIfDisposed(),X0(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.cumsum=function(n,e,t){return this.throwIfDisposed(),rI(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.depthToSpace=function(n,e){return this.throwIfDisposed(),SL(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.depthwiseConv2d=function(n,e,t,s,r,o){return this.throwIfDisposed(),I1(this,n,e,t,s,r,o)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.dilation2d=function(n,e,t,s,r){return this.throwIfDisposed(),$L(this,n,e,t,s,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.divNoNan=function(n){return this.throwIfDisposed(),DL(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.div=function(n){return this.throwIfDisposed(),Ge(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.dot=function(n){return this.throwIfDisposed(),PL(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.elu=function(){return this.throwIfDisposed(),Em(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.equal=function(n){return this.throwIfDisposed(),Zr(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.erf=function(){return this.throwIfDisposed(),oI(this)};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.euclideanNorm=function(n,e){return this.throwIfDisposed(),HL(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.exp=function(){return this.throwIfDisposed(),eo(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.expandDims=function(n){return this.throwIfDisposed(),hs(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.expm1=function(){return this.throwIfDisposed(),QL(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.fft=function(){return this.throwIfDisposed(),CI(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.flatten=function(){return this.throwIfDisposed(),re(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.floor=function(){return this.throwIfDisposed(),Am(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.floorDiv=function(n){return this.throwIfDisposed(),JN(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.gather=function(n,e,t){return this.throwIfDisposed(),T1(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.greaterEqual=function(n){return this.throwIfDisposed(),xa(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.greater=function(n){return this.throwIfDisposed(),Gs(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.ifft=function(){return this.throwIfDisposed(),Q0(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.irfft=function(){return this.throwIfDisposed(),WO(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.isFinite=function(){return this.throwIfDisposed(),oj(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.isInf=function(){return this.throwIfDisposed(),aj(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.isNaN=function(){return this.throwIfDisposed(),cj(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.leakyRelu=function(n){return this.throwIfDisposed(),R1(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.lessEqual=function(n){return this.throwIfDisposed(),Ol(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.less=function(n){return this.throwIfDisposed(),Uf(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.localResponseNormalization=function(n,e,t,s){return this.throwIfDisposed(),pj(this,n,e,t,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.logSigmoid=function(){return this.throwIfDisposed(),wj(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.logSoftmax=function(n){return this.throwIfDisposed(),uI(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.logSumExp=function(n,e){return this.throwIfDisposed(),dI(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.log=function(){return this.throwIfDisposed(),to(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.log1p=function(){return this.throwIfDisposed(),cI(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.logicalAnd=function(n){return this.throwIfDisposed(),ko(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.logicalNot=function(){return this.throwIfDisposed(),A1(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.logicalOr=function(n){return this.throwIfDisposed(),hI(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.logicalXor=function(n){return this.throwIfDisposed(),Ej(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.matMul=function(n,e,t){return this.throwIfDisposed(),mt(this,n,e,t)};fe().prototype.maxPool=function(n,e,t,s){return this.throwIfDisposed(),D1(this,n,e,t,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.max=function(n,e){return this.throwIfDisposed(),Er(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.maximum=function(n){return this.throwIfDisposed(),yi(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.mean=function(n,e){return this.throwIfDisposed(),rn(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.min=function(n,e){return this.throwIfDisposed(),Wf(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.minimum=function(n){return this.throwIfDisposed(),hu(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.mirrorPad=function(n,e){return this.throwIfDisposed(),jj(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.mod=function(n){return this.throwIfDisposed(),_j(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.mul=function(n){return this.throwIfDisposed(),te(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.neg=function(){return this.throwIfDisposed(),Yt(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.norm=function(n,e,t){return this.throwIfDisposed(),Rm(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.notEqual=function(n){return this.throwIfDisposed(),Gf(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.oneHot=function(n,e=1,t=0){return this.throwIfDisposed(),fI(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.onesLike=function(){return this.throwIfDisposed(),cr(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.pad=function(n,e){return this.throwIfDisposed(),P1(this,n,e)};fe().prototype.pool=function(n,e,t,s,r,o){return this.throwIfDisposed(),Xj(this,n,e,t,s,r,o)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.pow=function(n){return this.throwIfDisposed(),ia(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.prelu=function(n){return this.throwIfDisposed(),L1(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.prod=function(n,e){return this.throwIfDisposed(),Jj(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.reciprocal=function(){return this.throwIfDisposed(),CO(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.relu=function(){return this.throwIfDisposed(),ya(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.relu6=function(){return this.throwIfDisposed(),mI(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.reshapeAs=function(n){return this.throwIfDisposed(),re(this,n.shape)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.reshape=function(n){return this.throwIfDisposed(),re(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.resizeBilinear=function(n,e,t){return this.throwIfDisposed(),TI(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.resizeNearestNeighbor=function(n,e,t){return this.throwIfDisposed(),EI(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.reverse=function(n){return this.throwIfDisposed(),aa(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.rfft=function(){return this.throwIfDisposed(),HO(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.round=function(){return this.throwIfDisposed(),gI(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.rsqrt=function(){return this.throwIfDisposed(),xI(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.selu=function(){return this.throwIfDisposed(),yI(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.separableConv2d=function(n,e,t,s,r,o){return this.throwIfDisposed(),vI(this,n,e,t,s,r,o)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.sigmoid=function(){return this.throwIfDisposed(),jl(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.sign=function(){return this.throwIfDisposed(),DO(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.sin=function(){return this.throwIfDisposed(),bI(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.sinh=function(){return this.throwIfDisposed(),wI(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.slice=function(n,e){return this.throwIfDisposed(),$t(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.softmax=function(n){return this.throwIfDisposed(),z1(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.softplus=function(){return this.throwIfDisposed(),Cd(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.spaceToBatchND=function(n,e){return this.throwIfDisposed(),F1(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.split=function(n,e){return this.throwIfDisposed(),Ws(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.sqrt=function(){return this.throwIfDisposed(),Bn(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.square=function(){return this.throwIfDisposed(),Rt(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.squaredDifference=function(n){return this.throwIfDisposed(),KO(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.squeeze=function(n){return this.throwIfDisposed(),Nd(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.stack=function(n,e){this.throwIfDisposed();const t=n instanceof un?[this,n]:[this,...n];return Co(t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.step=function(n){return this.throwIfDisposed(),Id(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.stridedSlice=function(n,e,t,s,r,o,i,a){return this.throwIfDisposed(),ZO(this,n,e,t,s,r,o,i,a)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.sub=function(n){return this.throwIfDisposed(),Ke(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.sum=function(n,e){return this.throwIfDisposed(),We(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.tan=function(){return this.throwIfDisposed(),t_(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.tanh=function(){return this.throwIfDisposed(),Im(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.tile=function(n){return this.throwIfDisposed(),$r(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.toBool=function(){return this.throwIfDisposed(),Ae(this,"bool")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.toFloat=function(){return this.throwIfDisposed(),Ae(this,"float32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.toInt=function(){return this.throwIfDisposed(),Ae(this,"int32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.topk=function(n,e){return this.throwIfDisposed(),r_(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.transpose=function(n){return this.throwIfDisposed(),ct(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.unique=function(n){return this.throwIfDisposed(),a_(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.unsortedSegmentSum=function(n,e){return this.throwIfDisposed(),II(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.unstack=function(n){return this.throwIfDisposed(),la(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.where=function(n,e){return this.throwIfDisposed(),ss(n,this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.zerosLike=function(){return this.throwIfDisposed(),ut(this)};/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Wr extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Wr.prototype)}}class or extends Error{constructor(e){super(e),Object.setPrototypeOf(this,or.prototype)}}class Z extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Z.prototype)}}class tt extends Error{constructor(e){super(e),Object.setPrototypeOf(this,tt.prototype)}}class Cv extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Cv.prototype)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class v${constructor(e){this.maxEntries=e||100,this.cache=new Map}get(e){let t;return this.cache.has(e)&&(t=this.cache.get(e),this.cache.delete(e),this.cache.set(e,t)),t}put(e,t){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxEntries){const s=this.cache.keys().next().value;this.cache.delete(s)}this.cache.set(e,t)}getMaxEntries(){return this.maxEntries}setMaxEntries(e){if(e<0)throw new Error(`The maxEntries of LRU caches must be at least 0, but got ${e}.`);if(this.maxEntries>e)for(let t=0;t<this.maxEntries-e;t++){const s=this.cache.keys().next().value;this.cache.delete(s)}this.maxEntries=e}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function ca(n,e){if(Array.isArray(n)){let t=[];for(let s=0;s<e;s++)t=t.concat(n);return t}else{const t=new Array(e);return t.fill(n),t}}function Ur(n,e){if(!n)throw new Cv(e)}function nC(n,e){let t=0;for(const s of n)s===e&&t++;return t}function fs(n){return n.length===1?n[0]:n}function bt(n){return Array.isArray(n)?n:[n]}function vo(n){const t=n.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return t[0]!=="_"?t:"private"+t}function Wi(n){return n.length<=1||n.indexOf("_")===-1?n:n.replace(/[_]+(\w|$)/g,(e,t)=>t.toUpperCase())}let er={};function Sv(n){if(n==null)return null;const e={};return e.className=n.getClassName(),e.config=n.getConfig(),e}function Z0(n){if(!(n==null||typeof n!="object"))if(Array.isArray(n))n.forEach(e=>Z0(e));else{const e=Object.keys(n);for(const t of e){const s=n[t];s!=null&&typeof s=="object"&&(!Array.isArray(s)&&s.type==="ndarray"&&typeof s.value=="number"?n[t]=s.value:Z0(s))}}}function Rd(n,e={},t={},s="object",r=!1){if(typeof n=="string"){const o=n;let i;if(o in t)i=t[o];else if(o in er)i=er[o];else if(i=e[o],i==null)throw new Z(`Unknown ${s}: ${n}. This may be due to one of the following reasons:
1. The ${s} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${s} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);return i}else{const o=n;if(o.className==null||o.config==null)throw new Z(`${s}: Improper config format: ${JSON.stringify(o)}.
'className' and 'config' must set.`);const i=o.className;let a,l;if(i in t?[a,l]=t[i]:i in er?[a,l]=er.className:i in e&&([a,l]=e[i]),a==null)throw new Z(`Unknown ${s}: ${i}. This may be due to one of the following reasons:
1. The ${s} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${s} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);if(l!=null){const u={};for(const g of Object.keys(er))u[g]=er[g];for(const g of Object.keys(t))u[g]=t[g];const d=o.config;d.customObjects=u;const f=Object.assign({},er);for(const g of Object.keys(t))er[g]=t[g];Z0(o.config);const m=l(a,o.config,t,r);return er=Object.assign({},f),m}else{const u=Object.assign({},er);for(const f of Object.keys(t))er[f]=t[f];const d=new a(o.config);return er=Object.assign({},u),d}}}function LB(n,e){return n<e?-1:n>e?1:0}function of(n,e){return-1*LB(n,e)}function oi(n){if(n==null)return n;const e=[];for(const t of n)e.indexOf(t)===-1&&e.push(t);return e}function jB(n){if(n==null)throw new Z(`Invalid value in obj: ${JSON.stringify(n)}`);for(const e in n)if(n.hasOwnProperty(e))return!1;return!0}function ba(n,e,t){if(t!=null&&n.indexOf(t)<0)throw new Z(`${t} is not a valid ${e}.  Valid values are ${n} or null/undefined.`)}function Nv(n,e,t=0,s=1/0){return Ur(t>=0),Ur(s>=t),Array.isArray(n)&&n.length>=t&&n.length<=s&&n.every(r=>typeof r===e)}function Cn(n,e){Array.isArray(n)?(_(n.length>0,()=>`${e} is unexpectedly an empty array.`),n.forEach((t,s)=>Cn(t,`element ${s+1} of ${e}`))):_(Number.isInteger(n)&&n>0,()=>`Expected ${e} to be a positive integer, but got ${b$(n)}.`)}function b$(n){return n===null?"null":Array.isArray(n)?"["+n.map(e=>b$(e)).join(",")+"]":typeof n=="string"?`"${n}"`:`${n}`}function OB(n,e,t){let s=t!=null?t():ds(),r;return(...i)=>{const a=t!=null?t():ds();return a-s<e||(s=a,r=n(...i)),r}}function w$(n){return n==="relu"?"relu":n==="linear"?"linear":n==="elu"?"elu":null}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let _B=0;function k$(){return _B++}const af={};function Lm(n=""){return n in af||(af[n]=0),af[n]+=1,n+af[n].toString()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const zB=["channelsFirst","channelsLast"],BB=["nearest","bilinear"],VB=["valid","same","causal"],WB=["max","avg"],UB=["sum","mul","concat","ave"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const el=new Map;function en(n){ba(zB,"DataFormat",n)}function GB(n){ba(BB,"InterpolationFormat",n)}function Hs(n){ba(VB,"PaddingMode",n)}function C$(n){ba(WB,"PoolMode",n)}const su=[],sC="/";function Xi(n,e){su.push(n);try{const t=e();return su.pop(),t}catch(t){throw su.pop(),t}}function HB(){return su.length===0?"":su.join(sC)+sC}function S$(n){if(!I$(n))throw new Error("Not a valid tensor name: '"+n+"'");return HB()+n}function N$(n){if(!I$(n))throw new Error("Not a valid tensor name: '"+n+"'");el.has(n)||el.set(n,0);const e=el.get(n);if(el.set(n,el.get(n)+1),e>0){const t=`${n}_${e}`;return el.set(t,1),t}else return n}const qB=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function I$(n){return!!n.match(qB)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function KB(n){return n===parseInt(n.toString(),10)}function ii(n,e,t){e==null&&(e=0),t==null&&(t=n.length);let s=1;for(let r=e;r<t;++r)s*=n[r];return s}function Sl(n){if(n.length===0)return Number.NaN;let e=Number.POSITIVE_INFINITY;for(let t=0;t<n.length;t++){const s=n[t];s<e&&(e=s)}return e}function li(n){if(n.length===0)return Number.NaN;let e=Number.NEGATIVE_INFINITY;for(let t=0;t<n.length;t++){const s=n[t];s>e&&(e=s)}return e}function Ar(n,e){if(e<n)throw new Z(`end (${e}) < begin (${n}) is forbidden.`);const t=[];for(let s=n;s<e;++s)t.push(s);return t}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let o0;function dn(){return o0==null&&(o0=vP().epsilon()),o0}function Dr(){return"channelsLast"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Qr(n,e){return Ae(n,e)}function Ad(n,e=-1){const t=n.shape.slice();return e<0&&(e=t.length+e+1),t.splice(e,0,1),re(n,t)}function XB(n,e){return le(()=>{if(n.shape.length!==2)throw new Z(`repeat() expects a rank-2 tensor, but received a rank-${n.shape.length} tensor.`);const t=Ad(n,1);return ey(t,[1,e,1])})}function QB(n){const e=[ii(n.shape)];return re(n,e)}function YB(n){if(n.rank<=1)throw new Z(`batchFlatten requires a minimum rank of 2. Got rank: ${n.rank}.`);const e=[n.shape[0],ii(n.shape,1)];return re(n,e)}function Qi(n,e,t){return le(()=>{switch(n.rank){case 1:return O1(n,e,t);case 2:return kI(n,[e,0],[t,n.shape[1]]);case 3:return _1(n,[e,0,0],[t,n.shape[1],n.shape[2]]);case 4:return qf(n,[e,0,0,0],[t,n.shape[1],n.shape[2],n.shape[3]]);case 5:return $t(n,[e,0,0,0,0],[t,n.shape[1],n.shape[2],n.shape[3],n.shape[4]]);case 6:return $t(n,[e,0,0,0,0,0],[t,n.shape[1],n.shape[2],n.shape[3],n.shape[4],n.shape[5]]);default:throw new Z(`sliceAlongFirstAxis() received an unsupported tensor rank: ${n.rank}`)}})}function i0(n,e,t){return le(()=>{switch(n.rank){case 1:return O1(n,e,t);case 2:return kI(n,[0,e],[n.shape[0],t]);case 3:return _1(n,[0,0,e],[n.shape[0],n.shape[1],t]);case 4:return qf(n,[0,0,0,e],[n.shape[0],n.shape[1],n.shape[2],t]);default:throw new Z(`sliceAlongLastAxis() received an unsupported tensor rank: ${n.rank}`)}})}function lf(n,e,t,s){return le(()=>{switch(n.rank){case 1:return O1(n,e,t);case 2:switch(s){case 1:return Qi(n,e,t);case 2:return i0(n,e,t);default:throw new Z(`The axis is not within the rank of the tensor ${s}`)}case 3:switch(s){case 1:return Qi(n,e,t);case 2:return _1(n,[0,e,0],[n.shape[0],t,n.shape[2]]);case 3:return i0(n,e,t);default:throw new Z(`The axis is not within the rank of the tensor ${s}`)}case 4:switch(s){case 1:return Qi(n,e,t);case 2:return qf(n,[0,e,0,0],[n.shape[0],t,n.shape[2],n.shape[3]]);case 3:return qf(n,[0,0,e,0],[n.shape[0],n.shape[1],t,n.shape[3]]);case 4:return i0(n,e,t);default:throw new Z(`The axis is not within the rank of the tensor ${s}`)}default:throw new Z(`sliceAlongLastAxis() received an unsupported tensor rank: ${n.rank}`)}})}function Iv(n,e=-1){let t;return e<0&&(t=n[0].rank,t!==0?e=t:e=0),e===n[0].rank&&(e=-1),ms(n,e)}function rC(n,e){switch(n.rank){case 1:return nL([n,e]);case 2:return rL([n,e],0);case 3:return iL([n,e],0);case 4:return lL([n,e],0);default:throw new Z(`concatAlongFirstAxis() received an unsupported tensor rank: ${n.rank}`)}}function ey(n,e){if(Array.isArray(e)||(e=[e]),n.rank!==e.length)throw new Z(`The length of input n (${e.length}) does not match the number of dimensions in input x (${n.rank})`);return $r(n,e)}function jm(n,e=0,t=1,s,r){return vO(n,e,t,s,r)}function Yr(n,e,t,s){if(n.rank<2||e.rank<2)throw new tt(`dot requires both inputs to be rank >= 2 but got x shape = ${n.shape} and y shape = ${e.shape}`);if(e.rank>=3){const r=n.shape.slice(-1)[0],o=e.shape.slice(-2)[0];if(r!==o)throw new tt(`If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = ${n.shape} and  y shape = ${e.shape}`)}if(n.rank===2&&e.rank===2)return V2({a:n,b:e,transposeA:!1,transposeB:!1,bias:s?ty(n.rank,s,Dr()):null,activation:t});{const r=n.shape.slice(),o=r.pop();n=re(n,[-1,o]);const i=e.shape.slice(),a=i.pop(),l=i.pop(),u=[...i,a],d=Array.from({length:e.rank},(y,w)=>w===0?e.rank-2:w<=e.rank-2?w-1:w);e=re(ct(e,d),[l,-1]);const f=[...r,...u];return re(V2({a:n,b:e,transposeA:!1,transposeB:!1,bias:s?ty(n.rank,s,Dr()):null,activation:t}),f)}}function $$(n,e,t){return le(()=>(Array.isArray(e)?e=ps(e,"int32"):e=Ae(e,"int32"),T1(n,e,t)))}function Dd(n){return te(n,n)}function ty(n,e,t){const s=e.shape;if(e.rank!==1&&e.rank!==n)throw new Z(`Unexpected bias dimensions: ${e.rank}; expected it to be 1 or ${n}`);if(n===5){if(t==="channelsFirst")return s.length===1?re(e,[1,s[0],1,1,1]):re(e,[1,s[3],s[0],s[1],s[2]]);if(t==="channelsLast")return s.length===1?re(e,[1,1,1,1,s[0]]):re(e,[1].concat(s))}else if(n===4){if(t==="channelsFirst")return s.length===1?re(e,[1,s[0],1,1]):re(e,[1,s[2],s[0],s[1]]);if(t==="channelsLast")return s.length===1?re(e,[1,1,1,s[0]]):re(e,[1].concat(s))}else if(n===3){if(t==="channelsFirst")return s.length===1?re(e,[1,s[0],1]):re(e,[1,s[1],s[0]]);if(t==="channelsLast")return s.length===1?re(e,[1,1,s[0]]):re(e,[1].concat(s))}else if(n<3)return e;throw new Z(`Unsupported input rank by biasAdd: ${e.rank}`)}function Fr(n,e,t){return le(()=>(t==null&&(t=Dr()),en(t),Ie(n,ty(n.rank,e,t))))}function JB(n,e=1){if(e!==1)throw new tt(`Support for alpha values other than 1 (${e}) is not implemented yet.`);return Em(n)}function ZB(n){return le(()=>Ge(n,Ie(es(n),1)))}function T$(n,e,t,s){return le(()=>p_(n,e,t,s))}function eV(n){return le(()=>{const e=Ie(.5,te(.2,n));return Us(e,0,1)})}function Md(n,e,t=!1){return t?n():e()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const tV=["fanIn","fanOut","fanAvg"],nV=["normal","uniform","truncatedNormal"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function sV(n){ba(tV,"FanMode",n)}function rV(n){ba(nV,"Distribution",n)}class dr extends zl{fromConfigUsesCustomObjects(){return!1}getConfig(){return{}}}class E$ extends dr{apply(e,t){return kn(e,t)}}E$.className="Zeros";we(E$);class $v extends dr{apply(e,t){return vi(e,t)}}$v.className="Ones";we($v);class R$ extends dr{constructor(e){if(super(),typeof e!="object")throw new Z(`Expected argument of type ConstantConfig but got ${e}`);if(e.value===void 0)throw new Z(`config must have value set but got ${e}`);this.value=e.value}apply(e,t){return le(()=>te(gt(this.value),vi(e,t)))}getConfig(){return{value:this.value}}}R$.className="Constant";we(R$);class A$ extends dr{constructor(e){super(),this.DEFAULT_MINVAL=-.05,this.DEFAULT_MAXVAL=.05,this.minval=e.minval||this.DEFAULT_MINVAL,this.maxval=e.maxval||this.DEFAULT_MAXVAL,this.seed=e.seed}apply(e,t){return Sd(e,this.minval,this.maxval,t,this.seed)}getConfig(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}A$.className="RandomUniform";we(A$);class D$ extends dr{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,t){if(t=t||"float32",t!=="float32"&&t!=="int32")throw new tt(`randomNormal does not support dType ${t}.`);return jm(e,this.mean,this.stddev,t,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}D$.className="RandomNormal";we(D$);class M$ extends dr{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,t){if(t=t||"float32",t!=="float32"&&t!=="int32")throw new tt(`truncatedNormal does not support dType ${t}.`);return NI(e,this.mean,this.stddev,t,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}M$.className="TruncatedNormal";we(M$);class P$ extends dr{constructor(e){super(),this.gain=e.gain!=null?e.gain:1}apply(e,t){return le(()=>{if(e.length!==2||e[0]!==e[1])throw new Z("Identity matrix initializer can only be used for 2D square matrices.");return te(this.gain,lI(e[0]))})}getConfig(){return{gain:this.gain}}}P$.className="Identity";we(P$);function oV(n,e="channelsLast"){let t,s;if(en(e),n.length===2)t=n[0],s=n[1];else if([3,4,5].indexOf(n.length)!==-1){if(e==="channelsFirst"){const r=ii(n,2);t=n[1]*r,s=n[0]*r}else if(e==="channelsLast"){const r=ii(n,0,n.length-2);t=n[n.length-2]*r,s=n[n.length-1]*r}}else{const r=ii(n);t=Math.sqrt(r),s=Math.sqrt(r)}return[t,s]}class Ds extends dr{constructor(e){if(super(),e.scale<0)throw new Z(`scale must be a positive float. Got: ${e.scale}`);this.scale=e.scale==null?1:e.scale,this.mode=e.mode==null?"fanIn":e.mode,sV(this.mode),this.distribution=e.distribution==null?"normal":e.distribution,rV(this.distribution),this.seed=e.seed}apply(e,t){const s=oV(e),r=s[0],o=s[1];let i=this.scale;if(this.mode==="fanIn"?i/=Math.max(1,r):this.mode==="fanOut"?i/=Math.max(1,o):i/=Math.max(1,(r+o)/2),this.distribution==="normal"){const a=Math.sqrt(i);if(t=t||"float32",t!=="float32"&&t!=="int32")throw new tt(`${this.getClassName()} does not support dType ${t}.`);return NI(e,0,a,t,this.seed)}else{const a=Math.sqrt(3*i);return Sd(e,-a,a,t,this.seed)}}getConfig(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}Ds.className="VarianceScaling";we(Ds);class Tv extends Ds{constructor(e){super({scale:1,mode:"fanAvg",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return Ds.className}}Tv.className="GlorotUniform";we(Tv);class Ev extends Ds{constructor(e){super({scale:1,mode:"fanAvg",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return Ds.className}}Ev.className="GlorotNormal";we(Ev);class Rv extends Ds{constructor(e){super({scale:2,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return Ds.className}}Rv.className="HeNormal";we(Rv);class Av extends Ds{constructor(e){super({scale:2,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return Ds.className}}Av.className="HeUniform";we(Av);class Dv extends Ds{constructor(e){super({scale:1,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return Ds.className}}Dv.className="LeCunNormal";we(Dv);class Mv extends Ds{constructor(e){super({scale:1,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return Ds.className}}Mv.className="LeCunUniform";we(Mv);class F$ extends dr{constructor(e){super(),this.DEFAULT_GAIN=1,this.ELEMENTS_WARN_SLOW=2e3,this.gain=e.gain==null?this.DEFAULT_GAIN:e.gain,this.seed=e.seed}apply(e,t){return le(()=>{if(e.length<2)throw new tt("Shape must be at least 2D.");if(t!=="int32"&&t!=="float32"&&t!==void 0)throw new TypeError(`Unsupported data type ${t}.`);t=t;const s=pe(e.slice(0,-1)),r=e[e.length-1],o=s*r;o>this.ELEMENTS_WARN_SLOW&&console.warn(`Orthogonal initializer is being called on a matrix with more than ${this.ELEMENTS_WARN_SLOW} (${o}) elements: Slowness may result.`);const i=[Math.max(r,s),Math.min(r,s)],a=jm(i,0,1,t,this.seed),l=uz.qr(a,!1);let u=l[0];const f=l[1].flatten().stridedSlice([0],[Math.min(r,s)*Math.min(r,s)],[Math.min(r,s)+1]);return u=te(u,f.sign()),s<r&&(u=u.transpose()),te(gt(this.gain),u.reshape(e))})}getConfig(){return{gain:this.gain,seed:this.seed}}}F$.className="Orthogonal";we(F$);const oC={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function iC(n,e={}){return Rd(n,rr.getMap().classNameMap,e,"initializer")}function zt(n){return Sv(n)}function Lt(n){if(typeof n=="string"){const e=n in oC?oC[n]:n;if(e==="GlorotNormal")return new Ev;if(e==="GlorotUniform")return new Tv;if(e==="HeNormal")return new Rv;if(e==="HeUniform")return new Av;if(e==="LeCunNormal")return new Dv;if(e==="LeCunUniform")return new Mv;{const t={};return t.className=e,t.config={},iC(t)}}else return n instanceof dr?n:iC(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function ny(n){return Array.isArray(n)&&Array.isArray(n[0])}function Kf(n){return n.length===0?[]:Array.isArray(n[0])?n:[n]}function Xe(n){let e;if(Array.isArray(n)){if(n.length!==1)throw new Z(`Expected Tensor length to be 1; got ${n.length}`);e=n[0]}else e=n;return e}function ht(n){if(Array.isArray(n)&&Array.isArray(n[0])){if(n.length===1)return n=n,n[0];throw new Z(`Expected exactly 1 Shape; got ${n.length}`)}else return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Xf(n){let e=0;for(const t of n)t.shape.length===0?e+=1:e+=t.shape.reduce((s,r)=>s*r);return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const aC="Variable";class iV{constructor(e,t="float32",s=aC,r=!0,o=null){this.dtype=t??"float32",this.shape=e.shape,this.id=k$(),s=s??aC,this.originalName=S$(s),this.name=N$(this.originalName),this.trainable_=r,this.constraint=o,this.val=u_(e,this.trainable_,this.name,this.dtype)}read(){return this.assertNotDisposed(),this.val}write(e){return this.assertNotDisposed(),aV(this.val,e),this.val.id!==e.id&&(this.val.assign(e),this.constraint!=null&&this.val.assign(this.constraint.apply(this.val))),this}dispose(){this.assertNotDisposed(),this.val.dispose()}assertNotDisposed(){if(this.val.isDisposed)throw new Error(`LayersVariable ${this.name} is already disposed.`)}get trainable(){return this.trainable_}set trainable(e){this.trainable_=e,this.val.trainable=e}}function aV(n,e){if(n.shape.toString()!==e.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(n.shape)+" vs. "+JSON.stringify(e.shape))}function sy(n){return n.map(e=>e.read())}function Pv(n){n.forEach(e=>{e[0].write(e[1])})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class hn{constructor(e){this.dtype=e.dtype,this.shape=e.shape,e.shape!=null?this.ndim=e.shape.length:this.ndim=e.ndim,this.maxNDim=e.maxNDim,this.minNDim=e.minNDim,this.axes=e.axes||{}}}class no{constructor(e,t,s,r,o,i,a){this.dtype=e,this.shape=t,this.sourceLayer=s,this.inputs=r,this.callArgs=o,this.outputTensorIndex=a,this.id=k$(),i!=null&&(this.originalName=S$(i),this.name=N$(this.originalName)),this.rank=t.length}}let lV=0;class Om{constructor(e,t){this.callArgs=t,this.id=lV++,this.outboundLayer=e.outboundLayer,this.inboundLayers=e.inboundLayers,this.nodeIndices=e.nodeIndices,this.tensorIndices=e.tensorIndices,this.inputTensors=e.inputTensors,this.outputTensors=e.outputTensors,this.inputMasks=e.inputMasks,this.outputMasks=e.outputMasks,this.inputShapes=e.inputShapes,this.outputShapes=e.outputShapes;for(const s of e.inboundLayers)s!=null&&s.outboundNodes.push(this);e.outboundLayer.inboundNodes.push(this)}getConfig(){const e=[];for(const t of this.inboundLayers)t!=null?e.push(t.name):e.push(null);return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:e,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}}let cV=0;class ot extends zl{constructor(e={}){super(),this._callHook=null,this._addedWeightNames=[],this._stateful=!1,this.id=cV++,this.activityRegularizer=null,this.inputSpec=null,this.supportsMasking=!1,this._trainableWeights=[],this._nonTrainableWeights=[],this._losses=[],this._updates=[],this._built=!1,this.inboundNodes=[],this.outboundNodes=[];let t=e.name;if(!t){const s=this.getClassName();t=vo(s)+"_"+Lm(s)}if(this.name=t,this.trainable_=e.trainable==null?!0:e.trainable,e.inputShape!=null||e.batchInputShape!=null){let s;if(e.batchInputShape!=null)s=e.batchInputShape;else if(e.inputShape!=null){let o=null;e.batchSize!=null&&(o=e.batchSize),s=[o].concat(e.inputShape)}this.batchInputShape=s;let r=e.dtype;r==null&&(r=e.inputDType),r==null&&(r="float32"),this.dtype=r}e.weights!=null?this.initialWeights=e.weights:this.initialWeights=null,this._refCount=null,this.fastWeightInitDuringBuild=!1}static nodeKey(e,t){return e.name+"_ib-"+t.toString()}getNodeAtIndex(e,t){if(this.inboundNodes.length===0)throw new or(`The layer has never been called and thus has no defined ${t}.`);if(this.inboundNodes.length<=e)throw new Z(`Asked to get ${t} at node ${e}, but the layer has only ${this.inboundNodes.length} inbound nodes.`);return this.inboundNodes[e]}getInputAt(e){return fs(this.getNodeAtIndex(e,"input").inputTensors)}getOutputAt(e){return fs(this.getNodeAtIndex(e,"output").outputTensors)}get input(){if(this.inboundNodes.length>1)throw new Wr(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use \`getInputAt(nodeIndex)\` instead.`);if(this.inboundNodes.length===0)throw new Wr(`Layer ${this.name} is not connected, no input to return.`);return fs(this.getNodeAtIndex(0,"input").inputTensors)}get output(){if(this.inboundNodes.length===0)throw new Wr(`Layer ${this.name} has no inbound nodes.`);if(this.inboundNodes.length>1)throw new Wr(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use \`getOutputAt(nodeIndex)\` instead.`);return fs(this.getNodeAtIndex(0,"output").outputTensors)}get losses(){return this._losses}calculateLosses(){return this.losses.map(e=>e())}get updates(){return this._updates}get built(){return this._built}set built(e){this._built=e}get trainable(){return this.trainable_}set trainable(e){this._trainableWeights.forEach(t=>t.trainable=e),this.trainable_=e}get trainableWeights(){return this.trainable_?this._trainableWeights.filter(e=>e.trainable):[]}set trainableWeights(e){this._trainableWeights=e}get nonTrainableWeights(){return this.trainable?this._trainableWeights.filter(e=>!e.trainable).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)}set nonTrainableWeights(e){this._nonTrainableWeights=e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}get stateful(){return this._stateful}resetStates(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}assertInputCompatibility(e){const t=bt(e);if(this.inputSpec==null||this.inputSpec.length===0)return;const s=bt(this.inputSpec);if(t.length!==s.length)throw new Z(`Layer ${this.name} expects ${s.length} inputs, but it received ${t.length} input tensors. Input received: ${e}`);for(let r=0;r<t.length;r++){const o=t[r],i=s[r];if(i==null)continue;const a=o.rank;if(i.ndim!=null&&a!==i.ndim)throw new Z(`Input ${r} is incompatible with layer ${this.name}: expected ndim=${i.ndim}, found ndim=${a}`);if(i.maxNDim!=null&&a>i.maxNDim)throw new Z(`Input ${r} is incompatible with layer ${this.name}: expected max_ndim=${i.maxNDim}, found ndim=${a}`);if(i.minNDim!=null&&a<i.minNDim)throw new Z(`Input ${r} is incompatible with layer ${this.name}: expected min_ndim=${i.minNDim}, found ndim=${a}.`);if(i.dtype!=null&&o.dtype!==i.dtype)throw new Z(`Input ${r} is incompatible with layer ${this.name} : expected dtype=${i.dtype}, found dtype=${o.dtype}.`);if(i.axes){const l=o.shape;for(const u in i.axes){const d=Number(u),f=i.axes[u],m=d>=0?l[d]:l[l.length+d];if(f!=null&&[f,null].indexOf(m)===-1)throw new Z(`Input ${r} is incompatible with layer ${this.name}: expected axis ${d} of input shape to have value ${f} but got shape ${l}.`)}}if(i.shape!=null)for(let l=0;l<i.shape.length;++l){const u=i.shape[l],d=o.shape[l];if(u!=null&&d!=null&&u!==d)throw new Z(`Input ${r} is incompatible with layer ${this.name}: expected shape=${i.shape}, found shape=${o.shape}.`)}}}call(e,t){return e}invokeCallHook(e,t){this._callHook!=null&&this._callHook(e,t)}setCallHook(e){this._callHook=e}clearCallHook(){this._callHook=null}apply(e,t){t=t||{},this.assertNotDisposed();const s=bt(e),r=hV(e),o=fV(e);if(r===o)throw new Z("Arguments to apply() must be all SymbolicTensors or all Tensors");return Xi(this.name,()=>{if(!this.built){this.assertInputCompatibility(e);const i=[];for(const a of bt(e))i.push(a.shape);this.build(fs(i)),this.built=!0,this.initialWeights&&this.setWeights(this.initialWeights),this._refCount===null&&o&&(this._refCount=1)}if(this.assertInputCompatibility(e),o){let i=this.call(e,t);this.supportsMasking&&this.setMaskMetadata(e,i);const a=bt(i),l=[];for(let u of a)s.indexOf(u)!==-1&&(u=u.clone()),l.push(u);if(i=fs(l),this.activityRegularizer!=null)throw new tt("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return i}else{const i=uV(e),a=this.computeOutputShape(i);let l;const u=dV(e);if(this.warnOnIncompatibleInputShape(Array.isArray(e)?i[0]:i),a!=null&&a.length>0&&Array.isArray(a[0])?l=a.map((d,f)=>new no(u,d,this,bt(e),t,this.name,f)):l=new no(u,a,this,bt(e),t,this.name),this.addInboundNode(e,l,null,null,i,a,t),this._refCount++,this.activityRegularizer!=null)throw new tt("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return l}})}warnOnIncompatibleInputShape(e){if(this.batchInputShape!=null)if(e.length!==this.batchInputShape.length)console.warn(`The rank of the input tensor provided (shape: ${JSON.stringify(e)}) does not match that of the batchInputShape (${JSON.stringify(this.batchInputShape)}) of the layer ${this.name}`);else{let t=!1;this.batchInputShape.forEach((s,r)=>{s!=null&&e[r]!=null&&e[r]!==s&&(t=!0)}),t&&console.warn(`The shape of the input tensor (${JSON.stringify(e)}) does not match the expectation of layer ${this.name}: ${JSON.stringify(this.batchInputShape)}`)}}get outputShape(){if(this.inboundNodes==null||this.inboundNodes.length===0)throw new Wr(`The layer ${this.name} has never been called and thus has no defined output shape.`);const e=[];for(const t of this.inboundNodes){const s=JSON.stringify(t.outputShapes);e.indexOf(s)===-1&&e.push(s)}if(e.length===1){const t=this.inboundNodes[0].outputShapes;return Array.isArray(t)&&Array.isArray(t[0])&&t.length===1?t[0]:t}else throw new Wr(`The layer ${this.name} has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.`)}countParams(){if(!this.built)throw new or(`You tried to call countParams() on ${this.name}, but the layer is not built yet. Build it first by calling build(batchInputShape).`);return Xf(this.weights)}build(e){this.built=!0}getWeights(e=!1){return sy(e?this.trainableWeights:this.weights)}setWeights(e){le(()=>{const t=this.weights;if(t.length!==e.length)throw new Z(`You called setWeights(weights) on layer "${this.name}" with a weight list of length ${e.length}, but the layer was expecting ${t.length} weights. Provided weights: ${e}...`);if(t.length===0)return;const s=[],r=sy(t);for(let o=0;o<r.length;++o){const i=r[o],a=t[o],l=e[o];if(!xt(i.shape,l.shape))throw new Z(`Layer weight shape ${i.shape} not compatible with provided weight shape ${l.shape}`);s.push([a,l])}Pv(s)})}addWeight(e,t,s,r,o,i,a,l){if(this._addedWeightNames.indexOf(e)!==-1)throw new Z(`Duplicate weight name ${e} for layer ${this.name}`);this._addedWeightNames.push(e),s==null&&(s="float32"),this.fastWeightInitDuringBuild&&(r=l!=null?l():Lt("zeros"));const u=r.apply(t,s),d=new iV(u,s,e,i,a);return u.dispose(),o!=null&&this.addLoss(()=>o.apply(d.read())),i==null&&(i=!0),i?this._trainableWeights.push(d):this._nonTrainableWeights.push(d),d}setFastWeightInitDuringBuild(e){this.fastWeightInitDuringBuild=e}addLoss(e){e==null||Array.isArray(e)&&e.length===0||(e=bt(e),this._losses!==void 0&&this._losses!==null&&this.losses.push(...e))}computeOutputShape(e){return e}computeMask(e,t){if(!this.supportsMasking){if(t!=null)if(Array.isArray(t))t.forEach(s=>{if(s!=null)throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`)});else throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`);return null}return t}setMaskMetadata(e,t,s){if(!this.supportsMasking)return;const r=this.computeMask(e,s),o=bt(t),i=bt(r);if(o.length!==i.length)throw new Error(`${this.name} outputs ${o.length} tensors but ${o.length} masks for those tensors`);for(let a=0;a<o.length;a++)o[a].kerasMask=i[a]}addInboundNode(e,t,s,r,o,i,a=null){const l=bt(e);t=bt(t),s=bt(s),r=bt(r),o=Kf(o),i=Kf(i);const u=[],d=[],f=[];for(const m of l)u.push(m.sourceLayer),d.push(m.nodeIndex),f.push(m.tensorIndex);new Om({outboundLayer:this,inboundLayers:u,nodeIndices:d,tensorIndices:f,inputTensors:l,outputTensors:t,inputMasks:s,outputMasks:r,inputShapes:o,outputShapes:i},a);for(let m=0;m<t.length;m++)t[m].sourceLayer=this,t[m].nodeIndex=this.inboundNodes.length-1,t[m].tensorIndex=m}getConfig(){const e={name:this.name,trainable:this.trainable};return this.batchInputShape!=null&&(e.batchInputShape=this.batchInputShape),this.dtype!=null&&(e.dtype=this.dtype),e}disposeWeights(){return this.weights.forEach(e=>e.dispose()),this.weights.length}assertNotDisposed(){if(this._refCount===0)throw new Error(`Layer '${this.name}' is already disposed.`)}dispose(){if(!this.built)throw new Error(`Cannot dispose Layer ${this.name} because it has not been built yet.`);if(this._refCount===null)throw new Error(`Cannot dispose Layer ${this.name} because it has not been used yet.`);this.assertNotDisposed();let e=0;return--this._refCount===0&&(e=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:e}}}function uV(n){n=bt(n);const e=[];for(const t of n)e.push(t.shape);return fs(e)}function dV(n){return"float32"}function L$(n,e,t){if((e==null||t!=null&&t>0)&&(e=n.sourceLayer,t=n.nodeIndex),e.inboundNodes.length===0)return[n];{const s=e.inboundNodes[t];if(s.inboundLayers.length===0)return s.inputTensors;{const r=[];for(let o=0;o<s.inboundLayers.length;o++){const i=s.inputTensors[o],a=s.inboundLayers[o],l=s.nodeIndices[o],u=L$(i,a,l);for(const d of u)r.indexOf(d)===-1&&r.push(d)}return r}}}function hV(n){let e=!0;for(const t of bt(n))if(!(t instanceof no)){e=!1;break}return e}function fV(n){let e=!0;for(const t of bt(n))if(t instanceof no){e=!1;break}return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Pd extends ot{constructor(e){if(super({dtype:e.dtype,name:e.name!=null?e.name:Lm("input").toString()}),e.batchSize==null&&(e.batchSize=null),e.sparse==null&&(e.sparse=!1),this.trainable=!1,this.built=!0,this.sparse=e.sparse,e.inputShape!=null&&e.batchInputShape!=null)throw new Z("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");let t=e.batchInputShape;if(t==null){if(e.inputShape==null)throw new Z("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");t=[e.batchSize].concat(e.inputShape)}else if(e.batchSize!=null)throw new Z("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");const s=e.dtype||"float32";this.batchInputShape=t,this.dtype=s,this.inputSpec=[{shape:t}];const r=new no(this.dtype,this.batchInputShape,this,[],{},this.name);r.nodeIndex=0,r.tensorIndex=0,new Om({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[r],outputTensors:[r],inputMasks:[null],outputMasks:[null],inputShapes:[t],outputShapes:[t]})}apply(e,t){throw new Z(`Cannot pass any input to an InputLayer's apply() method. InputLayer name: ${this.name}`)}dispose(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}getConfig(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}Pd.className="InputLayer";we(Pd);function pV(n){if(n.batchShape==null&&n.shape==null)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(n.batchShape!=null&&n.shape!=null)throw new Z("Please provide either a `shape` or `batchShape` argument to Input, but not both.");let e=n.batchShape;n.shape!=null&&e==null&&(e=[null].concat(n.shape));let t=n.dtype;return t==null&&(t="float32"),new Pd({batchInputShape:e,name:n.name,dtype:t,sparse:n.sparse}).inboundNodes[0].outputTensors[0]}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function mV(n,e){if(n.dtype==null||n.dtype===e.dtype)return e;try{return Ae(e,n.dtype)}catch{throw new Z(`The dtype of the feed (${e.dtype}) can not be cast to the dtype of the key '${n.name}' (${n.dtype}).`)}}class ei{constructor(e){if(this.id2Value={},this.id2Mask={},this.name2Id={},e instanceof ei)for(const t in e.id2Value)this.id2Value[t]=e.id2Value[t],t in e.id2Mask&&(this.id2Mask[t]=e.id2Mask[t]);else{if(e==null)return;for(const t of e)this.add(t.key,t.value)}}add(e,t,s){if(this.id2Value[e.id]==null)this.id2Value[e.id]=mV(e,t),this.name2Id[e.name]=e.id,s!=null&&(this.id2Mask[e.id]=s);else throw new Z(`Duplicate key: name=${e.name}, id=${e.id}`);return this}addFeed(e){this.add(e.key,e.value)}hasKey(e){return this.id2Value[e.id]!=null}names(){return Object.keys(this.name2Id)}getValue(e){if(e instanceof no){if(this.id2Value[e.id]==null)throw new Z(`Nonexistent key: ${e.name}`);return this.id2Value[e.id]}else{const t=this.name2Id[e];if(t==null)throw new Z(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Value[t]}}getMask(e){if(e instanceof no){if(this.id2Value[e.id]==null)throw new Z(`Nonexistent key: ${e.name}`);return this.id2Mask[e.id]}else{const t=this.name2Id[e];if(t==null)throw new Z(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Mask[t]}}disposeMasks(){this.id2Mask!=null&&nt(this.id2Mask)}}const Qf=new v$,Yf=new v$;function gV(n){Qf!=null&&Qf.setMaxEntries(n),Yf!=null&&Yf.setMaxEntries(n)}function Qc(n,e,t,s){const r=t==null?!1:t.training,o=Array.isArray(n),i=o?n:[n],a=i.map(y=>y.name),l=[],u=e.names();for(const y of a)u.indexOf(y)!==-1?l.push(e.getValue(y)):l.push(null);const d=a.join(",")+"|"+e.names().sort().join(",");let f=Qf.get(d),m;if(f==null){const y=xV(i,e);f=y.sorted,m=y.recipientCounts,Qf.put(d,f),Yf.put(d,m)}m={},r||Object.assign(m,Yf.get(d));const g=new ei(e);for(let y=0;y<f.length;++y){const w=f[y],b=w.sourceLayer;if(b instanceof Pd)continue;const k=[],v=[],N=[];let S=!1;for(const P of w.inputs){const D=g.getValue(P),E=g.getMask(P);k.push(D),v.push(E),E!=null&&(S=!0),r||(m[P.name]--,m[P.name]===0&&!e.hasKey(P)&&a.indexOf(P.name)===-1&&!D.isDisposed&&P.sourceLayer.stateful!==!0&&N.push(D))}S&&(t=t||{},t.mask=v[0]);const $=bt(b.apply(k,t));let R=null;b.supportsMasking&&(R=b.computeMask(k,v));const M=vV(w),A=Array.isArray(M)?M:[M];for(let P=0;P<A.length;++P){g.hasKey(A[P])||g.add(A[P],$[P],Array.isArray(R)?R[0]:R);const D=a.indexOf(A[P].name);D!==-1&&(l[D]=$[P])}r||nt(N)}return g.disposeMasks(),o?l:l[0]}function xV(n,e){_(n!=null&&n.length>0,()=>"Expected at least one fetch, got none");let t=[],s={};if(n.length===1){const r=lC(n[0],e);t=r.sorted,s=r.recipientMap}else{const r=new Set;for(const o of n){const{sorted:i,recipientMap:a}=lC(o,e);for(const l of i)r.has(l.name)||(t.push(l),r.add(l.name));for(const l in a)s[l]==null&&(s[l]=new Set),a[l].forEach(u=>s[l].add(u))}}return{sorted:t,recipientCounts:yV(s)}}function yV(n){const e={};for(const t in n)e[t]=n[t].size;return e}function lC(n,e){const t=new Set,s=[],r={};for(const a of e.names())t.add(a);const o=[],i=[];for(o.push(n);o.length>0;){const a=o[o.length-1];if(t.has(a.name)){o.pop();continue}const l=i[i.length-1]===o.length-1;if(a.inputs.length===0||l)o.pop(),s.push(a),t.add(a.name),l&&i.pop();else{i.push(o.length-1);for(const u of a.inputs)r[u.name]==null&&(r[u.name]=new Set),r[u.name].add(a.name),!t.has(u.name)&&o.push(u)}}return{sorted:s,recipientMap:r}}function vV(n){let e;if(n.sourceLayer.inboundNodes.length===1)e=n.sourceLayer.output;else{let t=null;for(let s=0;s<n.sourceLayer.inboundNodes.length;++s)for(const r of n.sourceLayer.inboundNodes[s].outputTensors)if(r.id===n.id){t=s;break}e=n.sourceLayer.getOutputAt(t)}return e}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bV=de();bV.registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",()=>100,gV);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Fv(n,e){return le(()=>Bn(We(te(n,n),e,!0)))}class Fd extends zl{getConfig(){return{}}}class j$ extends Fd{constructor(e){super(),this.defaultMaxValue=2,this.defaultAxis=0,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return le(()=>{const t=Fv(e,this.axis),s=Us(t,0,this.maxValue);return te(e,Ge(s,Ie(dn(),t)))})}getConfig(){return{maxValue:this.maxValue,axis:this.axis}}}j$.className="MaxNorm";we(j$);class O$ extends Fd{constructor(e){super(),this.defaultAxis=0,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return le(()=>Ge(e,Ie(dn(),Fv(e,this.axis))))}getConfig(){return{axis:this.axis}}}O$.className="UnitNorm";we(O$);class _$ extends Fd{apply(e){return ya(e)}}_$.className="NonNeg";we(_$);class z$ extends Fd{constructor(e){super(),this.defaultMinValue=0,this.defaultMaxValue=1,this.defaultRate=1,this.defaultAxis=0,this.minValue=e.minValue!=null?e.minValue:this.defaultMinValue,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.rate=e.rate!=null?e.rate:this.defaultRate,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return le(()=>{const t=Fv(e,this.axis),s=Ie(te(this.rate,Us(t,this.minValue,this.maxValue)),te(1-this.rate,t));return te(e,Ge(s,Ie(dn(),t)))})}getConfig(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}z$.className="MinMaxNorm";we(z$);const cC={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function fn(n){return Sv(n)}function uC(n,e={}){return Rd(n,rr.getMap().classNameMap,e,"constraint")}function pn(n){if(n==null)return null;if(typeof n=="string"){const t={className:n in cC?cC[n]:n,config:{}};return uC(t)}else return n instanceof Fd?n:uC(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */async function _i(n){if(n==null)return;const e=[],t=[],s=[];for(const r in n){const o=n[r];if(typeof o!="number"){const i=o;e.push(i.data()),t.push(r),s.push(i)}}if(e.length>0){const r=await Promise.all(e);for(let o=0;o<r.length;++o)n[t[o]]=r[o][0];nt(s)}}function B$(n){if(n!=null)for(const e in n){const t=n[e];typeof t!="number"&&t.dispose()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var dC;(function(n){n[n.SILENT=0]="SILENT",n[n.VERBOSE=1]="VERBOSE"})(dC||(dC={}));const wV=125;class pu{constructor(){this.validationData=null}setParams(e){this.params=e}async onEpochBegin(e,t){}async onEpochEnd(e,t){}async onBatchBegin(e,t){}async onBatchEnd(e,t){}async onTrainBegin(e){}async onTrainEnd(e){}setModel(e){}}class kV{constructor(e,t=10){e==null&&(e=[]),this.callbacks=e,this.queueLength=t}append(e){this.callbacks.push(e)}setParams(e){for(const t of this.callbacks)t.setParams(e)}setModel(e){for(const t of this.callbacks)t.setModel(e)}async onEpochBegin(e,t){t==null&&(t={});for(const s of this.callbacks)await s.onEpochBegin(e,t)}async onEpochEnd(e,t){t==null&&(t={});for(const s of this.callbacks)await s.onEpochEnd(e,t)}async onBatchBegin(e,t){t==null&&(t={});for(const s of this.callbacks)await s.onBatchBegin(e,t)}async onBatchEnd(e,t){t==null&&(t={});for(const s of this.callbacks)await s.onBatchEnd(e,t)}async onTrainBegin(e){e==null&&(e={});for(const t of this.callbacks)await t.onTrainBegin(e)}async onTrainEnd(e){e==null&&(e={});for(const t of this.callbacks)await t.onTrainEnd(e)}}class CV extends pu{constructor(){super()}async onEpochBegin(e){this.seen=0,this.totals={}}async onBatchEnd(e,t){t==null&&(t={});const s=t.size==null?0:t.size;this.seen+=s;for(const r in t){const o=t[r];if(typeof o=="number")this.totals.hasOwnProperty(r)||(this.totals[r]=0),this.totals[r]=this.totals[r]+o*s;else{let i;r in this.totals?i=this.totals[r]:this.totals[r]=0;const a=le(()=>Ie(this.totals[r],te(o,s)));this.totals[r]=a,i!=null&&i.dispose()}}}async onEpochEnd(e,t){if(t!=null)for(const s of this.params.metrics)this.totals[s]!=null&&(typeof this.totals[s]=="number"?t[s]=this.totals[s]/this.seen:le(()=>{const r=te(Ge(1,this.seen),this.totals[s]);t[s]=r,this.totals[s].dispose(),Kr(t[s])}))}}class SV extends pu{async onTrainBegin(e){this.epoch=[],this.history={}}async onEpochEnd(e,t){t==null&&(t={}),this.epoch.push(e);for(const s in t)this.history[s]==null&&(this.history[s]=[]),this.history[s].push(t[s])}async syncData(){const e=[],t=[],s=[];for(const o in this.history){const i=this.history[o];for(let a=0;a<i.length;++a)if(typeof i[a]!="number"){const l=i[a];e.push(l.data()),t.push(o),s.push(a)}}const r=await Promise.all(e);for(let o=0;o<r.length;++o)this.history[t[o]][s[o]].dispose(),this.history[t[o]][s[o]]=r[o][0]}}class NV extends pu{constructor(e,t){if(super(),this.currentEpoch=0,this.nowFunc=e.nowFunc,this.nextFrameFunc=e.nextFrameFunc||HI,this.yieldEvery=t||"auto",this.yieldEvery==="auto"&&(this.yieldEvery=wV),this.yieldEvery==="never"&&e.onYield!=null)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");M0(this.yieldEvery)&&(this.maybeWait=OB(this.maybeWait.bind(this),this.yieldEvery,this.nowFunc)),this.trainBegin=e.onTrainBegin,this.trainEnd=e.onTrainEnd,this.epochBegin=e.onEpochBegin,this.epochEnd=e.onEpochEnd,this.batchBegin=e.onBatchBegin,this.batchEnd=e.onBatchEnd,this.yield=e.onYield}async maybeWait(e,t,s){const r=[];this.yield!=null&&(await _i(s),r.push(this.yield(e,t,s))),r.push(this.nextFrameFunc()),await Promise.all(r)}async onEpochBegin(e,t){this.currentEpoch=e,this.epochBegin!=null&&(await _i(t),await this.epochBegin(e,t))}async onEpochEnd(e,t){const s=[];this.epochEnd!=null&&(await _i(t),s.push(this.epochEnd(e,t))),this.yieldEvery==="epoch"&&s.push(this.nextFrameFunc()),await Promise.all(s)}async onBatchBegin(e,t){this.batchBegin!=null&&(await _i(t),await this.batchBegin(e,t))}async onBatchEnd(e,t){const s=[];this.batchEnd!=null&&(await _i(t),s.push(this.batchEnd(e,t))),this.yieldEvery==="batch"?s.push(this.nextFrameFunc()):M0(this.yieldEvery)&&s.push(this.maybeWait(this.currentEpoch,e,t)),await Promise.all(s)}async onTrainBegin(e){this.trainBegin!=null&&(await _i(e),await this.trainBegin(e))}async onTrainEnd(e){this.trainEnd!=null&&(await _i(e),await this.trainEnd(e))}}function V$(n,e){return n==null&&(n={}),n instanceof pu?[n]:Array.isArray(n)&&n[0]instanceof pu?n:bt(n).map(s=>new NV(s,e))}class nr{constructor(){}static registerCallbackConstructor(e,t){_(e>=0&&Number.isInteger(e),()=>`Verbosity level is expected to be an integer >= 0, but got ${e}`),nr.checkForDuplicate(t),nr.constructors[e]==null&&(nr.constructors[e]=[]),nr.constructors[e].push(t)}static checkForDuplicate(e){for(const t in nr.constructors)nr.constructors[+t].forEach(r=>{if(r===e)throw new Z("Duplicate callback constructor.")})}static clear(){nr.constructors={}}static createCallbacks(e){const t=[];for(const s in nr.constructors){const r=+s;e>=r&&t.push(...nr.constructors[r])}return t.map(s=>new s)}}nr.constructors={};function W$(n,e,t,s,r,o,i,a,l){const u=new SV,d=[new CV,...nr.createCallbacks(e)];n!=null&&d.push(...n),d.push(u);const f=new kV(d);return f.setParams({epochs:t,initialEpoch:s,samples:r,steps:o,batchSize:i,verbose:e,doValidation:a,metrics:l}),{callbackList:f,history:u}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Jr(n,e={},t=!1){return Rd(n,rr.getMap().classNameMap,e,"layer",t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Jf(n,e){return le(()=>{n.dtype!=="float32"&&(n=Ae(n,"float32"));const t=We(Dd(n),e,!0),s=Tm(t.shape,dn()),r=Bn(yi(t,s));return Ge(n,r)})}function _m(n,e){return le(()=>rn(Dd(Ke(e,n)),-1))}function Lv(n,e){return le(()=>rn(es(Ke(e,n)),-1))}function jv(n,e){return le(()=>{const t=Ke(n,e),s=Us(es(n),dn(),Number.MAX_VALUE),r=es(Ge(t,s));return te(100,rn(r,-1))})}function IV(n,e){return le(()=>{const t=Us(e,dn(),Number.MAX_VALUE),s=to(Ie(1,t)),r=Us(n,dn(),Number.MAX_VALUE),o=to(Ie(1,r));return rn(Dd(Ke(s,o)),-1)})}function $V(n,e){return le(()=>{const t=yi(0,Ke(1,te(n,e)));return rn(Dd(t),-1)})}function TV(n,e){return le(()=>{const t=yi(0,Ke(1,te(n,e)));return rn(t,-1)})}function EV(n,e){return le(()=>{const t=We(te(n,e),-1),s=Er(te(Ke(1,n),e),-1);return yi(0,Ie(1,Ke(s,t)))})}function RV(n,e){return le(()=>{const t=Math.log(2),s=Ke(e,n),r=Ke(Ie(s,Cd(te(-2,s))),t);return rn(r,-1)})}function mu(n,e,t=!1){return le(()=>{if(t)e=z1(e);else{const s=We(e,e.shape.length-1,!0);e=Ge(e,s)}return e=Us(e,dn(),1-dn()),Yt(We(te(Ae(n,"float32"),to(e)),e.shape.length-1))})}function Zf(n,e,t=!1){return le(()=>{const s=Ae(Am(QB(n)),"int32");e=Us(e,dn(),1-dn());const r=e.shape,o=re(fI(s,r[r.length-1]),r);return mu(o,e,t)})}function AV(n,e){if(!xt(n.shape,e.shape))throw new Z(`logits and labels must have the same shape, but got shapes ${JSON.stringify(n.shape)} and ${JSON.stringify(e.shape)}`);return le(()=>{const t=ya(e),s=Yt(es(e));return Ie(Ke(t,te(e,n)),cI(eo(s)))})}function zm(n,e){return le(()=>{let t;return t=Us(e,dn(),1-dn()),t=to(Ge(t,Ke(1,t))),rn(AV(n,t),-1)})}function DV(n,e){return le(()=>{const t=Us(n,dn(),1),s=Us(e,dn(),1);return We(te(n,to(Ge(t,s))),-1)})}function MV(n,e){return le(()=>{const t=to(Ie(dn(),e));return rn(Ke(e,te(n,t)),-1)})}function U$(n,e){return le(()=>{const t=Jf(n,-1),s=Jf(e,-1),r=te(t,s);return Yt(We(r,-1))})}const ep={meanSquaredError:_m,meanAbsoluteError:Lv,meanAbsolutePercentageError:jv,meanSquaredLogarithmicError:IV,squaredHinge:$V,hinge:TV,categoricalHinge:EV,logcosh:RV,categoricalCrossentropy:mu,sparseCategoricalCrossentropy:Zf,binaryCrossentropy:zm,kullbackLeiblerDivergence:DV,poisson:MV,cosineProximity:U$};function a0(n){if(typeof n=="string"){if(n in ep)return ep[n];let e=`Unknown loss ${n}`;throw n.toLowerCase().includes("softmaxcrossentropy")&&(e=`Unknown loss ${n}. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy`),new Z(e)}else return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function G$(n,e){return le(()=>{const t=te(.5,cr(e)),s=Qr(Gs(e,t),n.dtype);return rn(Zr(n,s),-1)})}function H$(n,e){return le(()=>Qr(Zr(cu(n,-1),cu(e,-1)),"float32"))}function PV(n,e){return le(()=>Ae(We(ko(Zr(n,1),Zr(e,1))),"float32"))}function FV(n,e){return le(()=>Ae(We(ko(Zr(n,0),Zr(e,1))),"float32"))}function LV(n,e){return le(()=>{const t=PV(n,e),s=FV(n,e),r=Ie(t,s);return Ae(ss(Gs(r,0),Ge(t,r),0),"float32")})}function jV(n,e){return zm(n,e)}function OV(n,e){return n.rank===e.rank&&(n=Nd(n,[n.rank-1])),e=cu(e,-1),e.dtype!==n.dtype&&(e=Ae(e,n.dtype)),Ae(Zr(n,e),"float32")}const _V=_m,zV=_m,BV=Lv,VV=Lv,WV=jv,UV=jv,q$=mu,GV=U$,K$=Zf,tp={binaryAccuracy:G$,categoricalAccuracy:H$,precision:LV,categoricalCrossentropy:q$,sparseCategoricalCrossentropy:K$,mse:_V,MSE:zV,mae:BV,MAE:VV,mape:WV,MAPE:UV,cosine:GV};function HV(n){if(typeof n=="string"&&n in tp)return tp[n];if(typeof n!="string"&&n!=null)return n;throw new Z(`Unknown metric ${n}`)}function cf(n){if(Ur(n!==null,`Unknown LossOrMetricFn ${n}`),typeof n=="string")return n;{let e;for(const t of Object.keys(ep))if(ep[t]===n){e=t;break}if(e!==void 0)return e;for(const t of Object.keys(tp))if(tp[t]===n){e=t;break}return e!==void 0?e:n.name}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function qV(n){const e={Adagrad:()=>Qo.adagrad(.01),Adadelta:()=>Qo.adadelta(1,.95,dn()),Adam:()=>Qo.adam(.001,.9,.999,dn()),Adamax:()=>Qo.adamax(.002,.9,.999,dn(),0),RMSProp:()=>Qo.rmsprop(.001,.9,0,dn()),SGD:()=>Qo.sgd(.01)};if(e.adagrad=e.Adagrad,e.adadelta=e.Adadelta,e.adam=e.Adam,e.adamax=e.Adamax,e.rmsprop=e.RMSProp,e.sgd=e.SGD,n in e)return e[n]();throw new Z(`Unknown Optimizer ${n}`)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const hC=1*1024*1024;function fC(n,e,t=!1){if(n==null||typeof n!="object"||Object.getPrototypeOf(n)!==Object.prototype||!ry(n))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(t){const s=JSON.stringify(n);s.length>hC&&console.warn(`User-defined metadata of model "${e}" is too large in size (length=${s.length} when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= ${hC}.`)}}function ry(n){if(n===null)return!0;if(typeof n=="object")if(Object.getPrototypeOf(n)===Object.prototype){const e=Object.keys(n);for(const t of e)if(typeof t!="string"||!ry(n[t]))return!1;return!0}else if(Array.isArray(n)){for(const e of n)if(!ry(e))return!1;return!0}else return!1;else{const e=typeof n;return e==="string"||e==="number"||e==="boolean"}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function KV(n,e,t,s=console.log){const r=QV(n),o=["Layer (type)","Input Shape","Output shape","Param #"];r?(e=e||90,t=t||[.32,.61,.89,1]):(e=e||115,t=t||[.24,.48,.7,.8,1]),t[t.length-1]<=1&&(t=t.map(d=>Math.floor(e*d)));let i;if(!r){o.push("Receives inputs"),i=[];for(const d in n.nodesByDepth)i.push(...n.nodesByDepth[d])}s("_".repeat(e)),np(o,t,s),s("=".repeat(e));const a=n.layers;for(let d=0;d<a.length;++d)r?YV(a[d],t,s):JV(a[d],t,i,s),s((d===a.length-1?"=":"_").repeat(e));n.checkTrainableWeightsConsistency();const l=XV(n),u=Xf(n.nonTrainableWeights);s(`Total params: ${l+u}`),s(`Trainable params: ${l}`),s(`Non-trainable params: ${u}`),s("_".repeat(e))}function XV(n){let e;return n.collectedTrainableWeights!=null?e=Xf(n.collectedTrainableWeights):e=Xf(n.trainableWeights),e}function QV(n){let e=!0;const t=[],s=[];for(const r in n.nodesByDepth)t.push(n.nodesByDepth[r]);for(const r of t){if(r.length>1||r.length===1&&r[0].inboundLayers.length>1){e=!1;break}s.push(...r)}if(e)for(const r of n.layers){let o=!1;for(const i of r.inboundNodes)if(s.indexOf(i)!==-1)if(o){e=!1;break}else o=!0;if(!e)break}return e}function np(n,e,t=console.log){let s="";for(let r=0;r<n.length;++r)r>0&&(s=s.slice(0,s.length-1)+" "),s+=n[r],s=s.slice(0,e[r]),s+=" ".repeat(e[r]-s.length);t(s)}function YV(n,e,t){let s,r;try{r=n.inboundNodes.map(l=>JSON.stringify(l.inputShapes)).join(",")}catch{r="multiple"}try{s=JSON.stringify(n.outputShape)}catch{s="multiple"}const o=n.name,i=n.getClassName(),a=[`${o} (${i})`,r,s,n.countParams().toString()];np(a,e,t)}function JV(n,e,t,s){let r,o;try{o=n.inboundNodes.map(f=>JSON.stringify(f.inputShapes)).join(",")}catch{o="multiple"}try{r=JSON.stringify(n.outputShape)}catch{r="multiple"}const i=[];for(const f of n.inboundNodes)if(!(t!=null&&t.length>0&&t.indexOf(f)===-1))for(let m=0;m<f.inboundLayers.length;++m){const g=f.inboundLayers[m].name,y=f.nodeIndices[m],w=f.tensorIndices[m];i.push(`${g}[${y}][${w}]`)}const a=n.name,l=n.getClassName(),u=i.length===0?"":i[0],d=[`${a} (${l})`,o,r,n.countParams().toString(),u];np(d,e,s);for(let f=1;f<i.length;++f)np(["","","","",i[f]],e,s)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function X$(n,e,t){return(n==="inboundNodes"||n==="outputLayers"||n==="inputLayers")&&e===0&&typeof t=="string"}function sp(n,e){if(n===null)return null;if(typeof n=="string")return Wi(n);if(typeof n=="number"||typeof n=="boolean")return n;if(n instanceof Array){const t=[],s=n.length;for(let r=0;r<s;++r){const o=n[r];X$(e,r,o)?t.push(o):t.push(sp(o,e))}return t}else{const t={};for(const s of Object.keys(n)){const r=n[s];if(s==="name"&&typeof r=="string")t[s]=r;else{const o=Wi(s);t[o]=sp(r,o)}}return t}}function oy(n,e){if(n==null)return null;if(typeof n=="string")return vo(n);if(typeof n=="number"||typeof n=="boolean")return n;if(n instanceof Array){const t=[],s=n.length;for(let r=0;r<s;++r){const o=n[r];X$(e,r,o)?t.push(o):t.push(oy(o,e))}return t}else{const t={};for(const s of Object.keys(n)){const r=n[s],o=vo(s);(s==="name"||s==="className")&&typeof r=="string"?t[o]=r:t[o]=oy(r,s)}return t}}/** @license See the LICENSE file. */const Q$="4.22.0";/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const ZV=n=>{const e=Object.keys(n);if(e.length===0)return!1;const t=e[0].split("/");return!isNaN(parseInt(t[t.length-1],10))};class Sr extends ot{constructor(e){if(super({}),this.containerNodes=new Set,this.name=e.name,this.name==null){const v=this.getClassName().toLowerCase();this.name=Lm(v)}if(this.supportsMasking=!1,this.trainable_=!0,Array.isArray(e.inputs)?this.inputs=e.inputs.slice():this.inputs=[e.inputs],Array.isArray(e.outputs)?this.outputs=e.outputs.slice():this.outputs=[e.outputs],oi(this.inputs).length!==this.inputs.length)throw new Z(`The list of inputs passed to the model is redundant. All inputs should only appear once. Found: ${this.inputs.map(v=>v.name)}`);oi(this.outputs).length!==this.outputs.length&&console.warn(`The list of outputs passed to the model is redundant. All outputs should only appear once. Found: ${this.outputs.map(v=>v.name)}`),this.inputLayers=[],this.inputLayersNodeIndices=[],this.inputLayersTensorIndices=[],this.outputLayers=[],this.outputLayersNodeIndices=[],this.outputLayersTensorIndices=[],this.layers=[],this.internalContainerRefs=[];for(const v of this.outputs){const N=v.sourceLayer,S=v.nodeIndex,$=v.tensorIndex;this.outputLayers.push(N),this.outputLayersNodeIndices.push(S),this.outputLayersTensorIndices.push($)}for(const v of this.inputs){const N=v.sourceLayer,S=v.nodeIndex,$=v.tensorIndex;Ur(S===0,"input layer has >1 nodes"),Ur($===0,"input layer has >1 tensors"),this.inputLayers.push(N),this.inputLayersNodeIndices.push(S),this.inputLayersTensorIndices.push($)}this.inputNames=[],this.outputNames=[],this.feedInputShapes=[],this.feedInputNames=[],this.feedOutputNames=[];for(let v=0;v<this.inputLayers.length;v++){const N=this.inputLayers[v];if(!(N instanceof Pd))throw new TypeError(`Input layers to a LayersModel must be InputLayer objects. Received inputs: ${e.inputs}. Input ${v} (0-based) originates from layer type ${N.getClassName()}.`);this.inputNames.push(N.name),this.feedInputShapes.push(N.batchInputShape),this.feedInputNames.push(N.name)}for(const v of this.outputLayers)this.outputNames.push(v.name);this.internalInputShapes=this.inputs.map(v=>v.shape),this.internalOutputShapes=this.outputs.map(v=>v.shape);const t={},s={},r={},o={},i={},a=[],l=(v,N,S,$,R,M)=>{($==null||R==null||M==null)&&($=v.sourceLayer,R=v.nodeIndex,M=v.tensorIndex);const A=$.inboundNodes[R];if(S.indexOf(A)!==-1)throw new or(`The tensor ${v.name} at layer "${$.name}" is part of a cycle.`);if(N.indexOf(A)!==-1)return;this.containerNodes.add(Sr.nodeKey($,R)),$.id in i||(i[$.id]=Object.keys(i).length),S.indexOf(A)===-1&&S.push(A);const P=A.inboundLayers.length;for(let D=0;D<P;D++){const E=A.inputTensors[D],j=A.inboundLayers[D],V=A.nodeIndices[D],W=A.tensorIndices[D];l(E,N,S,j,V,W)}for(N.push(A);S.indexOf(A)>=0;)S.splice(S.indexOf(A),1);a.push(A)},u=[],d=[];for(const v of this.outputs)l(v,u,d);const f=a.slice().reverse();for(const v of f){s[v.id]=v,v.id in t||(t[v.id]=0);let N=t[v.id];const S=r[v.outboundLayer.id]==null?0:r[v.outboundLayer.id];N=Math.max(N,S),r[v.outboundLayer.id]=N,o[v.outboundLayer.id]=v.outboundLayer,t[v.id]=N;for(let $=0;$<v.inboundLayers.length;$++){const R=v.inboundLayers[$],M=v.nodeIndices[$],A=R.inboundNodes[M],P=t[A.id]==null?0:t[A.id];t[A.id]=Math.max(N+1,P),s[A.id]=A}}const m={};for(const v in t){const N=t[v];N in m||(m[N]=[]),m[N].push(s[v])}const g={};for(const v in r){const N=r[v];N in g||(g[N]=[]),g[N].push(o[v])}let y=Object.keys(g).map(v=>parseInt(v,10)).sort(of);this.layers=[];for(const v of y){const N=g[v];N.sort((S,$)=>{const R=i[S.id],M=i[$.id];return R<M?-1:R>M?1:0});for(const S of N)S instanceof Sr&&this.internalContainerRefs.push(S),this.layers.push(S)}this.layersByDepth=g,y=Object.keys(m).map(v=>parseInt(v,10)).sort(of);const w=this.inputs.slice(),b=[];for(const v of y)for(const N of m[v]){const S=N.outboundLayer;if(S!=null){for(const $ of N.inputTensors)if(w.indexOf($)===-1)throw new or(`Graph disconnected: cannot obtain value for tensor ${$} at layer "${S.name}". The following previous layers were accessed without issue: ${b}`);for(const $ of N.outputTensors)w.push($);b.push(S.name)}}this.nodesByDepth=m;const k=this.layers.map(v=>v.name);for(const v of k){const N=k.filter(S=>S===v).length;if(N!==1)throw new or(`The name "${v}" is used ${N} times in the model. All layer names should be unique. Layer names: `+JSON.stringify(k))}this.outboundNodes=[],this.inboundNodes=[],new Om({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:this.inputs.map(v=>null),outputMasks:this.outputs.map(v=>null),inputShapes:this.inputs.map(v=>v.shape),outputShapes:this.outputs.map(v=>v.shape)}),this.built=!0,this._refCount=1}assertNotDisposed(){if(this._refCount===0)throw new Error(`Container '${this.name}' is already disposed.`)}dispose(){this.assertNotDisposed();const e={refCountAfterDispose:null,numDisposedVariables:0};if(--this._refCount===0){for(const t of this.layers)e.numDisposedVariables+=t.dispose().numDisposedVariables;for(const t of this.internalContainerRefs)e.numDisposedVariables+=t.dispose().numDisposedVariables}return e.refCountAfterDispose=this._refCount,e}get trainable(){return this.trainable_}set trainable(e){this.layers.forEach(t=>{t._trainableWeights.forEach(s=>s.trainable=e)}),this.trainable_=e}get trainableWeights(){if(this._trainableWeights.length>0)throw new Z("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];let e=[];for(const t of this.layers)e=e.concat(t.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const t of this.layers)e.push(...t.nonTrainableWeights);if(!this.trainable){const t=[];for(const s of this.layers)t.push(...s.trainableWeights);return t.concat(e)}return e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}loadWeights(e,t=!0){const s={};let r=0;const o=ZV(e);o&&this.parseWeights(e);for(const a of this.layers)for(const[l,u]of a.weights.entries()){const d=o?`${u.name.split("/").slice(0,-1).join("/")+"/"}${l}`:u.originalName;if(s[d]!=null)throw new Z(`Duplicate weight name: ${d}`);s[d]=u,r++}const i=[];for(const a in e){let l=a;if(s[a]==null){const u=a.split("/");l=u.slice(0,-2).concat([u[u.length-1]]).join("/")}if(s[l]!=null)i.push([s[l],e[a]]);else if(t)throw new Z(`Provided weight data has no target variable: ${a}`);delete s[l]}if(t){const a=[];for(const l in s)a.push(l);if(a.length>0)throw new Z(`${a.length} of ${r} weights are not set: ${a}`)}Pv(i)}parseWeights(e){for(const t in Object.keys(e)){const s=t.split("/"),r=["vars","layer_checkpoint_dependencies"],o=s.map(i=>i.startsWith("_")?i.slice(1):i).filter(i=>!r.includes(i)).join("/");o!==t&&(e[o]=e[t],delete e[t])}}updatedConfig(){const e=this.getConfig(),t={};return t.className=this.getClassName(),t.config=e,t.kerasVersion=`tfjs-layers ${Q$}`,t.backend="TensorFlow.js",t}toJSON(e,t=!0){const s=oy(this.updatedConfig());return t?JSON.stringify(s):s}call(e,t){return le(()=>{e=bt(e);const s=new ei;for(let r=0;r<this.inputs.length;++r)s.add(this.inputs[r],e[r]);return Qc(this.outputs,s,t)})}computeMask(e,t){return le(()=>{e=bt(e);let s;return t==null?s=ca(null,e.length):s=bt(t),this.runInternalGraph(e,s)[1]})}computeOutputShape(e){const t=Kf(e);if(t.length!==this.inputLayers.length)throw new Z(`Invalid inputShape argument ${e}: model has ${this.inputLayers.length} tensor inputs.`);const s={};for(let a=0;a<t.length;a++){const l=this.inputLayers[a],u=t[a],d=l.name+"_0_0";s[d]=u}const r=Object.keys(this.nodesByDepth).map(a=>parseInt(a,10)).sort(of);if(r.length>1)for(const a of r){const l=this.nodesByDepth[a];for(const u of l){const d=u.outboundLayer;if(this.inputLayers.map(w=>w.id).indexOf(d.id)!==-1)continue;const f=[];for(let w=0;w<u.inboundLayers.length;w++){const b=u.inboundLayers[w],k=u.nodeIndices[w],v=u.tensorIndices[w],N=`${b.name}_${k}_${v}`,S=s[N];f.push(S)}const m=d.computeOutputShape(fs(f)),g=Kf(m),y=d.inboundNodes.indexOf(u);for(let w=0;w<g.length;w++){const b=`${d.name}_${y}_${w}`;s[b]=g[w]}}}const o=[],i=[];for(let a=0;a<this.outputLayers.length;a++){const l=this.outputLayers[a],u=this.outputLayersNodeIndices[a],d=this.outputLayersTensorIndices[a],f=`${l.name}_${u}_${d}`;i.push(f)}for(let a=0;a<i.length;a++){const l=i[a];Ur(l in s),o.push(s[l])}return fs(o)}runInternalGraph(e,t){t==null&&(t=ca(null,e.length));const s={};for(let l=0;l<this.inputs.length;++l){const u=this.inputs[l],d=e[l],f=t[l];s[u.id]=[d,f]}const r=Object.keys(this.nodesByDepth).map(l=>parseInt(l,10)).sort(of);for(const l of r){const u=this.nodesByDepth[l];for(const d of u){const f=d.outboundLayer,m=d.inputTensors,g=d.outputTensors,y=new Array;for(const w of m)w.id in s&&y.push(s[w.id]);if(y.length===m.length){let w={},b,k,v,N;if(d.callArgs!=null&&(w=d.callArgs),y.length===1){const[S,$]=y[0];w.mask==null&&(w.mask=$),v=bt(f.call(S,w)),N=bt(f.computeMask(S,$)),b=[S],k=[$]}else b=y.map(S=>S[0]),k=y.map(S=>S[1]),w.mask==null&&(w.mask=k),v=bt(f.call(b,w)),N=bt(f.computeMask(b,k));if(f.activityRegularizer)throw new tt("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(let S=0;S<g.length;++S){const $=g[S],R=v[S],M=N[S];s[$.id]=[R,M]}}}}const o=[],i=[],a=[];for(const l of this.outputs){Ur(l.id in s,`Could not compute output ${l.name} : ${l.id}`);const[u,d]=s[l.id];a.push(u.shape),o.push(u),i.push(d)}return[o,i,a]}buildNodeConversionMap(e){const t={};let s;for(const r of this.layers){s=r instanceof Sr?1:0;for(let o=0;o<r.inboundNodes.length;o++){const i=Sr.nodeKey(r,o);this.containerNodes.has(i)&&(t[i]=s,s+=1)}}return t}getLayer(e,t){if(t!=null)return this.findLayer(t);if(e==null)throw new Z("Provide either a layer name or layer index");if(typeof e=="number")return this.findLayer(e);for(const s of this.layers)if(s.name===e)return s;throw new Z(`No such layer: ${e}`)}findLayer(e){if(this.layers.length<=e)throw new Z(`Was asked to retrieve layer at index ${e}, but model only has ${this.layers.length} layer(s).`);return this.layers[e]}calculateLosses(){return le(()=>{const e=[];for(const t of this.layers)for(let s=0;s<t.inboundNodes.length;++s){const r=Sr.nodeKey(t,s);this.containerNodes.has(r)&&e.push(...t.calculateLosses())}return e})}getConfig(){const e={name:this.name},t=this.buildNodeConversionMap(this.layers),s=[];for(const i of this.layers){const a=i.getClassName(),l=i.getConfig(),u=[];for(let f=0;f<i.inboundNodes.length;f++){const m=i.inboundNodes[f],g=Sr.nodeKey(i,f);let y={};if(this.containerNodes.has(g)){if(m.callArgs)try{JSON.stringify(m.callArgs),y=m.callArgs}catch{console.warn(`Layer ${i.name} was passed non-serializable keyword arguments: ${m.callArgs}. They will not be included in the serialized model (and thus will be missing at deserialization time).`),y={}}if(m.inboundLayers.length>0){const w=[];for(let b=0;b<m.inboundLayers.length;b++){const k=m.inboundLayers[b],v=m.nodeIndices[b],N=m.tensorIndices[b],S=Sr.nodeKey(k,v);let $=t[S];$==null&&($=0),w.push([k.name,$,N,y])}u.push(w)}}}const d={};d.name=i.name,d.className=a,d.config=l,d.inboundNodes=u,s.push(d)}e.layers=s;const r=[];for(let i=0;i<this.inputLayers.length;i++){const a=this.inputLayers[i],l=this.inputLayersNodeIndices[i],u=Sr.nodeKey(a,l);if(!this.containerNodes.has(u))continue;let d=t[u];d==null&&(d=0);const f=this.inputLayersTensorIndices[i];r.push([a.name,d,f])}e.inputLayers=r;const o=[];for(let i=0;i<this.outputLayers.length;i++){const a=this.outputLayers[i],l=this.outputLayersNodeIndices[i],u=Sr.nodeKey(a,l);if(!this.containerNodes.has(u))continue;let d=t[u];d==null&&(d=0);const f=this.outputLayersTensorIndices[i];o.push([a.name,d,f])}return e.outputLayers=o,e}static fromConfig(e,t,s={},r=!1){const o={},i={};function a(b,k){b.name in i?i[b.name].push(k):i[b.name]=[k]}function l(b,k){const v=[];let N;for(const S of k){const $=S[0],R=S[1],M=S[2];if(N=S[3]==null?{}:S[3],!($ in o)){a(b,k);return}const A=o[$];if(A.inboundNodes.length<=R){a(b,k);return}const P=A.inboundNodes[R];v.push(P.outputTensors[M])}v.length>0&&b.apply(fs(v),N)}function u(b){const k=b.name,v=Jr(b,t.customObjects!=null?t.customObjects:{});v.setFastWeightInitDuringBuild(r),o[k]=v,b.inboundNodes.forEach(S=>{if(!(S instanceof Array))throw new Z(`Corrupted configuration, expected array for nodeData: ${S}`);a(v,S)})}const d=t.name,f=t.layers;for(const b of f)u(b);for(;!jB(i);)for(const b of f){const k=o[b.name];if(k.name in i){const v=i[k.name];delete i[k.name];for(const N of v)l(k,N)}}const m=[],g=[],y=t.inputLayers;for(const b of y){const k=b[0],v=b[1],N=b[2];Ur(k in o);const $=o[k].inboundNodes[v].outputTensors;m.push($[N])}const w=t.outputLayers;for(const b of w){const k=b[0],v=b[1],N=b[2];Ur(k in o);const $=o[k].inboundNodes[v].outputTensors;g.push($[N])}return new e({inputs:m,outputs:g,name:d})}get stateful(){if(this._stateful)throw new Z("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(const e of this.layers)if(e.stateful)return!0;return!1}resetStates(){le(()=>{this.layers.forEach(e=>{e.stateful&&e.resetStates()})})}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function e6(n,e,t){const s=e.length;if(n==null||Array.isArray(n)&&n.length===0)return e.map(r=>null);if(s===1)return Array.isArray(n)&&n.length===1?n:typeof n=="object"&&e[0]in n?[n[e[0]]]:[n];if(Array.isArray(n)){if(n.length!==s)throw new Error(`Provided ${t} is an array of ${n.length} element(s), but the model has ${s} outputs. Make sure a set of weights is provided for each model output.`);return n}else if(typeof n=="object"&&Object.keys(n).length>0&&typeof n[Object.keys(n)[0]]=="object"){const r=[];return e.forEach(o=>{o in n?r.push(n[o]):r.push(null)}),r}else throw new Error(`The model has multiple (${s}) outputs, so ${t} must be either an array with ${s} elements or an object with ${e} keys. Provided ${t} not understood: ${JSON.stringify(n)}`)}function Y$(n,e){return e6(n,e,"classWeight")}async function J$(n,e,t,s){if(t!=null){const r=le(()=>{if(n.shape.length===1)return Ki(n);if(n.shape.length===2){if(n.shape[1]>1)return cu(n,1);if(n.shape[1]===1)return re(n,[n.shape[0]]);throw new Error(`Encountered unexpected last-dimension size (${n.shape[1]}) during handling of class weights. The size is expected to be >= 1.`)}else throw new Error(`Unexpected rank of target (y) tensor (${n.rank}) during handling of class weights. The rank is expected to be 1 or 2.`)}),o=Array.from(await r.data());nt(r);const i=[];return o.forEach(a=>{if(t[a]==null)throw new Error(`classWeight must contain all classes in the training data. The class ${a} exists in the data but not in classWeight`);i.push(t[a])}),ps(i,"float32")}else return null}function t6(n,e){return te(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const n6=32;function Z$(n,e){let t,s;const r=e;t=r.xs,s=r.ys,_(t!=null&&s!=null,()=>`A Dataset iterator for fitDataset() is expected to generate objects of the form \`{xs: xVal, ys: yVal}\`, where the two values may be \`tf.Tensor\`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates ${e}`);const o=pC("input",n.inputNames,t),i=pC("output",n.outputNames,s),a=o[0].shape[0];_(o.length===n.inputs.length,()=>`LayersModel has ${n.inputs.length} inputs, but the dataset provides ${o.length} inputs.  (Expected input keys: ${JSON.stringify(n.inputNames)})`),_(i.length===n.outputs.length,()=>`LayersModel has ${n.outputs.length} outputs, but the dataset provides ${i.length} outputs.  (Expected output keys: ${JSON.stringify(n.outputNames)})`);for(let l=0;l<o.length;l++)_(o[l].shape[0]===a,()=>`Batch size mismatch: input ${n.inputNames[l]} has ${o[l].shape[0]}; expected  ${a} based on input ${n.inputNames[0]}.`);for(let l=0;l<i.length;l++)_(i[l].shape[0]===a,()=>`Batch size mismatch: output ${n.outputNames[l]} has ${i[l].shape[0]}; expected  ${a} based on input ${n.inputNames[0]}.`);return{xs:o,ys:i}}function pC(n,e,t){if(t instanceof un)return[t];if(Array.isArray(t))return _(t.length===e.length,()=>`Received an array of ${t.length} Tensors, but expected ${e.length} to match the ${n} keys ${e}.`),t;{const s=[];for(const r of e){if(t[r]==null)throw new Z(`The feature data generated by the dataset lacks the required ${n} key '${r}'.`);s.push(t[r])}return s}}function s6(n){if(n.length===3)throw new tt("Validation with sample weights is not implemented yet.");return{xs:n[0],ys:n[1]}}async function r6(n,e,t){const s=t.batchesPerEpoch!=null;if(_(n.optimizer!=null,()=>"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."),_(t!=null,()=>"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."),_(t.epochs!=null&&t.epochs>0&&Number.isInteger(t.epochs),()=>`For fitDataset(), config.epochs is expected to be a positive integer, but got ${t.epochs}`),_(!s||t.batchesPerEpoch>0&&Number.isInteger(t.batchesPerEpoch),()=>`For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got ${t.batchesPerEpoch}`),_(t.validationSplit==null,()=>"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."),n.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");n.isTraining=!0;try{const r=t.validationData!=null;let o,i;if(r)if(mC(t.validationData))_(t.validationBatches==null||t.validationBatches>0&&Number.isInteger(t.validationBatches),()=>`For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got ${t.validationBatches}`);else{const b=s6(t.validationData);o=b.xs,i=b.ys}const a=n.makeTrainFunction(),l=n.getDedupedMetricsNames();let u;r?u=l.slice().concat(l.map(b=>"val_"+b)):u=l.slice();const d=V$(t.callbacks,t.yieldEvery),f=t.verbose==null?1:t.verbose,{callbackList:m,history:g}=W$(d,f,t.epochs,null,null,o6(e,t),null,r,u);m.setModel(n),n.history=g,await m.onTrainBegin(),n.stopTraining_=!1;let y=t.initialEpoch==null?0:t.initialEpoch,w=await e.iterator();for(;y<t.epochs;){const b={};await m.onEpochBegin(y);let k=0,v=0;for(s||(w=await e.iterator());!s||k<t.batchesPerEpoch;){const N=await w.next();if(s&&N.done){console.warn(`You provided \`batchesPerEpoch\` as ${t.batchesPerEpoch}, but your dataset iterator ran out of data after ${k} batches; interrupting training. Make sure that your dataset can generate at least \`batchesPerEpoch * epochs\` batches (in this case, ${t.batchesPerEpoch*t.epochs} batches). You may need to use the repeat() function when building your dataset.`);break}if(N.value!=null){const{xs:S,ys:$}=Z$(n,N.value),R={};R.batch=v,R.size=S[0].shape[0],await m.onBatchBegin(v,R);const M=[];if(t.classWeight!=null){const D=Y$(t.classWeight,n.outputNames);for(let E=0;E<D.length;++E)M.push(await J$($[E],null,D[E]))}const A=S.concat($).concat(M),P=a(A);nt(A);for(let D=0;D<l.length;++D){const E=l[D],j=P[D];R[E]=j,Kr(j)}await m.onBatchEnd(v,R),B$(R),v++,k++}if(s?k>=t.batchesPerEpoch:N.done){if(r){let S;mC(t.validationData)?S=bt(await n.evaluateDataset(t.validationData,{batches:t.validationBatches})):S=bt(n.evaluate(o,i,{batchSize:t.validationBatchSize==null?n6:t.validationBatchSize,verbose:0}));for(let $=0;$<n.metricsNames.length;++$)b[`val_${n.metricsNames[$]}`]=S[$]}break}if(n.stopTraining_)break}if(await m.onEpochEnd(y,b),y++,n.stopTraining_)break}return await m.onTrainEnd(),await n.history.syncData(),n.history}finally{n.isTraining=!1}}function o6(n,e){let t=null;return e.batchesPerEpoch!=null?t=e.batchesPerEpoch:Number.isFinite(n.size)&&(t=n.size),t}function mC(n){return typeof n.iterator=="function"}function i6(n){return typeof n.next=="function"}async function a6(n,e,t){t=t||{};const s=t.batches!=null,r=n.testFunction;let o=[];if(t.verbose>0)throw new tt("Verbose mode is not implemented yet.");_(!s||t.batches>0&&Number.isInteger(t.batches),()=>`Test loop expects \`batches\` to be a positive integer, but received ${JSON.stringify(t.batches)}`);const i=i6(e)?e:await e.iterator();let a=0,l=0;for(;!s||l<t.batches;){const u=await i.next();if(o=le(()=>{if(u.value){const{xs:d,ys:f}=Z$(n,u.value),m=d.concat(f),g=le(()=>r(m));if(nt(m),l===0)for(let w=0;w<g.length;++w)o.push(gt(0));const y=m[0].shape[0];for(let w=0;w<g.length;++w){const b=g[w],k=o[w];o[w]=le(()=>Ie(o[w],te(y,b))),l>0&&nt(k)}nt(g),a+=y,++l}return o}),u.done){s&&console.warn(`Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least \`batches\` batches (in this case, ${t.batches} batches). You may need to use the repeat() function when building your dataset.`);break}}for(let u=0;u<o.length;++u){const d=o[u];o[u]=Ge(o[u],a),nt(d)}return fs(o)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function l0(n){_(n>0&&Number.isInteger(n),()=>`batchSize is required to be a positive integer, but got ${n}`)}function Vc(n,e,t){return n==null?[null]:Array.isArray(n)?n.map(s=>Qi(s,e,t-e)):Qi(n,e,t-e)}function iy(n,e){return le(()=>n==null?null:Array.isArray(n)?n.map(t=>iy(t,e)):$$(n,e.dtype==="int32"?e:Ae(e,"int32")))}function c0(n,e){const t=[];let s=0,r=null;for(;s<n;)r=s+e,r>=n&&(r=n),t.push([s,r]),s=r;return t}function eT(n){const e=[];n instanceof un&&(n=[n]);for(let t=0;t<n.length;++t){const s=n[t];if(s.rank===1)e.push(Ad(s,1));else{if(s.rank===0)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");e.push(s)}}return e}function Cr(n,e){if(n==null)return;const t=[];if(e instanceof un)t.push(e.id);else if(Array.isArray(e))e.forEach(r=>t.push(r.id));else if(e!=null)for(const r in e){const o=e[r];t.push(o.id)}const s=[];if(n instanceof un)t.indexOf(n.id)===-1&&s.push(n);else if(Array.isArray(n))n.forEach(r=>{t.indexOf(r.id)===-1&&s.push(r)});else if(n!=null)for(const r in n){const o=n[r];t.indexOf(o.id)===-1&&s.push(o)}s.forEach(r=>{r.isDisposed||r.dispose()})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function l6(n){return n instanceof un}function ay(n){return Array.isArray(n)}function gC(n){return!l6(n)&&!ay(n)}function xC(n,e,t,s=!0,r=""){if(e==null||e.length===0){if(n!=null){let i=!1;if(ay(n)&&n.length>0)i=!0;else if(gC(n)){for(const a in n)if(n.hasOwnProperty(a)){i=!0;break}}else i=!0;if(i)throw new Z(`Error when checking model ${r} expected no data, but got ${n}`)}return[]}if(n==null)return e.map(i=>null);let o;if(gC(n)){n=n,o=[];for(const i of e){if(n[i]==null)throw new Z(`No data provided for "${i}". Need data for each key in: ${e}`);o.push(n[i])}}else if(ay(n)){if(n=n,n.length!==e.length)throw new Z(`Error when checking model ${r}: the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see ${e.length} Tensor(s), but instead got the following list of Tensor(s): ${n}`);o=n}else{if(n=n,e.length>1)throw new Z(`The model ${r} expects ${e.length} Tensor(s), but only received one Tensor. Found: Tensor with shape ${n.shape}`);o=[n]}if(o=eT(o),t!=null)for(let i=0;i<e.length;++i){if(t[i]==null)continue;const a=o[i];if(a.shape.length!==t[i].length)throw new Z(`Error when checking ${r}: expected ${e[i]} to have ${t[i].length} dimension(s). but got array with shape ${a.shape}`);for(let l=0;l<t[i].length;++l){if(l===0&&!s)continue;const u=a.shape[l],d=t[i][l];if(d!=null&&d>=0&&u!==d)throw new Z(`${r} expected a batch of elements where each example has shape [${t[i].slice(1,t[i].length)}] (i.e.,tensor shape [*,${t[i].slice(1,t[i].length)}]) but the ${r} received an input with ${a.shape[0]} examples, each with shape [${a.shape.slice(1,a.shape.length)}] (tensor shape [${a.shape}])`)}}return o}function c6(n,e,t){const s=oi(n.map(o=>o.shape[0]));s.sort();const r=oi(e.map(o=>o.shape[0]));if(r.sort(),s.length>1)throw new Z(`All input Tensors (x) should have the same number of samples. Got array shapes: ${JSON.stringify(n.map(o=>o.shape))}`);if(r.length>1)throw new Z(`All target Tensors (y) should have the same number of samples. Got array shapes: ${JSON.stringify(e.map(o=>o.shape))}`);if(s.length>0&&r.length>0&&!xt(s,r))throw new Z(`Input Tensors should have the same number of samples as target Tensors. Found ${s[0]} input sample(s) and ${r[0]} target sample(s).`)}function u6(n,e,t){const s=[_m,zm,mu];for(let r=0;r<n.length;++r){const o=n[r],i=e[r],a=t[r];if(i!=null){if(i===mu&&o.shape[o.shape.length-1]===1)throw new Z(`You are passing a target array of shape ${o.shape} while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].`);if(s.indexOf(i)!==-1){const l=o.shape.slice(1),u=a.slice(1);for(let d=0;d<l.length;++d){const f=l[d],m=u[d];if(m!=null&&f!==m)throw new Z(`A target Tensor with shape ${o.shape} was passed for an output of shape ${a}, while using a loss function that expects targets to have the same shape as the output.`)}}}}}function yC(n,e,t,s=!0,r=""){let o;if(Array.isArray(n)){if(n.length!==e.length)throw new Z(`Error when checking model ${r}: the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see ${e.length} Tensor(s), but instead got ${n.length} Tensors(s).`);o=n}else{if(e.length>1)throw new Z(`The model expects ${e.length} ${r} Tensors, but only received one Tensor. Found: array with shape ${JSON.stringify(n.shape)}.`);o=[n]}if(t!=null)for(let i=0;i<e.length;++i){if(t[i]==null)continue;const a=o[i];if(a.shape.length!==t[i].length)throw new Z(`Error when checking ${r}: expected ${e[i]} to have ${t[i].length} dimension(s), but got array with shape ${JSON.stringify(a.shape)}`);for(let l=0;l<t[i].length;++l){if(l===0&&!s)continue;const u=a.shape[l],d=t[i][l];if(d!=null&&d!==u)throw new Z(`Error when checking ${r}: expected ${e[i]} to have shape ${JSON.stringify(t[i])} but got array with shape ${JSON.stringify(a.shape)}.`)}}}function d6(n,e){if(n==null||Array.isArray(n)&&n.length===0)return e.map(s=>[]);let t;if(typeof n=="string"||typeof n=="function")t=[n];else if(Array.isArray(n)||typeof n=="object")t=n;else throw new TypeError(`Type of metrics argument not understood. Expected an string,function, Array, or Object, found: ${n}`);if(Array.isArray(t))return e.map(s=>t);{const s=[];for(const r of e){let o=t.hasOwnProperty(r)?t[r]:[];Array.isArray(o)||(o=[o]),s.push(o)}return s}}const h6="layers-model";class hl extends Sr{constructor(e){super(e),this.isTraining=!1}summary(e,t,s=console.log){if(!this.built)throw new Z("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");KV(this,e,t,s)}compile(e){if(e.loss==null&&(e.loss=[]),this.loss=e.loss,typeof e.optimizer=="string")this.optimizer_=qV(e.optimizer),this.isOptimizerOwned=!0;else{if(!(e.optimizer instanceof bi))throw new Z("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=e.optimizer,this.isOptimizerOwned=!1}let t=[];if(!Array.isArray(e.loss)&&typeof e.loss!="string"&&typeof e.loss!="function"){e.loss=e.loss;for(const i in e.loss)if(this.outputNames.indexOf(i)===-1)throw new Z(`Unknown entry in loss dictionary: "${i}". Only expected the following keys: ${this.outputNames}`);for(const i of this.outputNames)e.loss[i]==null&&console.warn(`Output "${i}" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to ${i} during training`),t.push(a0(e.loss[i]))}else if(Array.isArray(e.loss)){if(e.loss.length!==this.outputs.length)throw new Z(`When passing an Array as loss, it should have one entry per model output. The model has ${this.outputs.length} output(s), but you passed loss=${e.loss}.`);t=e.loss.map(a=>a0(a))}else{const i=a0(e.loss);this.outputs.forEach(a=>{t.push(i)})}this.lossFunctions=t,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(let i=0;i<this.outputs.length;++i){const a=this.internalOutputShapes[i],l=this.outputNames[i];this.feedOutputNames.push(l),this.feedOutputShapes.push(a),this.feedLossFns.push(this.lossFunctions[i])}const s=[];this.metrics=e.metrics,this.metricsNames=["loss"],this.metricsTensors=[],Xi("loss",()=>{for(let i=0;i<this.outputs.length;++i){if(s.indexOf(i)!==-1)continue;const a=this.lossFunctions[i];this.outputs.length>1&&(this.metricsTensors.push([a,i]),this.metricsNames.push(this.outputNames[i]+"_loss"))}});const r=d6(e.metrics,this.outputNames),o=(i,a,l)=>{this.outputNames.length>1&&(a=this.outputNames[i]+"_"+a),this.metricsNames.push(a),this.metricsTensors.push([l,i])};Xi("metric",()=>{for(let i=0;i<this.outputs.length;++i){if(s.indexOf(i)!==-1)continue;const a=r[i];(u=>{let f,m,g;for(const y of u){if(typeof y=="string"&&["accuracy","acc","crossentropy","ce"].indexOf(y)!==-1){const b=this.internalOutputShapes[i];b[b.length-1]===1||this.lossFunctions[i]===zm?["accuracy","acc"].indexOf(y)!==-1?m=G$:["crossentropy","ce"].indexOf(y)!==-1&&(m=jV):this.lossFunctions[i]===Zf?["accuracy","acc"].indexOf(y)!==-1?m=OV:["crossentropy","ce"].indexOf(y)!==-1&&(m=K$):["accuracy","acc"].indexOf(y)!==-1?m=H$:["crossentropy","ce"].indexOf(y)!==-1&&(m=q$);let k;["accuracy","acc"].indexOf(y)!==-1?k="acc":["crossentropy","ce"].indexOf(y)!==-1&&(k="ce"),g=m,f=""+k}else g=HV(y),f=""+cf(y);let w;Xi(f,()=>{w=g}),o(i,f,w)}})(a)}}),this.collectedTrainableWeights=this.trainableWeights}checkTrainableWeightsConsistency(){this.collectedTrainableWeights!=null&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}evaluate(e,t,s={}){const r=s.batchSize==null?32:s.batchSize;l0(r);const i=this.standardizeUserDataXY(e,t,!0,r);try{const a=i[0].concat(i[1]);this.makeTestFunction();const l=this.testFunction,u=this.testLoop(l,a,r,s.verbose,s.steps);return fs(u)}finally{Cr(i[0],e),Cr(i[1],t)}}async evaluateDataset(e,t){return this.makeTestFunction(),a6(this,e,t)}checkNumSamples(e,t,s,r="steps"){let o;if(s!=null){if(o=null,t!=null)throw new Z(`If ${r} is set, batchSize must be null or undefined.Got batchSize = ${t}`)}else if(e!=null)Array.isArray(e)?o=e[0].shape[0]:o=e.shape[0];else throw new Z(`Either the input data should have a defined shape, or ${r} shoud be specified.`);return o}execute(e,t){if(Array.isArray(t)&&t.length===0)throw new Z("`outputs` is an empty Array, which is not allowed.");const s=Array.isArray(t),r=s?t:[t],o=this.retrieveSymbolicTensors(r),i=new ei;if(e instanceof un&&(e=[e]),Array.isArray(e)){if(e.length!==this.inputs.length)throw new Z(`The number of inputs provided (${e.length}) does not match the number of inputs of this model (${this.inputs.length}).`);for(let l=0;l<this.inputs.length;++l)i.add(this.inputs[l],e[l])}else for(const l of this.inputs){const u=e[l.name];if(u==null)throw new Z(`No value is provided for the model's input ${l.name}`);i.add(l,u)}const a=Qc(o,i);return s?a:a[0]}retrieveSymbolicTensors(e){const t=ca(null,e.length);let s=e.length;for(const r of this.layers){const o=Array.isArray(r.output)?r.output:[r.output],i=o.map(a=>a.name);for(let a=0;a<e.length;++a){const l=i.indexOf(e[a]);if(l!==-1&&(t[a]=o[l],s--),s===0)break}if(s===0)break}if(s>0){const r=[];throw t.forEach((o,i)=>{o==null&&r.push(e[i])}),new Z(`Cannot find SymbolicTensors for output name(s): ${JSON.stringify(r)}`)}return t}predictLoop(e,t=32,s=!1){return le(()=>{const r=this.checkNumSamples(e);if(s)throw new tt("Verbose predictLoop() is not implemented yet.");const o=c0(r,t),i=this.outputs.map(a=>[]);for(let a=0;a<o.length;++a)le(()=>{const u=o[a][0],d=o[a][1],f=Vc(e,u,d),m=[];if(Array.isArray(f))for(let y=0;y<f.length;++y)m.push({key:this.inputs[y],value:f[y]});else m.push({key:this.inputs[0],value:f});const g=new ei(m);return Qc(this.outputs,g)}).forEach((u,d)=>i[d].push(u));return fs(i.map(a=>ms(a,0)))})}predict(e,t={}){const s=eT(e);yC(s,this.inputNames,this.feedInputShapes,!1);try{const r=t.batchSize==null?32:t.batchSize;return l0(r),this.predictLoop(s,r)}finally{Cr(s,e)}}predictOnBatch(e){yC(e,this.inputNames,this.feedInputShapes,!0);const t=(Array.isArray(e)?e[0]:e).shape[0];return this.predictLoop(e,t)}standardizeUserDataXY(e,t,s=!0,r){if(this.optimizer_==null)throw new or("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");const o=[];for(let i=0;i<this.feedOutputShapes.length;++i){const a=this.feedOutputShapes[i];this.feedLossFns[i]===Zf?o.push(a.slice(0,a.length-1).concat([1])):o.push(a)}if(e=xC(e,this.feedInputNames,this.feedInputShapes,!1,"input"),t=xC(t,this.feedOutputNames,o,!1,"target"),c6(e,t),u6(t,this.feedLossFns,this.feedOutputShapes),this.stateful&&r!=null&&r>0&&e[0].shape[0]%r!==0)throw new Z(`In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size ${r}. Found: ${e[0].shape[0]} sample(s).`);return[e,t]}async standardizeUserData(e,t,s,r,o=!0,i){const[a,l]=this.standardizeUserDataXY(e,t,o,i);if(s!=null)throw new Error("sample weight is not supported yet.");let u=null;if(r!=null){const d=Y$(r,this.outputNames);u=[];for(let f=0;f<d.length;++f)u.push(await J$(l[f],null,d[f]))}return[a,l,u]}testLoop(e,t,s,r=0,o){return le(()=>{const i=this.checkNumSamples(t,s,o,"steps"),a=[];if(r>0)throw new tt("Verbose mode is not implemented yet.");if(o!=null)throw new tt("steps mode in testLoop() is not implemented yet");{const l=c0(i,s),u=ps(Ar(0,i));for(let d=0;d<l.length;++d){const f=l[d][0],m=l[d][1],g=Qi(u,f,m-f),y=iy(t,g),w=e(y);if(d===0)for(let b=0;b<w.length;++b)a.push(gt(0));for(let b=0;b<w.length;++b){const k=w[b];a[b]=Ie(a[b],te(m-f,k))}}for(let d=0;d<a.length;++d)a[d]=Ge(a[d],i)}return a})}getDedupedMetricsNames(){const e=this.metricsNames,t=[];for(let s=0;s<e.length;++s){const r=e[s];let o=r;if(nC(e,r)>1){const i=nC(e.slice(0,s),r);o+=`_${i}`}t.push(o)}return t}makeTrainFunction(){return e=>{const t=[],s=e.slice(0,this.inputs.length),r=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),o=e.slice(this.inputs.length+this.outputs.length,this.inputs.length+this.outputs.length*2),i=[],a=()=>{const f=[];for(let w=0;w<this.inputs.length;++w)f.push({key:this.inputs[w],value:s[w]});const m=new ei(f),g=Qc(this.outputs,m,{training:!0});let y;for(let w=0;w<this.lossFunctions.length;++w){const b=this.lossFunctions[w];let k=b(r[w],g[w]);o[w]!=null&&(k=t6(k,o[w]));const v=rn(k);t.push(v),w===0?y=k:y=Ie(y,k)}for(let w=0;w<this.metricsTensors.length;++w){let b;if(this.outputs.length>1&&w<this.outputs.length)b=t[w];else{const k=this.metricsTensors[w][0],v=this.metricsTensors[w][1];b=rn(k(r[v],g[v]))}Kr(b),i.push(b)}return y=rn(y),this.calculateLosses().forEach(w=>{y=Ie(y,w)}),y},l=this.collectedTrainableWeights.map(f=>f.read());return[this.optimizer_.minimize(a,!0,l)].concat(i)}}makeTestFunction(){this.testFunction=e=>le(()=>{const t=[];let s;const r=e.slice(0,this.inputs.length),o=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),i=[];for(let u=0;u<this.inputs.length;++u)i.push({key:this.inputs[u],value:r[u]});const a=new ei(i),l=Qc(this.outputs,a);for(let u=0;u<this.lossFunctions.length;++u){const d=this.lossFunctions[u],f=rn(d(o[u],l[u]));u===0?s=f:s=Ie(s,f),t.push(s)}for(let u=0;u<this.metricsTensors.length;++u){const d=this.metricsTensors[u][0],f=this.metricsTensors[u][1],m=rn(d(o[f],l[f]));t.push(m)}return t})}async fit(e,t,s={}){if(this.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");this.isTraining=!0;let r,o,i,a,l,u,d,f,m;try{const g=s.batchSize==null?32:s.batchSize;l0(g);const w=await this.standardizeUserData(e,t,s.sampleWeight,s.classWeight,!1,g);r=w[0],o=w[1],m=w[2];let b=!1,k;if(s.validationData!=null&&s.validationData.length>0){if(b=!0,s.validationData.length===2)l=s.validationData[0],u=s.validationData[1];else throw s.validationData.length===3?new tt("validationData including sample weights is not supported yet."):new Z(`When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; ${s.validationData} is invalid.`);const D=await this.standardizeUserData(l,u,null,null,!0,g);d=D[0],f=D[1],k=d.concat(f)}else if(s.validationSplit!=null&&s.validationSplit>0&&s.validationSplit<1){b=!0;const P=Math.floor(r[0].shape[0]*(1-s.validationSplit)),D=r[0].shape[0];d=Vc(r,P,D),i=r,r=Vc(r,0,P),f=Vc(o,P,D),a=o,o=Vc(o,0,P),k=d.concat(f)}else s.validationSteps!=null&&(b=!0);const v=r.concat(o).concat(m);this.checkTrainableWeightsConsistency();const N=this.makeTrainFunction(),S=this.getDedupedMetricsNames();let $,R;b?(this.makeTestFunction(),$=this.testFunction,R=S.slice().concat(S.map(P=>"val_"+P))):($=null,k=[],R=S.slice());const M=V$(s.callbacks,s.yieldEvery);return await this.fitLoop(N,v,S,g,s.epochs,s.verbose,M,$,k,s.shuffle,R,s.initialEpoch,null,null)}finally{this.isTraining=!1,Cr(r,e),Cr(o,t),Cr(i,e),Cr(a,t),Cr(d,l),Cr(f,u),m!=null&&nt(m)}}async fitLoop(e,t,s,r,o,i,a,l,u,d,f,m,g,y){r==null&&(r=32),o==null&&(o=1),d==null&&(d=!0),m==null&&(m=0);let w=!1;if(l!=null&&u!=null&&(w=!0),y!=null&&(w=!0,g==null))throw new Z("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");const b=this.checkNumSamples(t,r,g,"steps_per_epoch");let k;b!=null&&(k=Ar(0,b)),i==null&&(i=1);const{callbackList:v,history:N}=W$(a,i,o,m,b,g,r,w,f);v.setModel(this),this.history=N,await v.onTrainBegin(),this.stopTraining_=!1;for(let S=m;S<o;++S){await v.onEpochBegin(S);const $={};if(g!=null)throw new tt("stepsPerEpoch mode is not implemented yet.");{if(d==="batch")throw new tt("batch shuffling is not implemneted yet");d&&EM(k);const R=ps(k),M=c0(b,r);for(let A=0;A<M.length;++A){const P={};if(await v.onBatchBegin(A,P),le(()=>{const D=M[A][0],E=M[A][1],j=Qi(R,D,E-D);P.batch=A,P.size=E-D;const V=iy(t,j),W=e(V);for(let U=0;U<s.length;++U){const X=s[U],ee=W[U];P[X]=ee,Kr(ee)}if(A===M.length-1&&w){const U=this.testLoop(l,u,r);for(let X=0;X<s.length;++X){const ee=s[X],G=U[X];Kr(G),$["val_"+ee]=G}}}),await v.onBatchEnd(A,P),B$(P),this.stopTraining_)break}R.dispose()}if(await v.onEpochEnd(S,$),this.stopTraining_)break}return await v.onTrainEnd(),await this.history.syncData(),this.history}async fitDataset(e,t){return r6(this,e,t)}async trainOnBatch(e,t){const s=await this.standardizeUserData(e,t),r=s[0],o=s[1],a=this.makeTrainFunction()(r.concat(o)),l=[];for(const u of a){const d=await u.data();l.push(d[0])}return nt(a),Cr(s[0],e),Cr(s[1],t),fs(l)}getNamedWeights(e){const t=[],s=e!=null&&e.trainableOnly,r=s?this.trainableWeights:this.weights,o=this.getWeights(s);for(let i=0;i<r.length;++i)s&&!r[i].trainable||t.push({name:r[i].originalName,tensor:o[i]});return t}set stopTraining(e){this.stopTraining_=e}get stopTraining(){return this.stopTraining_}get optimizer(){return this.optimizer_}set optimizer(e){this.optimizer_!==e&&(this.optimizer_=e,this.isOptimizerOwned=!1)}dispose(){const e=super.dispose();if(e.refCountAfterDispose===0&&this.optimizer!=null&&this.isOptimizerOwned){const t=E2().numTensors;this.optimizer_.dispose(),e.numDisposedVariables+=t-E2().numTensors}return e}getLossIdentifiers(){let e;if(typeof this.loss=="string")e=vo(this.loss);else if(Array.isArray(this.loss)){for(const t of this.loss)if(typeof t!="string")throw new Error("Serialization of non-string loss is not supported.");e=this.loss.map(t=>vo(t))}else{const t=Object.keys(this.loss);e={};const s=this.loss;for(const r of t)if(typeof s[r]=="string")e[r]=vo(s[r]);else throw new Error("Serialization of non-string loss is not supported.")}return e}getMetricIdentifiers(){if(typeof this.metrics=="string"||typeof this.metrics=="function")return[vo(cf(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(e=>vo(cf(e)));{const e={};for(const t in this.metrics)e[t]=vo(cf(this.metrics[t]));return e}}getTrainingConfig(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}loadTrainingConfig(e){if(e.weighted_metrics!=null)throw new Error("Loading weight_metrics is not supported yet.");if(e.loss_weights!=null)throw new Error("Loading loss_weights is not supported yet.");if(e.sample_weight_mode!=null)throw new Error("Loading sample_weight_mode is not supported yet.");const t=sp(e.optimizer_config),s=Jr(t);let r;if(typeof e.loss=="string")r=Wi(e.loss);else if(Array.isArray(e.loss))r=e.loss.map(i=>Wi(i));else if(e.loss!=null){r={};for(const i in e.loss)r[i]=Wi(e.loss[i])}let o;if(Array.isArray(e.metrics))o=e.metrics.map(i=>Wi(i));else if(e.metrics!=null){o={};for(const i in e.metrics)o[i]=Wi(e.metrics[i])}this.compile({loss:r,metrics:o,optimizer:s})}async save(e,t){if(typeof e=="string"){const u=PP(e);if(u.length===0)throw new Z(`Cannot find any save handlers for URL '${e}'`);if(u.length>1)throw new Z(`Found more than one (${u.length}) save handlers for URL '${e}'`);e=u[0]}if(e.save==null)throw new Z("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");const s=await R2(this.getNamedWeights(t)),a={modelTopology:this.toJSON(null,!1),format:h6,generatedBy:`TensorFlow.js tfjs-layers v${Q$}`,convertedBy:null};if((t==null?!1:t.includeOptimizer)&&this.optimizer!=null){a.trainingConfig=this.getTrainingConfig();const u="optimizer",{data:d,specs:f}=await R2(await this.optimizer.getWeights(),u);s.specs.push(...f),s.data=IP([s.data,d])}return this.userDefinedMetadata!=null&&(fC(this.userDefinedMetadata,this.name,!0),a.userDefinedMetadata=this.userDefinedMetadata),a.weightData=s.data,a.weightSpecs=s.specs,e.save(a)}setUserDefinedMetadata(e){fC(e,this.name),this.userDefinedMetadata=e}getUserDefinedMetadata(){return this.userDefinedMetadata}}hl.className="Model";we(hl);class tT extends hl{}tT.className="Functional";we(tT);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */async function f6(n,e){if(e==null&&(e={}),typeof n=="string"){const t=FP(n,e);if(t.length===0)t.push(bz(n,e));else if(t.length>1)throw new Z(`Found more than one (${t.length}) load handlers for URL '${n}'`);n=t[0]}return p6(n,void 0,e)}async function p6(n,e,t){if(t==null&&(t={}),n.load==null)throw new Z("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");const s=await n.load();let r=s.modelTopology;r.model_config!=null&&(r=r.model_config);const o=t.strict==null?!0:t.strict,i=s.weightData!=null&&s.weightSpecs!=null&&o,a=Jr(sp(r),e,i),l=s.trainingConfig;if(l!=null&&a.loadTrainingConfig(l),s.userDefinedMetadata!=null&&a.setUserDefinedMetadata(s.userDefinedMetadata),s.weightData!=null){if(s.weightSpecs==null)throw new Z("LayersModel artifacts contains weight data, but not weight specs. Therefore loading of weights cannot proceed.");const{modelWeights:u,optimizerWeights:d}=m6(s.weightData,s.weightSpecs);a.loadWeights(u,o),a.optimizer!=null&&d.length>0&&await a.optimizer.setWeights(d),nt(u),nt(d.map(f=>f.tensor))}return a}function m6(n,e){const t=bP(n,e),s={},r=[];return e.forEach(o=>{o.group==="optimizer"?r.push({name:o.name,tensor:t[o.name]}):s[o.name]=t[o.name]}),{modelWeights:s,optimizerWeights:r}}class Nl extends hl{constructor(e){if(super({inputs:[],outputs:[]}),e=e||{},this.trainable=!0,this.built=!1,this.name=e.name!=null?e.name:Lm("sequential_"),e.layers!=null)for(const t of e.layers)this.add(t)}checkShape(e){if(e.inboundNodes[0].outputTensors[0].shape.some(s=>s<0))throw new Z(`Negative dimension size caused by adding layer ${e.name} with input shape [${e.inboundNodes[0].inputTensors[0].shape}]`)}add(e){const t=e instanceof Nl||e instanceof hl;let s;if(t){if(s=e,s.outputs.length!==1)throw new Z("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(s.inputs.length!==1)throw new Z("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(this.outputs.length===0){if(e.inboundNodes.length===0){if(e.batchInputShape==null)throw new Z("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");const r=pV({batchShape:e.batchInputShape,dtype:e.dtype,name:e.name+"_input"});e.apply(r)}if(t)this.outputs=s.outputs,this.inputs=s.inputs;else{if(e.inboundNodes.length!==1)throw new Z(`A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer ${e.name} which has ${e.inboundNodes.length} pre-existing inbound connections.`);if(e.inboundNodes[0].outputTensors.length!==1)throw new Z("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[e.inboundNodes[0].outputTensors[0]],this.inputs=L$(this.outputs[0])}this.inboundNodes=[],new Om({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:ca(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(r=>r.shape),outputShapes:this.outputs[0].shape})}else{const r=e.apply(this.outputs[0]);if(Array.isArray(r))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[r],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(e),this.built=!1}pop(){if(this.layers.length===0)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),this.layers.length===0)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{const e=this.layers.length-1;this.layers[e].outboundNodes=[],this.outputs=[this.layers[e].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}call(e,t){return this.model==null&&this.build(),this.model.call(e,t)}build(e){if(ht(e),this.inputs.length===0||this.outputs.length===0)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new hl({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}countParams(){return this.built||this.build(),super.countParams()}summary(e,t,s=console.log){this.built||this.build(),super.summary(e,t,s)}setWeights(e){this.model==null&&this.build(),this.model.setWeights(e)}evaluate(e,t,s={}){if(!this.built)throw new or("The model needs to be compiled before being used.");return this.model.evaluate(e,t,s)}async evaluateDataset(e,t){if(!this.built)throw new or("The model needs to be compiled before being used.");return this.model.evaluateDataset(e,t)}predict(e,t={}){return this.model==null&&this.build(),this.model.predict(e,t)}predictOnBatch(e){return this.model==null&&this.build(),this.model.predictOnBatch(e)}compile(e){this.build(),this.model.compile(e),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}get optimizer(){return this.model==null?void 0:this.model.optimizer}set optimizer(e){this.model.optimizer=e}async fit(e,t,s={}){if(!this.built)throw new or("The model needs to be compiled before being used.");return this.model.fit(e,t,s)}async fitDataset(e,t){if(!this.built)throw new or("The model needs to be compiled before being used.");return this.model.fitDataset(e,t)}async trainOnBatch(e,t){return this.model.trainOnBatch(e,t)}static fromConfig(e,t,s={},r=!1){let o,i={};if(t instanceof Array){if(t[0].className==null||t[0].className==="Merge")throw new Z("Legacy serialization format not supported yet.");o=t}else _(t.layers!=null,()=>"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."),o=t.layers,delete t.layers,i=t;const a=new e(i);if(!(a instanceof Nl))throw new tt(`Sequential.fromConfig called on non-Sequential input: ${a}`);for(const l of o){const d=Jr(l,void 0,r);r&&d.setFastWeightInitDuringBuild(!0),a.add(d)}return a}set stopTraining(e){if(this.model==null)throw new Z("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=e}get stopTraining(){if(this.model==null)throw new Z("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}getConfig(){const e=[];for(const t of this.layers){const s={};s.className=t.getClassName(),s.config=t.getConfig(),e.push(s)}return{name:this.name,layers:e}}}Nl.className="Sequential";we(Nl);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function g6(n){return new Nl(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let Wn=class extends zl{getConfig(){return{}}};class nT extends Wn{apply(e,t=1){return JB(e,t)}}nT.className="elu";we(nT);class sT extends Wn{apply(e){return yI(e)}}sT.className="selu";we(sT);class rT extends Wn{apply(e){return ya(e)}}rT.className="relu";we(rT);class oT extends Wn{apply(e){return le(()=>hu(6,ya(e)))}}oT.className="relu6";we(oT);class iT extends Wn{apply(e){return e}}iT.className="linear";we(iT);class aT extends Wn{apply(e){return jl(e)}}aT.className="sigmoid";we(aT);class lT extends Wn{apply(e){return eV(e)}}lT.className="hardSigmoid";we(lT);class cT extends Wn{apply(e){return Cd(e)}}cT.className="softplus";we(cT);class uT extends Wn{apply(e){return ZB(e)}}uT.className="softsign";we(uT);class dT extends Wn{apply(e){return Im(e)}}dT.className="tanh";we(dT);let Ov=class extends Wn{apply(e,t=-1){return z1(e,t)}};Ov.className="softmax";we(Ov);class hT extends Wn{apply(e,t=-1){return uI(e,t)}}hT.className="logSoftmax";we(hT);class fT extends Wn{apply(e){return le(()=>le(()=>{const t=Math.sqrt(2),s=te(.5,Ie(1,oI(Ge(e,t))));return te(e,s)}))}}fT.className="gelu";we(fT);class pT extends Wn{apply(e){return le(()=>te(.5,te(e,Ie(1,Im(te(Bn(Ge(2,Math.PI)),Ie(e,te(.044715,ia(e,3)))))))))}}pT.className="gelu_new";we(pT);class mT extends Wn{apply(e){return le(()=>te(e,Im(Cd(e))))}}mT.className="mish";we(mT);class gT extends Wn{apply(e,t=1){return le(()=>te(jl(te(e,t)),e))}}gT.className="swish";we(gT);function ci(n){return n.getClassName()}function u0(n,e={}){return Rd(n,rr.getMap().classNameMap,e,"activation")}function ui(n){if(n==null){const e={};return e.className="linear",e.config={},u0(e)}if(typeof n=="string"){const e={};return e.className=n,e.config={},u0(e)}else return n instanceof Wn?n:u0(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function x6(n){if(n!=null&&typeof n!="object")throw new Error(`Argument to L1L2 regularizer's constructor is expected to be an object, but received: ${n}`)}class xT extends zl{}class yT extends xT{constructor(e){super(),x6(e),this.l1=e==null||e.l1==null?.01:e.l1,this.l2=e==null||e.l2==null?.01:e.l2,this.hasL1=this.l1!==0,this.hasL2=this.l2!==0}apply(e){return le(()=>{let t=kn([1]);return this.hasL1&&(t=Ie(t,We(te(this.l1,es(e))))),this.hasL2&&(t=Ie(t,We(te(this.l2,Dd(e))))),re(t,[])})}getConfig(){return{l1:this.l1,l2:this.l2}}static fromConfig(e,t){return new e({l1:t.l1,l2:t.l2})}}yT.className="L1L2";we(yT);const vC={l1l2:"L1L2"};function St(n){return Sv(n)}function bC(n,e={}){return Rd(n,rr.getMap().classNameMap,e,"regularizer")}function jt(n){if(n==null)return null;if(typeof n=="string"){const t={className:n in vC?vC[n]:n,config:{}};return bC(t)}else return n instanceof xT?n:bC(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class vT extends ot{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null&&(this.maxValue=e.maxValue)}call(e,t){e=Xe(e);let s=ya(e);return this.maxValue!=null&&(s=Us(s,0,this.maxValue)),s}computeOutputShape(e){return e}getConfig(){const e={maxValue:this.maxValue},t=super.getConfig();return Object.assign(e,t),e}}vT.className="ReLU";we(vT);class bT extends ot{constructor(e){super(e??{}),this.DEFAULT_ALPHA=.3,e==null&&(e={}),this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,t){const s=Xe(e);return R1(s,this.alpha)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},t=super.getConfig();return Object.assign(e,t),e}}bT.className="LeakyReLU";we(bT);class wT extends ot{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA_INITIALIZER="zeros",e==null&&(e={}),this.supportsMasking=!0,this.alphaInitializer=Lt(e.alphaInitializer||this.DEFAULT_ALPHA_INITIALIZER),this.alphaRegularizer=jt(e.alphaRegularizer),this.alphaConstraint=pn(e.alphaConstraint),e.sharedAxes==null)this.sharedAxes=null;else if(Array.isArray(e.sharedAxes))this.sharedAxes=e.sharedAxes;else if(typeof e.sharedAxes=="number")this.sharedAxes=[e.sharedAxes];else throw new Z(`Expected sharedAxes to be a number or an array of numbers, but got ${e.sharedAxes}`)}build(e){e=ht(e);const t=e.slice(1);if(this.sharedAxes!=null)for(const r of this.sharedAxes)t[r-1]=1;this.alpha=this.addWeight("alpha",t,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);const s={};if(this.sharedAxes!=null)for(let r=1;r<e.length;++r)s[r]=e[r];this.inputSpec=[new hn({ndim:e.length,axes:s})],this.built=!0}call(e,t){return e=Xe(e),L1(e,this.alpha.read())}getConfig(){const e={alphaInitializer:zt(this.alphaInitializer),alphaRegularizer:St(this.alphaRegularizer),alphaConstraint:fn(this.alphaConstraint),sharedAxes:this.sharedAxes},t=super.getConfig();return Object.assign(e,t),e}}wT.className="PReLU";we(wT);let kT=class extends ot{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA=1,e==null&&(e={}),e.alpha!=null&&e.alpha!==this.DEFAULT_ALPHA)throw new tt(`Non-default alpha value (${e.alpha}) is not supported by the ELU layer yet.`);this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,t){const s=Xe(e);return Em(s)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},t=super.getConfig();return Object.assign(e,t),e}};kT.className="ELU";we(kT);class CT extends ot{constructor(e){super(e??{}),this.DEFAULT_THETA=1,e==null&&(e={}),this.theta=e.theta==null?this.DEFAULT_THETA:e.theta}call(e,t){const s=Xe(e);return te(s,Ae(Gs(s,this.theta),"float32"))}computeOutputShape(e){return e}getConfig(){const e={theta:this.theta},t=super.getConfig();return Object.assign(e,t),e}}CT.className="ThresholdedReLU";we(CT);class ST extends ot{constructor(e){super(e??{}),this.DEFAULT_AXIS=1,e==null&&(e={}),this.softmax=new Ov().apply,this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis}call(e,t){return le(()=>{let s=Xe(e);const r=t.mask;if(r!=null){const o=te(Ke(vi(s.shape),Ae(r,s.dtype)),gt(-1e9));s=Ie(s,o)}return this.axis instanceof Array?this.axis.length>1?eo(Ke(s,dI(s,this.axis,!0))):this.softmax(s,this.axis[0]):this.softmax(s,this.axis)})}computeOutputShape(e){return e}getConfig(){const e={axis:this.axis},t=super.getConfig();return Object.assign(e,t),e}}ST.className="Softmax";we(ST);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function fl(n,e,t){if(typeof n=="number")return ca(n,e);if(n.length!==e)throw new Z(`The ${t} argument must be an integer or tuple of ${e} integers. Received: ${n.length} elements.`);for(let s=0;s<e;++s){const r=n[s];if(!KB(r))throw new Z(`The ${t} argument must be an integer or tuple of ${e} integers. Received: ${JSON.stringify(n)} including a non-integer number ${r}`)}return n}function Rr(n,e,t,s,r=1){if(n==null)return n;const o=e+(e-1)*(r-1);let i;return t==="same"?i=n:i=n-o+1,Math.floor((i+s-1)/s)}function Gr(n,e,t,s){if(n==null)return null;if(s==="valid")n=n*e+li([t-e,0]);else if(s==="same")n=n*e;else throw new Z(`Unsupport padding mode: ${s}.`);return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function _v(n,e){return le(()=>(en(e),e==="channelsFirst"?ct(n,[0,2,3,1]):n))}function NT(n,e){return le(()=>(en(e),e==="channelsFirst"?ct(n,[0,2,3,4,1]):n))}function y6(n,e,t,s=1,r="valid",o,i=1){return le(()=>{if(o==null&&(o=Dr()),en(o),n.shape.length!==3)throw new Z(`The input of a conv1dWithBias operation should be 3, but is ${n.shape.length} instead.`);if(e.shape.length!==3)throw new Z(`The kernel for a conv1dWithBias operation should be 3, but is ${e.shape.length} instead`);if(t!=null&&t.shape.length!==1)throw new Z(`The bias for a conv1dWithBias operation should be 1, but is ${t.shape.length} instead`);if(o==="channelsFirst"&&(n=ct(n,[0,2,1])),r==="causal")throw new tt("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");let a=eI(n,e,s,r==="same"?"same":"valid","NWC",i);return t!=null&&(a=Fr(a,t)),a})}function wC(n,e,t,s=[1,1],r="valid",o,i,a=null){return le(()=>{if(o==null&&(o=Dr()),en(o),n.rank!==3&&n.rank!==4)throw new Z(`conv2dWithBiasActivation expects input to be of rank 3 or 4, but received ${n.rank}.`);if(e.rank!==3&&e.rank!==4)throw new Z(`conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received ${n.rank}.`);let l=_v(n,o);if(r==="causal")throw new tt("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return l=x_({x:l,filter:e,strides:s,pad:r==="same"?"same":"valid",dilations:i,dataFormat:"NHWC",bias:t,activation:a}),o==="channelsFirst"&&(l=ct(l,[0,3,1,2])),l})}function v6(n,e,t,s=[1,1,1],r="valid",o,i){return le(()=>{if(o==null&&(o=Dr()),en(o),n.rank!==4&&n.rank!==5)throw new Z(`conv3dWithBias expects input to be of rank 4 or 5, but received ${n.rank}.`);if(e.rank!==4&&e.rank!==5)throw new Z(`conv3dWithBias expects kernel to be of rank 4 or 5, but received ${n.rank}.`);let a=NT(n,o);if(r==="causal")throw new tt("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return a=pL(a,e,s,r==="same"?"same":"valid","NDHWC",i),t!=null&&(a=Fr(a,t)),o==="channelsFirst"&&(a=ct(a,[0,4,1,2,3])),a})}class Bm extends ot{constructor(e,t){if(super(t),this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",Bm.verifyArgs(t),this.rank=e,Cn(this.rank,"rank"),this.rank!==1&&this.rank!==2&&this.rank!==3)throw new tt(`Convolution layer for rank other than 1, 2, or 3 (${this.rank}) is not implemented yet.`);if(this.kernelSize=fl(t.kernelSize,e,"kernelSize"),this.strides=fl(t.strides==null?1:t.strides,e,"strides"),this.padding=t.padding==null?"valid":t.padding,Hs(this.padding),this.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,en(this.dataFormat),this.activation=ui(t.activation),this.useBias=t.useBias==null?!0:t.useBias,this.biasInitializer=Lt(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.biasConstraint=pn(t.biasConstraint),this.biasRegularizer=jt(t.biasRegularizer),this.activityRegularizer=jt(t.activityRegularizer),this.dilationRate=fl(t.dilationRate==null?1:t.dilationRate,e,"dilationRate"),this.rank===1&&Array.isArray(this.dilationRate)&&this.dilationRate.length!==1)throw new Z(`dilationRate must be a number or an array of a single number for 1D convolution, but received ${JSON.stringify(this.dilationRate)}`);if(this.rank===2){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==2)throw new Z(`dilationRate must be a number or array of two numbers for 2D convolution, but received ${JSON.stringify(this.dilationRate)}`)}else if(this.rank===3){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==3)throw new Z(`dilationRate must be a number or array of three numbers for 3D convolution, but received ${JSON.stringify(this.dilationRate)}`)}}static verifyArgs(e){if(Ur("kernelSize"in e,"required key 'kernelSize' not in config"),typeof e.kernelSize!="number"&&!Nv(e.kernelSize,"number",1,3))throw new Z(`BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received ${JSON.stringify(e.kernelSize)}.`)}getConfig(){const e={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:ci(this.activation),useBias:this.useBias,biasInitializer:zt(this.biasInitializer),biasRegularizer:St(this.biasRegularizer),activityRegularizer:St(this.activityRegularizer),biasConstraint:fn(this.biasConstraint)},t=super.getConfig();return Object.assign(e,t),e}}class Bl extends Bm{constructor(e,t){super(e,t),this.kernel=null,Bl.verifyArgs(t),this.filters=t.filters,Cn(this.filters,"filters"),this.kernelInitializer=Lt(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.kernelConstraint=pn(t.kernelConstraint),this.kernelRegularizer=jt(t.kernelRegularizer)}build(e){e=ht(e);const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null)throw new Z(`The channel dimension of the input should be defined. Found ${e[t]}`);const s=e[t],r=this.kernelSize.concat([s,this.filters]);this.kernel=this.addWeight("kernel",r,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:{[t]:s}}],this.built=!0}call(e,t){return le(()=>{e=Xe(e);let s;const r=this.bias==null?null:this.bias.read(),o=w$(this.activation.getClassName());if(o!=null&&this.rank===2)s=wC(e,this.kernel.read(),r,this.strides,this.padding,this.dataFormat,this.dilationRate,o);else{if(this.rank===1)s=y6(e,this.kernel.read(),r,this.strides[0],this.padding,this.dataFormat,this.dilationRate[0]);else if(this.rank===2)s=wC(e,this.kernel.read(),r,this.strides,this.padding,this.dataFormat,this.dilationRate);else if(this.rank===3)s=v6(e,this.kernel.read(),r,this.strides,this.padding,this.dataFormat,this.dilationRate);else throw new tt("convolutions greater than 3D are not implemented yet.");this.activation!=null&&(s=this.activation.apply(s))}return s})}computeOutputShape(e){e=ht(e);const t=[],s=this.dataFormat==="channelsLast"?e.slice(1,e.length-1):e.slice(2);for(let o=0;o<s.length;++o){const i=Rr(s[o],this.kernelSize[o],this.padding,this.strides[o],typeof this.dilationRate=="number"?this.dilationRate:this.dilationRate[o]);t.push(i)}let r=[e[0]];return this.dataFormat==="channelsLast"?(r=r.concat(t),r.push(this.filters)):(r.push(this.filters),r=r.concat(t)),r}getConfig(){const e={filters:this.filters,kernelInitializer:zt(this.kernelInitializer),kernelRegularizer:St(this.kernelRegularizer),kernelConstraint:fn(this.kernelConstraint)},t=super.getConfig();return Object.assign(e,t),e}static verifyArgs(e){if(!("filters"in e)||typeof e.filters!="number"||e.filters<1)throw new Z(`Convolution layer expected config.filters to be a 'number' > 0 but got ${JSON.stringify(e.filters)}`)}}class Ld extends Bl{constructor(e){super(2,e),Ld.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!Nv(e.kernelSize,"number",1,2))throw new Z(`Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received ${JSON.stringify(e.kernelSize)}.`)}}Ld.className="Conv2D";we(Ld);class jd extends Bl{constructor(e){super(3,e),jd.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!(Array.isArray(e.kernelSize)&&(e.kernelSize.length===1||e.kernelSize.length===3)))throw new Z(`Conv3D expects config.kernelSize to be number or [number, number, number], but received ${JSON.stringify(e.kernelSize)}.`)}}jd.className="Conv3D";we(jd);class IT extends Ld{constructor(e){if(super(e),this.inputSpec=[new hn({ndim:4})],this.padding!=="same"&&this.padding!=="valid")throw new Z(`Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=ht(e),e.length!==4)throw new Z("Input should have rank 4; Received input shape: "+JSON.stringify(e));const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null)throw new Z("The channel dimension of the inputs should be defined. Found `None`.");const s=e[t],r=this.kernelSize.concat([this.filters,s]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new hn({ndim:4,axes:{[t]:s}})],this.built=!0}call(e,t){return le(()=>{let s=Xe(e);if(s.shape.length!==4)throw new Z(`Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${s.shape.length}`);const r=s.shape,o=r[0];let i,a;this.dataFormat==="channelsFirst"?(i=2,a=3):(i=1,a=2);const l=r[i],u=r[a],d=this.kernelSize[0],f=this.kernelSize[1],m=this.strides[0],g=this.strides[1],y=Gr(l,m,d,this.padding),w=Gr(u,g,f,this.padding),b=[o,y,w,this.filters];this.dataFormat!=="channelsLast"&&(s=ct(s,[0,2,3,1]));let k=tI(s,this.kernel.read(),b,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(k=ct(k,[0,3,1,2])),this.bias!=null&&(k=Fr(k,this.bias.read(),this.dataFormat)),this.activation!=null&&(k=this.activation.apply(k)),k})}computeOutputShape(e){e=ht(e);const t=e.slice();let s,r,o;this.dataFormat==="channelsFirst"?(s=1,r=2,o=3):(s=3,r=1,o=2);const i=this.kernelSize[0],a=this.kernelSize[1],l=this.strides[0],u=this.strides[1];return t[s]=this.filters,t[r]=Gr(t[r],l,i,this.padding),t[o]=Gr(t[o],u,a,this.padding),t}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}IT.className="Conv2DTranspose";we(IT);class $T extends jd{constructor(e){if(super(e),this.inputSpec=[new hn({ndim:5})],this.padding!=="same"&&this.padding!=="valid")throw new Z(`Conv3DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=ht(e),e.length!==5)throw new Z("Input should have rank 5; Received input shape: "+JSON.stringify(e));const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null)throw new Z("The channel dimension of the inputs should be defined. Found `None`.");const s=e[t],r=this.kernelSize.concat([this.filters,s]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new hn({ndim:5,axes:{[t]:s}})],this.built=!0}call(e,t){return le(()=>{let s=Xe(e);if(s.shape.length!==5)throw new Z(`Conv3DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${s.shape.length}`);const r=s.shape,o=r[0];let i,a,l;this.dataFormat==="channelsFirst"?(l=2,i=3,a=4):(l=1,i=2,a=3);const u=r[l],d=r[i],f=r[a],m=this.kernelSize[0],g=this.kernelSize[1],y=this.kernelSize[2],w=this.strides[0],b=this.strides[1],k=this.strides[2],v=Gr(u,w,m,this.padding),N=Gr(d,b,g,this.padding),S=Gr(f,k,y,this.padding),$=[o,v,N,S,this.filters];this.dataFormat!=="channelsLast"&&(s=ct(s,[0,2,3,4,1]));let R=xL(s,this.kernel.read(),$,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(R=ct(R,[0,4,1,2,3])),this.bias!==null&&(R=Fr(R,this.bias.read(),this.dataFormat)),this.activation!==null&&(R=this.activation.apply(R)),R})}computeOutputShape(e){e=ht(e);const t=e.slice();let s,r,o,i;this.dataFormat==="channelsFirst"?(s=1,r=2,o=3,i=4):(s=4,r=1,o=2,i=3);const a=this.kernelSize[0],l=this.kernelSize[1],u=this.kernelSize[2],d=this.strides[0],f=this.strides[1],m=this.strides[2];return t[s]=this.filters,t[r]=Gr(t[r],d,a,this.padding),t[o]=Gr(t[o],f,l,this.padding),t[i]=Gr(t[i],m,u,this.padding),t}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}$T.className="Conv3DTranspose";we($T);class TT extends Bl{constructor(e,t){if(super(e,t),this.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",this.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",this.depthwiseKernel=null,this.pointwiseKernel=null,t.filters==null)throw new Z("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(t.kernelInitializer!=null||t.kernelRegularizer!=null||t.kernelConstraint!=null)throw new Z("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(t.padding!=null&&t.padding!=="same"&&t.padding!=="valid")throw new Z(`SeparableConv${this.rank}D supports only padding modes: 'same' and 'valid', but received ${JSON.stringify(t.padding)}`);this.depthMultiplier=t.depthMultiplier==null?1:t.depthMultiplier,this.depthwiseInitializer=Lt(t.depthwiseInitializer||this.DEFAULT_DEPTHWISE_INITIALIZER),this.depthwiseRegularizer=jt(t.depthwiseRegularizer),this.depthwiseConstraint=pn(t.depthwiseConstraint),this.pointwiseInitializer=Lt(t.depthwiseInitializer||this.DEFAULT_POINTWISE_INITIALIZER),this.pointwiseRegularizer=jt(t.pointwiseRegularizer),this.pointwiseConstraint=pn(t.pointwiseConstraint)}build(e){if(e=ht(e),e.length<this.rank+2)throw new Z(`Inputs to SeparableConv${this.rank}D should have rank ${this.rank+2}, but received input shape: ${JSON.stringify(e)}`);const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null||e[t]<0)throw new Z(`The channel dimension of the inputs should be defined, but found ${JSON.stringify(e[t])}`);const s=e[t],r=this.kernelSize.concat([s,this.depthMultiplier]),o=[];for(let a=0;a<this.rank;++a)o.push(1);o.push(s*this.depthMultiplier,this.filters);const i=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",r,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,i,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",o,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,i,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,i,this.biasConstraint):this.bias=null,this.inputSpec=[new hn({ndim:this.rank+2,axes:{[t]:s}})],this.built=!0}call(e,t){return le(()=>{e=Xe(e);let s;if(this.rank===1)throw new tt("1D separable convolution is not implemented yet.");return this.rank===2&&(this.dataFormat==="channelsFirst"&&(e=ct(e,[0,2,3,1])),s=vI(e,this.depthwiseKernel.read(),this.pointwiseKernel.read(),this.strides,this.padding,this.dilationRate,"NHWC")),this.useBias&&(s=Fr(s,this.bias.read(),this.dataFormat)),this.activation!=null&&(s=this.activation.apply(s)),this.dataFormat==="channelsFirst"&&(s=ct(s,[0,3,1,2])),s})}getConfig(){const e=super.getConfig();return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=zt(this.depthwiseInitializer),e.pointwiseInitializer=zt(this.pointwiseInitializer),e.depthwiseRegularizer=St(this.depthwiseRegularizer),e.pointwiseRegularizer=St(this.pointwiseRegularizer),e.depthwiseConstraint=fn(this.depthwiseConstraint),e.pointwiseConstraint=fn(this.pointwiseConstraint),e}}TT.className="SeparableConv";class ET extends TT{constructor(e){super(2,e)}}ET.className="SeparableConv2D";we(ET);class Vm extends Bl{constructor(e){super(1,e),Vm.verifyArgs(e),this.inputSpec=[{ndim:3}]}getConfig(){const e=super.getConfig();return delete e.rank,delete e.dataFormat,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!Nv(e.kernelSize,"number",1,1))throw new Z(`Conv1D expects config.kernelSize to be number or number[] with length 1, but received ${JSON.stringify(e.kernelSize)}.`)}}Vm.className="Conv1D";we(Vm);class RT extends ot{constructor(e){super(e),typeof e.cropping=="number"?this.cropping=[[e.cropping,e.cropping],[e.cropping,e.cropping]]:typeof e.cropping[0]=="number"?this.cropping=[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:this.cropping=e.cropping,this.dataFormat=e.dataFormat===void 0?"channelsLast":e.dataFormat,this.inputSpec=[{ndim:4}]}computeOutputShape(e){return this.dataFormat==="channelsFirst"?[e[0],e[1],e[2]-this.cropping[0][0]-this.cropping[0][1],e[3]-this.cropping[1][0]-this.cropping[1][1]]:[e[0],e[1]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1],e[3]]}call(e,t){return le(()=>{if(e=Xe(e),this.dataFormat==="channelsLast"){const s=lf(e,this.cropping[0][0],e.shape[1]-this.cropping[0][0]-this.cropping[0][1],2);return lf(s,this.cropping[1][0],e.shape[2]-this.cropping[1][1]-this.cropping[1][0],3)}else{const s=lf(e,this.cropping[0][0],e.shape[2]-this.cropping[0][0]-this.cropping[0][1],3);return lf(s,this.cropping[1][0],e.shape[3]-this.cropping[1][1]-this.cropping[1][0],4)}})}getConfig(){const e={cropping:this.cropping,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}RT.className="Cropping2D";we(RT);class AT extends ot{constructor(e){super(e),this.DEFAULT_SIZE=[2,2],this.inputSpec=[{ndim:4}],this.size=e.size==null?this.DEFAULT_SIZE:e.size,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,en(this.dataFormat),this.interpolation=e.interpolation==null?"nearest":e.interpolation,GB(this.interpolation)}computeOutputShape(e){if(this.dataFormat==="channelsFirst"){const t=e[2]==null?null:this.size[0]*e[2],s=e[3]==null?null:this.size[1]*e[3];return[e[0],e[1],t,s]}else{const t=e[1]==null?null:this.size[0]*e[1],s=e[2]==null?null:this.size[1]*e[2];return[e[0],t,s,e[3]]}}call(e,t){return le(()=>{let s=Xe(e);const r=s.shape;if(this.dataFormat==="channelsFirst"){s=ct(s,[0,2,3,1]);const o=this.size[0]*r[2],i=this.size[1]*r[3],a=this.interpolation==="nearest"?wo.resizeNearestNeighbor(s,[o,i]):wo.resizeBilinear(s,[o,i]);return ct(a,[0,3,1,2])}else{const o=this.size[0]*r[1],i=this.size[1]*r[2];return this.interpolation==="nearest"?wo.resizeNearestNeighbor(s,[o,i]):wo.resizeBilinear(s,[o,i])}})}getConfig(){const e={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation},t=super.getConfig();return Object.assign(e,t),e}}AT.className="UpSampling2D";we(AT);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function b6(n,e,t=[1,1],s="valid",r,o){return le(()=>{r==null&&(r=Dr()),en(r);let i=_v(n,r);if(n.rank!==4)throw new Z(`Input for depthwiseConv2d is required to be 4-D, but is instead ${n.rank}-D`);if(e.rank!==4)throw new Z(`depthwiseKernel is required to be 4-D, but is instead ${e.rank}-D`);return i=I1(i,e,t,s==="same"?"same":"valid","NHWC",o),r==="channelsFirst"&&(i=ct(i,[0,3,1,2])),i})}class DT extends Bm{constructor(e){super(2,e),this.depthwiseKernel=null,this.depthMultiplier=e.depthMultiplier==null?1:e.depthMultiplier,this.depthwiseInitializer=Lt(e.depthwiseInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.depthwiseConstraint=pn(e.depthwiseConstraint),this.depthwiseRegularizer=jt(e.depthwiseRegularizer)}build(e){if(e=ht(e),e.length<4)throw new Z(`Inputs to DepthwiseConv2D should have rank 4. Received input shape: ${JSON.stringify(e)}.`);const t=this.dataFormat==="channelsFirst"?1:3;if(e[t]==null||e[t]<0)throw new Z(`The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not (${e[t]}).`);const s=e[t],r=[this.kernelSize[0],this.kernelSize[1],s,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",r,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[s*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return le(()=>{e=Xe(e);let s=b6(e,this.depthwiseKernel.read(),this.strides,this.padding,this.dataFormat,null);return this.useBias&&(s=Fr(s,this.bias.read(),this.dataFormat)),this.activation!=null&&(s=this.activation.apply(s)),s})}computeOutputShape(e){e=ht(e);const t=this.dataFormat==="channelsFirst"?e[2]:e[1],s=this.dataFormat==="channelsFirst"?e[3]:e[2],r=this.dataFormat==="channelsFirst"?e[1]*this.depthMultiplier:e[3]*this.depthMultiplier,o=Rr(t,this.kernelSize[0],this.padding,this.strides[0]),i=Rr(s,this.kernelSize[1],this.padding,this.strides[1]);return this.dataFormat==="channelsFirst"?[e[0],r,o,i]:[e[0],o,i,r]}getConfig(){const e=super.getConfig();return e.depthMultiplier=this.depthMultiplier,e.depthwiseInitializer=zt(this.depthwiseInitializer),e.depthwiseRegularizer=St(this.depthwiseRegularizer),e.depthwiseConstraint=fn(this.depthwiseRegularizer),e}}DT.className="DepthwiseConv2D";we(DT);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function MT(n,e,t,s){if(Array.isArray(n)){if(e!=null||t!=null)throw new Z("When inputs is an array, neither initialState or constants should be provided");s!=null&&(t=n.slice(n.length-s,n.length),n=n.slice(0,n.length-s)),n.length>1&&(e=n.slice(1,n.length)),n=n[0]}function r(o){return o==null||Array.isArray(o)?o:[o]}return e=r(e),t=r(t),{inputs:n,initialState:e,constants:t}}function PT(n,e,t,s=!1,r,o,i=!1,a=!1){return le(()=>{const l=e.shape.length;if(l<3)throw new Z(`Input should be at least 3D, but is ${l}D.`);const u=[1,0].concat(Ar(2,l));e=ct(e,u),i&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),r!=null&&(r=Ae(Ae(r,"bool"),"float32"),r.rank===l-1&&(r=hs(r,-1)),r=ct(r,u)),s&&(e=aa(e,0),r!=null&&(r=aa(r,0)));const d=[];let f,m=t;const g=e.shape[0],y=la(e);let w;r!=null&&(w=la(r));for(let k=0;k<g;++k){const v=y[k],N=le(()=>n(v,m));if(r==null)f=N[0],m=N[1];else{const S=le(()=>{const $=w[k],R=Ke(cr($),$),M=Ie(te(N[0],$),te(m[0],R)),A=m.map((P,D)=>Ie(te(N[1][D],$),te(P,R)));return{output:M,newStates:A}});f=S.output,m=S.newStates}a&&d.push(f)}let b;return a&&(b=Co(d,1)),[f,b,m]})}class wi extends ot{constructor(e){super(e);let t;if(e.cell==null)throw new Z("cell property is missing for the constructor of RNN.");if(Array.isArray(e.cell)?t=new Vv({cells:e.cell}):t=e.cell,t.stateSize==null)throw new Z("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");this.cell=t,this.returnSequences=e.returnSequences==null?!1:e.returnSequences,this.returnState=e.returnState==null?!1:e.returnState,this.goBackwards=e.goBackwards==null?!1:e.goBackwards,this._stateful=e.stateful==null?!1:e.stateful,this.unroll=e.unroll==null?!1:e.unroll,this.supportsMasking=!0,this.inputSpec=[new hn({ndim:3})],this.stateSpec=null,this.states_=null,this.numConstants=null,this.keptStates=[]}getStates(){if(this.states_==null){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;return Ar(0,e).map(t=>null)}else return this.states_}setStates(e){this.states_=e}computeOutputShape(e){ny(e)&&(e=e[0]),e=e;let t=this.cell.stateSize;Array.isArray(t)||(t=[t]);const s=t[0];let r;if(this.returnSequences?r=[e[0],e[1],s]:r=[e[0],s],this.returnState){const o=[];for(const i of t)o.push([e[0],i]);return[r].concat(o)}else return r}computeMask(e,t){return le(()=>{Array.isArray(t)&&(t=t[0]);const s=this.returnSequences?t:null;if(this.returnState){const r=this.states.map(o=>null);return[s].concat(r)}else return s})}get states(){if(this.states_==null){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,t=[];for(let s=0;s<e;++s)t.push(null);return t}else return this.states_}set states(e){this.states_=e}build(e){if(this.numConstants!=null)throw new tt("Constants support is not implemented in RNN yet.");ny(e)&&(e=e[0]),e=e;const t=this.stateful?e[0]:null,s=e.slice(2);this.inputSpec[0]=new hn({shape:[t,null,...s]});const r=[e[0]].concat(e.slice(2));this.cell.build(r);let o;if(Array.isArray(this.cell.stateSize)?o=this.cell.stateSize:o=[this.cell.stateSize],this.stateSpec!=null){if(!xt(this.stateSpec.map(i=>i.shape[i.shape.length-1]),o))throw new Z(`An initialState was passed that is not compatible with cell.stateSize. Received stateSpec=${this.stateSpec}; However cell.stateSize is ${this.cell.stateSize}`)}else this.stateSpec=o.map(i=>new hn({shape:[null,i]}));this.stateful&&this.resetStates()}resetStates(e,t=!1){le(()=>{if(!this.stateful)throw new Wr("Cannot call resetStates() on an RNN Layer that is not stateful.");const s=this.inputSpec[0].shape[0];if(s==null)throw new Z("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.states_==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(r=>kn([s,r])):this.states_=[kn([s,this.cell.stateSize])];else if(e==null)nt(this.states_),this.keptStates!=null&&(nt(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(r=>kn([s,r])):this.states_[0]=kn([s,this.cell.stateSize]);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new Z(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);t===!0?this.keptStates.push(this.states_.slice()):nt(this.states_);for(let r=0;r<this.states_.length;++r){const o=e[r],i=Array.isArray(this.cell.stateSize)?this.cell.stateSize[r]:this.cell.stateSize,a=[s,i];if(!xt(o.shape,a))throw new Z(`State ${r} is incompatible with layer ${this.name}: expected shape=${a}, received shape=${o.shape}`);this.states_[r]=o}}this.states_=this.states_.map(r=>Kr(r.clone()))})}apply(e,t){let s=t==null?null:t.initialState,r=t==null?null:t.constants;t==null&&(t={});const o=MT(e,s,r,this.numConstants);e=o.inputs,s=o.initialState,r=o.constants;let i=[],a=[];if(s!=null){t.initialState=s,i=i.concat(s),this.stateSpec=[];for(const u of s)this.stateSpec.push(new hn({shape:u.shape}));a=a.concat(this.stateSpec)}if(r!=null&&(t.constants=r,i=i.concat(r),this.numConstants=r.length),i[0]instanceof no){const u=[e].concat(i),d=this.inputSpec.concat(a),f=this.inputSpec;this.inputSpec=d;const m=super.apply(u,t);return this.inputSpec=f,m}else return super.apply(e,t)}call(e,t){return le(()=>{const s=t==null?null:t.mask,r=t==null?null:t.training;let o=t==null?null:t.initialState;e=Xe(e),o==null&&(this.stateful?o=this.states_:o=this.getInitialState(e));const i=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;if(o.length!==i)throw new Z(`RNN Layer has ${i} state(s) but was passed ${o.length} initial state(s).`);this.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");const a={training:r},u=PT((y,w)=>{const b=this.cell.call([y].concat(w),a);return[b[0],b.slice(1)]},e,o,this.goBackwards,s,null,this.unroll,this.returnSequences),d=u[0],f=u[1],m=u[2];this.stateful&&this.resetStates(m,r);const g=this.returnSequences?f:d;return this.returnState?[g].concat(m):g})}getInitialState(e){return le(()=>{let t=kn(e.shape);return t=We(t,[1,2]),t=Ad(t),Array.isArray(this.cell.stateSize)?this.cell.stateSize.map(s=>s>1?ey(t,[1,s]):t):this.cell.stateSize>1?[ey(t,[1,this.cell.stateSize])]:[t]})}get trainableWeights(){return this.trainable?this.cell.trainableWeights:[]}get nonTrainableWeights(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.cell!=null&&this.cell.setFastWeightInitDuringBuild(e)}getConfig(){const e=super.getConfig(),t={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};this.numConstants!=null&&(t.numConstants=this.numConstants);const s=this.cell.getConfig();return this.getClassName()===wi.className&&(t.cell={className:this.cell.getClassName(),config:s}),Object.assign(Object.assign(Object.assign({},s),e),t)}static fromConfig(e,t,s={}){const r=t.cell,o=Jr(r,s);return new e(Object.assign(t,{cell:o}))}}wi.className="RNN";we(wi);class Wm extends ot{}class zv extends Wm{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,Cn(this.units,"units"),this.activation=ui(e.activation==null?this.DEFAULT_ACTIVATION:e.activation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=Lt(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=Lt(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=Lt(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=jt(e.kernelRegularizer),this.recurrentRegularizer=jt(e.recurrentRegularizer),this.biasRegularizer=jt(e.biasRegularizer),this.kernelConstraint=pn(e.kernelConstraint),this.recurrentConstraint=pn(e.recurrentConstraint),this.biasConstraint=pn(e.biasConstraint),this.dropout=Sl([1,li([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=Sl([1,li([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=ht(e),this.kernel=this.addWeight("kernel",[e[e.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return le(()=>{if(e=e,e.length!==2)throw new Z(`SimpleRNNCell expects 2 input Tensors, got ${e.length}.`);let s=e[1];e=e[0];const r=t.training==null?!1:t.training;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=di({ones:()=>cr(e),rate:this.dropout,training:r,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=di({ones:()=>cr(s),rate:this.recurrentDropout,training:r,dropoutFunc:this.dropoutFunc}));let o;const i=this.dropoutMask,a=this.recurrentDropoutMask;i!=null?o=Yr(te(e,i),this.kernel.read()):o=Yr(e,this.kernel.read()),this.bias!=null&&(o=Fr(o,this.bias.read())),a!=null&&(s=te(s,a));let l=Ie(o,Yr(s,this.recurrentKernel.read()));return this.activation!=null&&(l=this.activation.apply(l)),[l,l]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:ci(this.activation),useBias:this.useBias,kernelInitializer:zt(this.kernelInitializer),recurrentInitializer:zt(this.recurrentInitializer),biasInitializer:zt(this.biasInitializer),kernelRegularizer:St(this.kernelRegularizer),recurrentRegularizer:St(this.recurrentRegularizer),biasRegularizer:St(this.biasRegularizer),activityRegularizer:St(this.activityRegularizer),kernelConstraint:fn(this.kernelConstraint),recurrentConstraint:fn(this.recurrentConstraint),biasConstraint:fn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign(Object.assign({},e),t)}}zv.className="SimpleRNNCell";we(zv);class FT extends wi{constructor(e){e.cell=new zv(e),super(e)}call(e,t){return le(()=>{this.cell.dropoutMask!=null&&(nt(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(nt(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=t==null?null:t.mask,r=t==null?null:t.training,o=t==null?null:t.initialState;return super.call(e,{mask:s,training:r,initialState:o})})}static fromConfig(e,t){return new e(t)}}FT.className="SimpleRNN";we(FT);class Bv extends Wm{constructor(e){if(super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.resetAfter)throw new Z("GRUCell does not support reset_after parameter set to true.");this.units=e.units,Cn(this.units,"units"),this.activation=ui(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=ui(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=Lt(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=Lt(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=Lt(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=jt(e.kernelRegularizer),this.recurrentRegularizer=jt(e.recurrentRegularizer),this.biasRegularizer=jt(e.biasRegularizer),this.kernelConstraint=pn(e.kernelConstraint),this.recurrentConstraint=pn(e.recurrentConstraint),this.biasConstraint=pn(e.biasConstraint),this.dropout=Sl([1,li([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=Sl([1,li([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=ht(e);const t=e[e.length-1];this.kernel=this.addWeight("kernel",[t,this.units*3],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*3],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units*3],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return le(()=>{if(e=e,e.length!==2)throw new Z(`GRUCell expects 2 input Tensors (inputs, h, c), got ${e.length}.`);const s=t.training==null?!1:t.training;let r=e[1];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=di({ones:()=>cr(e),rate:this.dropout,training:s,count:3,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=di({ones:()=>cr(r),rate:this.recurrentDropout,training:s,count:3,dropoutFunc:this.dropoutFunc}));const o=this.dropoutMask,i=this.recurrentDropoutMask;let a,l,u;0<this.dropout&&this.dropout<1&&(e=te(e,o[0]));let d=Yr(e,this.kernel.read());this.useBias&&(d=Fr(d,this.bias.read())),0<this.recurrentDropout&&this.recurrentDropout<1&&(r=te(r,i[0]));const f=this.recurrentKernel.read(),[m,g]=Ws(f,[2*this.units,this.units],f.rank-1),y=Yr(r,m),[w,b,k]=Ws(d,3,d.rank-1),[v,N]=Ws(y,2,y.rank-1);a=this.recurrentActivation.apply(Ie(w,v)),l=this.recurrentActivation.apply(Ie(b,N));const S=Yr(te(l,r),g);u=this.activation.apply(Ie(k,S));const $=Ie(te(a,r),te(Ie(1,Yt(a)),u));return[$,$]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:ci(this.activation),recurrentActivation:ci(this.recurrentActivation),useBias:this.useBias,kernelInitializer:zt(this.kernelInitializer),recurrentInitializer:zt(this.recurrentInitializer),biasInitializer:zt(this.biasInitializer),kernelRegularizer:St(this.kernelRegularizer),recurrentRegularizer:St(this.recurrentRegularizer),biasRegularizer:St(this.biasRegularizer),activityRegularizer:St(this.activityRegularizer),kernelConstraint:fn(this.kernelConstraint),recurrentConstraint:fn(this.recurrentConstraint),biasConstraint:fn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign(Object.assign({},e),t)}}Bv.className="GRUCell";we(Bv);class LT extends wi{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new Bv(e),super(e)}call(e,t){return le(()=>{this.cell.dropoutMask!=null&&(nt(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(nt(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=t==null?null:t.mask,r=t==null?null:t.training,o=t==null?null:t.initialState;return super.call(e,{mask:s,training:r,initialState:o})})}static fromConfig(e,t){return t.implmentation===0&&(t.implementation=1),new e(t)}}LT.className="GRU";we(LT);class Um extends Wm{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,Cn(this.units,"units"),this.activation=ui(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=ui(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=Lt(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=Lt(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=Lt(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.unitForgetBias=e.unitForgetBias,this.kernelRegularizer=jt(e.kernelRegularizer),this.recurrentRegularizer=jt(e.recurrentRegularizer),this.biasRegularizer=jt(e.biasRegularizer),this.kernelConstraint=pn(e.kernelConstraint),this.recurrentConstraint=pn(e.recurrentConstraint),this.biasConstraint=pn(e.biasConstraint),this.dropout=Sl([1,li([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=Sl([1,li([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=[this.units,this.units],this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){var t;e=ht(e);const s=e[e.length-1];this.kernel=this.addWeight("kernel",[s,this.units*4],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*4],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint);let r;if(this.useBias){if(this.unitForgetBias){const o=this.biasInitializer,i=this.units;r=new(t=class extends dr{apply(l,u){const d=o.apply([i]),f=new $v().apply([i]),m=o.apply([i*2]);return rC(rC(d,f),m)}},t.className="CustomInit",t)}else r=this.biasInitializer;this.bias=this.addWeight("bias",[this.units*4],null,r,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}call(e,t){return le(()=>{const s=t.training==null?!1:t.training;if(e=e,e.length!==3)throw new Z(`LSTMCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);let r=e[1];const o=e[2];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=di({ones:()=>cr(e),rate:this.dropout,training:s,count:4,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=di({ones:()=>cr(r),rate:this.recurrentDropout,training:s,count:4,dropoutFunc:this.dropoutFunc}));const i=this.dropoutMask,a=this.recurrentDropoutMask;let l,u,d,f;0<this.dropout&&this.dropout<1&&(e=te(e,i[0]));let m=Yr(e,this.kernel.read());0<this.recurrentDropout&&this.recurrentDropout<1&&(r=te(r,a[0])),m=Ie(m,Yr(r,this.recurrentKernel.read())),this.useBias&&(m=Fr(m,this.bias.read()));const[g,y,w,b]=Ws(m,4,m.rank-1);l=this.recurrentActivation.apply(g),u=this.recurrentActivation.apply(y),d=Ie(te(u,o),te(l,this.activation.apply(w))),f=this.recurrentActivation.apply(b);const k=te(f,this.activation.apply(d));return[k,k,d]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:ci(this.activation),recurrentActivation:ci(this.recurrentActivation),useBias:this.useBias,kernelInitializer:zt(this.kernelInitializer),recurrentInitializer:zt(this.recurrentInitializer),biasInitializer:zt(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:St(this.kernelRegularizer),recurrentRegularizer:St(this.recurrentRegularizer),biasRegularizer:St(this.biasRegularizer),activityRegularizer:St(this.activityRegularizer),kernelConstraint:fn(this.kernelConstraint),recurrentConstraint:fn(this.recurrentConstraint),biasConstraint:fn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign(Object.assign({},e),t)}}Um.className="LSTMCell";we(Um);class jT extends wi{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new Um(e),super(e)}call(e,t){return le(()=>{this.cell.dropoutMask!=null&&(nt(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(nt(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=t==null?null:t.mask,r=t==null?null:t.training,o=t==null?null:t.initialState;return super.call(e,{mask:s,training:r,initialState:o})})}static fromConfig(e,t){return t.implmentation===0&&(t.implementation=1),new e(t)}}jT.className="LSTM";we(jT);class Vv extends Wm{constructor(e){super(e),this.cells=e.cells}get stateSize(){const e=[];for(const t of this.cells.slice().reverse())Array.isArray(t.stateSize)?e.push(...t.stateSize):e.push(t.stateSize);return e}call(e,t){return le(()=>{e=e;let s=e.slice(1);const r=[];for(const a of this.cells.slice().reverse())Array.isArray(a.stateSize)?r.push(s.splice(0,a.stateSize.length)):r.push(s.splice(0,1));r.reverse();const o=[];let i;for(let a=0;a<this.cells.length;++a){const l=this.cells[a];s=r[a],a===0?i=[e[0]].concat(s):i=[i[0]].concat(s),i=l.call(i,t),o.push(i.slice(1))}s=[];for(const a of o.slice().reverse())s.push(...a);return[i[0]].concat(s)})}build(e){ny(e)&&(e=e[0]),e=e;let t;this.cells.forEach((s,r)=>{Xi(`RNNCell_${r}`,()=>{s.build(e),Array.isArray(s.stateSize)?t=s.stateSize[0]:t=s.stateSize,e=[e[0],t]})}),this.built=!0}getConfig(){const e=super.getConfig(),t=o=>({className:o.getClassName(),config:o.getConfig()}),r={cells:this.cells.map(t)};return Object.assign(Object.assign({},e),r)}static fromConfig(e,t,s={}){const r=[];for(const o of t.cells)r.push(Jr(o,s));return new e({cells:r})}get trainableWeights(){if(!this.trainable)return[];const e=[];for(const t of this.cells)e.push(...t.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const t of this.cells)e.push(...t.nonTrainableWeights);if(!this.trainable){const t=[];for(const s of this.cells)t.push(...s.trainableWeights);return t.concat(e)}return e}getWeights(){const e=[];for(const t of this.cells)e.push(...t.weights);return sy(e)}setWeights(e){const t=[];for(const s of this.cells){const r=s.weights.length,o=e.splice(r);for(let i=0;i<s.weights.length;++i)t.push([s.weights[i],o[i]])}Pv(t)}}Vv.className="StackedRNNCells";we(Vv);function di(n){const{ones:e,rate:t,training:s=!1,count:r=1,dropoutFunc:o}=n,i=()=>o!=null?o(e(),t):T$(e(),t),a=()=>Md(i,e,s);return!r||r<=1?Kr(a().clone()):Array(r).fill(void 0).map(a).map(u=>Kr(u.clone()))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var w6=function(n,e){var t={};for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&e.indexOf(s)<0&&(t[s]=n[s]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,s=Object.getOwnPropertySymbols(n);r<s.length;r++)e.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(n,s[r])&&(t[s[r]]=n[s[r]]);return t};class OT extends wi{constructor(e){if(e.unroll)throw new tt("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(e.cell))throw new tt("It is not possible at the moment to stack convolutional cells.");super(e),this.inputSpec=[new hn({ndim:5})]}call(e,t){return le(()=>{if(this.cell.dropoutMask!=null&&(nt(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(nt(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),t&&t.constants)throw new Z("ConvRNN2D cell does not support constants");const s=t==null?null:t.mask,r=t==null?null:t.training,o=t==null?null:t.initialState;return super.call(e,{mask:s,training:r,initialState:o})})}computeOutputShape(e){let t=this.computeSingleOutputShape(e);return this.returnSequences||(t=[t[0],...t.slice(2)]),this.returnState&&(t=[t,...Array(2).fill([e[0],...t.slice(-3)])]),t}getInitialState(e){return le(()=>{const{stateSize:t}=this.cell,s=e.shape,r=this.computeSingleOutputShape(s),o=[r[0],...r.slice(2)],i=kn(o);return Array.isArray(t)?Array(t.length).fill(i):[i]})}resetStates(e,t=!1){le(()=>{if(!this.stateful)throw new Wr("Cannot call resetStates() on an RNN Layer that is not stateful.");const s=this.inputSpec[0].shape,r=this.computeSingleOutputShape(s),o=[r[0],...r.slice(2)];if(s[0]==null)throw new Z("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.getStates()==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>kn(o)):this.states_=[kn(o)];else if(e==null)nt(this.states_),this.keptStates!=null&&(nt(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>kn(o)):this.states_[0]=kn(o);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new Z(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);t?this.keptStates.push(this.states_.slice()):nt(this.states_);for(let a=0;a<this.states_.length;++a){const l=e[a],u=o;if(!xt(l.shape,u))throw new Z(`State ${a} is incompatible with layer ${this.name}: expected shape=${u}, received shape=${l.shape}`);this.states_[a]=l}}this.states_=this.states_.map(a=>Kr(a.clone()))})}computeSingleOutputShape(e){const{dataFormat:t,filters:s,kernelSize:r,padding:o,strides:i,dilationRate:a}=this.cell,l=t==="channelsFirst",u=e[l?3:2],d=e[l?4:3],f=Rr(u,r[0],o,i[0],a[0]),m=Rr(d,r[1],o,i[1],a[1]);return[...e.slice(0,2),...l?[s,f,m]:[f,m,s]]}}OT.className="ConvRNN2D";class Wv extends Um{constructor(e){const{filters:t,kernelSize:s,strides:r,padding:o,dataFormat:i,dilationRate:a}=e;super(Object.assign(Object.assign({},e),{units:t})),this.filters=t,Cn(this.filters,"filters"),this.kernelSize=fl(s,2,"kernelSize"),this.kernelSize.forEach(l=>Cn(l,"kernelSize")),this.strides=fl(r||1,2,"strides"),this.strides.forEach(l=>Cn(l,"strides")),this.padding=o||"valid",Hs(this.padding),this.dataFormat=i||"channelsLast",en(this.dataFormat),this.dilationRate=fl(a||1,2,"dilationRate"),this.dilationRate.forEach(l=>Cn(l,"dilationRate"))}build(e){var t;e=ht(e);const s=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[s]==null)throw new Z(`The channel dimension of the input should be defined. Found ${e[s]}`);const r=e[s],o=4,i=this.kernelSize.concat([r,this.filters*o]);this.kernel=this.addWeight("kernel",i,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);const a=this.kernelSize.concat([this.filters,this.filters*o]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",a,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){let l;if(this.unitForgetBias){const u=this.biasInitializer,d=this.filters;l=new(t=class extends dr{apply(m,g){const y=u.apply([d]),w=vi([d]),b=u.apply([d*2]);return Iv([y,w,b])}},t.className="CustomInit",t)}else l=this.biasInitializer;this.bias=this.addWeight("bias",[this.filters*o],null,l,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}call(e,t){return le(()=>{if(e.length!==3)throw new Z(`ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);const s=t.training||!1,r=e[0],o=e[1],i=e[2],a=4;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=di({ones:()=>cr(r),rate:this.dropout,training:s,count:a,dropoutFunc:this.dropoutFunc}));const l=this.dropoutMask,u=(H,O,B)=>!O||!O[B]?H:te(O[B],H);let d=u(r,l,0),f=u(r,l,1),m=u(r,l,2),g=u(r,l,3);0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=di({ones:()=>cr(o),rate:this.recurrentDropout,training:s,count:a,dropoutFunc:this.dropoutFunc}));const y=this.recurrentDropoutMask;let w=u(o,y,0),b=u(o,y,1),k=u(o,y,2),v=u(o,y,3);const N=3,[S,$,R,M]=Ws(this.kernel.read(),a,N),[A,P,D,E]=this.useBias?Ws(this.bias.read(),a):[null,null,null,null];d=this.inputConv(d,S,A,this.padding),f=this.inputConv(f,$,P,this.padding),m=this.inputConv(m,R,D,this.padding),g=this.inputConv(g,M,E,this.padding);const[j,V,W,U]=Ws(this.recurrentKernel.read(),a,N);w=this.recurrentConv(w,j),b=this.recurrentConv(b,V),k=this.recurrentConv(k,W),v=this.recurrentConv(v,U);const X=this.recurrentActivation.apply(Ie(d,w)),ee=this.recurrentActivation.apply(Ie(f,b)),G=Ie(te(ee,i),te(X,this.activation.apply(Ie(m,k)))),z=te(this.recurrentActivation.apply(Ie(g,v)),this.activation.apply(G));return[z,z,G]})}getConfig(){const e=super.getConfig(),{units:t}=e,s=w6(e,["units"]),r={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign(Object.assign({},s),r)}inputConv(e,t,s,r){const o=oa(e,t,this.strides,r||"valid",this.dataFormat==="channelsFirst"?"NCHW":"NHWC",this.dilationRate);return s?Fr(o,s,this.dataFormat):o}recurrentConv(e,t){return oa(e,t,1,"same",this.dataFormat==="channelsFirst"?"NCHW":"NHWC")}}Wv.className="ConvLSTM2DCell";we(Wv);class _T extends OT{constructor(e){const t=new Wv(e);super(Object.assign(Object.assign({},e),{cell:t}))}static fromConfig(e,t){return new e(t)}}_T.className="ConvLSTM2D";we(_T);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Gm extends ot{constructor(e){super(e),this.rate=Math.max(Math.min(e.rate,1),0),this.noiseShape=e.noiseShape,this.seed=e.seed,this.supportsMasking=!0}getNoiseShape(e){if(this.noiseShape==null)return this.noiseShape;const t=e.shape,s=[];for(let r=0;r<this.noiseShape.length;++r)s.push(this.noiseShape[r]==null?t[r]:this.noiseShape[r]);return s}call(e,t){return le(()=>{this.invokeCallHook(e,t);const s=Xe(e);if(0<this.rate&&this.rate<1){const r=t.training==null?!1:t.training,o=this.getNoiseShape(s);return Md(()=>T$(s,this.rate,o,this.seed),()=>s,r)}return e})}getConfig(){const e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},t=super.getConfig();return Object.assign(e,t),e}dispose(){return super.dispose()}}Gm.className="Dropout";we(Gm);class zT extends Gm{constructor(e){super(e),this.inputSpec=[{ndim:3}]}getNoiseShape(e){const t=e.shape;return[t[0],1,t[2]]}}zT.className="SpatialDropout1D";we(zT);class Uv extends ot{constructor(e){if(super(e),this.activation=null,this.useBias=!0,this.kernel=null,this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.batchInputShape==null&&e.inputShape==null&&e.inputDim!=null){let t=null;e.batchSize!=null&&(t=e.batchSize),this.batchInputShape=[t,e.inputDim]}this.units=e.units,Cn(this.units,"units"),this.activation=ui(e.activation),e.useBias!=null&&(this.useBias=e.useBias),this.kernelInitializer=Lt(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.biasInitializer=Lt(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelConstraint=pn(e.kernelConstraint),this.biasConstraint=pn(e.biasConstraint),this.kernelRegularizer=jt(e.kernelRegularizer),this.biasRegularizer=jt(e.biasRegularizer),this.activityRegularizer=jt(e.activityRegularizer),this.supportsMasking=!0,this.inputSpec=[{minNDim:2}]}build(e){e=ht(e);const t=e[e.length-1];this.kernel==null&&(this.kernel=this.addWeight("kernel",[t,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:{[-1]:t}}],this.built=!0}computeOutputShape(e){e=ht(e);const t=e.slice();return t[t.length-1]=this.units,t}call(e,t){return le(()=>{this.invokeCallHook(e,t);const s=Xe(e),r=w$(this.activation.getClassName());let o;return r!=null?o=Yr(s,this.kernel.read(),r,this.bias?this.bias.read():null):(o=Yr(s,this.kernel.read()),this.bias!=null&&(o=Fr(o,this.bias.read())),this.activation!=null&&(o=this.activation.apply(o))),o})}getConfig(){const e={units:this.units,activation:ci(this.activation),useBias:this.useBias,kernelInitializer:zt(this.kernelInitializer),biasInitializer:zt(this.biasInitializer),kernelRegularizer:St(this.kernelRegularizer),biasRegularizer:St(this.biasRegularizer),activityRegularizer:St(this.activityRegularizer),kernelConstraint:fn(this.kernelConstraint),biasConstraint:fn(this.biasConstraint)},t=super.getConfig();return Object.assign(e,t),e}}Uv.className="Dense";we(Uv);class BT extends ot{constructor(e){e=e||{},super(e),this.inputSpec=[{minNDim:3}],this.dataFormat=e.dataFormat}computeOutputShape(e){e=ht(e);for(const t of e.slice(1))if(t==null)throw new Z(`The shape of the input to "Flatten" is not fully defined (got ${e.slice(1)}). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.`);return[e[0],ii(e,1)]}call(e,t){return le(()=>{this.invokeCallHook(e,t);let s=Xe(e);if(this.dataFormat==="channelsFirst"&&s.rank>1){const r=[0];for(let o=2;o<s.rank;++o)r.push(o);r.push(1),s=ct(s,r)}return YB(s)})}getConfig(){const e={};this.dataFormat!=null&&(e.dataFormat=this.dataFormat);const t=super.getConfig();return Object.assign(e,t),e}}BT.className="Flatten";we(BT);class VT extends ot{constructor(e){super(e),this.supportsMasking=!0,this.activation=ui(e.activation)}call(e,t){return le(()=>{this.invokeCallHook(e,t);const s=Xe(e);return this.activation.apply(s)})}getConfig(){const e={activation:ci(this.activation)},t=super.getConfig();return Object.assign(e,t),e}}VT.className="Activation";we(VT);class WT extends ot{constructor(e){super(e),this.n=e.n,this.inputSpec=[{ndim:2}]}computeOutputShape(e){return[e[0],this.n,e[1]]}call(e,t){return le(()=>(e=Xe(e),XB(e,this.n)))}getConfig(){const e={n:this.n},t=super.getConfig();return Object.assign(e,t),e}}WT.className="RepeatVector";we(WT);class UT extends ot{constructor(e){super(e),this.targetShape=e.targetShape;for(let t=0;t<this.targetShape.length;++t)this.isUnknown(this.targetShape[t])&&(this.targetShape[t]=null)}isUnknown(e){return e<0||e==null}fixUnknownDimension(e,t){const s="Total size of new array must be unchanged.",r=t.slice();let o=1,i=null;for(let l=0;l<r.length;++l){const u=r[l];if(this.isUnknown(u))if(i===null)i=l;else throw new Z("Can only specifiy one unknown dimension.");else o*=u}const a=ii(e);if(i!==null){if(o===0||a%o!==0)throw new Z(s);r[i]=a/o}else if(a!==o)throw new Z(s);return r}computeOutputShape(e){let t=!1;for(let s=0;s<e.length;++s)if(this.isUnknown(e[s])){t=!0;break}return t?e.slice(0,1).concat(this.targetShape):e.slice(0,1).concat(this.fixUnknownDimension(e.slice(1),this.targetShape))}call(e,t){return le(()=>{this.invokeCallHook(e,t);const s=Xe(e),r=s.shape,o=r.slice(0,1).concat(this.fixUnknownDimension(r.slice(1),this.targetShape));return re(s,o)})}getConfig(){const e={targetShape:this.targetShape},t=super.getConfig();return Object.assign(e,t),e}}UT.className="Reshape";we(UT);class GT extends ot{constructor(e){if(super(e),e.dims==null)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(e.dims))throw new Error(`Permute constructor requires \`dims\` to be an Array, but received ${e.dims} instead.`);const t=Ar(1,e.dims.length+1);if(!xt(e.dims.slice().sort(),t))throw new Error("Invalid permutation `dims`: "+JSON.stringify(e.dims)+" `dims` must contain consecutive integers starting from 1.");this.dims=e.dims,this.dimsIncludingBatch=[0].concat(this.dims),this.inputSpec=[new hn({ndim:this.dims.length+1})]}computeOutputShape(e){e=ht(e);const t=e.slice();return this.dims.forEach((s,r)=>{t[r+1]=e[s]}),t}call(e,t){return ct(Xe(e),this.dimsIncludingBatch)}getConfig(){const e={dims:this.dims},t=super.getConfig();return Object.assign(e,t),e}}GT.className="Permute";we(GT);class HT extends ot{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null?this.maskValue=e.maskValue==null?0:e.maskValue:this.maskValue=0}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={maskValue:this.maskValue};return Object.assign(t,e),t}computeMask(e,t){const s=Xe(e);return q0(Gf(s,this.maskValue),-1)}call(e,t){return le(()=>{this.invokeCallHook(e,t);const s=Xe(e),i=q0(Gf(s,this.maskValue),-1,!0);return te(s,Ae(i,s.dtype))})}}HT.className="Masking";we(HT);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class qT extends ot{constructor(e){if(super(e),this.embeddings=null,this.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",e.batchInputShape==null&&e.inputShape==null){let t=null;e.batchSize!=null&&(t=e.batchSize),e.inputLength==null?this.batchInputShape=[t,null]:this.batchInputShape=[t].concat(bt(e.inputLength))}this.inputDim=e.inputDim,Cn(this.inputDim,"inputDim"),this.outputDim=e.outputDim,Cn(this.outputDim,"outputDim"),this.embeddingsInitializer=Lt(e.embeddingsInitializer||this.DEFAULT_EMBEDDINGS_INITIALIZER),this.embeddingsRegularizer=jt(e.embeddingsRegularizer),this.activityRegularizer=jt(e.activityRegularizer),this.embeddingsConstraint=pn(e.embeddingsConstraint),this.maskZero=e.maskZero,this.supportsMasking=e.maskZero,this.inputLength=e.inputLength}build(e){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}warnOnIncompatibleInputShape(e){}computeMask(e,t){return le(()=>this.maskZero?(e=Xe(e),Gf(e,ut(e))):null)}computeOutputShape(e){if(e=ht(e),this.inputLength==null)return[...e,this.outputDim];const t=bt(this.inputLength);if(t.length!==e.length-1)throw new Z(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);{let s=0;for(let r=0;r<t.length;++r){const o=t[r],i=e[r+1];if(o!=null&&i!=null&&o!==i)throw new Z(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);o==null&&(t[s]=i),s++}}return[e[0],...t,this.outputDim]}call(e,t){return le(()=>{this.invokeCallHook(e,t);let s=Xe(e);s.dtype!=="int32"&&(s=Qr(s,"int32"));const r=$$(this.embeddings.read(),re(s,[s.size]));return re(r,ht(this.computeOutputShape(s.shape)))})}getConfig(){const e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:zt(this.embeddingsInitializer),embeddingsRegularizer:St(this.embeddingsRegularizer),activityRegularizer:St(this.activityRegularizer),embeddingsConstraint:fn(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},t=super.getConfig();return Object.assign(e,t),e}}qT.className="Embedding";we(qT);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class wa extends ot{constructor(e){super(e||{}),this.supportsMasking=!0}mergeFunction(e){throw new tt}computeElementwiseOpOutputShape(e,t){if(e==null||t==null)return null;if(e.length<t.length)return this.computeElementwiseOpOutputShape(t,e);if(t.length===0)return e;const s=e.slice(0,e.length-t.length);for(let r=0;r<t.length;++r){const o=e[e.length-t.length+r],i=t[r];if(o==null||i==null||o<0||i<0)s.push(null);else if(o===1)s.push(i);else if(i===1)s.push(o);else{if(o!==i)throw new Z("Operands could not be broadcast together with shapes "+JSON.stringify(e)+" "+JSON.stringify(t));s.push(o)}}return s}build(e){if(Array.isArray(e)&&!Array.isArray(e[0])&&(e=[ht(e)]),e=e,e.length<2)throw new Z(`A merge layer should be called on an Array of at least 2 inputs. Got ${e.length} input(s).`);let t=[];for(const o of e)o!=null&&o[0]!==null&&t.push(o[0]);if(t=oi(t),t.length>1)throw new Z(`Can not merge tensors with different batch sizes. Got tensors with shapes: ${JSON.stringify(e)}.`);let s=e[0]==null?null:e[0].slice(1);for(let o=1;o<e.length;++o){const i=e[o]==null?null:e[o].slice(1);s=this.computeElementwiseOpOutputShape(s,i)}const r=e.map(o=>o.length);e.indexOf(null)===-1&&oi(r).length===1?this.reshapeRequired=!1:this.reshapeRequired=!0}call(e,t){return le(()=>{if(e=e,this.reshapeRequired){const s=[],r=e.map(o=>o.rank);if(r.indexOf(null)===-1){const o=li(r);for(let i of e){const a=i.rank;for(let l=0;l<o-a;++l)i=Ad(i,1);s.push(i)}return this.mergeFunction(s)}else{let o=!1;for(const l of e){const u=l.rank;if(u==null){const d=l.shape,f=d[0],m=d.slice(1).concat([f]);let g=re(l,[f].concat(ii(d.slice(1))));g=ct(g,[1,0]),g=re(g,m),s.push(g),o=!0}else if(u>1){const d=Ar(1,u).concat([0]);s.push(ct(l,d)),o=!0}else s.push(l)}let i=this.mergeFunction(s);const a=i.rank;if(o){if(a==null){const l=i.shape,u=l.length,d=l[u-1],f=[d].concat(l.slice(0,l.length-1));i=re(ct(re(i,[-1,d]),[1,0]),f)}else if(a>1){const l=[a-1].concat(Ar(0,a-1));i=ct(i,l)}}return i}}else return this.mergeFunction(e)})}computeOutputShape(e){e=e;let t;e[0]==null?t=null:t=e[0].slice(1);for(let r=1;r<e.length;++r){const o=e[r]==null?null:e[r].slice(1);t=this.computeElementwiseOpOutputShape(t,o)}let s=[];for(const r of e)r!=null&&r[0]!==null&&s.push(r[0]);return s=oi(s),s.length===1?t=s.concat(t):t=[null].concat(t),t}computeMask(e,t){return le(()=>{if(t==null)return null;if(!Array.isArray(t))throw new Z("`mask` should be an Array");if(!Array.isArray(e))throw new Z("`inputs` should be an Array");if(t.length!==e.length)throw new Z(`The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths (${e.length} vs ${t.length})`);if(t.every(r=>r==null))return null;t=t.map(r=>r==null?r:hs(r,0));let s=t[0];for(let r=1;r<t.length-1;++r)s=ko(s,t[r]);return s})}}class KT extends wa{constructor(e){super(e)}mergeFunction(e){return le(()=>{let t=e[0].clone();for(let s=1;s<e.length;++s)t=Ie(t,e[s]);return t})}}KT.className="Add";we(KT);class XT extends wa{constructor(e){super(e)}mergeFunction(e){return le(()=>{let t=e[0].clone();for(let s=1;s<e.length;++s)t=te(t,e[s]);return t})}}XT.className="Multiply";we(XT);class QT extends wa{constructor(e){super(e)}mergeFunction(e){return le(()=>{let t=e[0].clone();for(let s=1;s<e.length;++s)t=Ie(t,e[s]);return te(1/e.length,t)})}}QT.className="Average";we(QT);class YT extends wa{constructor(e){super(e)}mergeFunction(e){return le(()=>{let t=e[0];for(let s=1;s<e.length;++s)t=yi(t,e[s]);return t})}}YT.className="Maximum";we(YT);class JT extends wa{constructor(e){super(e)}mergeFunction(e){return le(()=>{let t=e[0];for(let s=1;s<e.length;++s)t=hu(t,e[s]);return t})}}JT.className="Minimum";we(JT);class ZT extends wa{constructor(e){super(e),this.DEFAULT_AXIS=-1,e==null&&(e={}),this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){if(!(Array.isArray(e)&&Array.isArray(e[0]))||e.length===1)throw new Z("A `Concatenate` layer should be called on a list of at least 2 inputs");e=e;let t=!0;for(const r of e)if(r!=null){t=!1;break}if(t)return;const s=[];for(let r=0;r<e.length;++r){const o=e[r].slice();o.splice(this.axis,1);let i=!1;for(const a of s)if(xt(a,o)){i=!0;break}i||s.push(o)}if(s.length>1)throw new Z("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(e))}mergeFunction(e){return le(()=>Iv(e,this.axis))}computeOutputShape(e){if(!(Array.isArray(e)&&Array.isArray(e[0])))throw new Z("A `Concatenate` layer should be called on a list of inputs.");const t=e,s=t[0].slice(),r=this.axis<0?s.length+this.axis:this.axis;for(const o of t.slice(1)){if(s[r]==null||o[r]==null){s[r]=null;break}s[r]+=o[r]}return s}computeMask(e,t){if(t==null)return null;if(!Array.isArray(t))throw new Z("`mask` should be an array for Concatenate");if(!Array.isArray(e))throw new Z("`inputs` should be an array for Concatenate");if(t.length!==e.length)throw new Z(`Mismatch in the length of mask (${t.length}) and the legnth of inputs (${e.length})`);return le(()=>{let s=!0;if(t.forEach(i=>{if(i!=null){s=!1;return}}),s)return null;const r=[];for(let i=0;i<e.length;++i)t[i]==null?r.push(Ae(cr(e[i]),"bool")):t[i].rank<e[i].rank?r.push(hs(t[i],-1)):r.push(t[i]);const o=ms(r,this.axis);return ZN(o,-1,!1)})}getConfig(){const e={axis:this.axis},t=super.getConfig();return Object.assign(e,t),e}}ZT.className="Concatenate";we(ZT);function Wc(n,e){for(;n<0;)n+=e;return n}function k6(n,e,t){if(n.shape.length>3||e.shape.length>3)throw new tt("batchDot is not implemented for tensors of 4D or higher rank yet");if(_(n.shape.length>=2,()=>`batchDot requires the rank of x to be >= 2, but got ${n.shape.length}`),_(n.shape.length>=2,()=>`batchDot requires the rank of y to be >= 2, but got ${e.shape.length}`),typeof t=="number"&&(t=[t,t]),n.dtype==="complex64"||e.dtype==="complex64")throw new tt("batchDot is not implemented for complex64-type Tensors yet.");const s=n.shape.length,r=e.shape.length;t==null&&(t=[s-1,r-2]);const o=t;return le(()=>{let i;if(s>r){i=s-r;const l=[];for(let u=0;u<i;++u)l.push(1);e=re(e,e.shape.concat(l))}else if(r>s){i=r-s;const l=[];for(let u=0;u<i;++u)l.push(1);n=re(n,n.shape.concat(l))}else i=0;let a;if(n.shape.length===2&&e.shape.length===2)o[0]===o[1]?a=We(te(n,e),o[0]):a=We(te(ct(n,[1,0]),e),o[1]);else{const l=o[0]!==n.shape.length-1,u=o[1]===e.shape.length-1;a=mt(n,e,l,u)}if(i>0){let l;s>r?l=s+r-3:l=s-1;const u=[];for(let d=l;d<l+i;++d)u.push(d);a=Nd(a,u)}return a.shape.length===1&&(a=hs(a,1)),a})}class eE extends wa{constructor(e){super(e),this.axes=e.axes,this.normalize=e.normalize==null?!1:e.normalize,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){_(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const t=e[0],s=e[1];if(t.length>3||s.length>3)throw new tt("Dot layer does not support tensors of 4D or higher rank yet.");const r=this.interpretAxes(t,s);if(t[r[0]]!==s[r[1]])throw new Z(`Dimension incompatibility: ${t[r[0]]} !== ${s[r[1]]}`)}mergeFunction(e){if(e.length!==2)throw new Z(`A \`Dot\` layer must be called on exactly 2 inputs, but received ${e.length} input(s).`);let t=e[0],s=e[1],r;return Array.isArray(this.axes)?r=this.axes.map((o,i)=>Wc(o,e[i].shape.length)):r=[Wc(this.axes,t.shape.length),Wc(this.axes,s.shape.length)],this.normalize&&(t=Jf(t,r[0]),s=Jf(s,r[1])),k6(t,s,r)}interpretAxes(e,t){let s;return Array.isArray(this.axes)?s=this.axes:s=[Wc(this.axes,e.length),Wc(this.axes,t.length)],s}computeOutputShape(e){_(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const t=e[0].slice(),s=e[1].slice();if(t.length>3||s.length>3)throw new tt("Dot layer does not support tensors of 4D or higher rank yet.");const r=this.interpretAxes(t,s);t.splice(r[0],1),s.splice(r[1],1),s.splice(0,1);const o=t.concat(s);return o.length===1&&o.push(1),o}computeMask(e,t){return null}getConfig(){const e={axes:this.axes,normalize:this.normalize},t=super.getConfig();return Object.assign(e,t),e}}eE.className="Dot";we(eE);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class tE extends ot{constructor(e){super(e),this.supportsMasking=!0,this.stddev=e.stddev}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={stddev:this.stddev};return Object.assign(t,e),t}call(e,t){return le(()=>{this.invokeCallHook(e,t);const s=Xe(e);return Md(()=>Ie(jm(s.shape,0,this.stddev),s),()=>s,t.training||!1)})}}tE.className="GaussianNoise";we(tE);class nE extends ot{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={rate:this.rate};return Object.assign(t,e),t}call(e,t){return le(()=>{this.invokeCallHook(e,t);const s=Xe(e);return this.rate>0&&this.rate<1?Md(()=>{const o=Math.sqrt(this.rate/(1-this.rate));return te(s,jm(s.shape,1,o))},()=>s,t.training||!1):s})}}nE.className="GaussianDropout";we(nE);class sE extends ot{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate,this.noiseShape=e.noiseShape}_getNoiseShape(e){return this.noiseShape||Xe(e).shape}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={rate:this.rate};return Object.assign(t,e),t}call(e,t){return le(()=>{if(this.rate<1&&this.rate>0){const s=this._getNoiseShape(e);return Md(()=>{const o=Xe(e),a=-1.6732632423543772*1.0507009873554805;let l=xa(Sd(s),this.rate);l=Qr(l,"float32");const u=((1-this.rate)*(1+this.rate*a**2))**-.5,d=-u*a*this.rate,f=Ie(te(o,l),te(Ie(l,-1),a));return Ie(te(f,u),d)},()=>Xe(e),t.training||!1)}return e})}}sE.className="AlphaDropout";we(sE);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function gu(n,e,t,s,r,o=.001){let i;if(n.rank===2)i=UF(n,e,t,s,r,o);else if(n.rank===3)i=HF(n,e,t,s,r,o);else if(n.rank===4)i=KF(n,e,t,s,r,o);else throw new tt(`batchNormalization is not implemented for array of rank ${n.rank} yet`);return i}function C6(n,e,t,s,r=.001){return le(()=>{const o=M1(n,s),i=o.mean,a=o.variance;return[gu(n,i,a,t,e,r),i,a]})}function S6(n,e,t,s,r=.001){return le(()=>{const o=M1(n,s),i=o.mean,a=o.variance,l=[];for(const y of Ar(0,n.rank))s.indexOf(y)!==-1?l.push(1):l.push(n.shape[y]);const u=re(i,l),d=re(a,l),f=e==null?null:re(e,l),m=t==null?null:re(t,l);return[gu(n,u,d,m,f,r),i,a]})}function N6(n,e,t,s,r=.001){return xt(s.slice().sort(),Ar(0,n.rank-1))?C6(n,e,t,s,r):S6(n,e,t,s,r)}class rE extends ot{constructor(e){e==null&&(e={}),super(e),this.supportsMasking=!0,this.axis=e.axis==null?-1:e.axis,this.momentum=e.momentum==null?.99:e.momentum,this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=Lt(e.betaInitializer||"zeros"),this.gammaInitializer=Lt(e.gammaInitializer||"ones"),this.movingMeanInitializer=Lt(e.movingMeanInitializer||"zeros"),this.movingVarianceInitializer=Lt(e.movingVarianceInitializer||"ones"),this.betaConstraint=pn(e.betaConstraint),this.gammaConstraint=pn(e.gammaConstraint),this.betaRegularizer=jt(e.betaRegularizer),this.gammaRegularizer=jt(e.gammaRegularizer)}build(e){e=ht(e);const t=this.axis>=0?this.axis:this.axis+e.length,s=e[t];if(s==null)throw new Z(`Axis ${t} of input tensor should have a defined dimension but the layer received an input with shape ${JSON.stringify(e)}.`);this.inputSpec=[new hn({ndim:e.length,axes:{[t]:s}})];const r=[s];this.scale&&(this.gamma=this.addWeight("gamma",r,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",r,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",r,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",r,null,this.movingVarianceInitializer,null,!1),this.built=!0}call(e,t){return le(()=>{const s=t.training==null?!1:t.training,r=Xe(e),o=r.shape,i=o.length,a=Ar(0,i),l=this.axis>=0?this.axis:this.axis+i;a.splice(l,1);const u=ca(1,i);u[l]=o[l];const d=a.slice();d.sort();const f=!xt(d,Ar(0,i).slice(0,i-1)),m=()=>{if(f){const v=re(this.movingMean.read(),u),N=re(this.movingVariance.read(),u),S=this.center?re(this.beta.read(),u):null,$=this.scale?re(this.gamma.read(),u):null;return gu(r,v,N,S,$,this.epsilon)}else return gu(r,this.movingMean.read(),this.movingVariance.read(),this.beta==null?null:this.beta.read(),this.gamma==null?null:this.gamma.read(),this.epsilon)};if(!s)return m();const[g,y,w]=N6(r,this.gamma.read(),this.beta.read(),a,this.epsilon),b=(v,N,S)=>{le(()=>{const $=1-S,R=v.read(),M=te(Ke(R,N),$);v.write(Ke(R,M))})};return(()=>{b(this.movingMean,y,this.momentum),b(this.movingVariance,w,this.momentum)})(),g})}getConfig(){const e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:zt(this.betaInitializer),gammaInitializer:zt(this.gammaInitializer),movingMeanInitializer:zt(this.movingMeanInitializer),movingVarianceInitializer:zt(this.movingVarianceInitializer),betaRegularizer:St(this.betaRegularizer),gammaRegularizer:St(this.gammaRegularizer),betaConstraint:fn(this.betaConstraint),gammaConstraint:fn(this.gammaConstraint)},t=super.getConfig();return Object.assign(e,t),e}}rE.className="BatchNormalization";we(rE);class oE extends ot{constructor(e){if(e==null&&(e={}),super(e),this.axis=e.axis==null?-1:e.axis,typeof this.axis=="number"){if(!Number.isInteger(this.axis))throw new Error(`Expected axis to be an integer, but received ${this.axis}`)}else if(Array.isArray(this.axis)){for(const t of this.axis)if(!Number.isInteger(t))throw new Error(`Expected axis to be an array of integers, but received ${JSON.stringify(this.axis)}`)}else throw new Error(`Expected axis to be an integer or an array of integers, but received ${JSON.stringify(this.axis)}`);this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=Lt(e.betaInitializer||"zeros"),this.gammaInitializer=Lt(e.gammaInitializer||"ones"),this.betaRegularizer=jt(e.betaRegularizer),this.gammaRegularizer=jt(e.gammaRegularizer),this.supportsMasking=!0}build(e){e=ht(e);const t=e.length;typeof this.axis=="number"&&(this.axis=[this.axis]);for(let o=0;o<this.axis.length;++o)this.axis[o]<0&&(this.axis[o]+=t);for(const o of this.axis)if(o<0||o>=t)throw new Error(`Invalid axis: ${o}`);if(this.axis.length!==oi(this.axis).length)throw new Error(`Found duplicate axes in: ${this.axis}`);const s=this.axis.map(o=>e[o]),r=!0;this.scale?this.gamma=this.addWeight("gamma",s,"float32",this.gammaInitializer,this.gammaRegularizer,r):this.gamma=null,this.center?this.beta=this.addWeight("beta",s,"float32",this.betaInitializer,this.betaRegularizer,r):this.beta=null,this.built=!0}call(e,t){const s=Xe(e),r=s.shape,o=r.length;return le(()=>{let{mean:a,variance:l}=M1(s,this.axis,!0);const u=ca(1,o);for(const w of this.axis)u[w]=r[w];const d=w=>w!=null&&w.shape.length!==o?re(w,u):w;let f=this.scale?d(this.gamma.read()):null,m=this.center?d(this.beta.read()):null;const g=[],y=[];for(let w=0;w<o;++w)this.axis.indexOf(w)!==-1?(g.push(r[w]),y.push(1)):(g.push(1),y.push(r[w]));return a=$r(a,g),l=$r(l,g),f!=null&&(f=$r(f,y)),m!=null&&(m=$r(m,y)),gu(s,a,l,m,f,this.epsilon)})}getConfig(){const e={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:zt(this.betaInitializer),gammaInitializer:zt(this.gammaInitializer),betaRegularizer:St(this.betaRegularizer),gammaRegularizer:St(this.gammaRegularizer)},t=super.getConfig();return Object.assign(e,t),e}}oE.className="LayerNormalization";we(oE);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function I6(n,e,t){return le(()=>{if(n.rank!==4)throw new Z(`temporalPadding expects input tensor to be 4-D, but received a ${n.rank}-D tensor.`);if(e==null&&(e=[[1,1],[1,1]]),e.length!==2||e[0].length!==2||e[1].length!==2)throw new Z("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(t==null&&(t=Dr()),t!=="channelsLast"&&t!=="channelsFirst")throw new Z(`Unknown data format: ${t}. Supported data formats are 'channelsLast' and 'channelsFirst.`);let s;return t==="channelsFirst"?s=[[0,0],[0,0],e[0],e[1]]:s=[[0,0],e[0],e[1],[0,0]],P1(n,s)})}class iE extends ot{constructor(e){if(e==null&&(e={}),super(e),this.dataFormat=e.dataFormat==null?Dr():e.dataFormat,e.padding==null)this.padding=[[1,1],[1,1]];else if(typeof e.padding=="number")this.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{if(e.padding=e.padding,e.padding.length!==2)throw new Z(`ZeroPadding2D expects padding to be a length-2 array, but received a length-${e.padding.length} array.`);let t,s;if(typeof e.padding[0]=="number")t=[e.padding[0],e.padding[0]],s=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,e.padding[0].length!==2)throw new Z(`ZeroPadding2D expects height padding to be a length-2 array, but received a length-${e.padding[0].length} array.`);if(t=e.padding[0],e.padding[1].length!==2)throw new Z(`ZeroPadding2D expects width padding to be a length-2 array, but received a length-${e.padding[1].length} array.`);s=e.padding[1]}this.padding=[t,s]}this.inputSpec=[new hn({ndim:4})]}computeOutputShape(e){e=ht(e);let t,s;return this.dataFormat==="channelsFirst"?(e[2]!=null&&e[2]>=0?t=e[2]+this.padding[0][0]+this.padding[0][1]:t=null,e[3]!=null&&e[3]>=0?s=e[3]+this.padding[1][0]+this.padding[1][1]:s=null,[e[0],e[1],t,s]):(e[1]!=null&&e[1]>=0?t=e[1]+this.padding[0][0]+this.padding[0][1]:t=null,e[2]!=null&&e[2]>=0?s=e[2]+this.padding[1][0]+this.padding[1][1]:s=null,[e[0],t,s,e[3]])}call(e,t){return le(()=>I6(Xe(e),this.padding,this.dataFormat))}getConfig(){const e={padding:this.padding,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}iE.className="ZeroPadding2D";we(iE);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Hm(n,e,t,s,r,o){return le(()=>{en(r),C$(o),Hs(s),t==null&&(t=[1,1]),s==null&&(s="valid"),r==null&&(r=Dr()),o==null&&(o="max"),n=_v(n,r);let i;const a=s==="same"?"same":"valid";return o==="max"?i=D1(n,e,t,a):i=k1(n,e,t,a),r==="channelsFirst"&&(i=ct(i,[0,3,1,2])),i})}function aE(n,e,t,s,r,o){return le(()=>{en(r),C$(o),Hs(s),t==null&&(t=[1,1,1]),s==null&&(s="valid"),r==null&&(r=Dr()),o==null&&(o="max"),n=NT(n,r);let i;const a=s==="same"?"same":"valid";return o==="max"?i=Dj(n,e,t,a):i=PF(n,e,t,a),r==="channelsFirst"&&(i=ct(i,[0,4,1,2,3])),i})}class lE extends ot{constructor(e){if(e.poolSize==null&&(e.poolSize=2),super(e),typeof e.poolSize=="number")this.poolSize=[e.poolSize];else if(Array.isArray(e.poolSize)&&e.poolSize.length===1&&typeof e.poolSize[0]=="number")this.poolSize=e.poolSize;else throw new Z(`poolSize for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.poolSize)}`);if(Cn(this.poolSize,"poolSize"),e.strides==null)this.strides=this.poolSize;else if(typeof e.strides=="number")this.strides=[e.strides];else if(Array.isArray(e.strides)&&e.strides.length===1&&typeof e.strides[0]=="number")this.strides=e.strides;else throw new Z(`strides for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.strides)}`);Cn(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,Hs(this.padding),this.inputSpec=[new hn({ndim:3})]}computeOutputShape(e){e=ht(e);const t=Rr(e[1],this.poolSize[0],this.padding,this.strides[0]);return[e[0],t,e[2]]}call(e,t){return le(()=>{this.invokeCallHook(e,t),e=Ad(Xe(e),2);const s=this.poolingFunction(Xe(e),[this.poolSize[0],1],[this.strides[0],1],this.padding,"channelsLast");return Nd(s,[2])})}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides},t=super.getConfig();return Object.assign(e,t),e}}class cE extends lE{constructor(e){super(e)}poolingFunction(e,t,s,r,o){return en(o),Hs(r),Hm(e,t,s,r,o,"max")}}cE.className="MaxPooling1D";we(cE);class uE extends lE{constructor(e){super(e)}poolingFunction(e,t,s,r,o){return en(o),Hs(r),Hm(e,t,s,r,o,"avg")}}uE.className="AveragePooling1D";we(uE);class dE extends ot{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==2)throw new Z(`If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides];Cn(this.poolSize,"poolSize"),Cn(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,en(this.dataFormat),Hs(this.padding),this.inputSpec=[new hn({ndim:4})]}computeOutputShape(e){e=ht(e);let t=this.dataFormat==="channelsFirst"?e[2]:e[1],s=this.dataFormat==="channelsFirst"?e[3]:e[2];return t=Rr(t,this.poolSize[0],this.padding,this.strides[0]),s=Rr(s,this.poolSize[1],this.padding,this.strides[1]),this.dataFormat==="channelsFirst"?[e[0],e[1],t,s]:[e[0],t,s,e[3]]}call(e,t){return le(()=>(this.invokeCallHook(e,t),this.poolingFunction(Xe(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class hE extends dE{constructor(e){super(e)}poolingFunction(e,t,s,r,o){return en(o),Hs(r),Hm(e,t,s,r,o,"max")}}hE.className="MaxPooling2D";we(hE);class fE extends dE{constructor(e){super(e)}poolingFunction(e,t,s,r,o){return en(o),Hs(r),Hm(e,t,s,r,o,"avg")}}fE.className="AveragePooling2D";we(fE);class pE extends ot{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==3)throw new Z(`If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides,e.strides];Cn(this.poolSize,"poolSize"),Cn(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,en(this.dataFormat),Hs(this.padding),this.inputSpec=[new hn({ndim:5})]}computeOutputShape(e){e=ht(e);let t=this.dataFormat==="channelsFirst"?e[2]:e[1],s=this.dataFormat==="channelsFirst"?e[3]:e[2],r=this.dataFormat==="channelsFirst"?e[4]:e[3];return t=Rr(t,this.poolSize[0],this.padding,this.strides[0]),s=Rr(s,this.poolSize[1],this.padding,this.strides[1]),r=Rr(r,this.poolSize[2],this.padding,this.strides[2]),this.dataFormat==="channelsFirst"?[e[0],e[1],t,s,r]:[e[0],t,s,r,e[4]]}call(e,t){return le(()=>(this.invokeCallHook(e,t),this.poolingFunction(Xe(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class mE extends pE{constructor(e){super(e)}poolingFunction(e,t,s,r,o){return en(o),Hs(r),aE(e,t,s,r,o,"max")}}mE.className="MaxPooling3D";we(mE);class gE extends pE{constructor(e){super(e)}poolingFunction(e,t,s,r,o){return en(o),Hs(r),aE(e,t,s,r,o,"avg")}}gE.className="AveragePooling3D";we(gE);class xE extends ot{constructor(e){super(e),this.inputSpec=[new hn({ndim:3})]}computeOutputShape(e){return[e[0],e[2]]}call(e,t){throw new tt}}class yE extends xE{constructor(e){super(e||{})}call(e,t){return le(()=>{const s=Xe(e);return rn(s,1)})}}yE.className="GlobalAveragePooling1D";we(yE);class vE extends xE{constructor(e){super(e||{})}call(e,t){return le(()=>{const s=Xe(e);return Er(s,1)})}}vE.className="GlobalMaxPooling1D";we(vE);class bE extends ot{constructor(e){super(e),this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,en(this.dataFormat),this.inputSpec=[new hn({ndim:4})]}computeOutputShape(e){return e=e,this.dataFormat==="channelsLast"?[e[0],e[3]]:[e[0],e[1]]}call(e,t){throw new tt}getConfig(){const e={dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class wE extends bE{call(e,t){return le(()=>{const s=Xe(e);return this.dataFormat==="channelsLast"?rn(s,[1,2]):rn(s,[2,3])})}}wE.className="GlobalAveragePooling2D";we(wE);class kE extends bE{call(e,t){return le(()=>{const s=Xe(e);return this.dataFormat==="channelsLast"?Er(s,[1,2]):Er(s,[2,3])})}}kE.className="GlobalMaxPooling2D";we(kE);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class CE extends ot{constructor(e){super(e),this.layer=e.layer}build(e){this.built=!0}get trainable(){return this.layer!=null?this.layer.trainable:!1}set trainable(e){this.layer!=null&&(this.layer.trainable=e)}get trainableWeights(){return this.layer.trainableWeights}get nonTrainableWeights(){return this.layer.nonTrainableWeights}get updates(){return this.layer._updates}get losses(){return this.layer.losses}getWeights(){return this.layer.getWeights()}setWeights(e){this.layer.setWeights(e)}getConfig(){const e={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},t=super.getConfig();return Object.assign(e,t),e}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.layer!=null&&this.layer.setFastWeightInitDuringBuild(e)}static fromConfig(e,t,s={}){const r=t.layer,o=Jr(r,s);delete t.layer;const i={layer:o};return Object.assign(i,t),new e(i)}}class SE extends CE{constructor(e){super(e),this.supportsMasking=!0}build(e){if(e=ht(e),e.length<3)throw new Z(`TimeDistributed layer expects an input shape >= 3D, but received input shape ${JSON.stringify(e)}`);this.inputSpec=[{shape:e}];const t=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(t),this.layer.built=!0),super.build(e)}computeOutputShape(e){e=ht(e);const t=[e[0]].concat(e.slice(2)),s=this.layer.computeOutputShape(t),r=e[1];return[s[0],r].concat(s.slice(1))}call(e,t){return le(()=>(e=Xe(e),PT((i,a)=>[Xe(this.layer.call(i,t)),[]],e,[],!1,null,null,!1,!0)[1]))}}SE.className="TimeDistributed";we(SE);function $6(n){ba(UB,"BidirectionalMergeMode",n)}const T6="concat";class NE extends CE{constructor(e){super(e);const t=e.layer.getConfig(),s={};s.className=e.layer.getClassName(),s.config=t,this.forwardLayer=Jr(s),t.goBackwards=t.goBackwards!==!0;const r={};if(r.className=e.layer.getClassName(),r.config=t,this.backwardLayer=Jr(r),this.forwardLayer.name="forward_"+this.forwardLayer.name,this.backwardLayer.name="backward_"+this.backwardLayer.name,this.mergeMode=e.mergeMode===void 0?T6:e.mergeMode,$6(this.mergeMode),e.weights)throw new tt("weights support is not implemented for Bidirectional layer yet.");this._stateful=e.layer.stateful,this.returnSequences=e.layer.returnSequences,this.returnState=e.layer.returnState,this.supportsMasking=!0,this._trainable=!0,this.inputSpec=e.layer.inputSpec,this.numConstants=null}get trainable(){return this._trainable}set trainable(e){this._trainable=e,this.forwardLayer!=null&&(this.forwardLayer.trainable=e),this.backwardLayer!=null&&(this.backwardLayer.trainable=e)}getWeights(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}setWeights(e){const t=e.length,s=Math.floor(t/2);this.forwardLayer.setWeights(e.slice(0,s)),this.backwardLayer.setWeights(e.slice(s))}computeOutputShape(e){let t=this.forwardLayer.computeOutputShape(e);Array.isArray(t)&&Array.isArray(t[0])||(t=[t]),t=t;let s,r,o;return this.returnState&&(o=t.slice(1)),s=t[0],s=s,this.mergeMode==="concat"?(s[s.length-1]*=2,r=[s]):this.mergeMode==null?r=[s,s.slice()]:r=[s],this.returnState?this.mergeMode==null?r.concat(o).concat(o.slice()):[s].concat(o).concat(o.slice()):fs(r)}apply(e,t){let s=t==null?null:t.initialState,r=t==null?null:t.constants;t==null&&(t={});const o=MT(e,s,r,this.numConstants);if(e=o.inputs,s=o.initialState,r=o.constants,Array.isArray(e)&&(s=e.slice(1),e=e[0]),(s==null||s.length===0)&&r==null)return super.apply(e,t);const i=[],a=[];if(s!=null){const u=s.length;if(u%2>0)throw new Z("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");t.initialState=s,i.push(...s);const d=s.map(f=>new hn({shape:f.shape}));this.forwardLayer.stateSpec=d.slice(0,u/2),this.backwardLayer.stateSpec=d.slice(u/2),a.push(...d)}if(r!=null)throw new tt("Support for constants in Bidirectional layers is not implemented yet.");const l=i[0]instanceof no;for(const u of i)if(u instanceof no!==l)throw new Z("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(l){const u=[e].concat(i),d=this.inputSpec.concat(a),f=this.inputSpec;this.inputSpec=d;const m=super.apply(u,t);return this.inputSpec=f,m}else return super.apply(e,t)}call(e,t){return le(()=>{const s=t.initialState;let r,o;if(s==null)r=this.forwardLayer.call(e,t),o=this.backwardLayer.call(e,t);else{const l=s.slice(0,s.length/2),u=s.slice(s.length/2);r=this.forwardLayer.call(e,Object.assign(t,{initialState:l})),o=this.backwardLayer.call(e,Object.assign(t,{initialState:u}))}let i;this.returnState&&(Array.isArray(r)&&(i=r.slice(1).concat(o.slice(1))),r=r[0],o=o[0]),this.returnSequences&&(o=aa(o,1));let a;return this.mergeMode==="concat"?a=Iv([r,o]):this.mergeMode==="sum"?a=Ie(r,o):this.mergeMode==="ave"?a=te(.5,Ie(r,o)):this.mergeMode==="mul"?a=te(r,o):this.mergeMode==null&&(a=[r,o]),this.returnState?this.mergeMode==null?a.concat(i):[a].concat(i):a})}resetStates(e){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}build(e){Xi(this.forwardLayer.name,()=>{this.forwardLayer.build(e)}),Xi(this.backwardLayer.name,()=>{this.backwardLayer.build(e)}),this.built=!0}computeMask(e,t){Array.isArray(t)&&(t=t[0]);let s;if(this.returnSequences?this.mergeMode==null?s=[t,t]:s=t:this.mergeMode==null?s=[null,null]:s=null,this.returnState){const o=this.forwardLayer.states.map(i=>null);return Array.isArray(s)?s.concat(o).concat(o):[s].concat(o).concat(o)}else return s}get trainableWeights(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}get nonTrainableWeights(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.forwardLayer!=null&&this.forwardLayer.setFastWeightInitDuringBuild(e),this.backwardLayer!=null&&this.backwardLayer.setFastWeightInitDuringBuild(e)}getConfig(){const e={mergeMode:this.mergeMode},t=super.getConfig();return Object.assign(e,t),e}static fromConfig(e,t){const s=Jr(t.layer);if(delete t.layer,t.numConstants!=null)throw new tt("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");const r=t;return r.layer=s,new e(r)}}NE.className="Bidirectional";we(NE);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class IE extends ot{constructor(e){super(e),this.scale=e.scale,e.offset?this.offset=e.offset:this.offset=0}getConfig(){const e={scale:this.scale,offset:this.offset},t=super.getConfig();return Object.assign(e,t),e}call(e,t){return le(()=>(e=Xe(e),e.dtype!=="float32"&&(e=Qr(e,"float32")),Ie(te(e,this.scale),this.offset)))}}IE.className="Rescaling";we(IE);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const{resizeBilinear:E6,cropAndResize:R6}=wo;class $E extends ot{constructor(e){super(e),this.height=e.height,this.width=e.width}centerCrop(e,t,s,r,o,i,a,l){return le(()=>{let u,d=!1;const f=t/i,m=s/a,g=(r+t)/i,y=(o+s)/a,w=[f,m,g,y],b=[];e.rank===3?(d=!0,u=Co([e])):u=e;for(let $=0;$<u.shape[0];$++)b.push(w);const k=tu(b,[b.length,4]),v=fu(0,b.length,1,"int32"),S=R6(u,k,v,[r,o],"nearest");return Qr(d?Xe(la(S)):S,l)})}upsize(e,t,s,r){return le(()=>{const o=E6(e,[t,s]);return Qr(o,r)})}call(e,t){return le(()=>{const s=Xe(e),r=s.dtype,o=s.shape,i=o[o.length-3],a=o[o.length-2];let l=0;i!==this.height&&(l=Math.floor((i-this.height)/2));let u=0;return a!==this.width&&(u=Math.floor((a-this.width)/2),u===0&&(u=1)),l>=0&&u>=0?this.centerCrop(s,l,u,this.height,this.width,i,a,r):this.upsize(e,this.height,this.width,r)})}getConfig(){const e={height:this.height,width:this.width},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){e=ht(e);const t=e.length-3,s=e.length-2;return e[t]=this.height,e[s]=this.width,e}}$E.className="CenterCrop";we($E);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function A6(n,e,t,s){let r=Xe(n);if(r.dtype!=="int32"&&(r=Qr(r,"int32")),e==="int")return r;const o=r.shape;if(r.rank===0&&(r=hs(r,-1)),e==="oneHot"&&r.shape[r.shape.length-1]!==1&&(r=hs(r,-1)),r.rank>2)throw new Z(`When outputMode is not int, maximum output rank is 2 Received outputMode ${e} and input shape ${o} which would result in output rank ${r.rank}.`);const i=["multiHot","oneHot"].includes(e),a=r;let l;if(typeof s<"u"&&e==="count"?l=M2(a,s,t,i):l=M2(a,[],t,i),e!=="tfIdf")return l;if(s)return te(l,s);throw new Z("When outputMode is 'tfIdf', weights must be provided.")}/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class TE extends ot{constructor(e){super(e),this.numTokens=e.numTokens,e.outputMode?this.outputMode=e.outputMode:this.outputMode="multiHot"}getConfig(){const e={numTokens:this.numTokens,outputMode:this.outputMode},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){return e=ht(e),e==null?[this.numTokens]:this.outputMode==="oneHot"&&e[e.length-1]!==1?(e.push(this.numTokens),e):(e[e.length-1]=this.numTokens,e)}call(e,t){return le(()=>{e=Xe(e),e.dtype!=="int32"&&(e=Qr(e,"int32"));let s;if(typeof t.countWeights<"u"){if(this.outputMode!=="count")throw new Z(`countWeights is not used when outputMode !== count.
              Received countWeights=${t.countWeights}`);s=Xe(t.countWeights)}const r=Er(e),o=Wf(e),i=Gs(this.numTokens,r).bufferSync().get(0),a=xa(o,0).bufferSync().get(0);if(!(i&&a))throw new Z(`Input values must be between 0 < values <= numTokens with numTokens=${this.numTokens}`);return A6(e,this.outputMode,this.numTokens,s)})}}TE.className="CategoryEncoding";we(TE);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const D6=["bilinear","nearest"],kC=new Set(D6);class EE extends ot{constructor(e){if(super(e),this.height=e.height,this.width=e.width,e.interpolation)if(kC.has(e.interpolation))this.interpolation=e.interpolation;else throw new Z(`Invalid interpolation parameter: ${e.interpolation} is not implemented`);else this.interpolation="bilinear";this.cropToAspectRatio=!!e.cropToAspectRatio}computeOutputShape(e){e=ht(e);const t=e[2];return[this.height,this.width,t]}getConfig(){const e={height:this.height,width:this.width,interpolation:this.interpolation,cropToAspectRatio:this.cropToAspectRatio},t=super.getConfig();return Object.assign(e,t),e}call(e,t){return le(()=>{const s=[this.height,this.width];if(this.interpolation==="bilinear")return wo.resizeBilinear(e,s,!this.cropToAspectRatio);if(this.interpolation==="nearest")return wo.resizeNearestNeighbor(e,s,!this.cropToAspectRatio);throw new Error(`Interpolation is ${this.interpolation} but only ${[...kC]} are supported`)})}}EE.className="Resizing";we(EE);/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class RE{constructor(e){this.seed=e}next(){if(this.seed!==void 0)return this.seed++}}RE.className="RandomSeed";/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class AE extends ot{constructor(e){super(e),this.randomGenerator=new RE(e.seed)}getConfig(){const e={seed:this.randomGenerator.seed},t=super.getConfig();return Object.assign(e,t),e}}AE.className="BaseRandomLayer";/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const M6=["bilinear","nearest"],CC=new Set(M6);class DE extends AE{constructor(e){super(e);const{factor:t,interpolation:s="bilinear"}=e;if(this.factor=t,Array.isArray(this.factor)&&this.factor.length===2)this.widthLower=this.factor[0],this.widthUpper=this.factor[1];else if(!Array.isArray(this.factor)&&this.factor>0)this.widthLower=-this.factor,this.widthUpper=this.factor;else throw new Z(`Invalid factor: ${this.factor}. Must be positive number or tuple of 2 numbers`);if(this.widthLower<-1||this.widthUpper<-1)throw new Z(`factor must have values larger than -1. Got: ${this.factor}`);if(this.widthUpper<this.widthLower)throw new Z(`factor cannot have upper bound less than lower bound.
        Got upper bound: ${this.widthUpper}.
        Got lower bound: ${this.widthLower}
      `);if(s)if(CC.has(s))this.interpolation=s;else throw new Z(`Invalid interpolation parameter: ${s} is not implemented`)}getConfig(){const e={factor:this.factor,interpolation:this.interpolation},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){e=ht(e);const t=e[2];return[this.imgHeight,-1,t]}call(e,t){return le(()=>{const s=Xe(e);this.imgHeight=s.shape[s.shape.length-3];const r=s.shape[s.shape.length-2];this.widthFactor=Sd([1],1+this.widthLower,1+this.widthUpper,"float32",this.randomGenerator.next());let o=this.widthFactor.dataSync()[0]*r;o=Math.round(o);const i=[this.imgHeight,o];switch(this.interpolation){case"bilinear":return wo.resizeBilinear(e,i);case"nearest":return wo.resizeNearestNeighbor(e,i);default:throw new Error(`Interpolation is ${this.interpolation}
          but only ${[...CC]} are supported`)}})}}DE.className="RandomWidth";we(DE);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Uc(n){return new Uv(n)}function P6(n){return new Gm(n)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const F6=de();F6.registerFlag("KEEP_INTERMEDIATE_TENSORS",()=>!1,n=>{n&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var SC;(function(n){n[n.DT_INVALID=0]="DT_INVALID",n[n.DT_FLOAT=1]="DT_FLOAT",n[n.DT_DOUBLE=2]="DT_DOUBLE",n[n.DT_INT32=3]="DT_INT32",n[n.DT_UINT8=4]="DT_UINT8",n[n.DT_INT16=5]="DT_INT16",n[n.DT_INT8=6]="DT_INT8",n[n.DT_STRING=7]="DT_STRING",n[n.DT_COMPLEX64=8]="DT_COMPLEX64",n[n.DT_INT64=9]="DT_INT64",n[n.DT_BOOL=10]="DT_BOOL",n[n.DT_QINT8=11]="DT_QINT8",n[n.DT_QUINT8=12]="DT_QUINT8",n[n.DT_QINT32=13]="DT_QINT32",n[n.DT_BFLOAT16=14]="DT_BFLOAT16",n[n.DT_QINT16=15]="DT_QINT16",n[n.DT_QUINT16=16]="DT_QUINT16",n[n.DT_UINT16=17]="DT_UINT16",n[n.DT_COMPLEX128=18]="DT_COMPLEX128",n[n.DT_HALF=19]="DT_HALF",n[n.DT_RESOURCE=20]="DT_RESOURCE",n[n.DT_VARIANT=21]="DT_VARIANT",n[n.DT_UINT32=22]="DT_UINT32",n[n.DT_UINT64=23]="DT_UINT64",n[n.DT_FLOAT_REF=101]="DT_FLOAT_REF",n[n.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",n[n.DT_INT32_REF=103]="DT_INT32_REF",n[n.DT_UINT8_REF=104]="DT_UINT8_REF",n[n.DT_INT16_REF=105]="DT_INT16_REF",n[n.DT_INT8_REF=106]="DT_INT8_REF",n[n.DT_STRING_REF=107]="DT_STRING_REF",n[n.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",n[n.DT_INT64_REF=109]="DT_INT64_REF",n[n.DT_BOOL_REF=110]="DT_BOOL_REF",n[n.DT_QINT8_REF=111]="DT_QINT8_REF",n[n.DT_QUINT8_REF=112]="DT_QUINT8_REF",n[n.DT_QINT32_REF=113]="DT_QINT32_REF",n[n.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",n[n.DT_QINT16_REF=115]="DT_QINT16_REF",n[n.DT_QUINT16_REF=116]="DT_QUINT16_REF",n[n.DT_UINT16_REF=117]="DT_UINT16_REF",n[n.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",n[n.DT_HALF_REF=119]="DT_HALF_REF",n[n.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",n[n.DT_VARIANT_REF=121]="DT_VARIANT_REF",n[n.DT_UINT32_REF=122]="DT_UINT32_REF",n[n.DT_UINT64_REF=123]="DT_UINT64_REF"})(SC||(SC={}));var NC;(function(n){(function(e){e[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"})(n.CheckpointFormatVersion||(n.CheckpointFormatVersion={}))})(NC||(NC={}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var IC;(function(n){n[n.FAIL=0]="FAIL",n[n.SHORTEST=1]="SHORTEST",n[n.LONGEST=2]="LONGEST"})(IC||(IC={}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fe(n,e){Array.isArray(n)||(n=[n]),n.forEach(t=>{t!=null&&_(t.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the CPU backend.`)})}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const L6=$I;class qm extends Ny{nextDataId(){return qm.nextDataId++}constructor(){super(),this.blockSize=48,this.firstUse=!0,this.data=new ZS(this,Vr())}write(e,t,s){this.firstUse&&(this.firstUse=!1,de().get("IS_NODE")&&Bs(`
============================
Hi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. 
============================`));const r={id:this.nextDataId()};return this.data.set(r,{values:e,dtype:s,refCount:1}),r}makeTensorInfo(e,t,s){let r;if(t==="string"&&s!=null&&s.length>0&&Iu(s[0])){const o=s.map(i=>ri(i));r=this.write(o,e,t)}else r=this.write(s,e,t);return{dataId:r,shape:e,dtype:t}}refCount(e){return this.data.has(e)?this.data.get(e).refCount:0}incRef(e){const t=this.data.get(e);t.refCount++}decRef(e){if(this.data.has(e)){const t=this.data.get(e);t.refCount--}}move(e,t,s,r,o){this.data.set(e,{values:t,dtype:r,refCount:o})}numDataIds(){return this.data.numDataIds()}async read(e){return this.readSync(e)}readSync(e){const{dtype:t,complexTensorInfos:s}=this.data.get(e);if(t==="complex64"){const r=this.readSync(s.real.dataId),o=this.readSync(s.imag.dataId);return So(r,o)}return FM(this.data.get(e).values,t)}bufferSync(e){const t=this.readSync(e.dataId);if(e.dtype==="string")try{const s=t.map(r=>ai(r));return st(e.shape,e.dtype,s)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return st(e.shape,e.dtype,t)}makeOutput(e,t,s){return Vr().makeTensorFromTensorInfo(this.makeTensorInfo(t,s,e),this)}disposeData(e,t=!1){if(this.data.has(e)){if(this.data.get(e).refCount--,!t&&this.data.get(e).refCount>0)return!1;const{complexTensorInfos:s}=this.data.get(e);s!=null&&(this.disposeData(s.real.dataId,!0),this.disposeData(s.imag.dataId,!0)),this.data.delete(e)}return!0}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}async time(e){const t=ds();return e(),{kernelMs:ds()-t}}memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}where(e){Fe([e],"where");const t=this.readSync(e.dataId);return L6(e.shape,t)}dispose(){}floatPrecision(){return 32}epsilon(){return super.epsilon()}}qm.nextDataId=0;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ME(n){const e=new Float32Array(n.length);for(let t=0;t<n.length;++t)e[t]=Math.abs(n[t]);return e}const j6=n=>{const{x:e}=n.inputs,t=n.backend;Fe(e,"abs");let s=new Float32Array(pe(e.shape));const r=t.data.get(e.dataId).values;return s=ME(r),t.makeOutput(s,e.shape,e.dtype)},O6={kernelName:Cp,backendName:"cpu",kernelFunc:j6};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tn(n){return(e,t,s,r,o)=>{const i=Ze(e,t),a=i.length,l=Ve(i),u=pe(i),d=_n(o,u),f=e.length,m=t.length,g=Ve(e),y=Ve(t),w=kl(e,i),b=kl(t,i);if(w.length+b.length===0)for(let k=0;k<d.length;++k)d[k]=n(s[k%s.length],r[k%r.length]);else for(let k=0;k<d.length;++k){const v=Fl(k,a,l),N=v.slice(-f);w.forEach(M=>N[M]=0);const S=qr(N,f,g),$=v.slice(-m);b.forEach(M=>$[M]=0);const R=qr($,m,y);d[k]=n(s[S],r[R])}return[d,i]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rs(n){const{inputs:e,backend:t}=n,{real:s,imag:r}=e,o=t.data.get(s.dataId).values,i=t.data.get(r.dataId).values,a=t.makeTensorInfo(s.shape,"complex64"),l=t.data.get(a.dataId);return l.complexTensorInfos={real:t.makeTensorInfo(s.shape,"float32",o),imag:t.makeTensorInfo(r.shape,"float32",i)},a}const _6={kernelName:Oy,backendName:"cpu",kernelFunc:Rs};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rp(n,e,t="float32"){if(t==="complex64"){const r=rp(n,e,"float32"),o=rp(n,e,"float32");return Rs({inputs:{real:r,imag:o},backend:n})}const s=zn(pe(e),t);return n.makeTensorInfo(e,t,s)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function so(n){const{inputs:e,backend:t}=n,{x:s}=e;return t.incRef(s.dataId),{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}const z6={kernelName:qu,backendName:"cpu",kernelFunc:so};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ua(n){const{inputs:e,backend:t}=n,{input:s}=e,r=t.data.get(s.dataId).complexTensorInfos.real,o=t.data.get(r.dataId).values;return t.makeTensorInfo(r.shape,r.dtype,o)}const B6={kernelName:l1,backendName:"cpu",kernelFunc:ua};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PE(n,e,t,s){if(s==="int32"){const r=Int32Array.from(n);return[e,"int32",r]}if(s==="bool"){const r=ga([0],t),[o,i]=tn((a,l)=>a!==l?1:0)(e,[],n,r,"bool");return[i,"bool",o]}throw new Error(`Error in Cast: failed to cast ${t} to ${s}`)}function hi(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{dtype:o}=s;if(o==="complex64"){if(r.dtype==="complex64")return so({inputs:{x:r},backend:t});const d=rp(t,r.shape,r.dtype),f=hi({inputs:{x:r},backend:t,attrs:{dtype:"float32"}}),m=Rs({inputs:{real:f,imag:d},backend:t});return t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(f),m}if(r.dtype==="complex64"){const d=ua({inputs:{input:r},backend:t}),f=hi({inputs:{x:d},backend:t,attrs:{dtype:o}});return t.disposeIntermediateTensorInfo(d),f}if(!nN(r.dtype,o)){const d=so({inputs:{x:r},backend:t});return{dataId:d.dataId,shape:d.shape,dtype:o}}const i=t.data.get(r.dataId).values,[a,l,u]=PE(i,r.shape,r.dtype,o);return t.makeTensorInfo(a,l,u)}const V6={kernelName:Pu,backendName:"cpu",kernelFunc:hi};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gn(n,e,t,s){return t==null?({inputs:r,backend:o})=>{const{a:i,b:a}=r,l=o;Fe([i,a],n);const u=l.data.get(i.dataId).values,d=l.data.get(a.dataId).values,f=i.dtype==="string"?No(u):u,m=i.dtype==="string"?No(d):d,g=s||i.dtype,[y,w]=e(i.shape,a.shape,f,m,g);return l.makeTensorInfo(w,g,y)}:({inputs:r,backend:o})=>{const{a:i,b:a}=r,l=o;if(i.dtype==="complex64"||a.dtype==="complex64"){const u=hi({inputs:{x:i},backend:l,attrs:{dtype:"complex64"}}),d=l.data.get(u.dataId),f=d.complexTensorInfos.real,m=d.complexTensorInfos.imag,g=l.data.get(f.dataId).values,y=l.data.get(m.dataId).values,w=hi({inputs:{x:a},backend:l,attrs:{dtype:"complex64"}}),b=l.data.get(w.dataId),k=b.complexTensorInfos.real,v=b.complexTensorInfos.imag,N=l.data.get(k.dataId).values,S=l.data.get(v.dataId).values,[$,R,M]=t(i.shape,a.shape,g,y,N,S),A=l.makeTensorInfo(M,"float32",$),P=l.makeTensorInfo(M,"float32",R),D=Rs({inputs:{real:A,imag:P},backend:l});return l.disposeIntermediateTensorInfo(u),l.disposeIntermediateTensorInfo(w),l.disposeIntermediateTensorInfo(A),l.disposeIntermediateTensorInfo(P),D}else{const u=l.data.get(i.dataId).values,d=l.data.get(a.dataId).values,f=s||i.dtype,[m,g]=e(i.shape,a.shape,u,d,f);return l.makeTensorInfo(g,f,m)}}}function Gv(n){return(e,t,s,r,o,i)=>{const a=Ze(e,t),l=pe(a),u=a.length,d=Ve(a),f=_n("float32",l),m=_n("float32",l),g=kl(e,a),y=kl(t,a),w=So(s,r),b=So(o,i),k=e.length,v=Ve(e),N=t.length,S=Ve(t);if(g.length+y.length===0)for(let $=0;$<f.length;$++){const R=$%w.length,M=$%b.length,A=n(w[R*2],w[R*2+1],b[M*2],b[M*2+1]);f[$]=A.real,m[$]=A.imag}else for(let $=0;$<f.length;$++){const R=Fl($,u,d),M=R.slice(-k);g.forEach(j=>M[j]=0);const A=qr(M,k,v),P=R.slice(-N);y.forEach(j=>P[j]=0);const D=qr(P,N,S),E=n(w[A*2],w[A*2+1],b[D*2],b[D*2+1]);f[$]=E.real,m[$]=E.imag}return[f,m,a]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FE=tn(((n,e)=>n+e)),W6=Gv(((n,e,t,s)=>({real:n+t,imag:e+s}))),Il=gn(Ll,FE,W6),U6={kernelName:Ll,backendName:"cpu",kernelFunc:Il};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hv(n,e,t,s,r){const o=pe(s),i=zn(r,t);for(let a=0;a<n.length;a++){const l=n[a];if(l<0)throw new Error("Input x must be non-negative!");l>=r||(o>0?i[l]+=e[a]:i[l]+=1)}return i}function LE(n,e,t,s=!1){const r=n.shape[0],o=n.shape[1],i=st([r,t],e.dtype);for(let a=0;a<r;a++)for(let l=0;l<o;l++){const u=n.get(a,l);if(u<0)throw new Error("Input x must be non-negative!");u>=t||(s?i.set(1,a,u):e.size>0?i.set(i.get(a,u)+e.get(a,l),a,u):i.set(i.get(a,u)+1,a,u))}return i}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jE=tn(((n,e)=>n&e)),G6=gn(jy,jE),H6={kernelName:jy,backendName:"cpu",kernelFunc:G6};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oo(n){return(e,t,s)=>{const r=Qt(t,e.length);for(let o=0;o<e.length;++o)r[o]=n(e[o],s);return r}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wt(n,e,t){const s=oo(e);return ki(n,s,t)}function ki(n,e,t){return({inputs:s,attrs:r,backend:o})=>{const{x:i}=s;Fe(i,n);const a=o,l=a.data.get(i.dataId).values;let u;if(i.dtype==="string"){if(!Array.isArray(l))throw new Error("String tensor's value was not an instance of Array");u=No(l)}else u=l;const d=t||i.dtype,f=e(u,d,r);return a.makeTensorInfo(i.shape,d,f)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OE=oo(n=>Math.ceil(n)),q6=ki(Fu,OE),K6={kernelName:Fu,backendName:"cpu",kernelFunc:q6};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _E(n,e,t,s){const r=Qt(t,pe(e));if(s&&t!=="string"){let o=0;n.forEach(i=>{const a=pe(i.shape);r.set(i.vals,o),o+=a})}else{let o=0;n.forEach(i=>{const a=t==="string"?No(i.vals):i.vals;let l=0;for(let u=0;u<i.shape[0];++u){const d=u*e[1]+o;for(let f=0;f<i.shape[1];++f)r[d+f]=a[l++]}o+=i.shape[1]})}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zE=tn((n,e)=>n===e?1:0),BE=gn(Op,zE,null,"bool"),X6={kernelName:Op,backendName:"cpu",kernelFunc:BE};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VE=oo(n=>Math.exp(n)),WE=ki(Vu,VE,"float32"),Q6={kernelName:Vu,backendName:"cpu",kernelFunc:WE};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UE=oo(n=>Math.expm1(n)),Y6=ki(Wu,UE),J6={kernelName:Wu,backendName:"cpu",kernelFunc:Y6};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GE=oo(n=>Math.floor(n)),Z6=ki(Uu,GE),eW={kernelName:Uu,backendName:"cpu",kernelFunc:Z6};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HE=tn((n,e)=>Math.floor(n/e)),tW=gn(Gu,HE,null,"int32"),nW={kernelName:Gu,backendName:"cpu",kernelFunc:tW};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qE(n,e,t,s,r,o,i,a,l){const u=st([s,o],t);for(let d=0;d<s;d++){const f=[];let m=0;for(let g=0;g<r;g++){const y=n[d*r+g];m+=y*i[g],f.push(y)}if(m<0||m>=l/o)throw new Error(`Invalid indices: ${f} does not index into ${a}`);for(let g=0;g<o;g++)u.values[d*o+g]=e.get(...e.indexToLoc(m*o+g))}return u}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KE(n,e,t){const s=st(t,n.dtype);for(let r=0;r<s.size;++r){const i=s.indexToLoc(r).slice(),a=i[0],l=i[2],u=e.locToIndex([a,l]);i[2]=e.values[u];const d=n.locToIndex(i);0<=d&&d<n.values.length&&(s.values[r]=n.values[d])}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XE=tn((n,e)=>n>e?1:0),sW=gn(Vp,XE,null,"bool"),rW={kernelName:Vp,backendName:"cpu",kernelFunc:sW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QE=tn((n,e)=>n>=e?1:0),oW=gn(Hu,QE,null,"bool"),iW={kernelName:Hu,backendName:"cpu",kernelFunc:oW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YE=tn((n,e)=>n<e?1:0),aW=gn(Up,YE,null,"bool"),lW={kernelName:Up,backendName:"cpu",kernelFunc:aW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JE=tn((n,e)=>n<=e?1:0),cW=gn(Gp,JE,null,"bool"),uW={kernelName:Gp,backendName:"cpu",kernelFunc:cW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZE(n,e,t){const s=(e-n)/(t-1),r=zn(t,"float32");r[0]=n;for(let o=1;o<r.length;o++)r[o]=r[o-1]+s;return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eR=oo(n=>Math.log(n)),dW=ki(Yu,eR),hW={kernelName:Yu,backendName:"cpu",kernelFunc:dW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tR(n,e,t,s){const r=_n(s,pe(t));for(let o=0;o<r.length;++o){const i=o*e;let a=n[i];for(let l=0;l<e;++l){const u=n[i+l];(Number.isNaN(u)||u>a)&&(a=u)}r[o]=a}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nR=tn(((n,e)=>Math.max(n,e))),fW=gn(Zu,nR),pW={kernelName:Zu,backendName:"cpu",kernelFunc:fW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sR=tn(((n,e)=>Math.min(n,e))),mW=gn(ed,sR),gW={kernelName:ed,backendName:"cpu",kernelFunc:mW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qv=tn(((n,e)=>n*e)),xW=Gv(((n,e,t,s)=>({real:n*t-e*s,imag:n*s+e*t}))),Km=gn(nd,qv,xW),yW={kernelName:nd,backendName:"cpu",kernelFunc:Km};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rR(n,e,t){const s=pi(-1,t);return qv([],e,s,n,t)}function vW(n){const{inputs:e,backend:t}=n,{x:s}=e;Fe(s,"neg");const r=t.data.get(s.dataId).values,[o,i]=rR(r,s.shape,s.dtype);return t.makeTensorInfo(i,s.dtype,o)}const bW={kernelName:nm,backendName:"cpu",kernelFunc:vW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oR=tn(((n,e)=>n!==e?1:0)),wW=gn(sm,oR,null,"bool"),kW={kernelName:sm,backendName:"cpu",kernelFunc:wW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kv(n,e,t,s,r){const o=e.length,i=pe(e),a=Ve(e),l=Ve(r),u=_n(t,pe(r));for(let d=0;d<i;++d){const f=Fl(d,o,a),m=new Array(f.length);for(let y=0;y<m.length;y++)m[y]=f[s[y]];const g=qr(m,o,l);u[g]=n[d]}return u}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ys(n){const{inputs:e,attrs:t,backend:s}=n,{x:r}=e,{perm:o}=t;Fe(r,"transpose");const i=r.shape.length,a=new Array(i);for(let f=0;f<a.length;f++)a[f]=r.shape[o[f]];const l=s.data.get(r.dataId).values,u=Kv(l,r.shape,r.dtype,o,a);return{dataId:s.write(u,a,r.dtype),shape:a,dtype:r.dtype}}const CW={kernelName:ll,backendName:"cpu",kernelFunc:ys};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iR(n,e,t,s){const[r,o]=Sn(n,s),i=As(e,"int32"),a=zn(pe(r),i),l=pe(o);for(let u=0;u<a.length;++u){const d=u*l;let f=1;for(let m=0;m<l;++m)f*=t[d+m];a[u]=f}return{outVals:a,outShape:r,outDtype:i}}function SW(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,keepDims:i}=s;Fe(r,"prod");const a=r.shape.length,l=rt(o,r.shape),u=Bt(l,a);let d=l,f=r;const m=[];u!=null&&(f=ys({inputs:{x:r},backend:t,attrs:{perm:u}}),m.push(f),d=Zt(d.length,a));const g=t.data.get(f.dataId).values,{outVals:y,outShape:w,outDtype:b}=iR(f.shape,f.dtype,g,d);let k=w;return i&&(k=an(w,l)),m.forEach(v=>t.disposeIntermediateTensorInfo(v)),t.makeTensorInfo(k,b,y)}const NW={kernelName:cm,backendName:"cpu",kernelFunc:SW};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IW(n,e,t){n.forEach((s,r)=>{if(s<0||s>=t){const o=Fl(r,e.length,Ve(e)).join(",");throw new Error(`indices[${o}] = ${s} is not in [0, ${t})`)}})}function $W(n,e){for(let t=0;t<n.length;++t){const s=n[t],r=t===n.length-1?e:n[t+1].length;if(s.length===0)throw new Error("Ragged splits may not be empty");if(s[0]<0)throw new Error("Ragged splits must be non-negative");if(s[s.length-1]>r)throw new Error("Ragged splits must not point past values");for(let o=1;o<s.length;++o)if(s[o-1]>s[o])throw new Error("Ragged splits must be sorted in ascending order")}}function TW(n,e,t,s){const r=[];let o=0;const i=e.length-1+t.length,a=new Array(i).fill(null).map(()=>[0]);$W(t,s);let l=1;for(let u=0;u<e.length-1;++u){l*=e[u];const d=e[u+1];for(let f=1;f<l+1;++f)a[u].push(f*d)}for(let u=0;u<n.length;++u){let d=n[u],f=n[u]+1;for(let m=0;m<t.length;++m){const g=t[m],y=m+e.length-1;if(y>=0){const w=a[y],b=w[w.length-1]-g[d];for(let k=d;k<f;++k)a[y].push(g[k+1]+b)}d=g[d],f=g[f]}f!==d&&(r.push([d,f]),o+=f-d)}return{outSplits:a,valueSlices:r,numValues:o}}function EW(n){const e=[];for(let t=0;t<n.length;++t){const s=n[t].length,r=Qt("int32",s);e.push(r),n[t].forEach((o,i)=>r[i]=o)}return e}function $C(n,e){const t=n.slice(0,e);for(;t.length<e;)t.push(1);for(let s=e;s<n.length;s++)t[e-1]*=n[s];return t}function RW(n,e,t,s,r,o){const i=$C(e,2)[1],a=$C(o,2)[1];let l=0;for(const u of t)for(let d=u[0];d<u[1];++d){for(let f=0;f<s;++f)r[l*a+f]=n[d*i+f];++l}}function AW(n,e,t,s,r){const o=e.slice();o[0]=r;const i=Qt(t,pe(o)),a=n.length,l=a===0?0:a/e[0];return RW(n,e,s,l,i,o),[i,o]}function aR(n,e,t,s,r,o,i,a){if(n.length===0)throw new Error("paramsNestedSplits must be non empty");if(e[0].length===0)throw new Error("Split tensors must not be scalars");const l=e[0][0]-1;if(IW(o,i,l),s.length===0)throw new Error("params.rank must be nonzero");const u=s[0],{outSplits:d,valueSlices:f,numValues:m}=TW(o,i,n,u),g=EW(d),y=AW(t,s,r,f,m);return[g,y[0],y[1]]}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TC=2147483647;function lR(n,e,t,s,r,o,i){if(e.length>1)throw new Error("starts must be a scalar or vector");if(r.length>1)throw new Error("limits must be a scalar or vector");if(i.length>1)throw new Error("deltas must be a scalar or vector");const a=e.length===0,l=r.length===0,u=i.length===0,d=[];a||d.push(e[0]),l||d.push(r[0]),u||d.push(i[0]);for(let b=1;b<d.length;++b)if(d[b]!==d[b-1])throw new Error("starts, limits, and deltas must have the same shape");const f=d.length===0?1:d[0],m=Qt("int32",f+1);m[0]=0;for(let b=0;b<f;++b){const k=a?n[0]:n[b],v=l?s[0]:s[b],N=u?o[0]:o[b];if(N===0)throw new Error("Requires delta != 0");let S;if(N>0&&v<k||N<0&&v>k)S=0;else if(S=Math.ceil(Math.abs((v-k)/N)),S>TC)throw new Error(`Requires ((limit - start) / delta) <= ${TC}`);m[b+1]=m[b]+S}const g=m[f],y=Qt(t,g);let w=0;for(let b=0;b<f;++b){const k=m[b+1]-m[b];let v=a?n[0]:n[b];const N=u?o[0]:o[b];for(let S=0;S<k;++S)y[w++]=v,v+=N}return[m,y]}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var tr=Ir;class op{constructor(e,t,s,r,o,i,a,l,u,d){this.shape=e,this.shapeShape=t,this.values=s,this.valuesShape=r,this.valuesDType=o,this.defaultValue=i,this.defaultValueShape=a,this.rowPartitionValues=l,this.rowPartitionValuesShapes=u,this.rowPartitionTypes=KI(d),this.raggedRank=XI(this.rowPartitionTypes)}getRowPartitionTypeByDimension(e){return this.rowPartitionTypes[0]===tr.FIRST_DIM_SIZE?this.rowPartitionTypes[e+1]:this.rowPartitionTypes[e]}getRowPartitionTensor(e){return this.rowPartitionTypes[0]===tr.FIRST_DIM_SIZE?this.rowPartitionValues[e+1]:this.rowPartitionValues[e]}getMaxWidth(e){const t=this.getRowPartitionTensor(e-1);switch(this.getRowPartitionTypeByDimension(e-1)){case tr.VALUE_ROWIDS:return op.getMaxWidthValueRowID(t);case tr.ROW_SPLITS:return op.getMaxWidthRowSplit(t);default:throw new Error(`Cannot handle partition type ${tr[this.getRowPartitionTypeByDimension(e-1)]}`)}}static getMaxWidthRowSplit(e){const t=e.length;if(t===0||t===1)return 0;let s=0;for(let r=0;r<t-1;++r){const o=e[r+1]-e[r];o>s&&(s=o)}return s}static getMaxWidthValueRowID(e){const t=e.length;if(t===0)return 0;let s=0,r=e[0],o=0;for(let i=1;i<t;++i){const a=e[i];a!==r&&(r=a,o=Math.max(i-s,o),s=i)}return Math.max(t-s,o)}tensorShapeFromTensor(e,t,s=!0){if(t.length===0){if(e[0]===-1)return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return RC(e,s)}calculateOutputSize(e){const t=this.valuesShape,s=this.defaultValueShape;QI(s,t);const r=this.tensorShapeFromTensor(this.shape,this.shapeShape),i=qI(this.raggedRank,r,t);i[0]<0&&(i[0]=e);for(let a=1;a<=this.raggedRank;++a)i[a]<0&&(i[a]=this.getMaxWidth(a));return i}calculateFirstParentOutputIndex(e,t,s){const r=Math.min(e,s),o=[];let i=0;for(let a=0;a<r;++a,i+=t)o.push(i);for(let a=r;a<e;++a)o.push(-1);return _(o.length===e,()=>"Final length of result must be equal to firstDimension."),o}calculateOutputIndexRowSplit(e,t,s,r){const o=e.length,i=[];for(let a=0;a<o-1;++a){const l=e[a+1]-e[a];let u=Math.min(r,l),d=t[a];d===-1&&(u=0);for(let f=0;f<u;++f)i.push(d),d+=s;for(let f=0;f<l-u;++f)i.push(-1)}if(o>0&&i.length!==e[o-1])throw new Error("Invalid row split size.");return i}calculateOutputIndexValueRowID(e,t,s,r){const o=e.length,i=[];if(o===0)return[];let a=0,l=e[0];if(l>=t.length)throw new Error(`Got currentValueRowId=${l}, which is not less than ${t.length}`);let u=t[l];i.push(u);for(let d=1;d<o;++d){const f=e[d];if(f===l)u>=0&&(++a,a<r?u+=s:u=-1);else{if(a=0,l=f,f>=t.length)throw new Error(`Got nextValueRowId=${f} which is not less than ${t.length}`);u=t[f]}i.push(u)}if(i.length!==e.length)throw new Error("Invalid row ids.");return i}calculateOutputIndex(e,t,s,r){const o=this.getRowPartitionTensor(e),i=this.getRowPartitionTypeByDimension(e);switch(i){case tr.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(o,t,s,r);case tr.ROW_SPLITS:if(o.length-1>t.length)throw new Error(`Row partition size is greater than output size: ${o.length-1} > ${t.length}`);return this.calculateOutputIndexRowSplit(o,t,s,r);default:throw new Error(`Unsupported partition type: ${tr[i]}`)}}getFirstDimensionSize(){const e=this.rowPartitionValues[0];if(this.rowPartitionTypes.length===0)throw new Error("No row_partition_types given.");const t=this.rowPartitionTypes[0];switch(t){case tr.FIRST_DIM_SIZE:return e[0];case tr.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case tr.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error(`Cannot handle type ${tr[t]}`)}}compute(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");const t=this.getFirstDimensionSize(),s=this.calculateOutputSize(t),r=new Array(this.raggedRank+1);r[r.length-1]=1;for(let l=r.length-2;l>=0;--l)r[l]=r[l+1]*s[l+1];const o=RC(s,!1),i=Qt(this.valuesDType,pe(o));if(r[0]*s[0]>0){let l=this.calculateFirstParentOutputIndex(t,r[0],s[0]);for(let u=1;u<=this.raggedRank;++u)l=this.calculateOutputIndex(u-1,l,r[u],s[u]);this.setOutput(this.raggedRank,l,i,o)}return[o,i]}setOutput(e,t,s,r){if(s.length===0)return;const o=this.values,i=s;let a=r.slice();a=a.slice(e+1);const l=pe(a),u=t.length;let d=this.defaultValue;if(d.length!==l&&d.length!==1){const y=this.defaultValueShape;le(()=>{const w=re(d,y);d=nu(w,a).dataSync()})}let f=0,m=0,g=0;for(let y=0;y<=u;++y){let w=y<u?t[y]:-1;if(w===g){++g;continue}if(m<g){const b=o.subarray(f*l),k=i.subarray(m*l),v=(g-m)*l;EC(k,b,v)}if(y>=u){const b=s.length;w=Math.floor(b/l)}if(w>g)if(this.defaultValue.length===1)i.subarray(g*l,w*l).fill(this.defaultValue[0]),g=w;else for(;w>g;){const b=i.slice(g*l);EC(b,d,l),++g}w<0?(f=y+1,m=g):(f=y,m=g,g=m+1)}}}function EC(n,e,t){for(let s=0;s<t;s++)n[s]=e[s]}function RC(n,e){const t=[];for(let s of n){if(s<0){if(!e)throw new Error(`Dimension ${s} must be >= 0`);if(s<-1)throw new Error(`Dimension ${s} must be >= -1`);s=-1}t.push(s)}return t}function cR(n,e,t,s,r,o,i,a,l,u){return new op(n,e,t,s,r,o,i,a,l,u).compute()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uR(n,e,t,s){const r=n===e,o=n<e&&t<0,i=e<n&&t>1;if(r||o||i)return zn(0,s);const a=Math.abs(Math.ceil((e-n)/t)),l=zn(a,s);e<n&&t===1&&(t=-1),l[0]=n;for(let u=1;u<l.length;u++)l[u]=l[u-1]+t;return l}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dR=oo(n=>1/Math.sqrt(n)),DW=ki(ld,dR),MW={kernelName:ld,backendName:"cpu",kernelFunc:DW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hi(n,e,t,s,r,o,i,a,l,u){const d=[s/r,r],f=n.values,m=e.values;if(s===0)return st(t,e.dtype);const g=l instanceof Rn?l:st(d,e.dtype);typeof l=="string"||typeof l=="number"?g.values.fill(l):typeof l=="boolean"&&g.values.fill(+l);for(let y=0;y<o;y++){const w=[];let b=0;for(let k=0;k<i;k++){const v=f[y*i+k];w.push(v),b+=v*a[k]}if(b<0||b>=s/r)throw new Error(`Invalid indices: ${w} does not index into ${t}`);for(let k=0;k<r;k++)u?g.values[b*r+k]+=m[y*r+k]:g.values[b*r+k]=e.rank===0?m[0]:m[y*r+k]}return g}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PW=oo(n=>1/(1+Math.exp(-n))),hR=wt(fd,n=>1/(1+Math.exp(-n))),FW={kernelName:fd,backendName:"cpu",kernelFunc:hR};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fR(n,e,t,s,r){const o=tv(s,e,t),i=pe(t),a=Ve(s);if(o){const f=nv(e,a);return r==="string"?n.slice(f,f+i):n.subarray(f,f+i)}const l=r==="string"?No(n):n,u=st(s,r,l),d=st(t,r);for(let f=0;f<d.size;++f){const m=d.indexToLoc(f),g=m.map((y,w)=>y+e[w]);d.set(u.get(...g),...m)}return r==="string"?g$(d.values):d.values}function da(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{begin:o,size:i}=s;Fe(r,"slice");const[a,l]=Dm(r,o,i);Z1(r,a,l);const u=t.data.get(r.dataId).values,d=fR(u,a,l,r.shape,r.dtype);return t.makeTensorInfo(l,r.dtype,d)}const LW={kernelName:mm,backendName:"cpu",kernelFunc:da};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pR(n,e,t,s,r,o,i){const a=e[0],l=o[0],u=new Array(l),d=new Array(a),f=e[1];if(l===0){if(a!==0)throw new Error(s$(a));const b=Qt(t,0),k=Qt(r,0);return[b,[0,f],k,u,d]}let m=!0,g=0;const y=new Array(l).fill(0);for(let b=0;b<a;++b){const k=n[b*f];if(k<0)throw new Error(r$(b,k));if(k>=l)throw new Error(o$(b,k,l));++y[k],m=m&&k>=g,g=k}let w=!0;for(let b=0;b<l;++b){const k=y[b]===0;u[b]=k,w=w&&!k,y[b]=Math.max(y[b],1),b>0&&(y[b]+=y[b-1])}if(w&&m){const b=n,k=s;for(let v=0;v<a;++v)d[v]=v;return[b,[a,f],k,u,d]}else{const b=y[l-1],k=Qt(t,b*f),v=Qt(r,b),N=new Array(l).fill(0);for(let S=0;S<a;++S){const $=n[S*f],R=N[$],M=($===0?0:y[$-1])+R;N[$]++;for(let A=0;A<f;++A)k[M*f+A]=n[S*f+A];v[M]=s[S],d[S]=M}for(let S=0;S<l;++S)if(N[S]===0){const R=S===0?0:y[S-1];k[R*f+0]=S;for(let M=1;M<f;++M)k[R*f+M]=0;v[R]=i}return[k,[b,f],v,u,d]}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mR(n,e,t,s,r){const o=pe(s),i=e[0],a=r.length,l=[];let u=1,d=-1;for(let b=0;b<a;++b){const k=r[b];if(k===-1){if(d!==-1)throw new Error(i$(d,b));d=b,l.push(1)}else{if(k<0)throw new Error(a$(b,k));u*=k,l.push(k)}}if(d!==-1){if(u<=0)throw new Error(l$());const b=Math.trunc(o/u);if(u*b!==o)throw new Error(c$(s,l));l[d]=b}if(pe(l)!==o)throw new Error(u$(s,l));const m=s.length,g=[];if(m>0){g[m-1]=1;for(let b=m-2;b>=0;--b)g[b]=g[b+1]*s[b+1]}const y=[];if(a>0){y[a-1]=1;for(let b=a-2;b>=0;--b)y[b]=y[b+1]*l[b+1]}const w=Qt(t,i*a);for(let b=0;b<i;++b){let k=0;for(let v=0;v<m;++v)k+=n[b*m+v]*g[v];for(let v=0;v<a;++v)w[b*a+v]=Math.trunc(k/y[v]),k%=y[v]}return[w,[i,a],l]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xv(n,e,t,s,r,o=!1,i=0){const a=s.length,l=[e[0],n.length/e[0]],u=l[1],f=a>0?r[a-1]+1:0;if(f<0)throw new Error(J0());const m=e.slice();m[0]=f;const g=m.reduce((N,S)=>N*S,1),y=Qt(t,g);if(a===0)return f>0&&y.fill(i),[y,m];if(f<=0)throw new Error(J0());let w=0,b=1,k=0,v=r[w];for(;;){let N=0;if(b<a){if(N=r[b],v===N){++b;continue}if(v>=N)throw new Error(d$())}if(v<0||v>=f)throw new Error(h$(v,f));v>k&&y.fill(i,k*u,v*u);for(let S=w;S<b;++S){const $=s[S];if($<0||$>=l[0])throw new Error(f$(S,s[S],l[0]));for(let R=0;R<u;R++)y[v*u+R]+=n[$*u+R]}if(o)for(let S=0;S<u;S++)y[v*u+S]/=b-w;if(w=b,++b,k=v+1,v=N,b>a)break}return k<f&&y.fill(i,k*u,f*u),[y,m]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jW=oo(n=>Math.sqrt(n)),OW=wt(md,n=>Math.sqrt(n)),_W={kernelName:md,backendName:"cpu",kernelFunc:OW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gR=tn(((n,e)=>{const t=n-e;return t*t})),zW=gn(gd,gR),BW={kernelName:gd,backendName:"cpu",kernelFunc:zW};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xR=oo((n,e)=>{const{pattern:t,replaceGlobal:s,rewrite:r}=e;return n.replace(new RegExp(t,s?"g":""),r)}),VW=ki(h1,xR),WW={kernelName:h1,backendName:"cpu",kernelFunc:VW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yR(n,e,t,s){const r=st(n,e.dtype);for(let o=0;o<r.size;o++){const i=r.indexToLoc(o),a=new Array(i.length);for(let l=0;l<a.length;l++)a[l]=i[l]*t[l]+s[l];r.set(e.get(...a),...i)}return r}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class UW{constructor(e,t,s,r,o,i){this.separator=ri(e),this.nGramWidths=t,this.leftPad=ri(s),this.rightPad=ri(r),this.padWidth=o,this.preserveShort=i}getPadWidth(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)}getNumNGrams(e,t){const s=this.getPadWidth(t);return Math.max(0,e+2*s-t+1)}createNGrams(e,t,s,r,o,i){for(let a=0;a<o;++a){const l=this.getPadWidth(i),u=Math.max(0,l-a),d=Math.max(0,l-(o-(a+1))),f=i-(u+d),m=t+(u>0?0:a-l);let g=0;g+=u*this.leftPad.length;for(let v=0;v<f;++v)g+=e[m+v].length;g+=d*this.rightPad.length;const y=u+d+f-1;g+=y*this.separator.length,s[r+a]=new Uint8Array(g);const w=s[r+a];let b=0;const k=v=>v.forEach(N=>w[b++]=N);for(let v=0;v<u;++v)k(this.leftPad),k(this.separator);for(let v=0;v<f-1;++v)k(e[m+v]),k(this.separator);if(f>0){k(e[m+f-1]);for(let v=0;v<d;++v)k(this.separator),k(this.rightPad)}else{for(let v=0;v<d-1;++v)k(this.rightPad),k(this.separator);k(this.rightPad)}}}compute(e,t){const s=e.length,r=t.length;if(r>0){let l=t[0];if(l!==0)throw new Error(`First split value must be 0, got ${l}`);for(let u=1;u<r;++u){let d=t[u]>=l;if(d=d&&t[u]<=s,!d)throw new Error(`Invalid split value ${t[u]}, must be in [${l}, ${s}]`);l=t[u]}if(l!==s)throw new Error(`Last split value must be data size. Expected ${s}, got ${l}`)}const o=r-1,i=Qt("int32",r);if(s===0||r===0){const l=new Array(s);for(let u=0;u<=o;++u)i[u]=0;return[l,i]}i[0]=0;for(let l=1;l<=o;++l){const u=t[l]-t[l-1];let d=0;this.nGramWidths.forEach(f=>{d+=this.getNumNGrams(u,f)}),this.preserveShort&&u>0&&d===0&&(d=1),i[l]=i[l-1]+d}const a=new Array(i[o]);for(let l=0;l<o;++l){const u=t[l];let d=i[l];if(this.nGramWidths.forEach(f=>{const m=t[l+1]-t[l],g=this.getNumNGrams(m,f);this.createNGrams(e,u,a,d,g,f),d+=g}),this.preserveShort&&d===i[l]){const f=t[l+1]-t[l];if(f===0)continue;const m=f+2*this.padWidth;this.createNGrams(e,u,a,d,1,m)}}return[a,i]}}function vR(n,e,t,s,r,o,i,a){return new UW(t,s,r,o,i,a).compute(n,e)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GW(n,e,t,s){if(!n.length)return;if(e.length===0){for(let o=0;o<n.length;++o)s.push(n.subarray(o,o+1));return}if(e.length===1){const o=e[0];let i=n.indexOf(o);for(;i!==-1;){const a=n.subarray(0,i);(!t||a.length!==0)&&s.push(a),n=n.subarray(i+1),i=n.indexOf(o)}(!t||n.length!==0)&&s.push(n);return}let r=0;for(let o=0;o<n.length+1;o++)if(o===n.length||e.indexOf(n[o])!==-1){const i=n.subarray(r,o);(!t||i.length!==0)&&s.push(i),r=o+1}}function bR(n,e,t){const s=n.length,r=[];let o=0,i=0;const a=new Array(s);for(let m=0;m<s;++m){const g=r.length;GW(n[m],e,t,r);const y=r.length-g;a[m]=y,o+=y,i=Math.max(i,y)}const l=Qt("int32",o*2),u=new Array(o),d=[s,i];let f=0;for(let m=0;m<s;++m)for(let g=0;g<a[m];++g)l[f*2]=m,l[f*2+1]=g,u[f]=r[f],++f;return[l,u,d]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wR(n,e){const t=Qt("int32",n.length);for(let s=0;s<n.length;++s)t[s]=eP(n[s]).modulo(e).getLowBitsUnsigned();return t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kR=tn(((n,e)=>n-e)),HW=Gv(((n,e,t,s)=>({real:n-t,imag:e-s}))),Qv=gn(xd,kR,HW),qW={kernelName:xd,backendName:"cpu",kernelFunc:Qv};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CR(n,e){const t=new Array(n.rank);for(let r=0;r<t.length;r++)t[r]=n.shape[r]*e[r];const s=st(t,n.dtype);for(let r=0;r<s.values.length;++r){const o=s.indexToLoc(r),i=new Array(n.rank);for(let l=0;l<i.length;l++)i[l]=o[l]%n.shape[l];const a=n.locToIndex(i);s.values[r]=n.values[a]}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yc=(n,e)=>{const t=e.value-n.value;return t===0?n.index-e.index:t};function SR(n,e,t=0,s=n.length-1){for(;s>t;){if(s-t>600){const a=s-t+1,l=e-t+1,u=Math.log(a),d=.5*Math.exp(2*u/3),f=.5*Math.sqrt(u*d*(a-d)/a)*Math.sign(l-a/2),m=Math.max(t,Math.floor(e-l*d/a+f)),g=Math.min(s,Math.floor(e+(a-l)*d/a+f));SR(n,e,m,g)}const r=n[e];let o=t,i=s;for(sl(n,t,e),Yc(n[s],r)>0&&sl(n,t,s);o<i;){for(sl(n,o,i),o++,i--;Yc(n[o],r)<0;)o=o+1;for(;Yc(n[i],r)>0;)i=i-1}Yc(n[t],r)===0?sl(n,t,i):(i=i+1,sl(n,i,s)),i<=e&&(t=i+1),e<=i&&(s=i-1)}}function NR(n,e,t,s,r){const o=e[e.length-1],[i,a]=[n.length/o,o],l=_n(t,i*s),u=_n("int32",i*s);for(let f=0;f<i;f++){const m=f*a,g=n.subarray(m,m+a);let y=new Array(g.length);g.forEach((v,N)=>y[N]={value:v,index:N}),s<y.length&&(SR(y,s),y=y.slice(0,s)),r&&y.sort(Yc);const w=f*s,b=l.subarray(w,w+s),k=u.subarray(w,w+s);for(let v=0;v<s;v++)b[v]=y[v].value,k[v]=y[v].index}const d=e.slice();return d[d.length-1]=s,[st(d,t,l),st(d,"int32",u)]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IR(n,e,t,s){const r=rt(e,t)[0],o=[1,t[0],1];for(let y=0;y<r;y++)o[0]*=t[y];o[1]=t[r];for(let y=r+1;y<t.length;y++)o[2]*=t[y];const i=new Map,a=new Int32Array(t[r]),l=new Rn(o,s,n),u=[],d=o[0]===1&&o[2]===1;for(let y=0;y<t[r];y++){let w;if(d)w=n[y].toString();else{const k=[];for(let v=0;v<o[0];v++)for(let N=0;N<o[2];N++)k.push(l.get(v,y,N));w=k.join(",")}const b=i.get(w);if(b!=null)a[y]=b;else{const k=i.size;i.set(w,k),a[y]=k,u.push(y)}}const f=o.slice();f[1]=i.size;const m=new Rn(f,s);u.forEach((y,w)=>{for(let b=0;b<o[0];b++)for(let k=0;k<o[2];k++)m.set(l.get(b,y,k),b,w,k)});const g=t.slice();return g[r]=f[1],{outputValues:m.values,outputShape:g,indices:a}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KW=Object.freeze(Object.defineProperty({__proto__:null,addImpl:FE,bincountImpl:Hv,bincountReduceImpl:LE,bitwiseAndImpl:jE,castImpl:PE,ceilImpl:OE,concatImpl:_E,equalImpl:zE,expImpl:VE,expm1Impl:UE,floorDivImpl:HE,floorImpl:GE,gatherNdImpl:qE,gatherV2Impl:KE,greaterEqualImpl:QE,greaterImpl:XE,lessEqualImpl:JE,lessImpl:YE,linSpaceImpl:ZE,logImpl:eR,maxImpl:tR,maximumImpl:nR,minimumImpl:sR,multiplyImpl:qv,negImpl:rR,notEqualImpl:oR,prodImpl:iR,raggedGatherImpl:aR,raggedRangeImpl:lR,raggedTensorToTensorImpl:cR,rangeImpl:uR,rsqrtImpl:dR,scatterImpl:Hi,sigmoidImpl:PW,simpleAbsImpl:ME,sliceImpl:fR,sparseFillEmptyRowsImpl:pR,sparseReshapeImpl:mR,sparseSegmentReductionImpl:Xv,sqrtImpl:jW,squaredDifferenceImpl:gR,staticRegexReplaceImpl:xR,stridedSliceImpl:yR,stringNGramsImpl:vR,stringSplitImpl:bR,stringToHashBucketFastImpl:wR,subImpl:kR,tileImpl:CR,topKImpl:NR,transposeImpl:Kv,uniqueImpl:IR},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */GN("cpu",()=>new qm,1);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $R=wt(zu,n=>n>=0?n:Math.exp(n)-1),XW={kernelName:zu,backendName:"cpu",kernelFunc:$R};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TR(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{alpha:o}=s;Fe([r],"leakyRelu");const i=pe(r.shape),a=t.data.get(r.dataId).values,l=_n("float32",i);for(let u=0;u<a.length;u++)l[u]=a[u]<0?o*a[u]:a[u];return t.makeTensorInfo(r.shape,"float32",l)}const QW={kernelName:Wp,backendName:"cpu",kernelFunc:TR};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YW=tn((n,e)=>n<0?e*n:n);function ER(n){const{inputs:e,backend:t}=n,{x:s,alpha:r}=e;Fe([s,r],"prelu");const o=t.data.get(s.dataId).values,i=t.data.get(r.dataId).values,[a,l]=YW(s.shape,r.shape,o,i,"float32");return t.makeTensorInfo(l,"float32",a)}const JW={kernelName:lm,backendName:"cpu",kernelFunc:ER};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RR=wt(od,n=>Math.max(0,n)),ZW={kernelName:od,backendName:"cpu",kernelFunc:RR};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AR=wt(id,n=>Math.min(Math.max(0,n),6)),eU={kernelName:id,backendName:"cpu",kernelFunc:AR};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ip(n,e,t,s,r){if(t==="linear")return so({inputs:{x:e},backend:n});if(t==="relu")return RR({inputs:{x:e},backend:n});if(t==="elu")return $R({inputs:{x:e},backend:n});if(t==="relu6")return AR({inputs:{x:e},backend:n});if(t==="prelu")return ER({inputs:{x:e,alpha:s},backend:n});if(t==="leakyrelu")return TR({inputs:{x:e},backend:n,attrs:{alpha:r}});if(t==="sigmoid")return hR({inputs:{x:e},backend:n});throw new Error(`Activation ${t} has not been implemented for the CPU backend.`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tt(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{shape:o}=s,i=pe(r.shape),a=tN(o,i),l=pe(a);_(i===l,()=>`The new shape (${a}) has ${l} elements and the old shape (${r.shape}) has ${i} elements. The new shape and old shape must have the same number of elements.`),t.incRef(r.dataId);const u=t.data.get(r.dataId);if(u.complexTensorInfos!=null){const d=u.complexTensorInfos.real,f=u.complexTensorInfos.imag;d.shape=a,f.shape=a}return{dataId:r.dataId,shape:a,dtype:r.dtype}}const tU={kernelName:um,backendName:"cpu",kernelFunc:Tt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DR(n){const{inputs:e,backend:t,attrs:s}=n,{a:r,b:o}=e,{transposeA:i,transposeB:a}=s;Fe([r,o],"matMul");const l=r.shape.length,u=o.shape.length,d=i?r.shape[l-2]:r.shape[l-1],f=a?o.shape[u-1]:o.shape[u-2],m=i?r.shape[l-1]:r.shape[l-2],g=a?o.shape[u-2]:o.shape[u-1],y=r.shape.slice(0,-2),w=o.shape.slice(0,-2),b=pe(y),k=pe(w),N=Ze(r.shape.slice(0,-2),o.shape.slice(0,-2)).concat([m,g]);_(d===f,()=>`Error in matMul: inner shapes (${d}) and (${f}) of Tensors with shapes ${r.shape} and ${o.shape} and transposeA=${i} and transposeB=${a} must match.`);const S=i?[b,d,m]:[b,m,d],$=a?[k,g,f]:[k,f,g],R=Tt({inputs:{x:r},backend:t,attrs:{shape:S}}),M=Tt({inputs:{x:o},backend:t,attrs:{shape:$}}),A=i?R.shape[1]:R.shape[2],P=i?R.shape[2]:R.shape[1],D=a?M.shape[1]:M.shape[2],E=Math.max(b,k),j=t.data.get(R.dataId).values,V=t.data.get(M.dataId).values,W=Ve(R.shape),U=Ve(M.shape),[X,ee,G]=i?[W[0],1,W[1]]:[W[0],W[1],1],[z,H,O]=a?[1,U[1],U[0]]:[U[1],1,U[0]],B=P*D,Y=st([E,P,D],R.dtype),oe=Y.values,Q=t.blockSize;for(let ce=0;ce<E;ce++){const me=ce%b,ge=ce%k;for(let ve=0;ve<P;ve+=Q){const Ne=Math.min(ve+Q,P);for(let Me=0;Me<D;Me+=Q){const Ue=Math.min(Me+Q,D);for(let Qe=0;Qe<A;Qe+=Q){const ye=Math.min(Qe+Q,A);for(let Ce=ve;Ce<Ne;Ce++)for(let be=Me;be<Ue;be++){let xe=0;for(let Be=Qe;Be<ye;Be++){const Dt=j[me*X+Ce*ee+Be*G],at=V[Be*z+be*H+ge*O];xe+=Dt*at}oe[ce*B+(Ce*D+be)]+=xe}}}}}return t.disposeIntermediateTensorInfo(R),t.disposeIntermediateTensorInfo(M),t.makeTensorInfo(N,Y.dtype,Y.values)}const nU={kernelName:Tp,backendName:"cpu",kernelFunc:DR};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sU(n){const{inputs:e,backend:t,attrs:s}=n,{a:r,b:o,bias:i,preluActivationWeights:a}=e,{transposeA:l,transposeB:u,activation:d,leakyreluAlpha:f}=s;let m,g,y;const w=[];m=DR({inputs:{a:r,b:o},attrs:{transposeA:l,transposeB:u},backend:t}),i&&(g=Il({inputs:{a:m,b:i},backend:t}),w.push(m),m=g),d&&(y=ip(t,m,d,a,f),w.push(m),m=y);for(const k of w)t.disposeIntermediateTensorInfo(k);return m}const rU={kernelName:Of,backendName:"cpu",kernelFunc:sU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oU=wt($u,n=>Math.acos(n)),iU={kernelName:$u,backendName:"cpu",kernelFunc:oU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aU=wt(Tu,n=>Math.acosh(n)),lU={kernelName:Tu,backendName:"cpu",kernelFunc:aU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cU(n){const{inputs:e,backend:t}=n,s=e;Fe(e,"addN");const r=s.map(a=>t.data.get(a.dataId).values),o=st(s[0].shape,s[0].dtype),i=o.values;for(let a=0;a<s.length;a++){const l=r[a];for(let u=0;u<i.length;u++)i[u]+=l[u]}return t.makeTensorInfo(o.shape,o.dtype,o.values)}const uU={kernelName:Ay,backendName:"cpu",kernelFunc:cU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dU(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,keepDims:i}=s;Fe(r,"all");const a=rt(o,r.shape);let l=a;const u=Bt(l,r.shape.length);let d=r;u!=null&&(d=ys({inputs:{x:r},backend:t,attrs:{perm:u}}),l=Zt(l.length,r.shape.length)),Dn("all",l,d.shape.length);const[f,m]=Sn(d.shape,l),g=pe(m),y=zn(pe(f),d.dtype),w=t.data.get(d.dataId).values;for(let k=0;k<y.length;++k){const v=k*g;let N=w[v];for(let S=0;S<g;++S){const $=w[v+S];N=N&&$}y[k]=N}u!=null&&t.disposeIntermediateTensorInfo(d);const b=t.makeTensorInfo(f,d.dtype,y);if(i){const k=an(f,a),v=Tt({inputs:{x:b},backend:t,attrs:{shape:k}});return t.disposeIntermediateTensorInfo(b),v}return b}const hU={kernelName:Dy,backendName:"cpu",kernelFunc:dU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fU(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,keepDims:i}=s;Fe(r,"any");const a=rt(o,r.shape);let l=a;const u=Bt(l,r.shape.length);let d=r;u!=null&&(d=ys({inputs:{x:r},backend:t,attrs:{perm:u}}),l=Zt(l.length,r.shape.length)),Dn("any",l,d.shape.length);const[f,m]=Sn(d.shape,l),g=pe(m),y=zn(pe(f),d.dtype),w=t.data.get(d.dataId).values;for(let k=0;k<y.length;++k){const v=k*g;let N=w[v];for(let S=0;S<g;++S){const $=w[v+S];N=N||$}y[k]=N}u!=null&&t.disposeIntermediateTensorInfo(d);const b=t.makeTensorInfo(f,d.dtype,y);if(i){const k=an(f,a),v=Tt({inputs:{x:b},backend:t,attrs:{shape:k}});return t.disposeIntermediateTensorInfo(b),v}return b}const pU={kernelName:My,backendName:"cpu",kernelFunc:fU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mU(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o}=s;Fe(r,"argMax");let i=rt(o,r.shape);const a=Bt(i,r.shape.length);let l=r;const u=[];a!=null&&(l=ys({inputs:{x:r},backend:t,attrs:{perm:a}}),u.push(l),i=Zt(i.length,l.shape.length)),i=[i[0]],Dn("argMax",i,l.shape.length);const[d,f]=Sn(l.shape,i),m=pe(d),g=zn(m,"int32"),y=pe(f),w=t.data.get(l.dataId).values;for(let b=0;b<g.length;++b){const k=b*y;let v=w[k],N=0;for(let S=0;S<y;++S){const $=w[k+S];$>v&&(v=$,N=S)}g[b]=N}return u.forEach(b=>t.disposeIntermediateTensorInfo(b)),t.makeTensorInfo(d,"int32",g)}const gU={kernelName:Sp,backendName:"cpu",kernelFunc:mU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xU(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o}=s;Fe(r,"argMin");let i=rt(o,r.shape);const a=Bt(i,r.shape.length);let l=r;const u=[];a!=null&&(l=ys({inputs:{x:r},backend:t,attrs:{perm:a}}),u.push(l),i=Zt(i.length,l.shape.length)),i=[i[0]],Dn("argMin",i,l.shape.length);const[d,f]=Sn(l.shape,i),m=pe(d),g=zn(m,"int32"),y=pe(f),w=t.data.get(l.dataId).values;for(let b=0;b<g.length;++b){const k=b*y;let v=w[k],N=0;for(let S=0;S<y;++S){const $=w[k+S];$<v&&(v=$,N=S)}g[b]=N}return u.forEach(b=>t.disposeIntermediateTensorInfo(b)),t.makeTensorInfo(d,"int32",g)}const yU={kernelName:Np,backendName:"cpu",kernelFunc:xU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vU=wt(Eu,n=>Math.asin(n)),bU={kernelName:Eu,backendName:"cpu",kernelFunc:vU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wU=wt(Ru,n=>Math.asinh(n)),kU={kernelName:Ru,backendName:"cpu",kernelFunc:wU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CU=wt(Au,n=>Math.atan(n)),SU={kernelName:Au,backendName:"cpu",kernelFunc:CU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NU=tn((n,e)=>Math.atan2(n,e)),IU=gn(Mu,NU),$U={kernelName:Mu,backendName:"cpu",kernelFunc:IU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TU=wt(Du,n=>Math.atanh(n)),EU={kernelName:Du,backendName:"cpu",kernelFunc:TU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yv(n,e,t,s,r,o){const i=r.strideHeight,a=r.strideWidth,l=r.dilationHeight,u=r.dilationWidth,d=r.effectiveFilterHeight,f=r.effectiveFilterWidth,m=r.padInfo.top,g=r.padInfo.left,y=o==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,w=st(r.outShape,t),b=w.values,k=r.outShape[1]*r.outShape[2]*r.outShape[3],v=r.outShape[2]*r.outShape[3],N=r.outShape[3];for(let S=0;S<r.batchSize;++S){const $=S*k,R=S*s[0];for(let M=0;M<r.inChannels;++M)for(let A=0;A<r.outHeight;++A){const P=A*i-m,D=Math.max(0,P),E=Math.min(r.inHeight,d+P),j=$+A*v;for(let V=0;V<r.outWidth;++V){const W=V*a-g,U=Math.max(0,W),X=Math.min(r.inWidth,f+W);let ee=y,G=0,z=0;for(let O=D;O<E;O+=l){const B=R+O*s[1];for(let Y=U;Y<X;Y+=u){const oe=B+Y*s[2],Q=n[oe+M];o==="max"&&Q>ee?ee=Q:o==="avg"&&(G+=Q,z++)}if(isNaN(ee))break}const H=j+V*N+M;b[H]=o==="avg"?G/z:ee}}}return w}function MR(n,e,t,s,r=!1,o=!1){const i=st(s.outShape,"int32"),a=s.strideHeight,l=s.strideWidth,u=s.dilationHeight,d=s.dilationWidth,f=s.effectiveFilterHeight,m=s.effectiveFilterWidth,g=s.padInfo.top,y=s.padInfo.left,w=st(e,t,n);for(let b=0;b<s.batchSize;++b)for(let k=0;k<s.inChannels;++k)for(let v=0;v<s.outHeight;++v){const N=v*a-g;let S=N;for(;S<0;)S+=u;const $=Math.min(s.inHeight,f+N);for(let R=0;R<s.outWidth;++R){const M=R*l-y;let A=M;for(;A<0;)A+=d;const P=Math.min(s.inWidth,m+M);let D=Number.NEGATIVE_INFINITY,E=-1;for(let j=S;j<$;j+=u){const V=j-N;for(let W=A;W<P;W+=d){const U=W-M,X=w.get(b,j,W,k);X>D&&(D=X,r?E=o?((b*s.inHeight+j)*s.inWidth+W)*s.inChannels+k:(j*s.inWidth+W)*s.inChannels+k:E=V*m+U)}}i.set(E,b,v,R,k)}}return i}function PR(n,e,t,s,r,o){const i=r.strideDepth,a=r.strideHeight,l=r.strideWidth,u=r.dilationDepth,d=r.dilationHeight,f=r.dilationWidth,m=r.effectiveFilterDepth,g=r.effectiveFilterHeight,y=r.effectiveFilterWidth,w=r.padInfo.front,b=r.padInfo.top,k=r.padInfo.left,v=o==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,N=st(r.outShape,t),S=N.values,$=r.outShape[1]*r.outShape[2]*r.outShape[3]*r.outShape[4],R=r.outShape[2]*r.outShape[3]*r.outShape[4],M=r.outShape[3]*r.outShape[4],A=r.outShape[4];for(let P=0;P<r.batchSize;++P){const D=P*$,E=P*s[0];for(let j=0;j<r.inChannels;++j)for(let V=0;V<r.outDepth;++V){const W=V*i-w;let U=W;for(;U<0;)U+=u;const X=Math.min(r.inDepth,m+W),ee=D+V*R;for(let G=0;G<r.outHeight;++G){const z=G*a-b;let H=z;for(;H<0;)H+=d;const O=Math.min(r.inHeight,g+z),B=ee+G*M;for(let Y=0;Y<r.outWidth;++Y){const oe=Y*l-k;let Q=oe;for(;Q<0;)Q+=f;const ce=Math.min(r.inWidth,y+oe),me=B+Y*A;let ge=v,ve=0,Ne=0;for(let Ue=U;Ue<X;Ue+=u){const Qe=E+Ue*s[1];for(let ye=H;ye<O;ye+=d){const Ce=Qe+ye*s[2];for(let be=Q;be<ce;be+=f){const xe=Ce+be*s[3],Be=n[xe+j];if(o==="max"&&Be>ge?ge=Be:o==="avg"&&(ve+=Be,Ne++),isNaN(ge))break}if(isNaN(ge))break}if(isNaN(ge))break}const Me=me+j;S[Me]=o==="avg"?ve/Math.max(Ne,1):ge}}}}return N}function RU(n,e){const t=st(e.outShape,"int32"),s=e.strideDepth,r=e.strideHeight,o=e.strideWidth,i=e.dilationDepth,a=e.dilationHeight,l=e.dilationWidth,u=e.effectiveFilterDepth,d=e.effectiveFilterHeight,f=e.effectiveFilterWidth,m=e.padInfo.front,g=e.padInfo.top,y=e.padInfo.left;for(let w=0;w<e.batchSize;++w)for(let b=0;b<e.inChannels;++b)for(let k=0;k<e.outDepth;++k){const v=k*s-m;let N=v;for(;N<0;)N+=i;const S=Math.min(e.inDepth,u+v);for(let $=0;$<e.outHeight;++$){const R=$*r-g;let M=R;for(;M<0;)M+=a;const A=Math.min(e.inHeight,d+R);for(let P=0;P<e.outWidth;++P){const D=P*o-y;let E=D;for(;E<0;)E+=l;const j=Math.min(e.inWidth,f+D);let V=Number.NEGATIVE_INFINITY,W=-1;for(let U=N;U<S;U+=i){const X=U-v;for(let ee=M;ee<A;ee+=a){const G=ee-R;for(let z=E;z<j;z+=l){const H=z-D,O=n.get(w,U,ee,z,b);O>=V&&(V=O,W=X*d*f+G*d+H)}}}t.set(W,w,k,$,P,b)}}}return t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AU(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e;Fe(r,"avgPool");const{filterSize:o,strides:i,pad:a,dimRoundingMode:l}=s,u=1;_(Vn(i,u),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${u}'`);const d=ur(r.shape,o,i,u,a,l);let f;if(d.filterWidth===1&&d.filterHeight===1&&xt(d.inShape,d.outShape))f=so({inputs:{x:r},backend:t});else{const m=t.data.get(r.dataId).values,g=Ve(r.shape),y=Yv(m,r.shape,r.dtype,g,d,"avg");f=t.makeTensorInfo(d.outShape,r.dtype,y.values)}return f}const DU={kernelName:Ip,backendName:"cpu",kernelFunc:AU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MU(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{filterSize:o,strides:i,pad:a,dimRoundingMode:l,dataFormat:u}=s;Fe(r,"avgPool3d");const d=$o(r.shape,o,i,1,a,l,u),f=t.data.get(r.dataId).values,m=PR(f,r.shape,r.dtype,Ve(r.shape),d,"avg");return t.makeTensorInfo(m.shape,"float32",m.values)}const PU={kernelName:$p,backendName:"cpu",kernelFunc:MU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FU(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:o}=e,{filterSize:i,strides:a,pad:l,dimRoundingMode:u}=s;Fe([r,o],"avgPool3DGrad");const d=$o(o.shape,i,a,1,l,u),f=d.strideDepth,m=d.strideHeight,g=d.strideWidth,y=d.filterDepth,w=d.filterHeight,b=d.filterWidth,k=d.dilationDepth,v=d.dilationHeight,N=d.dilationWidth,S=d.effectiveFilterDepth,$=d.effectiveFilterHeight,R=d.effectiveFilterWidth,M=S-1-d.padInfo.front,A=R-1-d.padInfo.left,P=$-1-d.padInfo.top,D=st(o.shape,"float32"),E=1/(y*w*b),j=t.bufferSync(r);for(let V=0;V<d.batchSize;++V)for(let W=0;W<d.inChannels;++W)for(let U=0;U<d.inDepth;++U)for(let X=0;X<d.inHeight;++X)for(let ee=0;ee<d.inWidth;++ee){const G=U-M,z=X-P,H=ee-A;let O=0;for(let B=0;B<S;B+=k){const Y=(G+B)/f;if(!(Y<0||Y>=d.outDepth||Math.floor(Y)!==Y))for(let oe=0;oe<$;oe+=v){const Q=(z+oe)/m;if(!(Q<0||Q>=d.outHeight||Math.floor(Q)!==Q))for(let ce=0;ce<R;ce+=N){const me=(H+ce)/g;if(me<0||me>=d.outWidth||Math.floor(me)!==me)continue;const ge=j.get(V,Y,Q,me,W);O+=ge}}}D.set(O*E,V,U,X,ee,W)}return t.makeTensorInfo(D.shape,D.dtype,D.values)}const LU={kernelName:Fy,backendName:"cpu",kernelFunc:FU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jU(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:o}=e,i=o;Fe([r,o],"avgPoolGrad");const{filterSize:a,strides:l,pad:u}=s,d=ur(i.shape,a,l,1,u),f=d.strideHeight,m=d.strideWidth,g=d.filterHeight,y=d.filterWidth,w=d.dilationHeight,b=d.dilationWidth,k=d.effectiveFilterHeight,v=d.effectiveFilterWidth,N=v-1-d.padInfo.left,S=k-1-d.padInfo.top,$=st(i.shape,"float32"),R=1/(g*y),M=t.data.get(r.dataId).values,A=st(r.shape,"float32",M);for(let P=0;P<d.batchSize;++P)for(let D=0;D<d.inChannels;++D)for(let E=0;E<d.inHeight;++E)for(let j=0;j<d.inWidth;++j){const V=E-S,W=j-N;let U=0;for(let X=0;X<k;X+=w){const ee=(V+X)/f;if(!(ee<0||ee>=d.outHeight||Math.floor(ee)!==ee))for(let G=0;G<v;G+=b){const z=(W+G)/m;if(z<0||z>=d.outWidth||Math.floor(z)!==z)continue;const H=A.get(P,ee,z,D);U+=H}}$.set(U*R,P,E,j,D)}return t.makeTensorInfo($.shape,$.dtype,$.values)}const OU={kernelName:Py,backendName:"cpu",kernelFunc:jU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _U(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,scale:o,offset:i,mean:a,variance:l}=e;_(a.shape.length===l.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),_(i==null||a.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),_(o==null||a.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks."),Fe([r,a,l,o,i],"batchNorm");let{varianceEpsilon:u}=s;u==null&&(u=.001);const d=t.data.get(r.dataId).values,f=t.data.get(a.dataId).values,m=t.data.get(l.dataId).values,g=o?t.data.get(o.dataId).values:new Float32Array([1]),y=i?t.data.get(i.dataId).values:new Float32Array([0]),w=new Float32Array(d.length),b=y.length,k=g.length,v=m.length,N=f.length;let S=0,$=0,R=0,M=0;for(let A=0;A<d.length;++A)w[A]=y[S++]+(d[A]-f[$++])*g[R++]/Math.sqrt(m[M++]+u),S>=b&&(S=0),$>=N&&($=0),R>=k&&(R=0),M>=v&&(M=0);return t.makeTensorInfo(r.shape,r.dtype,w)}const zU={kernelName:zp,backendName:"cpu",kernelFunc:_U};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BU(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockShape:o,crops:i}=s;Fe([r],"batchToSpaceND");const a=o.reduce((k,v)=>k*v),l=$d(r.shape,o,a),u=Td(l.length,o.length),d=Ed(r.shape,o,a),f=av(i,o.length),m=lv(d,i,o.length),g=Tt({inputs:{x:r},backend:t,attrs:{shape:l}}),y=ys({inputs:{x:g},backend:t,attrs:{perm:u}}),w=Tt({inputs:{x:y},backend:t,attrs:{shape:d}}),b=da({inputs:{x:w},backend:t,attrs:{begin:f,size:m}});return t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(w),b}const VU={kernelName:Ep,backendName:"cpu",kernelFunc:BU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WU(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,weights:o}=e,{size:i}=s,a=t.data.get(r.dataId).values,l=t.data.get(o.dataId).values,u=Hv(a,l,o.dtype,o.shape,i);return t.makeTensorInfo([i],o.dtype,u)}const UU={kernelName:Ly,backendName:"cpu",kernelFunc:WU};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GU(n){const{inputs:e,backend:t}=n,{s0:s,s1:r}=e,o=t.data.get(s.dataId).values,i=t.data.get(r.dataId).values,a=Ze(Array.from(o),Array.from(i));return t.makeTensorInfo([a.length],"int32",Int32Array.from(a))}const HU={kernelName:aN,backendName:"cpu",kernelFunc:GU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qU=wt(Lu,(n,e)=>{const t=e;return n>t.clipValueMax?t.clipValueMax:n<t.clipValueMin?t.clipValueMin:n}),KU={kernelName:Lu,backendName:"cpu",kernelFunc:qU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XU=n=>{const{x:e}=n.inputs,t=n.backend,s=new Float32Array(pe(e.shape)),r=t.data.get(e.dataId),o=r.complexTensorInfos.real,i=r.complexTensorInfos.imag,a=t.data.get(o.dataId).values,l=t.data.get(i.dataId).values;for(let u=0;u<a.length;u++){const d=a[u],f=l[u];s[u]=Math.hypot(d,f)}return t.makeOutput(s,e.shape,"float32")},QU={kernelName:Rp,backendName:"cpu",kernelFunc:XU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $l(n){const{inputs:e,backend:t}=n,{input:s}=e,r=t.data.get(s.dataId).complexTensorInfos.imag,o=t.data.get(r.dataId).values;return t.makeTensorInfo(r.shape,r.dtype,o)}const YU={kernelName:e1,backendName:"cpu",kernelFunc:$l};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tl(n){const{inputs:e,backend:t,attrs:s}=n,{axis:r}=s,o=rt(r,e[0].shape)[0],i=e.map(w=>w.shape);rv(i,o);let a=Xr(e.map(w=>w.shape),o);if(pe(a)===0)return t.makeTensorInfo(a,e[0].dtype,[]);const l=e.filter(w=>pe(w.shape)>0);if(l.length===1)return so({inputs:{x:l[0]},backend:t});if(l[0].dtype==="complex64"){const w=l.map(S=>ua({inputs:{input:S},backend:t})),b=l.map(S=>$l({inputs:{input:S},backend:t})),k=Tl({inputs:w,backend:t,attrs:{axis:o}}),v=Tl({inputs:b,backend:t,attrs:{axis:o}}),N=Rs({inputs:{real:k,imag:v},backend:t});return w.forEach(S=>t.disposeIntermediateTensorInfo(S)),b.forEach(S=>t.disposeIntermediateTensorInfo(S)),t.disposeIntermediateTensorInfo(k),t.disposeIntermediateTensorInfo(v),N}const u=l.map(w=>{const k=[-1,pe(w.shape.slice(o))];return Tt({inputs:{x:w},backend:t,attrs:{shape:k}})}),d=u.map(w=>({vals:t.data.get(w.dataId).values,shape:w.shape}));a=Xr(u.map(w=>w.shape),1);const f=u[0].shape[0]===1,m=_E(d,a,e[0].dtype,f),g=Xr(l.map(w=>w.shape),o),y=t.makeTensorInfo(g,e[0].dtype,m);return u.forEach(w=>t.disposeIntermediateTensorInfo(w)),y}const JU={kernelName:Ap,backendName:"cpu",kernelFunc:Tl};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FR(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:o}=e,{strides:i,pad:a,dataFormat:l,dilations:u,dimRoundingMode:d}=s;Fe([r,o],"conv2d");const f=To(l),m=An(r.shape,o.shape,i,u,a,d,!1,f),g=m.filterHeight,y=m.filterWidth,w=m.dilationHeight,b=m.dilationWidth,k=m.padInfo.left,v=m.padInfo.top,N=m.dataFormat==="channelsLast",S=new Rn(m.outShape,r.dtype),$=Ve(r.shape),R=Ve(o.shape),M=$[0],A=N?$[1]:$[2],P=N?$[2]:1,D=N?1:$[1],E=S.strides[0],j=N?S.strides[1]:S.strides[2],V=N?S.strides[2]:1,W=N?1:S.strides[1],U=t.data.get(r.dataId).values,X=t.data.get(o.dataId).values,ee=S.values;for(let G=0;G<m.batchSize;++G){const z=G*M,H=G*E;for(let O=0;O<m.outHeight;++O){const B=H+O*j,Y=O*m.strideHeight-v;for(let oe=0;oe<g;++oe){const Q=Y+oe*w;if(Q<0||Q>=m.inHeight)continue;const ce=oe*R[0],me=z+Q*A;for(let ge=0;ge<m.outWidth;++ge){const ve=B+ge*V,Ne=ge*m.strideWidth-k;for(let Me=0;Me<y;++Me){const Ue=Ne+Me*b;if(Ue<0||Ue>=m.inWidth)continue;const Qe=ce+Me*R[1],ye=me+Ue*P;let Ce=Qe;for(let be=0;be<m.inChannels;++be){const xe=U[ye+be*D];for(let Be=0;Be<m.outChannels;++Be)ee[ve+Be*W]+=xe*X[Ce+Be];Ce+=m.outChannels}}}}}}return t.makeTensorInfo(S.shape,S.dtype,ee)}const ZU={kernelName:Dp,backendName:"cpu",kernelFunc:FR};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eG(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:o}=e,{strides:i,pad:a,dataFormat:l,dimRoundingMode:u,filterShape:d}=s;Fe([r,o],"conv2dBackpropFilter");const f=To(l),m=An(r.shape,d,i,1,a,u,!1,f),{strideHeight:g,strideWidth:y,filterHeight:w,filterWidth:b}=m,k=m.dataFormat==="channelsLast",v=new Rn(m.filterShape,"float32"),N=m.padInfo.left,S=m.padInfo.top,$=t.data.get(r.dataId).values,R=t.data.get(o.dataId).values,M=new Rn(r.shape,r.dtype,$),A=new Rn(o.shape,o.dtype,R);for(let P=0;P<w;++P){const D=Math.max(0,Math.ceil((S-P)/g)),E=Math.min(m.outHeight,(m.inHeight+S-P)/g);for(let j=0;j<b;++j){const V=Math.max(0,Math.ceil((N-j)/y)),W=Math.min(m.outWidth,(m.inWidth+N-j)/y);for(let U=0;U<m.inChannels;++U)for(let X=0;X<m.outChannels;++X){let ee=0;for(let G=0;G<m.batchSize;++G)for(let z=D;z<E;++z){const H=P+z*g-S;for(let O=V;O<W;++O){const B=j+O*y-N;k?ee+=M.get(G,H,B,U)*A.get(G,z,O,X):ee+=M.get(G,U,H,B)*A.get(G,X,z,O)}}v.set(ee,P,j,U,X)}}}return t.makeTensorInfo(v.shape,v.dtype,v.values)}const tG={kernelName:_y,backendName:"cpu",kernelFunc:eG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nG(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:o}=e,{inputShape:i,strides:a,pad:l,dataFormat:u,dimRoundingMode:d}=s;Fe([r,o],"conv2dBackpropInput");const f=Ve(o.shape),m=Ve(r.shape);let g=To(u);const y=An(i,o.shape,a,1,l,d,!1,g),w=new Rn(y.inShape,"float32"),b=w.values,k=t.data.get(r.dataId).values,v=t.data.get(o.dataId).values,[N,S,$]=f,{batchSize:R,filterHeight:M,filterWidth:A,inChannels:P,inHeight:D,inWidth:E,outChannels:j,outHeight:V,outWidth:W,strideHeight:U,strideWidth:X}=y;g=y.dataFormat;const ee=M-1-y.padInfo.top,G=A-1-y.padInfo.left,z=g==="channelsLast",H=w.strides[0],O=z?w.strides[1]:w.strides[2],B=z?w.strides[2]:1,Y=z?1:w.strides[1],oe=m[0],Q=z?m[1]:m[2],ce=z?m[2]:1,me=z?1:m[1];for(let ge=0;ge<R;++ge)for(let ve=0;ve<P;++ve)for(let Ne=0;Ne<D;++Ne){const Me=Ne-ee,Ue=Math.max(0,Math.ceil(Me/U)),Qe=Math.min(V,(M+Me)/U);for(let ye=0;ye<E;++ye){const Ce=ye-G,be=Math.max(0,Math.ceil(Ce/X)),xe=Math.min(W,(A+Ce)/X);let Be=0;for(let at=Ue;at<Qe;++at){const Ht=at*U-Me;for(let Mt=be;Mt<xe;++Mt){const is=Mt*X-Ce,ln=oe*ge+Q*at+ce*Mt,Fn=N*(M-1-Ht)+S*(A-1-is)+$*ve;for(let Gn=0;Gn<j;++Gn){const qt=k[ln+me*Gn],Le=v[Fn+Gn];Be+=qt*Le}}}const Dt=H*ge+O*Ne+B*ye+Y*ve;b[Dt]=Be}}return t.makeTensorInfo(w.shape,w.dtype,w.values)}const sG={kernelName:Mp,backendName:"cpu",kernelFunc:nG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rG(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:o}=e,{strides:i,pad:a,dilations:l}=s;Fe([r,o],"conv3d");const u=gi(r.shape,o.shape,i,l,a),{filterDepth:d,filterHeight:f,filterWidth:m,dilationDepth:g,dilationHeight:y,dilationWidth:w,padInfo:b}=u,k=b.front,v=b.left,N=b.top,S=new Rn(u.outShape,r.dtype),$=t.data.get(r.dataId).values,R=t.data.get(o.dataId).values,M=S.values,A=Ve(r.shape),P=Ve(o.shape);for(let D=0;D<u.batchSize;++D){const E=D*A[0],j=D*S.strides[0];for(let V=0;V<u.outDepth;++V){const W=j+V*S.strides[1],U=V*u.strideDepth-k;for(let X=0;X<d;++X){const ee=U+X*g;if(ee<0||ee>=u.inDepth)continue;const G=X*P[0],z=E+ee*A[1];for(let H=0;H<u.outHeight;++H){const O=W+H*S.strides[2],B=H*u.strideHeight-N;for(let Y=0;Y<f;++Y){const oe=B+Y*y;if(oe<0||oe>=u.inHeight)continue;const Q=G+Y*P[1],ce=z+oe*A[2];for(let me=0;me<u.outWidth;++me){const ge=O+me*u.outChannels,ve=me*u.strideWidth-v;for(let Ne=0;Ne<m;++Ne){const Me=ve+Ne*w;if(Me<0||Me>=u.inWidth)continue;const Ue=Q+Ne*P[2],Qe=ce+Me*u.inChannels;let ye=Ue;for(let Ce=0;Ce<u.inChannels;++Ce){const be=$[Qe+Ce];for(let xe=0;xe<u.outChannels;++xe)M[ge+xe]+=be*R[ye+xe];ye+=u.outChannels}}}}}}}}return t.makeTensorInfo(S.shape,S.dtype,S.values)}const oG={kernelName:Pp,backendName:"cpu",kernelFunc:rG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iG(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:o}=e,{strides:i,pad:a,filterShape:l}=s;Fe([r,o],"conv3dBackpropFilterV2");const u=Ve(r.shape),d=Ve(o.shape),f=gi(r.shape,l,i,1,a),m=f.strideDepth,g=f.strideHeight,y=f.strideWidth,w=f.filterDepth,b=f.filterHeight,k=f.filterWidth,v=new Rn(f.filterShape,"float32"),N=v.values,[S,$,R,M]=v.strides,A=t.data.get(o.dataId).values,[P,D,E,j]=d,V=t.data.get(r.dataId).values,[W,U,X,ee]=u,G=f.padInfo.front,z=f.padInfo.left,H=f.padInfo.top;for(let O=0;O<w;++O){const B=Math.max(0,Math.ceil((G-O)/m)),Y=Math.min(f.outDepth,(f.inDepth+G-O)/m),oe=O*S;for(let Q=0;Q<b;++Q){const ce=Math.max(0,Math.ceil((H-Q)/g)),me=Math.min(f.outHeight,(f.inHeight+H-Q)/g),ge=Q*$+oe;for(let ve=0;ve<k;++ve){const Ne=Math.max(0,Math.ceil((z-ve)/y)),Me=Math.min(f.outWidth,(f.inWidth+z-ve)/y),Ue=ve*R+ge;for(let Qe=0;Qe<f.inChannels;++Qe){const ye=Qe*M+Ue;for(let Ce=0;Ce<f.outChannels;++Ce){let be=0;for(let xe=0;xe<f.batchSize;++xe){const Be=xe*W,Dt=xe*P;for(let at=B;at<Y;++at){const Mt=(O+at*m-G)*U+Be,is=at*D+Dt;for(let ln=ce;ln<me;++ln){const Gn=(Q+ln*g-H)*X+Mt,qt=ln*E+is;for(let Le=Ne;Le<Me;++Le){const vt=(ve+Le*y-z)*ee+Gn,Nt=Le*j+qt;be+=V[vt+Qe]*A[Nt+Ce]}}}}N[ye+Ce]=be}}}}}return t.makeTensorInfo(v.shape,v.dtype,v.values)}const aG={kernelName:zy,backendName:"cpu",kernelFunc:iG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lG(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:o}=e,{pad:i,strides:a,inputShape:l}=s;Fe([r],"conv3dBackpropInputV2");const u=Ve(r.shape),d=Ve(o.shape),f=gi(l,o.shape,a,1,i),m=new Rn(f.inShape,"float32"),g=m.values,[y,w,b,k]=m.strides,v=t.data.get(r.dataId).values,[N,S,$,R]=u,M=t.data.get(o.dataId).values,[A,P,D,E]=d,{batchSize:j,filterDepth:V,filterHeight:W,filterWidth:U,inChannels:X,inDepth:ee,inHeight:G,inWidth:z,outChannels:H,outDepth:O,outHeight:B,outWidth:Y,strideDepth:oe,strideHeight:Q,strideWidth:ce}=f,me=V-1-f.padInfo.front,ge=W-1-f.padInfo.top,ve=U-1-f.padInfo.left;for(let Ne=0;Ne<j;++Ne)for(let Me=0;Me<X;++Me)for(let Ue=0;Ue<ee;++Ue){const Qe=Ue-me,ye=Math.max(0,Math.ceil(Qe/oe)),Ce=Math.min(O,(V+Qe)/oe);for(let be=0;be<G;++be){const xe=be-ge,Be=Math.max(0,Math.ceil(xe/Q)),Dt=Math.min(B,(W+xe)/Q);for(let at=0;at<z;++at){const Ht=at-ve,Mt=Math.max(0,Math.ceil(Ht/ce)),is=Math.min(Y,(U+Ht)/ce);let ln=0;for(let Fn=ye;Fn<Ce;++Fn){const Gn=Fn*oe-Qe;for(let qt=Be;qt<Dt;++qt){const Le=qt*Q-xe;for(let et=Mt;et<is;++et){const vt=et*ce-Ht,Nt=N*Ne+S*Fn+$*qt+R*et,Ia=A*(V-1-Gn)+P*(W-1-Le)+D*(U-1-vt)+E*Me;for(let io=0;io<H;++io){const $a=v[Nt+io],Si=M[Ia+io];ln+=$a*Si}}}}g[y*Ne+w*Ue+b*be+k*at+Me]=ln}}}return t.makeTensorInfo(m.shape,m.dtype,m.values)}const cG={kernelName:By,backendName:"cpu",kernelFunc:lG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uG=wt(ju,n=>Math.cos(n)),dG={kernelName:ju,backendName:"cpu",kernelFunc:uG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hG=wt(Ou,n=>Math.cosh(n)),fG={kernelName:Ou,backendName:"cpu",kernelFunc:hG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pG(n){const{inputs:e,backend:t,attrs:s}=n,{image:r,boxes:o,boxInd:i}=e,{cropSize:a,method:l,extrapolationValue:u}=s,[d,f,m,g]=r.shape,y=o.shape[0],[w,b]=a,k=st([y,w,b,g],"float32"),v=t.data.get(o.dataId).values,N=t.data.get(i.dataId).values,S=t.data.get(r.dataId).values,$=Ve(r.shape),R=Ve(k.shape);for(let M=0;M<y;M++){const A=M*4,P=v[A],D=v[A+1],E=v[A+2],j=v[A+3],V=N[M];if(V>=d)continue;const W=w>1?(E-P)*(f-1)/(w-1):0,U=b>1?(j-D)*(m-1)/(b-1):0;for(let X=0;X<w;X++){const ee=w>1?P*(f-1)+X*W:.5*(P+E)*(f-1);if(ee<0||ee>f-1){for(let G=0;G<b;G++)for(let z=0;z<g;z++){const H=z+G*R[2]+X*R[1]+M*R[0];k.values[H]=u}continue}if(l==="bilinear"){const G=Math.floor(ee),z=Math.ceil(ee),H=ee-G;for(let O=0;O<b;O++){const B=b>1?D*(m-1)+O*U:.5*(D+j)*(m-1);if(B<0||B>m-1){for(let ce=0;ce<g;ce++){const me=ce+O*R[2]+X*R[1]+M*R[0];k.values[me]=u}continue}const Y=Math.floor(B),oe=Math.ceil(B),Q=B-Y;for(let ce=0;ce<g;ce++){let me=ce+Y*$[2]+G*$[1]+V*$[0];const ge=S[me];me=ce+oe*$[2]+G*$[1]+V*$[0];const ve=S[me];me=ce+Y*$[2]+z*$[1]+V*$[0];const Ne=S[me];me=ce+oe*$[2]+z*$[1]+V*$[0];const Me=S[me],Ue=ge+(ve-ge)*Q,Qe=Ne+(Me-Ne)*Q;me=ce+O*R[2]+X*R[1]+M*R[0],k.values[me]=Ue+(Qe-Ue)*H}}}else for(let G=0;G<b;++G){const z=b>1?D*(m-1)+G*U:.5*(D+j)*(m-1);if(z<0||z>m-1){for(let B=0;B<g;B++){const Y=B+G*R[2]+X*R[1]+M*R[0];k.values[Y]=u}continue}const H=Math.round(z),O=Math.round(ee);for(let B=0;B<g;B++){const Y=B+H*$[2]+O*$[1]+V*$[0],oe=B+G*R[2]+X*R[1]+M*R[0];k.values[oe]=S[Y]}}}}return t.makeTensorInfo(k.shape,k.dtype,k.values)}const mG={kernelName:Wy,backendName:"cpu",kernelFunc:pG};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gG(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,exclusive:i,reverse:a}=s;Fe(r,"cumprod");const l=Bt([o],r.shape.length);let u=r;l!=null&&(u=ys({inputs:{x:r},backend:t,attrs:{perm:l}}));const d=Zt(1,r.shape.length)[0];if(d!==u.shape.length-1)throw new Error(`backend.cumprod in CPU expects an inner-most axis=${u.shape.length-1} but got axis=${d}`);const f=As(u.dtype,"int32"),m=Ty(pe(u.shape),f),g=t.data.get(u.dataId).values,y=u.shape[u.shape.length-1],w=a?(k,v)=>k+y-v-1:(k,v)=>k+v;for(let k=0;k<g.length;k+=y)for(let v=0;v<y;v++){const N=w(k,v);if(v===0)m[N]=i?1:g[N];else{const S=w(k,v-1);m[N]=i?g[S]*m[S]:g[N]*m[S]}}const b=t.makeTensorInfo(u.shape,f,m);if(l!=null){const k=xi(l),v=ys({inputs:{x:b},backend:t,attrs:{perm:k}});return t.disposeIntermediateTensorInfo(b),t.disposeIntermediateTensorInfo(u),v}return b}const xG={kernelName:Vy,backendName:"cpu",kernelFunc:gG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yG(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,exclusive:i,reverse:a}=s;Fe(r,"cumsum");const l=Bt([o],r.shape.length);let u=r;l!=null&&(u=ys({inputs:{x:r},backend:t,attrs:{perm:l}}));const d=Zt(1,r.shape.length)[0];if(d!==u.shape.length-1)throw new Error(`backend.cumsum in CPU expects an inner-most axis=${u.shape.length-1} but got axis=${d}`);const f=As(u.dtype,"int32"),m=zn(pe(u.shape),f),g=t.data.get(u.dataId).values,y=u.shape[u.shape.length-1],w=a?(k,v)=>k+y-v-1:(k,v)=>k+v;for(let k=0;k<g.length;k+=y)for(let v=0;v<y;v++){const N=w(k,v);if(v===0)m[N]=i?0:g[N];else{const S=w(k,v-1);m[N]=i?g[S]+m[S]:g[N]+m[S]}}const b=t.makeTensorInfo(u.shape,f,m);if(l!=null){const k=xi(l),v=ys({inputs:{x:b},backend:t,attrs:{perm:k}});return t.disposeIntermediateTensorInfo(b),t.disposeIntermediateTensorInfo(u),v}return b}const vG={kernelName:Fp,backendName:"cpu",kernelFunc:yG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bG(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,weights:o}=e,{size:i,binaryOutput:a}=s;if(r.shape.length===1){const l=t.data.get(r.dataId).values,u=t.data.get(o.dataId).values,d=Hv(l,u,o.dtype,o.shape,i);return t.makeTensorInfo([i],o.dtype,d)}else if(r.shape.length===2){const l=t.bufferSync(r),u=t.bufferSync(o),d=LE(l,u,i,a);return t.makeTensorInfo(d.shape,o.dtype,d.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${r.shape.length}.`)}const wG={kernelName:Uy,backendName:"cpu",kernelFunc:bG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kG(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockSize:o,dataFormat:i}=s;_(i==="NHWC",()=>`Only NHWC dataFormat supported on CPU for depthToSpace. Got ${i}`);const a=r.shape[0],l=r.shape[1],u=r.shape[2],d=r.shape[3],f=l*o,m=u*o,g=d/(o*o),y=t.data.get(r.dataId).values,w=new Float32Array(a*f*m*g);let b=0;for(let k=0;k<a;++k)for(let v=0;v<f;++v){const N=Math.floor(v/o),S=v%o;for(let $=0;$<m;++$){const R=Math.floor($/o),M=$%o,A=(S*o+M)*g;for(let P=0;P<g;++P){const E=P+A+d*(R+u*(N+l*k));w[b++]=y[E]}}}return t.makeTensorInfo([a,f,m,g],r.dtype,w)}const CG={kernelName:Gy,backendName:"cpu",kernelFunc:kG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LR(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:o}=e,{strides:i,pad:a,dilations:l,dimRoundingMode:u}=s;Fe([r,o],"depthwiseConv2DNative");const d=Ve(r.shape),f=Ve(o.shape);let m=l;m==null&&(m=[1,1]),_(Vn(i,m),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${i} and dilations '${m}'`);const g=An(r.shape,o.shape,i,m,a,u,!0),{filterHeight:y,filterWidth:w,dilationHeight:b,dilationWidth:k,padInfo:v}=g,N=v.left,S=v.top,$=g.outChannels/g.inChannels,R=new Rn(g.outShape,r.dtype),M=t.data.get(r.dataId).values,A=t.data.get(o.dataId).values,P=R.values;for(let D=0;D<g.batchSize;++D){const E=D*d[0],j=D*R.strides[0];for(let V=0;V<g.outHeight;++V){const W=j+V*R.strides[1],U=V*g.strideHeight-S;for(let X=0;X<y;++X){const ee=U+X*b;if(ee<0||ee>=g.inHeight)continue;const G=X*f[0],z=E+ee*d[1];for(let H=0;H<g.outWidth;++H){const O=W+H*R.strides[2],B=H*g.strideWidth-N;for(let Y=0;Y<w;++Y){const oe=B+Y*k;if(oe<0||oe>=g.inWidth)continue;const Q=G+Y*f[1],ce=z+oe*g.inChannels;let me=O,ge=Q;for(let ve=0;ve<g.inChannels;++ve){const Ne=M[ce+ve];for(let Me=0;Me<$;++Me)P[me+Me]+=Ne*A[ge+Me];me+=$,ge+=$}}}}}}return t.makeTensorInfo(R.shape,R.dtype,R.values)}const SG={kernelName:Lp,backendName:"cpu",kernelFunc:LR};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NG(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:o}=e,{strides:i,dilations:a,pad:l,dimRoundingMode:u,filterShape:d}=s;Fe([r,o],"depthwiseConv2dNativeBackpropFilter");const f=An(r.shape,d,i,a,l,u,!0),{strideHeight:m,strideWidth:g,filterHeight:y,filterWidth:w}=f,b=new Rn(f.filterShape,"float32"),k=f.padInfo.left,v=f.padInfo.top,N=f.outChannels/f.inChannels,S=t.data.get(r.dataId).values,$=new Rn(r.shape,r.dtype,S),R=t.data.get(o.dataId).values,M=new Rn(o.shape,o.dtype,R);for(let A=0;A<y;++A){const P=Math.max(0,Math.ceil((v-A)/m)),D=Math.min(f.outHeight,(f.inHeight+v-A)/m);for(let E=0;E<w;++E){const j=Math.max(0,Math.ceil((k-E)/g)),V=Math.min(f.outWidth,(f.inWidth+k-E)/g);for(let W=0;W<f.outChannels;++W){const U=Math.trunc(W/N),X=W%N;let ee=0;for(let G=0;G<f.batchSize;++G)for(let z=P;z<D;++z){const H=A+z*m-v;for(let O=j;O<V;++O){const B=E+O*g-k;ee+=$.get(G,H,B,U)*M.get(G,z,O,W)}}b.set(ee,A,E,U,X)}}}return t.makeTensorInfo(b.shape,b.dtype,b.values)}const IG={kernelName:Hy,backendName:"cpu",kernelFunc:NG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $G(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:o}=e,{strides:i,dilations:a,pad:l,dimRoundingMode:u,inputShape:d}=s;Fe([r,o],"depthwiseConv2DNativeBackpropInput");const f=Ve(r.shape),m=Ve(o.shape),g=An(d,o.shape,i,a,l,u,!0),y=new Rn(g.inShape,"float32"),w=y.values,[b,k,v]=y.strides,N=t.data.get(r.dataId).values,[S,$,R]=f,M=t.data.get(o.dataId).values,[A,P,D]=m,{batchSize:E,filterHeight:j,filterWidth:V,inChannels:W,inHeight:U,inWidth:X,outChannels:ee,outHeight:G,outWidth:z,strideHeight:H,strideWidth:O}=g,B=j-1-g.padInfo.top,Y=V-1-g.padInfo.left,oe=ee/W;for(let Q=0;Q<E;++Q)for(let ce=0;ce<W;++ce)for(let me=0;me<U;++me){const ge=me-B,ve=Math.max(0,Math.ceil(ge/H)),Ne=Math.min(G,(j+ge)/H);for(let Me=0;Me<X;++Me){const Ue=Me-Y,Qe=Math.max(0,Math.ceil(Ue/O)),ye=Math.min(z,(V+Ue)/O);let Ce=0;for(let be=ve;be<Ne;++be){const xe=be*H-ge;for(let Be=Qe;Be<ye;++Be){const Dt=Be*O-Ue,at=S*Q+$*be+R*Be,Ht=A*(j-1-xe)+P*(V-1-Dt)+D*ce;for(let Mt=0;Mt<oe;++Mt){const is=ce*oe+Mt,ln=N[at+is],Fn=M[Ht+Mt];Ce+=ln*Fn}}}w[b*Q+k*me+v*Me+ce]=Ce}}return t.makeTensorInfo(y.shape,y.dtype,y.values)}const TG={kernelName:qy,backendName:"cpu",kernelFunc:$G};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EG(n){const{inputs:e,backend:t}=n,{x:s}=e,r=pe(s.shape),o=t.data.get(s.dataId).values,i=st([r,r],s.dtype),a=i.values;for(let u=0;u<o.length;u++)a[u*r+u]=o[u];const l=[...s.shape,...s.shape];return t.makeTensorInfo(l,i.dtype,i.values)}const RG={kernelName:lN,backendName:"cpu",kernelFunc:EG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AG={kernelName:jp,backendName:"cpu",kernelFunc:({inputs:n,backend:e,attrs:t})=>{const{x:s,filter:r}=n,{strides:o,pad:i,dilations:a}=t,l=e,u=l.data.get(s.dataId).values,d=s.shape.length,f=l.data.get(r.dataId).values,m=r.shape.length,{batchSize:g,inHeight:y,inWidth:w,inChannels:b,outHeight:k,outWidth:v,padInfo:N,strideHeight:S,strideWidth:$,filterHeight:R,filterWidth:M,dilationHeight:A,dilationWidth:P,outShape:D}=kd(s.shape,r.shape,o,i,"NHWC",a),E=pe(D),j=D.length,V=Qt(s.dtype,E);for(let U=0;U<g;++U)for(let X=0;X<k;++X){const ee=X*S-N.top;for(let G=0;G<v;++G){const z=G*$-N.left;for(let H=0;H<b;++H){let O=Number.MIN_SAFE_INTEGER;for(let Y=0;Y<R;++Y){const oe=ee+Y*A;if(oe>=0&&oe<y)for(let Q=0;Q<M;++Q){const ce=z+Q*P;if(ce>=0&&ce<w){const me=qr([U,oe,ce,H],d,Ve(s.shape)),ge=qr([Y,Q,H],m,Ve(r.shape)),ve=u[me]+f[ge];ve>O&&(O=ve)}}}const B=qr([U,X,G,H],j,Ve(D));V[B]=O}}}return{dataId:l.write(ga(V,s.dtype),D,s.dtype),shape:D,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DG={kernelName:j0,backendName:"cpu",kernelFunc:({inputs:n,backend:e,attrs:t})=>{const{x:s,filter:r,dy:o}=n,{strides:i,pad:a,dilations:l}=t,u=e,d=Tr(s.shape,u.data.get(s.dataId).values),f=Tr(r.shape,u.data.get(r.dataId).values),{batchSize:m,inHeight:g,inWidth:y,inChannels:w,outHeight:b,outWidth:k,padInfo:v,strideHeight:N,strideWidth:S,filterHeight:$,filterWidth:R,dilationHeight:M,dilationWidth:A,outShape:P}=kd(s.shape,r.shape,i,a,"NHWC",l);_(o.rank===P.length,()=>`Error in ${j0}, dy must have the same rank as output ${P.length}, but got ${o.rank}`);const D=Tr(P,u.data.get(o.dataId).values),E=rN(r.shape,r.dtype);for(let V=0;V<m;++V)for(let W=0;W<b;++W){const U=W*N-v.top;for(let X=0;X<k;++X){const ee=X*S-v.left;for(let G=0;G<w;++G){let z=Number.MIN_SAFE_INTEGER,H=0,O=0;for(let B=0;B<$;++B){const Y=U+B*M;if(Y>=0&&Y<g)for(let oe=0;oe<R;++oe){const Q=ee+oe*A;if(Q>=0&&Q<y){const ce=d[V][Y][Q][G]+f[B][oe][G];ce>z&&(z=ce,H=B,O=oe)}}}E[H][O][G]+=D[V][W][X][G]}}}return{dataId:u.write(ga(E,s.dtype),r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MG={kernelName:L0,backendName:"cpu",kernelFunc:({inputs:n,backend:e,attrs:t})=>{const{x:s,filter:r,dy:o}=n,{strides:i,pad:a,dilations:l}=t,u=e,d=Tr(s.shape,u.data.get(s.dataId).values),f=Tr(r.shape,u.data.get(r.dataId).values),{batchSize:m,inHeight:g,inWidth:y,inChannels:w,outHeight:b,outWidth:k,padInfo:v,strideHeight:N,strideWidth:S,filterHeight:$,filterWidth:R,dilationHeight:M,dilationWidth:A,outShape:P}=kd(s.shape,r.shape,i,a,"NHWC",l);_(o.rank===P.length,()=>`Error in ${L0}, dy must have the same rank as output ${P.length}, but got ${o.rank}`);const D=Tr(P,u.data.get(o.dataId).values),E=rN(s.shape,s.dtype);for(let V=0;V<m;++V)for(let W=0;W<b;++W){const U=W*N-v.top;for(let X=0;X<k;++X){const ee=X*S-v.left;for(let G=0;G<w;++G){let z=Number.MIN_SAFE_INTEGER,H=U<0?0:U,O=ee<0?0:ee;for(let B=0;B<$;++B){const Y=U+B*M;if(Y>=0&&Y<g)for(let oe=0;oe<R;++oe){const Q=ee+oe*A;if(Q>=0&&Q<y){const ce=d[V][Y][Q][G]+f[B][oe][G];ce>z&&(z=ce,H=Y,O=Q)}}}E[V][H][O][G]+=D[V][W][X][G]}}}return{dataId:u.write(ga(E,s.dtype),s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PG(n){const{inputs:e,backend:t,attrs:s}=n,{image:r}=e,{canvas:o,options:i}=s,{contextOptions:a,imageOptions:l}=i||{},u=(l==null?void 0:l.alpha)||1,d=(a==null?void 0:a.contextType)||"2d";if(d!=="2d")throw new Error(`Context type ${a.contextType} is not supported by the CPU backend.`);const f=o.getContext(d,(a==null?void 0:a.contextAttributes)||{});if(f==null)throw new Error(`Could not get the context with ${d} type.`);const[m,g]=r.shape.slice(0,2),y=r.shape.length===2?1:r.shape[2],w=t.data.get(r.dataId).values,b=r.dtype==="float32"?255:1,k=new Uint8ClampedArray(g*m*4);for(let N=0;N<m*g;++N){const S=[0,0,0,255*u];for(let R=0;R<y;R++){const M=w[N*y+R];if(r.dtype==="float32"){if(M<0||M>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${M}.`)}else if(r.dtype==="int32"&&(M<0||M>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${M}.`);y===1?(S[0]=M*b,S[1]=M*b,S[2]=M*b):S[R]=M*b}const $=N*4;k[$+0]=Math.round(S[0]),k[$+1]=Math.round(S[1]),k[$+2]=Math.round(S[2]),k[$+3]=Math.round(S[3])}o.width=g,o.height=m;const v=new ImageData(k,g,m);return f.putImageData(v,0,0),r}const FG={kernelName:WM,backendName:"cpu",kernelFunc:PG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Od(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,keepDims:i}=s;Fe(r,"sum");let a;r.dtype==="bool"?a=hi({inputs:{x:r},backend:t,attrs:{dtype:"int32"}}):a=so({inputs:{x:r},backend:t});const l=a.shape.length,u=rt(o,a.shape),d=Bt(u,l);let f=u,m=a;d!=null&&(m=ys({inputs:{x:a},backend:t,attrs:{perm:d}}),f=Zt(f.length,l)),Dn("sum",f,m.shape.length);const[g,y]=Sn(m.shape,f),w=As(m.dtype,"int32");let b=rp(t,g,w);const k=pe(y),v=t.data.get(b.dataId).values,N=t.data.get(m.dataId).values;for(let S=0;S<v.length;++S){const $=S*k;let R=0;for(let M=0;M<k;++M)R+=N[$+M];v[S]=R}if(i){const S=an(b.shape,u),$=b;b=Tt({inputs:{x:b},backend:t,attrs:{shape:S}}),t.disposeIntermediateTensorInfo($)}return t.disposeIntermediateTensorInfo(a),d!=null&&t.disposeIntermediateTensorInfo(m),b}const LG={kernelName:gm,backendName:"cpu",kernelFunc:Od};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jG(n){const{inputs:e,backend:t,attrs:s}=n,{equation:r}=s,o=e,{allDims:i,summedDims:a,idDims:l}=gv(r,o.length);yv(i.length,l,o);const{path:u,steps:d}=vv(a,l),f=d.length;let m=null,g=i.length;const y=[];for(let w=0;w<f;++w){for(const b of d[w]){const{permutationIndices:k,expandDims:v}=xv(g,l[b]);let N;bv(k)?N=o[b]:(N=ys({inputs:{x:o[b]},backend:t,attrs:{perm:k}}),y.push(N));const S=N.shape.slice();for(let $=0;$<v.length;++$)S.splice(v[$],0,1);xt(N.shape,S)||(N=Tt({inputs:{x:N},backend:t,attrs:{shape:S}}),y.push(N)),m===null?m=N:(m=Km({inputs:{a:N,b:m},backend:t}),y.push(m))}w<f-1&&(u[w]>=0&&(m=Od({inputs:{x:m},backend:t,attrs:{axis:u[w]-(i.length-g),keepDims:!1}}),y.push(m)),g--)}for(const w of y)w!==m&&t.disposeIntermediateTensorInfo(w);return m}const OG={kernelName:Ky,backendName:"cpu",kernelFunc:jG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _G(n){const{inputs:e,backend:t}=n,{dy:s,y:r}=e;Fe([s,r],"eluGrad");const o=new Float32Array(pe(r.shape)),i=t.data.get(r.dataId).values,a=t.data.get(s.dataId).values;for(let l=0;l<i.length;++l){const u=i[l];u>=0?o[l]=a[l]:o[l]=a[l]*(u+1)}return t.makeTensorInfo(r.shape,"float32",o)}const zG={kernelName:Xy,backendName:"cpu",kernelFunc:_G};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BG=cv,VG=uv,WG=dv,UG=hv,GG=fv,HG=pv,qG=wt(Bu,n=>{const e=Math.sign(n),t=Math.abs(n),s=1/(1+BG*t);return e*(1-((((HG*s+GG)*s+UG)*s+WG)*s+VG)*s*Math.exp(-t*t))}),KG={kernelName:Bu,backendName:"cpu",kernelFunc:qG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ap(n){const{inputs:e,backend:t,attrs:s}=n,{input:r}=e,{dim:o}=s,i=r.shape.length,a=r.shape.slice();let l=o;return o<0&&(_(-(i+1)<=o,()=>`Axis must be in the interval [${-(i+1)}, ${i}]`),l=i+o+1),a.splice(l,0,1),Tt({inputs:{x:r},backend:t,attrs:{shape:a}})}const XG={kernelName:_p,backendName:"cpu",kernelFunc:ap};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QG=tn((n,e)=>n/e),Jv=gn(_u,QG),ly={kernelName:_u,backendName:"cpu",kernelFunc:Jv};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jR(n,e,t){const s=n.shape,r=s[0],o=s[1],i=t.data.get(n.dataId),a=i.complexTensorInfos.real,l=i.complexTensorInfos.imag,u=[r,o],d=pe(u),f=_n("float32",d),m=_n("float32",d);for(let b=0;b<r;b++){const k=da({inputs:{x:a},backend:t,attrs:{begin:[b,0],size:[1,o]}}),v=da({inputs:{x:l},backend:t,attrs:{begin:[b,0],size:[1,o]}}),N=Rs({inputs:{real:k,imag:v},backend:t}),{real:S,imag:$}=YG(N,e,t),R=So(S,$);for(let M=0;M<o;M++){const A=mv(R,M);f[b*o+M]=A.real,m[b*o+M]=A.imag}t.disposeIntermediateTensorInfo(k),t.disposeIntermediateTensorInfo(v),t.disposeIntermediateTensorInfo(N)}const g=t.makeTensorInfo(u,"float32",f),y=t.makeTensorInfo(u,"float32",m),w=Rs({inputs:{real:g,imag:y},backend:t});return t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(y),w}function YG(n,e,t){const s=pe(n.shape),r=t.data.get(n.dataId),o=t.data.get(r.complexTensorInfos.real.dataId).values,i=t.data.get(r.complexTensorInfos.imag.dataId).values;if(JG(s)){const a=cy(o,i,s,e,t),l=[n.shape[0],n.shape[1]];if(e){const u=t.makeTensorInfo(l,"float32",a.real),d=t.makeTensorInfo(l,"float32",a.imag),f=t.makeTensorInfo([],"float32",pi(s,"float32")),m=so({inputs:{x:f},backend:t}),g=ly.kernelFunc({inputs:{a:u,b:f},backend:t}),y=ly.kernelFunc({inputs:{a:d,b:m},backend:t}),w=t.data.get(g.dataId).values,b=t.data.get(y.dataId).values;return t.disposeIntermediateTensorInfo(u),t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(y),{real:w,imag:b}}return a}else{const a=So(o,i),l=ZG(a,s,e);return YI(l)}}function JG(n){return(n&n-1)===0}function cy(n,e,t,s,r){if(t===1)return{real:n,imag:e};const o=So(n,e),i=t/2,a=JI(o),l=a.real,u=a.imag,d=[l.length],f=r.makeTensorInfo(d,"float32",l),m=r.makeTensorInfo(d,"float32",u),g=Rs({inputs:{real:f,imag:m},backend:r}),y=ZI(o),w=y.real,b=y.imag,k=[w.length],v=r.makeTensorInfo(k,"float32",w),N=r.makeTensorInfo(k,"float32",b),S=Rs({inputs:{real:v,imag:N},backend:r}),$=cy(l,u,i,s,r),R=$.real,M=$.imag,A=[R.length],P=r.makeTensorInfo(A,"float32",R),D=r.makeTensorInfo(A,"float32",M),E=Rs({inputs:{real:P,imag:D},backend:r}),j=cy(w,b,i,s,r),V=j.real,W=j.imag,U=[V.length],X=r.makeTensorInfo(U,"float32",V),ee=r.makeTensorInfo(U,"float32",W),G=Rs({inputs:{real:X,imag:ee},backend:r}),z=t$(t,s),H=[z.real.length],O=r.makeTensorInfo(H,"float32",z.real),B=r.makeTensorInfo(H,"float32",z.imag),Y=Rs({inputs:{real:O,imag:B},backend:r}),oe=Km({inputs:{a:Y,b:G},backend:r}),Q=Il({inputs:{a:E,b:oe},backend:r}),ce=Qv({inputs:{a:E,b:oe},backend:r}),me=ua({inputs:{input:Q},backend:r}),ge=ua({inputs:{input:ce},backend:r}),ve=$l({inputs:{input:Q},backend:r}),Ne=$l({inputs:{input:ce},backend:r}),Me=Tl({inputs:[me,ge],backend:r,attrs:{axis:0}}),Ue=Tl({inputs:[ve,Ne],backend:r,attrs:{axis:0}}),Qe=r.data.get(Me.dataId).values,ye=r.data.get(Ue.dataId).values;return r.disposeIntermediateTensorInfo(f),r.disposeIntermediateTensorInfo(m),r.disposeIntermediateTensorInfo(g),r.disposeIntermediateTensorInfo(v),r.disposeIntermediateTensorInfo(N),r.disposeIntermediateTensorInfo(S),r.disposeIntermediateTensorInfo(P),r.disposeIntermediateTensorInfo(D),r.disposeIntermediateTensorInfo(E),r.disposeIntermediateTensorInfo(X),r.disposeIntermediateTensorInfo(ee),r.disposeIntermediateTensorInfo(G),r.disposeIntermediateTensorInfo(O),r.disposeIntermediateTensorInfo(B),r.disposeIntermediateTensorInfo(Y),r.disposeIntermediateTensorInfo(oe),r.disposeIntermediateTensorInfo(Q),r.disposeIntermediateTensorInfo(ce),r.disposeIntermediateTensorInfo(me),r.disposeIntermediateTensorInfo(ve),r.disposeIntermediateTensorInfo(ge),r.disposeIntermediateTensorInfo(Ne),r.disposeIntermediateTensorInfo(Me),r.disposeIntermediateTensorInfo(Ue),{real:Qe,imag:ye}}function ZG(n,e,t){const s=new Float32Array(e*2);for(let r=0;r<e;r++){let o=0,i=0;for(let a=0;a<e;a++){const l=n$(r*a,e,t),u=mv(n,a);o+=u.real*l.real-u.imag*l.imag,i+=u.real*l.imag+u.imag*l.real}t&&(o/=e,i/=e),e$(s,o,i,r)}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function e8(n){const{inputs:e,backend:t}=n,{input:s}=e,r=pe(s.shape),o=s.shape[s.shape.length-1],i=r/o,a=Tt({inputs:{x:s},backend:t,attrs:{shape:[i,o]}}),l=jR(a,!1,t),u=Tt({inputs:{x:l},backend:t,attrs:{shape:s.shape}});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(l),u}const t8={kernelName:Qy,backendName:"cpu",kernelFunc:e8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zv(n){const{backend:e,attrs:t}=n,{shape:s,value:r,dtype:o}=t,i=o||Pl(r),a=Qt(i,pe(s));return s8(a,r,i),e.makeTensorInfo(s,i,a)}const n8={kernelName:Yy,backendName:"cpu",kernelFunc:Zv};function s8(n,e,t){n.fill(e)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const r8={kernelName:Jy,backendName:"cpu",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{image:s}=n,r=t,o=_n(s.dtype,pe(s.shape)),[i,a,l,u]=s.shape,d=r.data.get(s.dataId).values;for(let m=0;m<i;m++){const g=m*l*a*u;for(let y=0;y<a;y++){const w=y*(l*u);for(let b=0;b<l;b++){const k=b*u;for(let v=0;v<u;v++){const N=Math.round(l-b-1),S=g+w+k+v;let $=d[S];if(N>=0&&N<l){const R=N*u,M=g+w+R+v;$=d[M]}o[S]=$}}}}return{dataId:r.write(o,s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o8(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:o,bias:i,preluActivationWeights:a}=e,{strides:l,pad:u,dataFormat:d,dilations:f,dimRoundingMode:m,activation:g,leakyreluAlpha:y}=s;let w=FR({inputs:{x:r,filter:o},backend:t,attrs:{strides:l,pad:u,dataFormat:d,dilations:f,dimRoundingMode:m}});if(i){const b=w;if(d==="NCHW"&&i.shape.length===1&&i.shape[0]!==1){const k=Tt({inputs:{x:i},backend:t,attrs:{shape:[i.shape[0],1,1]}});w=Il({inputs:{a:w,b:k},backend:t}),t.disposeIntermediateTensorInfo(k)}else w=Il({inputs:{a:w,b:i},backend:t});t.disposeIntermediateTensorInfo(b)}if(g){const b=w;if(d==="NCHW"&&g==="prelu"&&a.shape.length===1&&a.shape[0]!==1){const k=Tt({inputs:{x:a},backend:t,attrs:{shape:[a.shape[0],1,1]}});w=ip(t,w,g,k,y),t.disposeIntermediateTensorInfo(k)}else w=ip(t,w,g,a,y);t.disposeIntermediateTensorInfo(b)}return w}const i8={kernelName:_f,backendName:"cpu",kernelFunc:o8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function a8(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:o,bias:i,preluActivationWeights:a}=e,{strides:l,pad:u,dataFormat:d,dilations:f,dimRoundingMode:m,activation:g,leakyreluAlpha:y}=s;let w=LR({inputs:{x:r,filter:o},backend:t,attrs:{strides:l,pad:u,dataFormat:d,dilations:f,dimRoundingMode:m}});if(i){const b=w;w=Il({inputs:{a:w,b:i},backend:t}),t.disposeIntermediateTensorInfo(b)}if(g){const b=w;w=ip(t,w,g,a,y),t.disposeIntermediateTensorInfo(b)}return w}const l8={kernelName:$N,backendName:"cpu",kernelFunc:a8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function c8(n){const{inputs:e,backend:t}=n,{params:s,indices:r}=e,o=pe(s.shape),i=r.shape,a=i[i.length-1],[l,u,d,f]=J1(s,r);if(u===0)return t.makeTensorInfo(l,s.dtype,[]);const m=t.data.get(r.dataId).values,g=t.bufferSync(s),y=qE(m,g,s.dtype,u,a,d,f,s.shape,o);return t.makeTensorInfo(l,s.dtype,y.values)}const u8={kernelName:cN,backendName:"cpu",kernelFunc:c8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d8(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,indices:o}=e,{axis:i,batchDims:a}=s;Fe([r,o],"gatherV2");const l=rt(i,r.shape)[0],u=t.data.get(o.dataId).values,d=r.shape[l];for(let S=0;S<u.length;++S){const $=u[S];_($<=d-1&&$>=0,()=>`GatherV2: the index value ${$} is not in [0, ${d-1}]`)}let f=a;a==null&&(f=0);const m=pe(o.shape),g=kv(r,o,l,f),y=Tt({inputs:{x:r},backend:t,attrs:{shape:[g.batchSize,g.outerSize,g.dimSize,g.sliceSize]}}),w=Tt({inputs:{x:o},backend:t,attrs:{shape:[g.batchSize,m/g.batchSize]}}),b=[g.batchSize,g.outerSize,m/g.batchSize,g.sliceSize],k=t.bufferSync(w),v=t.bufferSync(y),N=KE(v,k,b);return t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(w),t.makeTensorInfo(g.outputShape,N.dtype,N.values)}const h8={kernelName:Bp,backendName:"cpu",kernelFunc:d8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f8(n){const{inputs:e,backend:t}=n,{input:s}=e,r=pe(s.shape),o=s.shape[s.shape.length-1],i=r/o,a=Tt({inputs:{x:s},backend:t,attrs:{shape:[i,o]}}),l=jR(a,!0,t),u=Tt({inputs:{x:l},backend:t,attrs:{shape:s.shape}});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(l),u}const p8={kernelName:Zy,backendName:"cpu",kernelFunc:f8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const m8=wt(Ku,n=>Number.isFinite(n)?1:0,"bool"),g8={kernelName:Ku,backendName:"cpu",kernelFunc:m8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const x8=wt(Xu,n=>Math.abs(n)===1/0?1:0,"bool"),y8={kernelName:Xu,backendName:"cpu",kernelFunc:x8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const v8=wt(Qu,n=>Number.isNaN(n)?1:0,"bool"),b8={kernelName:Qu,backendName:"cpu",kernelFunc:v8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function w8(n){const{backend:e,attrs:t}=n,{start:s,stop:r,num:o}=t,i=ZE(s,r,o);return e.makeTensorInfo([i.length],"float32",i)}const k8={kernelName:uN,backendName:"cpu",kernelFunc:w8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const C8=wt(Ju,n=>Math.log1p(n)),S8={kernelName:Ju,backendName:"cpu",kernelFunc:C8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const N8=tn((n,e)=>n&&e),I8=gn(Hp,N8,null,"bool"),$8={kernelName:Hp,backendName:"cpu",kernelFunc:I8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const T8=wt(qp,n=>n?0:1,"bool"),E8={kernelName:qp,backendName:"cpu",kernelFunc:T8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const R8=tn((n,e)=>n||e),A8=gn(Kp,R8,null,"bool"),D8={kernelName:Kp,backendName:"cpu",kernelFunc:A8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function M8(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{depthRadius:o,bias:i,alpha:a,beta:l}=s;Fe(r,"LRN");const u=r.shape[3],d=u-1,f=t.data.get(r.dataId).values,m=pe(r.shape),g=new Float32Array(m);function y(w){const b=w%u;let k=w-b+Math.max(0,b-o);const v=w-b+Math.min(b+o,d);let N=0;for(;k<=v;k++){const S=f[k];N+=S*S}return N}for(let w=0;w<m;w++){const b=y(w),k=f[w]*Math.pow(i+a*b,-l);g[w]=k}return t.makeTensorInfo(r.shape,r.dtype,g)}const P8={kernelName:Xp,backendName:"cpu",kernelFunc:M8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function F8(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,y:o,dy:i}=e,{depthRadius:a,bias:l,alpha:u,beta:d}=s;Fe(i,"LRNGrad");const f=pe(i.shape),m=i.shape[3],g=t.data.get(i.dataId).values,y=t.data.get(r.dataId).values,w=t.data.get(o.dataId).values,b=new Float32Array(f),k=f;for(let v=0;v<k;v++){const N=v%m,S=v-N+Math.max(0,N-a),$=v-N+Math.min(m,N+a+1);let R=0;for(let M=S;M<$;M++)R+=Math.pow(y[M],2);R=u*R+l;for(let M=S;M<$;M++){let A=-2*u*d*y[M]*w[v]/R;v===M&&(A+=Math.pow(R,-d)),A*=g[v],b[M]+=A}}return t.makeTensorInfo(i.shape,r.dtype,b)}const L8={kernelName:t1,backendName:"cpu",kernelFunc:F8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OR(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{reductionIndices:o,keepDims:i}=s,a=t;let l=r.shape;const u=l.length,d=rt(o,l);let f=d;const m=Bt(f,u);let g=a.data.get(r.dataId).values;if(m!=null){const S=new Array(u);for(let $=0;$<S.length;$++)S[$]=l[m[$]];g=Kv(g,l,r.dtype,m,S),f=Zt(f.length,u),l=S}Fe(r,"max"),Dn("max",f,u);const[y,w]=Sn(l,f),b=pe(w),k=tR(g,b,y,r.dtype),v=a.write(k,y,r.dtype);let N=y;return i&&(N=an(y,d)),{dataId:v,shape:N,dtype:r.dtype}}const j8={kernelName:Qp,backendName:"cpu",kernelFunc:OR};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function O8(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e;Fe(r,"maxPool");const{filterSize:o,strides:i,pad:a,dimRoundingMode:l}=s,u=1;_(Vn(i,u),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${u}'`);const d=ur(r.shape,o,i,u,a,l);let f;if(d.filterWidth===1&&d.filterHeight===1&&xt(d.inShape,d.outShape))f=so({inputs:{x:r},backend:t});else{const m=t.data.get(r.dataId).values,g=Ve(r.shape),y=Yv(m,r.shape,r.dtype,g,d,"max");f=t.makeTensorInfo(d.outShape,r.dtype,y.values)}return f}const _8={kernelName:Yp,backendName:"cpu",kernelFunc:O8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function z8(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{filterSize:o,strides:i,pad:a,dimRoundingMode:l,dataFormat:u}=s;Fe(r,"maxPool3d");const d=$o(r.shape,o,i,1,a,l,u),f=t.data.get(r.dataId).values,m=PR(f,r.shape,r.dtype,Ve(r.shape),d,"max");return t.makeTensorInfo(m.shape,"float32",m.values)}const B8={kernelName:Jp,backendName:"cpu",kernelFunc:z8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function V8(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:o}=e,{filterSize:i,strides:a,pad:l,dimRoundingMode:u}=s;Fe([r,o],"maxPool3DGrad");const d=$o(o.shape,i,a,1,l,u),f=t.bufferSync(o),m=RU(f,d),g=d.strideDepth,y=d.strideHeight,w=d.strideWidth,b=d.dilationDepth,k=d.dilationHeight,v=d.dilationWidth,N=d.effectiveFilterDepth,S=d.effectiveFilterHeight,$=d.effectiveFilterWidth,R=N-1-d.padInfo.front,M=$-1-d.padInfo.left,A=S-1-d.padInfo.top,P=st(o.shape,"float32"),D=t.bufferSync(r);for(let E=0;E<d.batchSize;++E)for(let j=0;j<d.inChannels;++j)for(let V=0;V<d.inDepth;++V)for(let W=0;W<d.inHeight;++W)for(let U=0;U<d.inWidth;++U){const X=V-R,ee=W-A,G=U-M;let z=0;for(let H=0;H<N;H+=b){const O=(X+H)/g;if(!(O<0||O>=d.outDepth||Math.floor(O)!==O))for(let B=0;B<S;B+=k){const Y=(ee+B)/y;if(!(Y<0||Y>=d.outHeight||Math.floor(Y)!==Y))for(let oe=0;oe<$;oe+=v){const Q=(G+oe)/w;if(Q<0||Q>=d.outWidth||Math.floor(Q)!==Q)continue;const ce=N*S*$-1-m.get(E,O,Y,Q,j),me=H*S*$+B*$+oe,ge=ce===me?1:0;if(ge===0)continue;const ve=D.get(E,O,Y,Q,j);z+=ve*ge}}}P.set(z,E,V,W,U,j)}return t.makeTensorInfo(P.shape,P.dtype,P.values)}const W8={kernelName:s1,backendName:"cpu",kernelFunc:V8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U8(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:o,output:i}=e,a=o;Fe([o,i],"maxPoolGrad");const{filterSize:l,strides:u,pad:d,dimRoundingMode:f}=s,m=ur(a.shape,l,u,1,d,f),g=t.data.get(a.dataId).values,y=st(m.outShape,a.dtype,MR(g,a.shape,a.dtype,m).values),w=m.strideHeight,b=m.strideWidth,k=m.dilationHeight,v=m.dilationWidth,N=m.effectiveFilterHeight,S=m.effectiveFilterWidth,$=S-1-m.padInfo.left,R=N-1-m.padInfo.top,M=st(a.shape,"float32"),A=t.data.get(r.dataId).values,P=st(r.shape,"float32",A);for(let D=0;D<m.batchSize;++D)for(let E=0;E<m.inChannels;++E)for(let j=0;j<m.inHeight;++j)for(let V=0;V<m.inWidth;++V){const W=j-R,U=V-$;let X=0;for(let ee=0;ee<N;ee+=k){const G=(W+ee)/w;if(!(G<0||G>=m.outHeight||Math.floor(G)!==G))for(let z=0;z<S;z+=v){const H=(U+z)/b;if(H<0||H>=m.outWidth||Math.floor(H)!==H)continue;const O=N*S-1-y.get(D,G,H,E),B=ee*S+z,Y=O===B?1:0;if(Y===0)continue;const oe=P.get(D,G,H,E);X+=oe*Y}}M.set(X,D,j,V,E)}return t.makeTensorInfo(M.shape,M.dtype,M.values)}const G8={kernelName:n1,backendName:"cpu",kernelFunc:U8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function H8(n,e,t,s,r){const o=Ve(e),i=Yv(n,e,t,o,r,"max"),a=MR(n,e,t,r,!0,s);return[i.values,a.values]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const q8={kernelName:dN,backendName:"cpu",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{x:s}=n,{filterSize:r,strides:o,pad:i,includeBatchInIndex:a}=e,l=t;Fe(s,"MaxPoolWithArgmax");const u=l.data.get(s.dataId).values,d=ur(s.shape,r,o,[1,1],i),[f,m]=H8(u,s.shape,s.dtype,a,d),g=l.write(f,d.outShape,s.dtype),y=l.write(m,d.outShape,s.dtype);return[{dataId:g,shape:d.outShape,dtype:s.dtype},{dataId:y,shape:d.outShape,dtype:"int32"}]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function K8(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,keepDims:i}=s,a=rt(o,r.shape),u=Sn(r.shape,a)[1],d=pe(u),f=[],m=t.makeTensorInfo([],"float32",new Float32Array([d]));f.push(m);const g=hi({inputs:{x:r},backend:t,attrs:{dtype:"float32"}});f.push(g);const y=Jv({inputs:{a:g,b:m},backend:t});f.push(y);const w=Od({inputs:{x:y},backend:t,attrs:{axis:o,keepDims:i}});return f.forEach(b=>t.disposeIntermediateTensorInfo(b)),w}const X8={kernelName:Zp,backendName:"cpu",kernelFunc:K8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Q8(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,keepDims:i}=s;Fe(r,"min");const a=rt(o,r.shape);let l=a;const u=Bt(l,r.shape.length);let d=r;u!=null&&(d=ys({inputs:{x:r},backend:t,attrs:{perm:u}}),l=Zt(l.length,r.shape.length)),Dn("min",l,d.shape.length);const[f,m]=Sn(d.shape,l),g=pe(m),y=zn(pe(f),d.dtype),w=t.data.get(d.dataId).values;for(let k=0;k<y.length;++k){const v=k*g;let N=w[v];for(let S=0;S<g;++S){const $=w[v+S];(Number.isNaN($)||$<N)&&(N=$)}y[k]=N}u!=null&&t.disposeIntermediateTensorInfo(d);const b=t.makeTensorInfo(f,d.dtype,y);if(i){const k=an(f,a),v=Tt({inputs:{x:b},backend:t,attrs:{shape:k}});return t.disposeIntermediateTensorInfo(b),v}return b}const Y8={kernelName:em,backendName:"cpu",kernelFunc:Q8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function J8(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{paddings:o,mode:i}=s;Fe(r,"mirrorPad");const a=o.map((N,S)=>N[0]+r.shape[S]+N[1]),l=o.map(N=>N[0]),u=o.map((N,S)=>N[0]+r.shape[S]),d=i==="reflect"?0:1,f=t.data.get(r.dataId).values,m=r.shape.length,g=Ve(r.shape),y=pe(a),w=a.length,b=Ve(a),k=_n(r.dtype,y);for(let N=0;N<y;N++){let S=Fl(N,w,b);for(let R=0;R<w;R++)S[R]<l[R]?S[R]=l[R]*2-S[R]-d:S[R]>=u[R]&&(S[R]=(u[R]-1)*2-S[R]+d);S=S.map((R,M)=>R-l[M]);const $=qr(S,m,g);k[N]=f[$]}return{dataId:t.write(k,a,r.dtype),shape:a,dtype:r.dtype}}const Z8={kernelName:tm,backendName:"cpu",kernelFunc:J8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eH=tn(((n,e)=>{const t=n%e;return n<0&&e<0||n>=0&&e>=0?t:(t+e)%e})),tH=gn(td,eH),nH={kernelName:td,backendName:"cpu",kernelFunc:tH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _R(n){const{inputs:e,backend:t,attrs:s}=n,{logits:r}=e,{dim:o}=s,i=r.shape.length;let a=o;if(a===-1&&(a=i-1),a!==i-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${i} and dim was ${a}`);const l=rt([a],r.shape),u=OR({inputs:{x:r},backend:t,attrs:{reductionIndices:l,keepDims:!1}}),d=an(u.shape,l),f=Tt({inputs:{x:u},backend:t,attrs:{shape:d}}),m=Qv({inputs:{a:r,b:f},backend:t}),g=WE({inputs:{x:m},backend:t}),y=Od({inputs:{x:g},backend:t,attrs:{axis:l,keepDims:!1}}),w=Tt({inputs:{x:y},backend:t,attrs:{shape:d}}),b=Jv({inputs:{a:g,b:w},backend:t});return t.disposeIntermediateTensorInfo(u),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(w),b}const sH={kernelName:vm,backendName:"cpu",kernelFunc:_R};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rH(n){const{inputs:e,backend:t,attrs:s}=n,{logits:r}=e,{numSamples:o,seed:i,normalized:a}=s;Fe(r,"multinomial");const l=a?r:_R({inputs:{logits:r},backend:t,attrs:{dim:-1}}),u=l.shape[0],d=l.shape[1],f=t.data.get(l.dataId).values,m=[u,o],g=zn(pe(m),"int32");for(let y=0;y<u;++y){const w=y*d,b=new Float32Array(d-1);b[0]=f[w];for(let N=1;N<b.length;++N)b[N]=b[N-1]+f[w+N];const k=j1.alea(i.toString()),v=y*o;for(let N=0;N<o;++N){const S=k();g[v+N]=b.length;for(let $=0;$<b.length;$++)if(S<b[$]){g[v+N]=$;break}}}return a||t.disposeIntermediateTensorInfo(l),t.makeTensorInfo(m,"int32",g)}const oH={kernelName:hN,backendName:"cpu",kernelFunc:rH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iH=H1;function aH(n){const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:o}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:l}=s;Fe(r,"NonMaxSuppression");const u=t.data.get(r.dataId).values,d=t.data.get(o.dataId).values,{selectedIndices:f}=iH(u,d,i,a,l);return t.makeTensorInfo([f.length],"int32",new Int32Array(f))}const lH={kernelName:r1,backendName:"cpu",kernelFunc:aH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cH=q1;function uH(n){const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:o}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:l,padToMaxOutputSize:u}=s;Fe(r,"NonMaxSuppressionPadded");const d=t.data.get(r.dataId).values,f=t.data.get(o.dataId).values,{selectedIndices:m,validOutputs:g}=cH(d,f,i,a,l,u);return[t.makeTensorInfo([m.length],"int32",new Int32Array(m)),t.makeTensorInfo([],"int32",new Int32Array([g]))]}const dH={kernelName:o1,backendName:"cpu",kernelFunc:uH};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hH=K1;function fH(n){const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:o}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:l,softNmsSigma:u}=s;Fe(r,"NonMaxSuppressionWithScore");const d=t.data.get(r.dataId).values,f=t.data.get(o.dataId).values,m=i,g=a,y=l,w=u,{selectedIndices:b,selectedScores:k}=hH(d,f,m,g,y,w);return[t.makeTensorInfo([b.length],"int32",new Int32Array(b)),t.makeTensorInfo([k.length],"float32",new Float32Array(k))]}const pH={kernelName:i1,backendName:"cpu",kernelFunc:fH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mH(n){const{inputs:e,backend:t,attrs:s}=n,{indices:r}=e,{dtype:o,depth:i,onValue:a,offValue:l}=s;Fe(r,"oneHot");const u=pe(r.shape),d=new Float32Array(u*i);d.fill(l);const f=t.data.get(r.dataId).values;for(let m=0;m<u;++m)f[m]>=0&&f[m]<i&&(d[m*i+f[m]]=a);return t.makeTensorInfo([...r.shape,i],o,d)}const gH={kernelName:om,backendName:"cpu",kernelFunc:mH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lp(n){const{inputs:e,backend:t}=n,{x:s}=e;if(s.dtype==="string")throw new Error("zerosLike is not supported for string tensors");if(s.dtype==="complex64"){const r=ua({inputs:{input:s},backend:t}),o=lp({inputs:{x:r},backend:t}),i=$l({inputs:{input:s},backend:t}),a=lp({inputs:{x:i},backend:t}),l=Rs({inputs:{real:o,imag:a},backend:t});return t.disposeIntermediateTensorInfo(r),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(a),l}else return Zv({backend:t,attrs:{shape:s.shape,value:0,dtype:s.dtype}})}const xH={kernelName:km,backendName:"cpu",kernelFunc:lp};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zR(n){const{inputs:e,backend:t}=n,{x:s}=e;if(s.dtype==="string")throw new Error("onesLike is not supported for string tensors");if(s.dtype==="complex64"){const r=ua({inputs:{input:s},backend:t}),o=zR({inputs:{x:r},backend:t}),i=$l({inputs:{input:s},backend:t}),a=lp({inputs:{x:i},backend:t}),l=Rs({inputs:{real:o,imag:a},backend:t});return t.disposeIntermediateTensorInfo(r),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(a),l}else return Zv({backend:t,attrs:{shape:s.shape,value:1,dtype:s.dtype}})}const yH={kernelName:rm,backendName:"cpu",kernelFunc:zR};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BR(n){const{inputs:e,backend:t,attrs:s}=n,{axis:r}=s;if(e.length===1)return ap({inputs:{input:e[0]},backend:t,attrs:{dim:r}});const o=e[0].shape,i=e[0].dtype;e.forEach(d=>{$y(o,d.shape,"All tensors passed to stack must have matching shapes"),_(i===d.dtype,()=>"All tensors passed to stack must have matching dtypes")});const a=[],l=e.map(d=>{const f=ap({inputs:{input:d},backend:t,attrs:{dim:r}});return a.push(f),f}),u=Tl({inputs:l,backend:t,attrs:{axis:r}});return a.forEach(d=>t.disposeIntermediateTensorInfo(d)),u}const vH={kernelName:im,backendName:"cpu",kernelFunc:BR};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bH(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{paddings:o,constantValue:i}=s;Fe(r,"pad");const a=o.map((v,N)=>v[0]+r.shape[N]+v[1]),l=o.map(v=>v[0]),u=t.data.get(r.dataId).values,d=pe(r.shape),f=r.shape.length,m=Ve(r.shape),g=pe(a),y=a.length,w=Ve(a),b=_n(r.dtype,g);i!==0&&b.fill(i);for(let v=0;v<d;v++){const S=Fl(v,f,m).map((R,M)=>R+l[M]),$=qr(S,y,w);b[$]=u[v]}return{dataId:t.write(b,a,r.dtype),shape:a,dtype:r.dtype}}const VR={kernelName:am,backendName:"cpu",kernelFunc:bH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wH=tn((n,e)=>Math.pow(n,e)),kH=gn(sd,wH),CH={kernelName:sd,backendName:"cpu",kernelFunc:kH};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SH(n){const{inputs:e,backend:t,attrs:s}=n,{paramsNestedSplits:r,paramsDenseValues:o,indices:i}=e,{outputRaggedRank:a}=s,l=r.map(k=>t.data.get(k.dataId).values),u=r.map(k=>k.shape),d=t.data.get(o.dataId).values,f=t.data.get(i.dataId).values,[m,g,y]=aR(l,u,d,o.shape,o.dtype,f,i.shape),w=m.map(k=>t.makeTensorInfo([k.length],"int32",k)),b=t.makeTensorInfo(y,o.dtype,g);return w.concat([b])}const NH={kernelName:fN,backendName:"cpu",kernelFunc:SH};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IH(n){const{inputs:e,backend:t}=n,{starts:s,limits:r,deltas:o}=e,i=t.data.get(s.dataId).values,a=t.data.get(r.dataId).values,l=t.data.get(o.dataId).values,[u,d]=lR(i,s.shape,s.dtype,a,r.shape,l,o.shape),f=t.makeTensorInfo([u.length],"int32",u),m=t.makeTensorInfo([d.length],s.dtype,d);return[f,m]}const $H={kernelName:pN,backendName:"cpu",kernelFunc:IH};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TH(n){const{inputs:e,backend:t,attrs:s}=n,{shape:r,values:o,defaultValue:i,rowPartitionTensors:a}=e,{rowPartitionTypes:l}=s,u=t.data.get(r.dataId).values,d=t.data.get(o.dataId).values,f=t.data.get(i.dataId).values,m=a.map(b=>t.data.get(b.dataId).values),g=a.map(b=>b.shape),[y,w]=cR(u,r.shape,d,o.shape,o.dtype,f,i.shape,m,g,l);return t.makeTensorInfo(y,o.dtype,w)}const EH={kernelName:mN,backendName:"cpu",kernelFunc:TH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RH(n){const{backend:e,attrs:t}=n,{start:s,stop:r,dtype:o,step:i}=t,a=uR(s,r,i,o);return e.makeTensorInfo([a.length],o,a)}const AH={kernelName:a1,backendName:"cpu",kernelFunc:RH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DH=wt(rd,n=>1/n),MH={kernelName:rd,backendName:"cpu",kernelFunc:DH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PH(n){const{inputs:e,backend:t,attrs:s}=n,{images:r}=e,{alignCorners:o,halfPixelCenters:i,size:a}=s;Fe(r,"resizeBilinear");const l=Ve(r.shape),[u,d]=a,[f,m,g,y]=r.shape,w=t.data.get(r.dataId).values,b=new Float32Array(pe([f,u,d,y])),k=[o&&u>1?m-1:m,o&&d>1?g-1:g],v=[o&&u>1?u-1:u,o&&d>1?d-1:d];let N=0;const S=k[0]/v[0],$=k[1]/v[1];for(let R=0;R<f;R++)for(let M=0;M<u;M++){let A;i?A=S*(M+.5)-.5:A=S*M;const P=Math.max(0,Math.floor(A)),D=A-P,E=Math.min(m-1,Math.ceil(A)),j=R*l[0]+P*l[1],V=R*l[0]+E*l[1];for(let W=0;W<d;W++){let U;i?U=$*(W+.5)-.5:U=$*W;const X=Math.max(0,Math.floor(U)),ee=U-X,G=Math.min(g-1,Math.ceil(U)),z=j+X*l[2],H=V+X*l[2],O=j+G*l[2],B=V+G*l[2];for(let Y=0;Y<y;Y++){const oe=w[z+Y],Q=w[H+Y],ce=w[O+Y],me=w[B+Y],ge=oe+(ce-oe)*ee,ve=Q+(me-Q)*ee,Ne=ge+(ve-ge)*D;b[N++]=Ne}}}return t.makeTensorInfo([f,u,d,y],"float32",b)}const FH={kernelName:hm,backendName:"cpu",kernelFunc:PH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LH(n){const{inputs:e,backend:t,attrs:s}=n,{images:r,dy:o}=e,{alignCorners:i}=s;Fe([o,r],"resizeBilinearGrad");const a=Ve(r.shape),[l,u,d,f]=r.shape,[,m,g]=o.shape,y=new Float32Array(l*u*d*f),w=[i&&m>1?u-1:u,i&&g>1?d-1:d],b=[i&&m>1?m-1:m,i&&g>1?g-1:g],k=w[0]/b[0],v=w[1]/b[1],N=t.data.get(o.dataId).values;let S=0;for(let $=0;$<l;$++){const R=$*a[0];for(let M=0;M<m;M++){const A=M*k,P=Math.floor(A),D=Math.min(Math.ceil(A),u-1),E=R+P*a[1],j=R+D*a[1],V=A-P,W=1-V;for(let U=0;U<g;U++){const X=U*v,ee=Math.floor(X),G=Math.min(Math.ceil(X),d-1),z=X-ee,H=1-z,O=E+ee*a[2],B=E+G*a[2],Y=j+ee*a[2],oe=j+G*a[2],Q=W*H,ce=W*z,me=V*H,ge=V*z;for(let ve=0;ve<f;ve++){const Ne=N[S++];y[O+ve]+=Ne*Q,y[B+ve]+=Ne*ce,y[Y+ve]+=Ne*me,y[oe+ve]+=Ne*ge}}}}return t.makeTensorInfo([l,d,u,f],"float32",y)}const jH={kernelName:u1,backendName:"cpu",kernelFunc:LH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OH(n){const{inputs:e,backend:t,attrs:s}=n,{images:r}=e,{alignCorners:o,halfPixelCenters:i,size:a}=s;Fe(r,"resizeNearestNeighbor");const l=Ve(r.shape),[u,d]=a,[f,m,g,y]=r.shape,w=t.data.get(r.dataId).values,b=new Float32Array(f*u*d*y),k=[o&&u>1?m-1:m,o&&d>1?g-1:g],v=[o&&u>1?u-1:u,o&&d>1?d-1:d],N=k[0]/v[0],S=k[1]/v[1];let $=0;for(let R=0;R<f;R++){const M=R*l[0];for(let A=0;A<u;A++){const P=i?N*(A+.5):N*A;let D=Math.min(m-1,o?Math.round(P):Math.floor(P));i&&(D=Math.max(0,D));const E=M+D*l[1];for(let j=0;j<d;j++){const V=i?S*(j+.5):S*j;let W=Math.min(g-1,o?Math.round(V):Math.floor(V));i&&(W=Math.max(0,W));const U=E+W*l[2];for(let X=0;X<y;X++){const ee=w[U+X];b[$++]=ee}}}}return t.makeTensorInfo([f,u,d,y],r.dtype,b)}const _H={kernelName:dm,backendName:"cpu",kernelFunc:OH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zH(n){const{inputs:e,backend:t,attrs:s}=n,{images:r,dy:o}=e,{alignCorners:i}=s;Fe([o,r],"resizeNearestNeighborGrad");const a=Ve(r.shape),l=Ve(o.shape),[u,d,f,m]=r.shape,[,g,y]=o.shape,w=new Float32Array(u*d*f*m),b=t.data.get(o.dataId).values,k=[i&&g>1?d-1:d,i&&y>1?f-1:f],v=[i&&g>1?g-1:g,i&&y>1?y-1:y],N=k[0]/v[0],S=k[1]/v[1],$=1/N,R=1/S,M=Math.ceil($)*2+2,A=Math.ceil(R)*2+2;for(let P=0;P<u;P++){const D=P*a[0];for(let E=0;E<d;E++){const j=D+E*a[1],V=Math.floor(E*$),W=Math.floor(V-M/2);for(let U=0;U<f;U++){const X=j+U*a[2],ee=Math.floor(U*R),G=Math.floor(ee-A/2);for(let z=0;z<m;z++){let H=0;for(let O=0;O<M;O++){const B=O+W;if(B<0||B>=g)continue;const Y=D+B*l[1],oe=B*N,Q=Math.min(d-1,i?Math.round(oe):Math.floor(oe));if(E===Q)for(let ce=0;ce<A;ce++){const me=ce+G;if(me<0||me>=y)continue;const ge=Y+me*l[2],ve=me*S,Ne=Math.min(f-1,i?Math.round(ve):Math.floor(ve));U===Ne&&(H+=b[ge+z])}}w[X+z]=H}}}}return t.makeTensorInfo(r.shape,r.dtype,w)}const BH={kernelName:c1,backendName:"cpu",kernelFunc:zH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VH(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{dims:o}=s;Fe(r,"reverse");const i=r.shape.length,a=rt(o,r.shape);if(i===0)return so({inputs:{x:r},backend:t});const l=new Rn(r.shape,r.dtype),u=t.bufferSync(r);for(let d=0;d<l.size;d++){const f=l.indexToLoc(d),m=f.slice();a.forEach(g=>m[g]=r.shape[g]-1-m[g]),l.set(u.get(...m),...f)}return t.makeTensorInfo(l.shape,l.dtype,l.values)}const WH={kernelName:fm,backendName:"cpu",kernelFunc:VH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UH={kernelName:x1,backendName:"cpu",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{image:s}=n,{radians:r,fillValue:o,center:i}=e,a=t,l=_n(s.dtype,pe(s.shape)),[u,d,f,m]=s.shape,[g,y]=iv(i,d,f),w=255,b=Math.sin(r),k=Math.cos(r),v=a.data.get(s.dataId).values;for(let S=0;S<u;S++){const $=S*f*d*m;for(let R=0;R<d;R++){const M=R*(f*m);for(let A=0;A<f;A++){const P=A*m;for(let D=0;D<m;D++){const E=[u,R,A,D],j=E[2],V=E[1];let W=(j-g)*k-(V-y)*b,U=(j-g)*b+(V-y)*k;W=Math.round(W+g),U=Math.round(U+y);let X=o;if(typeof o!="number"&&(D===3?X=w:X=o[D]),W>=0&&W<f&&U>=0&&U<d){const G=U*(f*m),z=W*m,H=$+G+z+D;X=v[H]}const ee=$+M+P+D;l[ee]=X}}}}return{dataId:a.write(l,s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GH=wt(ad,n=>{const e=Math.floor(n);return n-e<.5?Math.floor(n):n-e>.5?Math.ceil(n):e%2===0?e:e+1}),HH={kernelName:ad,backendName:"cpu",kernelFunc:GH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qH(n){const{inputs:e,backend:t,attrs:s}=n,{indices:r,updates:o}=e,{shape:i}=s,{sliceRank:a,numUpdates:l,sliceSize:u,strides:d,outputSize:f}=va(o,r,i),m=!0,g=t.bufferSync(r),y=t.bufferSync(o),w=Hi(g,y,i,f,u,l,a,d,0,m);return t.makeTensorInfo(i,w.dtype,w.values)}const KH={kernelName:gN,backendName:"cpu",kernelFunc:qH};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XH(n,e){let t=0,s=n.length,r=0;for(;t<s;)r=Math.floor((t+s)/2),n[r]<e?t=r+1:s=r;return s}function QH(n,e){let t=0,s=n.length,r=0;for(;t<s;)r=Math.floor((t+s)/2),n[r]<=e?t=r+1:s=r;return s}function YH(n,e,t,s,r,o){const i=Qt("int32",t*r);for(let a=0;a<t;++a){const l=n.slice(a*s,(a+1)*s),u=a*r;for(let d=0;d<r;++d)i[u+d]=o==="left"?XH(l,e[d+u]):QH(l,e[d+u])}return i}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JH(n){const{inputs:e,backend:t,attrs:s}=n,{sortedSequence:r,values:o}=e,{side:i}=s,a=t.data.get(r.dataId).values,l=t.data.get(o.dataId).values,u=YH(a,l,r.shape[0],r.shape[1],o.shape[1],i);return t.makeTensorInfo(o.shape,"int32",u)}const ZH={kernelName:yN,backendName:"cpu",kernelFunc:JH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function e9(n){const{inputs:e,backend:t}=n,{condition:s,t:r,e:o}=e;Fe([s,r,o],"select");const i=s.shape.length,a=t.data.get(s.dataId).values,l=t.data.get(r.dataId).values,u=t.data.get(o.dataId).values,d=As(r.dtype,o.dtype),f=zn(pe(r.shape),d);let m=0;const g=i===0||i>1||r.shape.length===1?1:pe(r.shape.slice(1));for(let y=0;y<a.length;y++)for(let w=0;w<g;w++)a[y]===1?f[m++]=l[y]:f[m++]=u[y];return t.makeTensorInfo(r.shape,d,f)}const t9={kernelName:pm,backendName:"cpu",kernelFunc:e9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const n9=Pm,s9=Fm,r9=wt(cd,n=>n>=0?s9*n:n9*(Math.exp(n)-1)),o9={kernelName:cd,backendName:"cpu",kernelFunc:r9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const i9=wt(hd,n=>n<0?-1:n>0?1:0),a9={kernelName:hd,backendName:"cpu",kernelFunc:i9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const l9=wt(ud,n=>Math.sin(n)),c9={kernelName:ud,backendName:"cpu",kernelFunc:l9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const u9=wt(dd,n=>Math.sinh(n)),d9={kernelName:dd,backendName:"cpu",kernelFunc:u9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const h9=11920928955078125e-23,AC=Math.log(h9)+2,f9=wt(pd,n=>{const e=n>-AC,t=n<AC,s=Math.exp(n);let r;return t?r=s:e?r=n:r=Math.log(1+s),r}),p9={kernelName:pd,backendName:"cpu",kernelFunc:f9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function m9(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockShape:o,paddings:i}=s;Fe([r],"spaceToBatchND");const a=pe(o),l=[[0,0]];l.push(...i);for(let R=1+o.length;R<r.shape.length;++R)l.push([0,0]);const u=VR.kernelFunc({inputs:{x:r},backend:t,attrs:{paddings:l,constantValue:0}}),d=$d(u.shape,o,a,!1),f=Td(d.length,o.length,!1),m=Ed(u.shape,o,a,!1),w=Tt({inputs:{x:u},backend:t,attrs:{shape:d}}),v=ys({inputs:{x:w},backend:t,attrs:{perm:f}}),$=Tt({inputs:{x:v},backend:t,attrs:{shape:m}});return t.disposeIntermediateTensorInfo(u),t.disposeIntermediateTensorInfo(w),t.disposeIntermediateTensorInfo(v),$}const g9={kernelName:xm,backendName:"cpu",kernelFunc:m9};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function x9(n){const{inputs:e,backend:t}=n,{indices:s,values:r,denseShape:o,defaultValue:i}=e;if(o.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
        ${o.shape}`);if(s.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
        ${s.shape}`);if(r.shape.length!==1)throw new Error(`Values must be a vector, saw:
        ${r.shape}`);if(i.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${i.shape}`);const a=t.data.get(s.dataId).values,l=t.data.get(r.dataId).values,u=t.data.get(o.dataId).values,d=t.data.get(i.dataId).values[0],[f,m,g,y,w]=pR(a,s.shape,s.dtype,l,r.dtype,u,d);return[t.makeTensorInfo(m,s.dtype,f),t.makeTensorInfo([m[0]],r.dtype,g),t.makeTensorInfo([y.length],"bool",new Uint8Array(y.map(b=>Number(b)))),t.makeTensorInfo([w.length],s.dtype,new Int32Array(w))]}const y9={kernelName:vN,backendName:"cpu",kernelFunc:x9};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function v9(n){const{inputs:e,backend:t}=n,{inputIndices:s,inputShape:r,newShape:o}=e;if(s.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape
        ${s.shape}`);if(r.shape.length!==1)throw new Error(`Input shape should be a vector but received shape
        ${r.shape}`);if(o.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${o.shape}`);const i=Array.from(t.data.get(r.dataId).values),a=t.data.get(s.dataId).values,l=Array.from(t.data.get(o.dataId).values),[u,d,f]=mR(a,s.shape,s.dtype,i,l);return[t.makeTensorInfo(d,s.dtype,u),t.makeTensorInfo([f.length],o.dtype,new Int32Array(f))]}const b9={kernelName:bN,backendName:"cpu",kernelFunc:v9};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function w9(n){const{inputs:e,backend:t}=n,{data:s,indices:r,segmentIds:o}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
          ${r.shape}`);if(o.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
          ${o.shape}`);if(r.shape[0]!==o.shape[0])throw new Error("segmentIds and indices should have same size.");const i=t.data.get(s.dataId).values,a=t.data.get(r.dataId).values,l=t.data.get(o.dataId).values,[u,d]=Xv(i,s.shape,s.dtype,a,l,!0);return t.makeTensorInfo(d,s.dtype,u)}const k9={kernelName:wN,backendName:"cpu",kernelFunc:w9};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function C9(n){const{inputs:e,backend:t}=n,{data:s,indices:r,segmentIds:o}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
         ${r.shape}`);if(o.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
         ${o.shape}`);if(r.shape[0]!==o.shape[0])throw new Error("segmentIds and indices should have same size.");const i=t.data.get(s.dataId).values,a=t.data.get(r.dataId).values,l=t.data.get(o.dataId).values,[u,d]=Xv(i,s.shape,s.dtype,a,l);return t.makeTensorInfo(d,s.dtype,u)}const S9={kernelName:kN,backendName:"cpu",kernelFunc:C9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function N9(n){const{inputs:e,backend:t,attrs:s}=n,{sparseIndices:r,sparseValues:o,defaultValue:i}=e,{outputShape:a}=s,{sliceRank:l,numUpdates:u,sliceSize:d,strides:f,outputSize:m}=va(o,r,a),g=!1,y=t.bufferSync(r);let w;switch(o.dtype){case"bool":{const b=t.bufferSync(o),k=!!t.data.get(i.dataId).values[0];w=Hi(y,b,a,m,d,u,l,f,k,g);break}case"float32":{const b=t.bufferSync(o),k=t.data.get(i.dataId).values[0];w=Hi(y,b,a,m,d,u,l,f,k,g);break}case"int32":{const b=t.bufferSync(o),k=t.data.get(i.dataId).values[0];w=Hi(y,b,a,m,d,u,l,f,k,g);break}case"string":{const b=t.bufferSync(o),k=ai(t.data.get(i.dataId).values[0]);w=Hi(y,b,a,m,d,u,l,f,k,g);break}default:throw new Error(`Unsupported type ${o.dtype}`)}return t.makeTensorInfo(a,w.dtype,w.values)}const I9={kernelName:CN,backendName:"cpu",kernelFunc:N9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $9(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{numOrSizeSplits:o,axis:i}=s,a=rt(i,r.shape)[0],l=wv(r,o,a),u=new Array(r.shape.length).fill(0),d=r.shape.slice();return l.map(f=>{const m=[...d];m[a]=f;const g=da({inputs:{x:r},backend:t,attrs:{begin:u,size:m}});return u[a]+=f,g})}const T9={kernelName:ym,backendName:"cpu",kernelFunc:$9};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const E9={kernelName:d1,backendName:"cpu",kernelFunc:({inputs:n,backend:e})=>{const{x:t}=n,s=e;Fe(t,"square");const r=s.data.get(t.dataId).values,o=new Float32Array(r.length);for(let a=0;a<r.length;++a){const l=r[a];o[a]=l*l}return{dataId:s.write(o,t.shape,t.dtype),shape:t.shape,dtype:t.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const R9=wt(wd,(n,e)=>{const t=e;return isNaN(n)?NaN:n>0?1:t.alpha}),A9={kernelName:wd,backendName:"cpu",kernelFunc:R9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D9(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{begin:o,end:i,strides:a,beginMask:l,endMask:u,ellipsisMask:d,newAxisMask:f,shrinkAxisMask:m}=s;Fe(r,"stridedSlice");const{finalShapeSparse:g,finalShape:y,isIdentity:w,sliceDim0:b,isSimpleSlice:k,begin:v,end:N,strides:S}=sv(r.shape,o,i,a,l,u,d,f,m);let $;if(w)$=Tt({inputs:{x:r},backend:t,attrs:{shape:y}});else if(b||k){_(r.shape.length>=1,()=>`Input must have rank at least 1, got: ${r.shape.length}`);const R=ev(v,N,S),M=da({inputs:{x:r},backend:t,attrs:{begin:v,size:R}});$=Tt({inputs:{x:M},backend:t,attrs:{shape:y}}),t.disposeIntermediateTensorInfo(M)}else{const R=t.bufferSync(r),M=yR(g,R,S,v);$=t.makeTensorInfo(y,M.dtype,M.values)}return $}const M9={kernelName:f1,backendName:"cpu",kernelFunc:D9};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function P9(n){const{inputs:e,backend:t,attrs:s}=n,{separator:r,nGramWidths:o,leftPad:i,rightPad:a,padWidth:l,preserveShortSequences:u}=s,{data:d,dataSplits:f}=e,m=t.data.get(d.dataId).values,g=t.data.get(f.dataId).values,[y,w]=vR(m,g,r,o,i,a,l,u);return[t.makeTensorInfo([y.length],"string",y),t.makeTensorInfo(f.shape,"int32",w)]}const F9={kernelName:SN,backendName:"cpu",kernelFunc:P9};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function L9(n){const{inputs:e,backend:t,attrs:s}=n,{skipEmpty:r}=s,{input:o,delimiter:i}=e;if(o.dtype!=="string")throw new Error("Input must be of datatype string");if(o.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${o.shape}`);if(i.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${i.shape}`);const a=t.data.get(o.dataId).values,l=t.data.get(i.dataId).values[0],[u,d,f]=bR(a,l,r),m=d.length;return[t.makeTensorInfo([m,2],"int32",u),t.makeTensorInfo([m],"string",d),t.makeTensorInfo([2],"int32",new Int32Array(f))]}const j9={kernelName:NN,backendName:"cpu",kernelFunc:L9};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function O9(n){const{inputs:e,backend:t,attrs:s}=n,{numBuckets:r}=s,{input:o}=e;if(o.dtype!=="string")throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");const i=t.data.get(o.dataId).values,a=wR(i,r);return t.makeTensorInfo(o.shape,"int32",a)}const _9={kernelName:IN,backendName:"cpu",kernelFunc:O9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const z9=wt(yd,n=>Math.tan(n)),B9={kernelName:yd,backendName:"cpu",kernelFunc:z9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const V9=wt(vd,n=>Math.tanh(n)),W9={kernelName:vd,backendName:"cpu",kernelFunc:V9};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U9(n){const{inputs:e,backend:t}=n,{tensor:s,indices:r,updates:o}=e,{sliceRank:i,numUpdates:a,sliceSize:l,strides:u,outputSize:d}=va(o,r,s.shape),f=!1,m=t.bufferSync(r),g=t.bufferSync(o),y=t.bufferSync(s),w=Hi(m,g,s.shape,d,l,a,i,u,y,f);return t.makeTensorInfo(s.shape,w.dtype,w.values)}const G9={kernelName:xN,backendName:"cpu",kernelFunc:U9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function H9(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{reps:o}=s;Fe(r,"tile");const i=CR(t.bufferSync(r),o);return t.makeTensorInfo(i.shape,i.dtype,i.values)}const q9={kernelName:bd,backendName:"cpu",kernelFunc:H9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function K9(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{k:o,sorted:i}=s;Fe(r,"topk");const a=t.data.get(r.dataId).values,[l,u]=NR(a,r.shape,r.dtype,o,i);return[t.makeTensorInfo(l.shape,l.dtype,l.values),t.makeTensorInfo(u.shape,u.dtype,u.values)]}const X9={kernelName:p1,backendName:"cpu",kernelFunc:K9};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Q9(n){const{inputs:e,attrs:t,backend:s}=n,{image:r,transforms:o}=e,{interpolation:i,fillMode:a,fillValue:l,outputShape:u}=t,[d,f,m,g]=r.shape,[y,w]=u??[f,m],b=[d,y,w,g],k=Ve(r.shape),v=k[0],N=k[1],S=k[2],$=Ve(b),R=$[0],M=$[1],A=$[2],P=_n(r.dtype,pe(b));P.fill(l);const D=s.data.get(r.dataId).values,E=s.data.get(o.dataId).values;for(let V=0;V<d;++V){const W=o.shape[0]===1?E:E.subarray(V*8,V*8+8);for(let U=0;U<y;++U)for(let X=0;X<w;++X)for(let ee=0;ee<g;++ee){let G;const z=W[6]*X+W[7]*U+1;if(z===0)continue;const H=(W[0]*X+W[1]*U+W[2])/z,O=(W[3]*X+W[4]*U+W[5])/z,B=DC(H,m,a),Y=DC(O,f,a);switch(i){case"nearest":G=n7(D,f,m,v,N,S,V,Y,B,ee,l);break;case"bilinear":G=s7(D,f,m,v,N,S,V,Y,B,ee,l);break;default:throw new Error(`Error in Transform: Expect 'nearest' or 'bilinear', but got ${i}`)}const oe=V*R+U*M+X*A+ee;P[oe]=G}return s.makeTensorInfo(b,r.dtype,P)}return{dataId:s.write(P,b,r.dtype),shape:r.shape,dtype:r.dtype}}const Y9={kernelName:m1,backendName:"cpu",kernelFunc:Q9};function DC(n,e,t){switch(t){case"reflect":return J9(n,e);case"wrap":return Z9(n,e);case"nearest":return t7(n,e);case"constant":default:return e7(n)}}function J9(n,e){let t=n;if(t<0)if(e<=1)t=0;else{const s=2*e;t<s&&(t=s*Math.trunc(-t/s)+t),t=t<-e?t+s:-t-1}else if(t>e-1)if(e<=1)t=0;else{const s=2*e;t-=s*Math.trunc(t/s),t>=e&&(t=s-t-1)}return Ji(0,t,e-1)}function Z9(n,e){let t=n;if(t<0)if(e<=1)t=0;else{const s=e-1;t+=e*(Math.trunc(-t/s)+1)}else if(t>e-1)if(e<=1)t=0;else{const s=e-1;t-=e*Math.trunc(t/s)}return Ji(0,t,e-1)}function e7(n,e){return n}function t7(n,e){return Ji(0,n,e-1)}function Jc(n,e,t,s,r,o,i,a,l,u,d){const f=i*s+a*r+l*o+u;return 0<=a&&a<e&&0<=l&&l<t?n[f]:d}function n7(n,e,t,s,r,o,i,a,l,u,d){const f=Math.round(a),m=Math.round(l);return Jc(n,e,t,s,r,o,i,f,m,u,d)}function s7(n,e,t,s,r,o,i,a,l,u,d){const f=Math.floor(a),m=Math.floor(l),g=f+1,y=m+1,w=(y-l)*Jc(n,e,t,s,r,o,i,f,m,u,d)+(l-m)*Jc(n,e,t,s,r,o,i,f,y,u,d),b=(y-l)*Jc(n,e,t,s,r,o,i,g,m,u,d)+(l-m)*Jc(n,e,t,s,r,o,i,g,y,u,d);return(g-a)*w+(a-f)*b}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function r7(n){const{inputs:e,attrs:t,backend:s}=n,{axis:r}=t,{x:o}=e;Fe(o,"unique");const i=s.data.get(o.dataId).values,{outputValues:a,outputShape:l,indices:u}=IR(i,r,o.shape,o.dtype);return[s.makeTensorInfo(l,o.dtype,a),s.makeTensorInfo([u.length],"int32",u)]}const o7={kernelName:g1,backendName:"cpu",kernelFunc:r7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function i7(n){const{inputs:e,backend:t,attrs:s}=n,{value:r}=e;let{axis:o}=s;o<0&&(o+=r.shape.length);const i=r.shape.length,a=r.shape[o],l=new Array(i-1);let u=0;for(let g=0;g<i;g++)g!==o&&(l[u++]=r.shape[g]);const d=new Array(i).fill(0),f=r.shape.slice();f[o]=1;const m=new Array(a);for(let g=0;g<m.length;g++){d[o]=g;const y=da({inputs:{x:r},backend:t,attrs:{begin:d,size:f}});m[g]=Tt({inputs:{x:y},backend:t,attrs:{shape:l}}),t.disposeIntermediateTensorInfo(y)}return m}const a7={kernelName:bm,backendName:"cpu",kernelFunc:i7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function l7(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,segmentIds:o}=e,{numSegments:i}=s;Fe(r,"unsortedSegmentSum");const a=r.shape.length,l=o.shape.length,u=[],d=[],f=a-l;let m=o;for(let y=0;y<f;++y){const w=ap({inputs:{input:m},backend:t,attrs:{dim:y+1}});m=w,d.push(w)}for(let y=0;y<i;++y){const w=pi(y,"int32"),b=t.makeTensorInfo([],"int32",w),k=BE({inputs:{a:b,b:m},backend:t}),v=hi({inputs:{x:k},backend:t,attrs:{dtype:"float32"}}),N=Km({inputs:{a:v,b:r},backend:t}),S=Od({inputs:{x:N},backend:t,attrs:{axis:0,keepDims:!1}});u.push(S),d.push(b),d.push(k),d.push(v),d.push(N),d.push(S)}const g=BR({inputs:u,backend:t,attrs:{axis:0}});return d.forEach(y=>t.disposeIntermediateTensorInfo(y)),g}const c7={kernelName:wm,backendName:"cpu",kernelFunc:l7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const u7=[rU,O6,iU,lU,U6,uU,hU,pU,gU,yU,bU,kU,SU,$U,EU,DU,PU,LU,OU,nU,zU,VU,UU,H6,HU,V6,K6,KU,_6,QU,JU,ZU,tG,sG,oG,aG,cG,dG,fG,mG,xG,vG,wG,CG,SG,IG,TG,RG,AG,DG,MG,FG,OG,XW,zG,X6,KG,Q6,XG,J6,t8,n8,r8,eW,nW,i8,l8,u8,h8,rW,iW,z6,p8,YU,g8,y8,b8,QW,lW,uW,k8,hW,S8,$8,E8,D8,P8,L8,j8,pW,_8,B8,W8,G8,q8,X8,Y8,gW,Z8,nH,oH,yW,bW,lH,dH,pH,kW,gH,yH,vH,VR,CH,JW,NW,NH,$H,EH,AH,B6,ly,MH,ZW,eU,tU,FH,jH,_H,BH,WH,UH,HH,MW,KH,ZH,t9,o9,FW,a9,c9,d9,LW,sH,p9,g9,y9,b9,k9,S9,I9,T9,_W,E9,BW,WW,A9,M9,F9,j9,_9,qW,LG,B9,W9,G9,q9,X9,Y9,CW,o7,a7,c7,xH];for(const n of u7)TN(n);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ui={},uf={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function d7(n,e){Ui[n]=e}function Mr(n,e){if(!(n in Ui)||e!=null){const s=f7(n,e);if(s!==null)Ui[n]=s;else return console.log("Could not get context for WebGL version",n),null}const t=Ui[n];return t==null||t.isContextLost()?(delete Ui[n],Mr(n)):(t.disable(t.DEPTH_TEST),t.disable(t.STENCIL_TEST),t.disable(t.BLEND),t.disable(t.DITHER),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SAMPLE_COVERAGE),t.enable(t.SCISSOR_TEST),t.enable(t.CULL_FACE),t.cullFace(t.BACK),Ui[n])}function h7(n){if(!de().getBool("IS_SAFARI")&&typeof OffscreenCanvas<"u"&&n===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}function f7(n,e){if(n!==1&&n!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");const t=e??h7(n);return t.addEventListener("webglcontextlost",s=>{s.preventDefault(),delete Ui[n]},!1),de().getBool("SOFTWARE_WEBGL_ENABLED")&&(uf.failIfMajorPerformanceCaveat=!1),n===1?t.getContext("webgl",uf)||t.getContext("experimental-webgl",uf):t.getContext("webgl2",uf)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var xu;(function(n){n[n.DENSE=0]="DENSE",n[n.SHARED_BATCH=1]="SHARED_BATCH"})(xu||(xu={}));var Vs;(function(n){n[n.RENDER=0]="RENDER",n[n.UPLOAD=1]="UPLOAD",n[n.PIXELS=2]="PIXELS",n[n.DOWNLOAD=3]="DOWNLOAD"})(Vs||(Vs={}));var En;(function(n){n[n.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",n[n.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",n[n.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",n[n.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",n[n.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"})(En||(En={}));function _d(n,e){return[e,n]}function p7(n,e){return n*e}function df(n){const e=pe(n),t=Math.ceil(e/4);return D0(t)}function Vl(n,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(n/2))]}function m7(n,e){const[t,s]=Vl(n,e);return t*s*4}function eb(n,e){const t=n;let s,r,o,i,a,l,u,d,f,m;return de().getNumber("WEBGL_VERSION")===2?(s=t.R32F,r=t.R16F,o=t.RGBA16F,i=t.RGBA32F,a=t.RED,u=4,d=1,f=t.HALF_FLOAT,m=t.FLOAT,l=t.RGBA8):(s=n.RGBA,r=n.RGBA,o=n.RGBA,i=t.RGBA,a=n.RGBA,u=4,d=4,f=e!=null?e.HALF_FLOAT_OES:null,m=n.FLOAT,l=n.RGBA),{internalFormatFloat:s,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:o,internalFormatPackedFloat:i,textureFormatFloat:a,downloadTextureFormat:l,downloadUnpackNumChannels:u,defaultNumChannels:d,textureTypeHalfFloat:f,textureTypeFloat:m}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Re(n,e){const t=e();return de().getBool("DEBUG")&&g7(n),t}function g7(n){const e=n.getError();if(e!==n.NO_ERROR)throw new Error("WebGL Error: "+b7(n,e))}const x7=596e-10,y7=65504;function v7(n){return!!(de().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||n===0||x7<Math.abs(n)&&Math.abs(n)<y7)}function b7(n,e){switch(e){case n.NO_ERROR:return"NO_ERROR";case n.INVALID_ENUM:return"INVALID_ENUM";case n.INVALID_VALUE:return"INVALID_VALUE";case n.INVALID_OPERATION:return"INVALID_OPERATION";case n.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case n.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case n.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return`Unknown error code ${e}`}}function hf(n,e){return Eo(n,()=>n.getExtension(e),'Extension "'+e+'" not supported on this browser.')}function w7(n,e){const t=Eo(n,()=>n.createShader(n.VERTEX_SHADER),"Unable to create vertex WebGLShader.");if(Re(n,()=>n.shaderSource(t,e)),Re(n,()=>n.compileShader(t)),n.getShaderParameter(t,n.COMPILE_STATUS)===!1)throw console.log(n.getShaderInfoLog(t)),new Error("Failed to compile vertex shader.");return t}function k7(n,e){const t=Eo(n,()=>n.createShader(n.FRAGMENT_SHADER),"Unable to create fragment WebGLShader.");if(Re(n,()=>n.shaderSource(t,e)),Re(n,()=>n.compileShader(t)),de().get("ENGINE_COMPILE_ONLY"))return t;if(n.getShaderParameter(t,n.COMPILE_STATUS)===!1)throw WR(e,n.getShaderInfoLog(t)),new Error("Failed to compile fragment shader.");return t}const C7=/ERROR: [0-9]+:([0-9]+):/g;function WR(n,e){const t=C7.exec(e);if(t==null){console.log(`Couldn't parse line number in error: ${e}`),console.log(n);return}const s=+t[1],r=n.split(`
`),o=r.length.toString().length+2,i=r.map((f,m)=>al((m+1).toString(),o)+f);let a=0;for(let f=0;f<i.length;f++)a=Math.max(i[f].length,a);const l=i.slice(0,s-1),u=i.slice(s-1,s),d=i.slice(s);console.log(l.join(`
`)),console.log(e.split(`
`)[0]),console.log(`%c ${al(u[0],a)}`,"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(d.join(`
`))}function S7(n){return Eo(n,()=>n.createProgram(),"Unable to create WebGLProgram.")}function N7(n,e){if(Re(n,()=>n.linkProgram(e)),!de().get("ENGINE_COMPILE_ONLY")&&n.getProgramParameter(e,n.LINK_STATUS)===!1)throw console.log(n.getProgramInfoLog(e)),new Error("Failed to link vertex and fragment shaders.")}function d0(n,e){if(Re(n,()=>n.validateProgram(e)),n.getProgramParameter(e,n.VALIDATE_STATUS)===!1)throw console.log(n.getProgramInfoLog(e)),new Error("Shader program validation failed.")}function I7(n,e){const t=Eo(n,()=>n.createBuffer(),"Unable to create WebGLBuffer");return Re(n,()=>n.bindBuffer(n.ARRAY_BUFFER,t)),Re(n,()=>n.bufferData(n.ARRAY_BUFFER,e,n.STATIC_DRAW)),t}function $7(n,e){const t=Eo(n,()=>n.createBuffer(),"Unable to create WebGLBuffer");return Re(n,()=>n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t)),Re(n,()=>n.bufferData(n.ELEMENT_ARRAY_BUFFER,e,n.STATIC_DRAW)),t}function T7(n){return Eo(n,()=>n.createTexture(),"Unable to create WebGLTexture.")}function E7(n,e){const t=de().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(n<=0||e<=0){const s=`[${n}x${e}]`;throw new Error("Requested texture size "+s+" is invalid.")}if(n>t||e>t){const s=`[${n}x${e}]`,r=`[${t}x${t}]`;throw new Error("Requested texture size "+s+" greater than WebGL maximum on this browser / GPU "+r+".")}}function R7(n){return Eo(n,()=>n.createFramebuffer(),"Unable to create WebGLFramebuffer.")}function MC(n,e,t,s,r,o,i){const a=n.getAttribLocation(e,t);return a===-1?!1:(Re(n,()=>n.bindBuffer(n.ARRAY_BUFFER,s)),Re(n,()=>n.vertexAttribPointer(a,r,n.FLOAT,!1,o,i)),Re(n,()=>n.enableVertexAttribArray(a)),!0)}function A7(n,e,t){L7(n,t),Re(n,()=>n.activeTexture(n.TEXTURE0+t)),Re(n,()=>n.bindTexture(n.TEXTURE_2D,e))}function D7(n,e,t){return Eo(n,()=>n.getUniformLocation(e,t),'uniform "'+t+'" not present in program.')}function M7(n,e,t){return n.getUniformLocation(e,t)}function P7(n,e,t,s){Re(n,()=>A7(n,e,s)),Re(n,()=>n.uniform1i(t,s))}function h0(n,e,t){Re(n,()=>n.bindFramebuffer(n.FRAMEBUFFER,t)),Re(n,()=>n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e,0))}function PC(n,e){Re(n,()=>n.bindFramebuffer(n.FRAMEBUFFER,e)),Re(n,()=>n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,null,0))}function ff(n){const e=n.checkFramebufferStatus(n.FRAMEBUFFER);if(e!==n.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+F7(n,e))}function F7(n,e){switch(e){case n.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case n.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return`unknown error ${e}`}}function Eo(n,e,t){const s=Re(n,()=>e());if(s==null)throw new Error(t);return s}function L7(n,e){const t=n.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,s=e+n.TEXTURE0;if(s<n.TEXTURE0||s>t){const r=`[gl.TEXTURE0, gl.TEXTURE${t}]`;throw new Error(`textureUnit must be in ${r}.`)}}function El(n,e=2){return pe(n.slice(0,n.length-e))}function Rl(n){if(n.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[n.length>1?n[n.length-2]:1,n[n.length-1]]}function pf(n){let e=[1,1,1];return n.length===0||n.length===1&&n[0]===1||(e=[El(n),...Rl(n)]),e}function j7(n,e=!1){let t=de().getNumber("WEBGL_MAX_TEXTURE_SIZE"),s=de().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");s===1/0&&de().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(s=t/2),e&&(t=t*2,s=s*2,n=n.map((a,l)=>l>=n.length-2?Iy(n[l]):n[l]),n.length===1&&(n=[2,n[0]])),n.length!==2&&(n=fi(n).newShape);let r=pe(n),o=null;n.length<=1&&r<=t?o=[1,r]:n.length===2&&n[0]<=t&&n[1]<=t?o=n:n.length===3&&n[0]*n[1]<=t&&n[2]<=t?o=[n[0]*n[1],n[2]]:n.length===3&&n[0]<=t&&n[1]*n[2]<=t?o=[n[0],n[1]*n[2]]:n.length===4&&n[0]*n[1]*n[2]<=t&&n[3]<=t?o=[n[0]*n[1]*n[2],n[3]]:n.length===4&&n[0]<=t&&n[1]*n[2]*n[3]<=t&&(o=[n[0],n[1]*n[2]*n[3]]);const i=o!=null&&Math.max(...o)>s&&Math.min(...o)<=(e?2:1)&&Math.min(...o)>0;if(o==null||i)if(e){const a=El(n);let l=2,u=2;n.length&&([l,u]=Rl(n)),r=a*(l/2)*(u/2),o=D0(r).map(d=>d*2)}else o=D0(r);return o}function mf(n){return n%2===0}function cp(n,e){if(n=n.slice(-2),e=e.slice(-2),xt(n,e)||!n.length||!e.length||n[0]===0||n[1]===0||e[0]===0||e[1]===0)return!0;if(n.length!==e.length){const t=n[n.length-1],s=e[e.length-1];if(t===s||mf(t)&&mf(s)&&(n[0]===1||e[0]===1))return!0}return n[1]===e[1]&&mf(n[0])&&mf(e[0])}let f0,p0;function O7(n){if(f0==null){const e=Mr(n);f0=e.getParameter(e.MAX_TEXTURE_SIZE)}return f0}function _7(n){if(p0==null){const e=Mr(n);p0=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,p0)}function z7(n){if(n===0)return 0;let e;const t=Mr(n);return ir(t,"EXT_disjoint_timer_query_webgl2")&&n===2?e=2:ir(t,"EXT_disjoint_timer_query")?e=1:e=0,e}function ir(n,e){return n.getExtension(e)!=null}function FC(n){try{if(Mr(n)!=null)return!0}catch(e){return console.log("Error when getting WebGL context: ",e),!1}return!1}function B7(n){if(n===0)return!1;const e=Mr(n);if(n===1){if(!ir(e,"OES_texture_float"))return!1}else if(!ir(e,"EXT_color_buffer_float"))return!1;return uy(e)}function V7(n){if(n===0)return!1;const e=Mr(n);if(n===1){if(!ir(e,"OES_texture_float")||!ir(e,"WEBGL_color_buffer_float"))return!1}else{if(ir(e,"EXT_color_buffer_float"))return uy(e);const s="EXT_color_buffer_half_float";if(ir(e,s)){const r=e.getExtension(s);return W7(e,r)}return!1}return uy(e)}function uy(n){const e=eb(n),t=n.createTexture();n.bindTexture(n.TEXTURE_2D,t),n.texImage2D(n.TEXTURE_2D,0,e.internalFormatFloat,1,1,0,e.textureFormatFloat,e.textureTypeFloat,null);const o=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,o),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0);const i=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(t),n.deleteFramebuffer(o),i}function W7(n,e){const t=eb(n,e),s=n.createTexture();n.bindTexture(n.TEXTURE_2D,s),n.texImage2D(n.TEXTURE_2D,0,t.internalFormatHalfFloat,1,1,0,t.textureFormatFloat,t.textureTypeHalfFloat,null);const i=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,i),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,s,0);const a=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(s),n.deleteFramebuffer(i),a}function U7(n){return n!==2?!1:Mr(n).fenceSync!=null}function zd(n,e){Array.isArray(n)||(n=[n]),n.forEach(t=>{t!=null&&_(t.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the WebGL backend.`)})}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Oe=de();Oe.registerFlag("HAS_WEBGL",()=>Oe.getNumber("WEBGL_VERSION")>0);Oe.registerFlag("WEBGL_VERSION",()=>FC(2)?2:FC(1)?1:0);Oe.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",()=>!1);Oe.registerFlag("WEBGL_BUFFER_SUPPORTED",()=>Oe.get("WEBGL_VERSION")===2);Oe.registerFlag("WEBGL_CPU_FORWARD",()=>!0);Oe.registerFlag("WEBGL_FORCE_F16_TEXTURES",()=>!1);Oe.registerFlag("WEBGL_PACK",()=>Oe.getBool("HAS_WEBGL"));Oe.registerFlag("WEBGL_PACK_NORMALIZATION",()=>Oe.getBool("WEBGL_PACK"));Oe.registerFlag("WEBGL_PACK_CLIP",()=>Oe.getBool("WEBGL_PACK"));Oe.registerFlag("WEBGL_PACK_DEPTHWISECONV",()=>Oe.getBool("WEBGL_PACK"));Oe.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",()=>Oe.getBool("WEBGL_PACK"));Oe.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",()=>Oe.getBool("WEBGL_PACK"));Oe.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",()=>Oe.getBool("WEBGL_PACK"));Oe.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",()=>Oe.getBool("WEBGL_PACK"));Oe.registerFlag("WEBGL_PACK_REDUCE",()=>Oe.getBool("WEBGL_PACK"));Oe.registerFlag("WEBGL_LAZILY_UNPACK",()=>Oe.getBool("WEBGL_PACK"));Oe.registerFlag("WEBGL_CONV_IM2COL",()=>Oe.getBool("WEBGL_PACK"));Oe.registerFlag("WEBGL_PACK_CONV2DTRANSPOSE",()=>Oe.getBool("WEBGL_PACK"));Oe.registerFlag("WEBGL_MAX_TEXTURE_SIZE",()=>O7(Oe.getNumber("WEBGL_VERSION")));Oe.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",()=>_7(Oe.getNumber("WEBGL_VERSION")));Oe.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",()=>{const n=Oe.getNumber("WEBGL_VERSION");return n===0?0:z7(n)});Oe.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",()=>Oe.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!BN());Oe.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",()=>B7(Oe.getNumber("WEBGL_VERSION")));Oe.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",()=>Oe.getBool("WEBGL_FORCE_F16_TEXTURES")?!1:Oe.getBool("WEBGL_RENDER_FLOAT32_CAPABLE"));Oe.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",()=>V7(Oe.getNumber("WEBGL_VERSION")));Oe.registerFlag("WEBGL_FENCE_API_ENABLED",()=>U7(Oe.getNumber("WEBGL_VERSION")));Oe.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",()=>Oe.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0);Oe.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",()=>-1,n=>{if(typeof n!="number")throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be a number but got ${n}.`);if(n<0&&n!==-1)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${n}.`)});Oe.registerFlag("WEBGL_FLUSH_THRESHOLD",()=>BN()?1:-1,n=>{if(typeof n!="number")throw new Error(`WEBGL_FLUSH_THRESHOLD must be a number but got ${n}.`);if(n<0&&n!==-1)throw new Error(`WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ${n}.`)});Oe.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",()=>128);Oe.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",()=>!1);Oe.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",()=>1e5);Oe.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",()=>128);Oe.registerFlag("WEBGL_EXP_CONV",()=>!1);Oe.registerFlag("SOFTWARE_WEBGL_ENABLED",()=>Oe.getBool("IS_TEST"));Oe.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",()=>1/0);Oe.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",()=>!1);Oe.registerFlag("WEBGL2_ISNAN_CUSTOM",()=>!1);Oe.registerFlag("ENGINE_COMPILE_ONLY",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function os(){let n,e,t,s,r,o,i,a,l,u;return de().getNumber("WEBGL_VERSION")===2?(n="#version 300 es",e="in",t="out",s="in",r="texture",o="outputColor",i="out vec4 outputColor;",a=de().getBool("WEBGL2_ISNAN_CUSTOM")?`
      bool isnan_custom(float val) {
        uint floatToUint = floatBitsToUint(val);
        return (floatToUint & 0x7fffffffu) > 0x7f800000u;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `:"",l="",u=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(n="",e="attribute",t="varying",s="varying",r="texture2D",o="gl_FragColor",i="",a=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,l=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,u=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:n,attribute:e,varyingVs:t,varyingFs:s,texture2D:r,output:o,defineOutput:i,defineSpecialNaN:a,defineSpecialInf:l,defineRound:u}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ka(n,e,t="index"){const s=Ve(e);return s.map((r,o)=>{const i=`int ${n[o]} = ${t} / ${r}`,a=o===s.length-1?`int ${n[o+1]} = ${t} - ${n[o]} * ${r}`:`index -= ${n[o]} * ${r}`;return`${i}; ${a};`}).join("")}function Xm(n,e,t="index"){const s=Ve(e);return s.map((r,o)=>{const i=`int ${n[o]} = ${t} / outShapeStrides[${o}]`,a=o===s.length-1?`int ${n[o+1]} = ${t} - ${n[o]} * outShapeStrides[${o}]`:`index -= ${n[o]} * outShapeStrides[${o}]`;return`${i}; ${a};`}).join("")}function G7(n,e){const t=n.length,s=n.map(o=>`${e}[${o}]`),r=new Array(t-1);r[t-2]=s[t-1];for(let o=t-3;o>=0;--o)r[o]=`(${r[o+1]} * ${s[o+1]})`;return r}function H7(n,e,t="index"){const s=n.map((o,i)=>i),r=G7(s,e);return r.map((o,i)=>{const a=`int ${n[i]} = ${t} / ${r[i]}`,l=i===r.length-1?`int ${n[i+1]} = ${t} - ${n[i]} * ${r[i]}`:`index -= ${n[i]} * ${r[i]}`;return`${a}; ${l};`}).join("")}function tb(n){const e=Ve(n).map(t=>t.toString());return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * ${e[0]} + coords.y * ${e[1]} + coords.z;
  }
`}function nb(){return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;
  }
`}const UR=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{getBroadcastDims:GR}=Az;function q7(n,e,t){const s=[];if(n.forEach(g=>{const y=pe(g.shapeInfo.logicalShape);if(g.shapeInfo.isUniform?s.push(`uniform float ${g.name}${y>1?`[${y}]`:""};`):(s.push(`uniform sampler2D ${g.name};`),s.push(`uniform int offset${g.name};`)),t.enableShapeUniforms){const{uniformShape:w}=sb(t.packedInputs,g.shapeInfo.logicalShape,g.shapeInfo.texShape);switch(w.length){case 1:s.push(`uniform int ${g.name}Shape;`);break;case 2:s.push(`uniform ivec2 ${g.name}Shape;`);break;case 3:s.push(`uniform ivec3 ${g.name}Shape;`);break;case 4:s.push(`uniform ivec4 ${g.name}Shape;`);break}s.push(`uniform ivec2 ${g.name}TexShape;`)}}),t.enableShapeUniforms){switch(e.logicalShape.length){case 1:s.push("uniform int outShape;");break;case 2:s.push("uniform ivec2 outShape;"),s.push("uniform int outShapeStrides;");break;case 3:s.push("uniform ivec3 outShape;"),s.push("uniform ivec2 outShapeStrides;");break;case 4:s.push("uniform ivec4 outShape;"),s.push("uniform ivec3 outShapeStrides;");break}s.push("uniform ivec2 outTexShape;")}t.customUniforms&&t.customUniforms.forEach(g=>{s.push(`uniform ${g.type} ${g.name}${g.arrayIndex?`[${g.arrayIndex}]`:""};`)});const r=s.join(`
`),o=n.map(g=>K7(g,e,t.packedInputs,t.enableShapeUniforms)).join(`
`),i=e.texShape,a=os(),l=Y7(a);let u,d,f=eq(a);return e.isPacked?(u=X7(e.logicalShape,i,t.enableShapeUniforms),d=Z7(a)):(u=Q7(e.logicalShape,i,t.enableShapeUniforms),d=J7(a)),t.packedInputs&&(f+=rq),[f,l,d,r,u,o,t.userCode].join(`
`)}function Wl(n,e=!1){const t=n.shapeInfo.logicalShape;switch(t.length){case 0:return gq(n,e);case 1:return yq(n,e);case 2:return bq(n,e);case 3:return kq(n,e);case 4:return Sq(n,e);case 5:return Nq(n);case 6:return Iq(n);default:throw new Error(`${t.length}-D input sampling is not yet supported`)}}function HR(n,e){switch(n.shapeInfo.logicalShape.length){case 0:return mq(n);case 1:return xq(n,e);case 2:return vq(n,e);case 3:return wq(n,e);default:return Cq(n,e)}}function K7(n,e,t=!1,s){let r="";t?r+=HR(n,s):r+=Wl(n,s);const o=n.shapeInfo.logicalShape,i=e.logicalShape;return o.length<=i.length&&(t?r+=$q(n,e):r+=Tq(n,e)),r}function X7(n,e,t){switch(n.length){case 0:return qR();case 1:return oq(n,e,t);case 2:return fq(n,e,t);case 3:return aq(n,e,t);default:return cq(n,e,t)}}function Q7(n,e,t){switch(n.length){case 0:return qR();case 1:return iq(n,e,t);case 2:return pq(n,e,t);case 3:return lq(n,e,t);case 4:return uq(n,e,t);case 5:return dq(n,e);case 6:return hq(n,e);default:throw new Error(`${n.length}-D output sampling is not yet supported`)}}function Y7(n){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return ${n.texture2D}(textureSampler, uv).r;
    }
  `}function J7(n){return`
    void setOutput(float val) {
      ${n.output} = vec4(val, 0, 0, 0);
    }
  `}function Z7(n){return`
    void setOutput(vec4 val) {
      ${n.output} = val;
    }
  `}function eq(n){return`${n.version}
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    ${n.varyingFs} vec2 resultUV;
    ${n.defineOutput}
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    ${n.defineSpecialNaN}
    ${n.defineSpecialInf}
    ${n.defineRound}

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    ${tq}
    ${nq}
    ${sq}
  `}const tq=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,nq=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,sq=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,rq=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function qR(){return`
    int getOutputCoords() {
      return 0;
    }
  `}function oq(n,e,t){const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];return s[0]===1?t?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ${s[1]}.0);
      }
    `:s[1]===1?t?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ${s[0]}.0);
      }
    `:t?`
    int getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      return 2 * (resTexRC.x * ${s[1]} + resTexRC.y);
    }
  `}function iq(n,e,t){return e[0]===1?t?`
      int getOutputCoords() {
        return int(resultUV.x * float(outTexShape[1]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.x * ${e[1]}.0);
      }
    `:e[1]===1?t?`
      int getOutputCoords() {
        return int(resultUV.y * float(outTexShape[0]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.y * ${e[0]}.0);
      }
    `:t?`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      return resTexRC.x * outTexShape[1] + resTexRC.y;
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      return resTexRC.x * ${e[1]} + resTexRC.y;
    }
  `}function aq(n,e,t){if(t)return`
    ivec3 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec3(b, r, c);
    }
  `;const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],r=Math.ceil(n[2]/2),o=r*Math.ceil(n[1]/2);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      int index = resTexRC.x * ${s[1]} + resTexRC.y;

      int b = index / ${o};
      index -= b * ${o};

      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec3(b, r, c);
    }
  `}function lq(n,e,t){if(t)return`
  ivec3 getOutputCoords() {
    ivec2 resTexRC = ivec2(resultUV.yx *
                           vec2(outTexShape[0], outTexShape[1]));
    int index = resTexRC.x * outTexShape[1] + resTexRC.y;
    ${Xm(["r","c","d"],n)}
    return ivec3(r, c, d);
  }
`;const s=ka(["r","c","d"],n);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${s}
      return ivec3(r, c, d);
    }
  `}function cq(n,e,t){if(t)return`
    ivec4 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatchN = texelsInBatch * outShape[1];

      int b2 = index / texelsInBatchN;
      index -= b2 * texelsInBatchN;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec4(b2, b, r, c);
    }
  `;const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],r=Math.ceil(n[n.length-1]/2),o=r*Math.ceil(n[n.length-2]/2);let i=o,a="",l="b, r, c";for(let u=2;u<n.length-1;u++)i*=n[n.length-u-1],a=`
      int b${u} = index / ${i};
      index -= b${u} * ${i};
    `+a,l=`b${u}, `+l;return`
    ivec${n.length} getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      int index = resTexRC.x * ${s[1]} + resTexRC.y;

      ${a}

      int b = index / ${o};
      index -= b * ${o};

      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec${n.length}(${l});
    }
  `}function uq(n,e,t){if(t)return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      ${Xm(["r","c","d","d2"],n)}
      return ivec4(r, c, d, d2);
    }
  `;const s=ka(["r","c","d","d2"],n);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${s}
      return ivec4(r, c, d, d2);
    }
  `}function dq(n,e){const t=ka(["r","c","d","d2","d3"],n);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(${e[0]},
                             ${e[1]}));

      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${t}

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}function hq(n,e){const t=ka(["r","c","d","d2","d3","d4"],n);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${t}

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}function fq(n,e,t){const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];if(xt(n,e))return t?`
      ivec2 getOutputCoords() {
        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(${s[0]}, ${s[1]}));
      }
    `;const r=Math.ceil(n[1]/2);return t?`
    ivec2 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));

      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;
      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));

      int index = resTexRC.x * ${s[1]} + resTexRC.y;
      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec2(r, c);
    }
  `}function pq(n,e,t){return xt(n,e)?t?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(${e[0]}, ${e[1]}));
      }
    `:n[1]===1?t?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(index, 0);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(index, 0);
      }
    `:n[0]===1?t?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(0, index);
      }
    `:t?`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      int r = index / outShape[1];
      int c = index - r * outShape[1];
      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      int r = index / ${n[1]};
      int c = index - r * ${n[1]};
      return ivec2(r, c);
    }
  `}function Ca(n){return`offset${n}`}function mq(n){const e=n.name,t="get"+e.charAt(0).toUpperCase()+e.slice(1),s=os();return`
    vec4 ${t}() {
      return ${s.texture2D}(${e}, halfCR);
    }
  `}function gq(n,e){const t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1);if(n.shapeInfo.isUniform)return`float ${s}() {return ${t};}`;const[r,o]=n.shapeInfo.texShape;if(r===1&&o===1)return`
      float ${s}() {
        return sampleTexture(${t}, halfCR);
      }
    `;const i=Ca(t);if(e)return`
    float ${s}() {
      vec2 uv = uvFromFlat(${t}TexShape[0], ${t}TexShape[1], ${i});
      return sampleTexture(${t}, uv);
    }
  `;const[a,l]=n.shapeInfo.texShape;return`
    float ${s}() {
      vec2 uv = uvFromFlat(${a}, ${l}, ${i});
      return sampleTexture(${t}, uv);
    }
  `}function xq(n,e){const t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1),r=n.shapeInfo.texShape,o=os();if(e)return`
    vec4 ${s}(int index) {
      ivec2 packedTexShape = ivec2(ceil(float(${t}TexShape[0]) / 2.0), ceil(float(${t}TexShape[1]) / 2.0));
      vec2 uv = packedUVfrom1D(
        packedTexShape[0], packedTexShape[1], index);
      return ${o.texture2D}(${t}, uv);
    }
  `;const i=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)];return`
    vec4 ${s}(int index) {
      vec2 uv = packedUVfrom1D(
        ${i[0]}, ${i[1]}, index);
      return ${o.texture2D}(${t}, uv);
    }
  `}function yq(n,e){const t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1);if(n.shapeInfo.isUniform)return`
      float ${s}(int index) {
        ${Ul(n)}
      }
    `;const r=n.shapeInfo.texShape,o=r[0],i=r[1];if(i===1&&o===1)return`
      float ${s}(int index) {
        return sampleTexture(${t}, halfCR);
      }
    `;const a=Ca(t);return i===1?e?`
      float ${s}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / float(${t}TexShape[0]));
        return sampleTexture(${t}, uv);
      }
    `:`
      float ${s}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / ${o}.0);
        return sampleTexture(${t}, uv);
      }
    `:o===1?e?`
      float ${s}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / float(${t}TexShape[1]), 0.5);
        return sampleTexture(${t}, uv);
      }
    `:`
      float ${s}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / ${i}.0, 0.5);
        return sampleTexture(${t}, uv);
      }
    `:e?`
    float ${s}(int index) {
      vec2 uv = uvFromFlat(${t}TexShape[0], ${t}TexShape[1], index + ${a});
      return sampleTexture(${t}, uv);
    }
  `:`
    float ${s}(int index) {
      vec2 uv = uvFromFlat(${o}, ${i}, index + ${a});
      return sampleTexture(${t}, uv);
    }
  `}function vq(n,e){const t=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),o=n.shapeInfo.texShape,i=o[0],a=o[1],l=os();if(o!=null&&xt(t,o))return e?`
      vec4 ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);

        return ${l.texture2D}(${s}, uv);
      }
    `:`
      vec4 ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${a}.0, ${i}.0);

        return ${l.texture2D}(${s}, uv);
      }
    `;if(e)return`
    vec4 ${r}(int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${s}TexShape[0]) / 2.0), ceil(float(${s}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${s}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);
      return ${l.texture2D}(${s}, uv);
    }
  `;const u=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)],d=Math.ceil(t[1]/2);return`
    vec4 ${r}(int row, int col) {
      vec2 uv = packedUVfrom2D(${d}, ${u[0]}, ${u[1]}, row, col);
      return ${l.texture2D}(${s}, uv);
    }
  `}function bq(n,e){const t=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),o=n.shapeInfo.texShape;if(o!=null&&xt(t,o)){if(e)return`
      float ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `;const m=o[0],g=o[1];return`
    float ${r}(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(${g}.0, ${m}.0);
      return sampleTexture(${s}, uv);
    }
  `}const{newShape:i,keptDims:a}=fi(t),l=i;if(l.length<t.length){const m=Gl(n,l),g=["row","col"];return`
      ${Wl(m,e)}
      float ${r}(int row, int col) {
        return ${r}(${Hl(g,a)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${r}(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(${t[1]}, 1)));
        ${Ul(n)}
      }
    `;const u=o[0],d=o[1],f=Ca(s);return d===1?e?`
      float ${r}(int row, int col) {
        float index = dot(vec3(row, col, ${f}), vec3(${s}Shape[1], 1, 1));
        vec2 uv = vec2(0.5, (index + 0.5) / float(${s}TexShape[0]));
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${r}(int row, int col) {
      float index = dot(vec3(row, col, ${f}), vec3(${t[1]}, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / ${u}.0);
      return sampleTexture(${s}, uv);
    }
  `:u===1?e?`
      float ${r}(int row, int col) {
        float index = dot(vec3(row, col, ${f}), vec3(${s}Shape[1], 1, 1));
        vec2 uv = vec2((index + 0.5) / float(${s}TexShape[1]), 0.5);
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${r}(int row, int col) {
      float index = dot(vec3(row, col, ${f}), vec3(${t[1]}, 1, 1));
      vec2 uv = vec2((index + 0.5) / ${d}.0, 0.5);
      return sampleTexture(${s}, uv);
    }
  `:e?`
      float ${r}(int row, int col) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${s}Shape[1] + col + ${f};
        vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index);
        return sampleTexture(${s}, uv);
      }
    `:`
  float ${r}(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * ${t[1]} + col + ${f};
    vec2 uv = uvFromFlat(${u}, ${d}, index);
    return sampleTexture(${s}, uv);
  }
`}function wq(n,e){const t=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),o=n.shapeInfo.texShape,i=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)];if(t[0]===1){const m=t.slice(1),g=[1,2],y=Gl(n,m),w=["b","row","col"];return`
        ${HR(y,e)}
        vec4 ${r}(int b, int row, int col) {
          return ${r}(${Hl(w,g)});
        }
      `}const a=os();if(e)return`
    vec4 ${r}(int b, int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${s}TexShape[0]) / 2.0), ceil(float(${s}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${s}Shape[2]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${s}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom3D(
        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);
      return ${a.texture2D}(${s}, uv);
    }
  `;const l=i[0],u=i[1],d=Math.ceil(t[2]/2),f=d*Math.ceil(t[1]/2);return`
    vec4 ${r}(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        ${l}, ${u}, ${f}, ${d}, b, row, col);
      return ${a.texture2D}(${s}, uv);
    }
  `}function kq(n,e){const t=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),o=t[1]*t[2],i=t[2],{newShape:a,keptDims:l}=fi(t),u=a;if(u.length<t.length){const w=Gl(n,u),b=["row","col","depth"];return`
        ${Wl(w,e)}
        float ${r}(int row, int col, int depth) {
          return ${r}(${Hl(b,l)});
        }
      `}if(n.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(${o}, ${i}, 1)));
        ${Ul(n)}
      }
    `;const d=n.shapeInfo.texShape,f=d[0],m=d[1],g=n.shapeInfo.flatOffset;if(m===o&&g==null)return e?`
      float ${r}(int row, int col, int depth) {
        int stride1 = ${s}Shape[2];
        float texR = float(row);
        float texC = dot(vec2(col, depth), vec2(stride1, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
        float ${r}(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(${i}, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(${m}.0, ${f}.0);
          return sampleTexture(${s}, uv);
        }
      `;if(m===i&&g==null)return e?`
      float ${r}(int row, int col, int depth) {
        float texR = dot(vec2(row, col), vec2(${s}Shape[1], 1));
        float texC = float(depth);
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${r}(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(${t[1]}, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${m}.0, ${f}.0);
      return sampleTexture(${s}, uv);
    }
  `;const y=Ca(s);return e?`
    float ${r}(int row, int col, int depth) {
      // Explicitly use integer operations as dot() only works on floats.
      int stride0 = ${s}Shape[1] * ${s}Shape[2];
      int stride1 = ${s}Shape[2];
      int index = row * stride0 + col * stride1 + depth + ${y};
      vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index);
      return sampleTexture(${s}, uv);
    }
    `:`
      float ${r}(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${o} + col * ${i} + depth + ${y};
        vec2 uv = uvFromFlat(${f}, ${m}, index);
        return sampleTexture(${s}, uv);
      }
  `}function Cq(n,e){const t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1),r=os();if(e)return`
    vec4 ${s}(int b2, int b, int row, int col) {
      int valuesPerRow = int(ceil(float(${t}Shape[3]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${t}Shape[2]) / 2.0));
      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);
      texelsInBatch *= ${t}Shape[1];
      index = b2 * texelsInBatch + index;
      ivec2 packedTexShape = ivec2(ceil(float(${t}TexShape[0]) / 2.0), ceil(float(${t}TexShape[1]) / 2.0));
      int texR = index / packedTexShape[1];
      int texC = index - texR * packedTexShape[1];
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ${r.texture2D}(${t}, uv);
    }
  `;const o=n.shapeInfo.logicalShape,i=o.length,a=n.shapeInfo.texShape,l=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],u=l[0],d=l[1],f=Math.ceil(o[i-1]/2);let m=f*Math.ceil(o[i-2]/2),g="int b, int row, int col",y=`b * ${m} + (row / 2) * ${f} + (col / 2)`;for(let w=2;w<i-1;w++)g=`int b${w}, `+g,m*=o[i-w-1],y=`b${w} * ${m} + `+y;return`
    vec4 ${s}(${g}) {
      int index = ${y};
      int texR = index / ${d};
      int texC = index - texR * ${d};
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${d}, ${u});
      return ${r.texture2D}(${t}, uv);
    }
  `}function Sq(n,e){const t=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),o=t[3],i=t[2]*o,a=t[1]*i,{newShape:l,keptDims:u}=fi(t);if(l.length<t.length){const v=Gl(n,l),N=["row","col","depth","depth2"];return`
      ${Wl(v,e)}
      float ${r}(int row, int col, int depth, int depth2) {
        return ${r}(${Hl(N,u)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(${a}, ${i}, ${o}, 1)));
        ${Ul(n)}
      }
    `;const d=n.shapeInfo.flatOffset,f=n.shapeInfo.texShape,m=f[0],g=f[1],y=`int stride2 = ${s}Shape[3];`,w=`int stride1 = ${s}Shape[2] * stride2;`,b=`int stride0 = ${s}Shape[1] * stride1;`;if(g===a&&d==null)return e?`
      float ${r}(int row, int col, int depth, int depth2) {
        ${y}
        ${w}
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(stride1, stride2, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(${i}, ${o}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${g}.0, ${m}.0);
        return sampleTexture(${s}, uv);
      }
    `;if(g===o&&d==null)return e?`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${s}Shape[1] * ${s}Shape[2], ${s}Shape[2], 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${t[1]*t[2]}, ${t[2]}, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${g}.0, ${m}.0);
        return sampleTexture(${s}, uv);
      }
    `;const k=Ca(s);return e?`
    float ${r}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      ${y}
      ${w}
      ${b}
      int index = row * stride0 + col * stride1 +
          depth * stride2 + depth2;
      vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index + ${k});
      return sampleTexture(${s}, uv);
    }
  `:`
    float ${r}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${i} +
          depth * ${o} + depth2;
      vec2 uv = uvFromFlat(${m}, ${g}, index + ${k});
      return sampleTexture(${s}, uv);
    }
  `}function Nq(n){const e=n.shapeInfo.logicalShape,t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1),r=e[4],o=e[3]*r,i=e[2]*o,a=e[1]*i,{newShape:l,keptDims:u}=fi(e);if(l.length<e.length){const w=Gl(n,l),b=["row","col","depth","depth2","depth3"];return`
      ${Wl(w)}
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        return ${s}(${Hl(b,u)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(${a}, ${i}, ${o}, ${r})) +
          depth3;
        ${Ul(n)}
      }
    `;const d=n.shapeInfo.flatOffset,f=n.shapeInfo.texShape,m=f[0],g=f[1];if(g===a&&d==null)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(${i}, ${o}, ${r}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${g}.0, ${m}.0);
        return sampleTexture(${t}, uv);
      }
    `;if(g===r&&d==null)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]},
               ${e[2]*e[3]}, ${e[3]}, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${g}.0, ${m}.0);
        return sampleTexture(${t}, uv);
      }
    `;const y=Ca(t);return`
    float ${s}(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${i} + depth * ${o} +
          depth2 * ${r} + depth3 + ${y};
      vec2 uv = uvFromFlat(${m}, ${g}, index);
      return sampleTexture(${t}, uv);
    }
  `}function Iq(n){const e=n.shapeInfo.logicalShape,t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1),{newShape:r,keptDims:o}=fi(e);if(r.length<e.length){const b=Gl(n,r),k=["row","col","depth","depth2","depth3","depth4"];return`
      ${Wl(b)}
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return ${s}(${Hl(k,o)});
      }
    `}const i=e[5],a=e[4]*i,l=e[3]*a,u=e[2]*l,d=e[1]*u;if(n.shapeInfo.isUniform)return`
      float ${s}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(${d}, ${u}, ${l}, ${a})) +
          dot(
            vec2(depth3, depth4),
            vec2(${i}, 1)));
        ${Ul(n)}
      }
    `;const f=n.shapeInfo.flatOffset,m=n.shapeInfo.texShape,g=m[0],y=m[1];if(y===d&&f==null)return`
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(${u}, ${l}, ${a}, ${i})) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${y}.0, ${g}.0);
        return sampleTexture(${t}, uv);
      }
    `;if(y===i&&f==null)return`
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]*e[4]},
               ${e[2]*e[3]*e[4]},
               ${e[3]*e[4]},
               ${e[4]})) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${y}.0, ${g}.0);
        return sampleTexture(${t}, uv);
      }
    `;const w=Ca(t);return`
    float ${s}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${d} + col * ${u} + depth * ${l} +
          depth2 * ${a} + depth3 * ${i} + depth4 + ${w};
      vec2 uv = uvFromFlat(${g}, ${y}, index);
      return sampleTexture(${t}, uv);
    }
  `}function Ul(n){const e=n.name,t=pe(n.shapeInfo.logicalShape);return t<2?`return ${e};`:`
    for (int i = 0; i < ${t}; i++) {
      if (i == index) {
        return ${e}[i];
      }
    }
  `}function $q(n,e){const t=n.name,s=t.charAt(0).toUpperCase()+t.slice(1),r="get"+s+"AtOutCoords",o=n.shapeInfo.logicalShape.length,i=e.logicalShape.length,a=GR(n.shapeInfo.logicalShape,e.logicalShape),l=Ct(i),u=i-o;let d;const f=["x","y","z","w","u","v"];o===0?d="":i<2&&a.length>=1?d="coords = 0;":d=a.map(v=>`coords.${f[v+u]} = 0;`).join(`
`);let m="";i<2&&o>0?m="coords":m=n.shapeInfo.logicalShape.map((v,N)=>`coords.${f[N+u]}`).join(", ");let g="return outputValue;";const w=pe(n.shapeInfo.logicalShape)===1,k=pe(e.logicalShape)===1;if(o===1&&!w&&!k)g=`
      return vec4(outputValue.xy, outputValue.xy);
    `;else if(w&&!k)i===1?g=`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:g=`
        return vec4(outputValue.x);
      `;else if(a.length){const v=o-2,N=o-1;a.indexOf(v)>-1&&a.indexOf(N)>-1?g="return vec4(outputValue.x);":a.indexOf(v)>-1?g="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":a.indexOf(N)>-1&&(g="return vec4(outputValue.xx, outputValue.zz);")}return`
    vec4 ${r}() {
      ${l} coords = getOutputCoords();
      ${d}
      vec4 outputValue = get${s}(${m});
      ${g}
    }
  `}function Tq(n,e){const t=n.name,s=t.charAt(0).toUpperCase()+t.slice(1),r="get"+s+"AtOutCoords",o=e.texShape,i=n.shapeInfo.texShape,a=n.shapeInfo.logicalShape.length,l=e.logicalShape.length;if(!n.shapeInfo.isUniform&&a===l&&n.shapeInfo.flatOffset==null&&xt(i,o))return`
      float ${r}() {
        return sampleTexture(${t}, resultUV);
      }
    `;const u=Ct(l),d=GR(n.shapeInfo.logicalShape,e.logicalShape),f=l-a;let m;const g=["x","y","z","w","u","v"];a===0?m="":l<2&&d.length>=1?m="coords = 0;":m=d.map(w=>`coords.${g[w+f]} = 0;`).join(`
`);let y="";return l<2&&a>0?y="coords":y=n.shapeInfo.logicalShape.map((w,b)=>`coords.${g[b+f]}`).join(", "),`
    float ${r}() {
      ${u} coords = getOutputCoords();
      ${m}
      return get${s}(${y});
    }
  `}function Ct(n){if(n<=1)return"int";if(n===2)return"ivec2";if(n===3)return"ivec3";if(n===4)return"ivec4";if(n===5)return"ivec5";if(n===6)return"ivec6";throw Error(`GPU for rank ${n} is not yet supported`)}function sb(n,e,t){const{newShape:s,keptDims:r}=fi(e),o=e.length,i=n&&o===3&&e[0]===1,a=i?e.slice(1):s,l=!n&&o>1&&!xt(e,t)&&s.length<o||i;return{useSqueezeShape:l,uniformShape:l?a:e,keptDims:r}}function Gl(n,e){const t=JSON.parse(JSON.stringify(n));return t.shapeInfo.logicalShape=e,t}function Hl(n,e){return e.map(t=>n[t]).join(", ")}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Eq(n,e,t,s){const r=t.map((d,f)=>{const m={logicalShape:d.shape,texShape:d.isUniform?null:d.texData.texShape,isUniform:d.isUniform,isPacked:d.isUniform?!1:d.texData.isPacked,flatOffset:null};return d.texData!=null&&d.texData.slice!=null&&d.texData.slice.flatOffset>0&&(m.flatOffset=d.texData.slice.flatOffset),{name:e.variableNames[f],shapeInfo:m}}),o=r.map(d=>d.shapeInfo),i={logicalShape:s.shape,texShape:s.texData.texShape,isUniform:!1,isPacked:s.texData.isPacked,flatOffset:null},a=q7(r,i,e),l=k7(n.gl,a),u=n.createProgram(l);return de().get("ENGINE_COMPILE_ONLY")?{program:e,fragmentShader:l,source:a,webGLProgram:u,inShapeInfos:o,outShapeInfo:i,variablesLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:(n.buildVao(u),Object.assign({program:e,fragmentShader:l,source:a,webGLProgram:u,inShapeInfos:o,outShapeInfo:i},KR(n,e,u)))}function KR(n,e,t){const s=[],r=[];let o,i,a,l=null,u=null;u=n.getUniformLocation(t,"NAN",!1),de().getNumber("WEBGL_VERSION")===1&&(l=n.getUniformLocation(t,"INFINITY",!1));const d=!1;for(const f of e.variableNames){const m={name:f,uniform:n.getUniformLocation(t,f,d),offset:n.getUniformLocation(t,`offset${f}`,d)};e.enableShapeUniforms&&(m.shape=n.getUniformLocation(t,`${f}Shape`,d),m.texShape=n.getUniformLocation(t,`${f}TexShape`,d)),s.push(m)}if(e.enableShapeUniforms&&(o=n.getUniformLocation(t,"outShape",d),a=n.getUniformLocation(t,"outShapeStrides",d),i=n.getUniformLocation(t,"outTexShape",d)),e.customUniforms)for(const f of e.customUniforms)r.push(n.getUniformLocation(t,f.name,d));return{variablesLocations:s,customUniformLocations:r,infLoc:l,nanLoc:u,outShapeLocation:o,outShapeStridesLocation:a,outTexShapeLocation:i}}function LC(n,e){if(n.length!==e.length)throw Error(`Binary was compiled with ${n.length} inputs, but was executed with ${e.length} inputs`);n.forEach((t,s)=>{const r=t.logicalShape,o=e[s],i=o.shape;if(!xt(r,i))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${r} and ${i} must match`);if(t.isUniform&&o.isUniform)return;const a=t.texShape,l=o.isUniform?null:o.texData.texShape;if(!xt(a,l))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${a} and ${l} must match`)})}function Rq(n,e,t,s,r){e.program.enableShapeUniforms||(LC(e.inShapeInfos,t),LC([e.outShapeInfo],[s]));const o=s.texData.texture,i=s.texData.texShape;s.texData.isPacked?n.setOutputPackedMatrixTexture(o.texture,i[0],i[1]):n.setOutputMatrixTexture(o.texture,i[0],i[1]),n.setProgram(e.webGLProgram),n.bindVertexArray(e.webGLProgram.vao),de().getNumber("WEBGL_VERSION")===1&&e.infLoc!==null&&n.gl.uniform1f(e.infLoc,1/0),e.nanLoc!==null&&n.gl.uniform1f(e.nanLoc,NaN);for(let l=0;l<t.length;++l){const u=t[l],{uniform:d,offset:f,shape:m,texShape:g}=e.variablesLocations[l];if(m){const{uniformShape:y}=sb(e.program.packedInputs,u.shape,u.texData.texShape);switch(y.length){case 1:n.gl.uniform1iv(m,new Int32Array(y));break;case 2:n.gl.uniform2iv(m,new Int32Array(y));break;case 3:n.gl.uniform3iv(m,new Int32Array(y));break;case 4:n.gl.uniform4iv(m,new Int32Array(y));break}}if(g&&n.gl.uniform2i(g,u.texData.texShape[0],u.texData.texShape[1]),d!=null){if(u.isUniform){if(pe(u.shape)<2)n.gl.uniform1f(d,u.uniformValues[0]);else{let y=u.uniformValues;y instanceof Float32Array||(y=new Float32Array(y)),n.gl.uniform1fv(d,y)}continue}u.texData.slice!=null&&f!=null&&n.gl.uniform1i(f,u.texData.slice.flatOffset),n.setInputMatrixTexture(u.texData.texture.texture,d,l)}}const a=e.outShapeLocation;if(a)switch(s.shape.length){case 1:n.gl.uniform1iv(a,new Int32Array(s.shape));break;case 2:n.gl.uniform2iv(a,new Int32Array(s.shape));break;case 3:n.gl.uniform3iv(a,new Int32Array(s.shape));break;case 4:n.gl.uniform4iv(a,new Int32Array(s.shape));break}if(e.outShapeStridesLocation){const l=Ve(s.shape);switch(s.shape.length){case 2:n.gl.uniform1iv(e.outShapeStridesLocation,new Int32Array(l));break;case 3:n.gl.uniform2iv(e.outShapeStridesLocation,new Int32Array(l));break;case 4:n.gl.uniform3iv(e.outShapeStridesLocation,new Int32Array(l));break}}if(e.outTexShapeLocation&&n.gl.uniform2i(e.outTexShapeLocation,s.texData.texShape[0],s.texData.texShape[1]),e.program.customUniforms&&r)for(let l=0;l<e.program.customUniforms.length;++l){const u=e.program.customUniforms[l],d=e.customUniformLocations[l],f=r[l];if(u.type==="float")n.gl.uniform1fv(d,f);else if(u.type==="vec2")n.gl.uniform2fv(d,f);else if(u.type==="vec3")n.gl.uniform3fv(d,f);else if(u.type==="vec4")n.gl.uniform4fv(d,f);else if(u.type==="int")n.gl.uniform1iv(d,f);else if(u.type==="ivec2")n.gl.uniform2iv(d,f);else if(u.type==="ivec3")n.gl.uniform3iv(d,f);else if(u.type==="ivec4")n.gl.uniform4iv(d,f);else throw Error(`uniform type ${u.type} is not supported yet.`)}n.executeProgram()}function Aq(n,e,t){let s="";e.concat(t).forEach(i=>{const a=i.texData!=null&&i.texData.slice!=null&&i.texData.slice.flatOffset>0;if(n.enableShapeUniforms&&!i.isUniform){const l=i.texData.texShape,{useSqueezeShape:u,uniformShape:d,keptDims:f}=sb(n.packedInputs,i.shape,l);let m="",g="",y="";if(d.length===1&&n.packedInputs){const $=[Math.ceil(l[0]/2),Math.ceil(l[1]/2)];m=`${$[0]>1}_${$[1]>1}`}else if(d.length===2&&!n.packedInputs)g=`${d[0]>1}_${d[1]>1}`;else if(d.length>2&&!n.packedInputs){const $=Ve(d);y=`${$[0]===l[1]}_${$[$.length-1]===l[1]}`}const w=i.shape.length,b=d.length===2&&xt(i.shape,l),k=pe(i.shape)===1,v=kl(i.shape,t.shape),N=!n.packedInputs&&w===t.shape.length&&xt(l,t.texData.texShape),S=n.packedInputs||d.length>2?"":`${l[0]>1}_${l[1]>1}`;s+=`${w}_${N}_${u?f:""}_${d.length}_${k}_${v}_${b}_${m}_${g}_${y}_${S}_${a}`}else{const l=i.isUniform?"uniform":i.texData.texShape;s+=`${i.shape}_${l}_${a}`}});const r=n.userCode;let o=n.constructor.name;return o+="_"+s+"_"+r+`${de().getNumber("WEBGL_VERSION")}`,o}function Un(n){return de().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&n<=4}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Dq{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=xu.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const t=os();this.outputShape=e,this.enableShapeUniforms=Un(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?Xm(["r","c","d"],e):ka(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        ${t.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Mq{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=xu.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const t=os();this.outputShape=e,this.enableShapeUniforms=Un(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?Xm(["r","c","d"],e):ka(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        ${t.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Pq{constructor(e){this.variableNames=["A"],this.outTexUsage=Vs.DOWNLOAD;const t=os();this.outputShape=e,this.userCode=`
      ${UR}

      void main() {
        float x = getAAtOutCoords();
        ${t.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Fq{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=Vs.DOWNLOAD;const t=os();this.outputShape=e,this.userCode=`
      ${UR}

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        ${t.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lq={R:0,G:1,B:2,A:3};class jC{constructor(e,t=!1,s="RGBA"){this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];const r=os();this.outputShape=e,this.enableShapeUniforms=Un(this.outputShape.length);let o="result";t&&(o="floor(result * 255. + 0.5)");let i="";for(let a=0;a<s.length;a++){const l=s[a];i+=`
          if(offset == ${a}) {
            result = values[${Lq[l]}];
          }`}this.userCode=`
      ${this.enableShapeUniforms?nb():tb(e)}

      void main() {
        ivec3 coords = getOutputCoords();
        int flatIndex = getFlatIndex(coords);
        float result = 0.;
        int offset = imod(flatIndex, ${s.length});

        flatIndex = idiv(flatIndex, ${s.length}, 1.);

        int r = flatIndex / texShape[1];
        if (r < texShape[0]) {
          int c = imod(flatIndex, texShape[1]);
          vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
          vec4 values = ${r.texture2D}(A, uv);
          ${i}
        }
        ${r.output} = vec4(${o}, 0., 0., 0.);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class jq{constructor(e,t=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];const s=os();this.outputShape=e,this.enableShapeUniforms=Un(this.outputShape.length);let r="",o="result";t&&(o="floor(result * 255. + 0.5)");for(let i=0;i<=1;i++)for(let a=0;a<=1;a++){const l=i*2+a;r+=`
          localCoords = coords;
          if(localCoords[2] + ${a} < ${this.enableShapeUniforms?"outShape[2]":`${e[2]}`}) {
          localCoords[2] += ${a};
          if (localCoords[1] + ${i} < ${this.enableShapeUniforms?"outShape[1]":`${e[1]}`}) {
            localCoords[1] += ${i};

            flatIndex = getFlatIndex(localCoords);
            offset = imod(flatIndex, 4);

            flatIndex = idiv(flatIndex, 4, 1.);

            int r = flatIndex / texShape[1];
            int c = imod(flatIndex, texShape[1]);
            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
            values = ${s.texture2D}(A, uv);

            if (offset == 0) {
              result[${l}] = values[0];
            } else if (offset == 1) {
              result[${l}] = values[1];
            } else if (offset == 2) {
              result[${l}] = values[2];
            } else {
              result[${l}] = values[3];
            }
          }
        }
        `}this.userCode=`
        ${this.enableShapeUniforms?nb():tb(e)}

        void main() {
          ivec3 coords = getOutputCoords();

          vec4 result = vec4(0.);
          int flatIndex, r, c, offset;
          ivec3 localCoords;
          vec2 uv;
          vec4 values;

          ${r}

          ${s.output} = ${o};
        }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Oq(n){const e=os(),t=`${e.version}
    precision highp float;
    ${e.attribute} vec3 clipSpacePos;
    ${e.attribute} vec2 uv;
    ${e.varyingVs} vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`;return w7(n,t)}function _q(n){const e=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return I7(n,e)}function zq(n){const e=new Uint16Array([0,1,2,2,1,3]);return $7(n,e)}function Bd(n,e,t,s,r,o){E7(e,t);const i=T7(n),a=n.TEXTURE_2D;return Re(n,()=>n.bindTexture(a,i)),Re(n,()=>n.texParameteri(a,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE)),Re(n,()=>n.texParameteri(a,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE)),Re(n,()=>n.texParameteri(a,n.TEXTURE_MIN_FILTER,n.NEAREST)),Re(n,()=>n.texParameteri(a,n.TEXTURE_MAG_FILTER,n.NEAREST)),de().getNumber("WEBGL_VERSION")===1?Re(n,()=>n.texImage2D(a,0,s,e,t,0,r,o,null)):Re(n,()=>n.texStorage2D(a,1,s,e,t)),Re(n,()=>n.bindTexture(n.TEXTURE_2D,null)),{texture:i,texShape:[t,e]}}function XR(n){return n.internalFormatFloat}function Bq(n,e,t,s){const[r,o]=_d(e,t);return Bd(n,r,o,XR(s),s.textureFormatFloat,n.FLOAT)}function QR(n){return n.internalFormatHalfFloat}function Vq(n,e,t,s){const[r,o]=_d(e,t);return Bd(n,r,o,QR(s),s.textureFormatFloat,s.textureTypeHalfFloat)}function YR(n){return n.downloadTextureFormat}function Wq(n,e,t,s){const[r,o]=_d(e,t);return Bd(n,r,o,YR(s),n.RGBA,n.UNSIGNED_BYTE)}function JR(n){return n.internalFormatPackedFloat}function Uq(n,e,t,s){const[r,o]=Vl(e,t);return Bd(n,r,o,JR(s),n.RGBA,n.FLOAT)}function ZR(n){return n.internalFormatPackedHalfFloat}function Gq(n,e,t,s){const[r,o]=Vl(e,t);return Bd(n,r,o,ZR(s),n.RGBA,s.textureTypeHalfFloat)}function Hq(n,e,t){return Re(n,()=>n.bindBuffer(n.ARRAY_BUFFER,t)),MC(n,e,"clipSpacePos",t,3,20,0)&&MC(n,e,"uv",t,2,20,12)}function qq(n,e,t,s,r,o){Re(n,()=>n.bindTexture(n.TEXTURE_2D,e));let i,a,l;r instanceof Uint8Array?(i=new Uint8Array(t*s*4),a=n.UNSIGNED_BYTE,l=n.RGBA):(i=new Float32Array(t*s*4),a=n.FLOAT,l=o.internalFormatPackedFloat),i.set(r),de().getNumber("WEBGL_VERSION")===2?Re(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,t,s,n.RGBA,a,i)):Re(n,()=>n.texImage2D(n.TEXTURE_2D,0,l,t,s,0,n.RGBA,a,i)),Re(n,()=>n.bindTexture(n.TEXTURE_2D,null))}function Kq(n,e,t){Re(n,()=>n.bindTexture(n.TEXTURE_2D,e)),t.data instanceof Uint8Array?de().getNumber("WEBGL_VERSION")===2?Re(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,t.width,t.height,n.RGBA,n.UNSIGNED_BYTE,t.data)):Re(n,()=>n.texImage2D(n.TEXTURE_2D,0,n.RGBA,t.width,t.height,0,n.RGBA,n.UNSIGNED_BYTE,t.data)):de().getNumber("WEBGL_VERSION")===2?Re(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,t)):Re(n,()=>n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,t)),Re(n,()=>n.bindTexture(n.TEXTURE_2D,null))}function Xq(n,e,t,s){const r=n.createBuffer();Re(n,()=>n.bindBuffer(n.PIXEL_PACK_BUFFER,r));const a=4*4*e*t;return Re(n,()=>n.bufferData(n.PIXEL_PACK_BUFFER,a,n.STREAM_READ)),Re(n,()=>n.readPixels(0,0,t,e,n.RGBA,n.FLOAT,0)),Re(n,()=>n.bindBuffer(n.PIXEL_PACK_BUFFER,null)),r}function Qq(n,e,t){const s=n,r=new Float32Array(t);return s.bindBuffer(s.PIXEL_PACK_BUFFER,e),s.getBufferSubData(s.PIXEL_PACK_BUFFER,0,r),s.bindBuffer(s.PIXEL_PACK_BUFFER,null),r}function Yq(n,e,t,s){const[r,o]=_d(e,t),i=4,a=new Uint8Array(p7(e*t,i));return Re(n,()=>n.readPixels(0,0,r,o,s.downloadTextureFormat,n.UNSIGNED_BYTE,a)),new Float32Array(a.buffer)}function Jq(n,e,t,s,r,o,i,a){const l=n,u=new Float32Array(m7(o,i));return l.bindBuffer(l.PIXEL_PACK_BUFFER,e),l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,u),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),u}function Zq(n,e,t){const s=new Float32Array(e*t*4);return Re(n,()=>n.readPixels(0,0,t,e,n.RGBA,n.FLOAT,s)),s}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class m0{constructor(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.itemsToPoll=[];const t=de().getNumber("WEBGL_VERSION");if(e!=null?(this.gl=e,d7(t,e)):this.gl=Mr(t),e=this.gl,de().getNumber("WEBGL_VERSION")===2){const o=e;this.createVertexArray=()=>Re(o,()=>o.createVertexArray()),this.bindVertexArray=i=>Re(o,()=>o.bindVertexArray(i)),this.deleteVertexArray=i=>Re(o,()=>o.deleteVertexArray(i)),this.getVertexArray=()=>Re(o,()=>o.getParameter(o.VERTEX_ARRAY_BINDING))}else if(e!=null){const o=e.getExtension("OES_vertex_array_object");if(o==null)throw new Error("All WebGL1 implementations are expected to offer OES_vertex_array_object.");this.createVertexArray=()=>Re(e,()=>o.createVertexArrayOES()),this.bindVertexArray=i=>Re(e,()=>o.bindVertexArrayOES(i)),this.deleteVertexArray=i=>Re(e,()=>o.deleteVertexArrayOES(i)),this.getVertexArray=()=>Re(e,()=>e.getParameter(o.VERTEX_ARRAY_BINDING_OES))}let s="WEBGL_color_buffer_float";const r="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),de().getNumber("WEBGL_VERSION")===1){const o="OES_texture_float",i="OES_texture_half_float";if(this.textureFloatExtension=hf(this.gl,o),ir(this.gl,i))this.textureHalfFloatExtension=hf(this.gl,i);else if(de().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(s),ir(this.gl,r))this.colorBufferHalfFloatExtension=hf(this.gl,r);else if(de().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(s="EXT_color_buffer_float",ir(this.gl,s))this.colorBufferFloatExtension=this.gl.getExtension(s);else if(ir(this.gl,r))this.colorBufferHalfFloatExtension=this.gl.getExtension(r);else throw new Error("GL context does not support color renderable floats");this.vertexBuffer=_q(this.gl),this.indexBuffer=zq(this.gl),this.framebuffer=R7(this.gl),this.textureConfig=eb(this.gl,this.textureHalfFloatExtension)}get debug(){return de().getBool("DEBUG")}dispose(){if(this.disposed)return;this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");const e=this.gl;Re(e,()=>e.finish()),Re(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,null)),Re(e,()=>e.deleteFramebuffer(this.framebuffer)),Re(e,()=>e.bindBuffer(e.ARRAY_BUFFER,null)),Re(e,()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)),Re(e,()=>e.deleteBuffer(this.indexBuffer)),this.disposed=!0}createFloat32MatrixTexture(e,t){return this.throwIfDisposed(),Bq(this.gl,e,t,this.textureConfig)}createFloat16MatrixTexture(e,t){return this.throwIfDisposed(),Vq(this.gl,e,t,this.textureConfig)}createUnsignedBytesMatrixTexture(e,t){return this.throwIfDisposed(),Wq(this.gl,e,t,this.textureConfig)}uploadPixelDataToTexture(e,t){this.throwIfDisposed(),Kq(this.gl,e,t)}uploadDenseMatrixToTexture(e,t,s,r){this.throwIfDisposed(),qq(this.gl,e,t,s,r,this.textureConfig)}createFloat16PackedMatrixTexture(e,t){return this.throwIfDisposed(),Gq(this.gl,e,t,this.textureConfig)}createPackedMatrixTexture(e,t){return this.throwIfDisposed(),Uq(this.gl,e,t,this.textureConfig)}deleteMatrixTexture(e){this.throwIfDisposed(),this.outputTexture===e&&(PC(this.gl,this.framebuffer),this.outputTexture=null),Re(this.gl,()=>this.gl.deleteTexture(e))}downloadByteEncodedFloatMatrixFromOutputTexture(e,t,s){return this.downloadMatrixDriver(e,()=>Yq(this.gl,t,s,this.textureConfig))}downloadPackedMatrixFromBuffer(e,t,s,r,o,i){return Jq(this.gl,e,t,s,r,o,i,this.textureConfig)}downloadFloat32MatrixFromBuffer(e,t){return Qq(this.gl,e,t)}createBufferFromTexture(e,t,s){this.bindTextureToFrameBuffer(e);const r=Xq(this.gl,t,s,this.textureConfig);return this.unbindTextureToFrameBuffer(),r}createAndWaitForFence(){const e=this.createFence(this.gl);return this.pollFence(e)}createFence(e){let t,s;if(de().getBool("WEBGL_FENCE_API_ENABLED")){const r=e,o=r.fenceSync(r.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),s=()=>{const i=r.clientWaitSync(o,0,0);return i===r.ALREADY_SIGNALED||i===r.CONDITION_SATISFIED},t=o}else de().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),s=()=>this.isQueryAvailable(t,de().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):s=()=>!0;return{query:t,isFencePassed:s}}downloadMatrixFromPackedTexture(e,t,s){return this.downloadMatrixDriver(e,()=>Zq(this.gl,t,s))}createProgram(e){this.throwIfDisposed();const t=this.gl;this.vertexShader==null&&(this.vertexShader=Oq(t));const s=S7(t);Re(t,()=>t.attachShader(s,this.vertexShader)),Re(t,()=>t.attachShader(s,e)),N7(t,s);const r=Object.assign(s,{vao:this.createVertexArray()});return this.debug&&d0(t,r),r}buildVao(e){this.setProgram(e),this.bindVertexArray(e.vao);const t=this.gl;Re(t,()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer)),Hq(t,e,this.vertexBuffer)}deleteProgram(e){this.throwIfDisposed(),e===this.program&&(this.program=null),e!=null&&(Re(this.gl,()=>this.gl.deleteProgram(e)),this.deleteVertexArray(e.vao))}setProgram(e){this.throwIfDisposed(),this.program=e,this.program!=null&&this.debug&&d0(this.gl,this.program),Re(this.gl,()=>this.gl.useProgram(e))}getUniformLocation(e,t,s=!0){return this.throwIfDisposed(),s?D7(this.gl,e,t):M7(this.gl,e,t)}getAttributeLocation(e,t){return this.throwIfDisposed(),Re(this.gl,()=>this.gl.getAttribLocation(e,t))}getUniformLocationNoThrow(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)}setInputMatrixTexture(e,t,s){this.throwIfDisposed(),this.throwIfNoProgram(),P7(this.gl,e,t,s)}setOutputMatrixTexture(e,t,s){this.setOutputMatrixTextureDriver(e,s,t)}setOutputPackedMatrixTexture(e,t,s){this.throwIfDisposed();const[r,o]=Vl(t,s);this.setOutputMatrixTextureDriver(e,r,o)}setOutputMatrixWriteRegion(e,t,s,r){this.setOutputMatrixWriteRegionDriver(s,e,r,t)}setOutputPackedMatrixWriteRegion(e,t,s,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){this.program!=null&&d0(this.gl,this.program),ff(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();const e=this.gl;if(this.debug){const t=this.getVertexArray();console.assert(t===this.program.vao,"VAO changed between setProgram and executeProgram!"),this.debugValidate()}Re(e,()=>e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),Re(this.gl,()=>this.gl.finish())}getQueryTimerExtension(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=hf(this.gl,de().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(de().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const s=this.gl,r=this.getQueryTimerExtensionWebGL2(),o=s.createQuery();return s.beginQuery(r.TIME_ELAPSED_EXT,o),o}const e=this.getQueryTimerExtensionWebGL1(),t=e.createQueryEXT();return e.beginQueryEXT(e.TIME_ELAPSED_EXT,t),t}endQuery(){if(de().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const t=this.gl,s=this.getQueryTimerExtensionWebGL2();t.endQuery(s.TIME_ELAPSED_EXT);return}const e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(e){return await y2(()=>this.disposed||this.isQueryAvailable(e,de().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))),this.getQueryTime(e,de().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(e,t){if(t===0)return null;if(t===2){const s=this.gl;return s.getQueryParameter(e,s.QUERY_RESULT)/1e6}else{const s=this.getQueryTimerExtensionWebGL1();return s.getQueryObjectEXT(e,s.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(e,t){if(t===0)return!0;if(t===2){const s=this.gl,r=this.getQueryTimerExtensionWebGL2(),o=s.getQueryParameter(e,s.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),o&&!this.disjoint}else{const s=this.getQueryTimerExtensionWebGL1(),r=s.getQueryObjectEXT(e,s.QUERY_RESULT_AVAILABLE_EXT);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(s.GPU_DISJOINT_EXT)),r&&!this.disjoint}}pollFence(e){return new Promise(t=>{this.addItemToPoll(()=>e.isFencePassed(),()=>t())})}pollItems(){const e=eK(this.itemsToPoll.map(t=>t.isDoneFn));for(let t=0;t<=e;++t){const{resolveFn:s}=this.itemsToPoll[t];s()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}addItemToPoll(e,t){if(this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1)return;let s;"setTimeoutCustom"in de().platform&&(s=de().platform.setTimeoutCustom.bind(de().platform)),y2(()=>(this.pollItems(),this.itemsToPoll.length===0),()=>0,null,s)}bindTextureToFrameBuffer(e){this.throwIfDisposed(),h0(this.gl,e,this.framebuffer),this.debug&&ff(this.gl)}unbindTextureToFrameBuffer(){this.outputTexture!=null?(h0(this.gl,this.outputTexture,this.framebuffer),this.debug&&ff(this.gl)):PC(this.gl,this.framebuffer)}downloadMatrixDriver(e,t){this.bindTextureToFrameBuffer(e);const s=t();return this.unbindTextureToFrameBuffer(),s}setOutputMatrixTextureDriver(e,t,s){this.throwIfDisposed();const r=this.gl;h0(r,e,this.framebuffer),this.debug&&ff(r),this.outputTexture=e,Re(r,()=>r.viewport(0,0,t,s)),Re(r,()=>r.scissor(0,0,t,s))}setOutputMatrixWriteRegionDriver(e,t,s,r){this.throwIfDisposed(),Re(this.gl,()=>this.gl.scissor(e,t,s,r))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(this.program==null)throw new Error("No GPU program is currently set.")}}function eK(n){let e=0;for(;e<n.length&&n[e]();++e);return e-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{addImpl:tK,bincountImpl:eA,bincountReduceImpl:nK,bitwiseAndImpl:sK,castImpl:rK,ceilImpl:oK,concatImpl:iK,equalImpl:aK,expImpl:lK,expm1Impl:cK,floorImpl:uK,gatherNdImpl:dK,gatherV2Impl:hK,greaterImpl:fK,greaterEqualImpl:pK,lessImpl:mK,lessEqualImpl:gK,linSpaceImpl:xK,logImpl:yK,maxImpl:vK,maximumImpl:bK,minimumImpl:wK,multiplyImpl:kK,negImpl:CK,notEqualImpl:SK,prodImpl:NK,raggedGatherImpl:IK,raggedRangeImpl:$K,raggedTensorToTensorImpl:TK,rangeImpl:EK,rsqrtImpl:RK,scatterImpl:AK,sigmoidImpl:DK,simpleAbsImpl:tA,sliceImpl:MK,sparseFillEmptyRowsImpl:PK,sparseReshapeImpl:FK,sparseSegmentReductionImpl:nA,sqrtImpl:LK,staticRegexReplaceImpl:jK,stridedSliceImpl:OK,stringNGramsImpl:_K,stringSplitImpl:zK,stringToHashBucketFastImpl:BK,subImpl:VK,tileImpl:WK,topKImpl:UK,transposeImpl:rb,uniqueImpl:GK}=KW;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sA(n,e){return["x","y","z","w","u","v"].slice(0,e).map(t=>`${n}.${t}`)}function ns(n,e){return e===1?[n]:sA(n,e)}function HK(n,e){if(n===1)return"rc";let t="";for(let s=0;s<n;s++)t+=e[s],s<n-1&&(t+=",");return t}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class qK{constructor(e){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.enableShapeUniforms=Un(this.outputShape.length),this.rank===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{const t=ns("rc",this.rank),s=Ct(this.rank),r=this.getOutOfBoundsCondition(t),o=this.getSetup(t),i=this.getOutput(t);this.userCode=`
        void main() {
          ${s} rc = getOutputCoords();

          if(${r}) {
            setOutput(vec4(0));
          } else {
            ${o}

            setOutput(vec4(${i}));
          }
        }
      `}}getSourceCoordsArr(e){const t=[];for(let s=0;s<=1;s++)for(let r=0;r<=1;r++){let o=`${s===0?"r":"rp1"}, ${r===0?"c":"cp1"}`;for(let i=2;i<this.rank;i++)o=`${e[e.length-1-i]},`+o;t.push(o)}return t}getOutOfBoundsCondition(e){if(this.rank===1)return`rc > ${this.enableShapeUniforms?"outShape":this.outputShape[0]}`;let t="";for(let s=this.rank-2;s<this.rank;s++)t+=`${e[s]} >= ${this.enableShapeUniforms?`outShape[${s}]`:this.outputShape[s]}`,s<this.rank-1&&(t+="||");return t}getSetup(e){if(this.rank===1)return"";const t=e.slice(-2),s=this.enableShapeUniforms?`outShape[${this.rank} - 1]`:this.outputShape[this.rank-1],r=this.enableShapeUniforms?`outShape[${this.rank} - 2]`:this.outputShape[this.rank-2];return`
      int r = ${t[0]};
      int c = ${t[1]};
      int rp1 = r + 1;
      int cp1 = c + 1;

      bool cEdge = cp1 >= ${s};
      bool rEdge = rp1 >= ${r};
    `}getOutput(e){const t=this.getSourceCoordsArr(e);return this.rank===1?`getA(rc), (rc + 1 >= ${this.enableShapeUniforms?"outShape":this.outputShape[0]} ? 0. : getA(rc + 1)), 0, 0`:`getA(${t[0]}),
            cEdge ? 0. : getA(${t[1]}),
            rEdge ? 0. : getA(${t[2]}),
            rEdge || cEdge ? 0. : getA(${t[3]})`}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class rA{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=e,this.enableShapeUniforms=Un(this.outputShape.length);let s="";for(let r=0;r<4;r++){let o="thisRC = rc;";r%2===1&&(o+="thisRC.z += 1;"),r>1&&(o+="thisRC.y += 1;"),s+=`
        ${o}
        ${r>0?"if(thisRC.y < rows && thisRC.z < cols){":""}
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[${r}] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        ${r>0?"}":""}
      `}this.userCode=`
      ${KK(t,this.enableShapeUniforms)}
      ${this.enableShapeUniforms?nb():tb(e)}

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = ${this.enableShapeUniforms?"outShape[1]":e[1]};
        int cols = ${this.enableShapeUniforms?"outShape[2]":e[2]};

        ${s}

        setOutput(result);
      }
    `}}function KK(n,e){return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      ${e?H7(["r","c","d"],"inputShape"):ka(["r","c","d"],n)}
      return ivec3(r, c, d);
    }
  `}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class XK{constructor(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.usedTextures={},this.logEnabled=!1}acquireTexture(e,t,s){const r=_C(t,s),o=zC(e,r,s);o in this.freeTextures||(this.freeTextures[o]=[]),o in this.usedTextures||(this.usedTextures[o]=[]);const i=OC(e,r,this.gpgpu.gl,this.gpgpu.textureConfig,s);if(this.freeTextures[o].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=i,this.log();const l=this.freeTextures[o].pop();return this.usedTextures[o].push(l),l}let a;return r===En.PACKED_2X2_FLOAT32?a=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):r===En.PACKED_2X2_FLOAT16?a=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):r===En.UNPACKED_FLOAT32?a=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):r===En.UNPACKED_FLOAT16?a=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):r===En.PACKED_4X1_UNSIGNED_BYTE&&(a=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[o].push(a),this.numUsedTextures++,this._numBytesAllocated+=i,this.log(),a}releaseTexture(e,t,s,r){if(this.freeTextures==null)return;const o=_C(s,r),i=zC(t,o,r);i in this.freeTextures||(this.freeTextures[i]=[]);const a=OC(t,o,this.gpgpu.gl,this.gpgpu.textureConfig,r),l=de().getNumber("WEBGL_DELETE_TEXTURE_THRESHOLD");l!==-1&&this._numBytesAllocated>l?(this.gpgpu.deleteMatrixTexture(e.texture),this._numBytesAllocated-=a):(this.freeTextures[i].push(e),this.numFreeTextures++,this._numBytesFree+=a),this.numUsedTextures--;const u=this.usedTextures[i],d=u&&u.indexOf(e);if(d==null||d<0)throw new Error("Cannot release a texture that was never provided by this texture manager");u[d]=u[u.length-1],u.pop(),this.log()}log(){if(!this.logEnabled)return;const e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",`${this.numFreeTextures} / ${this.numUsedTextures}`,`(${e})`);const t=this._numBytesFree/this._numBytesAllocated;console.log(`Bytes allocated: ${this._numBytesAllocated}`),console.log(`Bytes unused: ${this._numBytesFree} (${Math.round(100*t)}%)`)}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(this.freeTextures!=null){for(const e in this.freeTextures)this.freeTextures[e].forEach(t=>{this.gpgpu.deleteMatrixTexture(t.texture)});for(const e in this.usedTextures)this.usedTextures[e].forEach(t=>{this.gpgpu.deleteMatrixTexture(t.texture)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}function QK(n,e){const t=n;if(e===t.R32F)return 4;if(e===t.R16F)return 2;if(e===t.RGBA32F)return 16;if(e===n.RGBA)return 16;if(e===t.RGBA16F)return 8;if(e===t.RGBA8)return 4;throw new Error(`Unknown internal format ${e}`)}function OC(n,e,t,s,r){const o=YK(e,s);let i;if(r){const[l,u]=Vl(n[0],n[1]);i=l*u}else{const[l,u]=_d(n[0],n[1]);i=l*u}const a=QK(t,o);return i*a}function YK(n,e){switch(n){case En.PACKED_2X2_FLOAT32:return JR(e);case En.PACKED_2X2_FLOAT16:return ZR(e);case En.UNPACKED_FLOAT32:return XR(e);case En.UNPACKED_FLOAT16:return QR(e);case En.PACKED_4X1_UNSIGNED_BYTE:return YR(e);default:throw new Error(`Unknown physical texture type ${n}`)}}function JK(n){return de().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?n?En.PACKED_2X2_FLOAT32:En.UNPACKED_FLOAT32:n?En.PACKED_2X2_FLOAT16:En.UNPACKED_FLOAT16}function _C(n,e){if(n===Vs.UPLOAD)return En.PACKED_2X2_FLOAT32;if(n===Vs.RENDER||n==null)return JK(e);if(n===Vs.DOWNLOAD||n===Vs.PIXELS)return En.PACKED_4X1_UNSIGNED_BYTE;throw new Error(`Unknown logical texture type ${n}`)}function zC(n,e,t){return`${n[0]}_${n[1]}_${e}_${t}`}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Hr{constructor(e,t){this.variableNames=["A"],this.outputShape=e,this.enableShapeUniforms=Un(this.outputShape.length),this.userCode=`
      float unaryOperation(float x) {
        ${t}
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `}}const hr="if (isnan(x)) return x;",ZK="return x;",BC="return abs(x);",eX="return (x >= 0.0) ? x : (exp(x) - 1.0);",tX=hr+`
  return (x < 0.0) ? 0.0 : x;
`,nX=hr+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,Yo="return x;",sX="return 1.0 / (1.0 + exp(-1.0 * x));";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rX="return x;",oX=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,iX=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,aX=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,lX="return 1.0 / (1.0 + exp(-1.0 * x));";class ti{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.enableShapeUniforms=Un(this.outputShape.length),this.userCode=`
      vec4 unaryOperation(vec4 x) {
        ${t}
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class cX{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e,this.enableShapeUniforms=Un(this.outputShape.length);const t=e.length,s=ns("rc",t),r=Ct(t),o=HK(t,s),i=s.slice(-2),a=t<=1?"rc":`vec2(${i.join(",")})`;this.userCode=`
      void main() {
        ${r} rc = getOutputCoords();
        vec4 packedInput = getA(${o});

        setOutput(getChannel(packedInput, ${a}));
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uX=$I,dX=1e-7,hX=1e-4,gf={};function fX(n){return n in gf||(gf[n]={}),gf[n]}const pX=de().getNumber("CPU_HANDOFF_SIZE_THRESHOLD"),mX=600;function gX(){return de().global.screen==null?1024:de().global.screen.height*de().global.screen.width*window.devicePixelRatio*mX/1024/1024}class Qm extends Ny{nextDataId(){return Qm.nextDataId++}constructor(e){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!de().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");let t;if(e!=null){if(e instanceof m0)t=e;else{const s=Mr(de().getNumber("WEBGL_VERSION"),e);t=new m0(s)}this.binaryCache={},this.gpgpuCreatedLocally=!1}else{const s=Mr(de().getNumber("WEBGL_VERSION"));t=new m0(s),this.binaryCache=fX(de().getNumber("WEBGL_VERSION")),this.gpgpuCreatedLocally=!0}this.gpgpu=t,this.canvas=this.gpgpu.gl.canvas,this.textureManager=new XK(this.gpgpu),this.numMBBeforeWarning=gX(),this.texData=new ZS(this,Vr())}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}writeTexture(e,t,s,r,o,i){const a=this.makeTensorInfo(t,s),l=this.texData.get(a.dataId);l.isPacked=!1,l.texture={texture:e,texShape:[r,o]},l.texShape=[r,o];const u=pf(t),d=new jC(u,!1,i),f=this.runWebGLProgram(d,[a],s,[[r,o]]);return f.shape=t,l.texture=null,this.disposeIntermediateTensorInfo(a),f.dataId}write(e,t,s){if((de().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||de().getBool("DEBUG"))&&this.checkNumericalProblems(e),s==="complex64"&&e!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");const r={id:this.nextDataId()};return this.texData.set(r,{shape:t,dtype:s,values:e,usage:Vs.UPLOAD,refCount:1}),r}refCount(e){return this.texData.has(e)?this.texData.get(e).refCount:0}incRef(e){const t=this.texData.get(e);t.refCount++}decRef(e){if(this.texData.has(e)){const t=this.texData.get(e);t.refCount--}}move(e,t,s,r,o){if(de().getBool("DEBUG")&&this.checkNumericalProblems(t),r==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:s,dtype:r,values:t,usage:Vs.UPLOAD,refCount:o})}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}readSync(e){const t=this.texData.get(e),{values:s,dtype:r,complexTensorInfos:o,slice:i,shape:a,isPacked:l}=t;if(i!=null){let m;l?m=new ti(a,Yo):m=new Hr(a,Yo);const g=this.runWebGLProgram(m,[{dataId:e,shape:a,dtype:r}],r),y=this.readSync(g.dataId);return this.disposeIntermediateTensorInfo(g),y}if(s!=null)return this.convertAndCacheOnCPU(e);if(r==="string")return s;const u=this.activeTimers!=null;let d;u&&(d=ds());let f;if(r==="complex64"){const m=this.readSync(o.real.dataId),g=this.readSync(o.imag.dataId);f=So(m,g)}else f=this.getValuesFromTexture(e);return u&&(this.downloadWaitMs+=ds()-d),this.convertAndCacheOnCPU(e,f)}async read(e){if(this.pendingRead.has(e)){const y=this.pendingRead.get(e);return new Promise(w=>y.push(w))}const t=this.texData.get(e),{values:s,shape:r,slice:o,dtype:i,complexTensorInfos:a,isPacked:l}=t;if(o!=null){let y;l?y=new ti(r,Yo):y=new Hr(r,Yo);const w=this.runWebGLProgram(y,[{dataId:e,shape:r,dtype:i}],i),b=this.read(w.dataId);return this.disposeIntermediateTensorInfo(w),b}if(s!=null)return this.convertAndCacheOnCPU(e);if(de().getBool("DEBUG")&&!de().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&de().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let u=null,d;if(i!=="complex64"&&de().get("WEBGL_BUFFER_SUPPORTED")){d=this.decode(e);const y=this.texData.get(d.dataId);u=this.gpgpu.createBufferFromTexture(y.texture.texture,...df(r))}this.pendingRead.set(e,[]),i!=="complex64"&&await this.gpgpu.createAndWaitForFence();let f;if(i==="complex64"){const y=await Promise.all([this.read(a.real.dataId),this.read(a.imag.dataId)]),w=y[0],b=y[1];f=So(w,b)}else if(u==null)f=this.getValuesFromTexture(e);else{const y=pe(r);f=this.gpgpu.downloadFloat32MatrixFromBuffer(u,y)}if(d!=null&&this.disposeIntermediateTensorInfo(d),u!=null){const y=this.gpgpu.gl;Re(y,()=>y.deleteBuffer(u))}const m=this.convertAndCacheOnCPU(e,f),g=this.pendingRead.get(e);return this.pendingRead.delete(e),g.forEach(y=>y(m)),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e)&&Vr().removeDataId(e,this),this.pendingDeletes--),m}readToGPU(e,t={}){const s=this.texData.get(e),{values:r,shape:o,slice:i,dtype:a,isPacked:l,texture:u}=s;if(a==="complex64")throw new Error("Does not support reading texture for complex64 dtype.");if(i!=null){let g;l?g=new ti(o,Yo):g=new Hr(o,Yo);const y=this.runWebGLProgram(g,[{dataId:e,shape:o,dtype:a}],a),w=this.readToGPU(y,t);return this.disposeIntermediateTensorInfo(y),w}if(u==null)throw r!=null?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");const d=this.decode(e,t.customTexShape),f=Vr().makeTensorFromTensorInfo(d),m=this.texData.get(d.dataId);return Object.assign({tensorRef:f},m.texture)}bufferSync(e){const t=this.readSync(e.dataId);if(e.dtype==="string")try{const s=t.map(r=>ai(r));return st(e.shape,e.dtype,s)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return st(e.shape,e.dtype,t)}checkNumericalProblems(e){if(e!=null)for(let t=0;t<e.length;t++){const s=e[t];if(!v7(s))throw de().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error(`The value ${s} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`):Error(`The value ${s} cannot be represented on this device.`)}}getValuesFromTexture(e){const{shape:t,dtype:s,isPacked:r}=this.texData.get(e),o=pe(t);if(de().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){const m=this.decode(e),g=this.texData.get(m.dataId),y=this.gpgpu.downloadMatrixFromPackedTexture(g.texture.texture,...df(t)).subarray(0,o);return this.disposeIntermediateTensorInfo(m),y}const i=de().getBool("WEBGL_PACK")&&r===!0,a=i?pf(t):t,l=i?new Fq(a):new Pq(a),u=this.runWebGLProgram(l,[{shape:a,dtype:s,dataId:e}],"float32"),d=this.texData.get(u.dataId),f=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(d.texture.texture,d.texShape[0],d.texShape[1]).subarray(0,o);return this.disposeIntermediateTensorInfo(u),f}timerAvailable(){return de().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}time(e){const t=this.activeTimers,s=[];let r=!1;this.programTimersStack==null?(this.programTimersStack=s,r=!0):this.activeTimers.push(s),this.activeTimers=s,e();const o=Zi(this.activeTimers.map(l=>l.query)).filter(l=>l!=null),i=Zi(this.activeTimers.map(l=>l.name)).filter(l=>l!=null);this.activeTimers=t,r&&(this.programTimersStack=null);const a={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return(async()=>{if(de().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){const l=await Promise.all(o);a.kernelMs=RM(l),a.getExtraProfileInfo=()=>l.map((u,d)=>({name:i[d],ms:u})).map(u=>`${u.name}: ${u.ms}`).join(", ")}else a.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,a})()}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return de().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:ds(),endMs:null}}endTimer(e){return de().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=ds(),e)}async getQueryTime(e){if(de().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(e);const t=e;return t.endMs-t.startMs}disposeData(e,t=!1){if(this.pendingDisposal.has(e))return!1;if(!this.texData.has(e))return!0;if(t?this.texData.get(e).refCount=0:this.texData.get(e).refCount--,!t&&this.texData.get(e).refCount>0)return!1;if(this.pendingRead.has(e))return this.pendingDisposal.add(e),this.pendingDeletes++,!1;this.releaseGPUData(e);const{complexTensorInfos:s}=this.texData.get(e);return s!=null&&(this.disposeData(s.real.dataId,t),this.disposeData(s.imag.dataId,t)),this.texData.delete(e),!0}releaseGPUData(e){const{texture:t,dtype:s,texShape:r,usage:o,isPacked:i,slice:a}=this.texData.get(e),l=a&&a.origDataId||e,u=this.dataRefCount.get(l);u>1?this.dataRefCount.set(l,u-1):(this.dataRefCount.delete(l),t!=null&&(this.numBytesInGPU-=this.computeBytes(r,s),this.textureManager.releaseTexture(t,r,o,i)));const d=this.texData.get(e);d.texture=null,d.texShape=null,d.isPacked=!1,d.slice=null}getTexture(e){return this.uploadToGPU(e),this.texData.get(e).texture.texture}getDataInfo(e){return this.texData.get(e)}shouldExecuteOnCPU(e,t=pX){return de().getBool("WEBGL_CPU_FORWARD")&&e.every(s=>this.texData.get(s.dataId).texture==null&&pe(s.shape)<t)}getGPGPUContext(){return this.gpgpu}where(e){Bs("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");const t=e.dataSync();return uX(e.shape,t)}packedUnaryOp(e,t,s){const r=new ti(e.shape,t),o=this.compileAndRun(r,[e],s);return Vr().makeTensorFromTensorInfo(o)}abs(e){if(this.shouldExecuteOnCPU([e])&&e.dtype!=="complex64"){const r=tA(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,r)}if(de().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,BC,e.dtype);const t=new Hr(e.shape,BC),s=this.compileAndRun(t,[e]);return Vr().makeTensorFromTensorInfo(s)}makeTensorInfo(e,t,s){let r;if(t==="string"&&s!=null&&s.length>0&&Iu(s[0])){const o=s.map(i=>ri(i));r=this.write(o,e,t)}else r=this.write(s,e,t);return this.texData.get(r).usage=null,{dataId:r,shape:e,dtype:t}}makeOutput(e,t,s){return Vr().makeTensorFromTensorInfo(this.makeTensorInfo(e,t,s),this)}unpackTensor(e){const t=new cX(e.shape);return this.runWebGLProgram(t,[e],e.dtype)}packTensor(e){const t=new qK(e.shape);return this.runWebGLProgram(t,[e],e.dtype,null,!0)}packedReshape(e,t){const s=[El(e.shape),...Rl(e.shape)],r={dtype:e.dtype,shape:s,dataId:e.dataId},o=[El(t),...Rl(t)],i=new rA(o,s),a=!0,l=[s],u=this.runWebGLProgram(i,[r],e.dtype,l,a);return{dataId:u.dataId,shape:t,dtype:u.dtype}}decode(e,t){const s=this.texData.get(e),{isPacked:r,shape:o,dtype:i}=s;if(t!=null){const m=pe(o),g=t[0]*t[1]*4;_(m<=g,()=>"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data.")}const a=pf(o);let l;r?l=new Mq(a):l=new Dq(a);const u=!0,d=[t??df(a)],f=this.runWebGLProgram(l,[{shape:a,dtype:i,dataId:e}],i,d,u,t);return{dtype:i,shape:o,dataId:f.dataId}}runWebGLProgram(e,t,s,r,o=!1,i){const a=this.makeTensorInfo(e.outputShape,s),l=this.texData.get(a.dataId);if(e.packedOutput&&(l.isPacked=!0),e.outPackingScheme===xu.DENSE){const k=i??df(e.outputShape);l.texShape=k.map(v=>v*2)}if(e.outTexUsage!=null&&(l.usage=e.outTexUsage),pe(a.shape)===0)return l.values=_n(a.dtype,0),a;const u=[],d=t.map(k=>{if(k.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let v=this.texData.get(k.dataId);if(v.texture==null){if(!e.packedInputs&&pe(k.shape)<=de().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:k.shape,texData:null,isUniform:!0,uniformValues:v.values};e.packedInputs&&(v.isPacked=!0,v.shape=k.shape)}if(this.uploadToGPU(k.dataId),!!v.isPacked!=!!e.packedInputs)k=v.isPacked?this.unpackTensor(k):this.packTensor(k),u.push(k),v=this.texData.get(k.dataId);else if(v.isPacked&&!cp(v.shape,k.shape)){const N=k,S=k.shape;k.shape=v.shape,k=this.packedReshape(k,S),u.push(k),v=this.texData.get(k.dataId),N.shape=S}return{shape:k.shape,texData:v,isUniform:!1}});this.uploadToGPU(a.dataId);const f={shape:a.shape,texData:l,isUniform:!1},m=Aq(e,d,f),g=this.getAndSaveBinary(m,()=>Eq(this.gpgpu,e,d,f)),y=this.activeTimers!=null;let w;y&&(w=this.startTimer()),de().get("ENGINE_COMPILE_ONLY")||Rq(this.gpgpu,g,d,f,r),u.forEach(k=>this.disposeIntermediateTensorInfo(k)),y&&(w=this.endTimer(w),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(w)}));const b=de().getNumber("WEBGL_FLUSH_THRESHOLD");if(b>0){const k=ds();k-this.lastGlFlushTime>b&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=k)}if(!de().getBool("WEBGL_LAZILY_UNPACK")&&l.isPacked&&o===!1){const k=this.unpackTensor(a);return this.disposeIntermediateTensorInfo(a),k}return a}compileAndRun(e,t,s,r,o=!1){return s=s||t[0].dtype,this.runWebGLProgram(e,t,s,r,o)}getAndSaveBinary(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]}getTextureManager(){return this.textureManager}dispose(){this.disposed||(de().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(t=>{this.gpgpu.deleteProgram(this.binaryCache[t].webGLProgram),delete this.binaryCache[t]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}floatPrecision(){return this.floatPrecisionValue==null&&(this.floatPrecisionValue=le(()=>{if(!de().get("WEBGL_RENDER_FLOAT32_ENABLED")){const e=de().getBool("DEBUG");de().set("DEBUG",!1);const t=this.abs(gt(1e-8)).dataSync()[0];if(de().set("DEBUG",e),t>0)return 32}return 16})),this.floatPrecisionValue}epsilon(){return this.floatPrecision()===32?dX:hX}uploadToGPU(e){const t=this.texData.get(e),{shape:s,dtype:r,values:o,texture:i,usage:a,isPacked:l}=t;if(i!=null)return;const u=this.activeTimers!=null;let d;u&&(d=ds());let f=t.texShape;if(f==null&&(f=j7(s,l),t.texShape=f),o!=null){const m=pf(s);let g,y=f[1],w=f[0];const b=o instanceof Uint8Array||o instanceof Uint8ClampedArray;(l||!b)&&([y,w]=Vl(f[0],f[1])),l?g=new jq(m,b):g=new jC(m,b);const k=b?[w,y]:f,v=this.makeTensorInfo(k,r),N=this.texData.get(v.dataId);b?N.usage=Vs.PIXELS:N.usage=Vs.UPLOAD,N.texShape=k,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(v.dataId),y,w,o);const S=[[w,y]],R=this.runWebGLProgram(g,[v],r,S,!0),M=this.texData.get(R.dataId);t.texShape=M.texShape,t.isPacked=M.isPacked,t.usage=M.usage,de().get("ENGINE_COMPILE_ONLY")?this.disposeData(R.dataId):(t.texture=M.texture,t.values=null,this.texData.delete(R.dataId)),this.disposeIntermediateTensorInfo(v),u&&(this.uploadWaitMs+=ds()-d)}else{const m=this.acquireTexture(f,a,r,l);t.texture=m}}convertAndCacheOnCPU(e,t){const s=this.texData.get(e),{dtype:r}=s;return t!=null&&(s.values=xX(t,r)),s.values}acquireTexture(e,t,s,r){if(this.numBytesInGPU+=this.computeBytes(e,s),!this.warnedAboutMemory&&this.numBytesInGPU>this.numMBBeforeWarning*1024*1024){const o=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${o} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(e,t,r)}computeBytes(e,t){return e[0]*e[1]*jf(t)}checkCompileCompletion(){for(const[,e]of Object.entries(this.binaryCache))this.checkCompletion_(e)}async checkCompileCompletionAsync(){const e=[];if(this.gpgpu.parallelCompilationExtension){for(const[,t]of Object.entries(this.binaryCache))e.push(this.checkCompletionAsync_(t));return Promise.all(e)}else{for(const[,t]of Object.entries(this.binaryCache)){const s=new Promise(r=>{try{this.checkCompletion_(t),r(!0)}catch(o){throw o}});e.push(s)}return Promise.all(e)}}async checkCompletionAsync_(e){return this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?this.checkCompletion_(e):(await HI(),this.checkCompletionAsync_(e))}checkCompletion_(e){if(this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.gl.LINK_STATUS)===!1)throw console.log(this.gpgpu.gl.getProgramInfoLog(e.webGLProgram)),this.gpgpu.gl.getShaderParameter(e.fragmentShader,this.gpgpu.gl.COMPILE_STATUS)===!1?(WR(e.source,this.gpgpu.gl.getShaderInfoLog(e.fragmentShader)),new Error("Failed to compile fragment shader.")):new Error("Failed to link vertex and fragment shaders.");return!0}getUniformLocations(){for(const e of Object.values(this.binaryCache)){this.gpgpu.buildVao(e.webGLProgram);const{variablesLocations:t,customUniformLocations:s,infLoc:r,nanLoc:o,outShapeLocation:i,outShapeStridesLocation:a,outTexShapeLocation:l}=KR(this.gpgpu,e.program,e.webGLProgram);e.variablesLocations=t,e.customUniformLocations=s,e.infLoc=r,e.nanLoc=o,e.outShapeLocation=i,e.outShapeStridesLocation=a,e.outTexShapeLocation=l}}createTensorFromGPUData(e,t,s){e.channels=e.channels||"RGBA";const{texture:r,height:o,width:i,channels:a}=e,l=Vr().backend;if(!l.gpgpu.gl.isTexture(r))throw new Error("The texture is invalid. Also, please make sure the texture and the TFJS WebGL backend are using the same canvas. If you want to use your own custom canvas, you have to create and use the custom TFJS WebGL backend created from the canvas through 'new tf.MathBackendWebGL(customCanvas)'.");const u=l.writeTexture(r,t,s,o,i,a);return Vr().makeTensorFromDataId(u,t,s,l)}}Qm.nextDataId=0;function xX(n,e){if(e==="float32"||e==="complex64")return n;if(e==="int32"||e==="bool"){const t=e==="int32"?new Int32Array(n.length):new Uint8Array(n.length);for(let s=0;s<t.length;++s)t[s]=Math.round(n[s]);return t}else throw new Error(`Unknown dtype ${e}`)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */VN()&&GN("webgl",()=>new Qm,2);/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ob=`
  if (isnan(a)) return a;
  if (isnan(b)) return b;
`;class ha{constructor(e,t,s){this.variableNames=["A","B"],this.outputShape=Ze(t,s),this.enableShapeUniforms=Un(this.outputShape.length),this.userCode=`
      float binaryOperation(float a, float b) {
        ${e}
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Sa=`
  result.r = isNaN.r ? NAN : result.r;
  result.g = isNaN.g ? NAN : result.g;
  result.b = isNaN.b ? NAN : result.b;
  result.a = isNaN.a ? NAN : result.a;
`;class ql{constructor(e,t,s,r=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=Ze(t,s);const o=this.outputShape.length;this.enableShapeUniforms=Un(o);let i="";if(r)if(o===0||pe(this.outputShape)===1)i=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(i=`
          ${Ct(o)} coords = getOutputCoords();
        `,o===1)this.enableShapeUniforms?i+=`
            result.y = (coords + 1) >= outShape ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `:i+=`
            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{const l=ns("coords",o);this.enableShapeUniforms?i+=`
            bool nextRowOutOfBounds =
              (${l[o-2]} + 1) >= outShape[${o} - 2];
            bool nextColOutOfBounds =
              (${l[o-1]} + 1) >= outShape[${o} - 1];
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `:i+=`
            bool nextRowOutOfBounds =
              (${l[o-2]} + 1) >= ${this.outputShape[o-2]};
            bool nextColOutOfBounds =
              (${l[o-1]} + 1) >= ${this.outputShape[o-1]};
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        ${e}
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        ${i}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ms(n){const{inputs:e,backend:t}=n,{x:s}=e;return t.incRef(s.dataId),{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}const yX={kernelName:qu,backendName:"webgl",kernelFunc:Ms};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ci(n){const{inputs:e,backend:t}=n,{real:s,imag:r}=e,o=t.makeTensorInfo(s.shape,"complex64"),i=t.texData.get(o.dataId),a=Ms({inputs:{x:s},backend:t}),l=Ms({inputs:{x:r},backend:t});return i.complexTensorInfos={real:a,imag:l},o}const vX={kernelName:Oy,backendName:"webgl",kernelFunc:Ci};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oA="return (a < 0.) ? b * a : a;",iA=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function bX(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{alpha:o}=s,i=t.makeTensorInfo([],"float32",pi(o,"float32")),a=de().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ql(iA,r.shape,i.shape):new ha(oA,r.shape,i.shape),l=t.runWebGLProgram(a,[r,i],"float32");return t.disposeIntermediateTensorInfo(i),l}const wX={kernelName:Wp,backendName:"webgl",kernelFunc:bX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aA="return (a < 0.) ? b * a : a;",lA=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function kX(n){const{inputs:e,backend:t}=n,{x:s,alpha:r}=e,o=de().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ql(lA,s.shape,r.shape):new ha(aA,s.shape,r.shape);return t.runWebGLProgram(o,[s,r],"float32")}const CX={kernelName:lm,backendName:"webgl",kernelFunc:kX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kl="if (isnan(x)) return x;";function dt({opSnippet:n,packedOpSnippet:e,cpuKernelImpl:t,dtype:s}){return({inputs:r,backend:o})=>{const{x:i}=r,a=o,l=s||i.dtype;if(a.shouldExecuteOnCPU([i])&&t!=null){const f=a.texData.get(i.dataId),m=t(f.values,l);return a.makeTensorInfo(i.shape,l,m)}const u=de().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&e!=null;let d;return u?d=new ti(i.shape,e):d=new Hr(i.shape,n),a.runWebGLProgram(d,[i],l)}}function Mn({opSnippet:n,packedOpSnippet:e,checkOutOfBounds:t=!1,supportsComplex:s=!1,cpuKernelImpl:r,dtype:o}){return({inputs:i,backend:a})=>{const{a:l,b:u}=i,d=a;if(s&&l.dtype==="complex64"){const y=d.texData.get(l.dataId),w=d.texData.get(u.dataId),[b,k]=[[y.complexTensorInfos.real,w.complexTensorInfos.real],[y.complexTensorInfos.imag,w.complexTensorInfos.imag]].map(N=>{const[S,$]=N,R={dataId:S.dataId,dtype:S.dtype,shape:l.shape},M={dataId:$.dataId,dtype:$.dtype,shape:u.shape},A=new ha(n,l.shape,u.shape);return d.runWebGLProgram(A,[R,M],As(S.dtype,$.dtype))}),v=Ci({inputs:{real:b,imag:k},backend:d});return d.disposeIntermediateTensorInfo(b),d.disposeIntermediateTensorInfo(k),v}const f=o||As(l.dtype,u.dtype);if((l.dtype==="string"||u.dtype==="string"||d.shouldExecuteOnCPU([l,u]))&&r!=null){const y=d.texData.get(l.dataId).values,w=d.texData.get(u.dataId).values,b=l.dtype==="string"?No(y):y,k=l.dtype==="string"?No(w):w,[v,N]=r(l.shape,u.shape,b,k,f),S=d.makeTensorInfo(N,f),$=d.texData.get(S.dataId);return $.values=v,S}const m=de().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&e!=null;let g;return m?g=new ql(e,l.shape,u.shape,t):g=new ha(n,l.shape,u.shape),d.runWebGLProgram(g,[l,u],f)}}function yu(n,e=!1){if(n==="linear")return e?rX:ZK;if(n==="relu")return e?iX:tX;if(n==="elu")return e?oX:eX;if(n==="relu6")return e?aX:nX;if(n==="prelu")return e?lA:aA;if(n==="leakyrelu")return e?iA:oA;if(n==="sigmoid")return e?lX:sX;throw new Error(`Activation ${n} has not been implemented for the WebGL backend.`)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class cA{constructor(e,t,s,r=!1,o=!1,i=!1,a=null,l=!1,u=!1){this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=s,this.enableShapeUniforms=Un(this.outputShape.length);const d=r?e[1]:e[2],f=Math.ceil(d/2),m=r?"i * 2, rc.y":"rc.y, i * 2",g=o?"rc.z, i * 2":"i * 2, rc.z",y=r?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],w=o?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"];let b="",k="";a&&(l?b=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${a}
        }`:u?b=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${a}
        }`:b=`vec4 activation(vec4 x) {
          ${a}
        }`,k="result = activation(result);");const v=i?"result += getBiasAtOutCoords();":"";i&&this.variableNames.push("bias"),l&&this.variableNames.push("preluActivationWeights"),u&&this.variableNames.push("leakyreluAlpha");let N="rc.x",S="rc.x";e[0]<t[0]?N=`imod(rc.x, ${e[0]})`:t[0]<e[0]&&(S=`imod(rc.x, ${t[0]})`),this.userCode=`
      ${b}
      // Don't use uniform for sharedDimensionPacked for performance.
      const float sharedDimension = ${f}.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        int batchA = ${N};
        int batchB = ${S};
        for (int i = 0; i < ${f}; i++) {
          vec4 a = getMatrixA(batchA, ${m});
          vec4 b = getMatrixB(batchB, ${g});

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (${y[0]} * ${w[0]});
          result += (${y[1]} * ${w[1]});
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        ${v}

        ${k}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VC={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"};class WC{constructor(e,t,s){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=Ze(t,s),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        ${e}
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UC="return a * b;";function ib(n){const{inputs:e,backend:t}=n,{a:s,b:r}=e,o=As(s.dtype,r.dtype);if(s.dtype==="complex64"){const a=t.texData.get(s.dataId),l=t.texData.get(r.dataId),u=new WC(VC.REAL,s.shape,r.shape),d=new WC(VC.IMAG,s.shape,r.shape),f=[{dataId:a.complexTensorInfos.real.dataId,dtype:a.complexTensorInfos.real.dtype,shape:s.shape},{dataId:a.complexTensorInfos.imag.dataId,dtype:a.complexTensorInfos.imag.dtype,shape:s.shape},{dataId:l.complexTensorInfos.real.dataId,dtype:l.complexTensorInfos.real.dtype,shape:r.shape},{dataId:l.complexTensorInfos.imag.dataId,dtype:l.complexTensorInfos.imag.dtype,shape:r.shape}],m=t.runWebGLProgram(u,f,"float32"),g=t.runWebGLProgram(d,f,"float32"),y=Ci({inputs:{real:m,imag:g},backend:t});return t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(g),y}if(t.shouldExecuteOnCPU([s,r])){const a=t.texData.get(s.dataId),l=t.texData.get(r.dataId),[u,d]=kK(s.shape,r.shape,a.values,l.values,o),f=t.makeTensorInfo(d,o),m=t.texData.get(f.dataId);return m.values=u,f}let i;return de().getBool("WEBGL_PACK_BINARY_OPERATIONS")?i=new ql(UC,s.shape,r.shape):i=new ha(UC,s.shape,r.shape),t.runWebGLProgram(i,[s,r],o)}const SX={kernelName:nd,backendName:"webgl",kernelFunc:ib};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NX(n,e,t){const s=[El(n.shape),...Rl(n.shape)],r={dtype:n.dtype,shape:s,dataId:n.dataId},o=[El(e),...Rl(e)],i=new rA(o,s),a=!0,l=[s],u=t.runWebGLProgram(i,[r],n.dtype,l,a);return{dataId:u.dataId,shape:e,dtype:u.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ee(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{shape:o}=s,i=t,a=pe(r.shape),l=tN(o,a),u=pe(l);_(a===u,()=>`The new shape (${l}) has ${u} elements and the old shape (${r.shape}) has ${a} elements. The new shape and old shape must have the same number of elements.`);const d=i.texData.get(r.dataId);return d.isPacked&&!cp(r.shape,l)&&!(d.texture!==null&&cp(d.shape,l))?NX(r,l,i):(i.incRef(r.dataId),{dataId:r.dataId,shape:l,dtype:r.dtype})}const IX={kernelName:um,backendName:"webgl",kernelFunc:Ee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class GC{constructor(e,t){this.variableNames=["x"];const{windowSize:s,batchSize:r,inSize:o,outSize:i}=e;this.outputShape=[r,i];const a=Math.floor(s/4)*4,l=s%4;let u="sumValue += dot(values, ones);";if(t!=null){const f=1/t;u=`sumValue += dot(values * ${vl(f)?f.toPrecision(2):f}, ones);`}let d="";o%s>0&&(d=`
        if (inIdx < 0 || inIdx >= ${o}) {
          return 0.0;
        }
      `),this.userCode=`
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${d}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${s};

        float sumValue = 0.0;

        for (int i = 0; i < ${a}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${u}
        }

        int inIdx = inOffset + ${a};
        if (${l===1}) {
          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);

          ${u}
        } else if (${l===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1), 0.0, 0.0);

          ${u}
        } else if (${l===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2), 0.0);

          ${u}
        }
        setOutput(sumValue);
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $X{constructor(e,t){this.variableNames=["x"];const{windowSize:s,batchSize:r,inSize:o,outSize:i}=e;this.outputShape=[r,i];let a="0.0",l="";t==="prod"?a="1.0":t==="min"?(a="1.0 / 1e-20",l="min"):t==="max"&&(a="-1.0 / 1e-20",l="max");let u=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;t==="sum"?u="sumValue":t==="prod"?u="prodValue":t==="all"?u="allValue":t==="any"&&(u="anyValue");const d=Math.floor(s/4)*4,f=s%4;let m=`
      if (${t==="sum"}) {
        sumValue += dot(values, ones);
      } else if (${t==="prod"}) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = ${l}(values, minMaxValue);
        if (${t==="min"} || ${t==="max"}) {
          minMaxValue = ${l}(values, minMaxValue);
          bvec4 isNaN = isnan(values);
          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {
            minMaxValue = vec4(NAN);
          }
        }
      }
    `,g="vec4";t==="all"?(a="1.0",m=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,g="bvec4"):t==="any"&&(a="0.0",m=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,g="bvec4");let y="";o%s>0&&(y=`
        if (inIdx < 0 || inIdx >= ${o}) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = ${a};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${y}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${s};

        vec4 minMaxValue = vec4(${a});
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < ${d}; i += 4) {
          int inIdx = inOffset + i;
          ${g} values = ${g}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${m}
        }

        int inIdx = inOffset + ${d};
        if (${f===1}) {
          ${g} values = ${g}(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          ${m}
        } else if (${f===2}) {
          ${g} values = ${g}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          ${m}
        } else if (${f===3}) {
          ${g} values = ${g}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          ${m}
        }
        setOutput(${u});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TX(n){const e=[];for(;e.length===0||e[e.length-1].outSize!==1;){const t=e.length?e[e.length-1].outSize:n[1],s=Mm(t);e.push({inSize:t,windowSize:s,outSize:Math.ceil(t/s)})}return e}function Na(n,e,t,s){const r=TX(n.shape);let o=n;for(let i=0;i<r.length;i++){const{inSize:a,windowSize:l,outSize:u}=r[i];let d,f;t==="mean"?d=i===0?new GC({windowSize:l,inSize:a,batchSize:n.shape[0],outSize:u},a):new GC({windowSize:l,inSize:a,batchSize:n.shape[0],outSize:u}):d=new $X({windowSize:l,inSize:a,batchSize:n.shape[0],outSize:u},t),f=o,o=s.runWebGLProgram(d,[o],e),f.dataId!==n.dataId&&s.disposeIntermediateTensorInfo(f)}return o}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class EX{constructor(e,t){this.variableNames=["A"];const s=new Array(e.length);for(let i=0;i<s.length;i++)s[i]=e[t[i]];this.outputShape=s,this.rank=s.length;const r=Ct(this.rank),o=RX(t);this.userCode=`
    void main() {
      ${r} resRC = getOutputCoords();
      setOutput(getA(${o}));
    }
    `}}function RX(n){const e=n.length;if(e>6)throw Error(`Transpose for rank ${e} is not yet supported`);const t=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],s=new Array(e);for(let r=0;r<n.length;r++)s[n[r]]=t[r];return s.join()}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class AX{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;const s=new Array(e.length);for(let d=0;d<s.length;d++)s[d]=e[t[d]];if(this.outputShape=s,this.rank=s.length,this.rank>6)throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);const r=Ct(this.rank),o=sA("rc",this.rank),i=new Array(this.rank);for(let d=0;d<t.length;d++)i[t[d]]=o[d];const a=`vec2(${i.slice(-2).join()})`,l=`++${o[this.rank-1]} < ${s[this.rank-1]}`,u=`getChannel(getA(${i.join()}), ${a})`;this.userCode=`
    void main() {
      ${r} rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = ${u};
      if(${l}) {
        result[1] = ${u};
      }
      --${o[this.rank-1]};
      if(++${o[this.rank-2]} < ${s[this.rank-2]}) {
        result[2] = ${u};
        if(${l}) {
          result[3] = ${u};
        }
      }
      setOutput(result);
    }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ym(n,e,t){const s=de().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new AX(n.shape,e):new EX(n.shape,e);return t.runWebGLProgram(s,[n],n.dtype)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DX(n,e,t,s){const r=e,o=n.shape.length,i=rt(r,n.shape);let a=i;const l=Bt(a,o),u=l!=null;let d=n;u&&(d=Ym(n,l,s),a=Zt(a.length,o)),Dn("sum",a,o);const[f,m]=Sn(d.shape,a);let g=f;t&&(g=an(f,i));const y=pe(m),b=pe(n.shape)/y,k=Ee({inputs:{x:d},attrs:{shape:[b,y]},backend:s}),v=y1(n.dtype),N=Na(k,v,"sum",s),S=Ee({inputs:{x:N},attrs:{shape:g},backend:s});return s.disposeIntermediateTensorInfo(k),s.disposeIntermediateTensorInfo(N),u&&s.disposeIntermediateTensorInfo(d),S}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jm(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,keepDims:i}=s;return DX(r,o,i,t)}const MX={kernelName:gm,backendName:"webgl",kernelFunc:Jm};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rs(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{perm:o}=s,i=t,a=r.shape.length,l=new Array(a);for(let d=0;d<l.length;d++)l[d]=r.shape[o[d]];let u;if(i.shouldExecuteOnCPU([r])){const f=i.texData.get(r.dataId).values,m=rb(f,r.shape,r.dtype,o,l);u=i.makeTensorInfo(l,r.dtype);const g=i.texData.get(u.dataId);g.values=m}else u=Ym(r,o,i);return u}const PX={kernelName:ll,backendName:"webgl",kernelFunc:rs};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uA=1e3;function up({a:n,b:e,transposeA:t,transposeB:s,backend:r,bias:o=null,preluActivationWeights:i=null,leakyreluAlpha:a=0,activation:l=null}){const u=n.shape.length,d=e.shape.length,f=t?n.shape[u-2]:n.shape[u-1],m=s?e.shape[d-1]:e.shape[d-2],g=t?n.shape[u-1]:n.shape[u-2],y=s?e.shape[d-2]:e.shape[d-1],w=n.shape.slice(0,-2),b=e.shape.slice(0,-2),k=pe(w),v=pe(b),S=Ze(n.shape.slice(0,-2),e.shape.slice(0,-2)).concat([g,y]);_(f===m,()=>`Error in matMul: inner shapes (${f}) and (${m}) of Tensors with shapes ${n.shape} and ${e.shape} and transposeA=${t} and transposeB=${s} must match.`);const $=t?[k,f,g]:[k,g,f],R=s?[v,y,m]:[v,m,y],M=Ee({inputs:{x:n},backend:r,attrs:{shape:$}}),A=Ee({inputs:{x:e},backend:r,attrs:{shape:R}}),P=[M,A],D=Math.max(k,v),E=t?M.shape[1]:M.shape[2],j=o!=null,V=i!=null,W=l==="leakyrelu",U=l!=null?yu(l,!0):null,X=j||V||W||U!=null;let ee;if((g===1||y===1)&&E>uA&&X===!1){let z=M,H=A;t&&(z=rs({inputs:{x:M},backend:r,attrs:{perm:[0,2,1]}}),P.push(z)),s&&(H=rs({inputs:{x:A},backend:r,attrs:{perm:[0,2,1]}}),P.push(H));const O=y!==1,B=y===1;let Y=z;O&&(Y=Ee({inputs:{x:z},backend:r,attrs:{shape:[D,E,1]}}),P.push(Y));const oe=y===1?2:1;let Q=H;B&&(Q=Ee({inputs:{x:H},backend:r,attrs:{shape:[D,1,E]}}),P.push(Q));const ce=ib({inputs:{a:Y,b:Q},backend:r});ee=Jm({inputs:{x:ce},backend:r,attrs:{axis:oe,keepDims:!0}}),P.push(ce)}else{const z=As(n.dtype,e.dtype),H=new cA($,R,[D,g,y],t,s,j,U,V,W),O=[M,A];if(o!=null&&O.push(o),V&&O.push(i),W){const B=r.makeTensorInfo([],"float32",pi(a,"float32"));O.push(B),P.push(B)}ee=r.runWebGLProgram(H,O,z)}const G=Ee({inputs:{x:ee},backend:r,attrs:{shape:S}});P.push(ee);for(const z of P)r.disposeIntermediateTensorInfo(z);return G}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FX(n){const{inputs:e,backend:t,attrs:s}=n,{a:r,b:o,bias:i,preluActivationWeights:a}=e,{transposeA:l,transposeB:u,activation:d,leakyreluAlpha:f}=s;return up({a:r,b:o,transposeA:l,transposeB:u,backend:t,bias:i,preluActivationWeights:a,leakyreluAlpha:f,activation:d})}const LX={kernelName:Of,backendName:"webgl",kernelFunc:FX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HC="return abs(x);";function jX(n){const{inputs:e,backend:t}=n,{x:s}=e;if(t.shouldExecuteOnCPU([s])&&s.dtype!=="complex64"){const o=t.texData.get(s.dataId),i=tA(o.values);return t.makeTensorInfo(s.shape,s.dtype,i)}let r;return de().getBool("WEBGL_PACK_UNARY_OPERATIONS")?r=new ti(s.shape,HC):r=new Hr(s.shape,HC),t.runWebGLProgram(r,[s],s.dtype)}const OX={kernelName:Cp,backendName:"webgl",kernelFunc:jX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _X=hr+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,zX=dt({opSnippet:_X}),BX={kernelName:$u,backendName:"webgl",kernelFunc:zX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VX=hr+`
  if (x < 1.0) return NAN;
return log(x + sqrt(x * x - 1.0));`,WX=dt({opSnippet:VX}),UX={kernelName:Tu,backendName:"webgl",kernelFunc:WX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qC="return a + b;",GX=Mn({opSnippet:qC,packedOpSnippet:qC,supportsComplex:!0,cpuKernelImpl:tK}),HX={kernelName:Ll,backendName:"webgl",kernelFunc:GX};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class qX{constructor(e,t){this.outputShape=[],this.outputShape=e,this.variableNames=t.map((o,i)=>`T${i}`);const s=[];this.variableNames.forEach(o=>{s.push(`float v${o} = get${o}AtOutCoords();`)});const r=this.variableNames.map(o=>`v${o}`).join(" + ");this.userCode=`
      void main() {
        ${s.join(`
        `)}

        float result = ${r};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class KX{constructor(e,t){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=t.map((o,i)=>`T${i}`);const s=[];this.variableNames.forEach(o=>{s.push(`vec4 v${o} = get${o}AtOutCoords();`)});const r=this.variableNames.map(o=>`v${o}`).join(" + ");this.userCode=`
      void main() {
        ${s.join(`
        `)}

        vec4 result = ${r};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rf(n){const{inputs:e,backend:t}=n,s=e;if(s.length===1)return Ms({inputs:{x:s[0]},backend:t});if(s.length>de().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){const l=Math.floor(s.length/2),u=Rf({inputs:s.slice(0,l),backend:t}),d=Rf({inputs:s.slice(l),backend:t});return Rf({inputs:[u,d],backend:t})}const r=s.map(l=>l.dtype).reduce((l,u)=>As(l,u)),o=s.map(l=>l.shape),a=de().getBool("WEBGL_PACK")?new KX(s[0].shape,o):new qX(s[0].shape,o);return t.runWebGLProgram(a,s,r)}const XX={kernelName:Ay,backendName:"webgl",kernelFunc:Rf};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QX(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,keepDims:i}=s,a=r.shape.length,l=rt(o,r.shape);let u=l;const d=Bt(u,a);let f=r;d!=null&&(f=rs({inputs:{x:r},backend:t,attrs:{perm:d}}),u=Zt(u.length,a)),Dn("all",u,a);const[m,g]=Sn(f.shape,u),y=pe(g),w=Ee({inputs:{x:f},backend:t,attrs:{shape:[-1,y]}}),b=Na(w,w.dtype,"all",t);let k;if(i){const v=an(m,l);k=Ee({inputs:{x:b},backend:t,attrs:{shape:v}})}else k=Ee({inputs:{x:b},backend:t,attrs:{shape:m}});return t.disposeIntermediateTensorInfo(w),t.disposeIntermediateTensorInfo(b),d!=null&&t.disposeIntermediateTensorInfo(f),k}const YX={kernelName:Dy,backendName:"webgl",kernelFunc:QX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JX(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,keepDims:i}=s,a=r.shape.length,l=rt(o,r.shape);let u=l;const d=Bt(u,a);let f=r;d!=null&&(f=rs({inputs:{x:r},backend:t,attrs:{perm:d}}),u=Zt(u.length,a)),Dn("any",u,a);const[m,g]=Sn(f.shape,u),y=pe(g),w=Ee({inputs:{x:f},backend:t,attrs:{shape:[-1,y]}}),b=Na(w,w.dtype,"any",t);let k;if(i){const v=an(m,l);k=Ee({inputs:{x:b},backend:t,attrs:{shape:v}})}else k=Ee({inputs:{x:b},backend:t,attrs:{shape:m}});return t.disposeIntermediateTensorInfo(w),t.disposeIntermediateTensorInfo(b),d!=null&&t.disposeIntermediateTensorInfo(f),k}const ZX={kernelName:My,backendName:"webgl",kernelFunc:JX};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class eQ{constructor(e,t,s){this.variableNames=["A"];const{windowSize:r,batchSize:o,outSize:i}=e;s||this.variableNames.push("bestIndicesA"),this.outputShape=[o,i];const a=t==="max"?">":"<",l=s?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${r};

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < ${r}; i++) {
          int inIdx = ${l};
          float candidate = getA(batch, inIdx);
          if (candidate ${a} bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class tQ{constructor(e,t,s,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,_(e.length>2,()=>`Packed arg${s.charAt(0).toUpperCase()+s.slice(1)} supports only inputs with rank above 2.`);const o=e[e.length-1],i=Math.ceil(o/t);this.outputShape=e.slice(0,-1),i>1&&this.outputShape.push(i),r||this.variableNames.push("bestIndicesA");const a=this.outputShape,l=a.length,u=Ct(l),d=ns("coords",l);let f,m;if(i===1){m=l+1;const A=Ct(m);f=`
        ${A} sourceLocR = ${A}(${d.join()}, 0);
        ++${d[l-1]};
        ${A} sourceLocG = ${A}(${d.join()}, 0);
        ++${d[l-2]};
        ${A} sourceLocA = ${A}(${d.join()}, 0);
        --${d[l-1]};
        ${A} sourceLocB = ${A}(${d.join()}, 0);
        --${d[l-2]};`}else m=l,f=`
        ${u} sourceLocR = coords;
        ++${d[l-1]};
        ${u} sourceLocG = coords;
        ++${d[l-2]};
        ${u} sourceLocA = coords;
        --${d[l-1]};
        ${u} sourceLocB = coords;
        --${d[l-2]};`;const g=["x","y","z","w","u","v"].slice(0,m),y="."+g[m-1],w=g.map(A=>"int "+A),b=ns("sourceLocR",m-1).concat("inIdx.r"),k=ns("sourceLocG",m-1).concat("inIdx.g"),v=ns("sourceLocB",m-1).concat("inIdx.b"),N=ns("sourceLocA",m-1).concat("inIdx.a"),S=s==="max"?"greaterThan":"lessThan",$=r?"":`
          inIdx = round(vec4(getBestIndicesAChannel(${b.join()}),
                             getBestIndicesAChannel(${k.join()}),
                             getBestIndicesAChannel(${v.join()}),
                             getBestIndicesAChannel(${N.join()})));`,R=`vec4(
            getAChannel(${b.join()}),
            hasNextCol ? getAChannel(${k.join()}) : 0.,
            hasNextRow ? getAChannel(${v.join()}) : 0.,
            hasNextRow && hasNextCol ? getAChannel(${N.join()}) : 0.)`,M=r?"":`
      float getBestIndicesAChannel(${w.join()}) {
        return getChannel(getBestIndicesA(${g.join()}),
                                          vec2(${g.slice(-2).join()}));
      }`;this.userCode=`
      float getAChannel(${w.join()}) {
        return getChannel(getA(${g.join()}),
                               vec2(${g.slice(-2).join()}));
      }
      ${M}
      void main() {
        ${u} coords = getOutputCoords();
        bool hasNextCol = ${d[l-1]} < ${a[l-1]-1};
        bool hasNextRow = ${d[l-2]} < ${a[l-2]-1};
        ${f}
        ivec4 srcIdx = ivec4(sourceLocR${y}, sourceLocG${y},
          sourceLocB${y}, sourceLocA${y}) * ${t};
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = ${R};

        for (int i = 0; i < ${t}; i++) {
          inIdx = srcIdx;
          ${$}
          vec4 candidate = ${R};
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(${S}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dA(n,e,t,s=null){let r=e.shape[0],o=e.shape[1];s!=null&&(r=s.shape[0],o=s.shape[1]);const i=Mm(o),a={windowSize:i,inSize:o,batchSize:r,outSize:Math.ceil(o/i)},l=new eQ(a,t,s==null),u=[e];s!=null&&u.push(s);const d=n.runWebGLProgram(l,u,"int32");if(d.shape[1]===1)return d;const f=dA(n,e,t,d);return n.disposeIntermediateTensorInfo(d),f}function hA(n,e,t,s=null){const r=s!=null?s.shape:e.shape,o=r[r.length-1],i=Mm(o),a=new tQ(r,i,t,s==null),l=s==null?[e]:[e,s],u=n.runWebGLProgram(a,l,"int32");if(u.shape.length===e.shape.length){const d=hA(n,e,t,u);return n.disposeIntermediateTensorInfo(u),d}return u}function fA(n,e,t,s){const r=[t];if(Dn("arg"+s.charAt(0).toUpperCase()+s.slice(1),r,e.shape.length),!de().getBool("WEBGL_PACK_REDUCE")||e.shape.length<=2){const o=[],i=n.texData.get(e.dataId),a=i!==null&&i.isPacked;let l=e;a&&(l=n.unpackTensor(e),o.push(l));const[u,d]=Sn(l.shape,r),f=pe(d),m=Ee({inputs:{x:l},backend:n,attrs:{shape:[-1,f]}});o.push(m);const g=dA(n,m,s);o.push(g);const y=Ee({inputs:{x:g},backend:n,attrs:{shape:u}});return o.forEach(w=>n.disposeIntermediateTensorInfo(w)),y}return hA(n,e,s)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nQ(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o}=s;let i=rt(o,r.shape);const a=Bt(i,r.shape.length);let l=r;const u=[];a!=null&&(l=rs({inputs:{x:r},backend:t,attrs:{perm:a}}),u.push(l),i=Zt(i.length,l.shape.length)),Dn("argMax",[i[0]],l.shape.length);const d=fA(t,l,i[0],"max");return u.forEach(f=>t.disposeIntermediateTensorInfo(f)),d}const sQ={kernelName:Sp,backendName:"webgl",kernelFunc:nQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rQ(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o}=s;let i=rt(o,r.shape);const a=Bt(i,r.shape.length);let l=r;const u=[];a!=null&&(l=rs({inputs:{x:r},backend:t,attrs:{perm:a}}),u.push(l),i=Zt(i.length,l.shape.length)),Dn("argMin",[i[0]],l.shape.length);const d=fA(t,l,i[0],"min");return u.forEach(f=>t.disposeIntermediateTensorInfo(f)),d}const oQ={kernelName:Np,backendName:"webgl",kernelFunc:rQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iQ=hr+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,aQ=dt({opSnippet:iQ}),lQ={kernelName:Eu,backendName:"webgl",kernelFunc:aQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cQ=hr+"return log(x + sqrt(x * x + 1.0));",uQ=dt({opSnippet:cQ}),dQ={kernelName:Ru,backendName:"webgl",kernelFunc:uQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hQ=hr+`
  return atan(x);
`,fQ=dt({opSnippet:hQ}),pQ={kernelName:Au,backendName:"webgl",kernelFunc:fQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mQ=ob+`
  return atan(a, b);
`,gQ=`
  vec4 result = atan(a, b);
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Sa+`
  return result;
`,xQ=Mn({opSnippet:mQ,packedOpSnippet:gQ}),yQ={kernelName:Mu,backendName:"webgl",kernelFunc:xQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vQ=hr+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,bQ=dt({opSnippet:vQ}),wQ={kernelName:Du,backendName:"webgl",kernelFunc:bQ};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class vu{constructor(e,t,s,r=!1,o=!1){if(this.variableNames=["x"],t==="avg"&&s)throw new Error("Cannot compute positions for average pool.");const i=e.filterWidth,a=e.strideHeight,l=e.strideWidth,u=e.dilationHeight,d=e.dilationWidth,f=e.effectiveFilterHeight,m=e.effectiveFilterWidth,g=e.padInfo.top,y=e.padInfo.left;this.outputShape=e.outShape;const w=t==="avg",b=`((batch  * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + d`,k=`(xR * ${e.inWidth} + xC) * ${e.inChannels} + d`;let v="0.0";if(w||(v="-1.0 / 1e-20"),s){this.userCode=`
        const ivec2 strides = ivec2(${a}, ${l});
        const ivec2 pads = ivec2(${g}, ${y});

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < ${f};
              wR += ${u}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${m};
                wC += ${d}) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value >= currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = ${r?o?b:k:`wR * ${m} + wC`};
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const N="max";let S=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;t==="avg"&&(S="avgValue / max(count, 1.0)");const $=Math.floor(i/4)*4,R=i%4,M=`
      if (${w}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${N}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(${a}, ${l});
      const ivec2 pads = ivec2(${g}, ${y});
      const float initializationValue = ${v};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(${v});
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < ${f};
            wR += ${u}) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${$}; wC += 4) {
            int xC = xCCorner + wC * ${d};

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${d}, d),
              getValue(batch, xR, xC + 2 * ${d}, d),
              getValue(batch, xR, xC + 3 * ${d}, d)
            );

            ${M}
          }

          int xC = xCCorner + ${$};
          if (${R===1}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            ${M}
          } else if (${R===2}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${d}, d),
              initializationValue,
              initializationValue
            );

            ${M}
          } else if (${R===3}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${d}, d),
              getValue(batch, xR, xC + 2 * ${d}, d),
              initializationValue
            );

            ${M}
          }
        }
        setOutput(${S});
      }
    `}}class ab{constructor(e,t,s,r=!1,o=!1){if(this.variableNames=["x"],t==="avg"&&s)throw new Error("Cannot compute positions for average pool.");const i=e.filterWidth,a=e.strideDepth,l=e.strideHeight,u=e.strideWidth,d=e.dilationDepth,f=e.dilationHeight,m=e.dilationWidth,g=e.effectiveFilterDepth,y=e.effectiveFilterHeight,w=e.effectiveFilterWidth,b=e.padInfo.front,k=e.padInfo.top,v=e.padInfo.left;this.outputShape=e.outShape;const N=t==="avg";let S="0.0";if(N||(S="-1.0 / 1e-20"),s){this.userCode=`
        const ivec3 strides =
            ivec3(${a}, ${l}, ${u});
        const ivec3 pads = ivec3(${b}, ${k}, ${v});

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < ${g};
              wD += ${d}) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= ${e.inDepth}) {
              continue;
            }

            for (int wR = 0; wR < ${y};
                wR += ${f}) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int wC = 0; wC < ${w};
                  wC += ${m}) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value >= currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = ${r?o?`(((batch * ${e.inDepth} + xD) * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`((xD * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`wD * ${y} * ${w} +
                      wR * ${w} + wC`};
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const $="max";let R=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;t==="avg"&&(R="avgValue / max(count, 1.0)");const M=Math.floor(i/4)*4,A=i%4,P=`
      if (${N}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${$}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(${a}, ${l}, ${u});
      const ivec3 pads = ivec3(${b}, ${k}, ${v});
      const float initializationValue = ${S};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(${S});
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < ${g};
            wD += ${d}) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${y};
            wR += ${f}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${M}; wC += 4) {
              int xC = xCCorner + wC * ${m};

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${m}, ch),
                getValue(batch, xD, xR, xC + 2 * ${m}, ch),
                getValue(batch, xD, xR, xC + 3 * ${m}, ch)
              );

              ${P}
            }

            int xC = xCCorner + ${M};
            if (${A===1}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              ${P}
            } else if (${A===2}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${m}, ch),
                initializationValue,
                initializationValue
              );

              ${P}
            } else if (${A===3}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${m}, ch),
                getValue(batch, xD, xR, xC + 2 * ${m}, ch),
                initializationValue
              );

              ${P}
            }
          }
        }
        setOutput(${R});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kQ(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e;zd(r,"avgPool");const{filterSize:o,strides:i,pad:a,dimRoundingMode:l}=s,u=1;_(Vn(i,u),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${u}'`);const d=ur(r.shape,o,i,u,a,l);if(d.filterWidth===1&&d.filterHeight===1&&xt(d.inShape,d.outShape))return Ms({inputs:{x:r},backend:t});const f=new vu(d,"avg",!1);return t.runWebGLProgram(f,[r],"float32")}const CQ={kernelName:Ip,backendName:"webgl",kernelFunc:kQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SQ(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{filterSize:o,strides:i,pad:a,dimRoundingMode:l,dataFormat:u}=s,d=[1,1,1],f=$o(r.shape,o,i,d,a,l,u),m=new ab(f,"avg",!1);return t.runWebGLProgram(m,[r],"float32")}const NQ={kernelName:$p,backendName:"webgl",kernelFunc:SQ};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class IQ{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const t=e.filterHeight,s=e.filterWidth,r=e.strideHeight,o=e.strideWidth,i=e.dilationHeight,a=e.dilationWidth,l=e.effectiveFilterHeight,u=e.effectiveFilterWidth,d=l-1-e.padInfo.top,f=u-1-e.padInfo.left,m=1/(t*s);this.userCode=`
      const ivec2 pads = ivec2(${d}, ${f});
      const float avgMultiplier = float(${m});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${l};
            wR += ${i}) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${u};
            wC+= ${a}) {
            float dyC = float(dyCCorner + wC) / ${o}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}}class $Q{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const t=e.filterDepth,s=e.filterHeight,r=e.filterWidth,o=e.strideDepth,i=e.strideHeight,a=e.strideWidth,l=e.dilationDepth,u=e.dilationHeight,d=e.dilationWidth,f=e.effectiveFilterDepth,m=e.effectiveFilterHeight,g=e.effectiveFilterWidth,y=f-1-e.padInfo.front,w=m-1-e.padInfo.top,b=g-1-e.padInfo.left,k=1/(t*s*r);this.userCode=`
      const ivec3 pads = ivec3(${y}, ${w}, ${b});
      const float avgMultiplier = float(${k});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${f};
            wD += ${l}) {
          float dyD = float(dyDCorner + wD) / ${o}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${m};
              wR += ${u}) {
            float dyR = float(dyRCorner + wR) / ${i}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${g};
                wC += ${d}) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TQ(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:o}=e,i=o,{filterSize:a,strides:l,pad:u,dimRoundingMode:d}=s,f=[1,1,1],m=$o(i.shape,a,l,f,u,d),g=new $Q(m);return t.runWebGLProgram(g,[r],i.dtype)}const EQ={kernelName:Fy,backendName:"webgl",kernelFunc:TQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RQ(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:o}=e,i=o;zd([r,o],"avgPoolGrad");const{filterSize:a,strides:l,pad:u}=s,d=ur(i.shape,a,l,1,u),f=new IQ(d);return t.runWebGLProgram(f,[r],i.dtype)}const AQ={kernelName:Py,backendName:"webgl",kernelFunc:RQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DQ(n){const{inputs:e,backend:t,attrs:s}=n,{a:r,b:o}=e,{transposeA:i,transposeB:a}=s;return up({a:r,b:o,transposeA:i,transposeB:a,backend:t})}const MQ={kernelName:Tp,backendName:"webgl",kernelFunc:DQ};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class PQ{constructor(e,t,s,r,o,i){this.outputShape=[],this.variableNames=["x","mean","variance"],Ze(e,t),Ze(e,s);let a="0.0";r!=null&&(Ze(e,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let l="1.0";o!=null&&(Ze(e,o),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = ${a};
        float scale = ${l};
        float inv = scale * inversesqrt(variance + float(${i}));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class FQ{constructor(e,t,s,r,o,i){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],Ze(e,t),Ze(e,s);let a="vec4(0.0)";r!=null&&(Ze(e,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let l="vec4(1.0)";o!=null&&(Ze(e,o),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        vec4 offset = ${a};
        vec4 scale = ${l};

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(${i}));

        setOutput((x - mean) * inv + offset);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LQ=({inputs:n,backend:e,attrs:t})=>{const{x:s,mean:r,variance:o,offset:i,scale:a}=n;_(r.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),_(i==null||r.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),_(a==null||r.shape.length===a.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let{varianceEpsilon:l}=t;l==null&&(l=.001);const u=[s,r,o];let d=null;i!=null&&(d=i.shape,u.push(i));let f=null;a!=null&&(f=a.shape,u.push(a));const m=de().getBool("WEBGL_PACK_NORMALIZATION")?new FQ(s.shape,r.shape,o.shape,d,f,l):new PQ(s.shape,r.shape,o.shape,d,f,l);return e.runWebGLProgram(m,u,u[0].dtype)},jQ={kernelName:zp,backendName:"webgl",kernelFunc:LQ};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class OQ{constructor(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;const t=Ct(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const s=_Q(this.rank);let r;const o=e.map((i,a)=>`sourceLoc.${dy[a]} = start[${a}] + coords.${dy[a]};`);r=`
        ${t} sourceLoc;
        ${t} coords = getOutputCoords();
        ${o.join(`
`)}
      `,this.userCode=`
      void main() {
        ${r}
        setOutput(getSource(${s}));
      }
    `}}const dy=["x","y","z","w","u","v"];function _Q(n){if(n===1)return"sourceLoc";if(n<=6)return dy.slice(0,n).map(e=>"sourceLoc."+e).join(",");throw Error(`Slicing for rank ${n} is not yet supported`)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class zQ{constructor(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const t=Ct(this.rank),s=ns("coords",this.rank),r=ns("sourceLoc",this.rank),o=this.rank===1?"sourceLoc":`vec2(${r.slice(-2).join()})`,i=`getChannel(getSource(${r.join()}), ${o})`,a=`
      result.x = ${i};
      if (++${s[this.rank-1]} < ${e[this.rank-1]}) {
        ++${r[this.rank-1]};
        result.y = ${i};
        --${r[this.rank-1]};
      }
    `,l=this.rank===1?"":`
      --${s[this.rank-1]};
      if (++${s[this.rank-2]} < ${e[this.rank-2]}) {
        ++${r[this.rank-2]};
        result.z = ${i};
        if (++${s[this.rank-1]} < ${e[this.rank-1]}) {
          ++${r[this.rank-1]};
          result.w = ${i};
        }
      }
    `,u=this.rank<=4?`sourceLoc = coords +
            ${t}(${e.map((d,f)=>`start[${f}]`).join()});`:e.map((d,f)=>`${r[f]} = ${s[f]} + start[${f}];`).join(`
`);this.userCode=`
      void main() {
        ${t} coords = getOutputCoords();
        ${t} sourceLoc;
        ${u}
        vec4 result = vec4(0.);
        ${a}
        ${l}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BQ(n,e,t,s){const r=s.texData.get(n.dataId),o=s.makeTensorInfo(t,n.dtype),i=s.texData.get(o.dataId);Object.assign(i,r),i.refCount=1,i.shape=t,i.dtype=n.dtype;let a=nv(e,Ve(n.shape));r.slice&&(a+=r.slice.flatOffset),i.slice={flatOffset:a,origDataId:r.slice&&r.slice.origDataId||n.dataId};const l=s.dataRefCount.get(i.slice.origDataId)||1;return s.dataRefCount.set(i.slice.origDataId,l+1),o}function Xl(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{begin:o,size:i}=s,[a,l]=Dm(r,o,i);if(Z1(r,a,l),pe(l)===0)return t.makeTensorInfo(l,r.dtype,[]);if(t.shouldExecuteOnCPU([r])||r.dtype==="string"){const f=t.texData.get(r.dataId),m=MK(f.values,a,l,r.shape,r.dtype);return t.makeTensorInfo(l,r.dtype,m)}const{isPacked:u}=t.texData.get(r.dataId),d=tv(r.shape,a,l);if(u||!d){const f=de().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new zQ(l):new OQ(l),m=[a];return t.runWebGLProgram(f,[r],r.dtype,m)}return t.uploadToGPU(r.dataId),BQ(r,a,l,t)}const VQ={kernelName:mm,backendName:"webgl",kernelFunc:Xl};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WQ=n=>{const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockShape:o,crops:i}=s;_(r.shape.length<=4,()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet");const a=o.reduce((v,N)=>v*N),l=$d(r.shape,o,a),u=Td(l.length,o.length),d=Ed(r.shape,o,a),f=av(i,o.length),m=lv(d,i,o.length),g=[],y=Ee({inputs:{x:r},backend:t,attrs:{shape:l}}),w=rs({inputs:{x:y},backend:t,attrs:{perm:u}}),b=Ee({inputs:{x:w},backend:t,attrs:{shape:d}}),k=Xl({inputs:{x:b},backend:t,attrs:{begin:f,size:m}});return g.push(y),g.push(w),g.push(b),g.forEach(v=>t.disposeIntermediateTensorInfo(v)),k},UQ={kernelName:Ep,backendName:"webgl",kernelFunc:WQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GQ(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,weights:o}=e,{size:i}=s,a=t.readSync(r.dataId),l=t.readSync(o.dataId),u=eA(a,l,o.dtype,o.shape,i);return t.makeTensorInfo([i],o.dtype,u)}const HQ={kernelName:Ly,backendName:"webgl",kernelFunc:GQ};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qQ=`
  int r = int(a.r) & int(b.r);
  int g = int(a.g) & int(b.g);
  int rb = int(a.b) & int(b.b);
  int ra = int(a.a) & int(b.a);
  return vec4(r, g, rb, ra);
`,KQ=`
  return float(int(a.r) & int(b.r));
`;function XQ(n){const{inputs:e,backend:t}=n,{a:s,b:r}=e,o=de().getBool("WEBGL_PACK_BINARY_OPERATIONS"),i=de().getNumber("WEBGL_VERSION");if(t.shouldExecuteOnCPU([s,r])||i===1){const l=t.texData.get(s.dataId).values,u=t.texData.get(r.dataId).values,[d,f]=sK(s.shape,r.shape,l,u,s.dtype),m=t.makeTensorInfo(f,s.dtype),g=t.texData.get(m.dataId);return g.values=d,m}let a;return o?a=new ql(qQ,s.shape,r.shape,!1):a=new ha(KQ,s.shape,r.shape),t.runWebGLProgram(a,[s,r],s.dtype)}const QQ={kernelName:jy,backendName:"webgl",kernelFunc:XQ};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YQ(n){const{inputs:e,backend:t}=n,{s0:s,s1:r}=e,o=t.readSync(s.dataId),i=t.readSync(r.dataId),a=Ze(Array.from(o),Array.from(i));return t.makeTensorInfo([a.length],"int32",Int32Array.from(a))}const JQ={kernelName:aN,backendName:"webgl",kernelFunc:YQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZQ="return float(a != b);",pA=Mn({opSnippet:ZQ,cpuKernelImpl:SK,dtype:"bool"}),eY={kernelName:sm,backendName:"webgl",kernelFunc:pA};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vd(n){const{inputs:e,backend:t}=n,{input:s}=e,r=t.texData.get(s.dataId);return Ms({inputs:{x:r.complexTensorInfos.real},backend:t})}const tY={kernelName:l1,backendName:"webgl",kernelFunc:Vd};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nY="return float(int(x));";function sY(n,e){const t=new Hr(n.shape,nY),s=e.runWebGLProgram(t,[n],"int32");return{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hy(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{dtype:o}=s;if(o==="complex64"){if(r.dtype==="complex64")return Ms({inputs:{x:r},backend:t});const i=kn(r.shape),a=hy({inputs:{x:r},backend:t,attrs:{dtype:"float32"}}),l=Ci({inputs:{real:a,imag:i},backend:t});return i.dispose(),t.disposeIntermediateTensorInfo(a),l}if(r.dtype==="complex64"){const i=Vd({inputs:{input:r},backend:t}),a=hy({inputs:{x:i},backend:t,attrs:{dtype:o}});return t.disposeIntermediateTensorInfo(i),a}if(!nN(r.dtype,o)){const i=Ms({inputs:{x:r},backend:t});return{dataId:i.dataId,shape:i.shape,dtype:o}}if(t.shouldExecuteOnCPU([r])){const i=t.texData.get(r.dataId).values,[a,l,u]=rK(i,r.shape,r.dtype,o);return t.makeTensorInfo(a,l,u)}if(o==="int32")return sY(r,t);if(o==="bool"){const i=t.makeTensorInfo([],"bool",_n("bool",1)),l=pA({inputs:{a:r,b:i},backend:t});return t.disposeIntermediateTensorInfo(i),l}throw new Error(`Error in Cast: failed to cast ${r.dtype} to ${o}`)}const rY={kernelName:Pu,backendName:"webgl",kernelFunc:hy};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KC="return ceil(x);",oY=dt({opSnippet:KC,packedOpSnippet:KC,cpuKernelImpl:oK}),iY={kernelName:Fu,backendName:"webgl",kernelFunc:oY};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class aY{constructor(e){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class lY{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`
      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cY(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{clipValueMin:o,clipValueMax:i}=s;let a;de().getBool("WEBGL_PACK_CLIP")?a=new lY(r.shape):a=new aY(r.shape);const l=[[o],[i]];return t.runWebGLProgram(a,[r],r.dtype,l)}const uY={kernelName:Lu,backendName:"webgl",kernelFunc:cY};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class dY{constructor(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XC(n,e){return{dataId:e.dataId,dtype:e.dtype,shape:n.shape}}function hY(n){const{inputs:e,backend:t}=n,{x:s}=e,r=t.texData.get(s.dataId),o=new dY(s.shape),i=[XC(s,r.complexTensorInfos.real),XC(s,r.complexTensorInfos.imag)];return t.runWebGLProgram(o,i,i[0].dtype)}const fY={kernelName:Rp,backendName:"webgl",kernelFunc:hY};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class pY{constructor(e){this.outputShape=[],this.outputShape=Xr(e,1),this.variableNames=e.map((i,a)=>`T${a}`);const t=new Array(e.length-1);t[0]=e[0][1];for(let i=1;i<t.length;i++)t[i]=t[i-1]+e[i][1];const s=[`if (yC < ${t[0]}) setOutput(getT0(yR, yC));`];for(let i=1;i<t.length;i++){const a=t[i-1];s.push(`else if (yC < ${t[i]}) setOutput(getT${i}(yR, yC-${a}));`)}const r=t.length,o=t[t.length-1];s.push(`else setOutput(getT${r}(yR, yC-${o}));`),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        ${s.join(`
        `)}
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class mY{constructor(e,t){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=Xr(e,t);const s=this.outputShape,r=s.length,o=Ct(r),i=ns("coords",r),a=["x","y","z","w","u","v"].slice(0,r);this.variableNames=e.map((w,b)=>`T${b}`);const l=new Array(e.length-1);l[0]=e[0][t];for(let w=1;w<l.length;w++)l[w]=l[w-1]+e[w][t];const u=a[t],d=a.slice(-2),f=a.join();let m=`if (${u} < ${l[0]}) {
        return getChannel(
            getT0(${f}), vec2(${d.join()}));
        }`;for(let w=1;w<l.length;w++){const b=l[w-1];m+=`
        if (${u} < ${l[w]}  && ${u} >= ${l[w-1]}) {
          return getChannel(
            getT${w}(${xf(a,u,b)}),
            vec2(${xf(d,u,b)}));
        }`}const g=l.length,y=l[l.length-1];m+=`
        return getChannel(
          getT${g}(${xf(a,u,y)}),
          vec2(${xf(d,u,y)}));`,this.userCode=`
      float getValue(${a.map(w=>"int "+w)}) {
        ${m}
      }

      void main() {
        ${o} coords = getOutputCoords();
        vec4 result = vec4(getValue(${i}), 0., 0., 0.);

        ${i[r-1]} = ${i[r-1]} + 1;
        if (${i[r-1]} < ${s[r-1]}) {
          result.g = getValue(${i});
        }

        ${i[r-2]} = ${i[r-2]} + 1;
        if (${i[r-2]} < ${s[r-2]}) {
          result.a = getValue(${i});
        }

        ${i[r-1]} = ${i[r-1]} - 1;
        if (${i[r-2]} < ${s[r-2]} &&
            ${i[r-1]} < ${s[r-1]}) {
          result.b = getValue(${i});
        }
        setOutput(result);
      }
    `}}function xf(n,e,t){const s=n.indexOf(e);return n.map((o,i)=>i===s?`${o} - ${t}`:o).join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zm(n){const{inputs:e,backend:t}=n,{input:s}=e,r=t.texData.get(s.dataId);return Ms({inputs:{x:r.complexTensorInfos.imag},backend:t})}const gY={kernelName:e1,backendName:"webgl",kernelFunc:Zm};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zc(n,e,t){const s=n[0].dtype;if(s==="complex64"){const g=n.map(v=>Vd({inputs:{input:v},backend:t})),y=n.map(v=>Zm({inputs:{input:v},backend:t})),w=Zc(g,e,t),b=Zc(y,e,t),k=Ci({inputs:{real:w,imag:b},backend:t});return g.forEach(v=>t.disposeIntermediateTensorInfo(v)),y.forEach(v=>t.disposeIntermediateTensorInfo(v)),t.disposeIntermediateTensorInfo(w),t.disposeIntermediateTensorInfo(b),k}let r=t.shouldExecuteOnCPU(n);if(s==="string"&&(r=!0),r){const g=n.map(S=>{const R=[-1,pe(S.shape.slice(e))];return Ee({inputs:{x:S},backend:t,attrs:{shape:R}})}),y=g.map(S=>({vals:t.readSync(S.dataId),shape:S.shape})),w=Xr(g.map(S=>S.shape),1),b=g[0].shape[0]===1,k=iK(y,w,s,b),v=Xr(n.map(S=>S.shape),e),N=t.makeTensorInfo(v,s,k);return g.forEach(S=>t.disposeIntermediateTensorInfo(S)),N}const o=n.filter(g=>pe(g.shape)>0),i=de().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&o[0].shape.length>1;if(o.length===1){const g=i?new Hr(n[0].shape,Yo):new ti(n[0].shape,Yo);return t.runWebGLProgram(g,n,s)}const a=de().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(o.length>a){const g=[];for(let w=0;w<o.length;w+=a){const b=o.slice(w,w+a);g.push(Zc(b,e,t))}const y=Zc(g,e,t);for(const w of g)t.disposeIntermediateTensorInfo(w);return y}if(i){const g=new mY(o.map(y=>y.shape),e);return t.runWebGLProgram(g,o,s)}const{tensors2D:l,outShape:u}=xY(o,e,t),d=new pY(l.map(g=>g.shape)),f=t.runWebGLProgram(d,l,s);l.forEach(g=>t.disposeIntermediateTensorInfo(g));const m=Ee({inputs:{x:f},attrs:{shape:u},backend:t});return t.disposeIntermediateTensorInfo(f),m}function xY(n,e,t){const s=Xr(n.map(o=>o.shape),e);return{tensors2D:n.map(o=>Ee({inputs:{x:o},attrs:{shape:[-1,pe(o.shape.slice(e))]},backend:t})),outShape:s}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mA(n){const{inputs:e,backend:t,attrs:s}=n,{axis:r}=s,o=rt(r,e[0].shape)[0],i=e.map(u=>u.shape);rv(i,o);const a=Xr(e.map(u=>u.shape),o);if(pe(a)===0)return t.makeTensorInfo(a,e[0].dtype,[]);const l=e.filter(u=>pe(u.shape)>0);return l.length===1?Ms({inputs:{x:l[0]},backend:t}):Zc(l,o,t)}const yY={kernelName:Ap,backendName:"webgl",kernelFunc:mA};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class gA{constructor(e,t=!1,s=null,r=!1,o=!1){this.variableNames=["x","W"],this.outputShape=e.outShape;const i=e.padInfo.top,a=e.padInfo.left,l=e.strideHeight,u=e.strideWidth,d=e.dilationHeight,f=e.dilationWidth,m=e.filterHeight,g=e.filterWidth,y=Math.floor(e.inChannels/4)*4,w=e.inChannels%4,b=e.dataFormat==="channelsLast",k=b?1:2,v=b?2:3,N=b?3:1;let S="",$="";s&&(r?S=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:o?S=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:S=`
          float activation(float x) {
            ${s}
          }
        `,$="result = activation(result);");const R=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),o&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${S}

      const ivec2 strides = ivec2(${l}, ${u});
      const ivec2 pads = ivec2(${i}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[${N}];

        ivec2 xRCCorner =
            ivec2(coords[${k}], coords[${v}]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${m}; wR++) {
          int xR = xRCorner + wR * ${d};

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${g}; wC++) {
            int xC = xCCorner + wC * ${f};

            if (xC < 0 || xC >= ${e.inWidth}) {
              continue;
            }

            for (int d1 = 0; d1 < ${y}; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (${b}) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (${w===1}) {

              if (${b}) {
                dotProd +=
                    getX(batch, xR, xC, ${y}) *
                    getW(wR, wC, ${y}, d2);
              } else {
                dotProd +=
                    getX(batch, ${y}, xR, xC) *
                    getW(wR, wC, ${y}, d2);
              }

            } else if (${w===2}) {
              vec2 wValues = vec2(
                getW(wR, wC, ${y}, d2),
                getW(wR, wC, ${y} + 1, d2)
              );

              if (${b}) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, ${y}),
                  getX(batch, xR, xC, ${y} + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, ${y}, xR, xC),
                  getX(batch, ${y} + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (${w===3}) {
              vec3 wValues = vec3(
                getW(wR, wC, ${y}, d2),
                getW(wR, wC, ${y} + 1, d2),
                getW(wR, wC, ${y} + 2, d2)
              );

              if (${b}) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, ${y}),
                  getX(batch, xR, xC, ${y} + 1),
                  getX(batch, xR, xC, ${y} + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, ${y}, xR, xC),
                  getX(batch, ${y} + 1, xR, xC),
                  getX(batch, ${y} + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        ${R}
        ${$}
        setOutput(result);
      }
    `}}class vY{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const t=e.padInfo.front,s=e.padInfo.top,r=e.padInfo.left,o=e.strideDepth,i=e.strideHeight,a=e.strideWidth,l=e.dilationDepth,u=e.dilationHeight,d=e.dilationWidth,f=e.filterDepth,m=e.filterHeight,g=e.filterWidth,y=Math.floor(e.inChannels/4)*4,w=e.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(${o}, ${i}, ${a});
      const ivec3 pads = ivec3(${t}, ${s}, ${r});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < ${f}; wF++) {
          int xF = xFCorner + wF * ${l};

          if (xF < 0 || xF >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${m}; wR++) {
            int xR = xRCorner + wR * ${u};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${g}; wC++) {
              int xC = xCCorner + wC * ${d};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              for (int d1 = 0; d1 < ${y}; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (${w===1}) {
                dotProd +=
                  getX(batch, xF, xR, xC, ${y}) *
                  getW(wF, wR, wC, ${y}, d2);
              } else if (${w===2}) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, ${y}),
                  getX(batch, xF, xR, xC, ${y} + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, ${y}, d2),
                  getW(wF, wR, wC, ${y} + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (${w===3}) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, ${y}),
                  getX(batch, xF, xR, xC, ${y} + 1),
                  getX(batch, xF, xR, xC, ${y} + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, ${y}, d2),
                  getW(wF, wR, wC, ${y} + 1, d2),
                  getW(wF, wR, wC, ${y} + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class xA{constructor(e,t=!1,s=null,r=!1,o=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=Un(this.outputShape.length);const i=e.padInfo.left,a=e.strideWidth,l=e.dilationWidth,u=e.filterHeight,d=e.filterWidth,f=d;let m=`
       int xR; int xC; int xCOffset;
       vec4 wTexel; vec4 previous; vec4 final;`;for(let b=0;b<d;b++)m+=`
           vec4 xTexelC${b*2};
           int xTexelC${b*2}Ready;
           vec4 xTexelC${b*2+1};
           int xTexelC${b*2+1}Ready;
           vec4 xC${b};`;m+=`
     for (int r = 0; r < ${u}; r++) {
      for (int d1 = 0; d1 < ${e.inChannels}; d1 += 2) {
       `;for(let b=0;b<d;b++)m+=`
           xTexelC${b*2} = vec4(0.0);
           xTexelC${b*2}Ready = 0;
           xTexelC${b*2+1} = vec4(0.0);
           xTexelC${b*2+1}Ready = 0;
           xC${b} = vec4(0.0);`;m+=`
         xR = xRCorner + r * dilations[0];
         if (xR >=0 && xR < inDims[0]) {
       `;for(let b=0;b<(f+1)/2;b++){const k=b*2;if(m+=`
           xC = xCCorner + ${k*l};
           `,a===1){if(k<d&&(i%2===1?(m+=`
                 xCOffset = xC + 1;
                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${k}Ready == 0) {
                   xTexelC${k} = getX(batch, xR, xCOffset, d1);

                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${k}.zw = vec2(0.0);
                   }
                   xTexelC${k}Ready = 1;
                 }
               `,l===1&&k>0?m+=`
                 xC${k} = vec4(xTexelC${k-2}.zw, xTexelC${k}.xy);
                 `:m+=`
                   xCOffset = xC + 1 - 2;

                   if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       previous.zw = vec2(0.0);
                     }

                     xC${k} = vec4(previous.zw, xTexelC${k}.xy);
                   } else {
                     xC${k} = vec4(0.0, 0.0, xTexelC${k}.xy);
                   }
                   `):m+=`
                 if (xC >= 0 && xC < inDims[1] && xTexelC${k}Ready == 0) {
                   xTexelC${k} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${k}.zw = vec2(0.0);
                   }
                   xTexelC${k}Ready = 1;
                 }

                 xC${k} = xTexelC${k};
                 `,k+1<d)){const v=i%2===0?Iy(l):l;l%2===0&&i%2===1||l%2!==0&&i%2!==1?(m+=`
                   xCOffset = xC + imod(pads[1], 2) + ${v};

                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${k+1}Ready == 0) {
                     xTexelC${k+1} = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       xTexelC${k+1}.zw = vec2(0.0);
                     }
                     xTexelC${k+1}Ready = 1;
                   }
                   `,l>1?m+=`
                     xCOffset -= 2;
                     if (xCOffset >= 0 && xCOffset < inDims[1]) {
                      previous = getX(batch, xR, xCOffset, d1);
                      xC${k+1} = vec4(previous.zw, xTexelC${k+1}.xy);
                     } else {
                      xC${k+1} = vec4(0.0, 0.0, xTexelC${k+1}.xy);
                     }
                     `:m+=`
                     xC${k+1} = vec4(xTexelC${k}.zw, xTexelC${k+1}.xy);
                     `):v===1?m+=`
                     xC${k+1} = xTexelC${k};
                     `:m+=`
                     xCOffset = xC + ${v};

                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${k+1}Ready == 0) {
                       xTexelC${k+1} = getX(batch, xR, xCOffset, d1);
                       if (xCOffset + 1 >= inDims[1]) {
                         xTexelC${k+1}.zw = vec2(0.0);
                       }
                       xTexelC${k+1}Ready = 1;
                     }

                     xC${k+1} = xTexelC${k+1};
                     `}}else k<d&&(i%2===1?(m+=`
                 xCOffset = xC + 1 - strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${k}Ready == 0) {
                   xTexelC${k} = getX(batch, xR, xCOffset, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${k}.zw = vec2(0.0);
                   }
                   xTexelC${k}Ready = 1;
                 }

                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${k+1}Ready == 0) {
                   xTexelC${k+1} = getX(batch, xR, xC + 1, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xC + 2 >= inDims[1]) {
                     xTexelC${k+1}.zw = vec2(0.0);
                   }
                   xTexelC${k+1}Ready = 1;
                 }

                 xC${k} = vec4(xTexelC${k}.zw, xTexelC${k+1}.zw);
               `,k+1<d&&(m+=`
                   final = vec4(0.0);
                   xCOffset = xC + 1 + strides[1];
                   if(xCOffset >= 0 && xCOffset < inDims[1]) {
                     final = getX(batch, xR, xCOffset, d1);
                   }
                   xC${k+1} = vec4(xTexelC${k+1}.xy, final.xy);
                 `)):(m+=`
                 if(xC >= 0 && xC < inDims[1] && xTexelC${k}Ready == 0) {
                   xTexelC${k} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${k}.zw = vec2(0.0);
                   }
                   xTexelC${k}Ready = 1;
                 }

                 xCOffset = xC + strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${k+1}Ready == 0) {
                   xTexelC${k+1} = getX(batch, xR, xCOffset, d1);
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${k+1}.zw = vec2(0.);
                   }
                   xTexelC${k+1}Ready = 1;
                 }

                 xC${k} = vec4(
                   xTexelC${k}.xy, xTexelC${k+1}.xy);
               `,k+1<d&&(m+=`
                   xC${k+1} = vec4(xTexelC${k}.zw, xTexelC${k+1}.zw);
                 `)));k<d&&(m+=`
             wTexel = getW(r, ${k}, d1, d2);
             dotProd += xC${k}.xxzz * vec4(wTexel.xy, wTexel.xy);
             if(d1 + 1 < ${e.inChannels}) {
               dotProd += xC${k}.yyww * vec4(wTexel.zw, wTexel.zw);
             }
           `,k+1<d&&(m+=`
               wTexel = getW(r, ${k+1}, d1, d2);
               dotProd += xC${k+1}.xxzz * vec4(wTexel.xy, wTexel.xy);
               if(d1 + 1 < ${e.inChannels}) {
                 dotProd += xC${k+1}.yyww * vec4(wTexel.zw, wTexel.zw);
               }
             `))}m+=`
     }
   `,m+=`
     }
   `,m+=`
     }
   `;let g="",y="";s&&(r?g=`vec4 activation(vec4 a) {
           vec4 b = getPreluActivationWeightsAtOutCoords();
           ${s}
         }`:o?g=`vec4 activation(vec4 a) {
           vec4 b = getLeakyreluAlphaAtOutCoords();
           ${s}
         }`:g=`vec4 activation(vec4 x) {
           ${s}
         }`,y="result = activation(result);");const w=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),o&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
       ${g}

       void main() {
         ivec4 coords = getOutputCoords();
         int batch = coords.x;
         ivec2 xRCCorner = coords.yz * strides - pads;
         int d2 = coords.w;
         int xRCorner = xRCCorner.x;
         int xCCorner = xRCCorner.y;

         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
         vec4 dotProd = vec4(0.000000000000001);

         ${m}

         vec4 result = dotProd - vec4(0.000000000000001);
         ${w}
         ${y}
         setOutput(result);
       }
     `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class bY{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=e,this.enableShapeUniforms=Un(this.outputShape.length);const{dataFormat:s}=t,r=os(),o=s==="channelsLast",i=o?1:2,a=o?2:3,l=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":`if(blockIndex < ${e[2]} && pos < ${e[1]}) {`;let u="";for(let d=0;d<=1;d++)for(let f=0;f<=1;f++)u+=`
          blockIndex = rc.z + ${f};
          pos = rc.y + ${d};

          ${l}
            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];
            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);

            if(d0 < inputShape[${i}] && d0 >= 0) {
              // Use custom imod instead mod. On Intel GPU, mod may generate
              // unexpected value.
              // https://github.com/tensorflow/tfjs/issues/5447
              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];
              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /
                  inChannels);

              if(d1 < inputShape[${a}] && d1 >= 0) {

                ch = imod(pos, inChannels);

                if (${o}) {
                  innerDims = vec2(d1, ch);
                  result[${d*2+f}] = getChannel(
                    getA(rc.x, d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[${d*2+f}] = getChannel(
                    getA(rc.x, ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        ${u}

        ${r.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dp(n,e){const t=n.length;return t>=3?e?[...n.slice(0,-3),n[t-3]*n[t-2],n[t-1]]:[...n.slice(0,-3),n[t-3],n[t-2]*n[t-1]]:!e&&t===1&&n[0]>1?[n[0],1]:null}function yA({x:n,filter:e,convInfo:t,backend:s,bias:r=null,preluActivationWeights:o=null,leakyreluAlpha:i=0,activation:a=null}){const l=n.shape,u=s.texData.get(n.dataId),d=t.inChannels,f=l[0]*l[1]*l[2],m=t.outChannels,g=t.dataFormat==="channelsLast",y=!1,w=!1;let b;const k=[];if(o!=null){const S=dp(o.shape,g);S!=null&&(o=Ee({inputs:{x:o},backend:s,attrs:{shape:S}}),k.push(o))}if(r!=null){const S=dp(r.shape,g);S!=null&&(r=Ee({inputs:{x:r},backend:s,attrs:{shape:S}}),k.push(r))}if(!((f===1||m===1)&&d>uA)&&u.isPacked&&g&&u.texture!=null&&l[2]%2!==0&&xt(u.shape.slice(-3),l.slice(-3))){const S=l[0]*l[1]*(l[2]+1),$={dataId:n.dataId,shape:[1,S,t.inChannels],dtype:n.dtype},R=u.shape;u.shape=u.shape.slice(),u.shape[u.shape.length-2]++,_(cp(u.shape,$.shape),()=>`packed reshape ${u.shape} to ${$.shape} isn't free`);const M=Ee({inputs:{x:e},backend:s,attrs:{shape:[1,t.inChannels,t.outChannels]}});k.push(M);const A=up({a:$,b:M,backend:s,transposeA:y,transposeB:w,bias:r,activation:a,preluActivationWeights:o,leakyreluAlpha:i}),P=s.texData.get(A.dataId);_(P.isPacked,()=>"batchMatMul result is expected to be packed"),u.shape=R,P.shape=t.outShape,b=Ms({inputs:{x:A},backend:s}),b.shape=t.outShape,k.push(A)}else{const S=t.outHeight*t.outWidth,$=Ee({inputs:{x:n},backend:s,attrs:{shape:g?[t.batchSize,S,t.inChannels]:[t.batchSize,t.inChannels,S]}}),R=Ee({inputs:{x:e},backend:s,attrs:{shape:[1,t.inChannels,t.outChannels]}}),M=up({a:g?$:R,b:g?R:$,transposeA:!g,transposeB:w,backend:s,bias:r,activation:a,preluActivationWeights:o,leakyreluAlpha:i});b=Ee({inputs:{x:M},backend:s,attrs:{shape:t.outShape}}),k.push($),k.push(R),k.push(M)}for(const S of k)s.disposeIntermediateTensorInfo(S);return b}function vA({x:n,filter:e,convInfo:t,backend:s,bias:r=null,preluActivationWeights:o=null,leakyreluAlpha:i=0,activation:a=null}){const{filterWidth:l,filterHeight:u,inChannels:d,outWidth:f,outHeight:m,dataFormat:g}=t,y=g==="channelsLast",w=l*u*d,b=m*f,k=[t.batchSize,w,b],v=!0,N=!1,S=[];if(o!=null){const G=dp(o.shape,y);G!=null&&(o=Ee({inputs:{x:o},backend:s,attrs:{shape:G}}),S.push(o))}if(r!=null){const G=dp(r.shape,y);G!=null&&(r=Ee({inputs:{x:r},backend:s,attrs:{shape:G}}),S.push(r))}const $=Ee({inputs:{x:e},backend:s,attrs:{shape:[1,w,pe(e.shape)/w]}});S.push($);const R=new bY(k,t),M=[n.shape,[t.padInfo.top,t.padInfo.left],[t.strideHeight,t.strideWidth],[t.dilationHeight,t.dilationWidth],[t.inChannels],[t.filterWidth*t.inChannels],[t.outWidth]],A=s.runWebGLProgram(R,[n],"float32",M),P=Ee({inputs:{x:A},backend:s,attrs:{shape:k}});S.push(A),S.push(P);const D=r!=null,E=o!=null,j=a==="leakyrelu",V=a?yu(a,!0):null,W=new cA(y?P.shape:$.shape,y?$.shape:P.shape,y?[t.batchSize,b,t.outChannels]:[t.batchSize,t.outChannels,b],v,N,D,V,E,j),U=y?[P,$]:[$,P];if(r&&U.push(r),E&&U.push(o),j){const G=s.makeTensorInfo([],"float32",pi(i,"float32"));U.push(G),S.push(G)}const X=s.runWebGLProgram(W,U,"float32"),ee=Ee({inputs:{x:X},backend:s,attrs:{shape:t.outShape}});S.push(X);for(const G of S)s.disposeIntermediateTensorInfo(G);return ee}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wY(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:o}=e,{strides:i,pad:a,dataFormat:l,dilations:u,dimRoundingMode:d}=s,f=To(l),m=An(r.shape,o.shape,i,u,a,d,!1,f);let g;if(m.filterHeight===1&&m.filterWidth===1&&m.dilationHeight===1&&m.dilationWidth===1&&m.strideHeight===1&&m.strideWidth===1&&(m.padInfo.type==="SAME"||m.padInfo.type==="VALID"))g=yA({x:r,filter:o,convInfo:m,backend:t});else if(m.strideWidth<=2&&f==="channelsLast"&&de().getBool("WEBGL_EXP_CONV")){const w=new xA(m),b=[[m.padInfo.top,m.padInfo.left],[m.strideHeight,m.strideWidth],[m.dilationHeight,m.dilationWidth],[m.inHeight,m.inWidth]];g=t.runWebGLProgram(w,[r,o],"float32",b)}else if(de().getBool("WEBGL_CONV_IM2COL"))g=vA({x:r,filter:o,convInfo:m,backend:t});else{const w=new gA(m);g=t.runWebGLProgram(w,[r,o],"float32")}const y=Ee({inputs:{x:g},backend:t,attrs:{shape:m.outShape}});return t.disposeIntermediateTensorInfo(g),y}const kY={kernelName:Dp,backendName:"webgl",kernelFunc:wY};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class CY{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideHeight,s=e.strideWidth,r=e.padInfo.top,o=e.padInfo.left,i=e.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${t} - ${r};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${s} - ${o};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              ${i?`float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);`:`float dyValue = getDy(b, d2, yR, yC);
              float xValue = getX(b, d1, xR, xC);
              dotProd += (xValue * dyValue);`}
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class SY{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterHeight,s=e.filterWidth,r=e.strideHeight,o=e.strideWidth,i=e.dataFormat==="channelsLast",a=t-1-e.padInfo.top,l=s-1-e.padInfo.left,u=i?1:2,d=i?2:3,f=i?3:1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[${f}];

        ivec2 dyCorner = ivec2(coords[${u}], coords[${d}]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${t}; wR++) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${t} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            float dyC = float(dyCCorner + wC) / ${o}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${s} - 1 - wC;

            for (int d2 = 0; d2 < ${e.outChannels}; d2++) {

              if (${i}) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}}class NY{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideDepth,s=e.strideHeight,r=e.strideWidth,o=e.padInfo.front,i=e.padInfo.top,a=e.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yF = 0; yF < ${e.outDepth}; yF++) {
            int xF = wF + yF * ${t} - ${o};

            if (xF < 0 || xF >= ${e.inDepth}) {
              continue;
            }

            for (int yR = 0; yR < ${e.outHeight}; yR++) {
              int xR = wR + yR * ${s} - ${i};

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int yC = 0; yC < ${e.outWidth}; yC++) {
                int xC = wC + yC * ${r} - ${a};

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class IY{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterDepth,s=e.filterHeight,r=e.filterWidth,o=e.strideDepth,i=e.strideHeight,a=e.strideWidth,l=t-1-e.padInfo.front,u=s-1-e.padInfo.top,d=r-1-e.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(${l}, ${u}, ${d});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < ${t}; wF++) {
          float dyF = float(dyFCorner + wF) / ${o}.0;

          if (dyF < 0.0 || dyF >= ${e.outDepth}.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = ${t} - 1 - wF;

          for (int wR = 0; wR < ${s}; wR++) {
            float dyR = float(dyRCorner + wR) / ${i}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = ${s} - 1 - wR;

            for (int wC = 0; wC < ${r}; wC++) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = ${r} - 1 - wC;

              for (int d2 = 0; d2 < ${e.outChannels}; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $Y(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:o}=e,{strides:i,pad:a,dataFormat:l,dimRoundingMode:u,filterShape:d}=s,f=To(l),m=An(r.shape,d,i,1,a,u,!1,f),g=new CY(m);return t.runWebGLProgram(g,[r,o],"float32")}const TY={kernelName:_y,backendName:"webgl",kernelFunc:$Y};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class EY{constructor(e){this.variableNames=["dy","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"strides",type:"vec2"}],this.outputShape=e.inShape,this.enableShapeUniforms=Un(this.outputShape.length);const t=e.filterHeight,s=e.filterWidth,r=t-1-e.padInfo.top,o=s-1-e.padInfo.left;this.userCode=`
      const ivec2 pads = ivec2(${r}, ${o});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];

        ivec2 dyCorner = ivec2(coords[1], coords[2]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        vec4 result = vec4(0.);
        for (int wR = 0; wR < ${t}; wR++) {
          float dyR = float(dyRCorner + wR) / strides[0];
          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);
          int wRPerm = ${t} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            int wCPerm = ${s} - 1 - wC;

            float dyC = float(dyCCorner + wC) / strides[1];
            bool idyCVal = (dyC >= 0.0) && (dyC < ${e.outWidth}.0)
              && (fract(dyC) == 0.0);
            int idyC = int(dyC);

            float dyC2 = float(dyCCorner + wC + 1) / strides[1];
            bool idyCVal2 = (dyC2 >= 0.0) && (dyC2 < ${e.outWidth}.0)
              && (fract(dyC2) == 0.0);
            int idyC2 = int(dyC2);

            if (idyCVal && idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec4 dySample2 = (idyC / 2 == idyC2 / 2) ?
                  dySample : getDy(batch, idyR, idyC2, d2);

                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));

                dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample2.xy : dySample2.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC2, d2);
                vec2 dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            }
          }
        }
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RY(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:o}=e,{inputShape:i,strides:a,pad:l,dataFormat:u,dimRoundingMode:d}=s,f=To(u),m=An(i,o.shape,a,1,l,d,!1,f);if(de().getBool("WEBGL_PACK_CONV2DTRANSPOSE")&&f==="channelsLast"){const g=[[m.strideHeight,m.strideWidth]],y=new EY(m);return t.runWebGLProgram(y,[r,o],"float32",g)}else{const g=new SY(m);return t.runWebGLProgram(g,[r,o],"float32")}}const AY={kernelName:Mp,backendName:"webgl",kernelFunc:RY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DY(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:o}=e,{strides:i,pad:a,dilations:l}=s,u=gi(r.shape,o.shape,i,l,a),d=new vY(u);return t.runWebGLProgram(d,[r,o],"float32")}const MY={kernelName:Pp,backendName:"webgl",kernelFunc:DY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PY(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:o}=e,{strides:i,pad:a,filterShape:l}=s,u=gi(r.shape,l,i,1,a),d=new NY(u);return t.runWebGLProgram(d,[r,o],"float32")}const FY={kernelName:zy,backendName:"webgl",kernelFunc:PY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LY(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:o}=e,{pad:i,strides:a,inputShape:l}=s,u=gi(l,o.shape,a,1,i),d=new IY(u);return t.runWebGLProgram(d,[r,o],"float32")}const jY={kernelName:By,backendName:"webgl",kernelFunc:LY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OY=Kl+`
  return cos(x);
`,_Y=`
  vec4 result = cos(x);
  bvec4 isNaN = isnan(x);
  ${Sa}
  return result;
`,zY=dt({opSnippet:OY,packedOpSnippet:_Y}),BY={kernelName:ju,backendName:"webgl",kernelFunc:zY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VY=`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`,WY=dt({opSnippet:VY}),UY={kernelName:Ou,backendName:"webgl",kernelFunc:WY};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class GY{constructor(e,t,s,r,o){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];const[i,a,l,u]=e,[d]=t,[f,m]=s;this.outputShape=[d,f,m,u];const g=r==="bilinear"?1:0,[y,w]=[`${a-1}.0`,`${l-1}.0`],[b,k,v]=f>1?[`${(a-1)/(f-1)}`,"(y2-y1) * height_ratio",`y1*${y} + float(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${y}`],[N,S,$]=m>1?[`${(l-1)/(m-1)}`,"(x2-x1) * width_ratio",`x1*${w} + float(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${w}`];this.userCode=`
      const float height_ratio = float(${b});
      const float width_ratio = float(${N});
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= ${i}) {
          return;
        }

        float height_scale = ${k};
        float width_scale = ${S};

        float in_y = ${v};
        if( in_y < 0.0 || in_y > ${y} ) {
          setOutput(float(${o}));
          return;
        }
        float in_x = ${$};
        if( in_x < 0.0 || in_x > ${w} ) {
          setOutput(float(${o}));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(${g} == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HY=n=>{const{inputs:e,backend:t,attrs:s}=n,{image:r,boxes:o,boxInd:i}=e,{cropSize:a,method:l,extrapolationValue:u}=s,d=new GY(r.shape,o.shape,a,l,u);return t.runWebGLProgram(d,[r,o,i],"float32")},qY={kernelName:Wy,backendName:"webgl",kernelFunc:HY};var bu;(function(n){n.Prod="*",n.Sum="+"})(bu||(bu={}));class QC{constructor(e,t,s,r){this.op=e,this.outputShape=t,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];const o=this.outputShape.length,i=this.op===bu.Prod?"1.0":"0.0",a=s?i:`getX(${YC(o,"coords",this.op)})`,l=this.outputShape[this.outputShape.length-1];let u="",d="";s?(u=r?`end != ${l-1}`:"end != 0",d=r?"end + 1":"end - 1"):(u=r?`end + pow2 < ${l}`:"end >= pow2",d=r?"end + pow2":"end - pow2"),this.userCode=`
      void main() {
        ${Ct(o)} coords = getOutputCoords();
        int end = ${JC(o,"coords",this.op)};
        float val = ${a};
        int pow2 = int(pow(2.0, index));
        if (${u}) {
          int idx = ${d};
          ${JC(o,"coords",this.op)} = idx;
          val ${this.op}= getX(${YC(o,"coords",this.op)});
        }
        setOutput(val);
      }
    `}}function YC(n,e,t){if(n===1)return`${e}`;if(n===2)return`${e}.x, ${e}.y`;if(n===3)return`${e}.x, ${e}.y, ${e}.z`;if(n===4)return`${e}.x, ${e}.y, ${e}.z, ${e}.w`;throw new Error(`Cumulative ${t} for rank ${n} is not yet supported`)}function JC(n,e,t){if(n===1)return`${e}`;if(n===2)return`${e}.y`;if(n===3)return`${e}.z`;if(n===4)return`${e}.w`;throw new Error(`Cumulative ${t} for rank ${n} is not yet supported`)}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bA(n,e,t,s,r,o){const i=e.shape.length,a=Bt([s],i);let l=e;a!=null&&(l=rs({inputs:{x:e},backend:t,attrs:{perm:a}}));const u=Zt(1,i)[0];if(u!==i-1)throw new Error(`WebGL cumprod shader expects an inner-most axis=${e.shape.length-1} but got axis=${s}`);const d=l.shape[u];let f=Ms({inputs:{x:l},backend:t});for(let m=0;m<=Math.ceil(Math.log2(d))-1;m++){const g=new QC(n,l.shape,!1,o),y=[[m]],w=f;f=t.runWebGLProgram(g,[f],f.dtype,y),t.disposeIntermediateTensorInfo(w)}if(r){const m=new QC(n,l.shape,r,o),g=f;f=t.runWebGLProgram(m,[f],f.dtype),t.disposeIntermediateTensorInfo(g)}if(a!=null){const m=xi(a),g=rs({inputs:{x:f},backend:t,attrs:{perm:m}});return t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(l),g}return f}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KY(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,exclusive:i,reverse:a}=s;return bA(bu.Prod,r,t,o,i,a)}const XY={kernelName:Vy,backendName:"webgl",kernelFunc:KY};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QY(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,exclusive:i,reverse:a}=s;return bA(bu.Sum,r,t,o,i,a)}const YY={kernelName:Fp,backendName:"webgl",kernelFunc:QY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JY(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,weights:o}=e,{size:i,binaryOutput:a}=s;if(r.shape.length===1){const l=t.readSync(r.dataId),u=t.readSync(o.dataId),d=eA(l,u,o.dtype,o.shape,i);return t.makeTensorInfo([i],o.dtype,d)}else if(r.shape.length===2){const l=t.bufferSync(r),u=t.bufferSync(o),d=nK(l,u,i,a);return t.makeTensorInfo(d.shape,o.dtype,d.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${r.shape.length}.`)}const ZY={kernelName:Uy,backendName:"webgl",kernelFunc:JY};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class eJ{constructor(e,t,s){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=s,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = ${this.getHeightCoordString()};
      int w = ${this.getWidthCoordString()};
      int d = ${this.getDepthCoordString()};

      int in_h = h / ${t};
      int offset_h = imod(h, ${t});
      int in_w = w / ${t};
      int offset_w = imod(w, ${t});
      int offset_d = (offset_h * ${t} + offset_w) *
        ${this.getOutputDepthSize()};
      int in_d = d + offset_d;

      float result = ${this.getInputSamplingString()};
      setOutput(result);
    }
  `}getHeightCoordString(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"}getWidthCoordString(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"}getDepthCoordString(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"}getOutputDepthSize(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tJ(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockSize:o,dataFormat:i}=s,a=r.shape[0],l=i==="NHWC"?r.shape[1]:r.shape[2],u=i==="NHWC"?r.shape[2]:r.shape[3],d=i==="NHWC"?r.shape[3]:r.shape[1],f=l*o,m=u*o,g=d/(o*o),y=i==="NHWC"?[a,f,m,g]:[a,g,f,m],w=new eJ(y,o,i);return t.runWebGLProgram(w,[r],r.dtype)}const nJ={kernelName:Gy,backendName:"webgl",kernelFunc:tJ};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class wA{constructor(e,t=!1,s=null,r=!1,o=!1){this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=Un(this.outputShape.length);const i=e.filterHeight,a=e.filterWidth,l=e.outChannels/e.inChannels;let u="",d="";s&&(r?u=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:o?u=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:u=`
          float activation(float x) {
            ${s}
          }
        `,d="result = activation(result);");const f=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),o&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${u}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${l};
        int q = d2 - d1 * ${l};

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < ${i}; wR++) {
          int xR = xRCorner + wR * dilations[0];

          if (xR < 0 || xR >= inDims[0]) {
            continue;
          }

          for (int wC = 0; wC < ${a}; wC++) {
            int xC = xCCorner + wC * dilations[1];

            if (xC < 0 || xC >= inDims[1]) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        ${f}
        ${d}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class kA{constructor(e,t=!1,s=null,r=!1,o=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=Un(this.outputShape.length);const i=e.outChannels/e.inChannels,a=e.padInfo.left,l=e.strideWidth,u=e.dilationWidth,d=e.filterHeight,f=e.filterWidth,m=f;let g=`
      int xR; int xC; int xCOffset;
      vec4 wTexel; vec4 previous; vec4 final;`;for(let k=0;k<f;k++)g+=`
          vec4 xTexelC${k*2};
          int xTexelC${k*2}Ready;
          vec4 xTexelC${k*2+1};
          int xTexelC${k*2+1}Ready;
          vec4 xC${k};`;g+=`
    for (int r = 0; r < ${d}; r++) {
      `;for(let k=0;k<f;k++)g+=`
          xTexelC${k*2} = vec4(0.0);
          xTexelC${k*2}Ready = 0;
          xTexelC${k*2+1} = vec4(0.0);
          xTexelC${k*2+1}Ready = 0;
          xC${k} = vec4(0.0);`;g+=`
        xR = xRCorner + r * dilations[0];
        if (xR >=0 && xR < inDims[0]) {
      `;for(let k=0;k<(m+1)/2;k++){const v=k*2;if(g+=`
          xC = xCCorner + ${v*u};
          `,l===1){if(v<f&&(a%2===1?(g+=`
                xCOffset = xC + 1;
                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${v}Ready == 0) {
                  xTexelC${v} = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${v}.zw = vec2(0.0);
                  }
                  xTexelC${v}Ready = 1;
                }
              `,u===1&&v>0?g+=`
                xC${v} = vec4(xTexelC${v-2}.zw, xTexelC${v}.xy);
                `:g+=`
                  xCOffset = xC + 1 - 2;

                  if (xCOffset >= 0 && xCOffset < inDims[1]) {
                    previous = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      previous.zw = vec2(0.0);
                    }

                    xC${v} = vec4(previous.zw, xTexelC${v}.xy);
                  } else {
                    xC${v} = vec4(0.0, 0.0, xTexelC${v}.xy);
                  }
                  `):g+=`
                if (xC >= 0 && xC < inDims[1] && xTexelC${v}Ready == 0) {
                  xTexelC${v} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${v}.zw = vec2(0.0);
                  }
                  xTexelC${v}Ready = 1;
                }

                xC${v} = xTexelC${v};
                `,v+1<f)){const N=a%2===0?Iy(u):u;u%2===0&&a%2===1||u%2!==0&&a%2!==1?(g+=`
                  xCOffset = xC + imod(pads[1], 2) + ${N};

                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${v+1}Ready == 0) {
                    xTexelC${v+1} = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      xTexelC${v+1}.zw = vec2(0.0);
                    }
                    xTexelC${v+1}Ready = 1;
                  }
                  `,u>1?g+=`
                    xCOffset -= 2;
                    if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);
                     xC${v+1} = vec4(previous.zw, xTexelC${v+1}.xy);
                    } else {
                     xC${v+1} = vec4(0.0, 0.0, xTexelC${v+1}.xy);
                    }
                    `:g+=`
                    xC${v+1} = vec4(xTexelC${v}.zw, xTexelC${v+1}.xy);
                    `):N===1?g+=`
                    xC${v+1} = xTexelC${v};
                    `:g+=`
                    xCOffset = xC + ${N};

                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${v+1}Ready == 0) {
                      xTexelC${v+1} = getX(batch, xR, xCOffset, d1);
                      if (xCOffset + 1 >= inDims[1]) {
                        xTexelC${v+1}.zw = vec2(0.0);
                      }
                      xTexelC${v+1}Ready = 1;
                    }

                    xC${v+1} = xTexelC${v+1};
                    `}}else v<f&&(a%2===1?(g+=`
                xCOffset = xC + 1 - strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${v}Ready == 0) {
                  xTexelC${v} = getX(batch, xR, xCOffset, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${v}.zw = vec2(0.0);
                  }
                  xTexelC${v}Ready = 1;
                }

                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${v+1}Ready == 0) {
                  xTexelC${v+1} = getX(batch, xR, xC + 1, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xC + 2 >= inDims[1]) {
                    xTexelC${v+1}.zw = vec2(0.0);
                  }
                  xTexelC${v+1}Ready = 1;
                }

                xC${v} = vec4(xTexelC${v}.zw, xTexelC${v+1}.zw);
              `,v+1<f&&(g+=`
                  final = vec4(0.0);
                  xCOffset = xC + 1 + strides[1];
                  if(xCOffset >= 0 && xCOffset < inDims[1]) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xC${v+1} = vec4(xTexelC${v+1}.xy, final.xy);
                `)):(g+=`
                if(xC >= 0 && xC < inDims[1] && xTexelC${v}Ready == 0) {
                  xTexelC${v} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${v}.zw = vec2(0.0);
                  }
                  xTexelC${v}Ready = 1;
                }

                xCOffset = xC + strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${v+1}Ready == 0) {
                  xTexelC${v+1} = getX(batch, xR, xCOffset, d1);
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${v+1}.zw = vec2(0.);
                  }
                  xTexelC${v+1}Ready = 1;
                }

                xC${v} = vec4(
                  xTexelC${v}.xy, xTexelC${v+1}.xy);
              `,v+1<f&&(g+=`
                  xC${v+1} = vec4(xTexelC${v}.zw, xTexelC${v+1}.zw);
                `)));v<f&&(g+=`
            wTexel = getW(r, ${v}, d1, q);
            dotProd += xC${v} * vec4(wTexel.xz, wTexel.xz);
          `,v+1<f&&(g+=`
              wTexel = getW(r, ${v+1}, d1, q);
              dotProd += xC${v+1} * vec4(wTexel.xz, wTexel.xz);
            `))}g+=`
    }
  `,g+=`
      }
    `;let y="",w="";s&&(r?y=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:o?y=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:y=`vec4 activation(vec4 x) {
          ${s}
        }`,w="result = activation(result);");const b=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),o&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${y}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${i};
        int q = d2 - d1 * ${i};
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
        vec4 dotProd = vec4(0.000000000000001);

        ${g}

        vec4 result = dotProd - vec4(0.000000000000001);
        ${b}
        ${w}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sJ(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:o}=e,{strides:i,pad:a,dilations:l,dimRoundingMode:u}=s;let d=l;d==null&&(d=[1,1]),_(Vn(i,d),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${i} and dilations '${d}'`);const f=An(r.shape,o.shape,i,d,a,u,!0);let m;de().getBool("WEBGL_PACK_DEPTHWISECONV")&&f.strideWidth<=2&&f.outChannels/f.inChannels===1?m=new kA(f):m=new wA(f);const g=[[f.padInfo.top,f.padInfo.left],[f.strideHeight,f.strideWidth],[f.dilationHeight,f.dilationWidth],[f.inHeight,f.inWidth]];return t.runWebGLProgram(m,[r,o],"float32",g)}const rJ={kernelName:Lp,backendName:"webgl",kernelFunc:sJ};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class oJ{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideHeight,s=e.strideWidth,r=e.padInfo.top,o=e.padInfo.left,i=e.outChannels/e.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * ${i} + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${t} - ${r};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${s} - ${o};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class iJ{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterHeight,s=e.filterWidth,r=e.strideHeight,o=e.strideWidth,i=t-1-e.padInfo.top,a=s-1-e.padInfo.left,l=e.outChannels/e.inChannels;this.userCode=`
      const ivec2 pads = ivec2(${i}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < ${t}; wR++) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${t} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            float dyC = float(dyCCorner + wC) / ${o}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${s} - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < ${l}; dm++) {
              int d2 = d1 * ${l} + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aJ(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:o}=e,{strides:i,dilations:a,pad:l,dimRoundingMode:u,filterShape:d}=s,f=An(r.shape,d,i,a,l,u,!0),m=new oJ(f);return t.runWebGLProgram(m,[r,o],"float32")}const lJ={kernelName:Hy,backendName:"webgl",kernelFunc:aJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cJ(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:o}=e,{strides:i,dilations:a,pad:l,dimRoundingMode:u,inputShape:d}=s,f=An(d,o.shape,i,a,l,u,!0),m=new iJ(f);return t.runWebGLProgram(m,[r,o],"float32")}const uJ={kernelName:qy,backendName:"webgl",kernelFunc:cJ};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class dJ{constructor(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hJ(n){const{inputs:e,backend:t}=n,{x:s}=e,r=[...s.shape,...s.shape],o=pe(s.shape),i=Ee({inputs:{x:s},backend:t,attrs:{shape:[o]}}),a=new dJ(o),l=t.runWebGLProgram(a,[i],i.dtype),u=Ee({inputs:{x:l},backend:t,attrs:{shape:r}});return t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(l),u}const fJ={kernelName:lN,backendName:"webgl",kernelFunc:hJ};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class pJ{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const{inHeight:t,inWidth:s,padInfo:r,strideHeight:o,strideWidth:i,filterHeight:a,filterWidth:l,dilationHeight:u,dilationWidth:d}=e,{top:f,left:m}=r;this.userCode=`
      const ivec2 strides = ivec2(${o}, ${i});
      const ivec2 pads = ivec2(${f}, ${m});
      const float neg_infinity = -3.4e38;

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.w;
        ivec2 outTopLeftCorner =
            coords.yz * strides - pads;
        int hBeg = outTopLeftCorner.x;
        int wBeg = outTopLeftCorner.y;

        float curVal = neg_infinity;
        for (int h = 0; h < ${a}; h++) {
          int hIn = hBeg + h * ${u};

          if (hIn >= 0 && hIn < ${t}) {
            for (int w = 0; w < ${l}; w++) {
              int wIn = wBeg + w * ${d};

              if (wIn >= 0 && wIn < ${s}) {
                float xVal = getX(batch, hIn, wIn, d1);
                float wVal = getW(h, w, d1);

                float val = xVal + wVal;
                if (val > curVal) {
                  curVal = val;
                }
              }
            }
          }
        }

        float result = curVal;
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mJ(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:o}=e,{strides:i,pad:a,dilations:l}=s,u=kd(r.shape,o.shape,i,a,"NHWC",l);let d;const f=new pJ(u);d=t.runWebGLProgram(f,[r,o],"float32");const m=Ee({inputs:{x:d},backend:t,attrs:{shape:u.outShape}});return t.disposeIntermediateTensorInfo(d),m}const gJ={kernelName:jp,backendName:"webgl",kernelFunc:mJ};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xJ(n){const{inputs:e,backend:t,attrs:s}=n,{equation:r}=s,o=e,{allDims:i,summedDims:a,idDims:l}=gv(r,o.length);yv(i.length,l,o);const{path:u,steps:d}=vv(a,l),f=d.length;let m=null,g=i.length;const y=[];for(let w=0;w<f;++w){for(const b of d[w]){const{permutationIndices:k,expandDims:v}=xv(g,l[b]);let N;bv(k)?N=o[b]:(N=rs({inputs:{x:o[b]},backend:t,attrs:{perm:k}}),y.push(N));const S=N.shape.slice();for(let $=0;$<v.length;++$)S.splice(v[$],0,1);xt(N.shape,S)||(N=Ee({inputs:{x:N},backend:t,attrs:{shape:S}}),y.push(N)),m===null?m=N:(m=ib({inputs:{a:N,b:m},backend:t}),y.push(m))}w<f-1&&(u[w]>=0&&(m=Jm({inputs:{x:m},backend:t,attrs:{axis:u[w]-(i.length-g),keepDims:!1}}),y.push(m)),g--)}for(const w of y)w!==m&&t.disposeIntermediateTensorInfo(w);return m}const yJ={kernelName:Ky,backendName:"webgl",kernelFunc:xJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vJ="return (x >= 0.0) ? x : (exp(x) - 1.0);",bJ=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,wJ=dt({opSnippet:vJ,packedOpSnippet:bJ}),kJ={kernelName:zu,backendName:"webgl",kernelFunc:wJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CJ="return (b >= 0.0) ? a : a * (b + 1.0);",SJ=`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,NJ=n=>{const{inputs:e,backend:t}=n,{dy:s,y:r}=e,o=de().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ql(SJ,s.shape,r.shape):new ha(CJ,s.shape,r.shape);return t.runWebGLProgram(o,[s,r],s.dtype)},IJ={kernelName:Xy,backendName:"webgl",kernelFunc:NJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $J=`
  return vec4(equal(a, b));
`,TJ="return float(a == b);",EJ=Mn({opSnippet:TJ,packedOpSnippet:$J,dtype:"bool",cpuKernelImpl:aK}),RJ={kernelName:Op,backendName:"webgl",kernelFunc:EJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AJ=`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = ${cv};
  float a1 = ${uv};
  float a2 = ${dv};
  float a3 = ${hv};
  float a4 = ${fv};
  float a5 = ${pv};

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`,DJ=dt({opSnippet:AJ}),MJ={kernelName:Bu,backendName:"webgl",kernelFunc:DJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PJ=Kl+`
  return exp(x);
`,FJ=`
  vec4 result = exp(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,CA=dt({opSnippet:PJ,packedOpSnippet:FJ,cpuKernelImpl:lK,dtype:"float32"}),LJ={kernelName:Vu,backendName:"webgl",kernelFunc:CA};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fy(n){const{inputs:e,attrs:t,backend:s}=n,{dim:r}=t,{input:o}=e,i=o.shape.length,a=o.shape.slice();let l=r;return r<0&&(_(-(i+1)<=r,()=>`Axis must be in the interval [${-(i+1)}, ${i}]`),l=i+r+1),a.splice(l,0,1),Ee({inputs:{x:o},backend:s,attrs:{shape:a}})}const jJ={kernelName:_p,backendName:"webgl",kernelFunc:fy};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZC="return exp(x) - 1.0;",OJ=dt({opSnippet:ZC,packedOpSnippet:ZC,cpuKernelImpl:cK}),_J={kernelName:Wu,backendName:"webgl",kernelFunc:OJ};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class eS{constructor(e,t,s){this.variableNames=["real","imag"];const r=t[1];this.outputShape=t;const o=s?`2.0 * ${Math.PI}`:`-2.0 * ${Math.PI}`,i=s?`${r}.0`:"1.0";let a;if(e==="real")a="return real * expR - imag * expI;";else if(e==="imag")a="return real * expI + imag * expR;";else throw new Error(`FFT component must be either "real" or "imag", got ${e}.`);this.userCode=`
      const float exponentMultiplier = ${o};

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        ${a}
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(${r});
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < ${r}; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / ${i};
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SA(n,e,t){const s=t.texData.get(n.dataId),r=pe(n.shape),o=n.shape[n.shape.length-1],i=r/o,a=Ee({inputs:{x:n},backend:t,attrs:{shape:[i,o]}}),l=a.shape,u=new eS("real",l,e),d=new eS("imag",l,e),f=[{dataId:s.complexTensorInfos.real.dataId,dtype:s.complexTensorInfos.real.dtype,shape:l},{dataId:s.complexTensorInfos.imag.dataId,dtype:s.complexTensorInfos.imag.dtype,shape:l}],m=t.runWebGLProgram(u,f,"float32"),g=t.runWebGLProgram(d,f,"float32"),y=Ci({inputs:{real:m,imag:g},backend:t});t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(g);const w=Ee({inputs:{x:y},backend:t,attrs:{shape:n.shape}});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(y),w}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zJ(n){const{inputs:e,backend:t}=n,{input:s}=e;return SA(s,!1,t)}const BJ={kernelName:Qy,backendName:"webgl",kernelFunc:zJ};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class VJ{constructor(e,t){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=e,this.userCode=`
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wd(n){const{backend:e,attrs:t}=n,{shape:s,value:r}=t;let{dtype:o}=t;if(o=o||Pl(r),o==="string"){const i=Qt(o,pe(s));return i.fill(r),e.makeTensorInfo(s,o,i)}else{const i=new VJ(s,r),a=[[r]];return e.runWebGLProgram(i,[],o,a)}}const WJ={kernelName:Yy,backendName:"webgl",kernelFunc:Wd};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class UJ{constructor(e){this.variableNames=["Image"],this.outputShape=[];const t=e[2];this.outputShape=e,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];

          int coordX = ${t} - x - 1;
          float outputValue;
          if(coordX >= 0 && coordX < ${t}) {
            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);
          } else {
            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GJ={kernelName:Jy,backendName:"webgl",kernelFunc:({inputs:n,backend:e})=>{const{image:t}=n,s=e,r=new UJ(t.shape);return s.runWebGLProgram(r,[t],t.dtype)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tS="return floor(x);",HJ=dt({opSnippet:tS,packedOpSnippet:tS,cpuKernelImpl:uK}),qJ={kernelName:Uu,backendName:"webgl",kernelFunc:HJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KJ=`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,XJ=`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,QJ=Mn({opSnippet:KJ,packedOpSnippet:XJ,dtype:"int32"}),YJ={kernelName:Gu,backendName:"webgl",kernelFunc:QJ};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class JJ{constructor(e){this.variableNames=["A"];const t=os(),[s,r]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${r}.0, ${s}.0);

        vec4 values = ${t.texture2D}(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ZJ{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;const t=os(),[s,r]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(${r}.0, ${s}.0);
            vec4 values = ${t.texture2D}(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        ${t.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eZ={kernelName:GM,backendName:"webgl",kernelFunc:tZ};let tl,g0=de().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");function tZ(n){const{inputs:e,backend:t,attrs:s}=n;let{pixels:r}=e;const{numChannels:o}=s,i=typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement,a=typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement,[l,u]=i?[r.videoWidth,r.videoHeight]:[r.width,r.height],d=[u,l],f=[u,l,o];if(a||i){const w=de().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");(tl==null||w!==g0)&&(g0=w,tl=document.createElement("canvas").getContext("2d",{willReadFrequently:g0})),tl.canvas.width=l,tl.canvas.height=u,tl.drawImage(r,0,0,l,u),r=tl.canvas}const m=t.makeTensorInfo(d,"int32");t.texData.get(m.dataId).usage=Vs.PIXELS,t.gpgpu.uploadPixelDataToTexture(t.getTexture(m.dataId),r);const g=de().getBool("WEBGL_PACK")?new ZJ(f):new JJ(f),y=t.runWebGLProgram(g,[m],"int32");return t.disposeData(m.dataId),y}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nZ(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:o,bias:i,preluActivationWeights:a}=e,{strides:l,pad:u,dataFormat:d,dilations:f,dimRoundingMode:m,activation:g,leakyreluAlpha:y}=s,w=To(d),b=An(r.shape,o.shape,l,f,u,m,!1,w);let k;const v=[],N=i!=null,S=a!=null,$=g==="leakyrelu",R=()=>{const A=[r,o],P=(D,E)=>{if(E==="NCHW"&&D.shape.length===1&&D.shape[0]!==1){const j=Ee({inputs:{x:D},backend:t,attrs:{shape:[D.shape[0],1,1]}});return v.push(j),j}return D};if(N&&A.push(P(i,d)),S&&A.push(P(a,d)),$){const D=t.makeTensorInfo([],"float32",pi(y,"float32"));A.push(D),v.push(D)}return A};if(b.filterHeight===1&&b.filterWidth===1&&b.dilationHeight===1&&b.dilationWidth===1&&b.strideHeight===1&&b.strideWidth===1&&(b.padInfo.type==="SAME"||b.padInfo.type==="VALID"))k=yA({x:r,filter:o,convInfo:b,backend:t,bias:i,activation:g,preluActivationWeights:a,leakyreluAlpha:y});else if(b.strideWidth<=2&&w==="channelsLast"&&de().getBool("WEBGL_EXP_CONV")){const A=g?yu(g,!0):null,P=new xA(b,N,A,S,$),D=[[b.padInfo.top,b.padInfo.left],[b.strideHeight,b.strideWidth],[b.dilationHeight,b.dilationWidth],[b.inHeight,b.inWidth]],E=R();k=t.runWebGLProgram(P,E,"float32",D)}else if(de().getBool("WEBGL_CONV_IM2COL"))k=vA({x:r,filter:o,convInfo:b,backend:t,bias:i,activation:g,preluActivationWeights:a,leakyreluAlpha:y});else{const A=g?yu(g,!1):null,P=new gA(b,N,A,S,$),D=R();k=t.runWebGLProgram(P,D,"float32")}const M=Ee({inputs:{x:k},backend:t,attrs:{shape:b.outShape}});return v.push(k),v.forEach(A=>t.disposeIntermediateTensorInfo(A)),M}const sZ={kernelName:_f,backendName:"webgl",kernelFunc:nZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rZ(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:o,bias:i,preluActivationWeights:a}=e,{strides:l,pad:u,dilations:d,dimRoundingMode:f,activation:m,leakyreluAlpha:g}=s,y=[];let w=d;w==null&&(w=[1,1]),_(Vn(l,w),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${l} and dilations '${w}'`);const b=An(r.shape,o.shape,l,w,u,f,!0),k=de().getBool("WEBGL_PACK_DEPTHWISECONV")&&b.strideWidth<=2&&b.outChannels/b.inChannels===1,v=m?yu(m,k):null,N=[r,o],S=i!=null,$=a!=null,R=m==="leakyrelu";if(S&&N.push(i),$&&N.push(a),R){const D=t.makeTensorInfo([],"float32",pi(g,"float32"));N.push(D),y.push(D)}let M;k?M=new kA(b,S,v,$,R):M=new wA(b,S,v,$,R);const A=[[b.padInfo.top,b.padInfo.left],[b.strideHeight,b.strideWidth],[b.dilationHeight,b.dilationWidth],[b.inHeight,b.inWidth]],P=t.runWebGLProgram(M,N,"float32",A);return y.forEach(D=>t.disposeIntermediateTensorInfo(D)),P}const oZ={kernelName:$N,backendName:"webgl",kernelFunc:rZ};class iZ{constructor(e,t,s,r){this.sliceDim=e,this.strides=t,this.paramsShape=r,this.variableNames=["x","indices"],this.outputShape=s;const o=Ct(s.length);let i=`
    int index;`;for(let a=0;a<this.sliceDim;a++)i+=`
          index = round(getIndices(coords[0], ${a}));
          out_of_bounds = out_of_bounds || index < 0;
          out_of_bounds = out_of_bounds || index >= ${this.paramsShape[a]};
          flattenIndex += index * ${this.strides[a]};`;this.userCode=`
         void main() {
          ${o} coords = getOutputCoords();
          int flattenIndex = 0;
          bool out_of_bounds = false;

          ${i}

          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aZ(n){const{inputs:e,backend:t}=n,{params:s,indices:r}=e,o=r.shape,i=o[o.length-1],a=pe(s.shape),[l,u,d,f]=J1(s,r),m=Ee({inputs:{x:r},backend:t,attrs:{shape:[u,i]}}),g=Ee({inputs:{x:s},backend:t,attrs:{shape:[pe(s.shape)/d,d]}});if(t.shouldExecuteOnCPU([s,r])||s.dtype==="string"){const k=t.readSync(r.dataId),v=t.bufferSync(s),N=dK(k,v,s.dtype,u,i,d,f,s.shape,a);return t.makeTensorInfo(l,s.dtype,N.values)}const y=new iZ(i,f,[u,d],s.shape),w=t.runWebGLProgram(y,[g,m],g.dtype),b=Ee({inputs:{x:w},backend:t,attrs:{shape:l}});return t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(w),b}const lZ={kernelName:cN,backendName:"webgl",kernelFunc:aZ};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class cZ{constructor(e,t){this.variableNames=["A","indices"],this.outputShape=t,this.rank=t.length;const s=Ct(this.rank),r=uZ(e);this.userCode=`
      void main() {
        ${s} resRC = getOutputCoords();
        int index = int(getIndices(resRC.x, resRC.z));
        float inBounds = (index >= 0) && (index < ${e[2]}) ? 1.0 : 0.0;
        setOutput(inBounds * getA(${r}));
      }
    `}}function uZ(n,e){const t=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[];for(let r=0;r<n.length;r++)r===2?s.push("index"):s.push(`${t[r]}`);return s.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NA(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,indices:o}=e,{axis:i,batchDims:a}=s,l=rt(i,r.shape)[0];if(de().get("DEBUG")){const v=t.readSync(o.dataId),N=r.shape[l];for(let S=0;S<v.length;++S){const $=v[S];_($<=N-1&&$>=0,()=>`GatherV2: the index value ${$} is not in [0, ${N-1}]`)}}const u=kv(r,o,l,a),d=pe(o.shape),f=[],m=Ee({inputs:{x:r},backend:t,attrs:{shape:[u.batchSize,u.outerSize,u.dimSize,u.sliceSize]}}),g=Ee({inputs:{x:o},backend:t,attrs:{shape:[u.batchSize,d/u.batchSize]}});f.push(m),f.push(g);const y=[u.batchSize,u.outerSize,d/u.batchSize,u.sliceSize];if(t.shouldExecuteOnCPU([r,o])||r.dtype==="string"){const v=t.bufferSync(g),N=t.bufferSync(m),S=hK(N,v,y);return f.forEach($=>t.disposeIntermediateTensorInfo($)),t.makeTensorInfo(u.outputShape,S.dtype,S.values)}const w=new cZ(m.shape,y),b=t.runWebGLProgram(w,[m,g],m.dtype);f.push(b);const k=Ee({inputs:{x:b},backend:t,attrs:{shape:u.outputShape}});return f.forEach(v=>t.disposeIntermediateTensorInfo(v)),k}const dZ={kernelName:Bp,backendName:"webgl",kernelFunc:NA};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hZ="return float(a > b);",fZ=`
  return vec4(greaterThan(a, b));
`,pZ=Mn({opSnippet:hZ,packedOpSnippet:fZ,cpuKernelImpl:fK,dtype:"bool"}),mZ={kernelName:Vp,backendName:"webgl",kernelFunc:pZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gZ="return float(a >= b);",xZ=`
  return vec4(greaterThanEqual(a, b));
`,yZ=Mn({opSnippet:gZ,packedOpSnippet:xZ,dtype:"bool",cpuKernelImpl:pK}),vZ={kernelName:Hu,backendName:"webgl",kernelFunc:yZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bZ(n){const{inputs:e,backend:t}=n,{input:s}=e;return SA(s,!0,t)}const wZ={kernelName:Zy,backendName:"webgl",kernelFunc:bZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kZ="return float(!isnan(x) && !isinf(x));",CZ=dt({opSnippet:kZ,dtype:"bool"}),SZ={kernelName:Ku,backendName:"webgl",kernelFunc:CZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NZ="return float(isinf(x));",IZ=dt({opSnippet:NZ,dtype:"bool"}),$Z={kernelName:Xu,backendName:"webgl",kernelFunc:IZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TZ="return float(isnan(x));",EZ=dt({opSnippet:TZ,dtype:"bool"}),RZ={kernelName:Qu,backendName:"webgl",kernelFunc:EZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AZ="return float(a < b);",DZ=`
  return vec4(lessThan(a, b));
`,MZ=Mn({opSnippet:AZ,packedOpSnippet:DZ,cpuKernelImpl:mK,dtype:"bool"}),PZ={kernelName:Up,backendName:"webgl",kernelFunc:MZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FZ="return float(a <= b);",LZ=`
  return vec4(lessThanEqual(a, b));
`,jZ=Mn({opSnippet:FZ,packedOpSnippet:LZ,cpuKernelImpl:gK,dtype:"bool"}),OZ={kernelName:Gp,backendName:"webgl",kernelFunc:jZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _Z(n){const{backend:e,attrs:t}=n,{start:s,stop:r,num:o}=t,i=xK(s,r,o);return e.makeTensorInfo([i.length],"float32",i)}const zZ={kernelName:uN,backendName:"webgl",kernelFunc:_Z};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BZ=Kl+`
  return x < 0.0 ? 0./0. : log(x);
`,VZ=`
  vec4 result = log(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);
  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);
  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);
  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);
  return result;
`,WZ=dt({opSnippet:BZ,packedOpSnippet:VZ,cpuKernelImpl:yK}),UZ={kernelName:Yu,backendName:"webgl",kernelFunc:WZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GZ=Kl+`
  return log(1.0 + x);
`,HZ=dt({opSnippet:GZ}),qZ={kernelName:Ju,backendName:"webgl",kernelFunc:HZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KZ="return float(a >= 1.0 && b >= 1.0);",XZ=`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,QZ=Mn({opSnippet:KZ,packedOpSnippet:XZ,dtype:"bool"}),YZ={kernelName:Hp,backendName:"webgl",kernelFunc:QZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JZ="return float(!(x >= 1.0));",ZZ=dt({opSnippet:JZ}),eee={kernelName:qp,backendName:"webgl",kernelFunc:ZZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tee="return float(a >= 1.0 || b >= 1.0);",nee=`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,see=Mn({opSnippet:tee,packedOpSnippet:nee,dtype:"bool"}),ree={kernelName:Kp,backendName:"webgl",kernelFunc:see};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class oee{constructor(e,t,s,r,o){this.variableNames=["x"],this.outputShape=[];const i=t,a=e[3]-1;this.outputShape=e;let l;const u=`float(${s}) + float(${r}) * sum`;o===.5?l=`inversesqrt(${u})`:o===1?l=`1.0/(${u})`:l=`exp(log(${u}) * float(-${o}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -${i}; j <= ${i}; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  ${a}) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * ${l};
        setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class iee{constructor(e,t,s,r,o){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;const i=t,a=e[3]-1;this.outputShape=e;let l;const u=`float(${s}) + float(${r}) * sum`;o===.5?l=`inversesqrt(${u})`:o===1?l=`1.0/(${u})`:l=`exp(log(${u}) * float(-${o}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < ${this.outputShape[3]};
        bool hasNextRow = c < ${this.outputShape[2]};

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - ${i};
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - ${i}; j <= ${i}; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(${a}));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * ${l};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aee=n=>{const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{depthRadius:o,bias:i,alpha:a,beta:l}=s,u=de().getBool("WEBGL_PACK_NORMALIZATION")?new iee(r.shape,o,i,a,l):new oee(r.shape,o,i,a,l);return t.runWebGLProgram(u,[r],r.dtype)},lee={kernelName:Xp,backendName:"webgl",kernelFunc:aee};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class cee{constructor(e,t,s,r,o){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=t,this.bias=s,this.alpha=r,this.beta=o,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < ${this.depth}; ++d) {
          int depthBegin = int(max(0.0, float(d - ${t})));
          int depthEnd = int(min(float(${this.depth}),
              float(d + ${t} + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = ${this.depth};

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(${r}) * norm + float(${s});

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(${r})
                * float(${o})
                * getInputImage(b, r, c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * ${o});
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uee=n=>{const{inputs:e,backend:t,attrs:s}=n,{x:r,y:o,dy:i}=e,{depthRadius:a,bias:l,alpha:u,beta:d}=s,f=new cee(r.shape,a,l,u,d);return t.runWebGLProgram(f,[r,o,i],r.dtype)},dee={kernelName:t1,backendName:"webgl",kernelFunc:uee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hee(n,e,t,s){const r=pe(e),i=pe(n.shape)/r,a=Ee({inputs:{x:n},attrs:{shape:[i,r]},backend:s}),l=Na(a,n.dtype,"max",s),u=Ee({inputs:{x:l},attrs:{shape:t},backend:s});return s.disposeIntermediateTensorInfo(a),s.disposeIntermediateTensorInfo(l),u}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IA(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{reductionIndices:o,keepDims:i}=s,a=r.shape.length,l=rt(o,r.shape);let u=l;const d=Bt(u,a),f=d!=null,m=t.shouldExecuteOnCPU([r]);let g=r;if(f){if(m){const N=t.texData.get(g.dataId).values,S=new Array(a);for(let M=0;M<S.length;M++)S[M]=r.shape[d[M]];const $=rb(N,r.shape,r.dtype,d,S);g=t.makeTensorInfo(S,r.dtype);const R=t.texData.get(g.dataId);R.values=$}else g=Ym(r,d,t);u=Zt(u.length,a)}Dn("max",u,a);const[y,w]=Sn(g.shape,u);let b=y;i&&(b=an(y,l));let k;if(m){const N=t.texData.get(g.dataId).values,S=vK(N,pe(w),b,r.dtype);k=t.makeTensorInfo(b,r.dtype);const $=t.texData.get(k.dataId);$.values=S}else k=hee(g,w,b,t);return f&&t.disposeIntermediateTensorInfo(g),k}const fee={kernelName:Qp,backendName:"webgl",kernelFunc:IA};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pee=ob+`
  return max(a, b);
`,mee=`
  vec4 result = vec4(max(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Sa+`
  return result;
`,gee=Mn({opSnippet:pee,packedOpSnippet:mee,cpuKernelImpl:bK}),xee={kernelName:Zu,backendName:"webgl",kernelFunc:gee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yee(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e;zd(r,"maxPool");const{filterSize:o,strides:i,pad:a,dimRoundingMode:l}=s,u=1;_(Vn(i,u),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${u}'`);const d=ur(r.shape,o,i,u,a,l);if(d.filterWidth===1&&d.filterHeight===1&&xt(d.inShape,d.outShape))return Ms({inputs:{x:r},backend:t});const f=new vu(d,"max",!1);return t.runWebGLProgram(f,[r],r.dtype)}const vee={kernelName:Yp,backendName:"webgl",kernelFunc:yee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bee(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{filterSize:o,strides:i,pad:a,dataFormat:l,dimRoundingMode:u}=s,d=[1,1,1],f=$o(r.shape,o,i,d,a,u,l),m=new ab(f,"max",!1);return t.runWebGLProgram(m,[r],r.dtype)}const wee={kernelName:Jp,backendName:"webgl",kernelFunc:bee};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class kee{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const t=e.strideHeight,s=e.strideWidth,r=e.dilationHeight,o=e.effectiveFilterHeight,i=e.effectiveFilterWidth,a=o-1-e.padInfo.top,l=i-1-e.padInfo.left,u=o*i-1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${o};
          wR += ${r}) {
          float dyR = float(dyRCorner + wR) / ${t}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${i}; wC++) {
            float dyC = float(dyCCorner + wC) / ${s}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = ${u} - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * ${i} + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}}class Cee{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const t=e.strideDepth,s=e.strideHeight,r=e.strideWidth,o=e.dilationDepth,i=e.dilationHeight,a=e.dilationWidth,l=e.effectiveFilterDepth,u=e.effectiveFilterHeight,d=e.effectiveFilterWidth,f=l-1-e.padInfo.front,m=u-1-e.padInfo.top,g=d-1-e.padInfo.left,y=l*u*d-1;this.userCode=`
      const ivec3 pads = ivec3(${f}, ${m}, ${g});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${l};
           wD += ${o}) {
          float dyD = float(dyDCorner + wD) / ${t}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${u};
              wR += ${i}) {
            float dyR = float(dyRCorner + wR) / ${s}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${d};
                wC += ${a}) {
              float dyC = float(dyCCorner + wC) / ${r}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = ${y} -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * ${u} * ${d} +
                  wR * ${d} + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function See(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:o}=e,i=o,{filterSize:a,strides:l,pad:u,dimRoundingMode:d}=s,f=[1,1,1],m=$o(i.shape,a,l,f,u,d),g=new ab(m,"max",!0),y=t.runWebGLProgram(g,[i],i.dtype),w=new Cee(m),b=t.runWebGLProgram(w,[r,y],i.dtype);return t.disposeIntermediateTensorInfo(y),b}const Nee={kernelName:s1,backendName:"webgl",kernelFunc:See};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Iee(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:o,output:i}=e,a=o;zd([o,i],"maxPoolGrad");const{filterSize:l,strides:u,pad:d,dimRoundingMode:f}=s,m=ur(a.shape,l,u,1,d,f),g=!0,y=new vu(m,"max",g),w=t.runWebGLProgram(y,[a],a.dtype),b=new kee(m),k=t.runWebGLProgram(b,[r,w],a.dtype);return t.disposeIntermediateTensorInfo(w),k}const $ee={kernelName:n1,backendName:"webgl",kernelFunc:Iee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tee(n,e,t,s){let r=new vu(t,"max",!1);const o=s.runWebGLProgram(r,[n],"float32");r=new vu(t,"max",!0,!0,e);const i=s.runWebGLProgram(r,[n],"float32");return[o,i]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Eee={kernelName:dN,backendName:"webgl",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{x:s}=n,{filterSize:r,strides:o,pad:i,includeBatchInIndex:a}=e,l=t;_(s.shape.length===4,()=>`Error in maxPool: input must be rank 4 but got rank ${s.shape.length}.`);const u=[1,1];_(Vn(o,u),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${u}'`);const d=ur(s.shape,r,o,u,i),[f,m]=Tee(s,a,d,l);return[f,m]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ree(n,e,t,s){const r=pe(e),i=pe(n.shape)/r,a=Ee({inputs:{x:n},attrs:{shape:[i,r]},backend:s}),l=Na(a,"float32","mean",s),u=Ee({inputs:{x:l},attrs:{shape:t},backend:s});return s.disposeIntermediateTensorInfo(a),s.disposeIntermediateTensorInfo(l),u}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Aee={kernelName:Zp,backendName:"webgl",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{x:s}=n,{keepDims:r,axis:o}=e,i=t,a=s.shape.length,l=rt(o,s.shape);let u=l;const d=Bt(u,a),f=d!=null,m=i.shouldExecuteOnCPU([s]),g=[];let y=s;if(f){if(m){const S=i.texData.get(y.dataId).values,$=new Array(a);for(let A=0;A<$.length;A++)$[A]=s.shape[d[A]];const R=rb(S,s.shape,s.dtype,d,$);y=i.makeTensorInfo($,s.dtype);const M=i.texData.get(y.dataId);M.values=R}else y=Ym(s,d,i);g.push(y),u=Zt(u.length,a)}Dn("sum",u,a);const[w,b]=Sn(y.shape,u);let k=w;r&&(k=an(w,l));const v=Ree(y,b,k,i);for(const N of g)i.disposeIntermediateTensorInfo(N);return v}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dee(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,keepDims:i}=s,a=r.shape.length,l=rt(o,r.shape);let u=l;const d=Bt(u,a);let f=r;d!=null&&(f=rs({inputs:{x:r},backend:t,attrs:{perm:d}}),u=Zt(u.length,r.shape.length)),Dn("min",u,a);const[m,g]=Sn(f.shape,u),y=pe(g),w=Ee({inputs:{x:f},backend:t,attrs:{shape:[-1,y]}}),b=Na(w,w.dtype,"min",t);let k;if(i){const v=an(m,l);k=Ee({inputs:{x:b},backend:t,attrs:{shape:v}})}else k=Ee({inputs:{x:b},backend:t,attrs:{shape:m}});return t.disposeIntermediateTensorInfo(w),t.disposeIntermediateTensorInfo(b),d!=null&&t.disposeIntermediateTensorInfo(f),k}const Mee={kernelName:em,backendName:"webgl",kernelFunc:Dee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pee=ob+`
  return min(a, b);
`,Fee=`
  vec4 result = vec4(min(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Sa+`
  return result;
`,Lee=Mn({opSnippet:Pee,packedOpSnippet:Fee,cpuKernelImpl:wK}),jee={kernelName:ed,backendName:"webgl",kernelFunc:Lee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Oee{constructor(e,t,s){this.variableNames=["x"],this.outputShape=t.map((d,f)=>d[0]+e[f]+d[1]);const r=e.length,o=Ct(r),i=t.map(d=>d[0]).join(","),a=t.map((d,f)=>d[0]+e[f]).join(","),l=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r),u=s==="reflect"?0:1;if(r===1){this.userCode=`
        int start = ${i};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start) {
            outC = start * 2 - outC - ${u};
          } else if(outC >= end) {
            outC = (end - 1) * 2 - outC + ${u};
          }
          setOutput(getX(outC - start));
        }
      `;return}this.userCode=`
      ${o} start = ${o}(${i});
      ${o} end = ${o}(${a});

      void main() {
        ${o} outC = getOutputCoords();
        for (int i = 0; i < ${r}; i++) {
          if (outC[i] < start[i]) {
            outC[i] = start[i] * 2 - outC[i] - ${u};
          } else if(outC[i] >= end[i]) {
            outC[i] = (end[i] - 1) * 2 - outC[i] + ${u};
          }
        }
        ${o} coords = outC - start;
        setOutput(getX(${l}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _ee{constructor(e,t,s){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.map((y,w)=>y[0]+e[w]+y[1]);const r=e.length,o=Ct(r),i=t.map(y=>y[0]).join(","),a=t.map((y,w)=>y[0]+e[w]).join(","),l=ns("rc",r),u=ns("source",r),d=`${l[r-1]} < ${this.outputShape[r-1]}`,f=r===1?"source":`vec2(${u.slice(-2).join()})`,m=s==="reflect"?0:1;let g="";if(r===1){const y=`
        ${o} source = rc;
        if (source < start) {
          source = start * 2 - source - ${m};
        } else if (source >= end) {
          source = (end - 1) * 2 - source + ${m};
        }
        source -= start;
      `;g=`
        ${o} rc = outputLoc;
        ${y}
        result[0] = getChannel(getX(${u.join()}), ${f});
        ${l[r-1]} += 1;
        if(${d}) {
          ${y}
          result[1] = getChannel(getX(${u.join()}), ${f});
        }
      `}else{const y=`
        ${o} source = rc;
        ${o} lt = ${o}(lessThan(source, start));
        ${o} gte = ${o}(greaterThanEqual(source, end));
        ${o} orig = 1 - (lt + gte);
        source = orig * source +
                lt * (start * 2 - source - ${m}) +
                gte * ((end - 1) * 2 - source + ${m});
        source -= start;
      `;g=`
        ${o} rc = outputLoc;
        ${y}
        result[0] = getChannel(getX(${u.join()}), ${f});
        ${l[r-1]} += 1;
        if(${d}) {
          ${y}
          result[1] = getChannel(getX(${u.join()}), ${f});
        }
        rc = outputLoc;
        ${l[r-2]} += 1;
        if(${l[r-2]} < ${this.outputShape[r-2]}) {
          ${y}
          result[2] = getChannel(getX(${u.join()}), ${f});
          ${l[r-1]} += 1;
          if(${d}) {
            ${y}
            result[3] = getChannel(getX(${u.join()}), ${f});
          }
        }
      `}this.userCode=`
      const ${o} start = ${o}(${i});
      const ${o} end = ${o}(${a});

      void main() {
        ${o} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${g}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zee=({inputs:n,backend:e,attrs:t})=>{const{x:s}=n,{paddings:r,mode:o}=t,i=de().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new _ee(s.shape,r,o):new Oee(s.shape,r,o);return e.runWebGLProgram(i,[s],s.dtype)},Bee={kernelName:tm,backendName:"webgl",kernelFunc:zee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vee=`if (b == 0.0) return NAN;
  return mod(a, b);`,Wee=`
  vec4 result = mod(a, b);
  bvec4 isNaN = equal(b, vec4(0.0));
  `+Sa+`
  return result;
`,Uee=Mn({opSnippet:Vee,packedOpSnippet:Wee}),Gee={kernelName:td,backendName:"webgl",kernelFunc:Uee};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Hee{constructor(e,t,s){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[e,s],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < ${t-1}; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(${t-1}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qee=`
if (a == b) {
  return 1.0;
};
return a / b;`,Kee=`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,$A=Mn({opSnippet:qee,packedOpSnippet:Kee,checkOutOfBounds:!0}),Xee={kernelName:_u,backendName:"webgl",kernelFunc:$A};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nS="return a - b;",TA=Mn({opSnippet:nS,packedOpSnippet:nS,supportsComplex:!0,cpuKernelImpl:VK}),Qee={kernelName:xd,backendName:"webgl",kernelFunc:TA};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EA(n){const{inputs:e,backend:t,attrs:s}=n,{logits:r}=e,{dim:o}=s,i=rt([o],r.shape),a=IA({inputs:{x:r},backend:t,attrs:{reductionIndices:i,keepDims:!1}}),l=an(a.shape,i),u=Ee({inputs:{x:a},backend:t,attrs:{shape:l}}),d=TA({inputs:{a:r,b:u},backend:t}),f=CA({inputs:{x:d},backend:t}),m=Jm({inputs:{x:f},backend:t,attrs:{axis:i,keepDims:!1}}),g=Ee({inputs:{x:m},backend:t,attrs:{shape:l}}),y=$A({inputs:{a:f,b:g},backend:t});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(u),t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(g),y}const Yee={kernelName:vm,backendName:"webgl",kernelFunc:EA};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jee(n){const{inputs:e,backend:t,attrs:s}=n,{logits:r}=e,{numSamples:o,seed:i,normalized:a}=s,l=a?r:EA({inputs:{logits:r},backend:t,attrs:{dim:r.shape.length-1}}),u=l.shape[0],d=l.shape[1],f=new Hee(u,d,o),m=[[i]],g=t.runWebGLProgram(f,[l],"int32",m);return a||t.disposeIntermediateTensorInfo(l),g}const Zee={kernelName:hN,backendName:"webgl",kernelFunc:Jee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ete=hr+`
  return -x;
`,tte=`
  vec4 result = -x;
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`;function nte(n){const{inputs:e,backend:t}=n,{x:s}=e;if(t.shouldExecuteOnCPU([s])){const o=t.texData.get(s.dataId),[i,a]=CK(o.values,s.shape,s.dtype);return t.makeTensorInfo(a,s.dtype,i)}let r;return de().getBool("WEBGL_PACK_UNARY_OPERATIONS")?r=new ti(s.shape,tte):r=new Hr(s.shape,ete),t.runWebGLProgram(r,[s],s.dtype)}const ste={kernelName:nm,backendName:"webgl",kernelFunc:nte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rte=H1;function ote(n){Bs("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:o}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:l}=s,u=t.readSync(r.dataId),d=t.readSync(o.dataId),{selectedIndices:f}=rte(u,d,i,a,l);return t.makeTensorInfo([f.length],"int32",new Int32Array(f))}const ite={kernelName:r1,backendName:"webgl",kernelFunc:ote};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ate=q1;function lte(n){Bs("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:o}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:l,padToMaxOutputSize:u}=s,d=t.readSync(r.dataId),f=t.readSync(o.dataId),{selectedIndices:m,validOutputs:g}=ate(d,f,i,a,l,u);return[t.makeTensorInfo([m.length],"int32",new Int32Array(m)),t.makeTensorInfo([],"int32",new Int32Array([g]))]}const cte={kernelName:o1,backendName:"webgl",kernelFunc:lte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ute=K1;function dte(n){Bs("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:o}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:l,softNmsSigma:u}=s,d=t.readSync(r.dataId),f=t.readSync(o.dataId),m=i,g=a,y=l,w=u,{selectedIndices:b,selectedScores:k}=ute(d,f,m,g,y,w);return[t.makeTensorInfo([b.length],"int32",new Int32Array(b)),t.makeTensorInfo([k.length],"float32",new Float32Array(k))]}const hte={kernelName:i1,backendName:"webgl",kernelFunc:dte};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class fte{constructor(e,t,s,r){this.variableNames=["indices"],this.outputShape=[e,t],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(${r}), float(${s}),
                      float(index == coords.y)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pte=n=>{const{inputs:e,backend:t,attrs:s}=n,{indices:r}=e,{dtype:o,depth:i,onValue:a,offValue:l}=s,u=pe(r.shape),d=new fte(u,i,a,l),f=Ee({inputs:{x:r},backend:t,attrs:{shape:[u]}}),m=t.runWebGLProgram(d,[f],o);t.disposeIntermediateTensorInfo(f);const g=[...r.shape,i],y=Ee({inputs:{x:m},backend:t,attrs:{shape:g}});return t.disposeIntermediateTensorInfo(m),y},mte={kernelName:om,backendName:"webgl",kernelFunc:pte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hp(n){const{inputs:e,backend:t}=n,{x:s}=e;if(s.dtype==="complex64"){const r=Vd({inputs:{input:s},backend:t}),o=hp({inputs:{x:r},backend:t}),i=Zm({inputs:{input:s},backend:t}),a=hp({inputs:{x:i},backend:t}),l=Ci({inputs:{real:o,imag:a},backend:t});return t.disposeIntermediateTensorInfo(r),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(a),l}else return Wd({attrs:{shape:s.shape,dtype:s.dtype,value:s.dtype==="string"?"":0},backend:t})}const gte={kernelName:km,backendName:"webgl",kernelFunc:hp};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RA(n){const{inputs:e,backend:t}=n,{x:s}=e;if(s.dtype==="string")throw new Error("onesLike is not supported under string dtype");if(s.dtype==="complex64"){const r=Vd({inputs:{input:s},backend:t}),o=RA({inputs:{x:r},backend:t}),i=Zm({inputs:{input:s},backend:t}),a=hp({inputs:{x:i},backend:t}),l=Ci({inputs:{real:o,imag:a},backend:t});return t.disposeIntermediateTensorInfo(r),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(a),l}else return Wd({attrs:{shape:s.shape,dtype:s.dtype,value:1},backend:t})}const xte={kernelName:rm,backendName:"webgl",kernelFunc:RA};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yte(n){const{inputs:e,backend:t,attrs:s}=n,{axis:r}=s;if(e.length===1)return fy({inputs:{input:e[0]},backend:t,attrs:{dim:r}});const o=e[0].shape,i=e[0].dtype;e.forEach(d=>{$y(o,d.shape,"All tensors passed to stack must have matching shapes"),_(i===d.dtype,()=>"All tensors passed to stack must have matching dtypes")});const a=[],l=e.map(d=>{const f=fy({inputs:{input:d},backend:t,attrs:{dim:r}});return a.push(f),f}),u=mA({inputs:l,backend:t,attrs:{axis:r}});return a.forEach(d=>t.disposeIntermediateTensorInfo(d)),u}const vte={kernelName:im,backendName:"webgl",kernelFunc:yte};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class bte{constructor(e,t,s){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map((u,d)=>u[0]+e[d]+u[1]);const r=e.length,o=Ct(r),i=t.map(u=>u[0]).join(","),a=t.map((u,d)=>u[0]+e[d]).join(","),l=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);if(r===1){this.userCode=`
        int start = ${i};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(value);
          } else {
            setOutput(getX(outC - start));
          }
        }
      `;return}this.userCode=`
      ${o} start = ${o}(${i});
      ${o} end = ${o}(${a});

      void main() {
        ${o} outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(value);
        } else {
          ${o} coords = outC - start;
          setOutput(getX(${l}));
        }
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class wte{constructor(e,t,s){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map((w,b)=>w[0]+e[b]+w[1]);const r=e.length,o=Ct(r),i=t.map(w=>w[0]).join(","),a=t.map((w,b)=>w[0]+e[b]).join(","),l=ns("rc",r),u=ns("source",r),d=`${l[r-1]} < ${this.outputShape[r-1]}`,f=r===1?"source":`vec2(${u.slice(-2).join()})`,m=[`${o} rc = outputLoc;`,`${l[r-1]} += 1;
       if(${d}) {
      `,r===1?"":`}
       rc = outputLoc;
       ${l[r-2]} += 1;
       if(${l[r-2]} < ${this.outputShape[r-2]}) {`,r===1?"":`  ${l[r-1]} += 1;
         if(${d}) {`],g=r===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))";let y="";for(let w=0,b=r===1?2:4;w<b;w++)y+=`
        ${m[w]}
        if (${g}) {
          result[${w}] = float(value);
        } else {
          ${o} source = rc - start;
          result[${w}] = getChannel(getX(${u.join()}), ${f});
        }
      `;y+=r===1?"} ":"}}",this.userCode=`
      const ${o} start = ${o}(${i});
      const ${o} end = ${o}(${a});

      void main() {
        ${o} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${y}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AA=n=>{const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{paddings:o,constantValue:i}=s;if(pe(r.shape)===0){const u=o.map((d,f)=>d[0]+r.shape[f]+d[1]);return Wd({backend:t,attrs:{shape:u,value:i,dtype:r.dtype}})}const a=de().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new wte(r.shape,o,i):new bte(r.shape,o,i),l=[[i]];return t.runWebGLProgram(a,[r],r.dtype,l)},kte={kernelName:am,backendName:"webgl",kernelFunc:AA};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cte=`
  if(a < 0.0 && floor(b) < b){
    return NAN;
  }
  if (b == 0.0) {
    return 1.0;
  }
  return (round(mod(b, 2.0)) != 1) ?
      pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,Ste=`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  bvec4 isNaN1 = lessThan(a, vec4(0.0));
  bvec4 isNaN2 = lessThan(floor(b), b);
  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);
  `+Sa+`
  return result;
`,Nte=Mn({opSnippet:Cte,packedOpSnippet:Ste}),Ite={kernelName:sd,backendName:"webgl",kernelFunc:Nte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $te(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,keepDims:i}=s,a=r.shape.length,l=[],u=rt(o,r.shape);let d=u;const f=Bt(d,a);let m=r;f!=null&&(m=rs({inputs:{x:r},backend:t,attrs:{perm:f}}),d=Zt(d.length,a),l.push(m)),Dn("prod",d,a);let g;if(t.shouldExecuteOnCPU([m])){const y=t.texData.get(m.dataId).values,{outVals:w,outShape:b,outDtype:k}=NK(m.shape,m.dtype,y,d);g=t.makeTensorInfo(b,k,w)}else{const[y,w]=Sn(m.shape,d),b=pe(w),k=Ee({inputs:{x:m},backend:t,attrs:{shape:[-1,b]}}),v=y1(r.dtype),N=Na(k,v,"prod",t);g=Ee({inputs:{x:N},backend:t,attrs:{shape:y}}),l.push(k),l.push(N)}if(i){l.push(g);const y=an(g.shape,u);g=Ee({inputs:{x:g},backend:t,attrs:{shape:y}})}return l.forEach(y=>t.disposeIntermediateTensorInfo(y)),g}const Tte={kernelName:cm,backendName:"webgl",kernelFunc:$te};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ete(n){const{inputs:e,backend:t,attrs:s}=n,{paramsNestedSplits:r,paramsDenseValues:o,indices:i}=e,{outputRaggedRank:a}=s,l=r.map(k=>t.readSync(k.dataId)),u=r.map(k=>k.shape),d=t.readSync(o.dataId),f=t.readSync(i.dataId),[m,g,y]=IK(l,u,d,o.shape,o.dtype,f,i.shape,a),w=m.map(k=>t.makeTensorInfo([k.length],"int32",k)),b=t.makeTensorInfo(y,o.dtype,g);return w.concat([b])}const Rte={kernelName:fN,backendName:"webgl",kernelFunc:Ete};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ate(n){const{inputs:e,backend:t}=n,{starts:s,limits:r,deltas:o}=e,i=t.readSync(s.dataId),a=t.readSync(r.dataId),l=t.readSync(o.dataId),[u,d]=$K(i,s.shape,s.dtype,a,r.shape,l,o.shape),f=t.makeTensorInfo([u.length],"int32",u),m=t.makeTensorInfo([d.length],s.dtype,d);return[f,m]}const Dte={kernelName:pN,backendName:"webgl",kernelFunc:Ate};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mte(n){const{inputs:e,backend:t,attrs:s}=n,{shape:r,values:o,defaultValue:i,rowPartitionTensors:a}=e,{rowPartitionTypes:l}=s,u=t.readSync(r.dataId),d=t.readSync(o.dataId),f=t.readSync(i.dataId),m=a.map(b=>t.readSync(b.dataId)),g=a.map(b=>b.shape),[y,w]=TK(u,r.shape,d,o.shape,o.dtype,f,i.shape,m,g,l);return t.makeTensorInfo(y,o.dtype,w)}const Pte={kernelName:mN,backendName:"webgl",kernelFunc:Mte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DA=n=>{const{backend:e,attrs:t}=n,{start:s,stop:r,step:o,dtype:i}=t,a=EK(s,r,o,i);return e.makeTensorInfo([a.length],i,a)},Fte={kernelName:a1,backendName:"webgl",kernelFunc:DA};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lte="return 1.0 / x;",jte=dt({opSnippet:Lte}),Ote={kernelName:rd,backendName:"webgl",kernelFunc:jte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _te=hr+`
  return (x < 0.0) ? 0.0 : x;
`,zte=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Bte=dt({opSnippet:_te,packedOpSnippet:zte}),Vte={kernelName:od,backendName:"webgl",kernelFunc:Bte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wte=hr+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,Ute=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Gte=dt({opSnippet:Wte,packedOpSnippet:Ute}),Hte={kernelName:id,backendName:"webgl",kernelFunc:Gte};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class qte{constructor(e,t,s,r,o){this.variableNames=["A"],this.outputShape=[];const[i,a,l,u]=e;this.outputShape=[i,t,s,u];const d=[r&&t>1?a-1:a,r&&s>1?l-1:l],f=[r&&t>1?t-1:t,r&&s>1?s-1:s];let m;o?m="(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":m="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${d[0]/f[0]},
          ${d[1]/f[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${l}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${m};

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Kte{constructor(e,t,s,r,o){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[i,a,l,u]=e;this.outputShape=[i,t,s,u];const d=[r&&t>1?a-1:a,r&&s>1?l-1:l],f=[r&&t>1?t-1:t,r&&s>1?s-1:s];let m;o?m="(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":m="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${d[0]/f[0]},
          ${d[1]/f[1]},
          ${d[1]/f[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${l}.0,
                                     ${l}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${m};

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${u-1};
        bool hasNextRow = coords.z < ${s-1};

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xte(n){const{inputs:e,backend:t,attrs:s}=n,{images:r}=e,{alignCorners:o,halfPixelCenters:i,size:a}=s,[l,u]=a,d=de().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new Kte(r.shape,l,u,o,i):new qte(r.shape,l,u,o,i);return t.runWebGLProgram(d,[r],"float32")}const Qte={kernelName:hm,backendName:"webgl",kernelFunc:Xte};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Yte{constructor(e,t,s){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;const[,r,o]=t,[,i,a]=e,l=[s&&i>1?r-1:r,s&&a>1?o-1:o],u=[s&&i>1?i-1:i,s&&a>1?a-1:a],d=l[0]/u[0],f=l[1]/u[1],m=1/d,g=1/f,y=Math.ceil(m)*2+2,w=Math.ceil(g)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${d});
        const float widthScale = float(${f});

        const float invHeightScale = float(${m});
        const float invWidthScale = float(${g});

        const int winHeight = int(${y});
        const int winWidth = int(${w});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${i}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), ${r-1}.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), ${o-1}.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jte(n){const{inputs:e,backend:t,attrs:s}=n,{images:r,dy:o}=e,{alignCorners:i}=s,a=new Yte(o.shape,r.shape,i);return t.runWebGLProgram(a,[o],o.dtype)}const Zte={kernelName:u1,backendName:"webgl",kernelFunc:Jte};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ene{constructor(e,t,s,r,o){this.variableNames=["A"],this.outputShape=[];const[i,a,l,u]=e;this.outputShape=[i,t,s,u];const d=[r&&t>1?a-1:a,r&&s>1?l-1:l],f=[r&&t>1?t-1:t,r&&s>1?s-1:s],m=r?"0.5":"0.0";let g;o?g="max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":g="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${d[0]/f[0]},
          ${d[1]/f[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${l}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${g};

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${m})));
        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class tne{constructor(e,t,s,r,o){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[i,a,l,u]=e;this.outputShape=[i,t,s,u];const d=[r&&t>1?a-1:a,r&&s>1?l-1:l],f=[r&&t>1?t-1:t,r&&s>1?s-1:s],m=r?"0.5":"0.0";let g;o?g="max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":g="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${d[0]/f[0]},
          ${d[1]/f[1]},
          ${d[1]/f[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${l}.0,
                                     ${l}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${g};

        // Compute the coordinators of nearest neighbor point.
        ivec3 sourceNearestRC = ivec3(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${m})));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${u-1};
        bool hasNextRow = coords.z < ${s-1};

        vec4 newValue = vec4(
          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),
          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nne(n){const{inputs:e,backend:t,attrs:s}=n,{images:r}=e,{alignCorners:o,halfPixelCenters:i,size:a}=s,[l,u]=a,d=de().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new tne(r.shape,l,u,o,i):new ene(r.shape,l,u,o,i);return t.runWebGLProgram(d,[r],r.dtype)}const sne={kernelName:dm,backendName:"webgl",kernelFunc:nne};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class rne{constructor(e,t,s){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;const[,r,o]=t,[,i,a]=e,l=[s&&i>1?r-1:r,s&&a>1?o-1:o],u=[s&&i>1?i-1:i,s&&a>1?a-1:a],d=l[0]/u[0],f=l[1]/u[1],m=1/d,g=1/f,y=Math.ceil(m)*2+2,w=Math.ceil(g)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${d});
        const float widthScale = float(${f});

        const float invHeightScale = float(${m});
        const float invWidthScale = float(${g});

        const int winHeight = int(${y});
        const int winWidth = int(${w});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${i}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float sourceFracRow =
              float(${l[0]}) *
                (float(dyR) / float(${u[0]}));

            float sourceFracCol =
                float(${l[1]}) *
                  (float(dyC) / float(${u[1]}));

            int sourceNearestRow = int(min(
                float(int(${r}) - 1),
                ${s} ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(${o}) - 1),
                ${s} ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function one(n){const{inputs:e,backend:t,attrs:s}=n,{images:r,dy:o}=e,{alignCorners:i}=s,a=new rne(o.shape,r.shape,i);return t.runWebGLProgram(a,[o],o.dtype)}const ine={kernelName:c1,backendName:"webgl",kernelFunc:one};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ane{constructor(e,t){this.variableNames=["x"];const s=e.length;if(s>4)throw new Error(`WebGL backend: Reverse of rank-${s} tensor is not yet supported`);if(this.outputShape=e,s===1){this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(${e[0]} - coord - 1));
        }
      `;return}const r=a=>t.indexOf(a)!==-1&&e[a]!==1?`${e[a]} - coords[${a}] - 1`:`coords[${a}]`,o=e.map((a,l)=>r(l)).join(","),i=Ct(s);this.userCode=`
      void main() {
        ${i} coords = getOutputCoords();
        setOutput(getX(${o}));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class lne{constructor(e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;const s=e.length;if(s>4)throw new Error(`WebGL backend: Reverse of rank-${s} tensor is not yet supported`);this.outputShape=e;const r=ns("rc",s),o=`${r[s-1]} + 1 < ${this.outputShape[s-1]}`,i=`${r[s-2]} + 1 < ${this.outputShape[s-2]}`,a=Ct(s);s===1?this.userCode=`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(${e[0]} - rc - 1),
            ${e[0]} - rc - 1);
          if(${o}){
              result.g = getChannel(getX(${e[0]} - (rc  + 1) - 1),
                ${e[0]} - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:this.userCode=`
        void main() {
          ${a} rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = ${l(r.slice())};
          if(${o}){
            result.g = ${u(r.slice())};
          }
          if(${i}) {
            result.b = ${d(r.slice())};
            if(${o}) {
              result.a = ${f(r.slice())};
            }
          }
          setOutput(result);
        }
    `;function l(y){return m(y)}function u(y){return y[s-1]="("+y[s-1]+" + 1)",m(y)}function d(y){return y[s-2]="("+y[s-2]+" + 1)",m(y)}function f(y){return y[s-1]="("+y[s-1]+" + 1)",y[s-2]="("+y[s-2]+" + 1)",m(y)}function m(y){const w=e.map((v,N)=>g(N,y)),b=w.join(","),k=w.slice(-2).join(",");return`getChannel(getX(${b}), vec2(${k}))`}function g(y,w){return t.indexOf(y)!==-1&&e[y]!==1?`${e[y]} - ${w[y]} - 1`:`${w[y]}`}}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cne(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{dims:o}=s,i=r.shape.length,a=rt(o,r.shape);if(i===0)return Ms({inputs:{x:r},backend:t});const l=de().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new lne(r.shape,a):new ane(r.shape,a);return t.runWebGLProgram(l,[r],r.dtype)}const une={kernelName:fm,backendName:"webgl",kernelFunc:cne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class dne{constructor(e,t){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];const s=e[1],r=e[2];this.outputShape=e;let o="";typeof t=="number"?o=`float outputValue = ${t.toFixed(2)};`:o=`
        vec3 fill = vec3(${t.join(",")});
        float outputValue = fill[coords[3]];`,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];
          int y = coords[1];
          float coordXFloat = (float(x) - params[0]) * params[3] -
            (float(y) - params[1]) * params[2];
          float coordYFloat = (float(x) - params[0]) * params[2] +
            (float(y) - params[1]) * params[3];
          int coordX = int(round(coordXFloat + params[0]));
          int coordY = int(round(coordYFloat + params[1]));
          ${o}
          if(coordX >= 0 && coordX < ${r} && coordY >= 0 && coordY < ${s}) {
            outputValue = getImage(coords[0], coordY, coordX, coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hne={kernelName:x1,backendName:"webgl",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{image:s}=n,{radians:r,fillValue:o,center:i}=e,a=t,l=new dne(s.shape,o),[u,d]=iv(i,s.shape[1],s.shape[2]),f=[[u,d,Math.sin(r),Math.cos(r)]];return a.runWebGLProgram(l,[s],s.dtype,f)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fne=`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`,pne=dt({opSnippet:fne}),mne={kernelName:ad,backendName:"webgl",kernelFunc:pne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gne="return inversesqrt(x);",xne=dt({opSnippet:gne,cpuKernelImpl:RK}),yne={kernelName:ld,backendName:"webgl",kernelFunc:xne};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class lb{constructor(e,t,s,r,o,i,a=!0,l=!1){this.variableNames=["updates","indices","defaultValue"],this.outputShape=i;const u=Ct(o.length),d=Ct(i.length);let f="";s===1?f="i":s===2&&(f="i, j");const m=`getIndices(${f})`;let g="";r===1?g="i":r===2&&(g="i, coords[1]");const y=`getUpdates(${g})`;let w="";l&&(w="coords[0], coords[1]");const b=`getDefaultValue(${w})`,k=t>1?"strides[j]":"strides";this.userCode=`
        ${u} strides = ${u}(${o});

        void main() {
          ${d} coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < ${e}; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < ${t}; j++) {
              int index = round(${m});
              flattenedIndex += index * ${k};
            }
            if (flattenedIndex == coords[0]) {
              sum += ${y};
              found = true;
            }
          }
          setOutput(mix(${b}, sum, float(found)));
        }
      `}}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class vne{constructor(e,t,s,r,o,i,a=!0,l=!1){this.variableNames=["updates","indices","defaultValue"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=i;const u=Ct(o.length),d=Ct(i.length);let f="";s===1?f="i":s===2&&(f="i, j");const m=`getIndices(${f})`;let g="";r===1?g="i":r===2&&(g="i, coords[1]");const y=`getUpdates(${g})`;let w="";l&&(w="coords[0], coords[1]");const b=`getDefaultValue(${w})`,k=t>1?"strides[j]":"strides",v=t>1?"strides[j + 1]":"strides";this.userCode=`
        ${u} strides = ${u}(${o});

        void main() {
          ${d} coords = getOutputCoords();
          vec4 sum = vec4(0.);
          vec4 found = vec4(0.);
          for (int i = 0; i < ${e}; i+=2) {
            ivec2 flattenedIndex = ivec2(0);
            for (int j = 0; j < ${t}; j+=2) {
              ivec4 index = round(${m});
              flattenedIndex += index.xz * ${k};
              if (j + 1 < ${t}) {
                flattenedIndex += index.yw * ${v};
              }
            }
            if (flattenedIndex[0] == coords[0] || flattenedIndex[1] == coords[0] ||
                flattenedIndex[0] == coords[0] + 1 || flattenedIndex[1] == coords[0] + 1) {
              vec4 updVals = ${y};
              if (flattenedIndex[0] == coords[0]) {
                sum.xy += updVals.xy;
                found.xy = vec2(1.);
              } else if (flattenedIndex[0] == coords[0] + 1) {
                sum.zw += updVals.xy;
                found.zw = vec2(1.);
              }
              if (flattenedIndex[1] == coords[0]) {
                sum.xy += updVals.zw;
                found.xy = vec2(1.);
              } else if (flattenedIndex[1] == coords[0] + 1) {
                sum.zw += updVals.zw;
                found.zw = vec2(1.);
              }
            }
          }
          setOutput(mix(${b}, sum, found));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bne(n){const{inputs:e,backend:t,attrs:s}=n,{indices:r,updates:o}=e,{shape:i}=s,{sliceRank:a,numUpdates:l,sliceSize:u,strides:d,outputSize:f}=va(o,r,i),m=[f/u,u];if(f===0)return t.makeTensorInfo(i,r.dtype);const g=Ee({inputs:{x:r},backend:t,attrs:{shape:[l,a]}}),y=Ee({inputs:{x:o},backend:t,attrs:{shape:[l,u]}}),w=t.makeTensorInfo([],"float32",new Float32Array([0]));let b;de().getBool("WEBGL_PACK")?b=new vne(l,a,g.shape.length,y.shape.length,d,m):b=new lb(l,a,g.shape.length,y.shape.length,d,m);const k=t.runWebGLProgram(b,[y,g,w],y.dtype),v=Ee({inputs:{x:k},backend:t,attrs:{shape:i}});return t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(k),t.disposeIntermediateTensorInfo(w),v}const wne={kernelName:gN,backendName:"webgl",kernelFunc:bne};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class kne{constructor(e,t,s,r){this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[e,s];const o="while (left < right) {",i=`for (int i = 0; i < ${Math.ceil(Math.log2(t+1))}; ++i) { if (left >= right) break;`,a=de().getNumber("WEBGL_VERSION")===2?o:i,l=r==="left"?"<":"<=";this.userCode=`
       int findBound(int batch, float value) {
         int left = 0;
         int right = numInputs;
         int mid;
         ${a}
           mid = (left + right) / 2;
           if (getSortedSequence(batch, mid) ${l} value) {
             left = mid + 1;
           } else {
             right = mid;
           }
         }
         return right;
       }

       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int valueIndex = coords[1];

         float value = getValues(batch, valueIndex);

         setOutput(float(findBound(batch, value)));
       }
     `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cne(n){const{inputs:e,backend:t,attrs:s}=n,{sortedSequence:r,values:o}=e,{side:i}=s,a=new kne(r.shape[0],r.shape[1],o.shape[1],i),l=[[r.shape[1]]];return t.runWebGLProgram(a,[r,o],"int32",l)}const Sne={kernelName:yN,backendName:"webgl",kernelFunc:Cne};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Nne{constructor(e,t,s){this.variableNames=["c","a","b"],this.outputShape=t;let r,o;if(s>4)throw Error(`Where for rank ${s} is not yet supported`);if(s===1)o="resRC",r="resRC";else{const a=["resRC.x","resRC.y","resRC.z","resRC.w"],l=[],u=[];for(let d=0;d<t.length;d++)u.push(`${a[d]}`),d<e&&l.push(`${a[d]}`);r=l.join(),o=u.join()}const i=Ct(s);this.userCode=`
      void main() {
        ${i} resRC = getOutputCoords();
        float cVal = getC(${r});
        if (cVal >= 1.0) {
          setOutput(getA(${o}));
        } else {
          setOutput(getB(${o}));
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ine(n){const{inputs:e,backend:t}=n,{condition:s,t:r,e:o}=e,i=new Nne(s.shape.length,r.shape,r.shape.length);return t.runWebGLProgram(i,[s,r,o],As(r.dtype,o.dtype))}const $ne={kernelName:pm,backendName:"webgl",kernelFunc:Ine};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tne=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = ${Pm};
  float scale = ${Fm};
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,Ene=dt({opSnippet:Tne}),Rne={kernelName:cd,backendName:"webgl",kernelFunc:Ene};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ane=Kl+`
  return 1.0 / (1.0 + exp(-1.0 * x));
`,Dne=`
  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Mne=dt({opSnippet:Ane,packedOpSnippet:Dne,cpuKernelImpl:DK}),Pne={kernelName:fd,backendName:"webgl",kernelFunc:Mne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fne=`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`,Lne=dt({opSnippet:Fne}),jne={kernelName:hd,backendName:"webgl",kernelFunc:Lne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const One=Kl+`
  return sin(x);
`,_ne=`
  vec4 result = sin(x);
  bvec4 isNaN = isnan(x);
  ${Sa}
  return result;
`,zne=dt({opSnippet:One,packedOpSnippet:_ne}),Bne={kernelName:ud,backendName:"webgl",kernelFunc:zne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vne=`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`,Wne=dt({opSnippet:Vne}),Une={kernelName:dd,backendName:"webgl",kernelFunc:Wne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gne=`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`,Hne=dt({opSnippet:Gne}),qne={kernelName:pd,backendName:"webgl",kernelFunc:Hne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kne=n=>{const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockShape:o,paddings:i}=s;_(r.shape.length<=4,()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet");const a=o.reduce((k,v)=>k*v),l=[[0,0]];l.push(...i);for(let k=1+o.length;k<r.shape.length;++k)l.push([0,0]);const u=[],d=AA({inputs:{x:r},backend:t,attrs:{paddings:l,constantValue:0}}),f=$d(d.shape,o,a,!1),m=Td(f.length,o.length,!1),g=Ed(d.shape,o,a,!1),y=Ee({inputs:{x:d},backend:t,attrs:{shape:f}}),w=rs({inputs:{x:y},backend:t,attrs:{perm:m}}),b=Ee({inputs:{x:w},backend:t,attrs:{shape:g}});return u.push(d),u.push(y),u.push(w),u.forEach(k=>t.disposeIntermediateTensorInfo(k)),b},Xne={kernelName:xm,backendName:"webgl",kernelFunc:Kne};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qne(n){const{inputs:e,backend:t}=n,{indices:s,values:r,denseShape:o,defaultValue:i}=e;if(o.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
         ${o.shape}`);if(s.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
         ${s.shape}`);if(r.shape.length!==1)throw new Error(`Values must be a vector, saw:
         ${r.shape}`);if(i.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${i.shape}`);const a=t.readSync(s.dataId),l=t.readSync(r.dataId),u=t.readSync(o.dataId),d=t.readSync(i.dataId)[0],[f,m,g,y,w]=PK(a,s.shape,s.dtype,l,r.dtype,u,d);return[t.makeTensorInfo(m,s.dtype,f),t.makeTensorInfo([m[0]],r.dtype,g),t.makeTensorInfo([y.length],"bool",new Uint8Array(y.map(b=>Number(b)))),t.makeTensorInfo([w.length],s.dtype,new Int32Array(w))]}const Yne={kernelName:vN,backendName:"webgl",kernelFunc:Qne};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jne(n){const{inputs:e,backend:t}=n,{inputIndices:s,inputShape:r,newShape:o}=e;if(s.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape ${s.shape}`);if(r.shape.length!==1)throw new Error(`Input shape should be a vector but received shape ${r.shape}`);if(o.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${o.shape}`);const i=Array.from(t.readSync(r.dataId)),a=t.readSync(s.dataId),l=Array.from(t.readSync(o.dataId)),[u,d,f]=FK(a,s.shape,s.dtype,i,l);return[t.makeTensorInfo(d,s.dtype,u),t.makeTensorInfo([f.length],o.dtype,new Int32Array(f))]}const Zne={kernelName:bN,backendName:"webgl",kernelFunc:Jne};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ese(n){const{inputs:e,backend:t}=n,{data:s,indices:r,segmentIds:o}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
              ${r.shape}`);if(o.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
              ${o.shape}`);const i=t.readSync(s.dataId),a=t.readSync(r.dataId),l=t.readSync(o.dataId),[u,d]=nA(i,s.shape,s.dtype,a,l,!0);return t.makeTensorInfo(d,s.dtype,u)}const tse={kernelName:wN,backendName:"webgl",kernelFunc:ese};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nse(n){const{inputs:e,backend:t}=n,{data:s,indices:r,segmentIds:o}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
             ${r.shape}`);if(o.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
             ${o.shape}`);const i=t.readSync(s.dataId),a=t.readSync(r.dataId),l=t.readSync(o.dataId),[u,d]=nA(i,s.shape,s.dtype,a,l);return t.makeTensorInfo(d,s.dtype,u)}const sse={kernelName:kN,backendName:"webgl",kernelFunc:nse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rse(n){const{inputs:e,backend:t,attrs:s}=n,{sparseIndices:r,sparseValues:o,defaultValue:i}=e,{outputShape:a}=s,{sliceRank:l,numUpdates:u,sliceSize:d,strides:f,outputSize:m}=va(o,r,a),g=!1;if(o.dtype==="string"){const k=t.bufferSync(r),v=t.bufferSync(o),N=ai(t.readSync(i.dataId)[0]),S=AK(k,v,a,m,d,u,l,f,N,g);return t.makeTensorInfo(a,S.dtype,S.values)}const y=new lb(u,l,r.shape.length,o.shape.length,f,[m,1],g),w=t.runWebGLProgram(y,[o,r,i],o.dtype),b=Ee({inputs:{x:w},backend:t,attrs:{shape:a}});return t.disposeIntermediateTensorInfo(w),b}const ose={kernelName:CN,backendName:"webgl",kernelFunc:rse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ise(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{numOrSizeSplits:o,axis:i}=s,a=rt(i,r.shape)[0],l=wv(r,o,a),u=r.shape.length,d=new Array(u).fill(0),f=r.shape.slice();return l.map(m=>{const g=[...f];g[a]=m;const y=Xl({inputs:{x:r},backend:t,attrs:{begin:d,size:g}});return d[a]+=m,y})}const ase={kernelName:ym,backendName:"webgl",kernelFunc:ise};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sS="return sqrt(x);",lse=dt({opSnippet:sS,packedOpSnippet:sS,cpuKernelImpl:LK}),cse={kernelName:md,backendName:"webgl",kernelFunc:lse};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const use="return x * x;",dse=dt({opSnippet:use}),hse={kernelName:d1,backendName:"webgl",kernelFunc:dse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rS="return (a - b) * (a - b);",fse=Mn({opSnippet:rS,packedOpSnippet:rS}),pse={kernelName:gd,backendName:"webgl",kernelFunc:fse};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mse(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e;if(r.dtype!=="string")throw new Error("Input must be of datatype string");const o=t.readSync(r.dataId),i=No(o),a=jK(i,"string",s);return t.makeTensorInfo(r.shape,"string",a)}const gse={kernelName:h1,backendName:"webgl",kernelFunc:mse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xse({inputs:n,attrs:e,backend:t}){const{x:s}=n,r=hr+`
    return x > 0.0 ? 1.0 : float(${e.alpha});
  `,o=new Hr(s.shape,r);return t.runWebGLProgram(o,[s],s.dtype)}const yse={kernelName:wd,backendName:"webgl",kernelFunc:xse};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class vse{constructor(e,t,s){this.variableNames=["x"],this.outputShape=s;const r=s.length,o=Ct(s.length),i=Ct(s.length);let a="";if(r===1)a="coords * strides + begin";else{let l=0;a=s.map((u,d)=>(l++,s.length===1?`coords * strides[${d}] + begin[${d}]`:`coords[${l-1}] * strides[${d}] + begin[${d}]`)).join(",")}this.userCode=`
      ${o} begin = ${o}(${e});
      ${o} strides = ${o}(${t});

      void main() {
        ${i} coords = getOutputCoords();
        setOutput(getX(${a}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bse(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{begin:o,end:i,strides:a,beginMask:l,endMask:u,ellipsisMask:d,newAxisMask:f,shrinkAxisMask:m}=s,{finalShapeSparse:g,finalShape:y,isIdentity:w,sliceDim0:b,isSimpleSlice:k,begin:v,end:N,strides:S}=sv(r.shape,o,i,a,l,u,d,f,m);let $;if(w)$=Ee({inputs:{x:r},backend:t,attrs:{shape:y}});else if(b||k){_(r.shape.length>=1,()=>`Input must have rank at least 1, got: ${r.shape.length}`);const M=ev(v,N,S),A=Xl({inputs:{x:r},backend:t,attrs:{begin:v,size:M}});$=Ee({inputs:{x:A},backend:t,attrs:{shape:y}}),t.disposeIntermediateTensorInfo(A)}else if(t.shouldExecuteOnCPU([r])){const A=t.readSync(r.dataId),P=st(r.shape,r.dtype,A),D=OK(g,P,S,v);$=t.makeTensorInfo(y,r.dtype,D.values)}else{const A=new vse(v,S,g);$=t.runWebGLProgram(A,[r],r.dtype)}const R=Ee({inputs:{x:$},backend:t,attrs:{shape:y}});return t.disposeIntermediateTensorInfo($),R}const wse={kernelName:f1,backendName:"webgl",kernelFunc:bse};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kse(n){const{inputs:e,backend:t,attrs:s}=n,{separator:r,nGramWidths:o,leftPad:i,rightPad:a,padWidth:l,preserveShortSequences:u}=s,{data:d,dataSplits:f}=e,m=t.readSync(d.dataId),g=t.readSync(f.dataId),[y,w]=_K(m,g,r,o,i,a,l,u);return[t.makeTensorInfo([y.length],"string",y),t.makeTensorInfo(f.shape,"int32",w)]}const Cse={kernelName:SN,backendName:"webgl",kernelFunc:kse};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sse(n){const{inputs:e,backend:t,attrs:s}=n,{skipEmpty:r}=s,{input:o,delimiter:i}=e;if(o.dtype!=="string")throw new Error("Input must be of datatype string");if(o.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${o.shape}`);if(i.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${i.shape}`);const a=t.readSync(o.dataId),l=t.readSync(i.dataId)[0],[u,d,f]=zK(a,l,r),m=d.length;return[t.makeTensorInfo([m,2],"int32",u),t.makeTensorInfo([m],"string",d),t.makeTensorInfo([2],"int32",new Int32Array(f))]}const Nse={kernelName:NN,backendName:"webgl",kernelFunc:Sse};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ise(n){const{inputs:e,backend:t,attrs:s}=n,{numBuckets:r}=s,{input:o}=e;if(o.dtype!=="string")throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");const i=t.readSync(o.dataId),a=BK(i,r);return t.makeTensorInfo(o.shape,"int32",a)}const $se={kernelName:IN,backendName:"webgl",kernelFunc:Ise};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tse="return tan(x);",Ese=dt({opSnippet:Tse}),Rse={kernelName:yd,backendName:"webgl",kernelFunc:Ese};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ase=`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`,Dse=dt({opSnippet:Ase}),Mse={kernelName:vd,backendName:"webgl",kernelFunc:Dse};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pse(n){const{inputs:e,backend:t,attrs:s}=n,{tensor:r,indices:o,updates:i}=e,{sliceRank:a,numUpdates:l,sliceSize:u,strides:d,outputSize:f}=va(i,o,r.shape),m=[f/u,u];if(f===0)return t.makeTensorInfo(r.shape,o.dtype);const g=Ee({inputs:{x:o},backend:t,attrs:{shape:[l,a]}}),y=Ee({inputs:{x:i},backend:t,attrs:{shape:[l,u]}}),w=Ee({inputs:{x:r},backend:t,attrs:{shape:m}}),b=new lb(l,a,g.shape.length,y.shape.length,d,m,!1,!0),k=t.runWebGLProgram(b,[y,g,w],w.dtype),v=Ee({inputs:{x:k},backend:t,attrs:{shape:r.shape}});return t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(w),t.disposeIntermediateTensorInfo(k),v}const Fse={kernelName:xN,backendName:"webgl",kernelFunc:Pse};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Lse{constructor(e,t){this.variableNames=["A"];const s=new Array(e.length);for(let i=0;i<s.length;i++)s[i]=e[i]*t[i];this.outputShape=s,this.rank=s.length;const r=Ct(this.rank),o=jse(e);this.userCode=`
      void main() {
        ${r} resRC = getOutputCoords();
        setOutput(getA(${o}));
      }
    `}}function jse(n){const e=n.length;if(e>5)throw Error(`Tile for rank ${e} is not yet supported`);if(e===1)return`imod(resRC, ${n[0]})`;const t=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],s=[];for(let r=0;r<n.length;r++)s.push(`imod(${t[r]}, ${n[r]})`);return s.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MA(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{reps:o}=s;if(r.dtype==="string"||r.shape.length>5){const l=t.readSync(r.dataId),u=r.dtype==="string"?l.map(m=>ai(m)):l,d=st(r.shape,r.dtype,u),f=WK(d,o);return t.makeTensorInfo(f.shape,f.dtype,f.values)}const i=new Lse(r.shape,o);return t.runWebGLProgram(i,[r],r.dtype)}const Ose={kernelName:bd,backendName:"webgl",kernelFunc:MA};class _se{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=e,this.userCode=`
       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // We compare elements pair-wise within a group of size 2 * inc.
         // The comparing rule for each group alternates between ascending
         // and descending. Within each group, we compare each pair at
         // positions i and i+inc. To decide whether an element at position i
         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than
         // inc, it is in the first half of the group, we denote it as x0,
         // otherwise we denote it as x1.
         // For example, as shown in the Bitonic top K paper referenced above,
         // Figure5(a) shows that element[1] is in the
         // second half of the group when group size is 2, but it is in the
         // first half of the group when group size is 4.

         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;
         int i = isFirstInPair ? elemIdx : elemIdx - inc;

         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));
         float x0 = i0 < n ? getX(batch, i0) : negativeInf;
         float x1 = i1 < n ? getX(batch, i1) : negativeInf;

         // Denotes which direction indices are in (ascending or descending).
         bool reverse = imod(elemIdx, 2 * dir) >= dir;
         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);
         if (reverse == isGreater) { // Elements in opposite order of direction
           int iTemp = i0;
           i0 = i1;
           i1 = iTemp;
         }
         if (isFirstInPair) {
            setOutput(float(i0));
         } else {
            setOutput(float(i1));
         }
       }
     `}}class zse{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=e,this.userCode=`
    void main() {
         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // The output size is half of the previous size.
         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),
         // we only need to output the indices at positions |, the indices at
         // positions _ can be thrown away, see Figure5(b) After Phase 2
         // (Merge phase) in the Bitonic Top K paper referenced above.
         // For example, the paper shows we only need to output the orange bars.
         // The output sequence should look like this | | | | | | | |.
         // Because the sequence is halved, to map the output index back
         // to the previous sequence to find the corresponding value,
         // we need to double the index. When we double the index,
         // we basically interpolate a position, so 2i looks like
         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position
         // of each 2k positions by - elemIdx % k. E.g. for output at
         // index 4,5,6,7, we want to get the corresponding element at
         // original index 8,9,10,11, for output at index 8,9,10,11,
         // we want to get the corresponding element at original index
         // 16,17,18,19, so on and so forth.

         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));
         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));

         float x0 = getX(batch, i0);
         float x1 = i1 < n ? getX(batch, i1) : x0;

         setOutput(x0 >= x1 ? float(i0) : float(i1));
       }
     `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zi(n,e){e!==null&&n.disposeIntermediateTensorInfo(e)}function oS(n){let e=1;for(;e<n;)e*=2;return e}function Bse(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{k:o,sorted:i}=s,a=de().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),l=de().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),u=r.shape,d=u[u.length-1];if(t.shouldExecuteOnCPU([r])||d<a||o>l){const D=t.readSync(r.dataId),[E,j]=UK(D,u,r.dtype,o,i);return[t.makeTensorInfo(E.shape,E.dtype,E.values),t.makeTensorInfo(j.shape,j.dtype,j.values)]}if(o===0)return u[u.length-1]=0,[t.makeTensorInfo(u,r.dtype,[]),t.makeTensorInfo(u,"int32",[])];if(d===1)return[r,Wd({attrs:{shape:u,dtype:"int32",value:0},backend:t})];const f=t.texData.get(r.dataId),m=f!==null&&f.isPacked,g=m?t.unpackTensor(r):r,w=pe(u)/d,b=Ee({inputs:{x:g},attrs:{shape:[w,d]},backend:t});m&&zi(t,g);const k=oS(o),v=oS(d);let N=null;const S=()=>N===null?[b,b]:[b,N],$=(D,E,j)=>{const V=S(),W=new _se(j),X=[[d],[N===null?1:0],[Number.NEGATIVE_INFINITY],[D],[E]],ee=N;N=t.runWebGLProgram(W,V,"int32",X),zi(t,ee)};for(let D=1;D<k;D*=2){const E=D*2;for(let j=D;j>=1;j/=2)$(E,j,[w,v])}for(let D=v;D>k;D/=2){const E=S(),j=new zse([w,D/2]),W=[[d],[N===null?1:0],[k]],U=N;N=t.runWebGLProgram(j,E,"int32",W),zi(t,U);const X=k/2,ee=X*2;for(let G=X;G>=1;G/=2)$(ee,G,N.shape)}let R=N;N=Xl({inputs:{x:N},backend:t,attrs:{begin:0,size:[w,o]}}),zi(t,R);let M=NA({inputs:{x:b,indices:N},backend:t,attrs:{axis:1,batchDims:1}});zi(t,b);const A=u.slice(0,-1);A.push(o),R=N,N=Ee({inputs:{x:N},attrs:{shape:A},backend:t}),zi(t,R);const P=M;return M=Ee({inputs:{x:M},attrs:{shape:A},backend:t}),zi(t,P),[M,N]}const Vse={kernelName:p1,backendName:"webgl",kernelFunc:Bse};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Wse{constructor(e,t,s,r,o,i){this.variableNames=["Image","Transforms"],this.outputShape=i;const a=s==="nearest"?1:2;let l;switch(r){case"constant":l=1;break;case"reflect":l=2;break;case"wrap":l=3;break;case"nearest":l=4;break;default:l=1;break}this.userCode=`
            float mapCoord(float outCoord, float len) {
              float inCoord = outCoord;
              if(${l} == 2) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    if (inCoord < sz2) {
                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +
                      inCoord;
                    }
                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    inCoord -= sz2 * float(int(float(inCoord / sz2)));
                    if (inCoord >= len) {
                      inCoord = sz2 - inCoord - 1.0;
                    }
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${l} == 3) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord -= len * float(int(float(inCoord / sz)));
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${l} == 4) {
                return clamp(outCoord, 0.0, len - 1.0);
              } else {
                return outCoord;
              }
            }

            float readWithFillValue(int batch, int coordY, int coordX,
              int channel) {
              float outputValue;
              if (0 <= coordY && coordY < ${e} && 0 <= coordX && coordX < ${t}) {
                  outputValue = getImage(batch, coordY, coordX, channel);
              } else {
                outputValue = float(${o});
              }
              return outputValue;
            }

            void main() {
              ivec4 coords = getOutputCoords();
              float outputValue;
              int batch = coords[0];
              int x = coords[2];
              int y = coords[1];
              int channel = coords[3];
              float xf = float(x);
              float yf = float(y);
              float a1 = getTransforms(batch, 0);
              float a2 = getTransforms(batch, 1);
              float a3 = getTransforms(batch, 2);
              float b1 = getTransforms(batch, 3);
              float b2 = getTransforms(batch, 4);
              float b3 = getTransforms(batch, 5);
              float c1 = getTransforms(batch, 6);
              float c2 = getTransforms(batch, 7);
              float projection = c1 * xf + c2 * yf + 1.0;
              if (projection == 0.0) {
                outputValue = float(${o});
              } else {
                float inX = (a1 * xf + a2 * yf + a3) / projection;
                float inY = (b1 * xf + b2 * yf + b3) / projection;
                float mapX = mapCoord(inX, float(${t}));
                float mapY = mapCoord(inY, float(${e}));

                if (${a} == 1) {
                  int coordY = int(round(mapY));
                  int coordX = int(round(mapX));
                  outputValue = readWithFillValue(batch, coordY, coordX,
                    channel);
                } else {
                  float yFloor = floor(mapY);
                  float xFloor = floor(mapX);
                  float yCeil = yFloor + 1.0;
                  float xCeil = xFloor + 1.0;
                  float valueYFloor = (xCeil - mapX) *
                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);
                  float valueYCeil = (xCeil - mapX) *
                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);
                  outputValue = (yCeil - mapY) * valueYFloor +
                  (mapY - yFloor) * valueYCeil;
                }
              }
              setOutput(outputValue);
            }
        `}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Use(n){const{inputs:e,backend:t,attrs:s}=n,{image:r,transforms:o}=e,{interpolation:i,fillMode:a,fillValue:l,outputShape:u}=s,[d,f,m,g]=r.shape,[y,w]=u??[f,m],b=[d,y,w,g],k=new Wse(f,m,i,a,l,b);return t.runWebGLProgram(k,[r,o],"float32")}const Gse={kernelName:m1,backendName:"webgl",kernelFunc:Use};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hse(n){const{inputs:e,attrs:t,backend:s}=n,{axis:r}=t,{x:o}=e;zd(o,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");const i=s.readSync(o.dataId),{outputValues:a,outputShape:l,indices:u}=GK(i,r,o.shape,o.dtype);return[s.makeTensorInfo(l,o.dtype,a),s.makeTensorInfo([u.length],"int32",u)]}const qse={kernelName:g1,backendName:"webgl",kernelFunc:Hse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kse(n){const{inputs:e,backend:t,attrs:s}=n,{value:r}=e;let{axis:o}=s;o<0&&(o+=r.shape.length);const i=r,a=i.shape.length,l=r.shape[o],u=new Array(a-1);let d=0;for(let w=0;w<a;w++)w!==o&&(u[d++]=i.shape[w]);const f=[],m=new Array(a).fill(0),g=i.shape.slice();g[o]=1;const y=new Array(l);for(let w=0;w<y.length;w++){m[o]=w;const b=Xl({inputs:{x:i},backend:t,attrs:{begin:m,size:g}}),k=Ee({inputs:{x:b},backend:t,attrs:{shape:u}});y[w]=k,f.push(b)}return f.forEach(w=>t.disposeIntermediateTensorInfo(w)),y}const Xse={kernelName:bm,backendName:"webgl",kernelFunc:Kse};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Qse{constructor(e,t){this.variableNames=["x","segmentIds"];const s=e.windowSize,r=e.batchSize,o=e.inSize,i=e.numSegments,a=i*Math.ceil(o/s);this.outputShape=[r,a];const l="0.0",u="sumValue",d=Math.floor(s/4)*4,f=s%4,m=`
        sumValue += dot(values, segFilter);
    `;let g="";o%s>0&&(g=`
        if (inIdx < 0 || inIdx >= ${o}) {
          return initializationValue;
        }
      `);let y="";o%s>0&&(y=`
        if (inIdx < 0 || inIdx >= ${o}) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = ${l};

      float getValue(int batch, int inIdx) {
        ${g}
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        ${y}
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          ${i})) * float(${s}));
        int currentSeg = int(mod(float(outIdx), float(${i})));

        float sumValue = 0.0;

        for (int i = 0; i < ${d}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          ${m}
        }

        int inIdx = inOffset + ${d};
        if (${f===1}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          ${m}
        } else if (${f===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          ${m}
        } else if (${f===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          ${m}
        }
        setOutput(${u});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yse(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,segmentIds:o}=e,{numSegments:i}=s,a=r.shape.length,l=[];let u=0;const d=Bt([u],a);let f=r;d!=null&&(f=rs({inputs:{x:r},backend:t,attrs:{perm:d}}),l.push(f),u=Zt(1,a)[0]);const m=m$(f.shape,u,i),g=pe([f.shape[u]]),y=Ee({inputs:{x:f},backend:t,attrs:{shape:[-1,g]}});l.push(y);const w=y1(r.dtype),b=(S,$,R,M,A)=>{const P=S.shape[0],D=S.shape[1],E=p$(D,A),j={windowSize:E,inSize:D,batchSize:P,numSegments:A},V=new Qse(j,$),W=t.compileAndRun(V,[S,R],M);if(l.push(W),W.shape[1]===A)return W;const U=DA({backend:t,attrs:{start:0,stop:A,step:1,dtype:"float32"}}),X=MA({inputs:{x:U},backend:t,attrs:{reps:[D/E]}});return l.push(U),l.push(X),b(W,$,X,M,A)},k=b(y,"unsortedSegmentSum",o,w,i),v=Ee({inputs:{x:k},backend:t,attrs:{shape:m}});let N=v;if(d!=null){l.push(v);const S=xi(d);N=rs({inputs:{x:N},backend:t,attrs:{perm:S}})}return l.forEach(S=>t.disposeIntermediateTensorInfo(S)),N}const Jse={kernelName:wm,backendName:"webgl",kernelFunc:Yse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zse=[LX,OX,BX,UX,HX,XX,YX,ZX,sQ,oQ,lQ,dQ,pQ,yQ,wQ,CQ,NQ,EQ,AQ,MQ,jQ,UQ,HQ,QQ,JQ,rY,iY,uY,vX,fY,yY,kY,TY,AY,MY,FY,jY,BY,UY,qY,XY,YY,ZY,nJ,rJ,lJ,uJ,fJ,gJ,yJ,kJ,IJ,RJ,MJ,LJ,jJ,_J,BJ,WJ,GJ,qJ,YJ,eZ,sZ,oZ,lZ,dZ,mZ,vZ,yX,wZ,gY,SZ,$Z,RZ,wX,PZ,OZ,zZ,UZ,qZ,YZ,eee,ree,lee,dee,fee,xee,vee,wee,Nee,$ee,Eee,Aee,Mee,jee,Bee,Gee,Zee,SX,ste,ite,cte,hte,eY,mte,xte,vte,kte,Ite,CX,Tte,Rte,Dte,Pte,Fte,tY,Xee,Ote,Vte,Hte,IX,Qte,Zte,sne,ine,une,hne,mne,yne,wne,Sne,$ne,Rne,Pne,jne,Bne,Une,VQ,Yee,qne,Xne,Yne,Zne,tse,sse,ose,ase,cse,hse,pse,gse,yse,wse,Cse,Nse,$se,Qee,MX,Rse,Mse,Fse,Ose,Vse,Gse,PX,qse,Xse,Jse,gte];for(const n of Zse)TN(n);const x0={epochs:50,batchSize:32,learningRate:.001,validationSplit:.2},yf="audiio-ml-model";class ere{constructor(){Oc(this,"model",null);Oc(this,"isDisposed",!1)}createModel(){this.model&&this.model.dispose();const e=g6();return e.add(Uc({inputShape:[mM],units:64,activation:"relu",kernelInitializer:"heNormal",name:"input_dense"})),e.add(Uc({units:128,activation:"relu",kernelInitializer:"heNormal",name:"hidden_1"})),e.add(P6({rate:.3,name:"dropout"})),e.add(Uc({units:64,activation:"relu",kernelInitializer:"heNormal",name:"hidden_2"})),e.add(Uc({units:32,activation:"relu",kernelInitializer:"heNormal",name:"hidden_3"})),e.add(Uc({units:1,activation:"sigmoid",name:"output"})),e.compile({optimizer:Qo.adam(x0.learningRate),loss:"binaryCrossentropy",metrics:["accuracy"]}),this.model=e,e}getModel(){return this.model}isReady(){return this.model!==null&&!this.isDisposed}async train(e,t,s,r,o={},i,a){var b,k,v;const l={...x0,...o};this.model||this.createModel();const{inputs:u,labels:d}=IM(e,t,s,r,a),f=d.filter(N=>N>.5).length,m=d.filter(N=>N<=.2).length,g=d.length-f-m;if(console.log(`[MLTrainer] Training data: ${f} positive, ${m} negative (disliked), ${g} neutral samples`),u.length<10)throw new Error("Insufficient training data (need at least 10 samples)");const y=dl(u),w=ps(d);try{const N=await this.model.fit(y,w,{epochs:l.epochs,batchSize:l.batchSize,validationSplit:l.validationSplit,shuffle:!0,callbacks:{onEpochEnd:(R,M)=>{i&&M&&i({epoch:R+1,totalEpochs:l.epochs,loss:M.loss,accuracy:M.acc})}}}),S=N.history.loss.length-1;return{loss:N.history.loss[S],accuracy:((b=N.history.acc)==null?void 0:b[S])??0,valLoss:(k=N.history.val_loss)==null?void 0:k[S],valAccuracy:(v=N.history.val_acc)==null?void 0:v[S],samplesUsed:u.length}}finally{y.dispose(),w.dispose()}}predict(e,t,s,r,o){if(!this.model||this.isDisposed)return .5;const i=Lf(e,t,s,r,o),a=dl([i.combined]);try{const l=this.model.predict(a),u=l.dataSync()[0];return l.dispose(),u}finally{a.dispose()}}predictBatch(e,t,s,r,o){if(!this.model||this.isDisposed||e.length===0)return e.map(()=>.5);JS(o);const i=e.map(l=>Lf(l,t,s,r,o).combined),a=dl(i);try{const l=this.model.predict(a),u=Array.from(l.dataSync());return l.dispose(),u}finally{a.dispose()}}async saveModel(){if(!this.model)return console.warn("[MLTrainer] No model to save"),!1;try{return await this.model.save(`indexeddb://${yf}`),console.log("[MLTrainer] Model saved to IndexedDB"),!0}catch(e){return console.error("[MLTrainer] Failed to save model:",e),!1}}async loadModel(){try{return this.model=await f6(`indexeddb://${yf}`),this.model.compile({optimizer:Qo.adam(x0.learningRate),loss:"binaryCrossentropy",metrics:["accuracy"]}),console.log("[MLTrainer] Model loaded from IndexedDB"),!0}catch{return console.log("[MLTrainer] No saved model found, will create new one"),!1}}async hasSavedModel(){try{const e=await KP();return`indexeddb://${yf}`in e}catch{return!1}}async deleteModel(){try{await XP(`indexeddb://${yf}`),console.log("[MLTrainer] Saved model deleted")}catch{console.warn("[MLTrainer] No model to delete")}}getSummary(){if(!this.model)return"No model loaded";let e="";return this.model.summary(void 0,void 0,t=>{e+=t+`
`}),e}dispose(){this.model&&(this.model.dispose(),this.model=null),this.isDisposed=!0}}let y0=null;function Gc(){return y0||(y0=new ere),y0}function tre(n){return n>=50}function nre(n,e,t,s){if(s===0&&e>=50)return!0;if(s===0)return!1;const r=(Date.now()-n)/(1e3*60*60);return r>=24&&e-t>=10||r>=168}const Ql={exploration:{epsilon:.15,explorationBoost:25,noveltyDecay:.9},serendipity:{maxBonus:30,genreJumpBonus:15,unexpectedArtistBonus:20},diversity:{sameArtistPenalty:-30,sameGenrePenalty:-10,idealGenreMix:.4},flow:{energyTransitionMax:.3,smoothTransitionBonus:15,jarringTransitionPenalty:-20},temporal:{hourWeight:.25},weights:{base:.4,exploration:.1,serendipity:.15,diversity:.15,flow:.1,temporal:.05,plugin:.05}},ni=[],v0=new Map;function sre(n){const e=ni.findIndex(t=>t.pluginId===n.pluginId);e>=0&&ni.splice(e,1),ni.push(n),ni.sort((t,s)=>s.priority-t.priority),console.log(`[AdvancedScoring] Registered feature provider: ${n.pluginId}`)}function rre(n){const e=ni.findIndex(t=>t.pluginId===n);e>=0&&(ni.splice(e,1),console.log(`[AdvancedScoring] Unregistered feature provider: ${n}`))}function ore(){return ni}async function fp(n){if(v0.has(n))return v0.get(n);for(const e of ni)try{const t=await e.getAudioFeatures(n);if(t)return v0.set(n,t),t}catch(t){console.warn(`[AdvancedScoring] Provider ${e.pluginId} failed:`,t)}return null}function ire(n,e,t,s){var u;const r=Ql.exploration,o=!n.artists.some(d=>e.has(d.id||d.name.toLowerCase())),i=!((u=n.genres)!=null&&u.some(d=>t.has(d.toLowerCase())));let a=0;o&&(a+=r.explorationBoost*.6),i&&(a+=r.explorationBoost*.4);const l=Math.pow(r.noveltyDecay,s);return a*=l,Math.random()<r.epsilon&&(a+=r.explorationBoost*.5),a}function are(n,e,t){var m;const s=Ql.serendipity;let r=0;const o=Object.entries(e.genrePreferences).filter(([g,y])=>y>20).map(([g])=>g.toLowerCase()),i=Object.entries(e.artistPreferences).filter(([g,y])=>y>30).map(([g])=>g.toLowerCase()),a=((m=n.genres)==null?void 0:m.map(g=>g.toLowerCase()))||[],l=a.some(g=>o.includes(g));return!a.some(g=>t.slice(0,10).some(y=>{var w;return(w=y.genres)==null?void 0:w.some(b=>b.toLowerCase()===g)}))&&l&&(r+=s.genreJumpBonus),!n.artists.map(g=>g.name.toLowerCase()).some(g=>i.includes(g))&&l&&(r+=s.unexpectedArtistBonus),a.length>=2&&a.filter(y=>o.includes(y)).length>=1&&a.filter(y=>!o.includes(y)).length>=1&&(r+=10),Math.min(r,s.maxBonus)}function lre(n,e,t,s){var l,u,d;const r=Ql.diversity;let o=0;const i=(l=n.artists[0])==null?void 0:l.name.toLowerCase();if(i&&t.has(i)){const f=t.get(i);o+=r.sameArtistPenalty*Math.min(f,3)}const a=(d=(u=n.genres)==null?void 0:u[0])==null?void 0:d.toLowerCase();if(a&&s.size>0){const f=Array.from(s.values()).reduce((y,w)=>y+w,0),g=(s.get(a)||0)/Math.max(f,1);g>r.idealGenreMix?o+=r.sameGenrePenalty*(g-r.idealGenreMix)*10:o+=10*(r.idealGenreMix-g)}return a&&!s.has(a)&&(o+=15),o}function cre(n,e,t,s,r){const o=Ql.flow;if(!e)return 0;let i=0;const a=(t==null?void 0:t.energy)??py(n),l=(s==null?void 0:s.energy)??(r.length>0?r[r.length-1]:.5),u=Math.abs(a-l);if(u<=o.energyTransitionMax?i+=o.smoothTransitionBonus*(1-u/o.energyTransitionMax):i+=o.jarringTransitionPenalty*(u-o.energyTransitionMax),t!=null&&t.bpm&&(s!=null&&s.bpm)){const d=Math.abs(t.bpm-s.bpm),f=d/s.bpm;f<=.15?i+=10:f<=.5||d<=30?i+=5:i-=10}if(t!=null&&t.key&&(s!=null&&s.key)){const d=hre(t.key,s.key);i+=d*10}return i}function ure(n,e,t,s){var u,d;const r=Ql.temporal;let o=0;const i=s.get(e);if(i){const f=(d=(u=n.genres)==null?void 0:u[0])==null?void 0:d.toLowerCase();f&&i.genres[f]&&(o+=i.genres[f]*r.hourWeight*100);const m=py(n),g=Math.abs(m-i.energy);o+=(1-g)*r.hourWeight*50}const a=t===0||t===6,l=py(n);return a?l>.6&&(o+=5):e>=9&&e<=17?l>=.3&&l<=.6&&(o+=5):e>=18&&e<=22&&l>=.4&&l<=.7&&(o+=5),o}async function dre(n,e,t,s,r=0){var $,R,M,A;const o=Ql.weights,i=[],a=await fp(n.id),l=t.sessionTracks[t.sessionTracks.length-1],u=l?await fp(l.id):null,d=new Map,f=new Map;for(const P of t.sessionTracks){const D=($=P.artists[0])==null?void 0:$.name.toLowerCase();D&&d.set(D,(d.get(D)||0)+1);const E=(M=(R=P.genres)==null?void 0:R[0])==null?void 0:M.toLowerCase();E&&f.set(E,(f.get(E)||0)+1)}const m=ire(n,s.artistHistory,s.genreHistory,r);m>10&&i.push("New discovery");const g=are(n,s,t.sessionTracks);g>15&&i.push("Unexpected find");const y=lre(n,t.sessionTracks,d,f);y>10&&i.push("Adds variety"),y<-15&&i.push("Too repetitive");const w=cre(n,l||null,a,u,t.recentEnergy);w>10&&i.push("Smooth transition");const b=ure(n,t.hour,t.dayOfWeek,s.timePatterns);b>5&&i.push("Right time");let k=0;if(a){const P=((A=s.timePatterns.get(t.hour))==null?void 0:A.energy)??.5;a.energy!==void 0&&(k+=(1-Math.abs(a.energy-P))*20),i.push("Audio-analyzed")}const v=Math.max(-100,Math.min(100,e));let S=v*o.base+m*o.exploration+g*o.serendipity+y*o.diversity+w*o.flow+b*o.temporal+k*o.plugin;return t.explorationMode==="explore"?S+=m*.5:t.explorationMode==="exploit"&&(S+=v*.2),{baseScore:v,explorationBonus:m,serendipityScore:g,diversityScore:y,flowScore:w,temporalScore:b,pluginScore:k,finalScore:S,explanation:i}}function py(n){var o;const e=((o=n.genres)==null?void 0:o.map(i=>i.toLowerCase()))||[],t=["electronic","edm","dance","metal","punk","hardcore","drum and bass","dubstep"],s=["pop","rock","hip-hop","rap","indie","alternative","funk","disco"],r=["ambient","classical","jazz","acoustic","folk","lo-fi","chill","sleep"];for(const i of e){if(t.some(a=>i.includes(a)))return .8;if(r.some(a=>i.includes(a)))return .3;if(s.some(a=>i.includes(a)))return .55}return .5}function hre(n,e){const t=["C","G","D","A","E","B","F#","C#","Ab","Eb","Bb","F"],s=u=>u.replace("m","").replace("#","#").toUpperCase(),r=s(n),o=s(e),i=t.indexOf(r),a=t.indexOf(o);if(i===-1||a===-1)return .5;const l=Math.min(Math.abs(i-a),12-Math.abs(i-a));return l<=1?1:l<=2?.8:l<=3?.5:.2}async function PA(n,e,t,s,r){const o=new Map,i=10;for(let a=0;a<n.length;a+=i){const u=n.slice(a,a+i).map(f=>dre(f,e.get(f.id)||50,t,s,r.get(f.id)||0).then(m=>({trackId:f.id,score:m}))),d=await Promise.all(u);for(const{trackId:f,score:m}of d)o.set(f,m)}return o}function cb(n,e,t){return{pluginId:n,priority:e,getAudioFeatures:t.getAudioFeatures||(async()=>null),getSimilarTracks:t.getSimilarTracks,getArtistSimilarity:t.getArtistSimilarity}}function FA(n){sre(n),console.log(`[PluginAudio] Registered provider: ${n.pluginId} (priority: ${n.priority})`)}function iS(n){rre(n),console.log(`[PluginAudio] Unregistered provider: ${n}`)}function fre(n,e){const s=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"][n]||"C";return e===0?`${s}m`:s}const LA=Ps()(fa((n,e)=>({isModelLoaded:!1,isTraining:!1,modelVersion:0,lastTrainedAt:0,eventsAtLastTrain:0,featureScalers:null,trainingMetrics:null,trainingProgress:null,lastError:null,initializeModel:async()=>{const t=Gc();try{await t.loadModel()?(n({isModelLoaded:!0,lastError:null}),console.log("[MLStore] Model loaded successfully")):(t.createModel(),n({isModelLoaded:!1,lastError:null}),console.log("[MLStore] New model created, needs training"))}catch(s){const r=s instanceof Error?s.message:"Failed to initialize model";console.error("[MLStore] Initialization error:",r),n({lastError:r}),t.createModel()}},trainModel:async t=>{const s=e();if(s.isTraining)return console.log("[MLStore] Training already in progress"),!1;const r=On.getState(),{listenHistory:o,userProfile:i,dislikedTracks:a}=r,l=o.length+Object.keys(a).length;if(!tre(l))return console.log("[MLStore] Not enough data to train"),n({lastError:"Need at least 50 listen events to train"}),!1;console.log(`[MLStore] Training with ${o.length} listens + ${Object.keys(a).length} disliked tracks`);let u=s.featureScalers;u||(u=t.length>0?x2(t):Yx(),n({featureScalers:u}));const d=new Map;for(const f of t)d.set(f.id,f);n({isTraining:!0,trainingProgress:{epoch:0,totalEpochs:50,loss:0},lastError:null});try{const f=Gc();f.isReady()||f.createModel();const m=await f.train(d,o,i,u,{epochs:50,batchSize:32},g=>{n({trainingProgress:g})},a);return await f.saveModel(),n({isModelLoaded:!0,isTraining:!1,modelVersion:s.modelVersion+1,lastTrainedAt:Date.now(),eventsAtLastTrain:o.length,trainingMetrics:m,trainingProgress:null,lastError:null}),console.log("[MLStore] Training complete:",m),!0}catch(f){const m=f instanceof Error?f.message:"Training failed";return console.error("[MLStore] Training error:",m),n({isTraining:!1,trainingProgress:null,lastError:m}),!1}},predictScore:(t,s)=>{const r=e();if(!r.isModelLoaded)return .5;const o=Gc();if(!o.isReady())return .5;const i=On.getState(),a=r.featureScalers||Yx();return o.predict(t,i.userProfile,i.listenHistory,a,s)},predictBatchScores:(t,s)=>{const r=new Map,o=e();if(!o.isModelLoaded||t.length===0)return t.forEach(d=>r.set(d.id,.5)),r;const i=Gc();if(!i.isReady())return t.forEach(d=>r.set(d.id,.5)),r;const a=On.getState(),l=o.featureScalers||Yx(),u=i.predictBatch(t,a.userProfile,a.listenHistory,l,s);return t.forEach((d,f)=>{r.set(d.id,u[f])}),r},getHybridScore:(t,s)=>{const r=e(),i=On.getState().calculateTrackScore(t,{hour:s});if(!r.isModelLoaded)return i;const l=r.predictScore(t,s)*200-100,u=Math.min(.6,.1+r.modelVersion*.1),d=1-u,f=i*d+l*u;return Math.max(-100,Math.min(100,f))},getHybridRecommendations:(t,s=20,r)=>{const o=e(),i=On.getState(),a=r??new Date().getHours(),l=t.filter(m=>!i.isDisliked(m.id));if(l.length===0)return[];const u=l.map(m=>({track:m,score:o.getHybridScore(m,a)}));u.sort((m,g)=>g.score-m.score);const d=Math.min(s*2,u.length),f=u.slice(0,d);for(let m=f.length-1;m>0;m--){const g=Math.min(m,3),y=m-Math.floor(Math.random()*g);y!==m&&Math.abs(f[m].score-f[y].score)<10&&([f[m],f[y]]=[f[y],f[m]])}return f.slice(0,s).map(m=>m.track)},updateScalers:t=>{if(t.length===0)return;const s=x2(t);n({featureScalers:s})},checkAndTrain:async t=>{const s=e();if(s.isTraining)return;const r=On.getState(),{listenHistory:o}=r;nre(s.lastTrainedAt,o.length,s.eventsAtLastTrain,s.modelVersion)&&(console.log("[MLStore] Training triggered"),await s.trainModel(t))},resetModel:async()=>{const t=Gc();await t.deleteModel(),t.dispose(),n({isModelLoaded:!1,isTraining:!1,modelVersion:0,lastTrainedAt:0,eventsAtLastTrain:0,featureScalers:null,trainingMetrics:null,trainingProgress:null,lastError:null}),console.log("[MLStore] Model reset")}}),{name:"audiio-ml",partialize:n=>({modelVersion:n.modelVersion,lastTrainedAt:n.lastTrainedAt,eventsAtLastTrain:n.eventsAtLastTrain,featureScalers:n.featureScalers,trainingMetrics:n.trainingMetrics})})),pre={autoQueueEnabled:!1,autoQueueThreshold:2,autoQueueBatchSize:10,limitArtistRepetition:!0,maxArtistPerBatch:2,useMLRecommendations:!0},mre={seedWeight:.7,diversityFactor:.3,progressiveDrift:!0},gre=5e3,xre=14400*1e3;function yre(n,e,t){var o,i;if(!n.length)return[];const s=[],r=new Map;for(const a of n){if(s.length>=e)break;const l=((i=(o=a.artists[0])==null?void 0:o.name)==null?void 0:i.toLowerCase())||"unknown",u=r.get(l)||0;u<t&&(s.push(a),r.set(l,u+1))}if(s.length<e){const a=n.filter(l=>!s.includes(l));s.push(...a.slice(0,e-s.length))}return s}const aS={C:0,G:1,D:2,A:3,E:4,B:5,"F#":6,Gb:6,"C#":7,Db:7,Ab:8,"G#":8,Eb:9,"D#":9,Bb:10,"A#":10,F:11,Am:0,Em:1,Bm:2,"F#m":3,"C#m":4,"G#m":5,"D#m":6,Ebm:6,"A#m":7,Bbm:7,Fm:8,Cm:9,Gm:10,Dm:11};function vre(n,e){if(!n||!e)return .5;const t=aS[n],s=aS[e];if(t===void 0||s===void 0)return .5;const r=Math.min(Math.abs(t-s),12-Math.abs(t-s));return Math.max(0,1-r*.2)}function bre(n,e){var s,r,o,i;let t=0;switch(e.type){case"track":(s=e.artistIds)!=null&&s.some(a=>n.artists.some(l=>l.id===a||l.name.toLowerCase()===a.toLowerCase()))&&(t+=30),(r=e.genres)!=null&&r.some(a=>{var l;return(l=n.genres)==null?void 0:l.some(u=>u.toLowerCase().includes(a.toLowerCase()))})&&(t+=20);break;case"artist":n.artists.some(a=>a.id===e.id||a.name.toLowerCase()===e.name.toLowerCase())&&(t+=50),(o=e.genres)!=null&&o.some(a=>{var l;return(l=n.genres)==null?void 0:l.some(u=>u.toLowerCase().includes(a.toLowerCase()))})&&(t+=20);break;case"genre":(i=n.genres)!=null&&i.some(a=>a.toLowerCase().includes(e.id.toLowerCase())||e.id.toLowerCase().includes(a.toLowerCase()))&&(t+=60);break}if(e.audioFeatures){const a=e.audioFeatures,l=n.audioFeatures||{};let u=0,d=0;if(a.bpm!==void 0&&l.bpm!==void 0){const f=Math.abs(a.bpm-l.bpm),m=Math.min(f/a.bpm,1);m<=.1?u+=12:m<=.2?u+=8:m<=.3&&(u+=4),d++}if(a.energy!==void 0&&l.energy!==void 0){const f=Math.abs(a.energy-l.energy);f<=.15?u+=12:f<=.25?u+=8:f<=.35&&(u+=4),d++}if(a.key!==void 0&&l.key!==void 0){const f=vre(a.key,l.key);u+=Math.round(f*10),d++}if(a.valence!==void 0&&l.valence!==void 0){const f=Math.abs(a.valence-l.valence);f<=.2?u+=6:f<=.35&&(u+=3),d++}t+=u,d>0&&console.log(`[RadioSeed] Audio match for "${n.title}": +${u} (${d} factors)`)}return Math.min(100,t)}const Ud=Ps()(fa((n,e)=>({mode:"manual",radioSeed:null,radioTracksPlayed:0,sessionHistory:{playedTrackIds:[],playedArtistIds:[],sessionStartTime:Date.now()},isAutoQueueFetching:!1,lastAutoQueueFetch:0,autoQueueError:null,consecutiveFailures:0,config:pre,radioConfig:mre,pendingCandidates:[],setMode:t=>n({mode:t}),enableAutoQueue:()=>n({mode:"auto-queue",config:{...e().config,autoQueueEnabled:!0}}),disableAutoQueue:()=>n({mode:"manual",config:{...e().config,autoQueueEnabled:!1}}),toggleAutoQueue:()=>{const{config:t,mode:s}=e();t.autoQueueEnabled||s==="auto-queue"?e().disableAutoQueue():e().enableAutoQueue()},startRadio:async(t,s=[])=>{const r=yt.getState();let o=t;if(t.type==="track"&&!t.audioFeatures)try{const i=await fp(t.id);i&&(o={...t,audioFeatures:i},console.log("[SmartQueue] Enriched seed with audio features:",i))}catch(i){console.warn("[SmartQueue] Could not fetch audio features for seed:",i)}if(n({mode:"radio",radioSeed:o,radioTracksPlayed:0,sessionHistory:{playedTrackIds:[],playedArtistIds:[],sessionStartTime:Date.now()},autoQueueError:null,consecutiveFailures:0}),console.log("[SmartQueue] Starting radio with seed:",o),s.length>0){const i=await e().fetchMoreTracks(s);i.length>0&&(r.setQueue(i,0),await r.play(i[0]),e().recordTrackPlayed(i[0]))}},stopRadio:()=>{n({mode:"manual",radioSeed:null,radioTracksPlayed:0,pendingCandidates:[]}),console.log("[SmartQueue] Radio stopped")},checkAndReplenish:async t=>{const s=e(),{config:r,mode:o,isAutoQueueFetching:i,lastAutoQueueFetch:a}=s;if(o==="manual"||!r.autoQueueEnabled&&o!=="radio"||i||Date.now()-a<gre)return;const l=yt.getState(),{queue:u,queueIndex:d}=l,f=u.length-d-1;if(f<=r.autoQueueThreshold){console.log("[SmartQueue] Replenishing queue, remaining:",f),n({isAutoQueueFetching:!0});try{const m=await s.fetchMoreTracks(t);m.length>0?(m.forEach(g=>l.addToQueue(g)),n({isAutoQueueFetching:!1,lastAutoQueueFetch:Date.now(),autoQueueError:null,consecutiveFailures:0}),console.log("[SmartQueue] Added",m.length,"tracks to queue")):n({isAutoQueueFetching:!1,lastAutoQueueFetch:Date.now(),autoQueueError:"No matching tracks found",consecutiveFailures:s.consecutiveFailures+1})}catch(m){const g=m instanceof Error?m.message:"Failed to fetch tracks";console.error("[SmartQueue] Fetch error:",g),n({isAutoQueueFetching:!1,lastAutoQueueFetch:Date.now(),autoQueueError:g,consecutiveFailures:s.consecutiveFailures+1})}}},fetchMoreTracks:async t=>{var oe,Q,ce,me,ge,ve,Ne,Me,Ue,Qe;const s=e(),{config:r,radioConfig:o,mode:i,radioSeed:a,sessionHistory:l,radioTracksPlayed:u}=s,d=yt.getState(),f=On.getState(),m=LA.getState(),g=ma.getState(),y=d.currentTrack,w=new Set;d.queue.forEach(ye=>w.add(ye.id)),l.playedTrackIds.forEach(ye=>w.add(ye)),Object.keys(f.dislikedTracks).forEach(ye=>w.add(ye));const b=[],k=[],v=[];if(console.log("[SmartQueue] Gathering candidates from multiple sources..."),console.log(`[SmartQueue] Current track: ${(y==null?void 0:y.title)||"none"} by ${((oe=y==null?void 0:y.artists[0])==null?void 0:oe.name)||"unknown"}`),t.length>0&&(b.push(...t),console.log(`[SmartQueue] Local library: ${t.length} tracks`)),y){for(const ye of ore())if(ye.getSimilarTracks)try{const Ce=await ye.getSimilarTracks(y.id,20);Ce.length>0&&console.log(`[SmartQueue] Plugin ${ye.pluginId} returned ${Ce.length} similar tracks`)}catch(Ce){console.warn(`[SmartQueue] Plugin ${ye.pluginId} similar tracks failed:`,Ce)}}try{if((Q=window.api)!=null&&Q.getSimilarTracks&&y){const Ce=await window.api.getSimilarTracks(y.id);Ce&&Ce.length>0&&(v.push(...Ce),console.log(`[SmartQueue] API similar: ${Ce.length} tracks`))}if((ce=window.api)!=null&&ce.getRecommendedTracks){if(i==="radio"&&a){const be=a.type==="track"?"artist":a.type,xe=await window.api.getRecommendedTracks(be,a.id);(xe==null?void 0:xe.length)>0&&(k.push(...xe),console.log(`[SmartQueue] Radio seed recs: ${xe.length} tracks`))}if(y!=null&&y.artists[0]){const be=y.artists[0].id||y.artists[0].name,xe=await window.api.getRecommendedTracks("artist",be);(xe==null?void 0:xe.length)>0&&(k.push(...xe),console.log(`[SmartQueue] Artist recs (${y.artists[0].name}): ${xe.length} tracks`))}if((me=y==null?void 0:y.genres)!=null&&me[0]){const be=await window.api.getRecommendedTracks("genre",y.genres[0]);(be==null?void 0:be.length)>0&&(k.push(...be),console.log(`[SmartQueue] Genre recs (${y.genres[0]}): ${be.length} tracks`))}const Ce=Object.entries(f.userProfile.genrePreferences).sort((be,xe)=>xe[1].score-be[1].score).slice(0,2).map(([be])=>be);for(const be of Ce)if(be!==((ge=y==null?void 0:y.genres)==null?void 0:ge[0]))try{const xe=await window.api.getRecommendedTracks("genre",be);(xe==null?void 0:xe.length)>0&&(k.push(...xe.slice(0,10)),console.log(`[SmartQueue] User genre recs (${be}): ${Math.min(xe.length,10)} tracks`))}catch{}}if(k.length<20&&((ve=window.api)!=null&&ve.search)){const Ce=[];y&&(y.artists[0]&&(Ce.push(`${y.artists[0].name} fans also like`),Ce.push(`similar to ${y.artists[0].name}`)),(Ne=y.genres)!=null&&Ne[0]&&(Ce.push(`best ${y.genres[0]} 2024`),Ce.push(`${y.genres[0]} playlist`)));const be=Object.entries(f.userProfile.artistPreferences).sort((xe,Be)=>Be[1].score-xe[1].score).slice(0,3).map(([xe,Be])=>Be.artistName);for(const xe of be)xe&&xe!==((Me=y==null?void 0:y.artists[0])==null?void 0:Me.name)&&Ce.push(`${xe} popular songs`);for(const xe of Ce.slice(0,3))try{const Be=await window.api.search({query:xe,type:"track"});(Be==null?void 0:Be.length)>0&&(k.push(...Be.slice(0,15)),console.log(`[SmartQueue] Search "${xe}": ${Math.min(Be.length,15)} tracks`))}catch{console.warn(`[SmartQueue] Search failed: "${xe}"`)}}if(k.length<10&&((Ue=window.api)!=null&&Ue.getTrending)){const Ce=await window.api.getTrending();((Qe=Ce==null?void 0:Ce.tracks)==null?void 0:Qe.length)>0&&(k.push(...Ce.tracks.slice(0,20)),console.log(`[SmartQueue] Trending fallback: ${Math.min(Ce.tracks.length,20)} tracks`))}g.results.tracks.length>0&&(k.push(...g.results.tracks),console.log(`[SmartQueue] Search cache: ${g.results.tracks.length} tracks`))}catch(ye){console.warn("[SmartQueue] API fetch failed:",ye)}let N=[];const S=b.length,$=k.length+v.length;console.log(`[SmartQueue] Source breakdown - Local: ${S}, Similar: ${v.length}, Discovery: ${k.length}`);const R=[];let M=0,A=0,P=0;for(;M<v.length;)R.push(v[M++]);for(;A<k.length||P<b.length;)A<k.length&&R.push(k[A++]),A<k.length&&R.push(k[A++]),P<b.length&&R.push(b[P++]);N=R;const D=new Set;if(N=N.filter(ye=>!(ye!=null&&ye.id)||D.has(ye.id)||w.has(ye.id)?!1:(D.add(ye.id),!0)),console.log(`[SmartQueue] ${N.length} unique candidates after deduplication`),N.length===0)return console.warn("[SmartQueue] No candidates available for auto-queue"),[];const E=new Date,j=d.queue.slice(Math.max(0,d.queueIndex-5),d.queueIndex+1),V=[];for(const ye of j.slice(-3)){const Ce=ye.audioFeatures||await fp(ye.id);(Ce==null?void 0:Ce.energy)!==void 0&&V.push(Ce.energy)}const W=$/Math.max(1,S+$);let U="balanced";W>.6?U="exploit":W<.3&&(U="explore"),console.log(`[SmartQueue] Exploration mode: ${U} (discovery ratio: ${(W*100).toFixed(0)}%)`);const X={hour:E.getHours(),dayOfWeek:E.getDay(),sessionTracks:j,recentGenres:j.flatMap(ye=>ye.genres||[]).slice(0,10),recentArtists:j.map(ye=>{var Ce;return(Ce=ye.artists[0])==null?void 0:Ce.name}).filter(Boolean).slice(0,5),recentEnergy:V,explorationMode:U},ee={genrePreferences:f.userProfile.genrePreferences,artistPreferences:f.userProfile.artistPreferences,artistHistory:f.getArtistHistory(),genreHistory:f.getGenreHistory(),timePatterns:f.getTimePatternsForScoring()},G=f.getPlayCounts(),z=new Map,H=r.useMLRecommendations&&m.isModelLoaded;for(const ye of N){let Ce;if(i==="radio"&&a){const be=H?m.getHybridScore(ye):f.calculateTrackScore(ye),xe=bre(ye,a);let Be=o.seedWeight;o.progressiveDrift&&(Be=Math.max(.3,o.seedWeight-u*.02)),Ce=be*(1-Be)+xe*Be}else Ce=H?m.getHybridScore(ye):f.calculateTrackScore(ye);z.set(ye.id,Ce)}console.log(`[SmartQueue] Using ${H?"ML hybrid":"rule-based"} + advanced scoring...`);const O=await PA(N,z,X,ee,G),B=N.map(ye=>{const Ce=O.get(ye.id);return{track:ye,score:(Ce==null?void 0:Ce.finalScore)??z.get(ye.id)??0,explanation:(Ce==null?void 0:Ce.explanation)||[]}});B.sort((ye,Ce)=>Ce.score-ye.score),console.log("[SmartQueue] Top 5 candidates:"),B.slice(0,5).forEach((ye,Ce)=>{var xe;const be=ye.explanation.length>0?` [${ye.explanation.join(", ")}]`:"";console.log(`  ${Ce+1}. ${ye.track.title} by ${(xe=ye.track.artists[0])==null?void 0:xe.name} (${ye.score.toFixed(1)})${be}`)});let Y=B.map(ye=>ye.track);return r.limitArtistRepetition?Y=yre(Y,r.autoQueueBatchSize,r.maxArtistPerBatch):Y=Y.slice(0,r.autoQueueBatchSize),console.log(`[SmartQueue] Selected ${Y.length} tracks for queue`),Y},recordTrackPlayed:t=>{n(s=>{const r=[...s.sessionHistory.playedTrackIds,t.id],o=[...s.sessionHistory.playedArtistIds,...t.artists.map(l=>l.id||l.name)],i=r.slice(-200),a=o.slice(-400);return{sessionHistory:{...s.sessionHistory,playedTrackIds:i,playedArtistIds:a},radioTracksPlayed:s.mode==="radio"?s.radioTracksPlayed+1:s.radioTracksPlayed}})},clearSession:()=>{n({sessionHistory:{playedTrackIds:[],playedArtistIds:[],sessionStartTime:Date.now()},radioTracksPlayed:0})},resetSession:()=>{const{sessionHistory:t}=e();Date.now()-t.sessionStartTime>xre&&e().clearSession()},updateConfig:t=>{n(s=>({config:{...s.config,...t}}))},updateRadioConfig:t=>{n(s=>({radioConfig:{...s.radioConfig,...t}}))}}),{name:"audiio-smart-queue",partialize:n=>({config:n.config,radioConfig:n.radioConfig})}));function jA(){return Ud(YS(n=>({isRadioMode:n.mode==="radio",seed:n.radioSeed,tracksPlayed:n.radioTracksPlayed})))}function wre(){return Ud(YS(n=>({isEnabled:n.config.autoQueueEnabled||n.mode==="auto-queue",isFetching:n.isAutoQueueFetching,error:n.autoQueueError})))}const kre=({entity:n,x:e,y:t,onClose:s,onAddToPlaylist:r,onDislike:o})=>{const i=L.useRef(null),a=L.useRef(null),[l,u]=L.useState(!1),d=L.useRef(null),{play:f,addToQueue:m}=yt(),{isLiked:g,toggleLike:y,playlists:w,addToPlaylist:b,startDownload:k}=gs(),{isDisliked:v,removeDislike:N}=On(),{openArtist:S,openAlbum:$}=on();L.useEffect(()=>()=>{d.current&&clearTimeout(d.current)},[]);const R=L.useCallback(()=>{d.current&&(clearTimeout(d.current),d.current=null),u(!0)},[]),M=L.useCallback(()=>{d.current=setTimeout(()=>{u(!1)},150)},[]);if(L.useEffect(()=>{if(i.current){const A=i.current.getBoundingClientRect(),P=window.innerWidth,D=window.innerHeight;let E=e,j=t;e+A.width>P&&(E=P-A.width-10),t+A.height>D&&(j=D-A.height-10),i.current.style.left=`${E}px`,i.current.style.top=`${j}px`}},[e,t]),L.useEffect(()=>{const A=D=>{i.current&&!i.current.contains(D.target)&&s()},P=D=>{D.key==="Escape"&&s()};return document.addEventListener("mousedown",A),document.addEventListener("keydown",P),()=>{document.removeEventListener("mousedown",A),document.removeEventListener("keydown",P)}},[s]),n.type==="track"){const A=n.data,P=g(A.id),D=v(A.id),E=()=>{f(A),s()},j=()=>{m(A),s()},V=()=>{y(A),s()},W=()=>{k(A),s()},U=()=>{D?N(A.id):o&&o(A),s()},X=H=>{b(H,A),u(!1),s()},ee=()=>{r&&r(A),s()},G=()=>{var O,B;const H=A.artists[0];H&&S(H.id,{id:H.id,name:H.name,image:(O=A.artwork)==null?void 0:O.medium,source:((B=A._meta)==null?void 0:B.metadataProvider)||"unknown"}),s()},z=()=>{var H,O,B;A.album&&$(A.album.id,{id:A.album.id,title:A.album.title,artist:((H=A.artists[0])==null?void 0:H.name)||"Unknown",artwork:(O=A.album.artwork)==null?void 0:O.medium,year:A.album.releaseDate?parseInt(A.album.releaseDate.substring(0,4)):void 0,source:((B=A._meta)==null?void 0:B.metadataProvider)||"unknown"}),s()};return p.jsxs("div",{ref:i,className:"context-menu",style:{left:e,top:t},children:[p.jsxs("button",{className:"context-menu-item",onClick:E,children:[p.jsx(At,{size:16}),p.jsx("span",{children:"Play"})]}),p.jsxs("button",{className:"context-menu-item",onClick:j,children:[p.jsx(Mf,{size:16}),p.jsx("span",{children:"Add to Queue"})]}),p.jsx("div",{className:"context-menu-divider"}),p.jsxs("div",{className:"context-menu-item has-submenu",onMouseEnter:R,onMouseLeave:M,children:[p.jsx(Yi,{size:16}),p.jsx("span",{children:"Add to Playlist"}),p.jsx(yl,{size:14,className:"context-menu-arrow"}),l&&p.jsxs("div",{ref:a,className:"context-submenu",onMouseEnter:R,onMouseLeave:M,children:[r&&p.jsxs("button",{className:"context-menu-item",onClick:ee,children:[p.jsx(xl,{size:16}),p.jsx("span",{children:"New Playlist..."})]}),w.length>0&&r&&p.jsx("div",{className:"context-menu-divider"}),w.length===0?p.jsx("div",{className:"context-menu-item disabled",children:p.jsx("span",{children:"No playlists"})}):w.map(H=>p.jsxs("button",{className:"context-menu-item",onClick:()=>X(H.id),children:[p.jsx(Yi,{size:16}),p.jsx("span",{children:H.name})]},H.id))]})]}),p.jsx("div",{className:"context-menu-divider"}),A.artists[0]&&p.jsxs("button",{className:"context-menu-item",onClick:G,children:[p.jsx(Ye,{size:16}),p.jsx("span",{children:"Go to Artist"})]}),A.album&&p.jsxs("button",{className:"context-menu-item",onClick:z,children:[p.jsx(Ye,{size:16}),p.jsx("span",{children:"Go to Album"})]}),(A.artists[0]||A.album)&&p.jsx("div",{className:"context-menu-divider"}),p.jsxs("button",{className:"context-menu-item",onClick:V,children:[P?p.jsx(Ml,{size:16}):p.jsx(Su,{size:16}),p.jsx("span",{children:P?"Remove from Liked":"Add to Liked"})]}),p.jsxs("button",{className:`context-menu-item ${D?"active":""}`,onClick:U,children:[D?p.jsx(Cy,{size:16}):p.jsx(GS,{size:16}),p.jsx("span",{children:D?"Remove Dislike":"Not for me..."})]}),p.jsx("div",{className:"context-menu-divider"}),p.jsxs("button",{className:"context-menu-item",onClick:W,children:[p.jsx(gl,{size:16}),p.jsx("span",{children:"Download"})]})]})}if(n.type==="artist"){const A=n.data,P=()=>{s()},D=()=>{S(A.id,A),s()};return p.jsxs("div",{ref:i,className:"context-menu",style:{left:e,top:t},children:[p.jsxs("button",{className:"context-menu-item",onClick:P,children:[p.jsx(At,{size:16}),p.jsx("span",{children:"Play Artist"})]}),p.jsx("div",{className:"context-menu-divider"}),p.jsxs("button",{className:"context-menu-item",onClick:D,children:[p.jsx(Ye,{size:16}),p.jsx("span",{children:"Go to Artist Page"})]})]})}if(n.type==="album"){const A=n.data,P=()=>{s()},D=()=>{s()},E=()=>{$(A.id,A),s()},j=()=>{S(`artist-${A.artist}`,{id:`artist-${A.artist}`,name:A.artist,source:A.source}),s()};return p.jsxs("div",{ref:i,className:"context-menu",style:{left:e,top:t},children:[p.jsxs("button",{className:"context-menu-item",onClick:P,children:[p.jsx(At,{size:16}),p.jsx("span",{children:"Play Album"})]}),p.jsxs("button",{className:"context-menu-item",onClick:D,children:[p.jsx(Mf,{size:16}),p.jsx("span",{children:"Add to Queue"})]}),p.jsx("div",{className:"context-menu-divider"}),p.jsxs("button",{className:"context-menu-item",onClick:E,children:[p.jsx(Ye,{size:16}),p.jsx("span",{children:"Go to Album Page"})]}),p.jsxs("button",{className:"context-menu-item",onClick:j,children:[p.jsx(Ye,{size:16}),p.jsx("span",{children:"Go to Artist"})]})]})}return null},eg=L.createContext(null);function Pn(){const n=L.useContext(eg);if(!n)throw new Error("useTrackContextMenu must be used within a ContextMenuProvider");return{showContextMenu:n.showTrackMenu,hideContextMenu:n.hideContextMenu}}function ub(){const n=L.useContext(eg);if(!n)throw new Error("useArtistContextMenu must be used within a ContextMenuProvider");return{showContextMenu:n.showArtistMenu,hideContextMenu:n.hideContextMenu}}function Gd(){const n=L.useContext(eg);if(!n)throw new Error("useAlbumContextMenu must be used within a ContextMenuProvider");return{showContextMenu:n.showAlbumMenu,hideContextMenu:n.hideContextMenu}}const Cre=({children:n,onAddToPlaylist:e,onDislike:t})=>{const[s,r]=L.useState(null),o=L.useCallback((d,f)=>{d.preventDefault(),d.stopPropagation(),r({entity:f,x:d.clientX,y:d.clientY})},[]),i=L.useCallback((d,f)=>{d.preventDefault(),d.stopPropagation(),r({entity:{type:"track",data:f},x:d.clientX,y:d.clientY})},[]),a=L.useCallback((d,f)=>{d.preventDefault(),d.stopPropagation(),r({entity:{type:"artist",data:f},x:d.clientX,y:d.clientY})},[]),l=L.useCallback((d,f)=>{d.preventDefault(),d.stopPropagation(),r({entity:{type:"album",data:f},x:d.clientX,y:d.clientY})},[]),u=L.useCallback(()=>{r(null)},[]);return p.jsxs(eg.Provider,{value:{showContextMenu:o,hideContextMenu:u,showTrackMenu:i,showArtistMenu:a,showAlbumMenu:l},children:[n,s&&p.jsx(kre,{entity:s.entity,x:s.x,y:s.y,onClose:u,onAddToPlaylist:e,onDislike:t})]})};function Sre({availableTracks:n,enabled:e=!0}){const{queue:t,queueIndex:s,currentTrack:r}=yt(),{mode:o,config:i,checkAndReplenish:a,recordTrackPlayed:l}=Ud(),u=L.useRef(null);return L.useEffect(()=>{if(!e||o==="manual"&&!i.autoQueueEnabled||!r)return;r.id!==u.current&&(u.current=r.id,l(r)),t.length-s-1<=i.autoQueueThreshold&&a(n)},[s,r==null?void 0:r.id,o,i.autoQueueEnabled,e]),L.useEffect(()=>{if(!e)return;const d=()=>{(o!=="manual"||i.autoQueueEnabled)&&a(n)};return window.addEventListener("audiio:check-auto-queue",d),()=>window.removeEventListener("audiio:check-auto-queue",d)},[n,a,o,i.autoQueueEnabled,e]),{isActive:o!=="manual"||i.autoQueueEnabled,mode:o,config:i}}function Yl(){const n=On(),e=LA(),t=yt(),s=e.isModelLoaded,r=e.isTraining,o=L.useCallback((d="balanced")=>{const f=new Date,m=t.queue.slice(Math.max(0,t.queueIndex-5),t.queueIndex+1);return{hour:f.getHours(),dayOfWeek:f.getDay(),sessionTracks:m,recentGenres:m.flatMap(g=>g.genres||[]).slice(0,10),recentArtists:m.map(g=>{var y;return(y=g.artists[0])==null?void 0:y.name}).filter(Boolean).slice(0,5),recentEnergy:[],explorationMode:d,userMood:"auto"}},[t.queue,t.queueIndex]),i=L.useCallback(()=>({genrePreferences:n.userProfile.genrePreferences,artistPreferences:n.userProfile.artistPreferences,artistHistory:n.getArtistHistory(),genreHistory:n.getGenreHistory(),timePatterns:n.getTimePatternsForScoring()}),[n]),a=L.useCallback(d=>s?e.getHybridScore(d):n.calculateTrackScore(d),[s,e,n]),l=L.useCallback(async(d,f={})=>{const{enabled:m=!0,explorationMode:g="balanced",minScore:y,limit:w,shuffle:b=!1,shuffleIntensity:k=.1}=f;if(!m||d.length===0)return d.map(A=>({track:A,score:0,explanation:[]}));const v=o(g),N=i(),S=n.getPlayCounts(),$=new Map;for(const A of d)$.set(A.id,a(A));const R=await PA(d,$,v,N,S);let M=d.map(A=>{const P=R.get(A.id);return{track:A,score:(P==null?void 0:P.finalScore)??$.get(A.id)??0,explanation:(P==null?void 0:P.explanation)||[]}});return M.sort((A,P)=>P.score-A.score),y!==void 0&&(M=M.filter(A=>A.score>=y)),b&&M.length>1&&(M=lS(M,k)),w!==void 0&&w>0&&(M=M.slice(0,w)),M},[o,i,n,a]),u=L.useCallback((d,f={})=>{const{enabled:m=!0,minScore:g,limit:y,shuffle:w=!1,shuffleIntensity:b=.1}=f;if(!m||d.length===0)return d.map(v=>({track:v,score:0,explanation:[]}));let k=d.map(v=>({track:v,score:a(v),explanation:[]}));return k.sort((v,N)=>N.score-v.score),g!==void 0&&(k=k.filter(v=>v.score>=g)),w&&k.length>1&&(k=lS(k,b)),y!==void 0&&y>0&&(k=k.slice(0,y)),k},[a]);return{rankTracks:l,rankTracksSync:u,getTrackScore:a,isMLReady:s,isTraining:r}}function lS(n,e){const t=[...n],s=Math.ceil(t.length*e);for(let r=0;r<t.length;r++){const o=Math.min(s,3);if(Math.random()<e&&r+o<t.length){const i=r+1+Math.floor(Math.random()*o);Math.abs(t[r].score-t[i].score)<15&&([t[r],t[i]]=[t[i],t[r]])}}return t}const pp=new Map,Nre=["spotify-metadata","local-audio-analysis"];let cS=!1;function Ire(){return cb("spotify-metadata",100,{async getAudioFeatures(n){var t;const e=pp.get(n);if(e)return e;try{if((t=window.api)!=null&&t.getAudioFeatures){const s=await window.api.getAudioFeatures(n);if(s){const r={bpm:s.tempo,energy:s.energy,danceability:s.danceability,acousticness:s.acousticness,instrumentalness:s.instrumentalness,valence:s.valence,loudness:s.loudness,speechiness:s.speechiness,key:fre(s.key,s.mode),mode:s.mode===1?"major":"minor"};return pp.set(n,r),r}}}catch(s){console.warn("[SpotifyProvider] Failed to get audio features:",s)}return null},async getSimilarTracks(n,e){var t;try{if((t=window.api)!=null&&t.getSimilarTracks){const s=await window.api.getSimilarTracks(n,e);if(s&&Array.isArray(s))return s.map(r=>typeof r=="string"?r:r.id)}}catch(s){console.warn("[SpotifyProvider] Failed to get similar tracks:",s)}return[]}})}function $re(){return cb("lastfm-scrobbler",75,{async getAudioFeatures(n){return null},async getSimilarTracks(n,e){var t;try{if((t=window.api)!=null&&t.getLastfmSimilar)return await window.api.getLastfmSimilar(n,e)||[]}catch(s){console.warn("[LastfmProvider] Failed to get similar tracks:",s)}return[]},async getArtistSimilarity(n,e){var t;try{if((t=window.api)!=null&&t.getArtistSimilarity)return await window.api.getArtistSimilarity(n,e)}catch(s){console.warn("[LastfmProvider] Failed to get artist similarity:",s)}return 0}})}function Tre(){return cb("local-audio-analysis",25,{async getAudioFeatures(n){var t;const e=pp.get(n);if(e)return e;try{if((t=window.api)!=null&&t.getAudioFeatures){const s=await window.api.getAudioFeatures(n);if(s){const r={bpm:s.bpm,energy:s.energy,danceability:s.danceability,acousticness:s.acousticness,instrumentalness:s.instrumentalness,valence:s.valence,loudness:s.loudness,speechiness:s.speechiness,key:s.key,mode:s.mode};return pp.set(n,r),r}}}catch(s){console.warn("[LocalAnalysisProvider] Failed to get audio features:",s)}return null},async getSimilarTracks(n,e){return[]}})}async function Ere(){var n;if(!cS)try{if((n=window.api)!=null&&n.checkAudioAnalyzer){const e=await window.api.checkAudioAnalyzer();if(e!=null&&e.available){const t=Tre();FA(t),cS=!0,console.log("[PluginAudioFeatures] Registered local audio analysis provider")}else console.log("[PluginAudioFeatures] Local audio analysis not available (FFmpeg missing)")}}catch(e){console.warn("[PluginAudioFeatures] Failed to initialize local analysis:",e)}}function Rre(){const n=pa(t=>t.plugins),e=L.useRef(new Set);L.useEffect(()=>{Ere()},[]),L.useEffect(()=>{const t=e.current;for(const s of n){if(!(Nre.includes(s.id)||s.id==="lastfm-scrobbler"))continue;const o=s.enabled&&s.installed,i=t.has(s.id);if(o&&!i){let a;switch(s.id){case"spotify-metadata":a=Ire();break;case"lastfm-scrobbler":a=$re();break;case"local-audio-analysis":continue;default:continue}a&&(FA(a),t.add(s.id),console.log(`[PluginAudioFeatures] Registered provider: ${s.id}`))}else!o&&i&&(iS(s.id),t.delete(s.id),console.log(`[PluginAudioFeatures] Unregistered provider: ${s.id}`))}},[n]),L.useEffect(()=>()=>{const t=e.current;for(const s of t)iS(s);t.clear()},[])}function Are(){const{updateDownloadProgress:n,completeDownload:e,failDownload:t}=gs();L.useEffect(()=>{var r;if(!((r=window.api)!=null&&r.onDownloadProgress)){console.log("[useDownloadProgress] Download progress API not available");return}console.log("[useDownloadProgress] Setting up download progress listener");const s=window.api.onDownloadProgress(o=>{switch(console.log("[useDownloadProgress] Progress event:",o),o.status){case"downloading":n(o.trackId,o.progress);break;case"completed":e(o.trackId,o.filePath||"");break;case"failed":t(o.trackId,o.error||"Download failed");break}});return()=>{console.log("[useDownloadProgress] Cleaning up download progress listener"),s()}},[n,e,t])}async function Dre(n){return new Promise(e=>{const t=new Image;t.crossOrigin="anonymous",t.onload=()=>{try{const s=document.createElement("canvas");s.width=50,s.height=50;const r=s.getContext("2d");if(!r){e("#1db954");return}r.drawImage(t,0,0,50,50);const o=r.getImageData(0,0,50,50).data;let i=0,a=0,l=0;for(let d=0;d<o.length;d+=4)i+=o[d],a+=o[d+1],l+=o[d+2];const u=o.length/4;e(`rgb(${Math.round(i/u)}, ${Math.round(a/u)}, ${Math.round(l/u)})`)}catch{e("#1db954")}},t.onerror=()=>e("#1db954"),t.src=n})}function Mre(n){const e=[...n];for(let t=e.length-1;t>0;t--){const s=Math.floor(Math.random()*(t+1)),r=e[t];e[t]=e[s],e[s]=r}return e}const Pre=({title:n,subtitle:e,query:t,isPersonalized:s,context:r})=>{var B,Y;const{play:o,setQueue:i}=yt(),{startRadio:a,enableAutoQueue:l}=Ud(),{isRadioMode:u,seed:d}=jA(),{userProfile:f}=On(),{likedTracks:m}=gs(),{showContextMenu:g}=Pn(),{rankTracks:y}=Yl(),[w,b]=L.useState([]),[k,v]=L.useState(!0),[N,S]=L.useState(!1),[$,R]=L.useState("var(--accent-primary)"),[M,A]=L.useState(!1),P=L.useRef(f.totalListens),D=L.useRef(null),E=u&&(d==null?void 0:d.type)==="genre"&&d.name==="Made For You",j=L.useCallback(async(oe=!1)=>{var Q,ce,me,ge,ve;oe?S(!0):v(!0);try{let Ne=[];const Me=[];if(m.length>0&&Me.push(...m.slice(0,30)),(Q=window.api)!=null&&Q.getRecommendedTracks){const ye=Object.entries(f.genrePreferences).sort((be,xe)=>xe[1].score-be[1].score).slice(0,2).map(([be])=>be),Ce=Object.entries(f.artistPreferences).sort((be,xe)=>xe[1].score-be[1].score).slice(0,2).map(([be,xe])=>xe.artistName);for(const be of ye)try{const xe=await window.api.getRecommendedTracks("genre",be);(xe==null?void 0:xe.length)>0&&Me.push(...xe.slice(0,15))}catch{}for(const be of Ce)if(be)try{const xe=await window.api.getRecommendedTracks("artist",be);(xe==null?void 0:xe.length)>0&&Me.push(...xe.slice(0,10))}catch{}}if((ce=window.api)!=null&&ce.getTrending)try{const ye=await window.api.getTrending();((me=ye==null?void 0:ye.tracks)==null?void 0:me.length)>0&&Me.push(...ye.tracks.slice(0,15).map(Ce=>({...Ce,streamSources:[],_meta:{metadataProvider:Ce._provider||"hero",matchConfidence:1,externalIds:Ce.externalIds||{},lastUpdated:new Date}})))}catch{}if(Me.length<10&&((ge=window.api)!=null&&ge.search)){const ye=t||((ve=r==null?void 0:r.topArtists)!=null&&ve[0]?`${r.topArtists[0]} best songs`:"top hits 2024 popular");try{const Ce=await window.api.search({query:ye,type:"track"});(Ce==null?void 0:Ce.length)>0&&Me.push(...Ce.slice(0,20))}catch{}}const Ue=new Set;if(Ne=Me.filter(ye=>!(ye!=null&&ye.id)||Ue.has(ye.id)?!1:(Ue.add(ye.id),!0)),Ne.length===0){v(!1),S(!1);return}const Qe=await y(Ne,{enabled:!0,explorationMode:oe?"balanced":"exploit",limit:20,shuffle:!0,shuffleIntensity:oe?.3:.15});b(Qe.map(ye=>ye.track))}catch(Ne){console.error("[HeroSection] Failed to fetch:",Ne)}finally{v(!1),S(!1)}},[t,r==null?void 0:r.topArtists,y,m,f]);L.useEffect(()=>{j(!1)},[j]),L.useEffect(()=>{const oe=f.totalListens-P.current;return oe>=5&&(console.log("[HeroSection] Evolving mix - refreshing after",oe,"new listens"),P.current=f.totalListens,D.current&&clearTimeout(D.current),D.current=setTimeout(()=>{j(!0)},2e3)),()=>{D.current&&clearTimeout(D.current)}},[f.totalListens,j]);const V=w==null?void 0:w[0],W=((B=V==null?void 0:V.artwork)==null?void 0:B.large)||((Y=V==null?void 0:V.artwork)==null?void 0:Y.medium);L.useEffect(()=>{W?Dre(W).then(R):R("var(--accent-primary)")},[W]),L.useEffect(()=>{const oe=setTimeout(()=>A(!0),50);return()=>clearTimeout(oe)},[]);const U=L.useCallback(()=>{w.length>0&&w[0]&&(i(w,0),o(w[0]),l())},[w,i,o,l]),X=L.useCallback(()=>{if(w.length>0){const oe=Mre(w);oe[0]&&(i(oe,0),o(oe[0]),l())}},[w,i,o,l]),ee=L.useCallback(async()=>{if(w.length===0)return;const oe=Object.entries(f.genrePreferences).sort((ge,ve)=>ve[1].score-ge[1].score)[0],Q={type:"genre",id:(oe==null?void 0:oe[0])||"pop",name:"Made For You",genres:Object.keys(f.genrePreferences).slice(0,3),artwork:W},ce=new Set,me=[...w,...m].filter(ge=>ce.has(ge.id)?!1:(ce.add(ge.id),!0));await a(Q,me)},[w,f,W,m,a]),G=L.useCallback(()=>{N||j(!0)},[N,j]),z=!k&&w.length===0,H=E?"Made For You Radio":n,O=E?"Endless personalized music":N?"Updating your mix...":e;return p.jsxs("section",{className:`discover-hero-section discover-hero-section--centered ${M?"is-visible":""} ${E?"is-radio-active":""}`,style:{"--ambient-color":$},onContextMenu:V?oe=>g(oe,V):void 0,children:[k?p.jsxs("div",{className:"hero-skeleton hero-skeleton--centered",children:[p.jsx("div",{className:"hero-skeleton-artwork hero-skeleton-artwork--centered"}),p.jsxs("div",{className:"hero-skeleton-info hero-skeleton-info--centered",children:[p.jsx("div",{className:"hero-skeleton-badge"}),p.jsx("div",{className:"hero-skeleton-title"}),p.jsx("div",{className:"hero-skeleton-subtitle"}),p.jsx("div",{className:"hero-skeleton-actions"})]})]}):z?p.jsxs("div",{className:"hero-content hero-content--centered",children:[p.jsx("div",{className:"hero-artwork hero-artwork--centered",children:p.jsx("div",{className:"hero-artwork-placeholder",children:p.jsx(Ye,{size:80})})}),p.jsxs("div",{className:"hero-info hero-info--centered",children:[p.jsx("h1",{className:"hero-title hero-title--centered",children:n}),p.jsx("p",{className:"hero-subtitle hero-subtitle--centered",children:"Discover new music"})]})]}):p.jsxs(p.Fragment,{children:[p.jsx("div",{className:"hero-ambient-bg hero-ambient-bg--subtle",style:{backgroundImage:W?`url(${W})`:"none"}}),N&&p.jsx("div",{className:"hero-refresh-indicator",children:p.jsx(Pf,{size:16,className:"spinning"})}),p.jsxs("div",{className:"hero-content hero-content--centered",children:[p.jsxs("div",{className:"hero-artwork hero-artwork--centered",children:[W?p.jsx("img",{src:W,alt:V==null?void 0:V.title}):p.jsx("div",{className:"hero-artwork-placeholder",children:p.jsx(Ye,{size:80})}),E&&p.jsxs("div",{className:"hero-radio-indicator",children:[p.jsx(A0,{size:24}),p.jsx("span",{className:"radio-pulse"})]})]}),p.jsxs("div",{className:"hero-info hero-info--centered",children:[s&&p.jsx("span",{className:"hero-badge hero-badge--centered",children:E?"Live Radio":"Made for You"}),p.jsx("h1",{className:"hero-title hero-title--centered",children:H}),O&&p.jsx("p",{className:"hero-subtitle hero-subtitle--centered",children:O}),p.jsxs("div",{className:"hero-track-info",children:[p.jsxs("span",{children:[w.length," tracks"]}),p.jsx("span",{className:"hero-dot",children:""}),p.jsx("span",{children:"Updates as you listen"})]}),p.jsxs("div",{className:"hero-actions hero-actions--centered",children:[p.jsxs("button",{className:"hero-play-btn hero-play-btn--pill",onClick:U,children:[p.jsx(At,{size:20}),p.jsx("span",{children:"Play"})]}),p.jsxs("button",{className:"hero-shuffle-btn hero-shuffle-btn--pill",onClick:X,children:[p.jsx(Dl,{size:18}),p.jsx("span",{children:"Shuffle"})]}),p.jsxs("button",{className:`hero-radio-btn hero-radio-btn--pill ${E?"active":""}`,onClick:ee,title:"Start endless personalized radio",children:[p.jsx(A0,{size:18}),p.jsx("span",{children:"Radio"})]}),p.jsx("button",{className:"hero-refresh-btn",onClick:G,disabled:N,title:"Refresh mix",children:p.jsx(Pf,{size:16,className:N?"spinning":""})})]})]})]})]}),p.jsx("style",{children:`
        /* ============================================
           HeroSection - Made For You / Ever-Evolving Radio
           Centered layout with ambient glow effects
           Uses CSS variables for full theming support
           ============================================ */

        /* Container - centered flexbox layout */
        .discover-hero-section--centered {
          position: relative;
          width: 100%;
          min-height: 280px;
          display: flex;
          align-items: center;
          justify-content: center;
          overflow: hidden;
          border-radius: var(--radius-xl, 16px);
          background: var(--surface-primary);
          border: 1px solid var(--border-subtle, transparent);
          transition: border-color 0.3s ease;
        }

        /* Radio active state - accent border glow */
        .discover-hero-section--centered.is-radio-active {
          border-color: var(--accent-primary);
          box-shadow: 0 0 20px color-mix(in srgb, var(--accent-primary) 20%, transparent);
        }

        /* Subtle ambient background - LOW opacity */
        .discover-hero-section--centered .hero-ambient-bg--subtle {
          position: absolute;
          inset: 0;
          background-size: cover;
          background-position: center;
          filter: blur(80px) saturate(1.2);
          opacity: 0;
          transform: scale(1.2);
          transition: opacity 0.6s ease-out;
        }

        .discover-hero-section--centered .hero-ambient-bg--subtle::after {
          content: '';
          position: absolute;
          inset: 0;
          background: linear-gradient(
            to bottom,
            color-mix(in srgb, var(--bg-primary) 60%, transparent) 0%,
            color-mix(in srgb, var(--bg-primary) 40%, transparent) 50%,
            color-mix(in srgb, var(--bg-primary) 70%, transparent) 100%
          );
        }

        .discover-hero-section--centered.is-visible .hero-ambient-bg--subtle {
          opacity: 0.25;
        }

        /* Refresh indicator */
        .discover-hero-section--centered .hero-refresh-indicator {
          position: absolute;
          top: 12px;
          right: 12px;
          z-index: 10;
          display: flex;
          align-items: center;
          gap: 6px;
          padding: 6px 10px;
          font-size: 11px;
          color: var(--text-secondary);
          background: color-mix(in srgb, var(--surface-secondary) 80%, transparent);
          border-radius: var(--radius-full, 9999px);
          backdrop-filter: blur(8px);
        }

        /* Centered content layout */
        .discover-hero-section--centered .hero-content--centered {
          position: relative;
          z-index: 1;
          display: flex;
          flex-direction: column;
          align-items: center;
          text-align: center;
          padding: var(--spacing-2xl, 32px);
          gap: var(--spacing-lg, 20px);
        }

        /* Compact artwork with soft ambient glow */
        .discover-hero-section--centered .hero-artwork--centered {
          width: 160px;
          height: 160px;
          border-radius: var(--radius-lg, 12px);
          overflow: hidden;
          position: relative;
          opacity: 0;
          transform: translateY(20px) scale(0.95);
          transition: opacity 0.5s ease-out, transform 0.5s ease-out, box-shadow 0.5s ease-out;
          box-shadow:
            0 6px 24px var(--shadow-color, rgba(0, 0, 0, 0.4)),
            0 0 40px var(--ambient-color, var(--accent-primary));
        }

        .discover-hero-section--centered.is-visible .hero-artwork--centered {
          opacity: 1;
          transform: translateY(0) scale(1);
          box-shadow:
            0 8px 32px var(--shadow-color, rgba(0, 0, 0, 0.5)),
            0 0 50px color-mix(in srgb, var(--ambient-color, var(--accent-primary)) 35%, transparent);
        }

        .discover-hero-section--centered .hero-artwork--centered img {
          width: 100%;
          height: 100%;
          object-fit: cover;
          display: block;
        }

        .discover-hero-section--centered .hero-artwork-placeholder {
          width: 100%;
          height: 100%;
          display: flex;
          align-items: center;
          justify-content: center;
          background: var(--surface-secondary);
          color: var(--text-muted);
        }

        /* Radio indicator overlay on artwork */
        .discover-hero-section--centered .hero-radio-indicator {
          position: absolute;
          bottom: 8px;
          right: 8px;
          display: flex;
          align-items: center;
          justify-content: center;
          width: 40px;
          height: 40px;
          background: var(--accent-primary);
          color: var(--text-on-accent, #fff);
          border-radius: 50%;
          box-shadow: 0 2px 8px color-mix(in srgb, var(--accent-primary) 50%, transparent);
        }

        .discover-hero-section--centered .hero-radio-indicator .radio-pulse {
          position: absolute;
          inset: -4px;
          border: 2px solid var(--accent-primary);
          border-radius: 50%;
          animation: radio-pulse 1.5s ease-out infinite;
        }

        @keyframes radio-pulse {
          0% {
            transform: scale(1);
            opacity: 0.8;
          }
          100% {
            transform: scale(1.4);
            opacity: 0;
          }
        }

        /* Centered info section */
        .discover-hero-section--centered .hero-info--centered {
          display: flex;
          flex-direction: column;
          align-items: center;
          gap: var(--spacing-sm, 8px);
          max-width: 400px;
        }

        /* Made for You badge */
        .discover-hero-section--centered .hero-badge--centered {
          display: inline-flex;
          align-items: center;
          padding: 6px 14px;
          font-size: 11px;
          font-weight: 600;
          text-transform: uppercase;
          letter-spacing: 0.08em;
          color: var(--text-primary);
          background: linear-gradient(
            135deg,
            color-mix(in srgb, var(--accent-primary) 30%, transparent),
            color-mix(in srgb, var(--accent-primary) 15%, transparent)
          );
          border: 1px solid color-mix(in srgb, var(--accent-primary) 40%, transparent);
          border-radius: var(--radius-full, 9999px);
          backdrop-filter: blur(8px);
          opacity: 0;
          transform: translateY(10px);
          transition: opacity 0.4s ease-out, transform 0.4s ease-out;
        }

        .discover-hero-section--centered.is-visible .hero-badge--centered {
          opacity: 1;
          transform: translateY(0);
          transition-delay: 150ms;
        }

        /* Clean title typography - 24px bold */
        .discover-hero-section--centered .hero-title--centered {
          font-size: 24px;
          font-weight: 700;
          letter-spacing: -0.02em;
          line-height: 1.2;
          color: var(--text-primary);
          margin: 0;
          opacity: 0;
          transform: translateY(10px);
          transition: opacity 0.4s ease-out, transform 0.4s ease-out;
        }

        .discover-hero-section--centered.is-visible .hero-title--centered {
          opacity: 1;
          transform: translateY(0);
          transition-delay: 200ms;
        }

        /* Subtitle - 14px muted */
        .discover-hero-section--centered .hero-subtitle--centered {
          font-size: 14px;
          color: var(--text-secondary);
          margin: 0;
          line-height: 1.5;
          opacity: 0;
          transform: translateY(10px);
          transition: opacity 0.4s ease-out, transform 0.4s ease-out;
        }

        .discover-hero-section--centered.is-visible .hero-subtitle--centered {
          opacity: 1;
          transform: translateY(0);
          transition-delay: 250ms;
        }

        /* Track info line */
        .discover-hero-section--centered .hero-track-info {
          display: flex;
          align-items: center;
          gap: 8px;
          font-size: 12px;
          color: var(--text-muted);
          opacity: 0;
          transform: translateY(10px);
          transition: opacity 0.4s ease-out, transform 0.4s ease-out;
        }

        .discover-hero-section--centered.is-visible .hero-track-info {
          opacity: 1;
          transform: translateY(0);
          transition-delay: 275ms;
        }

        .discover-hero-section--centered .hero-dot {
          font-size: 8px;
        }

        /* Pill-style action buttons - horizontal layout */
        .discover-hero-section--centered .hero-actions--centered {
          display: flex;
          align-items: center;
          justify-content: center;
          gap: var(--spacing-sm, 12px);
          margin-top: var(--spacing-md, 16px);
          opacity: 0;
          transform: translateY(10px);
          transition: opacity 0.4s ease-out, transform 0.4s ease-out;
          flex-wrap: wrap;
        }

        .discover-hero-section--centered.is-visible .hero-actions--centered {
          opacity: 1;
          transform: translateY(0);
          transition-delay: 300ms;
        }

        /* Play button - pill shape, accent color */
        .discover-hero-section--centered .hero-play-btn--pill {
          display: inline-flex;
          align-items: center;
          justify-content: center;
          gap: 8px;
          padding: 12px 28px;
          font-size: 14px;
          font-weight: 600;
          color: var(--text-on-accent, #fff);
          background: var(--accent-primary);
          border: none;
          border-radius: var(--radius-full, 9999px);
          cursor: pointer;
          transition: all 0.2s ease-out;
          box-shadow: 0 4px 16px color-mix(in srgb, var(--accent-primary) 40%, transparent);
        }

        .discover-hero-section--centered .hero-play-btn--pill:hover {
          transform: scale(1.04);
          filter: brightness(1.1);
          box-shadow: 0 6px 24px color-mix(in srgb, var(--accent-primary) 50%, transparent);
        }

        .discover-hero-section--centered .hero-play-btn--pill:active {
          transform: scale(0.98);
        }

        /* Shuffle button - pill shape, transparent */
        .discover-hero-section--centered .hero-shuffle-btn--pill {
          display: inline-flex;
          align-items: center;
          justify-content: center;
          gap: 8px;
          padding: 12px 24px;
          font-size: 14px;
          font-weight: 500;
          color: var(--text-primary);
          background: transparent;
          border: 1px solid var(--border-default);
          border-radius: var(--radius-full, 9999px);
          cursor: pointer;
          transition: all 0.2s ease-out;
        }

        .discover-hero-section--centered .hero-shuffle-btn--pill:hover {
          background: var(--surface-hover);
          border-color: var(--border-hover);
          transform: scale(1.02);
        }

        .discover-hero-section--centered .hero-shuffle-btn--pill:active {
          transform: scale(0.98);
        }

        /* Radio button - pill shape */
        .discover-hero-section--centered .hero-radio-btn--pill {
          display: inline-flex;
          align-items: center;
          justify-content: center;
          gap: 8px;
          padding: 12px 24px;
          font-size: 14px;
          font-weight: 500;
          color: var(--text-primary);
          background: transparent;
          border: 1px solid var(--border-default);
          border-radius: var(--radius-full, 9999px);
          cursor: pointer;
          transition: all 0.2s ease-out;
        }

        .discover-hero-section--centered .hero-radio-btn--pill:hover {
          background: var(--surface-hover);
          border-color: var(--accent-primary);
          color: var(--accent-primary);
          transform: scale(1.02);
        }

        .discover-hero-section--centered .hero-radio-btn--pill.active {
          background: color-mix(in srgb, var(--accent-primary) 15%, transparent);
          border-color: var(--accent-primary);
          color: var(--accent-primary);
        }

        .discover-hero-section--centered .hero-radio-btn--pill:active {
          transform: scale(0.98);
        }

        /* Refresh button - icon only */
        .discover-hero-section--centered .hero-refresh-btn {
          display: inline-flex;
          align-items: center;
          justify-content: center;
          width: 36px;
          height: 36px;
          padding: 0;
          color: var(--text-muted);
          background: transparent;
          border: 1px solid var(--border-subtle);
          border-radius: 50%;
          cursor: pointer;
          transition: all 0.2s ease-out;
        }

        .discover-hero-section--centered .hero-refresh-btn:hover:not(:disabled) {
          background: var(--surface-hover);
          border-color: var(--border-default);
          color: var(--text-primary);
        }

        .discover-hero-section--centered .hero-refresh-btn:disabled {
          opacity: 0.5;
          cursor: not-allowed;
        }

        .discover-hero-section--centered .hero-refresh-btn .spinning {
          animation: spin 1s linear infinite;
        }

        @keyframes spin {
          from { transform: rotate(0deg); }
          to { transform: rotate(360deg); }
        }

        /* Skeleton loading state - centered */
        .discover-hero-section--centered .hero-skeleton--centered {
          display: flex;
          flex-direction: column;
          align-items: center;
          gap: var(--spacing-lg, 20px);
          padding: var(--spacing-2xl, 32px);
        }

        .discover-hero-section--centered .hero-skeleton-artwork--centered {
          width: 160px;
          height: 160px;
          border-radius: var(--radius-lg, 12px);
          background: linear-gradient(
            90deg,
            var(--skeleton-base, rgba(255, 255, 255, 0.05)) 0%,
            var(--skeleton-highlight, rgba(255, 255, 255, 0.1)) 50%,
            var(--skeleton-base, rgba(255, 255, 255, 0.05)) 100%
          );
          background-size: 200% 100%;
          animation: shimmer 1.5s infinite;
        }

        .discover-hero-section--centered .hero-skeleton-info--centered {
          display: flex;
          flex-direction: column;
          align-items: center;
          gap: var(--spacing-sm, 8px);
        }

        .discover-hero-section--centered .hero-skeleton-badge {
          width: 100px;
          height: 24px;
          border-radius: var(--radius-full, 9999px);
          background: linear-gradient(
            90deg,
            var(--skeleton-base, rgba(255, 255, 255, 0.05)) 0%,
            var(--skeleton-highlight, rgba(255, 255, 255, 0.1)) 50%,
            var(--skeleton-base, rgba(255, 255, 255, 0.05)) 100%
          );
          background-size: 200% 100%;
          animation: shimmer 1.5s infinite;
        }

        .discover-hero-section--centered .hero-skeleton-title {
          width: 220px;
          height: 38px;
          border-radius: var(--radius-sm, 6px);
          background: linear-gradient(
            90deg,
            var(--skeleton-base, rgba(255, 255, 255, 0.05)) 0%,
            var(--skeleton-highlight, rgba(255, 255, 255, 0.1)) 50%,
            var(--skeleton-base, rgba(255, 255, 255, 0.05)) 100%
          );
          background-size: 200% 100%;
          animation: shimmer 1.5s infinite;
          animation-delay: 0.1s;
        }

        .discover-hero-section--centered .hero-skeleton-subtitle {
          width: 160px;
          height: 20px;
          border-radius: var(--radius-sm, 6px);
          background: linear-gradient(
            90deg,
            var(--skeleton-base, rgba(255, 255, 255, 0.05)) 0%,
            var(--skeleton-highlight, rgba(255, 255, 255, 0.1)) 50%,
            var(--skeleton-base, rgba(255, 255, 255, 0.05)) 100%
          );
          background-size: 200% 100%;
          animation: shimmer 1.5s infinite;
          animation-delay: 0.2s;
        }

        .discover-hero-section--centered .hero-skeleton-actions {
          width: 200px;
          height: 44px;
          border-radius: var(--radius-full, 9999px);
          margin-top: var(--spacing-md, 16px);
          background: linear-gradient(
            90deg,
            var(--skeleton-base, rgba(255, 255, 255, 0.05)) 0%,
            var(--skeleton-highlight, rgba(255, 255, 255, 0.1)) 50%,
            var(--skeleton-base, rgba(255, 255, 255, 0.05)) 100%
          );
          background-size: 200% 100%;
          animation: shimmer 1.5s infinite;
          animation-delay: 0.3s;
        }

        @keyframes shimmer {
          0% { background-position: 200% 0; }
          100% { background-position: -200% 0; }
        }

        /* Responsive adjustments */
        @media (max-width: 600px) {
          .discover-hero-section--centered {
            min-height: 260px;
          }

          .discover-hero-section--centered .hero-artwork--centered,
          .discover-hero-section--centered .hero-skeleton-artwork--centered {
            width: 140px;
            height: 140px;
          }

          .discover-hero-section--centered .hero-title--centered {
            font-size: 20px;
          }

          .discover-hero-section--centered .hero-actions--centered {
            gap: 8px;
          }

          .discover-hero-section--centered .hero-play-btn--pill,
          .discover-hero-section--centered .hero-shuffle-btn--pill,
          .discover-hero-section--centered .hero-radio-btn--pill {
            padding: 10px 18px;
            font-size: 13px;
          }

          .discover-hero-section--centered .hero-radio-btn--pill span {
            display: none;
          }

          .discover-hero-section--centered .hero-refresh-btn {
            width: 32px;
            height: 32px;
          }
        }

        @media (max-width: 400px) {
          .discover-hero-section--centered .hero-artwork--centered,
          .discover-hero-section--centered .hero-skeleton-artwork--centered {
            width: 120px;
            height: 120px;
          }

          .discover-hero-section--centered .hero-title--centered {
            font-size: 18px;
          }

          .discover-hero-section--centered .hero-shuffle-btn--pill span,
          .discover-hero-section--centered .hero-play-btn--pill span {
            display: none;
          }

          .discover-hero-section--centered .hero-play-btn--pill,
          .discover-hero-section--centered .hero-shuffle-btn--pill {
            padding: 10px 14px;
          }
        }
      `})]})},Hd=({track:n,onClick:e,onContextMenu:t,style:s})=>{var y,w,b;const{currentTrack:r,isPlaying:o}=yt(),{isLiked:i,toggleLike:a}=gs(),l=(r==null?void 0:r.id)===n.id,u=i(n.id),d=((y=n.artwork)==null?void 0:y.medium)??((b=(w=n.album)==null?void 0:w.artwork)==null?void 0:b.medium),f=n.artists.map(k=>k.name).join(", "),m=k=>{k.stopPropagation(),a(n)},g=k=>{t&&t(k,n)};return p.jsxs("div",{className:`track-card ${l?"playing":""}`,onClick:e,onContextMenu:g,style:s,children:[p.jsxs("div",{className:"track-card-artwork",children:[d?p.jsx("img",{src:d,alt:n.title,loading:"lazy"}):p.jsx("div",{className:"track-card-artwork-placeholder",children:p.jsx(Ye,{size:48})}),p.jsx("div",{className:"track-card-overlay",children:p.jsx("button",{className:"track-card-play",children:l&&o?p.jsx(bp,{size:24}):p.jsx(At,{size:24})})})]}),p.jsxs("div",{className:"track-card-info",children:[p.jsx("div",{className:"track-card-title",children:n.title}),p.jsx("div",{className:"track-card-artist",children:f})]}),p.jsx("button",{className:`track-card-like ${u?"liked":""}`,onClick:m,title:u?"Remove from Liked Songs":"Add to Liked Songs",children:u?p.jsx(Ml,{size:16}):p.jsx(Su,{size:16})})]})},db=({title:n,subtitle:e,tracks:t,artists:s,albums:r,isLoading:o,onSeeAll:i})=>{const{play:a,setQueue:l}=yt(),{openArtist:u,openAlbum:d}=on(),{showContextMenu:f}=Pn(),{showContextMenu:m}=ub(),{showContextMenu:g}=Gd(),y=(v,N)=>{t&&(l(t,N),a(v))},w=v=>{u(v.id,v)},b=v=>{d(v.id,v)},k=t&&t.length>0||s&&s.length>0||r&&r.length>0;return!o&&!k?null:p.jsxs("section",{className:"discover-horizontal-section",children:[p.jsxs("div",{className:"discover-section-header",children:[p.jsxs("div",{className:"discover-section-title-row",children:[p.jsx("h2",{className:"discover-section-title",children:n}),e&&p.jsx("span",{className:"discover-section-subtitle",children:e})]}),i&&p.jsx("button",{className:"discover-section-more",onClick:i,children:"See all"})]}),o?p.jsx("div",{className:"discover-horizontal-scroll",children:[1,2,3,4,5,6].map(v=>p.jsx("div",{className:"discover-card-skeleton"},v))}):p.jsxs("div",{className:"discover-horizontal-scroll",children:[t==null?void 0:t.map((v,N)=>p.jsx(Hd,{track:v,onClick:()=>y(v,N),onContextMenu:f},v.id)),s==null?void 0:s.map(v=>p.jsxs("div",{className:"artist-card",onClick:()=>w(v),onContextMenu:N=>m(N,v),children:[p.jsx("div",{className:"artist-card-image",children:v.image?p.jsx("img",{src:v.image,alt:v.name}):p.jsx("div",{className:"artist-card-placeholder",children:p.jsx(Ye,{size:32})})}),p.jsx("div",{className:"artist-card-name",children:v.name}),p.jsx("div",{className:"artist-card-type",children:"Artist"})]},v.id)),r==null?void 0:r.map(v=>p.jsxs("div",{className:"album-card",onClick:()=>b(v),onContextMenu:N=>g(N,v),children:[p.jsx("div",{className:"album-card-image",children:v.artwork?p.jsx("img",{src:v.artwork,alt:v.title}):p.jsx("div",{className:"album-card-placeholder",children:p.jsx(Ye,{size:32})})}),p.jsx("div",{className:"album-card-title",children:v.title}),p.jsx("div",{className:"album-card-artist",children:v.artist})]},v.id))]})]})},Fre=({title:n,subtitle:e,tracks:t=[],isLoading:s,maxItems:r=6})=>{const{play:o,setQueue:i,currentTrack:a,isPlaying:l}=yt(),{showContextMenu:u}=Pn(),d=(t==null?void 0:t.slice(0,r))??[],f=(m,g)=>{i(d,g),o(m)};return!s&&(!t||t.length===0)?null:p.jsxs("section",{className:"discover-large-card-section",children:[p.jsx("div",{className:"discover-section-header",children:p.jsxs("div",{className:"discover-section-title-row",children:[p.jsx("h2",{className:"discover-section-title",children:n}),e&&p.jsx("span",{className:"discover-section-subtitle",children:e})]})}),s?p.jsx("div",{className:"large-card-grid",children:[1,2,3].map(m=>p.jsx("div",{className:"large-card-skeleton"},m))}):p.jsx("div",{className:"large-card-grid",children:d.map((m,g)=>{var b,k,v,N;const y=(a==null?void 0:a.id)===m.id,w=((b=m.artwork)==null?void 0:b.medium)??((v=(k=m.album)==null?void 0:k.artwork)==null?void 0:v.medium);return p.jsxs("div",{className:`large-track-card ${y?"playing":""}`,onClick:()=>f(m,g),onContextMenu:S=>u(S,m),children:[p.jsxs("div",{className:"large-track-artwork",children:[w?p.jsx("img",{src:w,alt:m.title}):p.jsx("div",{className:"large-track-placeholder",children:p.jsx(Ye,{size:48})}),p.jsx("div",{className:"large-track-overlay",children:p.jsx("button",{className:"large-track-play",children:y&&l?p.jsx(bp,{size:28}):p.jsx(At,{size:28})})}),y&&l&&p.jsxs("div",{className:"large-track-playing-badge",children:[p.jsx("span",{className:"playing-bar"}),p.jsx("span",{className:"playing-bar"}),p.jsx("span",{className:"playing-bar"})]})]}),p.jsxs("div",{className:"large-track-info",children:[p.jsx("h3",{className:"large-track-title",children:m.title}),p.jsx("p",{className:"large-track-artist",children:m.artists.map(S=>S.name).join(", ")}),((N=m.album)==null?void 0:N.releaseDate)&&p.jsx("span",{className:"large-track-year",children:m.album.releaseDate.substring(0,4)})]})]},m.id)})})]})},Lre=({title:n,tracks:e=[],isLoading:t,maxItems:s=5})=>{const{play:r,setQueue:o,currentTrack:i,isPlaying:a}=yt(),{showContextMenu:l}=Pn(),u=(e==null?void 0:e.slice(0,s))??[],d=(m,g)=>{o(u,g),r(m)},f=m=>{const g=Math.floor(m/6e4),y=Math.floor(m%6e4/1e3);return`${g}:${y.toString().padStart(2,"0")}`};return!t&&(!e||e.length===0)?null:p.jsxs("section",{className:"discover-compact-section",children:[p.jsx("h2",{className:"discover-section-title",children:n}),t?p.jsx("div",{className:"compact-list-loading",children:[1,2,3,4,5].map(m=>p.jsx("div",{className:"compact-track-skeleton"},m))}):p.jsx("div",{className:"compact-list",children:u.map((m,g)=>{var w;const y=(i==null?void 0:i.id)===m.id;return p.jsxs("div",{className:`compact-track-item ${y?"playing":""}`,onClick:()=>d(m,g),onContextMenu:b=>l(b,m),children:[p.jsxs("div",{className:"compact-track-artwork",children:[(w=m.artwork)!=null&&w.small?p.jsx("img",{src:m.artwork.small,alt:m.title}):p.jsx("div",{className:"compact-track-placeholder",children:p.jsx(Ye,{size:16})}),p.jsx("div",{className:"compact-track-play-overlay",children:y&&a?p.jsxs("div",{className:"compact-playing-indicator",children:[p.jsx("span",{className:"playing-bar"}),p.jsx("span",{className:"playing-bar"}),p.jsx("span",{className:"playing-bar"})]}):p.jsx(At,{size:14})})]}),p.jsxs("div",{className:"compact-track-info",children:[p.jsx("span",{className:"compact-track-title",children:m.title}),p.jsx("span",{className:"compact-track-artist",children:m.artists.map(b=>b.name).join(", ")})]}),p.jsx("span",{className:"compact-track-duration",children:f(m.duration)})]},m.id)})})]})},jre=({title:n,subtitle:e,tracks:t,isLoading:s,isPersonalized:r,maxItems:o=8,onSeeAll:i})=>{const{play:a,setQueue:l}=yt(),{showContextMenu:u}=Pn(),d=(t==null?void 0:t.slice(0,o))||[],f=(m,g)=>{l(d,g),a(m)};return!s&&(!t||t.length===0)?null:p.jsxs("section",{className:`discover-section ${r?"personalized":""}`,children:[p.jsxs("div",{className:"discover-section-header",children:[p.jsxs("div",{className:"discover-section-title-row",children:[p.jsx("h2",{className:"discover-section-title",children:n}),e&&p.jsx("span",{className:"discover-section-subtitle",children:e}),r&&p.jsx("span",{className:"discover-section-personalized-tag",children:"For You"})]}),i&&p.jsx("button",{className:"discover-section-more",onClick:i,children:"See all"})]}),s?p.jsx("div",{className:"discover-section-loading",children:p.jsx("div",{className:"discover-loading-cards",children:[1,2,3,4].map(m=>p.jsx("div",{className:"track-card skeleton",style:{animationDelay:`${m*100}ms`}},m))})}):p.jsx("div",{className:"discover-section-grid",children:d.map((m,g)=>p.jsx(Hd,{track:m,onClick:()=>f(m,g),onContextMenu:u,style:{animationDelay:`${g*50}ms`}},m.id))})]})},Ore=({id:n,title:e,subtitle:t,query:s,onSeeAll:r,isPersonalized:o,maxItems:i=12})=>{const[a,l]=L.useState([]),[u,d]=L.useState(!0),{play:f,setQueue:m}=yt(),{showContextMenu:g}=Pn(),{rankTracks:y}=Yl();L.useEffect(()=>{let k=!0;return(async()=>{var N,S,$;d(!0);try{let R=[];if((N=window.api)!=null&&N.getTrending){const M=await window.api.getTrending();((S=M==null?void 0:M.tracks)==null?void 0:S.length)>0&&(R=M.tracks.slice(0,i*2).map(A=>({...A,streamSources:[],_meta:{metadataProvider:A._provider||"trending",matchConfidence:1,externalIds:A.externalIds||{},lastUpdated:new Date}})))}if(R.length===0&&(($=window.api)!=null&&$.search)){const M=s||"top hits 2024 trending popular";R=(await window.api.search({query:M,type:"track"})||[]).slice(0,i*2)}if(!k)return;if(o&&R.length>0){const M=await y(R,{enabled:!0,explorationMode:"balanced",limit:i,shuffle:!0,shuffleIntensity:.1});l(M.map(A=>A.track))}else{const M=await y(R,{enabled:!0,explorationMode:"explore",limit:i,shuffle:!0,shuffleIntensity:.15});l(M.map(A=>A.track))}}catch(R){console.error("[TrendingTracksSection] Failed to fetch:",R)}finally{k&&d(!1)}})(),()=>{k=!1}},[s,i,o,y]);const w=(k,v)=>{m(a,v),f(k)},b=!u&&a.length===0;return p.jsxs("section",{id:n,className:"discover-horizontal-section discover-trending-section",children:[p.jsxs("div",{className:"discover-section-header",children:[p.jsxs("div",{className:"discover-section-title-row",children:[p.jsx("h2",{className:"discover-section-title",children:e}),t&&p.jsx("span",{className:"discover-section-subtitle",children:t})]}),r&&p.jsx("button",{className:"discover-section-more",onClick:r,children:"See all"})]}),u?p.jsx("div",{className:"discover-horizontal-scroll",children:[1,2,3,4,5,6].map(k=>p.jsx("div",{className:"discover-card-skeleton"},k))}):b?p.jsx("div",{className:"discover-empty-state",children:p.jsx("p",{children:"Unable to load trending tracks"})}):p.jsx("div",{className:"discover-horizontal-scroll",children:a.map((k,v)=>p.jsx(Hd,{track:k,onClick:()=>w(k,v),onContextMenu:g},k.id))})]})},_re=({id:n,title:e,subtitle:t,onSeeAll:s,maxItems:r=10})=>{const[o,i]=L.useState([]),[a,l]=L.useState(!0),{openArtist:u}=on(),{showContextMenu:d}=ub();L.useEffect(()=>{let m=!0;return(async()=>{var y,w,b,k,v,N;l(!0);try{if((y=window.api)!=null&&y.getTrending){const S=await window.api.getTrending();if(m&&((w=S==null?void 0:S.artists)==null?void 0:w.length)>0){const $=S.artists.slice(0,r).map(R=>{var M,A;return{id:R.id,name:R.name,image:((M=R.artwork)==null?void 0:M.medium)||((A=R.artwork)==null?void 0:A.small),source:"trending"}});i($),l(!1);return}}if((b=window.api)!=null&&b.search){const S=await window.api.search({query:"top hits 2024 popular",type:"track"});if(m&&(S==null?void 0:S.length)>0){const $=new Map;for(const R of S){for(const M of R.artists)if($.has(M.id)||$.set(M.id,{id:M.id,name:M.name,image:((k=M.artwork)==null?void 0:k.medium)||((v=M.artwork)==null?void 0:v.small),source:((N=R._meta)==null?void 0:N.metadataProvider)||"search"}),$.size>=r)break;if($.size>=r)break}i(Array.from($.values()))}}}catch(S){console.error("[TrendingArtistsSection] Failed to fetch:",S)}finally{m&&l(!1)}})(),()=>{m=!1}},[r]);const f=m=>{u(m.id,{id:m.id,name:m.name,image:m.image,source:m.source})};return!a&&o.length===0?null:p.jsxs("section",{id:n,className:"discover-horizontal-section discover-trending-artists-section",children:[p.jsxs("div",{className:"discover-section-header",children:[p.jsxs("div",{className:"discover-section-title-row",children:[p.jsx("h2",{className:"discover-section-title",children:e}),t&&p.jsx("span",{className:"discover-section-subtitle",children:t})]}),s&&p.jsx("button",{className:"discover-section-more",onClick:s,children:"See all"})]}),a?p.jsx("div",{className:"discover-horizontal-scroll",children:[1,2,3,4,5,6].map(m=>p.jsx("div",{className:"artist-card-skeleton circular"},m))}):p.jsx("div",{className:"discover-horizontal-scroll",children:o.map(m=>p.jsxs("div",{className:"artist-card circular",onClick:()=>f(m),onContextMenu:g=>d(g,{id:m.id,name:m.name,image:m.image,source:m.source}),children:[p.jsx("div",{className:"artist-card-image",children:m.image?p.jsx("img",{src:m.image,alt:m.name}):p.jsx("div",{className:"artist-card-placeholder",children:p.jsx(Ye,{size:32})})}),p.jsx("div",{className:"artist-card-name",children:m.name}),p.jsx("div",{className:"artist-card-type",children:"Artist"})]},m.id))})]})},zre=({id:n,title:e,subtitle:t,context:s,onSeeAll:r,maxItems:o=10})=>{const[i,a]=L.useState([]),[l,u]=L.useState(!0),[d,f]=L.useState(""),{play:m,setQueue:g}=yt(),{showContextMenu:y}=Pn(),{rankTracks:w}=Yl();L.useEffect(()=>{let N=!0;return(async()=>{var R,M,A;u(!0);const $=(R=s==null?void 0:s.topArtists)==null?void 0:R[0];if(!$){u(!1);return}f($);try{let P=[];if((M=window.api)!=null&&M.getRecommendedTracks){const E=await window.api.getRecommendedTracks("artist",$);(E==null?void 0:E.length)>0&&(P=E)}if(P.length===0&&((A=window.api)!=null&&A.search)){const E=`${$} similar music style`;P=(await window.api.search({query:E,type:"track"})||[]).filter(V=>!V.artists.some(W=>W.name.toLowerCase()===$.toLowerCase()))}if(!N||P.length===0){N&&u(!1);return}const D=await w(P,{enabled:!0,explorationMode:"balanced",limit:o,shuffle:!0,shuffleIntensity:.2});N&&a(D.map(E=>E.track))}catch(P){console.error("[ArtistRadioSection] Failed to fetch:",P)}finally{N&&u(!1)}})(),()=>{N=!1}},[s==null?void 0:s.topArtists,o,w]);const b=(N,S)=>{g(i,S),m(N)};if(!d||!l&&i.length===0)return null;const k=e||`More like ${d}`,v=t||"Based on your listening";return p.jsxs("section",{id:n,className:"discover-horizontal-section discover-artist-radio-section",children:[p.jsxs("div",{className:"discover-section-header",children:[p.jsxs("div",{className:"discover-section-title-row",children:[p.jsx("h2",{className:"discover-section-title",children:k}),p.jsx("span",{className:"discover-section-subtitle",children:v}),p.jsx("span",{className:"discover-section-personalized-tag",children:"For You"})]}),r&&p.jsx("button",{className:"discover-section-more",onClick:r,children:"See all"})]}),l?p.jsx("div",{className:"discover-horizontal-scroll",children:[1,2,3,4,5,6].map(N=>p.jsx("div",{className:"discover-card-skeleton"},N))}):p.jsx("div",{className:"discover-horizontal-scroll",children:i.map((N,S)=>p.jsx(Hd,{track:N,onClick:()=>b(N,S),onContextMenu:y},N.id))})]})},OA=({id:n,title:e,context:t,onSeeAll:s,artistIndex:r=0,maxItems:o=8})=>{const[i,a]=L.useState([]),[l,u]=L.useState(!0),[d,f]=L.useState(""),{play:m,setQueue:g}=yt(),{showContextMenu:y}=Pn(),{rankTracks:w}=Yl();L.useEffect(()=>{let v=!0;return(async()=>{var $,R,M;u(!0);const S=($=t==null?void 0:t.topArtists)==null?void 0:$[r];if(!S){u(!1);return}f(S);try{let A=[];if((R=window.api)!=null&&R.getRecommendedTracks){const D=await window.api.getRecommendedTracks("artist",S);(D==null?void 0:D.length)>0&&(A=D)}if(A.length===0&&((M=window.api)!=null&&M.search)){const D=`${S} fans also like similar`;A=await window.api.search({query:D,type:"track"})||[]}if(!v||A.length===0){v&&u(!1);return}const P=await w(A,{enabled:!0,explorationMode:"balanced",limit:o,shuffle:!0,shuffleIntensity:.2});a(P.map(D=>D.track))}catch(A){console.error("[BecauseYouLikeSection] Failed to fetch:",A)}finally{v&&u(!1)}})(),()=>{v=!1}},[t==null?void 0:t.topArtists,r,o,w]);const b=(v,N)=>{g(i,N),m(v)};if(!d||!l&&i.length===0)return null;const k=e||`Because you like ${d}`;return p.jsxs("section",{id:n,className:"discover-horizontal-section discover-because-you-like-section",children:[p.jsxs("div",{className:"discover-section-header",children:[p.jsxs("div",{className:"discover-section-title-row",children:[p.jsx("h2",{className:"discover-section-title",children:k}),p.jsx("span",{className:"discover-section-personalized-tag",children:"For You"})]}),s&&p.jsx("button",{className:"discover-section-more",onClick:s,children:"See all"})]}),l?p.jsx("div",{className:"discover-horizontal-scroll",children:[1,2,3,4,5].map(v=>p.jsx("div",{className:"discover-card-skeleton"},v))}):p.jsx("div",{className:"discover-horizontal-scroll",children:i.map((v,N)=>p.jsx(Hd,{track:v,onClick:()=>b(v,N),onContextMenu:y},v.id))})]})},Bre=({id:n,title:e,subtitle:t,context:s,onSeeAll:r,maxItems:o=10})=>{const[i,a]=L.useState([]),[l,u]=L.useState(!0),{openAlbum:d}=on(),{showContextMenu:f}=Gd();L.useEffect(()=>{let g=!0;return(async()=>{var w,b,k,v,N,S;u(!0);try{if((w=window.api)!=null&&w.search){const $=(b=s==null?void 0:s.topGenres)==null?void 0:b[0],R=$?`${$} new releases 2024`:"new releases 2024 popular",M=await window.api.search({query:R,type:"album"});if(g&&(M==null?void 0:M.length)>0){const A=new Map;for(const P of M){const D=P;if(D.id&&!A.has(D.id)&&A.set(D.id,{id:D.id,title:D.title,artist:((v=(k=D.artists)==null?void 0:k[0])==null?void 0:v.name)||"Unknown Artist",artwork:((N=D.artwork)==null?void 0:N.medium)||((S=D.artwork)==null?void 0:S.small),year:D.releaseDate?parseInt(D.releaseDate.substring(0,4)):void 0,source:"search"}),A.size>=o)break}a(Array.from(A.values()))}}}catch($){console.error("[NewReleasesSection] Failed to fetch:",$)}finally{g&&u(!1)}})(),()=>{g=!1}},[s==null?void 0:s.topGenres,o]);const m=g=>{d(g.id,{id:g.id,title:g.title,artist:g.artist,artwork:g.artwork,year:g.year,source:g.source})};return!l&&i.length===0?null:p.jsxs("section",{id:n,className:"discover-horizontal-section discover-new-releases-section",children:[p.jsxs("div",{className:"discover-section-header",children:[p.jsxs("div",{className:"discover-section-title-row",children:[p.jsx("h2",{className:"discover-section-title",children:e}),t&&p.jsx("span",{className:"discover-section-subtitle",children:t})]}),r&&p.jsx("button",{className:"discover-section-more",onClick:r,children:"See all"})]}),l?p.jsx("div",{className:"discover-horizontal-scroll",children:[1,2,3,4,5,6].map(g=>p.jsx("div",{className:"album-card-skeleton"},g))}):p.jsx("div",{className:"discover-horizontal-scroll",children:i.map(g=>p.jsxs("div",{className:"album-card",onClick:()=>m(g),onContextMenu:y=>f(y,{id:g.id,title:g.title,artist:g.artist,artwork:g.artwork,year:g.year,source:g.source}),children:[p.jsxs("div",{className:"album-card-image",children:[g.artwork?p.jsx("img",{src:g.artwork,alt:g.title}):p.jsx("div",{className:"album-card-placeholder",children:p.jsx(Ye,{size:32})}),g.year&&g.year>=new Date().getFullYear()&&p.jsx("span",{className:"album-new-badge",children:"NEW"})]}),p.jsx("div",{className:"album-card-title",children:g.title}),p.jsx("div",{className:"album-card-artist",children:g.artist})]},g.id))})]})},Vre=({id:n,title:e,subtitle:t,query:s,onSeeAll:r,maxItems:o=10})=>{const[i,a]=L.useState([]),[l,u]=L.useState(!0),{play:d,setQueue:f,currentTrack:m,isPlaying:g}=yt(),{showContextMenu:y}=Pn();L.useEffect(()=>{let v=!0;return(async()=>{var S,$,R;u(!0);try{if((S=window.api)!=null&&S.getTrending){const M=await window.api.getTrending();if(v&&(($=M==null?void 0:M.tracks)==null?void 0:$.length)>0){const A=M.tracks.slice(0,o).map(P=>({...P,streamSources:[],_meta:{metadataProvider:P._provider||"chart",matchConfidence:1,externalIds:P.externalIds||{},lastUpdated:new Date}}));a(A),u(!1);return}}if((R=window.api)!=null&&R.search){const M=s||"chart top 50 2024",A=await window.api.search({query:M,type:"track"});v&&a((A||[]).slice(0,o))}}catch(M){console.error("[ChartListSection] Failed to fetch:",M)}finally{v&&u(!1)}})(),()=>{v=!1}},[s,o]);const w=(v,N)=>{f(i,N),d(v)},b=v=>{if(!v)return"--:--";const N=Math.floor(v/1e3),S=Math.floor(N/60),$=N%60;return`${S}:${$.toString().padStart(2,"0")}`},k=!l&&i.length===0;return p.jsxs("section",{id:n,className:"chart-list-section",children:[p.jsxs("div",{className:"discover-section-header",children:[p.jsxs("div",{className:"discover-section-title-row",children:[p.jsx("h2",{className:"discover-section-title",children:e}),t&&p.jsx("span",{className:"discover-section-subtitle",children:t})]}),r&&p.jsx("button",{className:"discover-section-more",onClick:r,children:"See all"})]}),l?p.jsx("div",{className:"chart-list",children:Array.from({length:o}).map((v,N)=>p.jsxs("div",{className:"chart-item-skeleton",children:[p.jsx("div",{className:"skeleton-rank"}),p.jsx("div",{className:"skeleton-artwork"}),p.jsxs("div",{className:"skeleton-info",children:[p.jsx("div",{className:"skeleton-title"}),p.jsx("div",{className:"skeleton-artist"})]})]},N))}):k?p.jsx("div",{className:"discover-empty-state",children:p.jsx("p",{children:"Unable to load chart data"})}):p.jsx("div",{className:"chart-list",children:i.map((v,N)=>{var M,A,P;const S=(m==null?void 0:m.id)===v.id,$=S&&g,R=((M=v.artwork)==null?void 0:M.small)||((P=(A=v.album)==null?void 0:A.artwork)==null?void 0:P.small);return p.jsxs("div",{className:`chart-item ${S?"playing":""}`,onClick:()=>w(v,N),onContextMenu:D=>y(D,v),children:[p.jsx("span",{className:"chart-rank",children:N+1}),p.jsxs("div",{className:"chart-artwork",children:[R?p.jsx("img",{src:R,alt:v.title,loading:"lazy"}):p.jsx("div",{className:"chart-artwork-placeholder",children:p.jsx(Ye,{size:20})}),$&&p.jsxs("div",{className:"chart-playing-indicator",children:[p.jsx("span",{className:"bar"}),p.jsx("span",{className:"bar"}),p.jsx("span",{className:"bar"})]})]}),p.jsxs("div",{className:"chart-info",children:[p.jsxs("div",{className:"chart-title",children:[v.title,v.explicit&&p.jsx("span",{className:"chart-explicit",children:"E"})]}),p.jsx("div",{className:"chart-artist",children:v.artists.map(D=>D.name).join(", ")})]}),p.jsx("span",{className:"chart-duration",children:b(v.duration)})]},v.id)})})]})},Wre=({id:n,title:e,context:t,maxItems:s=6})=>{const[r,o]=L.useState([]),[i,a]=L.useState(!0),{play:l,setQueue:u,currentTrack:d,isPlaying:f}=yt(),{showContextMenu:m}=Pn(),{rankTracks:g}=Yl();L.useEffect(()=>{let b=!0;return(async()=>{var v;a(!0);try{const N=(t==null?void 0:t.topArtists)||[],S=[];N.length>0&&N.slice(0,3).forEach(A=>{S.push(`${A} best songs`)}),S.push("top hits 2024","trending music");const $=[];if((v=window.api)!=null&&v.search)for(const A of S.slice(0,2))try{const P=await window.api.search({query:A,type:"track"});(P==null?void 0:P.length)>0&&$.push(...P.slice(0,6))}catch{}if(!b||$.length===0){b&&a(!1);return}const R=$.filter((A,P,D)=>P===D.findIndex(E=>E.id===A.id)),M=await g(R,{enabled:!0,explorationMode:"exploit",limit:s,shuffle:!0,shuffleIntensity:.15});b&&o(M.map(A=>A.track))}catch(N){console.error("[QuickPicksSection] Failed to fetch:",N)}finally{b&&a(!1)}})(),()=>{b=!1}},[t==null?void 0:t.topArtists,s,g]);const y=(b,k)=>{u(r,k),l(b)};return!i&&r.length===0?null:p.jsxs("section",{id:n,className:"quick-picks-section",children:[e&&p.jsx("div",{className:"discover-section-header",children:p.jsx("h2",{className:"discover-section-title",children:e})}),i?p.jsx("div",{className:"quick-picks-grid",children:Array.from({length:s}).map((b,k)=>p.jsx("div",{className:"quick-pick-skeleton"},k))}):p.jsx("div",{className:"quick-picks-grid",children:r.map((b,k)=>{var $,R,M;const v=(d==null?void 0:d.id)===b.id,N=v&&f,S=(($=b.artwork)==null?void 0:$.small)||((M=(R=b.album)==null?void 0:R.artwork)==null?void 0:M.small);return p.jsxs("div",{className:`quick-pick-tile ${v?"playing":""}`,onClick:()=>y(b,k),onContextMenu:A=>m(A,b),children:[p.jsxs("div",{className:"quick-pick-artwork",children:[S?p.jsx("img",{src:S,alt:b.title,loading:"lazy"}):p.jsx("div",{className:"quick-pick-artwork-placeholder",children:p.jsx(Ye,{size:20})}),N&&p.jsxs("div",{className:"quick-pick-playing",children:[p.jsx("span",{className:"bar"}),p.jsx("span",{className:"bar"}),p.jsx("span",{className:"bar"})]})]}),p.jsx("div",{className:"quick-pick-info",children:p.jsx("span",{className:"quick-pick-title",children:b.title})})]},b.id)})})]})},Ure=({id:n,title:e,subtitle:t,isPersonalized:s,context:r,artist:o,artistName:i})=>{const{play:a,setQueue:l,currentTrack:u,isPlaying:d}=yt(),{openArtist:f}=on(),{showContextMenu:m}=Pn(),{getTopArtists:g}=On(),[y,w]=L.useState(o??null),[b,k]=L.useState(!o),[v,N]=L.useState(null),S=i??g(1)[0];L.useEffect(()=>{if(o||!S)return;(async()=>{var P,D;k(!0),N(null);try{if(window.api){const j=(await window.api.search({query:S,type:"track"})).filter(W=>W.artists.some(U=>U.name.toLowerCase().includes(S.toLowerCase()))).slice(0,5),V=j[0];if(V&&j.length>0){const W=V.artists[0];W&&w({id:W.id||S.toLowerCase().replace(/\s+/g,"-"),name:W.name,image:((P=V.artwork)==null?void 0:P.large)??((D=V.artwork)==null?void 0:D.medium),topTracks:j,relatedArtists:[]})}}}catch(E){console.error("[ArtistSpotlight] Failed to fetch artist:",E),N("Failed to load artist")}finally{k(!1)}})()},[o,S]);const $=A=>{y&&(l(y.topTracks,y.topTracks.indexOf(A)),a(A))},R=()=>{const A=y==null?void 0:y.topTracks[0];!y||!A||(l(y.topTracks,0),a(A))},M=()=>{y&&f(y.id,{id:y.id,name:y.name,image:y.image,source:"spotlight"})};return!b&&!y?null:p.jsx(Nu,{id:n,type:"artist-spotlight",title:e,subtitle:t,isPersonalized:s,isLoading:b,error:v,context:r,showHeader:!1,className:"artist-spotlight-section",children:y&&p.jsxs("div",{className:"spotlight-container",children:[p.jsxs("div",{className:"spotlight-hero",children:[p.jsxs("div",{className:"spotlight-image",children:[y.image?p.jsx("img",{src:y.image,alt:y.name}):p.jsx("div",{className:"spotlight-image-placeholder",children:p.jsx(u2,{size:64})}),p.jsx("div",{className:"spotlight-image-gradient"})]}),p.jsxs("div",{className:"spotlight-info",children:[p.jsx("span",{className:"spotlight-label",children:"Artist Spotlight"}),p.jsx("h2",{className:"spotlight-name",children:y.name}),y.monthlyListeners&&p.jsxs("p",{className:"spotlight-listeners",children:[Hre(y.monthlyListeners)," monthly listeners"]}),y.bio&&p.jsx("p",{className:"spotlight-bio",children:Kre(y.bio,150)}),p.jsxs("div",{className:"spotlight-actions",children:[p.jsxs("button",{className:"spotlight-play",onClick:R,children:[p.jsx(At,{size:20}),p.jsx("span",{children:"Play"})]}),p.jsx("button",{className:"spotlight-view",onClick:M,children:"View Artist"})]})]})]}),p.jsxs("div",{className:"spotlight-tracks",children:[p.jsx("h3",{className:"spotlight-tracks-title",children:"Popular Tracks"}),p.jsx("div",{className:"spotlight-tracks-list",children:y.topTracks.map((A,P)=>p.jsx(Gre,{track:A,index:P,isPlaying:(u==null?void 0:u.id)===A.id&&d,onClick:()=>$(A),onContextMenu:D=>m(D,A)},A.id))})]}),y.relatedArtists&&y.relatedArtists.length>0&&p.jsxs("div",{className:"spotlight-related",children:[p.jsx("h3",{className:"spotlight-related-title",children:"Similar Artists"}),p.jsx("div",{className:"spotlight-related-list",children:y.relatedArtists.slice(0,4).map(A=>p.jsxs("div",{className:"related-artist",children:[p.jsx("div",{className:"related-artist-image",children:A.image?p.jsx("img",{src:A.image,alt:A.name}):p.jsx(u2,{size:24})}),p.jsx("span",{className:"related-artist-name",children:A.name})]},A.id))})]})]})})},Gre=({track:n,index:e,isPlaying:t,onClick:s,onContextMenu:r})=>{var i;const o=(i=n.artwork)==null?void 0:i.small;return p.jsxs("div",{className:`spotlight-track ${t?"playing":""}`,onClick:s,onContextMenu:r,children:[p.jsx("span",{className:"track-number",children:e+1}),p.jsxs("div",{className:"track-artwork",children:[o?p.jsx("img",{src:o,alt:n.title}):p.jsx(Ye,{size:16}),t&&p.jsxs("div",{className:"track-playing",children:[p.jsx("span",{className:"playing-bar"}),p.jsx("span",{className:"playing-bar"}),p.jsx("span",{className:"playing-bar"})]})]}),p.jsx("div",{className:"track-info",children:p.jsx("span",{className:"track-title",children:n.title})}),p.jsx("span",{className:"track-duration",children:qre(n.duration)})]})};function Hre(n){return n>=1e6?(n/1e6).toFixed(1)+"M":n>=1e3?(n/1e3).toFixed(1)+"K":n.toString()}function qre(n){const e=Math.floor(n/60),t=n%60;return`${e}:${t.toString().padStart(2,"0")}`}function Kre(n,e){return n.length<=e?n:n.slice(0,e).trim()+"..."}const yo={"very-low":"var(--color-energy-calm)",low:"var(--color-energy-chill)",medium:"var(--color-energy-balanced)",high:"var(--color-energy-upbeat)","very-high":"var(--color-energy-intense)"},Af={"very-low":"Calm",low:"Chill",medium:"Balanced",high:"Upbeat","very-high":"Intense"},Xre=({id:n,title:e,subtitle:t,query:s,isPersonalized:r,context:o,tracks:i,onSeeAll:a})=>{const{play:l,setQueue:u,currentTrack:d,isPlaying:f}=yt(),{showContextMenu:m}=Pn(),{sortTracksByEnergy:g}=On(),{tracks:y,isLoading:w,error:b}=QS(i?void 0:s,{limit:10}),k=i??y,v=L.useMemo(()=>g(k,"asc").map(S=>({track:S,mood:Ff(S)})),[k,g]),N=S=>{const $=v.map(R=>R.track);u($,$.indexOf(S)),l(S)};return!w&&k.length===0?null:p.jsx(Nu,{id:n,type:"mood-gradient",title:e,subtitle:t,isPersonalized:r,isLoading:w,error:b,context:o,onSeeAll:a,className:"mood-gradient-section",children:p.jsxs("div",{className:"mood-gradient-container",children:[p.jsxs("div",{className:"mood-gradient-bar",children:[p.jsx("div",{className:"mood-gradient-background",style:{background:`linear-gradient(90deg, ${yo["very-low"]} 0%, ${yo.low} 25%, ${yo.medium} 50%, ${yo.high} 75%, ${yo["very-high"]} 100%)`}}),p.jsx("div",{className:"mood-track-container",children:v.map(({track:S,mood:$},R)=>p.jsx(Qre,{track:S,energyLevel:$.energyLevel,index:R,totalTracks:v.length,isPlaying:(d==null?void 0:d.id)===S.id&&f,onClick:()=>N(S),onContextMenu:M=>m(M,S)},S.id))})]}),p.jsxs("div",{className:"mood-gradient-labels",children:[p.jsx("span",{className:"mood-label",style:{color:yo["very-low"]},children:Af["very-low"]}),p.jsx("span",{className:"mood-label",style:{color:yo.medium},children:Af.medium}),p.jsx("span",{className:"mood-label",style:{color:yo["very-high"]},children:Af["very-high"]})]})]})})},Qre=({track:n,energyLevel:e,index:t,totalTracks:s,isPlaying:r,onClick:o,onContextMenu:i})=>{var g,y;const a=((g=n.artwork)==null?void 0:g.small)??((y=n.artwork)==null?void 0:y.medium),l=yo[e],u=4,d=100-u*2,f=u+t/Math.max(s-1,1)*d,m=Math.sin(t/Math.max(s-1,1)*Math.PI*2)*18;return p.jsxs("div",{className:`mood-card ${r?"playing":""}`,style:{left:`${f}%`,transform:`translateX(-50%) translateY(${m}px)`,"--card-color":l,animationDelay:`${t*60}ms`},onClick:o,onContextMenu:i,children:[p.jsx("div",{className:"mood-card-glow",style:{background:`radial-gradient(circle, ${l}50 0%, transparent 70%)`}}),p.jsxs("div",{className:"mood-card-artwork",children:[a?p.jsx("img",{src:a,alt:n.title,loading:"lazy"}):p.jsx("div",{className:"mood-card-placeholder",children:p.jsx(Ye,{size:24})}),p.jsx("div",{className:"mood-card-overlay",children:p.jsx(At,{size:20})}),r&&p.jsxs("div",{className:"mood-card-playing",children:[p.jsx("span",{className:"playing-bar"}),p.jsx("span",{className:"playing-bar"}),p.jsx("span",{className:"playing-bar"})]})]}),p.jsxs("div",{className:"mood-card-info",children:[p.jsx("span",{className:"mood-card-title",children:n.title}),p.jsx("span",{className:"mood-card-energy",style:{color:l},children:Af[e]})]})]})},us={rock:"var(--color-genre-rock)",pop:"var(--color-genre-pop)",hiphop:"var(--color-genre-hiphop)",electronic:"var(--color-genre-electronic)",rnb:"var(--color-genre-rnb)",jazz:"var(--color-genre-jazz)",classical:"var(--color-genre-classical)",country:"var(--color-genre-country)",latin:"var(--color-genre-latin)",metal:"var(--color-genre-metal)",folk:"var(--color-genre-folk)",blues:"var(--color-genre-blues)",reggae:"var(--color-genre-reggae)",world:"var(--color-genre-world)",ambient:"var(--color-genre-ambient)"},_A={root:[{id:"pop",name:"Pop",color:us.pop,searchQuery:"pop music",children:[{id:"synth-pop",name:"Synth Pop",color:"#a855f7",searchQuery:"synth pop"},{id:"dance-pop",name:"Dance Pop",color:"#c084fc",searchQuery:"dance pop"},{id:"indie-pop",name:"Indie Pop",color:"#d8b4fe",searchQuery:"indie pop"},{id:"k-pop",name:"K-Pop",color:"#e879f9",searchQuery:"k-pop"},{id:"j-pop",name:"J-Pop",color:"#f0abfc",searchQuery:"j-pop"},{id:"art-pop",name:"Art Pop",color:"#f5d0fe",searchQuery:"art pop"}]},{id:"rock",name:"Rock",color:us.rock,searchQuery:"rock music",children:[{id:"indie-rock",name:"Indie Rock",color:"#ef4444",searchQuery:"indie rock"},{id:"alt-rock",name:"Alternative",color:"#dc2626",searchQuery:"alternative rock"},{id:"classic-rock",name:"Classic Rock",color:"#b91c1c",searchQuery:"classic rock"},{id:"punk-rock",name:"Punk",color:"#991b1b",searchQuery:"punk rock"},{id:"prog-rock",name:"Progressive",color:"#7f1d1d",searchQuery:"progressive rock"},{id:"garage-rock",name:"Garage",color:"#fca5a5",searchQuery:"garage rock"}]},{id:"hiphop",name:"Hip Hop",color:us.hiphop,searchQuery:"hip hop music",children:[{id:"trap",name:"Trap",color:"#f59e0b",searchQuery:"trap music"},{id:"boom-bap",name:"Boom Bap",color:"#d97706",searchQuery:"boom bap"},{id:"conscious",name:"Conscious",color:"#b45309",searchQuery:"conscious hip hop"},{id:"drill",name:"Drill",color:"#92400e",searchQuery:"drill music"},{id:"lo-fi-hiphop",name:"Lo-Fi Hip Hop",color:"#fbbf24",searchQuery:"lo-fi hip hop"},{id:"old-school",name:"Old School",color:"#fcd34d",searchQuery:"old school hip hop"}]},{id:"electronic",name:"Electronic",color:us.electronic,searchQuery:"electronic music",children:[{id:"house",name:"House",color:"#06b6d4",searchQuery:"house music"},{id:"techno",name:"Techno",color:"#0891b2",searchQuery:"techno"},{id:"edm",name:"EDM",color:"#0e7490",searchQuery:"edm"},{id:"dubstep",name:"Dubstep",color:"#155e75",searchQuery:"dubstep"},{id:"dnb",name:"Drum & Bass",color:"#164e63",searchQuery:"drum and bass"},{id:"trance",name:"Trance",color:"#22d3ee",searchQuery:"trance music"},{id:"ambient-electronic",name:"Ambient",color:"#67e8f9",searchQuery:"ambient electronic"}]},{id:"rnb",name:"R&B / Soul",color:us.rnb,searchQuery:"r&b soul music",children:[{id:"contemporary-rnb",name:"Contemporary R&B",color:"#ec4899",searchQuery:"contemporary r&b"},{id:"neo-soul",name:"Neo Soul",color:"#db2777",searchQuery:"neo soul"},{id:"classic-soul",name:"Classic Soul",color:"#be185d",searchQuery:"classic soul"},{id:"funk",name:"Funk",color:"#9d174d",searchQuery:"funk music"},{id:"motown",name:"Motown",color:"#f472b6",searchQuery:"motown"}]},{id:"jazz",name:"Jazz",color:us.jazz,searchQuery:"jazz music",children:[{id:"smooth-jazz",name:"Smooth Jazz",color:"#3b82f6",searchQuery:"smooth jazz"},{id:"bebop",name:"Bebop",color:"#2563eb",searchQuery:"bebop jazz"},{id:"fusion",name:"Fusion",color:"#1d4ed8",searchQuery:"jazz fusion"},{id:"vocal-jazz",name:"Vocal Jazz",color:"#1e40af",searchQuery:"vocal jazz"},{id:"free-jazz",name:"Free Jazz",color:"#60a5fa",searchQuery:"free jazz"}]},{id:"classical",name:"Classical",color:us.classical,searchQuery:"classical music",children:[{id:"orchestral",name:"Orchestral",color:"#a855f7",searchQuery:"orchestral classical"},{id:"chamber",name:"Chamber",color:"#9333ea",searchQuery:"chamber music"},{id:"piano",name:"Piano",color:"#7c3aed",searchQuery:"classical piano"},{id:"opera",name:"Opera",color:"#6d28d9",searchQuery:"opera"},{id:"modern-classical",name:"Modern",color:"#c084fc",searchQuery:"modern classical"}]},{id:"country",name:"Country",color:us.country,searchQuery:"country music",children:[{id:"modern-country",name:"Modern Country",color:"#ea580c",searchQuery:"modern country"},{id:"classic-country",name:"Classic Country",color:"#c2410c",searchQuery:"classic country"},{id:"country-rock",name:"Country Rock",color:"#9a3412",searchQuery:"country rock"},{id:"americana",name:"Americana",color:"#fb923c",searchQuery:"americana"},{id:"bluegrass",name:"Bluegrass",color:"#fdba74",searchQuery:"bluegrass"}]},{id:"latin",name:"Latin",color:us.latin,searchQuery:"latin music",children:[{id:"reggaeton",name:"Reggaeton",color:"#f97316",searchQuery:"reggaeton"},{id:"salsa",name:"Salsa",color:"#ea580c",searchQuery:"salsa"},{id:"bachata",name:"Bachata",color:"#c2410c",searchQuery:"bachata"},{id:"latin-pop",name:"Latin Pop",color:"#fb923c",searchQuery:"latin pop"},{id:"cumbia",name:"Cumbia",color:"#fed7aa",searchQuery:"cumbia"}]},{id:"metal",name:"Metal",color:us.metal,searchQuery:"metal music",children:[{id:"heavy-metal",name:"Heavy Metal",color:"#334155",searchQuery:"heavy metal"},{id:"death-metal",name:"Death Metal",color:"#1e293b",searchQuery:"death metal"},{id:"black-metal",name:"Black Metal",color:"#0f172a",searchQuery:"black metal"},{id:"prog-metal",name:"Progressive Metal",color:"#475569",searchQuery:"progressive metal"},{id:"metalcore",name:"Metalcore",color:"#64748b",searchQuery:"metalcore"}]},{id:"folk",name:"Folk",color:us.folk,searchQuery:"folk music",children:[{id:"indie-folk",name:"Indie Folk",color:"#22c55e",searchQuery:"indie folk"},{id:"traditional-folk",name:"Traditional",color:"#16a34a",searchQuery:"traditional folk"},{id:"folk-rock",name:"Folk Rock",color:"#15803d",searchQuery:"folk rock"},{id:"singer-songwriter",name:"Singer-Songwriter",color:"#4ade80",searchQuery:"singer songwriter"}]},{id:"blues",name:"Blues",color:us.blues,searchQuery:"blues music",children:[{id:"electric-blues",name:"Electric Blues",color:"#3b82f6",searchQuery:"electric blues"},{id:"delta-blues",name:"Delta Blues",color:"#2563eb",searchQuery:"delta blues"},{id:"chicago-blues",name:"Chicago Blues",color:"#1d4ed8",searchQuery:"chicago blues"},{id:"blues-rock",name:"Blues Rock",color:"#60a5fa",searchQuery:"blues rock"}]},{id:"reggae",name:"Reggae",color:us.reggae,searchQuery:"reggae music",children:[{id:"roots-reggae",name:"Roots Reggae",color:"#14b8a6",searchQuery:"roots reggae"},{id:"dub",name:"Dub",color:"#0d9488",searchQuery:"dub music"},{id:"dancehall",name:"Dancehall",color:"#0f766e",searchQuery:"dancehall"},{id:"ska",name:"Ska",color:"#2dd4bf",searchQuery:"ska"}]},{id:"world",name:"World",color:us.world,searchQuery:"world music",children:[{id:"afrobeat",name:"Afrobeat",color:"#78350f",searchQuery:"afrobeat"},{id:"indian",name:"Indian",color:"#92400e",searchQuery:"indian music"},{id:"celtic",name:"Celtic",color:"#a16207",searchQuery:"celtic music"},{id:"middle-eastern",name:"Middle Eastern",color:"#854d0e",searchQuery:"middle eastern music"},{id:"asian",name:"Asian",color:"#a3a3a3",searchQuery:"asian music"}]},{id:"ambient",name:"Ambient / Chill",color:us.ambient,searchQuery:"ambient chill music",children:[{id:"lofi",name:"Lo-Fi",color:"#64748b",searchQuery:"lo-fi beats"},{id:"chillout",name:"Chillout",color:"#475569",searchQuery:"chillout"},{id:"downtempo",name:"Downtempo",color:"#334155",searchQuery:"downtempo"},{id:"new-age",name:"New Age",color:"#94a3b8",searchQuery:"new age music"},{id:"sleep",name:"Sleep",color:"#cbd5e1",searchQuery:"sleep music"}]}]};function Yre(n){function e(t){for(const s of t){if(s.id===n)return s;if(s.children){const r=e(s.children);if(r)return r}}}return e(_A.root)}function zA(){return _A.root}function Jre(n){const e=Yre(n);return(e==null?void 0:e.children)??[]}const Zre=({id:n,title:e,subtitle:t,isPersonalized:s,context:r,highlightedGenres:o,maxGenres:i=8,onSeeAll:a})=>{const{setSearchQuery:l}=on(),{search:u}=ma(),{getTopGenres:d}=On(),[f,m]=L.useState(null),g=o??d(3),y=zA().slice(0,i),w=v=>{if(v.children&&v.children.length>0)m(f===v.id?null:v.id);else{const N=v.searchQuery??v.name;l(N),u(N)}},b=v=>{const N=v.searchQuery??v.name;l(N),u(N)},k=v=>g.some(N=>N.toLowerCase().includes(v.toLowerCase()));return p.jsxs(Nu,{id:n,type:"genre-explorer",title:e,subtitle:t,isPersonalized:s,context:r,onSeeAll:a,className:"genre-explorer-section",children:[p.jsx("div",{className:"genre-grid",children:y.map((v,N)=>p.jsx(eoe,{genre:v,index:N,isExpanded:f===v.id,isHighlighted:k(v.id),onClick:()=>w(v),onSubgenreClick:b},v.id))}),f&&p.jsx(toe,{parentId:f,onSubgenreClick:b,onClose:()=>m(null)})]})},eoe=({genre:n,index:e,isExpanded:t,isHighlighted:s,onClick:r})=>{const o=n.children&&n.children.length>0;return p.jsxs("div",{className:`genre-tile ${t?"expanded":""} ${s?"highlighted":""}`,style:{"--genre-color":n.color,animationDelay:`${e*50}ms`},onClick:r,children:[p.jsx("div",{className:"genre-tile-bg",style:{background:`linear-gradient(135deg, ${n.color}40 0%, ${n.color}10 100%)`}}),p.jsxs("div",{className:"genre-tile-content",children:[p.jsx("span",{className:"genre-tile-name",children:n.name}),o&&p.jsx("span",{className:"genre-tile-expand",children:t?p.jsx(kp,{size:16}):p.jsx(yl,{size:16})})]}),s&&p.jsx("span",{className:"genre-tile-badge",children:"Your Taste"}),p.jsx("div",{className:"genre-tile-accent",style:{backgroundColor:n.color}})]})},toe=({parentId:n,onSubgenreClick:e,onClose:t})=>{const s=Jre(n),r=zA().find(o=>o.id===n);return s.length===0||!r?null:p.jsxs("div",{className:"subgenres-panel",onClick:o=>o.stopPropagation(),children:[p.jsxs("div",{className:"subgenres-header",children:[p.jsxs("h4",{className:"subgenres-title",children:["Explore ",p.jsx("span",{style:{color:r.color},children:r.name})]}),p.jsx("button",{className:"subgenres-close",onClick:t,children:""})]}),p.jsx("div",{className:"subgenres-grid",children:s.map((o,i)=>p.jsxs("button",{className:"subgenre-pill",style:{"--subgenre-color":o.color,animationDelay:`${i*30}ms`},onClick:()=>e(o),children:[p.jsx("span",{className:"subgenre-dot",style:{backgroundColor:o.color}}),o.name]},o.id))})]})};function noe(n=new Date){return n.toISOString().split("T")[0]}function uS(n){const e=[],t=new Date;for(let s=0;s<n;s++){const r=new Date(t);r.setDate(r.getDate()-s),e.push(noe(r))}return e}const soe=360*60*1e3,BA=Ps()(fa((n,e)=>({dailyTrending:[],banners:[],searchPopularity:new Map,lastTrendingUpdate:0,lastBannerUpdate:0,updateDailyTrending:(t,s)=>{n(r=>{const o=r.dailyTrending.filter(l=>l.date!==t);return{dailyTrending:[{date:t,tracks:s,fetchedAt:Date.now()},...o].slice(0,7),lastTrendingUpdate:Date.now()}})},getTrendingForDate:t=>{const{dailyTrending:s}=e(),r=s.find(o=>o.date===t);if(r&&Date.now()-r.fetchedAt<soe)return r},getWeeklyTrending:()=>{const{dailyTrending:t}=e();return uS(7).map(r=>t.find(o=>o.date===r)).filter(r=>r!==void 0)},recordSearch:t=>{const s=t.toLowerCase().trim();s.length<2||n(r=>{const o=new Map(r.searchPopularity),i=o.get(s)||0;if(o.set(s,i+1),o.size>1e3){const l=[...o.entries()].sort((u,d)=>d[1]-u[1]).slice(0,500);return{searchPopularity:new Map(l)}}return{searchPopularity:o}})},getPopularSearches:(t=10)=>{const{searchPopularity:s}=e();return[...s.entries()].sort((r,o)=>o[1]-r[1]).slice(0,t).map(([r,o])=>({query:r,count:o}))},addBanner:t=>{const s=`banner-${Date.now()}-${Math.random().toString(36).slice(2,7)}`;n(r=>({banners:[...r.banners,{...t,id:s}],lastBannerUpdate:Date.now()}))},removeBanner:t=>{n(s=>({banners:s.banners.filter(r=>r.id!==t)}))},getActiveBanners:()=>{const{banners:t}=e(),s=Date.now();return t.filter(r=>!r.expiresAt||r.expiresAt>s).sort((r,o)=>o.priority-r.priority)},computeTrendingFromTracks:t=>{const{searchPopularity:s,dailyTrending:r}=e(),o=uS(2)[1],i=r.find(l=>l.date===o),a=new Map((i==null?void 0:i.tracks.map((l,u)=>[l.id,u]))??[]);return t.slice(0,20).map((l,u)=>{var w,b,k;const d=`${((w=l.artists[0])==null?void 0:w.name)??""} ${l.title}`.toLowerCase(),f=s.get(d)??0,m=100-u*5+f,g=a.get(l.id);let y="new";return g!==void 0&&(g>u?y="up":g<u?y="down":y="stable"),{id:l.id,title:l.title,artist:l.artists.map(v=>v.name).join(", "),artwork:((b=l.artwork)==null?void 0:b.small)??((k=l.artwork)==null?void 0:k.medium),trendScore:m,changeDirection:y,previousRank:g!==void 0?g+1:void 0}})}}),{name:"audiio-trending",partialize:n=>({dailyTrending:n.dailyTrending.slice(0,7),banners:n.banners.filter(e=>!e.expiresAt||e.expiresAt>Date.now()),searchPopularity:Object.fromEntries([...n.searchPopularity.entries()].slice(0,200)),lastTrendingUpdate:n.lastTrendingUpdate,lastBannerUpdate:n.lastBannerUpdate}),merge:(n,e)=>{const t=n;return{...e,dailyTrending:t.dailyTrending??[],banners:t.banners??[],searchPopularity:new Map(Object.entries(t.searchPopularity??{})),lastTrendingUpdate:t.lastTrendingUpdate??0,lastBannerUpdate:t.lastBannerUpdate??0}}})),roe=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];function eu(n=0){const e=new Date;return e.setDate(e.getDate()-n),e.toISOString().split("T")[0]}function dS(n){const e=new Date(n+"T00:00:00");return roe[e.getDay()]}function ooe(n){return n===eu(0)}const ioe=({id:n,title:e,subtitle:t,isPersonalized:s,context:r,dailyData:o,onSeeAll:i})=>{const{play:a,setQueue:l,currentTrack:u,isPlaying:d}=yt();Pn();const{getWeeklyTrending:f,updateDailyTrending:m,computeTrendingFromTracks:g,getTrendingForDate:y}=BA(),w=L.useRef(null),[b,k]=L.useState(eu(0)),[v,N]=L.useState(o??[]),[S,$]=L.useState(!o),R=Array.from({length:7},(E,j)=>eu(j)).reverse();L.useEffect(()=>{if(o){N(o);return}(async()=>{$(!0);try{const j=f();if(j.length>=3){N(j),$(!1);return}if(!y(eu(0))&&window.api){const W=await window.api.search({query:"top hits trending 2024",type:"track"}),U=g(W);m(eu(0),U)}N(f())}catch(j){console.error("[WeeklyRotation] Failed to fetch data:",j)}finally{$(!1)}})()},[o,f,y,m,g]);const M=v.find(E=>E.date===b),A=(M==null?void 0:M.tracks)??[],P=E=>{console.log("Play trending track:",E.id)},D=E=>{k(E)};return p.jsxs(Nu,{id:n,type:"weekly-rotation",title:e,subtitle:t,isPersonalized:s,isLoading:S,context:r,onSeeAll:i,className:"weekly-rotation-section",children:[p.jsx("div",{className:"rotation-timeline",ref:w,children:R.map((E,j)=>{const V=v.find(X=>X.date===E),W=V&&V.tracks.length>0,U=ooe(E);return p.jsxs("button",{className:`timeline-day ${b===E?"selected":""} ${U?"today":""} ${W?"":"no-data"}`,onClick:()=>D(E),style:{animationDelay:`${j*50}ms`},children:[p.jsx("span",{className:"timeline-day-name",children:dS(E)}),p.jsx("span",{className:"timeline-day-date",children:E.split("-")[2]}),U&&p.jsx("span",{className:"timeline-today-badge",children:"Today"}),W&&p.jsx("span",{className:"timeline-track-count",children:V.tracks.length})]},E)})}),p.jsx("div",{className:"rotation-tracks",children:A.length===0?p.jsxs("div",{className:"rotation-empty",children:[p.jsx(Ye,{size:32}),p.jsxs("p",{children:["No trending data for ",dS(b)]})]}):p.jsx("div",{className:"rotation-list",children:A.slice(0,5).map((E,j)=>p.jsx(aoe,{track:E,rank:j+1,onClick:()=>P(E)},E.id))})})]})},aoe=({track:n,rank:e,onClick:t})=>p.jsxs("div",{className:"trending-track",onClick:t,children:[p.jsxs("span",{className:"trending-rank",children:["#",e]}),p.jsx("div",{className:"trending-artwork",children:n.artwork?p.jsx("img",{src:n.artwork,alt:n.title}):p.jsx("div",{className:"trending-artwork-placeholder",children:p.jsx(Ye,{size:20})})}),p.jsxs("div",{className:"trending-info",children:[p.jsx("span",{className:"trending-title",children:n.title}),p.jsx("span",{className:"trending-artist",children:n.artist})]}),p.jsxs("div",{className:`trending-change trending-change--${n.changeDirection}`,children:[n.changeDirection==="up"&&p.jsxs(p.Fragment,{children:[p.jsx(Z4,{size:16}),n.previousRank&&p.jsxs("span",{children:["+",n.previousRank-e]})]}),n.changeDirection==="down"&&p.jsxs(p.Fragment,{children:[p.jsx(eM,{size:16}),n.previousRank&&p.jsxs("span",{children:["-",e-n.previousRank]})]}),n.changeDirection==="stable"&&p.jsx(tM,{size:16}),n.changeDirection==="new"&&p.jsx("span",{className:"trending-new",children:"NEW"})]}),p.jsx("button",{className:"trending-play",children:p.jsx(At,{size:18})})]}),loe=({id:n,context:e,banner:t})=>{const{setSearchQuery:s}=on(),{search:r}=ma(),{getActiveBanners:o}=BA(),i=o(),a=t??i[0];if(!a)return null;const l=()=>{if(a.ctaAction){if(a.ctaAction.startsWith("search:")){const d=a.ctaAction.replace("search:","");s(d),r(d)}else if(a.ctaAction.startsWith("artist:")){const d=a.ctaAction.replace("artist:","");console.log("Navigate to artist:",d)}else if(a.ctaAction.startsWith("album:")){const d=a.ctaAction.replace("album:","");console.log("Navigate to album:",d)}}},u={};return a.backgroundImage?(u.backgroundImage=`url(${a.backgroundImage})`,u.backgroundSize="cover",u.backgroundPosition="center"):a.gradientColors?u.background=`linear-gradient(135deg, ${a.gradientColors[0]} 0%, ${a.gradientColors[1]} 100%)`:a.backgroundColor?u.backgroundColor=a.backgroundColor:u.background="linear-gradient(135deg, var(--accent) 0%, var(--bg-primary) 100%)",p.jsxs("section",{id:n,className:"banner-section",style:u,children:[p.jsx("div",{className:"banner-overlay"}),p.jsxs("div",{className:"banner-content",children:[p.jsxs("div",{className:"banner-text",children:[a.type!=="custom"&&p.jsx("span",{className:"banner-badge",children:coe(a.type)}),p.jsx("h2",{className:"banner-title",children:a.title}),a.subtitle&&p.jsx("p",{className:"banner-subtitle",children:a.subtitle})]}),a.ctaText&&p.jsxs("button",{className:"banner-cta",onClick:l,children:[p.jsx("span",{children:a.ctaText}),p.jsx(yl,{size:20})]})]}),p.jsxs("div",{className:"banner-decoration",children:[p.jsx("div",{className:"banner-circle banner-circle--1"}),p.jsx("div",{className:"banner-circle banner-circle--2"})]})]})};function coe(n){switch(n){case"new-release":return"New Release";case"featured-artist":return"Featured Artist";case"playlist":return"Playlist";case"event":return"Event";default:return""}}function uoe(n,e){return n===0||n%5===0?"large":n%3===0?"medium":"small"}const doe=({id:n,title:e,subtitle:t,query:s,isPersonalized:r,context:o,tracks:i,onSeeAll:a})=>{const{play:l,setQueue:u,currentTrack:d,isPlaying:f}=yt(),{showContextMenu:m}=Pn(),{tracks:g,isLoading:y,error:w}=QS(i?void 0:s,{limit:12}),b=i??g,k=b.map((N,S)=>({track:N,size:uoe(S,b.length)})),v=N=>{u(b,b.indexOf(N)),l(N)};return!y&&b.length===0?null:p.jsx(Nu,{id:n,type:"masonry",title:e,subtitle:t,isPersonalized:r,isLoading:y,error:w,context:o,onSeeAll:a,className:"masonry-section",children:p.jsx("div",{className:"masonry-grid",children:k.map(({track:N,size:S},$)=>p.jsx(hoe,{track:N,size:S,index:$,isPlaying:(d==null?void 0:d.id)===N.id&&f,onClick:()=>v(N),onContextMenu:R=>m(R,N)},N.id))})})},hoe=({track:n,size:e,index:t,isPlaying:s,onClick:r,onContextMenu:o})=>{var a,l,u,d;const i=e==="large"?((a=n.artwork)==null?void 0:a.large)??((l=n.artwork)==null?void 0:l.medium):((u=n.artwork)==null?void 0:u.medium)??((d=n.artwork)==null?void 0:d.small);return p.jsxs("div",{className:`masonry-card masonry-card--${e} ${s?"playing":""}`,onClick:r,onContextMenu:o,style:{animationDelay:`${t*50}ms`},children:[p.jsxs("div",{className:"masonry-card-artwork",children:[i?p.jsx("img",{src:i,alt:n.title,loading:"lazy"}):p.jsx("div",{className:"masonry-card-placeholder",children:p.jsx(Ye,{size:e==="large"?48:e==="medium"?32:24})}),p.jsx("div",{className:"masonry-card-overlay",children:p.jsx("button",{className:"masonry-card-play",children:p.jsx(At,{size:e==="large"?32:24})})}),s&&p.jsxs("div",{className:"masonry-card-playing",children:[p.jsx("span",{className:"playing-bar"}),p.jsx("span",{className:"playing-bar"}),p.jsx("span",{className:"playing-bar"})]})]}),p.jsxs("div",{className:"masonry-card-info",children:[p.jsx("span",{className:"masonry-card-title",children:n.title}),(e==="large"||e==="medium")&&p.jsx("span",{className:"masonry-card-artist",children:n.artists.map(f=>f.name).join(", ")})]})]})},foe={type:"hero",component:Pre,displayName:"Featured",description:"Compact featured content with ambient background",requirements:{},constraints:{maxPerPage:1,preferredPosition:"top"},weights:{base:75,personalizedBoost:15},generateConfig:n=>({title:n.isNewUser?"Trending Now":"Made For You",subtitle:n.isNewUser?"Popular tracks right now":"Personalized mix based on your listening",query:n.isNewUser?"top hits 2024 trending":`${n.topArtists[0]??""} ${n.topGenres[0]??""} similar`,isPersonalized:!n.isNewUser})},poe={type:"compact-list",component:Lre,displayName:"Jump Back In",description:"Compact list for recently played tracks",requirements:{},constraints:{maxPerPage:1,preferredPosition:"top"},weights:{base:80,personalizedBoost:20},generateConfig:n=>({title:n.isNewUser?"Popular Right Now":"Jump Back In",query:n.isNewUser?"popular trending 2024":"recently played popular tracks",isPersonalized:!n.isNewUser})},moe={type:"trending-tracks",component:Ore,displayName:"Trending Songs",description:"Hot tracks right now",requirements:{},constraints:{maxPerPage:1,preferredPosition:"top"},weights:{base:85,personalizedBoost:0,newUserBoost:20},generateConfig:()=>({title:"Trending Songs",subtitle:"Popular right now",query:"top hits 2024 trending popular",isPersonalized:!1})},goe={type:"trending-artists",component:_re,displayName:"Popular Artists",description:"Trending artists right now",requirements:{},constraints:{maxPerPage:1,cooldownSections:4},weights:{base:70,personalizedBoost:0,newUserBoost:15},generateConfig:()=>({title:"Popular Artists",subtitle:"Artists everyone is listening to",query:"trending popular artists 2024",isPersonalized:!1})},xoe={type:"artist-radio",component:zre,displayName:"Artist Radio",description:"Tracks similar to your top artist",requirements:{},constraints:{maxPerPage:1,preferredPosition:"top"},weights:{base:75,personalizedBoost:25},generateConfig:n=>({title:n.topArtists[0]?`More like ${n.topArtists[0]}`:"Artist Radio",subtitle:n.topArtists[0]?"Based on your listening":"Discover similar artists",query:n.topArtists[0]?`${n.topArtists[0]} similar`:"popular artists 2024",isPersonalized:n.topArtists.length>0})},yoe={type:"because-you-like",component:OA,displayName:"Because You Like",description:"Recommendations based on a specific artist",requirements:{},constraints:{maxPerPage:2,cooldownSections:2},weights:{base:65,personalizedBoost:20},generateConfig:n=>({title:n.topArtists[0]?`Because you like ${n.topArtists[0]}`:"You Might Like",query:n.topArtists[0]?`${n.topArtists[0]} similar artists`:"recommended music 2024",isPersonalized:n.topArtists.length>0})},voe={type:"because-you-like",component:OA,displayName:"Because You Like",description:"Recommendations based on another artist",requirements:{minTopArtists:1},constraints:{maxPerPage:2,cooldownSections:3},weights:{base:55,personalizedBoost:15},generateConfig:n=>({title:n.topArtists[1]?`Because you like ${n.topArtists[1]}`:"More For You",query:n.topArtists[1]?`${n.topArtists[1]} similar`:"discover new music",isPersonalized:n.topArtists.length>1})},boe={type:"new-releases",component:Bre,displayName:"New Releases",description:"Latest music releases",requirements:{},constraints:{maxPerPage:1,cooldownSections:5},weights:{base:60,personalizedBoost:10},generateConfig:n=>({title:"New Releases",subtitle:n.topGenres[0]?`In ${n.topGenres[0]}`:"Fresh music",query:n.topGenres[0]?`new releases ${n.topGenres[0]} 2024`:"new releases 2024 latest",isPersonalized:n.topGenres.length>0})},woe={type:"chart-list",component:Vre,displayName:"Top Charts",description:"Numbered list of trending tracks",requirements:{},constraints:{maxPerPage:1,preferredPosition:"top"},weights:{base:80,personalizedBoost:5,newUserBoost:15},generateConfig:()=>({title:"Top Charts",subtitle:"What everyone is listening to",query:"top charts hits 2024",isPersonalized:!1})},koe={type:"quick-picks",component:Wre,displayName:"Quick Picks",description:"Small tiles for quick access",requirements:{},constraints:{maxPerPage:1,preferredPosition:"top"},weights:{base:90,personalizedBoost:15,newUserBoost:10},generateConfig:n=>({title:"",query:n.topArtists[0]?`${n.topArtists[0]} similar recommendations`:"recommended popular tracks 2024",isPersonalized:n.topArtists.length>0})},Coe={type:"grid",component:jre,displayName:"Discover",description:"Standard responsive grid of track cards",requirements:{},constraints:{maxPerPage:2,cooldownSections:3},weights:{base:55,personalizedBoost:15},generateConfig:n=>({title:n.topGenres[0]?`${n.topGenres[0]} Mix`:"Discover",query:n.topGenres[0]?`${n.topGenres[0]} best 2024`:"discover new music",isPersonalized:n.topGenres.length>0})},Soe={type:"horizontal",component:db,displayName:"Browse",description:"Horizontally scrollable row of content",requirements:{},constraints:{maxPerPage:3,cooldownSections:2},weights:{base:50,personalizedBoost:10},generateConfig:n=>({title:n.topGenres[1]?`${n.topGenres[1]} Hits`:"Popular Tracks",query:n.topGenres[1]?`${n.topGenres[1]} hits 2024`:"popular tracks 2024",isPersonalized:n.topGenres.length>1})},Noe={type:"large-cards",component:Fre,displayName:"Highlights",description:"Large card grid with 2-3 columns",requirements:{},constraints:{maxPerPage:1,cooldownSections:4},weights:{base:45,personalizedBoost:15,timeRelevance:n=>n>=18&&n<22?15:0},generateConfig:n=>{const e=n.hour;return e>=6&&e<12?{title:"Morning Energy",query:"upbeat energizing morning"}:e>=12&&e<18?{title:"Afternoon Vibes",query:"popular trending afternoon"}:e>=18&&e<22?{title:"Evening Wind Down",query:"chill relaxing evening"}:{title:"Night Mode",query:"ambient calm night lofi"}}},Ioe={type:"artist-spotlight",component:Ure,displayName:"Featured Artist",description:"Magazine-style artist deep dive",requirements:{},constraints:{maxPerPage:1,cooldownSections:6,preferredPosition:"bottom"},weights:{base:45,personalizedBoost:25},generateConfig:n=>({title:n.topArtists[0]?`Spotlight: ${n.topArtists[0]}`:"Featured Artist",query:n.topArtists[0]||"popular artist 2024",isPersonalized:n.topArtists.length>0})},$oe={type:"mood-gradient",component:Xre,displayName:"Mood Spectrum",description:"Tracks arranged by energy level",requirements:{},constraints:{maxPerPage:1,cooldownSections:4},weights:{base:60,personalizedBoost:15,newUserBoost:10},generateConfig:n=>({title:"Mood Spectrum",subtitle:"From calm to energetic",query:n.topGenres[0]?`${n.topGenres[0]} music`:"popular music variety",isPersonalized:n.topGenres.length>0})},Toe={type:"genre-explorer",component:Zre,displayName:"Explore Genres",description:"Browse music by genre",requirements:{},constraints:{maxPerPage:1,cooldownSections:5,preferredPosition:"middle"},weights:{base:55,personalizedBoost:10,newUserBoost:20},generateConfig:()=>({title:"Explore Genres",subtitle:"Find your next favorite sound",query:"music genres discover variety",isPersonalized:!1})},Eoe={type:"weekly-rotation",component:ioe,displayName:"Weekly Rotation",description:"Trending tracks by day",requirements:{},constraints:{maxPerPage:1,cooldownSections:6},weights:{base:50,personalizedBoost:5,newUserBoost:15},generateConfig:()=>({title:"Weekly Rotation",subtitle:"What's been trending this week",query:"trending this week popular 2024",isPersonalized:!1})},Roe={type:"banner",component:loe,displayName:"Featured",description:"Promotional banner",requirements:{},constraints:{maxPerPage:1,preferredPosition:"top"},weights:{base:70,personalizedBoost:0,newUserBoost:25},generateConfig:()=>({title:"Featured",query:"featured popular hits 2024",isPersonalized:!1})},Aoe={type:"masonry",component:doe,displayName:"Discover Grid",description:"Masonry layout of tracks",requirements:{},constraints:{maxPerPage:1,cooldownSections:4},weights:{base:55,personalizedBoost:15},generateConfig:n=>({title:n.topGenres[0]?`${n.topGenres[0]} Discoveries`:"Discover",query:n.topGenres[0]?`${n.topGenres[0]} best 2024`:"discover new music 2024",isPersonalized:n.topGenres.length>0})},Doe={type:"horizontal",component:db,displayName:"Chill Vibes",description:"Relaxing music",requirements:{},constraints:{maxPerPage:3,cooldownSections:2},weights:{base:50,personalizedBoost:10,timeRelevance:n=>n>=20||n<6?20:0},generateConfig:()=>({title:"Chill Vibes",subtitle:"Wind down with these tracks",query:"chill lofi relaxing music",isPersonalized:!1})},Moe={type:"horizontal",component:db,displayName:"Energy Boost",description:"Upbeat music",requirements:{},constraints:{maxPerPage:3,cooldownSections:2},weights:{base:50,personalizedBoost:10,timeRelevance:n=>n>=6&&n<18?15:0},generateConfig:()=>({title:"Energy Boost",subtitle:"Get pumped up",query:"upbeat energetic workout music",isPersonalized:!1})};function Poe(){_t.register(koe),_t.register(foe),_t.register(Roe),_t.register(woe),_t.register(moe),_t.register(goe),_t.register(xoe),_t.register(yoe),_t.register(voe),_t.register(boe),_t.register(poe),_t.register(Coe),_t.register(Soe),_t.register(Doe),_t.register(Moe),_t.register(Aoe),_t.register(Noe),_t.register($oe),_t.register(Toe),_t.register(Eoe),_t.register(Ioe),console.log("[SectionRegistry] Registered",_t.getAll().length,"sections")}let hS=!1;hS||(Poe(),hS=!0);const fS=()=>{const{setSearchQuery:n}=on(),{search:e}=ma(),{getTopGenres:t,getTopArtists:s,userProfile:r}=On(),{likedTracks:o,playlists:i}=gs(),{getPlugin:a}=pa(),[l,u]=L.useState([]),[d,f]=L.useState([]),m=a("lrclib-lyrics"),g=(m==null?void 0:m.enabled)??!1,y=L.useMemo(()=>uM({userProfile:r,likedTracksCount:o.length,topArtists:s(5),topGenres:t(5),hasLyrics:g,hasPlaylists:i.length>0,playlistCount:i.length,recentSections:l}),[r,o.length,s,t,g,i.length,l]);L.useEffect(()=>{const v=_t.selectSections(y,12);f(v),u(N=>[...v.map($=>$.type),...N].slice(0,20))},[y.userProfile.totalListens,y.likedTracksCount]);const w=L.useCallback(v=>{n(v),e(v)},[n,e]),b=()=>{const v=new Date().getHours();return v<12?"Good morning":v<18?"Good afternoon":"Good evening"},k=r.totalListens>5||o.length>0;return p.jsxs("div",{className:"discover",children:[p.jsx("header",{className:"discover-hero",children:p.jsxs("div",{className:"discover-hero-content",children:[p.jsx("h1",{className:"discover-greeting",children:b()}),k&&p.jsx("span",{className:"discover-personalized-badge",children:"Personalized for you"})]})}),p.jsx("div",{className:"discover-sections",children:d.map((v,N)=>p.jsx(Foe,{config:v,context:y,index:N,onSeeAll:()=>v.query&&w(v.query)},v.id))})]})},Foe=({config:n,context:e,index:t,onSeeAll:s})=>{const r=_t.get(n.type);if(!r)return console.warn(`[Discover] Unknown section type: ${n.type}`),null;const o=r.component;return p.jsx("div",{className:"discover-section-wrapper",style:{animationDelay:`${t*100}ms`},children:p.jsx(o,{id:n.id,type:n.type,title:n.title,subtitle:n.subtitle,query:n.query,isPersonalized:n.isPersonalized,context:e,onSeeAll:s})})},Loe=({onSearch:n,placeholder:e="Search for songs, artists, or albums...",onFocus:t,onBlur:s,onTyping:r})=>{const{query:o,setQuery:i,search:a}=ma(),[l,u]=L.useState(o),d=L.useRef(null),f=L.useCallback(b=>{b.preventDefault(),n?n(l):a(l)},[l,a,n]),m=L.useCallback(b=>{u(b.target.value),i(b.target.value),r==null||r()},[i,r]),g=L.useCallback(b=>{b.key==="Enter"&&(n?n(l):a(l))},[l,a,n]),y=L.useCallback(()=>{t==null||t()},[t]),w=L.useCallback(()=>{s==null||s()},[s]);return p.jsx("form",{className:"search-bar",onSubmit:f,children:p.jsx("input",{ref:d,type:"text",className:"search-input",placeholder:e,value:l,onChange:m,onKeyDown:g,onFocus:y,onBlur:w})})},joe=({onSearch:n,onClose:e,isSearchActive:t})=>{const[s,r]=L.useState(!1),[o,i]=L.useState(!1),a=L.useRef(null);L.useEffect(()=>()=>{a.current&&clearTimeout(a.current)},[]);const l=()=>{r(!0)},u=()=>{r(!1)},d=()=>{i(!0),a.current&&clearTimeout(a.current),a.current=setTimeout(()=>{i(!1)},500)},f=()=>{e()},m=["floating-search",t?"active":"",s?"focused":"",o?"typing":""].filter(Boolean).join(" ");return p.jsxs(p.Fragment,{children:[p.jsx("div",{className:`floating-search-backdrop ${t?"visible":""}`,onClick:f}),p.jsxs("div",{className:m,children:[p.jsx("div",{className:"floating-search-spotlight"}),p.jsxs("div",{className:"floating-search-bar",children:[p.jsxs("button",{className:`floating-search-morph-icon ${t?"is-close":""}`,onClick:t?f:void 0,"aria-label":t?"Close search":"Search",type:"button",tabIndex:t?0:-1,children:[p.jsx("span",{className:"morph-icon morph-icon--search",children:p.jsx(j4,{size:18})}),p.jsx("span",{className:"morph-icon morph-icon--close",children:p.jsx(ar,{size:18})})]}),p.jsx(Loe,{onSearch:n,onFocus:l,onBlur:u,onTyping:d})]})]})]})},tg=({track:n,index:e,isPlaying:t=!1,onClick:s,onContextMenu:r,compact:o=!1})=>{var d,f,m;const i=g=>{const y=Math.floor(g/60),w=Math.floor(g%60);return`${y}:${w.toString().padStart(2,"0")}`},a=n.artists.map(g=>g.name).join(", "),l=((d=n.artwork)==null?void 0:d.medium)??((m=(f=n.album)==null?void 0:f.artwork)==null?void 0:m.medium),u=g=>{r&&r(g,n)};return p.jsxs("div",{className:`track-row ${t?"playing":""} ${o?"compact":""}`,onClick:s,onContextMenu:u,children:[p.jsx("span",{className:"track-number",children:e}),l?p.jsx("img",{className:"track-artwork",src:l,alt:n.title,loading:"lazy"}):p.jsx("div",{className:"track-artwork-placeholder",children:p.jsx(Ye,{size:20})}),p.jsxs("div",{className:"track-info",children:[p.jsx("div",{className:"track-title",children:n.title}),p.jsx("div",{className:"track-artist",children:a})]}),p.jsx("span",{className:"track-duration",children:i(n.duration)})]})},pS=({artist:n,onClick:e,onContextMenu:t})=>p.jsxs("div",{className:"artist-card",onClick:e,onContextMenu:t,children:[p.jsx("div",{className:"artist-card-image",children:n.image?p.jsx("img",{src:n.image,alt:n.name}):p.jsx("div",{className:"artist-card-placeholder",children:p.jsx(Ye,{size:32})})}),p.jsxs("div",{className:"artist-card-info",children:[p.jsx("span",{className:"artist-card-name",children:n.name}),p.jsx("span",{className:"artist-card-type",children:"Artist"})]})]}),mS=({album:n,onClick:e,onContextMenu:t})=>p.jsxs("div",{className:"album-card",onClick:e,onContextMenu:t,children:[p.jsxs("div",{className:"album-card-image",children:[n.artwork?p.jsx("img",{src:n.artwork,alt:n.title}):p.jsx("div",{className:"album-card-placeholder",children:p.jsx(Ye,{size:32})}),p.jsx("div",{className:"album-card-play",children:p.jsx(At,{size:24})})]}),p.jsxs("div",{className:"album-card-info",children:[p.jsx("span",{className:"album-card-title",children:n.title}),p.jsx("span",{className:"album-card-artist",children:n.artist}),n.year&&p.jsx("span",{className:"album-card-year",children:n.year})]})]}),Ooe=()=>{var S;const{results:n,isSearching:e,error:t,query:s,activeFilter:r,setActiveFilter:o}=ma(),{play:i,setQueue:a,currentTrack:l}=yt(),{openArtist:u,openAlbum:d}=on(),{showContextMenu:f}=Pn(),{showContextMenu:m}=ub(),{showContextMenu:g}=Gd(),y=async($,R)=>{a(n.tracks,R),await i($)},w=$=>{u($.id,$)},b=$=>{d($.id,$)},k=[{id:"all",label:"All"},{id:"tracks",label:"Songs"},{id:"artists",label:"Artists"},{id:"albums",label:"Albums"}],v=n.tracks.length>0||n.artists.length>0||n.albums.length>0,N=n.tracks[0]||null;return e?p.jsx("div",{className:"search-results",children:p.jsxs("div",{className:"search-results-loading",children:[p.jsx("div",{className:"search-loading-spinner"}),p.jsx("span",{children:"Searching..."})]})}):t?p.jsx("div",{className:"search-results",children:p.jsx("div",{className:"search-results-error",children:t})}):s?v?p.jsxs("div",{className:"search-results",children:[p.jsx("div",{className:"search-filters",children:k.map($=>p.jsx("button",{className:`search-filter-btn ${r===$.id?"active":""}`,onClick:()=>o($.id),children:$.label},$.id))}),r==="all"&&p.jsxs("div",{className:"search-results-all",children:[p.jsxs("div",{className:"search-top-section",children:[N&&p.jsxs("div",{className:"search-top-result",children:[p.jsx("h3",{className:"search-section-title",children:"Top Result"}),p.jsxs("div",{className:"top-result-card",onClick:()=>y(N,0),children:[p.jsx("div",{className:"top-result-image",children:(S=N.artwork)!=null&&S.medium?p.jsx("img",{src:N.artwork.medium,alt:N.title}):p.jsx("div",{className:"top-result-placeholder",children:p.jsx(Ye,{size:48})})}),p.jsxs("div",{className:"top-result-info",children:[p.jsx("span",{className:"top-result-title",children:N.title}),p.jsxs("div",{className:"top-result-meta",children:[p.jsx("span",{className:"top-result-artist",children:N.artists.map($=>$.name).join(", ")}),p.jsx("span",{className:"top-result-type",children:"Song"})]})]}),p.jsx("button",{className:"top-result-play",children:p.jsx(At,{size:24})})]})]}),n.tracks.length>0&&p.jsxs("div",{className:"search-songs-preview",children:[p.jsx("h3",{className:"search-section-title",children:"Songs"}),p.jsx("div",{className:"search-songs-list",children:n.tracks.slice(0,4).map(($,R)=>{var M;return p.jsxs("div",{className:`search-song-row ${(l==null?void 0:l.id)===$.id?"playing":""}`,onClick:()=>y($,R),onContextMenu:A=>f(A,$),children:[p.jsx("div",{className:"search-song-image",children:(M=$.artwork)!=null&&M.small?p.jsx("img",{src:$.artwork.small,alt:$.title}):p.jsx(Ye,{size:16})}),p.jsxs("div",{className:"search-song-info",children:[p.jsx("span",{className:"search-song-title",children:$.title}),p.jsx("span",{className:"search-song-artist",children:$.artists.map(A=>A.name).join(", ")})]}),p.jsx("span",{className:"search-song-duration",children:_oe($.duration)})]},$.id)})})]})]}),n.artists.length>0&&p.jsxs("div",{className:"search-section",children:[p.jsxs("div",{className:"search-section-header",children:[p.jsx("h3",{className:"search-section-title",children:"Artists"}),n.artists.length>6&&p.jsxs("button",{className:"search-see-all",onClick:()=>o("artists"),children:["See All ",p.jsx(yl,{size:14})]})]}),p.jsx("div",{className:"search-horizontal-scroll",children:n.artists.map($=>p.jsx(pS,{artist:$,onClick:()=>w($),onContextMenu:R=>m(R,$)},$.id))})]}),n.albums.length>0&&p.jsxs("div",{className:"search-section",children:[p.jsxs("div",{className:"search-section-header",children:[p.jsx("h3",{className:"search-section-title",children:"Albums"}),n.albums.length>6&&p.jsxs("button",{className:"search-see-all",onClick:()=>o("albums"),children:["See All ",p.jsx(yl,{size:14})]})]}),p.jsx("div",{className:"search-horizontal-scroll",children:n.albums.map($=>p.jsx(mS,{album:$,onClick:()=>b($),onContextMenu:R=>g(R,$)},$.id))})]})]}),r==="tracks"&&p.jsx("div",{className:"search-tracks-view",children:p.jsx("div",{className:"results-list",children:n.tracks.map(($,R)=>p.jsx(tg,{track:$,index:R+1,isPlaying:(l==null?void 0:l.id)===$.id,onClick:()=>y($,R),onContextMenu:f},$.id))})}),r==="artists"&&p.jsx("div",{className:"search-artists-view",children:p.jsx("div",{className:"search-artists-grid large",children:n.artists.map($=>p.jsx(pS,{artist:$,onClick:()=>w($),onContextMenu:R=>m(R,$)},$.id))})}),r==="albums"&&p.jsx("div",{className:"search-albums-view",children:p.jsx("div",{className:"search-albums-grid large",children:n.albums.map($=>p.jsx(mS,{album:$,onClick:()=>b($),onContextMenu:R=>g(R,$)},$.id))})})]}):p.jsx("div",{className:"search-results",children:p.jsxs("div",{className:"search-results-empty",children:['No results found for "',s,'"']})}):p.jsx("div",{className:"search-results",children:p.jsx("div",{className:"search-results-empty",children:"Search for tracks, artists, or albums"})})};function _oe(n){if(!n)return"--:--";const e=Math.floor(n/1e3),t=Math.floor(e/60),s=e%60;return`${t}:${s.toString().padStart(2,"0")}`}const zoe=()=>{const{likedTracks:n}=gs(),{play:e,setQueue:t,currentTrack:s}=yt(),r=i=>{const a=n[i];a&&(t(n,i),e(a))},o=()=>{n.length>0&&(t(n,0),e(n[0]))};return p.jsxs("div",{className:"library-view",children:[p.jsxs("header",{className:"library-header",children:[p.jsx("div",{className:"library-header-icon likes-icon",children:p.jsx(Ml,{size:64})}),p.jsxs("div",{className:"library-header-info",children:[p.jsx("span",{className:"library-header-type",children:"Collection"}),p.jsx("h1",{className:"library-header-title",children:"Liked Songs"}),p.jsxs("span",{className:"library-header-count",children:[n.length," songs"]})]})]}),n.length>0&&p.jsx("div",{className:"library-actions",children:p.jsxs("button",{className:"library-play-button",onClick:o,children:[p.jsx(At,{size:18})," Play All"]})}),p.jsx("div",{className:"library-tracks",children:n.length===0?p.jsxs("div",{className:"library-empty",children:[p.jsx("div",{className:"library-empty-icon",children:p.jsx(Su,{size:48})}),p.jsx("h3",{children:"Songs you like will appear here"}),p.jsx("p",{children:"Save songs by tapping the heart icon"})]}):p.jsx("div",{className:"results-list",children:n.map((i,a)=>p.jsx(tg,{track:i,index:a+1,isPlaying:(s==null?void 0:s.id)===i.id,onClick:()=>r(a)},i.id))})})]})},Boe=()=>{const{playlists:n,createPlaylist:e,deletePlaylist:t}=gs(),{openPlaylist:s}=on(),r=()=>{const i=prompt("Enter playlist name:");if(i!=null&&i.trim()){const a=e(i.trim());s(a.id)}},o=(i,a)=>{i.stopPropagation(),confirm("Are you sure you want to delete this playlist?")&&t(a)};return p.jsxs("div",{className:"library-view",children:[p.jsxs("header",{className:"library-header",children:[p.jsx("div",{className:"library-header-icon playlists-icon",children:p.jsx(Yi,{size:64})}),p.jsxs("div",{className:"library-header-info",children:[p.jsx("span",{className:"library-header-type",children:"Library"}),p.jsx("h1",{className:"library-header-title",children:"Playlists"}),p.jsxs("span",{className:"library-header-count",children:[n.length," playlists"]})]})]}),p.jsx("div",{className:"library-actions",children:p.jsxs("button",{className:"library-create-button",onClick:r,children:[p.jsx(xl,{size:18})," Create Playlist"]})}),p.jsx("div",{className:"playlists-grid",children:n.length===0?p.jsxs("div",{className:"library-empty",children:[p.jsx("div",{className:"library-empty-icon",children:p.jsx(Yi,{size:48})}),p.jsx("h3",{children:"Create your first playlist"}),p.jsx("p",{children:"Organize your favorite tracks"}),p.jsxs("button",{className:"library-create-button",onClick:r,children:[p.jsx(xl,{size:18})," Create Playlist"]})]}):n.map(i=>{var a,l;return p.jsxs("div",{className:"playlist-card",onClick:()=>s(i.id),children:[p.jsxs("div",{className:"playlist-card-artwork",children:[i.tracks.length>0&&((l=(a=i.tracks[0])==null?void 0:a.artwork)!=null&&l.medium)?p.jsx("img",{src:i.tracks[0].artwork.medium,alt:i.name,loading:"lazy"}):p.jsx("div",{className:"playlist-card-artwork-placeholder",children:p.jsx(Ye,{size:48})}),p.jsx("div",{className:"playlist-card-overlay",children:p.jsx("button",{className:"playlist-card-play",children:p.jsx(At,{size:24})})})]}),p.jsxs("div",{className:"playlist-card-info",children:[p.jsx("div",{className:"playlist-card-name",children:i.name}),p.jsxs("div",{className:"playlist-card-count",children:[i.tracks.length," songs"]})]}),p.jsx("button",{className:"playlist-card-delete",onClick:u=>o(u,i.id),title:"Delete playlist",children:p.jsx(ar,{size:16})})]},i.id)})})]})},Voe=()=>{var y,w,b,k,v;const{selectedPlaylistId:n,goBack:e}=on(),{playlists:t,renamePlaylist:s,removeFromPlaylist:r}=gs(),{play:o,setQueue:i,currentTrack:a}=yt(),l=t.find(N=>N.id===n);if(!l)return p.jsx("div",{className:"library-view",children:p.jsxs("div",{className:"library-empty",children:[p.jsx("h3",{children:"Playlist not found"}),p.jsx("button",{onClick:e,children:"Go back"})]})});const u=N=>{const S=l.tracks[N];S&&(i(l.tracks,N),o(S))},d=()=>{l.tracks.length>0&&(i(l.tracks,0),o(l.tracks[0]))},f=()=>{const N=prompt("Enter new name:",l.name);N!=null&&N.trim()&&N!==l.name&&s(l.id,N.trim())},m=(N,S)=>{N.stopPropagation(),r(l.id,S)},g=((w=(y=l.tracks[0])==null?void 0:y.artwork)==null?void 0:w.medium)??((v=(k=(b=l.tracks[0])==null?void 0:b.album)==null?void 0:k.artwork)==null?void 0:v.medium);return p.jsxs("div",{className:"library-view",children:[p.jsxs("header",{className:"library-header playlist-detail-header",children:[p.jsx("button",{className:"back-btn-round playlist-back-btn-pos",onClick:e,"aria-label":"Go back",children:p.jsx(ky,{size:20})}),p.jsx("div",{className:"playlist-detail-artwork",children:g?p.jsx("img",{src:g,alt:l.name}):p.jsx("div",{className:"playlist-detail-artwork-placeholder",children:p.jsx(Ye,{size:48})})}),p.jsxs("div",{className:"library-header-info",children:[p.jsx("span",{className:"library-header-type",children:"Playlist"}),p.jsx("h1",{className:"library-header-title",onClick:f,title:"Click to rename",children:l.name}),p.jsxs("span",{className:"library-header-count",children:[l.tracks.length," songs"]})]})]}),l.tracks.length>0&&p.jsx("div",{className:"library-actions",children:p.jsxs("button",{className:"library-play-button",onClick:d,children:[p.jsx(At,{size:18})," Play All"]})}),p.jsx("div",{className:"library-tracks",children:l.tracks.length===0?p.jsxs("div",{className:"library-empty",children:[p.jsx("div",{className:"library-empty-icon",children:p.jsx(Ye,{size:48})}),p.jsx("h3",{children:"This playlist is empty"}),p.jsx("p",{children:"Search for songs and add them here"})]}):p.jsx("div",{className:"results-list",children:l.tracks.map((N,S)=>p.jsxs("div",{className:"playlist-track-row",children:[p.jsx(tg,{track:N,index:S+1,isPlaying:(a==null?void 0:a.id)===N.id,onClick:()=>u(S)}),p.jsx("button",{className:"playlist-track-remove",onClick:$=>m($,N.id),title:"Remove from playlist",children:p.jsx(ar,{size:16})})]},N.id))})})]})},Woe=()=>{const{downloads:n,removeDownload:e,retryDownload:t}=gs(),{play:s,currentTrack:r}=yt(),o=n.filter(u=>u.status==="completed"),i=n.filter(u=>u.status!=="completed"),a=u=>{u.status==="completed"&&s(u.track)},l=u=>`${Math.round(u)}%`;return p.jsxs("div",{className:"library-view",children:[p.jsxs("header",{className:"library-header",children:[p.jsx("div",{className:"library-header-icon downloads-icon",children:p.jsx(gl,{size:64})}),p.jsxs("div",{className:"library-header-info",children:[p.jsx("span",{className:"library-header-type",children:"Library"}),p.jsx("h1",{className:"library-header-title",children:"Downloads"}),p.jsxs("span",{className:"library-header-count",children:[o.length," downloaded",i.length>0&&`  ${i.length} in progress`]})]})]}),p.jsxs("div",{className:"downloads-content",children:[i.length>0&&p.jsxs("section",{className:"downloads-section",children:[p.jsx("h2",{className:"downloads-section-title",children:"In Progress"}),p.jsx("div",{className:"downloads-list",children:i.map(u=>{var d;return p.jsxs("div",{className:"download-item",children:[p.jsx("div",{className:"download-artwork",children:(d=u.track.artwork)!=null&&d.medium?p.jsx("img",{src:u.track.artwork.medium,alt:u.track.title}):p.jsx("div",{className:"download-artwork-placeholder",children:p.jsx(Ye,{size:24})})}),p.jsxs("div",{className:"download-info",children:[p.jsx("div",{className:"download-title",children:u.track.title}),p.jsx("div",{className:"download-artist",children:u.track.artists.map(f=>f.name).join(", ")}),u.status==="downloading"&&p.jsxs("div",{className:"download-progress",children:[p.jsx("div",{className:"download-progress-bar",style:{"--progress":`${u.progress}%`}}),p.jsx("span",{className:"download-progress-text",children:l(u.progress)})]}),u.status==="pending"&&p.jsx("div",{className:"download-status",children:"Waiting..."}),u.status==="failed"&&p.jsx("div",{className:"download-status error",children:u.error||"Download failed"})]}),p.jsxs("div",{className:"download-actions",children:[u.status==="failed"&&p.jsx("button",{className:"download-retry",onClick:()=>t(u.track.id),title:"Retry",children:p.jsx(Pf,{size:18})}),p.jsx("button",{className:"download-remove",onClick:()=>e(u.track.id),title:"Cancel",children:p.jsx(ar,{size:18})})]})]},u.track.id)})})]}),p.jsxs("section",{className:"downloads-section",children:[p.jsx("h2",{className:"downloads-section-title",children:"Downloaded"}),o.length===0?p.jsxs("div",{className:"library-empty",children:[p.jsx("div",{className:"library-empty-icon",children:p.jsx(gl,{size:48})}),p.jsx("h3",{children:"No downloads yet"}),p.jsx("p",{children:"Download songs to listen offline"})]}):p.jsx("div",{className:"downloads-list",children:o.map(u=>{var d;return p.jsxs("div",{className:`download-item completed ${(r==null?void 0:r.id)===u.track.id?"playing":""}`,onClick:()=>a(u),children:[p.jsxs("div",{className:"download-artwork",children:[(d=u.track.artwork)!=null&&d.medium?p.jsx("img",{src:u.track.artwork.medium,alt:u.track.title}):p.jsx("div",{className:"download-artwork-placeholder",children:p.jsx(Ye,{size:24})}),p.jsx("div",{className:"download-play-overlay",children:p.jsx(At,{size:24})})]}),p.jsxs("div",{className:"download-info",children:[p.jsx("div",{className:"download-title",children:u.track.title}),p.jsx("div",{className:"download-artist",children:u.track.artists.map(f=>f.name).join(", ")}),p.jsx("div",{className:"download-status success",children:"Downloaded"})]}),p.jsx("button",{className:"download-remove",onClick:f=>{f.stopPropagation(),e(u.track.id)},title:"Remove",children:p.jsx(ar,{size:18})})]},u.track.id)})})]})]})]})};var il=LS();function Uoe(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];return L.useMemo(()=>s=>{e.forEach(r=>r(s))},e)}const ng=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function Jl(n){const e=Object.prototype.toString.call(n);return e==="[object Window]"||e==="[object global]"}function hb(n){return"nodeType"in n}function Fs(n){var e,t;return n?Jl(n)?n:hb(n)&&(e=(t=n.ownerDocument)==null?void 0:t.defaultView)!=null?e:window:window}function fb(n){const{Document:e}=Fs(n);return n instanceof e}function qd(n){return Jl(n)?!1:n instanceof Fs(n).HTMLElement}function VA(n){return n instanceof Fs(n).SVGElement}function Zl(n){return n?Jl(n)?n.document:hb(n)?fb(n)?n:qd(n)||VA(n)?n.ownerDocument:document:document:document}const ro=ng?L.useLayoutEffect:L.useEffect;function pb(n){const e=L.useRef(n);return ro(()=>{e.current=n}),L.useCallback(function(){for(var t=arguments.length,s=new Array(t),r=0;r<t;r++)s[r]=arguments[r];return e.current==null?void 0:e.current(...s)},[])}function Goe(){const n=L.useRef(null),e=L.useCallback((s,r)=>{n.current=setInterval(s,r)},[]),t=L.useCallback(()=>{n.current!==null&&(clearInterval(n.current),n.current=null)},[]);return[e,t]}function wu(n,e){e===void 0&&(e=[n]);const t=L.useRef(n);return ro(()=>{t.current!==n&&(t.current=n)},e),t}function Kd(n,e){const t=L.useRef();return L.useMemo(()=>{const s=n(t.current);return t.current=s,s},[...e])}function mp(n){const e=pb(n),t=L.useRef(null),s=L.useCallback(r=>{r!==t.current&&(e==null||e(r,t.current)),t.current=r},[]);return[t,s]}function my(n){const e=L.useRef();return L.useEffect(()=>{e.current=n},[n]),e.current}let b0={};function Xd(n,e){return L.useMemo(()=>{if(e)return e;const t=b0[n]==null?0:b0[n]+1;return b0[n]=t,n+"-"+t},[n,e])}function WA(n){return function(e){for(var t=arguments.length,s=new Array(t>1?t-1:0),r=1;r<t;r++)s[r-1]=arguments[r];return s.reduce((o,i)=>{const a=Object.entries(i);for(const[l,u]of a){const d=o[l];d!=null&&(o[l]=d+n*u)}return o},{...e})}}const pl=WA(1),ku=WA(-1);function Hoe(n){return"clientX"in n&&"clientY"in n}function mb(n){if(!n)return!1;const{KeyboardEvent:e}=Fs(n.target);return e&&n instanceof e}function qoe(n){if(!n)return!1;const{TouchEvent:e}=Fs(n.target);return e&&n instanceof e}function gy(n){if(qoe(n)){if(n.touches&&n.touches.length){const{clientX:e,clientY:t}=n.touches[0];return{x:e,y:t}}else if(n.changedTouches&&n.changedTouches.length){const{clientX:e,clientY:t}=n.changedTouches[0];return{x:e,y:t}}}return Hoe(n)?{x:n.clientX,y:n.clientY}:null}const Al=Object.freeze({Translate:{toString(n){if(!n)return;const{x:e,y:t}=n;return"translate3d("+(e?Math.round(e):0)+"px, "+(t?Math.round(t):0)+"px, 0)"}},Scale:{toString(n){if(!n)return;const{scaleX:e,scaleY:t}=n;return"scaleX("+e+") scaleY("+t+")"}},Transform:{toString(n){if(n)return[Al.Translate.toString(n),Al.Scale.toString(n)].join(" ")}},Transition:{toString(n){let{property:e,duration:t,easing:s}=n;return e+" "+t+"ms "+s}}}),gS="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function Koe(n){return n.matches(gS)?n:n.querySelector(gS)}const Xoe={display:"none"};function Qoe(n){let{id:e,value:t}=n;return Xt.createElement("div",{id:e,style:Xoe},t)}function Yoe(n){let{id:e,announcement:t,ariaLiveType:s="assertive"}=n;const r={position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"};return Xt.createElement("div",{id:e,style:r,role:"status","aria-live":s,"aria-atomic":!0},t)}function Joe(){const[n,e]=L.useState("");return{announce:L.useCallback(s=>{s!=null&&e(s)},[]),announcement:n}}const UA=L.createContext(null);function Zoe(n){const e=L.useContext(UA);L.useEffect(()=>{if(!e)throw new Error("useDndMonitor must be used within a children of <DndContext>");return e(n)},[n,e])}function eie(){const[n]=L.useState(()=>new Set),e=L.useCallback(s=>(n.add(s),()=>n.delete(s)),[n]);return[L.useCallback(s=>{let{type:r,event:o}=s;n.forEach(i=>{var a;return(a=i[r])==null?void 0:a.call(i,o)})},[n]),e]}const tie={draggable:`
    To pick up a draggable item, press the space bar.
    While dragging, use the arrow keys to move the item.
    Press space again to drop the item in its new position, or press escape to cancel.
  `},nie={onDragStart(n){let{active:e}=n;return"Picked up draggable item "+e.id+"."},onDragOver(n){let{active:e,over:t}=n;return t?"Draggable item "+e.id+" was moved over droppable area "+t.id+".":"Draggable item "+e.id+" is no longer over a droppable area."},onDragEnd(n){let{active:e,over:t}=n;return t?"Draggable item "+e.id+" was dropped over droppable area "+t.id:"Draggable item "+e.id+" was dropped."},onDragCancel(n){let{active:e}=n;return"Dragging was cancelled. Draggable item "+e.id+" was dropped."}};function sie(n){let{announcements:e=nie,container:t,hiddenTextDescribedById:s,screenReaderInstructions:r=tie}=n;const{announce:o,announcement:i}=Joe(),a=Xd("DndLiveRegion"),[l,u]=L.useState(!1);if(L.useEffect(()=>{u(!0)},[]),Zoe(L.useMemo(()=>({onDragStart(f){let{active:m}=f;o(e.onDragStart({active:m}))},onDragMove(f){let{active:m,over:g}=f;e.onDragMove&&o(e.onDragMove({active:m,over:g}))},onDragOver(f){let{active:m,over:g}=f;o(e.onDragOver({active:m,over:g}))},onDragEnd(f){let{active:m,over:g}=f;o(e.onDragEnd({active:m,over:g}))},onDragCancel(f){let{active:m,over:g}=f;o(e.onDragCancel({active:m,over:g}))}}),[o,e])),!l)return null;const d=Xt.createElement(Xt.Fragment,null,Xt.createElement(Qoe,{id:s,value:r.draggable}),Xt.createElement(Yoe,{id:a,announcement:i}));return t?il.createPortal(d,t):d}var bn;(function(n){n.DragStart="dragStart",n.DragMove="dragMove",n.DragEnd="dragEnd",n.DragCancel="dragCancel",n.DragOver="dragOver",n.RegisterDroppable="registerDroppable",n.SetDroppableDisabled="setDroppableDisabled",n.UnregisterDroppable="unregisterDroppable"})(bn||(bn={}));function gp(){}function xp(n,e){return L.useMemo(()=>({sensor:n,options:e??{}}),[n,e])}function GA(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];return L.useMemo(()=>[...e].filter(s=>s!=null),[...e])}const Pr=Object.freeze({x:0,y:0});function HA(n,e){return Math.sqrt(Math.pow(n.x-e.x,2)+Math.pow(n.y-e.y,2))}function qA(n,e){let{data:{value:t}}=n,{data:{value:s}}=e;return t-s}function rie(n,e){let{data:{value:t}}=n,{data:{value:s}}=e;return s-t}function xS(n){let{left:e,top:t,height:s,width:r}=n;return[{x:e,y:t},{x:e+r,y:t},{x:e,y:t+s},{x:e+r,y:t+s}]}function KA(n,e){if(!n||n.length===0)return null;const[t]=n;return t[e]}function yS(n,e,t){return e===void 0&&(e=n.left),t===void 0&&(t=n.top),{x:e+n.width*.5,y:t+n.height*.5}}const XA=n=>{let{collisionRect:e,droppableRects:t,droppableContainers:s}=n;const r=yS(e,e.left,e.top),o=[];for(const i of s){const{id:a}=i,l=t.get(a);if(l){const u=HA(yS(l),r);o.push({id:a,data:{droppableContainer:i,value:u}})}}return o.sort(qA)},oie=n=>{let{collisionRect:e,droppableRects:t,droppableContainers:s}=n;const r=xS(e),o=[];for(const i of s){const{id:a}=i,l=t.get(a);if(l){const u=xS(l),d=r.reduce((m,g,y)=>m+HA(u[y],g),0),f=Number((d/4).toFixed(4));o.push({id:a,data:{droppableContainer:i,value:f}})}}return o.sort(qA)};function iie(n,e){const t=Math.max(e.top,n.top),s=Math.max(e.left,n.left),r=Math.min(e.left+e.width,n.left+n.width),o=Math.min(e.top+e.height,n.top+n.height),i=r-s,a=o-t;if(s<r&&t<o){const l=e.width*e.height,u=n.width*n.height,d=i*a,f=d/(l+u-d);return Number(f.toFixed(4))}return 0}const aie=n=>{let{collisionRect:e,droppableRects:t,droppableContainers:s}=n;const r=[];for(const o of s){const{id:i}=o,a=t.get(i);if(a){const l=iie(a,e);l>0&&r.push({id:i,data:{droppableContainer:o,value:l}})}}return r.sort(rie)};function lie(n,e,t){return{...n,scaleX:e&&t?e.width/t.width:1,scaleY:e&&t?e.height/t.height:1}}function QA(n,e){return n&&e?{x:n.left-e.left,y:n.top-e.top}:Pr}function cie(n){return function(t){for(var s=arguments.length,r=new Array(s>1?s-1:0),o=1;o<s;o++)r[o-1]=arguments[o];return r.reduce((i,a)=>({...i,top:i.top+n*a.y,bottom:i.bottom+n*a.y,left:i.left+n*a.x,right:i.right+n*a.x}),{...t})}}const uie=cie(1);function die(n){if(n.startsWith("matrix3d(")){const e=n.slice(9,-1).split(/, /);return{x:+e[12],y:+e[13],scaleX:+e[0],scaleY:+e[5]}}else if(n.startsWith("matrix(")){const e=n.slice(7,-1).split(/, /);return{x:+e[4],y:+e[5],scaleX:+e[0],scaleY:+e[3]}}return null}function hie(n,e,t){const s=die(e);if(!s)return n;const{scaleX:r,scaleY:o,x:i,y:a}=s,l=n.left-i-(1-r)*parseFloat(t),u=n.top-a-(1-o)*parseFloat(t.slice(t.indexOf(" ")+1)),d=r?n.width/r:n.width,f=o?n.height/o:n.height;return{width:d,height:f,top:u,right:l+d,bottom:u+f,left:l}}const fie={ignoreTransform:!1};function ec(n,e){e===void 0&&(e=fie);let t=n.getBoundingClientRect();if(e.ignoreTransform){const{transform:u,transformOrigin:d}=Fs(n).getComputedStyle(n);u&&(t=hie(t,u,d))}const{top:s,left:r,width:o,height:i,bottom:a,right:l}=t;return{top:s,left:r,width:o,height:i,bottom:a,right:l}}function vS(n){return ec(n,{ignoreTransform:!0})}function pie(n){const e=n.innerWidth,t=n.innerHeight;return{top:0,left:0,right:e,bottom:t,width:e,height:t}}function mie(n,e){return e===void 0&&(e=Fs(n).getComputedStyle(n)),e.position==="fixed"}function gie(n,e){e===void 0&&(e=Fs(n).getComputedStyle(n));const t=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(r=>{const o=e[r];return typeof o=="string"?t.test(o):!1})}function sg(n,e){const t=[];function s(r){if(e!=null&&t.length>=e||!r)return t;if(fb(r)&&r.scrollingElement!=null&&!t.includes(r.scrollingElement))return t.push(r.scrollingElement),t;if(!qd(r)||VA(r)||t.includes(r))return t;const o=Fs(n).getComputedStyle(r);return r!==n&&gie(r,o)&&t.push(r),mie(r,o)?t:s(r.parentNode)}return n?s(n):t}function YA(n){const[e]=sg(n,1);return e??null}function w0(n){return!ng||!n?null:Jl(n)?n:hb(n)?fb(n)||n===Zl(n).scrollingElement?window:qd(n)?n:null:null}function JA(n){return Jl(n)?n.scrollX:n.scrollLeft}function ZA(n){return Jl(n)?n.scrollY:n.scrollTop}function xy(n){return{x:JA(n),y:ZA(n)}}var Tn;(function(n){n[n.Forward=1]="Forward",n[n.Backward=-1]="Backward"})(Tn||(Tn={}));function eD(n){return!ng||!n?!1:n===document.scrollingElement}function tD(n){const e={x:0,y:0},t=eD(n)?{height:window.innerHeight,width:window.innerWidth}:{height:n.clientHeight,width:n.clientWidth},s={x:n.scrollWidth-t.width,y:n.scrollHeight-t.height},r=n.scrollTop<=e.y,o=n.scrollLeft<=e.x,i=n.scrollTop>=s.y,a=n.scrollLeft>=s.x;return{isTop:r,isLeft:o,isBottom:i,isRight:a,maxScroll:s,minScroll:e}}const xie={x:.2,y:.2};function yie(n,e,t,s,r){let{top:o,left:i,right:a,bottom:l}=t;s===void 0&&(s=10),r===void 0&&(r=xie);const{isTop:u,isBottom:d,isLeft:f,isRight:m}=tD(n),g={x:0,y:0},y={x:0,y:0},w={height:e.height*r.y,width:e.width*r.x};return!u&&o<=e.top+w.height?(g.y=Tn.Backward,y.y=s*Math.abs((e.top+w.height-o)/w.height)):!d&&l>=e.bottom-w.height&&(g.y=Tn.Forward,y.y=s*Math.abs((e.bottom-w.height-l)/w.height)),!m&&a>=e.right-w.width?(g.x=Tn.Forward,y.x=s*Math.abs((e.right-w.width-a)/w.width)):!f&&i<=e.left+w.width&&(g.x=Tn.Backward,y.x=s*Math.abs((e.left+w.width-i)/w.width)),{direction:g,speed:y}}function vie(n){if(n===document.scrollingElement){const{innerWidth:o,innerHeight:i}=window;return{top:0,left:0,right:o,bottom:i,width:o,height:i}}const{top:e,left:t,right:s,bottom:r}=n.getBoundingClientRect();return{top:e,left:t,right:s,bottom:r,width:n.clientWidth,height:n.clientHeight}}function nD(n){return n.reduce((e,t)=>pl(e,xy(t)),Pr)}function bie(n){return n.reduce((e,t)=>e+JA(t),0)}function wie(n){return n.reduce((e,t)=>e+ZA(t),0)}function kie(n,e){if(e===void 0&&(e=ec),!n)return;const{top:t,left:s,bottom:r,right:o}=e(n);YA(n)&&(r<=0||o<=0||t>=window.innerHeight||s>=window.innerWidth)&&n.scrollIntoView({block:"center",inline:"center"})}const Cie=[["x",["left","right"],bie],["y",["top","bottom"],wie]];class gb{constructor(e,t){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const s=sg(t),r=nD(s);this.rect={...e},this.width=e.width,this.height=e.height;for(const[o,i,a]of Cie)for(const l of i)Object.defineProperty(this,l,{get:()=>{const u=a(s),d=r[o]-u;return this.rect[l]+d},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class ru{constructor(e){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(t=>{var s;return(s=this.target)==null?void 0:s.removeEventListener(...t)})},this.target=e}add(e,t,s){var r;(r=this.target)==null||r.addEventListener(e,t,s),this.listeners.push([e,t,s])}}function Sie(n){const{EventTarget:e}=Fs(n);return n instanceof e?n:Zl(n)}function k0(n,e){const t=Math.abs(n.x),s=Math.abs(n.y);return typeof e=="number"?Math.sqrt(t**2+s**2)>e:"x"in e&&"y"in e?t>e.x&&s>e.y:"x"in e?t>e.x:"y"in e?s>e.y:!1}var sr;(function(n){n.Click="click",n.DragStart="dragstart",n.Keydown="keydown",n.ContextMenu="contextmenu",n.Resize="resize",n.SelectionChange="selectionchange",n.VisibilityChange="visibilitychange"})(sr||(sr={}));function bS(n){n.preventDefault()}function Nie(n){n.stopPropagation()}var lt;(function(n){n.Space="Space",n.Down="ArrowDown",n.Right="ArrowRight",n.Left="ArrowLeft",n.Up="ArrowUp",n.Esc="Escape",n.Enter="Enter",n.Tab="Tab"})(lt||(lt={}));const sD={start:[lt.Space,lt.Enter],cancel:[lt.Esc],end:[lt.Space,lt.Enter,lt.Tab]},Iie=(n,e)=>{let{currentCoordinates:t}=e;switch(n.code){case lt.Right:return{...t,x:t.x+25};case lt.Left:return{...t,x:t.x-25};case lt.Down:return{...t,y:t.y+25};case lt.Up:return{...t,y:t.y-25}}};class rg{constructor(e){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=e;const{event:{target:t}}=e;this.props=e,this.listeners=new ru(Zl(t)),this.windowListeners=new ru(Fs(t)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(sr.Resize,this.handleCancel),this.windowListeners.add(sr.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(sr.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:e,onStart:t}=this.props,s=e.node.current;s&&kie(s),t(Pr)}handleKeyDown(e){if(mb(e)){const{active:t,context:s,options:r}=this.props,{keyboardCodes:o=sD,coordinateGetter:i=Iie,scrollBehavior:a="smooth"}=r,{code:l}=e;if(o.end.includes(l)){this.handleEnd(e);return}if(o.cancel.includes(l)){this.handleCancel(e);return}const{collisionRect:u}=s.current,d=u?{x:u.left,y:u.top}:Pr;this.referenceCoordinates||(this.referenceCoordinates=d);const f=i(e,{active:t,context:s.current,currentCoordinates:d});if(f){const m=ku(f,d),g={x:0,y:0},{scrollableAncestors:y}=s.current;for(const w of y){const b=e.code,{isTop:k,isRight:v,isLeft:N,isBottom:S,maxScroll:$,minScroll:R}=tD(w),M=vie(w),A={x:Math.min(b===lt.Right?M.right-M.width/2:M.right,Math.max(b===lt.Right?M.left:M.left+M.width/2,f.x)),y:Math.min(b===lt.Down?M.bottom-M.height/2:M.bottom,Math.max(b===lt.Down?M.top:M.top+M.height/2,f.y))},P=b===lt.Right&&!v||b===lt.Left&&!N,D=b===lt.Down&&!S||b===lt.Up&&!k;if(P&&A.x!==f.x){const E=w.scrollLeft+m.x,j=b===lt.Right&&E<=$.x||b===lt.Left&&E>=R.x;if(j&&!m.y){w.scrollTo({left:E,behavior:a});return}j?g.x=w.scrollLeft-E:g.x=b===lt.Right?w.scrollLeft-$.x:w.scrollLeft-R.x,g.x&&w.scrollBy({left:-g.x,behavior:a});break}else if(D&&A.y!==f.y){const E=w.scrollTop+m.y,j=b===lt.Down&&E<=$.y||b===lt.Up&&E>=R.y;if(j&&!m.x){w.scrollTo({top:E,behavior:a});return}j?g.y=w.scrollTop-E:g.y=b===lt.Down?w.scrollTop-$.y:w.scrollTop-R.y,g.y&&w.scrollBy({top:-g.y,behavior:a});break}}this.handleMove(e,pl(ku(f,this.referenceCoordinates),g))}}}handleMove(e,t){const{onMove:s}=this.props;e.preventDefault(),s(t)}handleEnd(e){const{onEnd:t}=this.props;e.preventDefault(),this.detach(),t()}handleCancel(e){const{onCancel:t}=this.props;e.preventDefault(),this.detach(),t()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}rg.activators=[{eventName:"onKeyDown",handler:(n,e,t)=>{let{keyboardCodes:s=sD,onActivation:r}=e,{active:o}=t;const{code:i}=n.nativeEvent;if(s.start.includes(i)){const a=o.activatorNode.current;return a&&n.target!==a?!1:(n.preventDefault(),r==null||r({event:n.nativeEvent}),!0)}return!1}}];function wS(n){return!!(n&&"distance"in n)}function kS(n){return!!(n&&"delay"in n)}class xb{constructor(e,t,s){var r;s===void 0&&(s=Sie(e.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=e,this.events=t;const{event:o}=e,{target:i}=o;this.props=e,this.events=t,this.document=Zl(i),this.documentListeners=new ru(this.document),this.listeners=new ru(s),this.windowListeners=new ru(Fs(i)),this.initialCoordinates=(r=gy(o))!=null?r:Pr,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:e,props:{options:{activationConstraint:t,bypassActivationConstraint:s}}}=this;if(this.listeners.add(e.move.name,this.handleMove,{passive:!1}),this.listeners.add(e.end.name,this.handleEnd),e.cancel&&this.listeners.add(e.cancel.name,this.handleCancel),this.windowListeners.add(sr.Resize,this.handleCancel),this.windowListeners.add(sr.DragStart,bS),this.windowListeners.add(sr.VisibilityChange,this.handleCancel),this.windowListeners.add(sr.ContextMenu,bS),this.documentListeners.add(sr.Keydown,this.handleKeydown),t){if(s!=null&&s({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(kS(t)){this.timeoutId=setTimeout(this.handleStart,t.delay),this.handlePending(t);return}if(wS(t)){this.handlePending(t);return}}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),this.timeoutId!==null&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(e,t){const{active:s,onPending:r}=this.props;r(s,e,this.initialCoordinates,t)}handleStart(){const{initialCoordinates:e}=this,{onStart:t}=this.props;e&&(this.activated=!0,this.documentListeners.add(sr.Click,Nie,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(sr.SelectionChange,this.removeTextSelection),t(e))}handleMove(e){var t;const{activated:s,initialCoordinates:r,props:o}=this,{onMove:i,options:{activationConstraint:a}}=o;if(!r)return;const l=(t=gy(e))!=null?t:Pr,u=ku(r,l);if(!s&&a){if(wS(a)){if(a.tolerance!=null&&k0(u,a.tolerance))return this.handleCancel();if(k0(u,a.distance))return this.handleStart()}if(kS(a)&&k0(u,a.tolerance))return this.handleCancel();this.handlePending(a,u);return}e.cancelable&&e.preventDefault(),i(l)}handleEnd(){const{onAbort:e,onEnd:t}=this.props;this.detach(),this.activated||e(this.props.active),t()}handleCancel(){const{onAbort:e,onCancel:t}=this.props;this.detach(),this.activated||e(this.props.active),t()}handleKeydown(e){e.code===lt.Esc&&this.handleCancel()}removeTextSelection(){var e;(e=this.document.getSelection())==null||e.removeAllRanges()}}const $ie={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class og extends xb{constructor(e){const{event:t}=e,s=Zl(t.target);super(e,$ie,s)}}og.activators=[{eventName:"onPointerDown",handler:(n,e)=>{let{nativeEvent:t}=n,{onActivation:s}=e;return!t.isPrimary||t.button!==0?!1:(s==null||s({event:t}),!0)}}];const Tie={move:{name:"mousemove"},end:{name:"mouseup"}};var yy;(function(n){n[n.RightClick=2]="RightClick"})(yy||(yy={}));class Eie extends xb{constructor(e){super(e,Tie,Zl(e.event.target))}}Eie.activators=[{eventName:"onMouseDown",handler:(n,e)=>{let{nativeEvent:t}=n,{onActivation:s}=e;return t.button===yy.RightClick?!1:(s==null||s({event:t}),!0)}}];const C0={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};class Rie extends xb{constructor(e){super(e,C0)}static setup(){return window.addEventListener(C0.move.name,e,{capture:!1,passive:!1}),function(){window.removeEventListener(C0.move.name,e)};function e(){}}}Rie.activators=[{eventName:"onTouchStart",handler:(n,e)=>{let{nativeEvent:t}=n,{onActivation:s}=e;const{touches:r}=t;return r.length>1?!1:(s==null||s({event:t}),!0)}}];var ou;(function(n){n[n.Pointer=0]="Pointer",n[n.DraggableRect=1]="DraggableRect"})(ou||(ou={}));var yp;(function(n){n[n.TreeOrder=0]="TreeOrder",n[n.ReversedTreeOrder=1]="ReversedTreeOrder"})(yp||(yp={}));function Aie(n){let{acceleration:e,activator:t=ou.Pointer,canScroll:s,draggingRect:r,enabled:o,interval:i=5,order:a=yp.TreeOrder,pointerCoordinates:l,scrollableAncestors:u,scrollableAncestorRects:d,delta:f,threshold:m}=n;const g=Mie({delta:f,disabled:!o}),[y,w]=Goe(),b=L.useRef({x:0,y:0}),k=L.useRef({x:0,y:0}),v=L.useMemo(()=>{switch(t){case ou.Pointer:return l?{top:l.y,bottom:l.y,left:l.x,right:l.x}:null;case ou.DraggableRect:return r}},[t,r,l]),N=L.useRef(null),S=L.useCallback(()=>{const R=N.current;if(!R)return;const M=b.current.x*k.current.x,A=b.current.y*k.current.y;R.scrollBy(M,A)},[]),$=L.useMemo(()=>a===yp.TreeOrder?[...u].reverse():u,[a,u]);L.useEffect(()=>{if(!o||!u.length||!v){w();return}for(const R of $){if((s==null?void 0:s(R))===!1)continue;const M=u.indexOf(R),A=d[M];if(!A)continue;const{direction:P,speed:D}=yie(R,A,v,e,m);for(const E of["x","y"])g[E][P[E]]||(D[E]=0,P[E]=0);if(D.x>0||D.y>0){w(),N.current=R,y(S,i),b.current=D,k.current=P;return}}b.current={x:0,y:0},k.current={x:0,y:0},w()},[e,S,s,w,o,i,JSON.stringify(v),JSON.stringify(g),y,u,$,d,JSON.stringify(m)])}const Die={x:{[Tn.Backward]:!1,[Tn.Forward]:!1},y:{[Tn.Backward]:!1,[Tn.Forward]:!1}};function Mie(n){let{delta:e,disabled:t}=n;const s=my(e);return Kd(r=>{if(t||!s||!r)return Die;const o={x:Math.sign(e.x-s.x),y:Math.sign(e.y-s.y)};return{x:{[Tn.Backward]:r.x[Tn.Backward]||o.x===-1,[Tn.Forward]:r.x[Tn.Forward]||o.x===1},y:{[Tn.Backward]:r.y[Tn.Backward]||o.y===-1,[Tn.Forward]:r.y[Tn.Forward]||o.y===1}}},[t,e,s])}function Pie(n,e){const t=e!=null?n.get(e):void 0,s=t?t.node.current:null;return Kd(r=>{var o;return e==null?null:(o=s??r)!=null?o:null},[s,e])}function Fie(n,e){return L.useMemo(()=>n.reduce((t,s)=>{const{sensor:r}=s,o=r.activators.map(i=>({eventName:i.eventName,handler:e(i.handler,s)}));return[...t,...o]},[]),[n,e])}var Cu;(function(n){n[n.Always=0]="Always",n[n.BeforeDragging=1]="BeforeDragging",n[n.WhileDragging=2]="WhileDragging"})(Cu||(Cu={}));var vy;(function(n){n.Optimized="optimized"})(vy||(vy={}));const CS=new Map;function Lie(n,e){let{dragging:t,dependencies:s,config:r}=e;const[o,i]=L.useState(null),{frequency:a,measure:l,strategy:u}=r,d=L.useRef(n),f=b(),m=wu(f),g=L.useCallback(function(k){k===void 0&&(k=[]),!m.current&&i(v=>v===null?k:v.concat(k.filter(N=>!v.includes(N))))},[m]),y=L.useRef(null),w=Kd(k=>{if(f&&!t)return CS;if(!k||k===CS||d.current!==n||o!=null){const v=new Map;for(let N of n){if(!N)continue;if(o&&o.length>0&&!o.includes(N.id)&&N.rect.current){v.set(N.id,N.rect.current);continue}const S=N.node.current,$=S?new gb(l(S),S):null;N.rect.current=$,$&&v.set(N.id,$)}return v}return k},[n,o,t,f,l]);return L.useEffect(()=>{d.current=n},[n]),L.useEffect(()=>{f||g()},[t,f]),L.useEffect(()=>{o&&o.length>0&&i(null)},[JSON.stringify(o)]),L.useEffect(()=>{f||typeof a!="number"||y.current!==null||(y.current=setTimeout(()=>{g(),y.current=null},a))},[a,f,g,...s]),{droppableRects:w,measureDroppableContainers:g,measuringScheduled:o!=null};function b(){switch(u){case Cu.Always:return!1;case Cu.BeforeDragging:return t;default:return!t}}}function rD(n,e){return Kd(t=>n?t||(typeof e=="function"?e(n):n):null,[e,n])}function jie(n,e){return rD(n,e)}function Oie(n){let{callback:e,disabled:t}=n;const s=pb(e),r=L.useMemo(()=>{if(t||typeof window>"u"||typeof window.MutationObserver>"u")return;const{MutationObserver:o}=window;return new o(s)},[s,t]);return L.useEffect(()=>()=>r==null?void 0:r.disconnect(),[r]),r}function ig(n){let{callback:e,disabled:t}=n;const s=pb(e),r=L.useMemo(()=>{if(t||typeof window>"u"||typeof window.ResizeObserver>"u")return;const{ResizeObserver:o}=window;return new o(s)},[t]);return L.useEffect(()=>()=>r==null?void 0:r.disconnect(),[r]),r}function _ie(n){return new gb(ec(n),n)}function SS(n,e,t){e===void 0&&(e=_ie);const[s,r]=L.useState(null);function o(){r(l=>{if(!n)return null;if(n.isConnected===!1){var u;return(u=l??t)!=null?u:null}const d=e(n);return JSON.stringify(l)===JSON.stringify(d)?l:d})}const i=Oie({callback(l){if(n)for(const u of l){const{type:d,target:f}=u;if(d==="childList"&&f instanceof HTMLElement&&f.contains(n)){o();break}}}}),a=ig({callback:o});return ro(()=>{o(),n?(a==null||a.observe(n),i==null||i.observe(document.body,{childList:!0,subtree:!0})):(a==null||a.disconnect(),i==null||i.disconnect())},[n]),s}function zie(n){const e=rD(n);return QA(n,e)}const NS=[];function Bie(n){const e=L.useRef(n),t=Kd(s=>n?s&&s!==NS&&n&&e.current&&n.parentNode===e.current.parentNode?s:sg(n):NS,[n]);return L.useEffect(()=>{e.current=n},[n]),t}function Vie(n){const[e,t]=L.useState(null),s=L.useRef(n),r=L.useCallback(o=>{const i=w0(o.target);i&&t(a=>a?(a.set(i,xy(i)),new Map(a)):null)},[]);return L.useEffect(()=>{const o=s.current;if(n!==o){i(o);const a=n.map(l=>{const u=w0(l);return u?(u.addEventListener("scroll",r,{passive:!0}),[u,xy(u)]):null}).filter(l=>l!=null);t(a.length?new Map(a):null),s.current=n}return()=>{i(n),i(o)};function i(a){a.forEach(l=>{const u=w0(l);u==null||u.removeEventListener("scroll",r)})}},[r,n]),L.useMemo(()=>n.length?e?Array.from(e.values()).reduce((o,i)=>pl(o,i),Pr):nD(n):Pr,[n,e])}function IS(n,e){e===void 0&&(e=[]);const t=L.useRef(null);return L.useEffect(()=>{t.current=null},e),L.useEffect(()=>{const s=n!==Pr;s&&!t.current&&(t.current=n),!s&&t.current&&(t.current=null)},[n]),t.current?ku(n,t.current):Pr}function Wie(n){L.useEffect(()=>{if(!ng)return;const e=n.map(t=>{let{sensor:s}=t;return s.setup==null?void 0:s.setup()});return()=>{for(const t of e)t==null||t()}},n.map(e=>{let{sensor:t}=e;return t}))}function Uie(n,e){return L.useMemo(()=>n.reduce((t,s)=>{let{eventName:r,handler:o}=s;return t[r]=i=>{o(i,e)},t},{}),[n,e])}function oD(n){return L.useMemo(()=>n?pie(n):null,[n])}const $S=[];function Gie(n,e){e===void 0&&(e=ec);const[t]=n,s=oD(t?Fs(t):null),[r,o]=L.useState($S);function i(){o(()=>n.length?n.map(l=>eD(l)?s:new gb(e(l),l)):$S)}const a=ig({callback:i});return ro(()=>{a==null||a.disconnect(),i(),n.forEach(l=>a==null?void 0:a.observe(l))},[n]),r}function Hie(n){if(!n)return null;if(n.children.length>1)return n;const e=n.children[0];return qd(e)?e:n}function qie(n){let{measure:e}=n;const[t,s]=L.useState(null),r=L.useCallback(u=>{for(const{target:d}of u)if(qd(d)){s(f=>{const m=e(d);return f?{...f,width:m.width,height:m.height}:m});break}},[e]),o=ig({callback:r}),i=L.useCallback(u=>{const d=Hie(u);o==null||o.disconnect(),d&&(o==null||o.observe(d)),s(d?e(d):null)},[e,o]),[a,l]=mp(i);return L.useMemo(()=>({nodeRef:a,rect:t,setRef:l}),[t,a,l])}const Kie=[{sensor:og,options:{}},{sensor:rg,options:{}}],Xie={current:{}},Df={draggable:{measure:vS},droppable:{measure:vS,strategy:Cu.WhileDragging,frequency:vy.Optimized},dragOverlay:{measure:ec}};class iu extends Map{get(e){var t;return e!=null&&(t=super.get(e))!=null?t:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(e=>{let{disabled:t}=e;return!t})}getNodeFor(e){var t,s;return(t=(s=this.get(e))==null?void 0:s.node.current)!=null?t:void 0}}const Qie={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new iu,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:gp},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:Df,measureDroppableContainers:gp,windowRect:null,measuringScheduled:!1},Yie={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:gp,draggableNodes:new Map,over:null,measureDroppableContainers:gp},ag=L.createContext(Yie),iD=L.createContext(Qie);function Jie(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new iu}}}function Zie(n,e){switch(e.type){case bn.DragStart:return{...n,draggable:{...n.draggable,initialCoordinates:e.initialCoordinates,active:e.active}};case bn.DragMove:return n.draggable.active==null?n:{...n,draggable:{...n.draggable,translate:{x:e.coordinates.x-n.draggable.initialCoordinates.x,y:e.coordinates.y-n.draggable.initialCoordinates.y}}};case bn.DragEnd:case bn.DragCancel:return{...n,draggable:{...n.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case bn.RegisterDroppable:{const{element:t}=e,{id:s}=t,r=new iu(n.droppable.containers);return r.set(s,t),{...n,droppable:{...n.droppable,containers:r}}}case bn.SetDroppableDisabled:{const{id:t,key:s,disabled:r}=e,o=n.droppable.containers.get(t);if(!o||s!==o.key)return n;const i=new iu(n.droppable.containers);return i.set(t,{...o,disabled:r}),{...n,droppable:{...n.droppable,containers:i}}}case bn.UnregisterDroppable:{const{id:t,key:s}=e,r=n.droppable.containers.get(t);if(!r||s!==r.key)return n;const o=new iu(n.droppable.containers);return o.delete(t),{...n,droppable:{...n.droppable,containers:o}}}default:return n}}function eae(n){let{disabled:e}=n;const{active:t,activatorEvent:s,draggableNodes:r}=L.useContext(ag),o=my(s),i=my(t==null?void 0:t.id);return L.useEffect(()=>{if(!e&&!s&&o&&i!=null){if(!mb(o)||document.activeElement===o.target)return;const a=r.get(i);if(!a)return;const{activatorNode:l,node:u}=a;if(!l.current&&!u.current)return;requestAnimationFrame(()=>{for(const d of[l.current,u.current]){if(!d)continue;const f=Koe(d);if(f){f.focus();break}}})}},[s,e,r,i,o]),null}function tae(n,e){let{transform:t,...s}=e;return n!=null&&n.length?n.reduce((r,o)=>o({transform:r,...s}),t):t}function nae(n){return L.useMemo(()=>({draggable:{...Df.draggable,...n==null?void 0:n.draggable},droppable:{...Df.droppable,...n==null?void 0:n.droppable},dragOverlay:{...Df.dragOverlay,...n==null?void 0:n.dragOverlay}}),[n==null?void 0:n.draggable,n==null?void 0:n.droppable,n==null?void 0:n.dragOverlay])}function sae(n){let{activeNode:e,measure:t,initialRect:s,config:r=!0}=n;const o=L.useRef(!1),{x:i,y:a}=typeof r=="boolean"?{x:r,y:r}:r;ro(()=>{if(!i&&!a||!e){o.current=!1;return}if(o.current||!s)return;const u=e==null?void 0:e.node.current;if(!u||u.isConnected===!1)return;const d=t(u),f=QA(d,s);if(i||(f.x=0),a||(f.y=0),o.current=!0,Math.abs(f.x)>0||Math.abs(f.y)>0){const m=YA(u);m&&m.scrollBy({top:f.y,left:f.x})}},[e,i,a,s,t])}const aD=L.createContext({...Pr,scaleX:1,scaleY:1});var Jo;(function(n){n[n.Uninitialized=0]="Uninitialized",n[n.Initializing=1]="Initializing",n[n.Initialized=2]="Initialized"})(Jo||(Jo={}));const lD=L.memo(function(e){var t,s,r,o;let{id:i,accessibility:a,autoScroll:l=!0,children:u,sensors:d=Kie,collisionDetection:f=aie,measuring:m,modifiers:g,...y}=e;const w=L.useReducer(Zie,void 0,Jie),[b,k]=w,[v,N]=eie(),[S,$]=L.useState(Jo.Uninitialized),R=S===Jo.Initialized,{draggable:{active:M,nodes:A,translate:P},droppable:{containers:D}}=b,E=M!=null?A.get(M):null,j=L.useRef({initial:null,translated:null}),V=L.useMemo(()=>{var Vt;return M!=null?{id:M,data:(Vt=E==null?void 0:E.data)!=null?Vt:Xie,rect:j}:null},[M,E]),W=L.useRef(null),[U,X]=L.useState(null),[ee,G]=L.useState(null),z=wu(y,Object.values(y)),H=Xd("DndDescribedBy",i),O=L.useMemo(()=>D.getEnabled(),[D]),B=nae(m),{droppableRects:Y,measureDroppableContainers:oe,measuringScheduled:Q}=Lie(O,{dragging:R,dependencies:[P.x,P.y],config:B.droppable}),ce=Pie(A,M),me=L.useMemo(()=>ee?gy(ee):null,[ee]),ge=Ro(),ve=jie(ce,B.draggable.measure);sae({activeNode:M!=null?A.get(M):null,config:ge.layoutShiftCompensation,initialRect:ve,measure:B.draggable.measure});const Ne=SS(ce,B.draggable.measure,ve),Me=SS(ce?ce.parentElement:null),Ue=L.useRef({activatorEvent:null,active:null,activeNode:ce,collisionRect:null,collisions:null,droppableRects:Y,draggableNodes:A,draggingNode:null,draggingNodeRect:null,droppableContainers:D,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),Qe=D.getNodeFor((t=Ue.current.over)==null?void 0:t.id),ye=qie({measure:B.dragOverlay.measure}),Ce=(s=ye.nodeRef.current)!=null?s:ce,be=R?(r=ye.rect)!=null?r:Ne:null,xe=!!(ye.nodeRef.current&&ye.rect),Be=zie(xe?null:Ne),Dt=oD(Ce?Fs(Ce):null),at=Bie(R?Qe??ce:null),Ht=Gie(at),Mt=tae(g,{transform:{x:P.x-Be.x,y:P.y-Be.y,scaleX:1,scaleY:1},activatorEvent:ee,active:V,activeNodeRect:Ne,containerNodeRect:Me,draggingNodeRect:be,over:Ue.current.over,overlayNodeRect:ye.rect,scrollableAncestors:at,scrollableAncestorRects:Ht,windowRect:Dt}),is=me?pl(me,P):null,ln=Vie(at),Fn=IS(ln),Gn=IS(ln,[Ne]),qt=pl(Mt,Fn),Le=be?uie(be,Mt):null,et=V&&Le?f({active:V,collisionRect:Le,droppableRects:Y,droppableContainers:O,pointerCoordinates:is}):null,vt=KA(et,"id"),[Nt,Ia]=L.useState(null),io=xe?Mt:pl(Mt,Gn),$a=lie(io,(o=Nt==null?void 0:Nt.rect)!=null?o:null,Ne),Si=L.useRef(null),Ta=L.useCallback((Vt,Hn)=>{let{sensor:qn,options:fr}=Hn;if(W.current==null)return;const as=A.get(W.current);if(!as)return;const Kn=Vt.nativeEvent,bs=new qn({active:W.current,activeNode:as,event:Kn,options:fr,context:Ue,onAbort(Wt){if(!A.get(Wt))return;const{onDragAbort:Xn}=z.current,pr={id:Wt};Xn==null||Xn(pr),v({type:"onDragAbort",event:pr})},onPending(Wt,qs,Xn,pr){if(!A.get(Wt))return;const{onDragPending:Lr}=z.current,Ls={id:Wt,constraint:qs,initialCoordinates:Xn,offset:pr};Lr==null||Lr(Ls),v({type:"onDragPending",event:Ls})},onStart(Wt){const qs=W.current;if(qs==null)return;const Xn=A.get(qs);if(!Xn)return;const{onDragStart:pr}=z.current,mr={activatorEvent:Kn,active:{id:qs,data:Xn.data,rect:j}};il.unstable_batchedUpdates(()=>{pr==null||pr(mr),$(Jo.Initializing),k({type:bn.DragStart,initialCoordinates:Wt,active:qs}),v({type:"onDragStart",event:mr}),X(Si.current),G(Kn)})},onMove(Wt){k({type:bn.DragMove,coordinates:Wt})},onEnd:ao(bn.DragEnd),onCancel:ao(bn.DragCancel)});Si.current=bs;function ao(Wt){return async function(){const{active:Xn,collisions:pr,over:mr,scrollAdjustedTranslate:Lr}=Ue.current;let Ls=null;if(Xn&&Lr){const{cancelDrop:lo}=z.current;Ls={activatorEvent:Kn,active:Xn,collisions:pr,delta:Lr,over:mr},Wt===bn.DragEnd&&typeof lo=="function"&&await Promise.resolve(lo(Ls))&&(Wt=bn.DragCancel)}W.current=null,il.unstable_batchedUpdates(()=>{k({type:Wt}),$(Jo.Uninitialized),Ia(null),X(null),G(null),Si.current=null;const lo=Wt===bn.DragEnd?"onDragEnd":"onDragCancel";if(Ls){const rc=z.current[lo];rc==null||rc(Ls),v({type:lo,event:Ls})}})}}},[A]),tc=L.useCallback((Vt,Hn)=>(qn,fr)=>{const as=qn.nativeEvent,Kn=A.get(fr);if(W.current!==null||!Kn||as.dndKit||as.defaultPrevented)return;const bs={active:Kn};Vt(qn,Hn.options,bs)===!0&&(as.dndKit={capturedBy:Hn.sensor},W.current=fr,Ta(qn,Hn))},[A,Ta]),Ea=Fie(d,tc);Wie(d),ro(()=>{Ne&&S===Jo.Initializing&&$(Jo.Initialized)},[Ne,S]),L.useEffect(()=>{const{onDragMove:Vt}=z.current,{active:Hn,activatorEvent:qn,collisions:fr,over:as}=Ue.current;if(!Hn||!qn)return;const Kn={active:Hn,activatorEvent:qn,collisions:fr,delta:{x:qt.x,y:qt.y},over:as};il.unstable_batchedUpdates(()=>{Vt==null||Vt(Kn),v({type:"onDragMove",event:Kn})})},[qt.x,qt.y]),L.useEffect(()=>{const{active:Vt,activatorEvent:Hn,collisions:qn,droppableContainers:fr,scrollAdjustedTranslate:as}=Ue.current;if(!Vt||W.current==null||!Hn||!as)return;const{onDragOver:Kn}=z.current,bs=fr.get(vt),ao=bs&&bs.rect.current?{id:bs.id,rect:bs.rect.current,data:bs.data,disabled:bs.disabled}:null,Wt={active:Vt,activatorEvent:Hn,collisions:qn,delta:{x:as.x,y:as.y},over:ao};il.unstable_batchedUpdates(()=>{Ia(ao),Kn==null||Kn(Wt),v({type:"onDragOver",event:Wt})})},[vt]),ro(()=>{Ue.current={activatorEvent:ee,active:V,activeNode:ce,collisionRect:Le,collisions:et,droppableRects:Y,draggableNodes:A,draggingNode:Ce,draggingNodeRect:be,droppableContainers:D,over:Nt,scrollableAncestors:at,scrollAdjustedTranslate:qt},j.current={initial:be,translated:Le}},[V,ce,et,Le,A,Ce,be,Y,D,Nt,at,qt]),Aie({...ge,delta:P,draggingRect:Le,pointerCoordinates:is,scrollableAncestors:at,scrollableAncestorRects:Ht});const nc=L.useMemo(()=>({active:V,activeNode:ce,activeNodeRect:Ne,activatorEvent:ee,collisions:et,containerNodeRect:Me,dragOverlay:ye,draggableNodes:A,droppableContainers:D,droppableRects:Y,over:Nt,measureDroppableContainers:oe,scrollableAncestors:at,scrollableAncestorRects:Ht,measuringConfiguration:B,measuringScheduled:Q,windowRect:Dt}),[V,ce,Ne,ee,et,Me,ye,A,D,Y,Nt,oe,at,Ht,B,Q,Dt]),sc=L.useMemo(()=>({activatorEvent:ee,activators:Ea,active:V,activeNodeRect:Ne,ariaDescribedById:{draggable:H},dispatch:k,draggableNodes:A,over:Nt,measureDroppableContainers:oe}),[ee,Ea,V,Ne,k,H,A,Nt,oe]);return Xt.createElement(UA.Provider,{value:N},Xt.createElement(ag.Provider,{value:sc},Xt.createElement(iD.Provider,{value:nc},Xt.createElement(aD.Provider,{value:$a},u)),Xt.createElement(eae,{disabled:(a==null?void 0:a.restoreFocus)===!1})),Xt.createElement(sie,{...a,hiddenTextDescribedById:H}));function Ro(){const Vt=(U==null?void 0:U.autoScrollEnabled)===!1,Hn=typeof l=="object"?l.enabled===!1:l===!1,qn=R&&!Vt&&!Hn;return typeof l=="object"?{...l,enabled:qn}:{enabled:qn}}}),rae=L.createContext(null),TS="button",oae="Draggable";function iae(n){let{id:e,data:t,disabled:s=!1,attributes:r}=n;const o=Xd(oae),{activators:i,activatorEvent:a,active:l,activeNodeRect:u,ariaDescribedById:d,draggableNodes:f,over:m}=L.useContext(ag),{role:g=TS,roleDescription:y="draggable",tabIndex:w=0}=r??{},b=(l==null?void 0:l.id)===e,k=L.useContext(b?aD:rae),[v,N]=mp(),[S,$]=mp(),R=Uie(i,e),M=wu(t);ro(()=>(f.set(e,{id:e,key:o,node:v,activatorNode:S,data:M}),()=>{const P=f.get(e);P&&P.key===o&&f.delete(e)}),[f,e]);const A=L.useMemo(()=>({role:g,tabIndex:w,"aria-disabled":s,"aria-pressed":b&&g===TS?!0:void 0,"aria-roledescription":y,"aria-describedby":d.draggable}),[s,g,w,b,y,d.draggable]);return{active:l,activatorEvent:a,activeNodeRect:u,attributes:A,isDragging:b,listeners:s?void 0:R,node:v,over:m,setNodeRef:N,setActivatorNodeRef:$,transform:k}}function aae(){return L.useContext(iD)}const lae="Droppable",cae={timeout:25};function uae(n){let{data:e,disabled:t=!1,id:s,resizeObserverConfig:r}=n;const o=Xd(lae),{active:i,dispatch:a,over:l,measureDroppableContainers:u}=L.useContext(ag),d=L.useRef({disabled:t}),f=L.useRef(!1),m=L.useRef(null),g=L.useRef(null),{disabled:y,updateMeasurementsFor:w,timeout:b}={...cae,...r},k=wu(w??s),v=L.useCallback(()=>{if(!f.current){f.current=!0;return}g.current!=null&&clearTimeout(g.current),g.current=setTimeout(()=>{u(Array.isArray(k.current)?k.current:[k.current]),g.current=null},b)},[b]),N=ig({callback:v,disabled:y||!i}),S=L.useCallback((A,P)=>{N&&(P&&(N.unobserve(P),f.current=!1),A&&N.observe(A))},[N]),[$,R]=mp(S),M=wu(e);return L.useEffect(()=>{!N||!$.current||(N.disconnect(),f.current=!1,N.observe($.current))},[$,N]),L.useEffect(()=>(a({type:bn.RegisterDroppable,element:{id:s,key:o,disabled:t,node:$,rect:m,data:M}}),()=>a({type:bn.UnregisterDroppable,key:o,id:s})),[s]),L.useEffect(()=>{t!==d.current.disabled&&(a({type:bn.SetDroppableDisabled,id:s,key:o,disabled:t}),d.current.disabled=t)},[s,o,t,a]),{active:i,rect:m,isOver:(l==null?void 0:l.id)===s,node:$,over:l,setNodeRef:R}}function yb(n,e,t){const s=n.slice();return s.splice(t<0?s.length+t:t,0,s.splice(e,1)[0]),s}function dae(n,e){return n.reduce((t,s,r)=>{const o=e.get(s);return o&&(t[r]=o),t},Array(n.length))}function vf(n){return n!==null&&n>=0}function hae(n,e){if(n===e)return!0;if(n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function fae(n){return typeof n=="boolean"?{draggable:n,droppable:n}:n}const cD=n=>{let{rects:e,activeIndex:t,overIndex:s,index:r}=n;const o=yb(e,s,t),i=e[r],a=o[r];return!a||!i?null:{x:a.left-i.left,y:a.top-i.top,scaleX:a.width/i.width,scaleY:a.height/i.height}},bf={scaleX:1,scaleY:1},uD=n=>{var e;let{activeIndex:t,activeNodeRect:s,index:r,rects:o,overIndex:i}=n;const a=(e=o[t])!=null?e:s;if(!a)return null;if(r===t){const u=o[i];return u?{x:0,y:t<i?u.top+u.height-(a.top+a.height):u.top-a.top,...bf}:null}const l=pae(o,r,t);return r>t&&r<=i?{x:0,y:-a.height-l,...bf}:r<t&&r>=i?{x:0,y:a.height+l,...bf}:{x:0,y:0,...bf}};function pae(n,e,t){const s=n[e],r=n[e-1],o=n[e+1];return s?t<e?r?s.top-(r.top+r.height):o?o.top-(s.top+s.height):0:o?o.top-(s.top+s.height):r?s.top-(r.top+r.height):0:0}const dD="Sortable",hD=Xt.createContext({activeIndex:-1,containerId:dD,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:cD,disabled:{draggable:!1,droppable:!1}});function fD(n){let{children:e,id:t,items:s,strategy:r=cD,disabled:o=!1}=n;const{active:i,dragOverlay:a,droppableRects:l,over:u,measureDroppableContainers:d}=aae(),f=Xd(dD,t),m=a.rect!==null,g=L.useMemo(()=>s.map(R=>typeof R=="object"&&"id"in R?R.id:R),[s]),y=i!=null,w=i?g.indexOf(i.id):-1,b=u?g.indexOf(u.id):-1,k=L.useRef(g),v=!hae(g,k.current),N=b!==-1&&w===-1||v,S=fae(o);ro(()=>{v&&y&&d(g)},[v,g,y,d]),L.useEffect(()=>{k.current=g},[g]);const $=L.useMemo(()=>({activeIndex:w,containerId:f,disabled:S,disableTransforms:N,items:g,overIndex:b,useDragOverlay:m,sortedRects:dae(g,l),strategy:r}),[w,f,S.draggable,S.droppable,N,g,b,l,m,r]);return Xt.createElement(hD.Provider,{value:$},e)}const mae=n=>{let{id:e,items:t,activeIndex:s,overIndex:r}=n;return yb(t,s,r).indexOf(e)},gae=n=>{let{containerId:e,isSorting:t,wasDragging:s,index:r,items:o,newIndex:i,previousItems:a,previousContainerId:l,transition:u}=n;return!u||!s||a!==o&&r===i?!1:t?!0:i!==r&&e===l},xae={duration:200,easing:"ease"},pD="transform",yae=Al.Transition.toString({property:pD,duration:0,easing:"linear"}),vae={roleDescription:"sortable"};function bae(n){let{disabled:e,index:t,node:s,rect:r}=n;const[o,i]=L.useState(null),a=L.useRef(t);return ro(()=>{if(!e&&t!==a.current&&s.current){const l=r.current;if(l){const u=ec(s.current,{ignoreTransform:!0}),d={x:l.left-u.left,y:l.top-u.top,scaleX:l.width/u.width,scaleY:l.height/u.height};(d.x||d.y)&&i(d)}}t!==a.current&&(a.current=t)},[e,t,s,r]),L.useEffect(()=>{o&&i(null)},[o]),o}function mD(n){let{animateLayoutChanges:e=gae,attributes:t,disabled:s,data:r,getNewIndex:o=mae,id:i,strategy:a,resizeObserverConfig:l,transition:u=xae}=n;const{items:d,containerId:f,activeIndex:m,disabled:g,disableTransforms:y,sortedRects:w,overIndex:b,useDragOverlay:k,strategy:v}=L.useContext(hD),N=wae(s,g),S=d.indexOf(i),$=L.useMemo(()=>({sortable:{containerId:f,index:S,items:d},...r}),[f,r,S,d]),R=L.useMemo(()=>d.slice(d.indexOf(i)),[d,i]),{rect:M,node:A,isOver:P,setNodeRef:D}=uae({id:i,data:$,disabled:N.droppable,resizeObserverConfig:{updateMeasurementsFor:R,...l}}),{active:E,activatorEvent:j,activeNodeRect:V,attributes:W,setNodeRef:U,listeners:X,isDragging:ee,over:G,setActivatorNodeRef:z,transform:H}=iae({id:i,data:$,attributes:{...vae,...t},disabled:N.draggable}),O=Uoe(D,U),B=!!E,Y=B&&!y&&vf(m)&&vf(b),oe=!k&&ee,Q=oe&&Y?H:null,me=Y?Q??(a??v)({rects:w,activeNodeRect:V,activeIndex:m,overIndex:b,index:S}):null,ge=vf(m)&&vf(b)?o({id:i,items:d,activeIndex:m,overIndex:b}):S,ve=E==null?void 0:E.id,Ne=L.useRef({activeId:ve,items:d,newIndex:ge,containerId:f}),Me=d!==Ne.current.items,Ue=e({active:E,containerId:f,isDragging:ee,isSorting:B,id:i,index:S,items:d,newIndex:Ne.current.newIndex,previousItems:Ne.current.items,previousContainerId:Ne.current.containerId,transition:u,wasDragging:Ne.current.activeId!=null}),Qe=bae({disabled:!Ue,index:S,node:A,rect:M});return L.useEffect(()=>{B&&Ne.current.newIndex!==ge&&(Ne.current.newIndex=ge),f!==Ne.current.containerId&&(Ne.current.containerId=f),d!==Ne.current.items&&(Ne.current.items=d)},[B,ge,f,d]),L.useEffect(()=>{if(ve===Ne.current.activeId)return;if(ve&&!Ne.current.activeId){Ne.current.activeId=ve;return}const Ce=setTimeout(()=>{Ne.current.activeId=ve},50);return()=>clearTimeout(Ce)},[ve]),{active:E,activeIndex:m,attributes:W,data:$,rect:M,index:S,newIndex:ge,items:d,isOver:P,isSorting:B,isDragging:ee,listeners:X,node:A,overIndex:b,over:G,setNodeRef:O,setActivatorNodeRef:z,setDroppableNodeRef:D,setDraggableNodeRef:U,transform:Qe??me,transition:ye()};function ye(){if(Qe||Me&&Ne.current.newIndex===S)return yae;if(!(oe&&!mb(j)||!u)&&(B||Ue))return Al.Transition.toString({...u,property:pD})}}function wae(n,e){var t,s;return typeof n=="boolean"?{draggable:n,droppable:!1}:{draggable:(t=n==null?void 0:n.draggable)!=null?t:e.draggable,droppable:(s=n==null?void 0:n.droppable)!=null?s:e.droppable}}function vp(n){if(!n)return!1;const e=n.data.current;return!!(e&&"sortable"in e&&typeof e.sortable=="object"&&"containerId"in e.sortable&&"items"in e.sortable&&"index"in e.sortable)}const kae=[lt.Down,lt.Right,lt.Up,lt.Left],gD=(n,e)=>{let{context:{active:t,collisionRect:s,droppableRects:r,droppableContainers:o,over:i,scrollableAncestors:a}}=e;if(kae.includes(n.code)){if(n.preventDefault(),!t||!s)return;const l=[];o.getEnabled().forEach(f=>{if(!f||f!=null&&f.disabled)return;const m=r.get(f.id);if(m)switch(n.code){case lt.Down:s.top<m.top&&l.push(f);break;case lt.Up:s.top>m.top&&l.push(f);break;case lt.Left:s.left>m.left&&l.push(f);break;case lt.Right:s.left<m.left&&l.push(f);break}});const u=oie({collisionRect:s,droppableRects:r,droppableContainers:l});let d=KA(u,"id");if(d===(i==null?void 0:i.id)&&u.length>1&&(d=u[1].id),d!=null){const f=o.get(t.id),m=o.get(d),g=m?r.get(m.id):null,y=m==null?void 0:m.node.current;if(y&&g&&f&&m){const b=sg(y).some((R,M)=>a[M]!==R),k=xD(f,m),v=Cae(f,m),N=b||!k?{x:0,y:0}:{x:v?s.width-g.width:0,y:v?s.height-g.height:0},S={x:g.left,y:g.top};return N.x&&N.y?S:ku(S,N)}}}};function xD(n,e){return!vp(n)||!vp(e)?!1:n.data.current.sortable.containerId===e.data.current.sortable.containerId}function Cae(n,e){return!vp(n)||!vp(e)||!xD(n,e)?!1:n.data.current.sortable.index<e.data.current.sortable.index}const Sae={metadata:"Metadata",streaming:"Streaming",lyrics:"Lyrics",scrobbling:"Scrobbling",other:"Other"},ES={metadata:"var(--color-access-metadata)",streaming:"var(--color-access-streaming)",lyrics:"var(--color-access-lyrics)",scrobbling:"var(--color-access-scrobbling)",other:"var(--color-access-other)"},Nae=({plugin:n,index:e,onClick:t,onToggle:s,isDraggable:r=!0})=>{const{attributes:o,listeners:i,setNodeRef:a,transform:l,transition:u,isDragging:d}=mD({id:n.id,disabled:!r}),f={transform:Al.Transform.toString(l),transition:u,opacity:d?.5:1,zIndex:d?1e3:"auto"},m=g=>{g.stopPropagation(),s()};return p.jsxs("div",{ref:a,style:f,className:`plugin-card ${d?"dragging":""}`,onClick:t,children:[r&&p.jsxs("div",{className:"plugin-card-drag-handle",...o,...i,onClick:g=>g.stopPropagation(),children:[p.jsx(KS,{size:20}),p.jsx("span",{className:"plugin-card-priority",children:e+1})]}),p.jsx("div",{className:"plugin-card-icon",style:{background:ES[n.category]},children:n.icon?p.jsx("img",{src:n.icon,alt:n.name}):p.jsx(lu,{size:28})}),p.jsxs("div",{className:"plugin-card-info",children:[p.jsxs("div",{className:"plugin-card-header",children:[p.jsx("h3",{className:"plugin-card-name",children:n.name}),p.jsxs("span",{className:"plugin-card-version",children:["v",n.version]})]}),p.jsx("p",{className:"plugin-card-description",children:n.description}),p.jsxs("div",{className:"plugin-card-meta",children:[p.jsx("span",{className:"plugin-card-category",style:{color:ES[n.category]},children:Sae[n.category]}),p.jsxs("span",{className:"plugin-card-author",children:["by ",n.author]})]})]}),p.jsxs("div",{className:"plugin-card-actions",children:[p.jsxs("label",{className:"plugin-toggle",onClick:m,children:[p.jsx("input",{type:"checkbox",checked:n.enabled,readOnly:!0,disabled:!n.installed}),p.jsx("span",{className:"plugin-toggle-slider"})]}),p.jsx(yl,{size:20,className:"plugin-card-arrow"})]})]})},Iae=()=>{const{plugins:n,togglePlugin:e,getOrderedPlugins:t,pluginOrder:s,setPluginOrder:r}=pa(),{openPlugin:o}=on(),[i,a]=L.useState("all"),l=GA(xp(og,{activationConstraint:{distance:8}}),xp(rg,{coordinateGetter:gD})),u=t(),d=u.filter(b=>b.installed),f=u.filter(b=>!b.installed),m=i==="all"?u:i==="installed"?d:f,g=n.filter(b=>b.enabled).length,y=b=>{const{active:k,over:v}=b;if(v&&k.id!==v.id){const N=s.indexOf(String(k.id)),S=s.indexOf(String(v.id));if(N!==-1&&S!==-1){const $=yb(s,N,S);r($)}}},w=i!=="available";return p.jsxs("div",{className:"plugins-view",children:[p.jsxs("header",{className:"plugins-header",children:[p.jsx("div",{className:"plugins-header-icon",children:p.jsx(lu,{size:64})}),p.jsxs("div",{className:"plugins-header-info",children:[p.jsx("span",{className:"plugins-header-type",children:"Extensions"}),p.jsx("h1",{className:"plugins-header-title",children:"Plugins"}),p.jsxs("span",{className:"plugins-header-count",children:[g," enabled  ",d.length," installed"]})]})]}),p.jsx("div",{className:"plugins-priority-hint",children:p.jsx("span",{children:"Drag plugins to set priority order. Higher position = higher priority (tried first)."})}),p.jsxs("div",{className:"plugins-filters",children:[p.jsxs("button",{className:`plugins-filter ${i==="all"?"active":""}`,onClick:()=>a("all"),children:["All (",n.length,")"]}),p.jsxs("button",{className:`plugins-filter ${i==="installed"?"active":""}`,onClick:()=>a("installed"),children:["Installed (",d.length,")"]}),p.jsxs("button",{className:`plugins-filter ${i==="available"?"active":""}`,onClick:()=>a("available"),children:["Available (",f.length,")"]})]}),p.jsx(lD,{sensors:l,collisionDetection:XA,onDragEnd:y,children:p.jsx(fD,{items:m.map(b=>b.id),strategy:uD,children:p.jsx("div",{className:"plugins-list",children:m.length===0?p.jsxs("div",{className:"plugins-empty",children:[p.jsx(lu,{size:48}),p.jsx("h3",{children:"No plugins found"}),p.jsx("p",{children:i==="available"?"All available plugins are already installed":"No plugins match your current filter"})]}):m.map((b,k)=>p.jsx(Nae,{plugin:b,index:s.indexOf(b.id),onClick:()=>o(b.id),onToggle:()=>e(b.id),isDraggable:w&&b.installed},b.id))})})}),p.jsx("div",{className:"plugins-add-section",children:p.jsxs("button",{className:"plugins-add-button",children:[p.jsx(xl,{size:20}),p.jsx("span",{children:"Add Plugin from URL"})]})})]})},$ae={metadata:"Metadata Provider",streaming:"Streaming Provider",lyrics:"Lyrics Provider",scrobbling:"Scrobbling Service",other:"Other"},RS={metadata:"var(--color-access-metadata)",streaming:"var(--color-access-streaming)",lyrics:"var(--color-access-lyrics)",scrobbling:"var(--color-access-scrobbling)",other:"var(--color-access-other)"},Tae={network:V4,storage:W4,playback:U4,library:G4,system:US},Eae={network:"var(--color-access-network)",storage:"var(--color-access-storage)",playback:"var(--color-access-playback)",library:"var(--color-access-library)",system:"var(--color-access-system)"},Rae=({setting:n,value:e,onChange:t,disabled:s=!1})=>{const r=()=>{var o;switch(n.type){case"boolean":return p.jsxs("label",{className:"plugin-toggle",children:[p.jsx("input",{type:"checkbox",checked:e,onChange:i=>t(i.target.checked),disabled:s}),p.jsx("span",{className:"plugin-toggle-slider"})]});case"select":return p.jsx("select",{className:"plugin-select",value:e,onChange:i=>t(i.target.value),disabled:s,children:(o=n.options)==null?void 0:o.map(i=>p.jsx("option",{value:i.value,children:i.label},i.value))});case"number":return p.jsx("input",{type:"number",className:"plugin-number-input",value:e,min:n.min,max:n.max,onChange:i=>t(parseInt(i.target.value,10)||n.default),disabled:s});default:return null}};return p.jsxs("div",{className:"plugin-setting-item",children:[p.jsxs("div",{className:"plugin-setting-info",children:[p.jsx("span",{className:"plugin-setting-label",children:n.label}),p.jsx("span",{className:"plugin-setting-description",children:n.description})]}),r()]})},Aae=({privacyAccess:n})=>n.length===0?p.jsxs("div",{className:"privacy-card",children:[p.jsxs("div",{className:"privacy-card-header",children:[p.jsx(c2,{size:24}),p.jsx("h3",{children:"App Privacy"})]}),p.jsxs("div",{className:"privacy-card-empty",children:[p.jsx(wp,{size:32}),p.jsx("p",{children:"This plugin does not access any sensitive data"})]})]}):p.jsxs("div",{className:"privacy-card",children:[p.jsxs("div",{className:"privacy-card-header",children:[p.jsx(c2,{size:24}),p.jsx("h3",{children:"App Privacy"})]}),p.jsx("p",{className:"privacy-card-subtitle",children:"The developer indicated that this plugin may access the following data:"}),p.jsx("div",{className:"privacy-access-list",children:n.map((e,t)=>{const s=Tae[e.type]||US,r=Eae[e.type]||"#6b7280";return p.jsxs("div",{className:"privacy-access-item",children:[p.jsx("div",{className:"privacy-access-icon",style:{backgroundColor:`${r}20`,color:r},children:p.jsx(s,{size:20})}),p.jsxs("div",{className:"privacy-access-info",children:[p.jsxs("div",{className:"privacy-access-header",children:[p.jsx("span",{className:"privacy-access-label",children:e.label}),e.required&&p.jsx("span",{className:"privacy-access-required",children:"Required"})]}),p.jsx("p",{className:"privacy-access-description",children:e.description})]})]},t)})}),p.jsx("div",{className:"privacy-card-footer",children:p.jsxs("p",{children:["Privacy practices may vary based on the features you use or your configuration.",p.jsx("a",{href:"#",className:"privacy-learn-more",children:"Learn More"})]})})]}),Dae=()=>{const{selectedPluginId:n,goBack:e}=on(),{plugins:t,togglePlugin:s,removePlugin:r,updatePluginSetting:o}=pa(),i=t.find(u=>u.id===n);if(!i)return p.jsx("div",{className:"plugin-detail-view",children:p.jsxs("div",{className:"plugin-detail-empty",children:[p.jsx("h3",{children:"Plugin not found"}),p.jsx("button",{onClick:e,children:"Go back"})]})});const a=()=>{s(i.id)},l=()=>{confirm(`Are you sure you want to uninstall "${i.name}"?`)&&(r(i.id),e())};return p.jsxs("div",{className:"plugin-detail-view",children:[p.jsx("header",{className:"plugin-detail-header",children:p.jsx("button",{className:"back-btn-round plugin-back-btn-pos",onClick:e,"aria-label":"Go back",children:p.jsx(ky,{size:20})})}),p.jsxs("div",{className:"plugin-detail-hero",children:[p.jsx("div",{className:"plugin-detail-icon",style:{background:RS[i.category]},children:i.icon?p.jsx("img",{src:i.icon,alt:i.name}):p.jsx(lu,{size:56})}),p.jsxs("div",{className:"plugin-detail-info",children:[p.jsx("h1",{className:"plugin-detail-name",children:i.name}),p.jsx("span",{className:"plugin-detail-category",style:{color:RS[i.category]},children:$ae[i.category]}),p.jsxs("div",{className:"plugin-detail-meta",children:[p.jsxs("span",{className:"plugin-detail-version",children:["Version ",i.version]}),p.jsxs("span",{className:"plugin-detail-author",children:["by ",i.author]})]})]}),p.jsx("div",{className:"plugin-detail-actions",children:i.installed?p.jsxs("button",{className:"plugin-action-button danger",onClick:l,children:[p.jsx(z4,{size:18}),"Uninstall"]}):p.jsx("button",{className:"plugin-action-button primary",children:"Install"})})]}),p.jsxs("div",{className:"plugin-detail-content",children:[p.jsxs("section",{className:"plugin-detail-section",children:[p.jsx("h2",{children:"About"}),p.jsx("p",{className:"plugin-detail-description",children:i.description}),(i.homepage||i.repository)&&p.jsxs("div",{className:"plugin-detail-links",children:[i.homepage&&p.jsx("a",{href:i.homepage,target:"_blank",rel:"noopener noreferrer",children:"Homepage"}),i.repository&&p.jsx("a",{href:i.repository,target:"_blank",rel:"noopener noreferrer",children:"Source Code"})]})]}),p.jsx("section",{className:"plugin-detail-section",children:p.jsx(Aae,{privacyAccess:i.privacyAccess})}),p.jsxs("section",{className:"plugin-detail-section",children:[p.jsx("h2",{children:"Settings"}),p.jsxs("div",{className:"plugin-settings-list",children:[p.jsxs("div",{className:"plugin-setting-item",children:[p.jsxs("div",{className:"plugin-setting-info",children:[p.jsx("span",{className:"plugin-setting-label",children:"Enabled"}),p.jsx("span",{className:"plugin-setting-description",children:"Allow this plugin to run and access data"})]}),p.jsxs("label",{className:"plugin-toggle",children:[p.jsx("input",{type:"checkbox",checked:i.enabled,onChange:a,disabled:!i.installed}),p.jsx("span",{className:"plugin-toggle-slider"})]})]}),i.settingsDefinitions&&i.settingsDefinitions.length>0&&p.jsxs(p.Fragment,{children:[p.jsx("div",{className:"plugin-settings-divider"}),p.jsxs("div",{className:"plugin-settings-header",children:[p.jsx(Sy,{size:16}),p.jsx("span",{children:"Plugin Configuration"})]}),i.settingsDefinitions.map(u=>{var d;return p.jsx(Rae,{setting:u,value:((d=i.settings)==null?void 0:d[u.key])??u.default,onChange:f=>o(i.id,u.key,f),disabled:!i.enabled||!i.installed},u.key)})]})]})]})]})]})},Mae={id:"default-dark",name:"Default Dark",author:"Audiio Team",version:"1.0.0",description:"The classic Audiio dark theme with green accent",mode:"dark",source:"builtin",colors:{bgPrimary:"#0a0a0a",bgSecondary:"#141414",bgTertiary:"#1c1c1c",bgHover:"#252525",bgElevated:"#1a1a1a",bgSurface:"#121212",bgOverlay:"rgba(0, 0, 0, 0.6)",textPrimary:"#ffffff",textSecondary:"#a3a3a3",textMuted:"#737373",textInverse:"#000000",textOnAccent:"#ffffff",accent:"#1db954",accentHover:"#1ed760",accentGlow:"rgba(29, 185, 84, 0.25)",accentSoft:"rgba(29, 185, 84, 0.1)",accentMuted:"rgba(29, 185, 84, 0.5)",borderColor:"rgba(255, 255, 255, 0.08)",borderLight:"rgba(255, 255, 255, 0.12)",borderStrong:"rgba(255, 255, 255, 0.18)",colorSuccess:"#1db954",colorWarning:"#f59e0b",colorError:"#ef4444",colorInfo:"#3b82f6"}},Pae={id:"midnight",name:"Midnight",author:"Audiio Team",version:"1.0.0",description:"Deep blues and purples for late night listening",mode:"dark",source:"builtin",colors:{bgPrimary:"#0a0a14",bgSecondary:"#12121e",bgTertiary:"#1a1a2e",bgHover:"#252540",bgElevated:"#161628",bgSurface:"#0e0e1a",bgOverlay:"rgba(10, 10, 20, 0.7)",textPrimary:"#e8e8ff",textSecondary:"#a0a0c0",textMuted:"#7878a0",textInverse:"#0a0a14",textOnAccent:"#ffffff",accent:"#8b5cf6",accentHover:"#a78bfa",accentGlow:"rgba(139, 92, 246, 0.25)",accentSoft:"rgba(139, 92, 246, 0.1)",accentMuted:"rgba(139, 92, 246, 0.5)",borderColor:"rgba(139, 92, 246, 0.1)",borderLight:"rgba(139, 92, 246, 0.15)",borderStrong:"rgba(139, 92, 246, 0.2)",colorSuccess:"#10b981",colorWarning:"#f59e0b",colorError:"#ef4444",colorInfo:"#6366f1"},gradients:{accent:"linear-gradient(135deg, #8b5cf6 0%, #a855f7 100%)"}},Fae={id:"sunset",name:"Sunset",author:"Audiio Team",version:"1.0.0",description:"Warm oranges and reds inspired by golden hour",mode:"dark",source:"builtin",colors:{bgPrimary:"#0f0a08",bgSecondary:"#1a1210",bgTertiary:"#241a16",bgHover:"#352520",bgElevated:"#1e1612",bgSurface:"#140e0c",bgOverlay:"rgba(15, 10, 8, 0.7)",textPrimary:"#fff5f0",textSecondary:"#c0a090",textMuted:"#a08070",textInverse:"#0f0a08",textOnAccent:"#ffffff",accent:"#f97316",accentHover:"#fb923c",accentGlow:"rgba(249, 115, 22, 0.25)",accentSoft:"rgba(249, 115, 22, 0.1)",accentMuted:"rgba(249, 115, 22, 0.5)",borderColor:"rgba(249, 115, 22, 0.1)",borderLight:"rgba(249, 115, 22, 0.15)",borderStrong:"rgba(249, 115, 22, 0.2)",colorSuccess:"#22c55e",colorWarning:"#eab308",colorError:"#ef4444",colorInfo:"#3b82f6"},gradients:{accent:"linear-gradient(135deg, #f97316 0%, #fb923c 50%, #fbbf24 100%)"}},Lae={id:"ocean",name:"Ocean",author:"Audiio Team",version:"1.0.0",description:"Cool teals and cyans like deep ocean waters",mode:"dark",source:"builtin",colors:{bgPrimary:"#080a0a",bgSecondary:"#101414",bgTertiary:"#161c1c",bgHover:"#202828",bgElevated:"#121818",bgSurface:"#0c1010",bgOverlay:"rgba(8, 10, 10, 0.7)",textPrimary:"#f0ffff",textSecondary:"#a0c0c0",textMuted:"#789090",textInverse:"#080a0a",textOnAccent:"#ffffff",accent:"#14b8a6",accentHover:"#2dd4bf",accentGlow:"rgba(20, 184, 166, 0.25)",accentSoft:"rgba(20, 184, 166, 0.1)",accentMuted:"rgba(20, 184, 166, 0.5)",borderColor:"rgba(20, 184, 166, 0.1)",borderLight:"rgba(20, 184, 166, 0.15)",borderStrong:"rgba(20, 184, 166, 0.2)",colorSuccess:"#10b981",colorWarning:"#f59e0b",colorError:"#ef4444",colorInfo:"#06b6d4"},gradients:{accent:"linear-gradient(135deg, #14b8a6 0%, #06b6d4 100%)"}},jae={id:"monochrome-dark",name:"Monochrome Dark",author:"Audiio Team",version:"1.0.0",description:"Elegant grayscale with crisp white accents",mode:"dark",source:"builtin",colors:{bgPrimary:"#0a0a0a",bgSecondary:"#141414",bgTertiary:"#1e1e1e",bgHover:"#282828",bgElevated:"#1a1a1a",bgSurface:"#121212",bgOverlay:"rgba(0, 0, 0, 0.7)",textPrimary:"#ffffff",textSecondary:"#a3a3a3",textMuted:"#737373",textInverse:"#000000",textOnAccent:"#000000",accent:"#ffffff",accentHover:"#e0e0e0",accentGlow:"rgba(255, 255, 255, 0.15)",accentSoft:"rgba(255, 255, 255, 0.08)",accentMuted:"rgba(255, 255, 255, 0.4)",borderColor:"rgba(255, 255, 255, 0.1)",borderLight:"rgba(255, 255, 255, 0.15)",borderStrong:"rgba(255, 255, 255, 0.2)",colorSuccess:"#4ade80",colorWarning:"#fbbf24",colorError:"#f87171",colorInfo:"#60a5fa"},gradients:{accent:"linear-gradient(135deg, #ffffff 0%, #e0e0e0 100%)"}},Oae={id:"default-light",name:"Default Light",author:"Audiio Team",version:"1.0.0",description:"Clean white theme with the classic green accent",mode:"light",source:"builtin",colors:{bgPrimary:"#ffffff",bgSecondary:"#f5f5f5",bgTertiary:"#ebebeb",bgHover:"#e0e0e0",bgElevated:"#ffffff",bgSurface:"#fafafa",bgOverlay:"rgba(0, 0, 0, 0.4)",textPrimary:"#1a1a1a",textSecondary:"#666666",textMuted:"#999999",textInverse:"#ffffff",textOnAccent:"#ffffff",accent:"#1db954",accentHover:"#1aa34a",accentGlow:"rgba(29, 185, 84, 0.2)",accentSoft:"rgba(29, 185, 84, 0.08)",accentMuted:"rgba(29, 185, 84, 0.4)",borderColor:"rgba(0, 0, 0, 0.08)",borderLight:"rgba(0, 0, 0, 0.05)",borderStrong:"rgba(0, 0, 0, 0.15)",colorSuccess:"#16a34a",colorWarning:"#d97706",colorError:"#dc2626",colorInfo:"#2563eb"},shadows:{xs:"0 1px 3px rgba(0, 0, 0, 0.08)",sm:"0 2px 8px rgba(0, 0, 0, 0.1)",md:"0 4px 16px rgba(0, 0, 0, 0.12)",lg:"0 8px 32px rgba(0, 0, 0, 0.15)",xl:"0 16px 48px rgba(0, 0, 0, 0.18)",module:"0 4px 24px rgba(0, 0, 0, 0.08)",card:"0 2px 12px rgba(0, 0, 0, 0.06)",elevated:"0 8px 40px rgba(0, 0, 0, 0.12)"},glass:{bg:"rgba(255, 255, 255, 0.85)",bgLight:"rgba(255, 255, 255, 0.7)",border:"rgba(0, 0, 0, 0.06)",borderStrong:"rgba(0, 0, 0, 0.1)"}},_ae={id:"paper",name:"Paper",author:"Audiio Team",version:"1.0.0",description:"Warm cream and beige tones like aged paper",mode:"light",source:"builtin",colors:{bgPrimary:"#faf8f5",bgSecondary:"#f2efe8",bgTertiary:"#e8e4da",bgHover:"#ddd8cc",bgElevated:"#fffdf8",bgSurface:"#f5f2ec",bgOverlay:"rgba(40, 35, 28, 0.4)",textPrimary:"#2c2820",textSecondary:"#6b6355",textMuted:"#9a9080",textInverse:"#faf8f5",textOnAccent:"#ffffff",accent:"#b45309",accentHover:"#d97706",accentGlow:"rgba(180, 83, 9, 0.2)",accentSoft:"rgba(180, 83, 9, 0.08)",accentMuted:"rgba(180, 83, 9, 0.4)",borderColor:"rgba(44, 40, 32, 0.08)",borderLight:"rgba(44, 40, 32, 0.05)",borderStrong:"rgba(44, 40, 32, 0.15)",colorSuccess:"#15803d",colorWarning:"#b45309",colorError:"#b91c1c",colorInfo:"#1d4ed8"},gradients:{accent:"linear-gradient(135deg, #b45309 0%, #d97706 100%)",surface:"linear-gradient(180deg, #f2efe8 0%, #faf8f5 100%)"},shadows:{xs:"0 1px 3px rgba(44, 40, 32, 0.06)",sm:"0 2px 8px rgba(44, 40, 32, 0.08)",md:"0 4px 16px rgba(44, 40, 32, 0.1)",lg:"0 8px 32px rgba(44, 40, 32, 0.12)",xl:"0 16px 48px rgba(44, 40, 32, 0.14)",module:"0 4px 24px rgba(44, 40, 32, 0.06)",card:"0 2px 12px rgba(44, 40, 32, 0.05)",elevated:"0 8px 40px rgba(44, 40, 32, 0.1)"},glass:{bg:"rgba(250, 248, 245, 0.85)",bgLight:"rgba(250, 248, 245, 0.7)",border:"rgba(44, 40, 32, 0.06)",borderStrong:"rgba(44, 40, 32, 0.1)"}},zae={id:"monochrome-light",name:"Monochrome Light",author:"Audiio Team",version:"1.0.0",description:"Pure white with elegant gray accents",mode:"light",source:"builtin",colors:{bgPrimary:"#ffffff",bgSecondary:"#f8f8f8",bgTertiary:"#f0f0f0",bgHover:"#e8e8e8",bgElevated:"#ffffff",bgSurface:"#fcfcfc",bgOverlay:"rgba(0, 0, 0, 0.5)",textPrimary:"#1a1a1a",textSecondary:"#6a6a6a",textMuted:"#9a9a9a",textInverse:"#ffffff",textOnAccent:"#ffffff",accent:"#1a1a1a",accentHover:"#333333",accentGlow:"rgba(26, 26, 26, 0.15)",accentSoft:"rgba(26, 26, 26, 0.06)",accentMuted:"rgba(26, 26, 26, 0.35)",borderColor:"rgba(0, 0, 0, 0.08)",borderLight:"rgba(0, 0, 0, 0.04)",borderStrong:"rgba(0, 0, 0, 0.12)",colorSuccess:"#16a34a",colorWarning:"#ca8a04",colorError:"#dc2626",colorInfo:"#2563eb"},gradients:{accent:"linear-gradient(135deg, #1a1a1a 0%, #333333 100%)"},shadows:{xs:"0 1px 3px rgba(0, 0, 0, 0.06)",sm:"0 2px 8px rgba(0, 0, 0, 0.08)",md:"0 4px 16px rgba(0, 0, 0, 0.1)",lg:"0 8px 32px rgba(0, 0, 0, 0.12)",xl:"0 16px 48px rgba(0, 0, 0, 0.14)",module:"0 4px 24px rgba(0, 0, 0, 0.06)",card:"0 2px 12px rgba(0, 0, 0, 0.04)",elevated:"0 8px 40px rgba(0, 0, 0, 0.1)"},glass:{bg:"rgba(255, 255, 255, 0.9)",bgLight:"rgba(255, 255, 255, 0.75)",border:"rgba(0, 0, 0, 0.05)",borderStrong:"rgba(0, 0, 0, 0.08)"}},AS=[Mae,Pae,Fae,Lae,jae,Oae,_ae,zae],S0=()=>`custom-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,N0=()=>typeof window<"u"&&window.matchMedia?window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":"dark",ml=Ps()(fa((n,e)=>({activeThemeId:"default-dark",systemMode:"auto",themes:[...AS],communityThemes:[],setTheme:t=>{e().themes.find(r=>r.id===t)&&n({activeThemeId:t})},setSystemMode:t=>{const{activeThemeId:s,themes:r}=e(),o=r.find(a=>a.id===s);let i;t==="auto"?i=N0():i=t,o&&o.mode!==i?n({systemMode:t,activeThemeId:i==="dark"?"default-dark":"default-light"}):n({systemMode:t})},installTheme:t=>{const s={...t,source:"community",id:t.id||S0()};n(r=>({themes:[...r.themes,s],communityThemes:[...r.communityThemes,s]}))},uninstallTheme:t=>{const s=e().themes.find(r=>r.id===t);(s==null?void 0:s.source)!=="builtin"&&n(r=>({activeThemeId:r.activeThemeId===t?"default-dark":r.activeThemeId,themes:r.themes.filter(i=>i.id!==t),communityThemes:r.communityThemes.filter(i=>i.id!==t)}))},updateTheme:(t,s)=>{n(r=>({themes:r.themes.map(o=>o.id===t?{...o,...s}:o),communityThemes:r.communityThemes.map(o=>o.id===t?{...o,...s}:o)}))},getTheme:t=>e().themes.find(s=>s.id===t),getActiveTheme:()=>{const{activeThemeId:t,themes:s,systemMode:r}=e();if(r==="auto"){const o=N0(),i=s.find(l=>l.id===t);if((i==null?void 0:i.mode)===o)return i;const a=o==="dark"?"default-dark":"default-light";return s.find(l=>l.id===a)||s[0]}return s.find(o=>o.id===t)||s[0]},getEffectiveColorMode:()=>{const{systemMode:t,activeThemeId:s,themes:r}=e();if(t==="auto")return N0();const o=r.find(i=>i.id===s);return(o==null?void 0:o.mode)||"dark"},createCustomTheme:t=>{const s={...t,id:S0(),source:"community"};return e().installTheme(s),s},exportTheme:t=>{const s=e().themes.find(o=>o.id===t);if(!s)return"";const r={...s,id:s.source==="builtin"?void 0:s.id,source:void 0};return JSON.stringify(r,null,2)},importTheme:t=>{try{const s=JSON.parse(t);if(!s.name||!s.colors||!s.mode)return console.error("Invalid theme: missing required fields"),null;const r={...s,id:s.id||S0(),source:"community",author:s.author||"Unknown",version:s.version||"1.0.0"};return e().installTheme(r),r}catch(s){return console.error("Failed to import theme:",s),null}}}),{name:"audiio-themes",partialize:n=>({activeThemeId:n.activeThemeId,systemMode:n.systemMode,communityThemes:n.communityThemes}),merge:(n,e)=>{const t=n,s=[...AS,...t.communityThemes||[]];return{...e,...t,themes:s}}}));typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",n=>{const e=ml.getState();if(e.systemMode==="auto"){const t=n.matches?"dark":"light",s=e.themes.find(r=>r.id===e.activeThemeId);if((s==null?void 0:s.mode)!==t){const r=t==="dark"?"default-dark":"default-light";e.setTheme(r)}}});const Bae=["#1db954","#8b5cf6","#ec4899","#3b82f6","#f97316","#ef4444","#14b8a6","#f59e0b","#6366f1","#10b981","#ffffff","#000000"],Vae=({color:n,onChange:e,label:t})=>{const[s,r]=L.useState(!1),[o,i]=L.useState(n),a=L.useRef(null);L.useEffect(()=>{i(n)},[n]),L.useEffect(()=>{const f=m=>{a.current&&!a.current.contains(m.target)&&r(!1)};return s&&document.addEventListener("mousedown",f),()=>{document.removeEventListener("mousedown",f)}},[s]);const l=f=>{const m=f.target.value;i(m),(/^#[0-9A-Fa-f]{6}$/.test(m)||/^#[0-9A-Fa-f]{3}$/.test(m))&&e(m)},u=f=>{const m=f.target.value;i(m),e(m)},d=f=>{i(f),e(f)};return p.jsxs("div",{className:"color-picker",ref:a,children:[t&&p.jsx("label",{className:"color-picker-label",children:t}),p.jsxs("div",{className:"color-picker-trigger",onClick:()=>r(!s),children:[p.jsx("div",{className:"color-picker-swatch",style:{backgroundColor:n}}),p.jsx("input",{type:"text",className:"color-picker-input",value:o,onChange:l,onClick:f=>f.stopPropagation(),placeholder:"#000000"})]}),s&&p.jsxs("div",{className:"color-picker-dropdown",children:[p.jsxs("div",{className:"color-picker-native-wrapper",children:[p.jsx("input",{type:"color",className:"color-picker-native",value:n,onChange:u}),p.jsx("span",{className:"color-picker-native-label",children:"Pick custom color"})]}),p.jsxs("div",{className:"color-picker-presets",children:[p.jsx("span",{className:"color-picker-presets-label",children:"Quick colors"}),p.jsx("div",{className:"color-picker-presets-grid",children:Bae.map(f=>p.jsx("button",{className:`color-picker-preset ${n===f?"active":""}`,style:{backgroundColor:f},onClick:()=>d(f),title:f},f))})]})]})]})},wf=n=>n==="light"?{bgPrimary:"#ffffff",bgSecondary:"#f5f5f5",bgTertiary:"#ebebeb",bgHover:"#e0e0e0",bgElevated:"#ffffff",bgSurface:"#fafafa",bgOverlay:"rgba(0, 0, 0, 0.4)",textPrimary:"#1a1a1a",textSecondary:"#666666",textMuted:"#999999",textInverse:"#ffffff",accent:"#1db954",accentHover:"#1ed760",accentGlow:"rgba(29, 185, 84, 0.2)",accentSoft:"rgba(29, 185, 84, 0.08)",accentMuted:"rgba(29, 185, 84, 0.4)",borderColor:"rgba(0, 0, 0, 0.08)",borderLight:"rgba(0, 0, 0, 0.05)",borderStrong:"rgba(0, 0, 0, 0.15)",colorSuccess:"#16a34a",colorWarning:"#d97706",colorError:"#dc2626",colorInfo:"#2563eb"}:{bgPrimary:"#0a0a0a",bgSecondary:"#141414",bgTertiary:"#1c1c1c",bgHover:"#252525",bgElevated:"#1a1a1a",bgSurface:"#121212",bgOverlay:"rgba(0, 0, 0, 0.6)",textPrimary:"#ffffff",textSecondary:"#a0a0a0",textMuted:"#606060",textInverse:"#000000",accent:"#1db954",accentHover:"#1ed760",accentGlow:"rgba(29, 185, 84, 0.25)",accentSoft:"rgba(29, 185, 84, 0.1)",accentMuted:"rgba(29, 185, 84, 0.5)",borderColor:"rgba(255, 255, 255, 0.08)",borderLight:"rgba(255, 255, 255, 0.12)",borderStrong:"rgba(255, 255, 255, 0.18)",colorSuccess:"#1db954",colorWarning:"#f59e0b",colorError:"#ef4444",colorInfo:"#3b82f6"},Wae=n=>{const e=Uae(n,15),t=I0(n,.25),s=I0(n,.1),r=I0(n,.5);return{accentHover:e,accentGlow:t,accentSoft:s,accentMuted:r}},I0=(n,e)=>{const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(n);if(!t)return`rgba(0, 0, 0, ${e})`;const s=parseInt(t[1],16),r=parseInt(t[2],16),o=parseInt(t[3],16);return`rgba(${s}, ${r}, ${o}, ${e})`},Uae=(n,e)=>{const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(n);if(!t)return n;let s=parseInt(t[1],16),r=parseInt(t[2],16),o=parseInt(t[3],16);return s=Math.min(255,Math.max(0,s+s*e/100)),r=Math.min(255,Math.max(0,r+r*e/100)),o=Math.min(255,Math.max(0,o+o*e/100)),`#${Math.round(s).toString(16).padStart(2,"0")}${Math.round(r).toString(16).padStart(2,"0")}${Math.round(o).toString(16).padStart(2,"0")}`},Gae=({isOpen:n,onClose:e,editingTheme:t})=>{const{createCustomTheme:s,updateTheme:r,exportTheme:o,setTheme:i}=ml(),[a,l]=L.useState("My Custom Theme"),[u,d]=L.useState("dark"),[f,m]=L.useState(wf("dark")),[g,y]=L.useState(""),[w,b]=L.useState("colors");L.useEffect(()=>{t?(l(t.name),d(t.mode),m(t.colors),y(t.customCSS||"")):(l("My Custom Theme"),d("dark"),m(wf("dark")),y(""))},[t,n]),L.useEffect(()=>{t||m(wf(u))},[u,t]);const k=(R,M)=>{m(A=>{const P={...A,[R]:M};if(R==="accent"){const D=Wae(M);return{...P,...D}}return P})},v=()=>{const R={name:a,author:"You",version:"1.0.0",description:`Custom ${u} theme`,mode:u,colors:f,customCSS:g||void 0};if(t&&t.source==="community")r(t.id,R),i(t.id);else{const M=s(R);i(M.id)}e()},N=()=>{const R={name:a,author:"You",version:"1.0.0",description:`Custom ${u} theme`,mode:u,colors:f,customCSS:g||void 0},M=JSON.stringify(R,null,2);navigator.clipboard.writeText(M)},S=()=>{m(wf(u)),y("")},$=L.useMemo(()=>[{name:"Background",colors:[{key:"bgPrimary",label:"Primary"},{key:"bgSecondary",label:"Secondary"},{key:"bgTertiary",label:"Tertiary"},{key:"bgHover",label:"Hover"},{key:"bgElevated",label:"Elevated"},{key:"bgSurface",label:"Surface"}]},{name:"Text",colors:[{key:"textPrimary",label:"Primary"},{key:"textSecondary",label:"Secondary"},{key:"textMuted",label:"Muted"}]},{name:"Accent",colors:[{key:"accent",label:"Primary"},{key:"accentHover",label:"Hover"}]},{name:"Semantic",colors:[{key:"colorSuccess",label:"Success"},{key:"colorWarning",label:"Warning"},{key:"colorError",label:"Error"},{key:"colorInfo",label:"Info"}]}],[]);return n?p.jsx("div",{className:"modal-overlay",onClick:e,children:p.jsxs("div",{className:"theme-editor-modal",onClick:R=>R.stopPropagation(),children:[p.jsxs("div",{className:"theme-editor-header",children:[p.jsx("h2",{children:t?"Edit Theme":"Create Theme"}),p.jsx("button",{className:"modal-close",onClick:e,children:p.jsx(ar,{size:20})})]}),p.jsxs("div",{className:"theme-editor-content",children:[p.jsxs("div",{className:"theme-editor-controls",children:[p.jsxs("div",{className:"theme-editor-field",children:[p.jsx("label",{children:"Theme Name"}),p.jsx("input",{type:"text",className:"theme-editor-input",value:a,onChange:R=>l(R.target.value),placeholder:"My Custom Theme"})]}),p.jsxs("div",{className:"theme-editor-field",children:[p.jsx("label",{children:"Mode"}),p.jsxs("div",{className:"theme-editor-mode-toggle",children:[p.jsxs("button",{className:`theme-editor-mode-btn ${u==="dark"?"active":""}`,onClick:()=>d("dark"),children:[p.jsx(qS,{size:16}),"Dark"]}),p.jsxs("button",{className:`theme-editor-mode-btn ${u==="light"?"active":""}`,onClick:()=>d("light"),children:[p.jsx(HS,{size:16}),"Light"]})]})]}),p.jsxs("div",{className:"theme-editor-tabs",children:[p.jsx("button",{className:`theme-editor-tab ${w==="colors"?"active":""}`,onClick:()=>b("colors"),children:"Colors"}),p.jsx("button",{className:`theme-editor-tab ${w==="advanced"?"active":""}`,onClick:()=>b("advanced"),children:"Advanced"})]}),w==="colors"&&p.jsx("div",{className:"theme-editor-colors",children:$.map(R=>p.jsxs("div",{className:"theme-editor-color-group",children:[p.jsx("h4",{children:R.name}),p.jsx("div",{className:"theme-editor-color-grid",children:R.colors.map(({key:M,label:A})=>p.jsx(Vae,{label:A,color:f[M],onChange:P=>k(M,P)},M))})]},R.name))}),w==="advanced"&&p.jsx("div",{className:"theme-editor-advanced",children:p.jsxs("div",{className:"theme-editor-field",children:[p.jsx("label",{children:"Custom CSS"}),p.jsx("textarea",{className:"theme-editor-css",value:g,onChange:R=>y(R.target.value),placeholder:`.sidebar {
  /* Custom styles */
}`,rows:12}),p.jsx("span",{className:"theme-editor-hint",children:"Add custom CSS to fine-tune your theme. Selectors are automatically scoped."})]})})]}),p.jsxs("div",{className:"theme-editor-preview-panel",children:[p.jsx("h4",{children:"Live Preview"}),p.jsx("div",{className:"theme-editor-preview",style:{"--preview-bg-primary":f.bgPrimary,"--preview-bg-secondary":f.bgSecondary,"--preview-bg-tertiary":f.bgTertiary,"--preview-text-primary":f.textPrimary,"--preview-text-secondary":f.textSecondary,"--preview-accent":f.accent,"--preview-border":f.borderColor},children:p.jsxs("div",{className:"preview-app",children:[p.jsxs("div",{className:"preview-sidebar",children:[p.jsx("div",{className:"preview-logo",style:{background:f.accent}}),p.jsx("div",{className:"preview-nav-item active",style:{background:f.accentSoft},children:p.jsx("div",{className:"preview-nav-indicator",style:{background:f.accent}})}),p.jsx("div",{className:"preview-nav-item"}),p.jsx("div",{className:"preview-nav-item"})]}),p.jsxs("div",{className:"preview-content",children:[p.jsx("div",{className:"preview-header",style:{background:f.textPrimary}}),p.jsxs("div",{className:"preview-cards",children:[p.jsxs("div",{className:"preview-card",children:[p.jsx("div",{className:"preview-card-art",style:{background:f.bgTertiary}}),p.jsx("div",{className:"preview-card-text",style:{background:f.textSecondary}})]}),p.jsxs("div",{className:"preview-card",children:[p.jsx("div",{className:"preview-card-art",style:{background:f.bgTertiary}}),p.jsx("div",{className:"preview-card-text",style:{background:f.textSecondary}})]}),p.jsxs("div",{className:"preview-card",children:[p.jsx("div",{className:"preview-card-art",style:{background:f.bgTertiary}}),p.jsx("div",{className:"preview-card-text",style:{background:f.textSecondary}})]})]})]}),p.jsxs("div",{className:"preview-player",children:[p.jsx("div",{className:"preview-player-art",style:{background:f.bgTertiary}}),p.jsxs("div",{className:"preview-player-info",children:[p.jsx("div",{className:"preview-player-title",style:{background:f.textPrimary}}),p.jsx("div",{className:"preview-player-artist",style:{background:f.textSecondary}})]}),p.jsx("div",{className:"preview-player-btn",style:{background:f.accent}})]})]})})]})]}),p.jsxs("div",{className:"theme-editor-footer",children:[p.jsxs("div",{className:"theme-editor-footer-left",children:[p.jsxs("button",{className:"theme-editor-btn secondary",onClick:S,children:[p.jsx(Pf,{size:16}),"Reset"]}),p.jsxs("button",{className:"theme-editor-btn secondary",onClick:N,children:[p.jsx(gl,{size:16}),"Copy JSON"]})]}),p.jsxs("div",{className:"theme-editor-footer-right",children:[p.jsx("button",{className:"theme-editor-btn secondary",onClick:e,children:"Cancel"}),p.jsxs("button",{className:"theme-editor-btn primary",onClick:v,children:[p.jsx(wp,{size:16}),t?"Save Changes":"Create Theme"]})]})]})]})}):null},Hae=({onAccept:n,onDecline:e})=>p.jsx("div",{className:"mobile-privacy-overlay",children:p.jsxs("div",{className:"mobile-privacy-modal",children:[p.jsx("div",{className:"mobile-privacy-icon",children:p.jsx(yD,{size:48})}),p.jsx("h2",{className:"mobile-privacy-title",children:"Mobile Access"}),p.jsx("p",{className:"mobile-privacy-subtitle",children:"Stream your music anywhere"}),p.jsxs("div",{className:"mobile-privacy-content",children:[p.jsxs("div",{className:"mobile-privacy-section",children:[p.jsxs("div",{className:"mobile-privacy-feature",children:[p.jsx("div",{className:"mobile-privacy-feature-icon secure",children:p.jsx(Qae,{size:20})}),p.jsxs("div",{className:"mobile-privacy-feature-info",children:[p.jsx("h4",{children:"Secure Connection"}),p.jsx("p",{children:"Each session uses a unique, randomly generated access token. Only devices with your token can connect."})]})]}),p.jsxs("div",{className:"mobile-privacy-feature",children:[p.jsx("div",{className:"mobile-privacy-feature-icon private",children:p.jsx(Yae,{size:20})}),p.jsxs("div",{className:"mobile-privacy-feature-info",children:[p.jsx("h4",{children:"Your Data Stays Yours"}),p.jsx("p",{children:"Music streams directly from your computer. No data is sent to external servers or stored in the cloud."})]})]}),p.jsxs("div",{className:"mobile-privacy-feature",children:[p.jsx("div",{className:"mobile-privacy-feature-icon control",children:p.jsx(Jae,{size:20})}),p.jsxs("div",{className:"mobile-privacy-feature-info",children:[p.jsx("h4",{children:"You're in Control"}),p.jsx("p",{children:"See all connected devices, disconnect any session instantly, or regenerate your access token at any time."})]})]})]}),p.jsxs("div",{className:"mobile-privacy-note",children:[p.jsx(Zae,{size:16}),p.jsxs("p",{children:[p.jsx("strong",{children:"How it works:"})," Audiio creates a personal server on your computer. Scan the QR code with your phone to access your music library through a secure web portal."]})]})]}),p.jsxs("div",{className:"mobile-privacy-actions",children:[p.jsx("button",{className:"mobile-privacy-btn secondary",onClick:e,children:"Not Now"}),p.jsx("button",{className:"mobile-privacy-btn primary",onClick:n,children:"Enable Mobile Access"})]})]})}),qae=({qrCode:n,url:e,isRemote:t})=>{const[s,r]=L.useState(!1),o=async()=>{try{await navigator.clipboard.writeText(e),r(!0),setTimeout(()=>r(!1),2e3)}catch{}};return p.jsxs("div",{className:"mobile-qr-container",children:[p.jsx("div",{className:"mobile-qr-card",children:n?p.jsx("img",{src:n,alt:"Scan to connect",className:"mobile-qr-image"}):p.jsx("div",{className:"mobile-qr-placeholder",children:p.jsx(ele,{size:64})})}),p.jsxs("div",{className:"mobile-qr-info",children:[p.jsx("p",{className:"mobile-qr-instruction",children:"Scan with your phone's camera"}),p.jsxs("div",{className:"mobile-qr-url-row",children:[p.jsx("span",{className:"mobile-qr-badge",children:t?"Remote":"Local Network"}),p.jsxs("button",{className:"mobile-qr-copy",onClick:o,children:[s?p.jsx(nle,{size:14}):p.jsx(tle,{size:14}),s?"Copied!":"Copy Link"]})]})]})]})},Kae=({sessions:n,onDisconnect:e})=>{const t=s=>{const r=Date.now()-s,o=Math.floor(r/6e4);if(o<1)return"Just now";if(o<60)return`${o}m ago`;const i=Math.floor(o/60);return i<24?`${i}h ago`:new Date(s).toLocaleDateString()};return n.length===0?p.jsxs("div",{className:"mobile-devices-empty",children:[p.jsx(sle,{size:32}),p.jsx("p",{children:"No devices connected"}),p.jsx("span",{children:"Scan the QR code with your phone to get started"})]}):p.jsx("div",{className:"mobile-devices-list",children:n.map(s=>p.jsxs("div",{className:"mobile-device-item",children:[p.jsxs("div",{className:"mobile-device-icon",children:[p.jsx(rle,{size:20}),p.jsx("span",{className:`mobile-device-status ${s.isActive?"active":""}`})]}),p.jsxs("div",{className:"mobile-device-info",children:[p.jsx("span",{className:"mobile-device-name",children:s.deviceName||"Unknown Device"}),p.jsx("span",{className:"mobile-device-time",children:s.isActive?"Active now":`Last seen ${t(s.lastActivity)}`})]}),p.jsx("button",{className:"mobile-device-disconnect",onClick:()=>e(s.id),title:"Disconnect this device",children:p.jsx(ole,{size:16})})]},s.id))})},Xae=()=>{var w,b,k;const[n,e]=L.useState({isEnabled:!1,isLoading:!0,accessConfig:null,sessions:[],enableRemoteAccess:!1,hasAcceptedPrivacy:localStorage.getItem("audiio-mobile-privacy-accepted")==="true"}),[t,s]=L.useState(!1);L.useEffect(()=>{r()},[]);const r=async()=>{var v,N;console.log("[MobileAccess] Loading status...");try{const S=await((N=(v=window.api)==null?void 0:v.getMobileStatus)==null?void 0:N.call(v));console.log("[MobileAccess] Status:",S),S?e($=>({...$,isEnabled:S.isEnabled,accessConfig:S.accessConfig,sessions:S.sessions||[],enableRemoteAccess:S.enableRemoteAccess||!1,isLoading:!1})):(console.log("[MobileAccess] No status returned (API may not be available)"),e($=>({...$,isLoading:!1})))}catch(S){console.error("[MobileAccess] Error loading status:",S),e($=>({...$,isLoading:!1}))}},o=()=>{n.hasAcceptedPrivacy?l():s(!0)},i=()=>{localStorage.setItem("audiio-mobile-privacy-accepted","true"),e(v=>({...v,hasAcceptedPrivacy:!0})),s(!1),l()},a=()=>{s(!1)},l=async()=>{var v,N;console.log("[MobileAccess] Enabling mobile access..."),e(S=>({...S,isLoading:!0}));try{const S=await((N=(v=window.api)==null?void 0:v.enableMobileAccess)==null?void 0:N.call(v));console.log("[MobileAccess] Result:",S),S!=null&&S.success&&S.accessConfig?(console.log("[MobileAccess] Successfully enabled, QR:",!!S.accessConfig.qrCode),e($=>({...$,isEnabled:!0,accessConfig:S.accessConfig,isLoading:!1}))):(console.error("[MobileAccess] Enable failed:",(S==null?void 0:S.error)||"Unknown error"),e($=>({...$,isLoading:!1})))}catch(S){console.error("[MobileAccess] Failed to enable mobile access:",S),e($=>({...$,isLoading:!1}))}},u=async()=>{var v,N;e(S=>({...S,isLoading:!0}));try{await((N=(v=window.api)==null?void 0:v.disableMobileAccess)==null?void 0:N.call(v)),e(S=>({...S,isEnabled:!1,accessConfig:null,sessions:[],isLoading:!1}))}catch(S){console.error("Failed to disable mobile access:",S),e($=>({...$,isLoading:!1}))}},d=async()=>{var N,S;const v=!n.enableRemoteAccess;e($=>({...$,enableRemoteAccess:v,isLoading:!0}));try{const $=await((S=(N=window.api)==null?void 0:N.setMobileRemoteAccess)==null?void 0:S.call(N,v));$!=null&&$.accessConfig&&e(R=>({...R,accessConfig:$.accessConfig,isLoading:!1}))}catch{e($=>({...$,enableRemoteAccess:!v,isLoading:!1}))}},f=async()=>{var v,N;e(S=>({...S,isLoading:!0}));try{const S=await((N=(v=window.api)==null?void 0:v.regenerateMobileToken)==null?void 0:N.call(v));S!=null&&S.accessConfig&&e($=>({...$,accessConfig:S.accessConfig,sessions:[],isLoading:!1}))}catch{e(S=>({...S,isLoading:!1}))}},m=async v=>{var N,S;try{await((S=(N=window.api)==null?void 0:N.disconnectMobileSession)==null?void 0:S.call(N,v)),e($=>({...$,sessions:$.sessions.filter(R=>R.id!==v)}))}catch($){console.error("Failed to disconnect device:",$)}};if(n.isLoading&&!n.isEnabled)return p.jsx("div",{className:"mobile-access-loading",children:p.jsx("div",{className:"mobile-access-spinner"})});const g=((w=n.accessConfig)==null?void 0:w.tunnelUrl)||((b=n.accessConfig)==null?void 0:b.localUrl)||"",y=!!((k=n.accessConfig)!=null&&k.tunnelUrl);return p.jsxs("div",{className:"mobile-access-settings",children:[t&&p.jsx(Hae,{onAccept:i,onDecline:a}),p.jsxs("div",{className:"mobile-access-header",children:[p.jsx("div",{className:"mobile-access-header-icon",children:p.jsx(yD,{size:24})}),p.jsxs("div",{className:"mobile-access-header-info",children:[p.jsx("h3",{children:"Mobile Access"}),p.jsx("p",{children:"Access your music from your phone or tablet"})]}),p.jsxs("label",{className:"mobile-access-toggle",children:[p.jsx("input",{type:"checkbox",checked:n.isEnabled,onChange:n.isEnabled?u:o,disabled:n.isLoading}),p.jsx("span",{className:"mobile-access-toggle-slider"})]})]}),n.isEnabled&&n.accessConfig&&p.jsxs("div",{className:"mobile-access-content",children:[p.jsx(qae,{qrCode:n.accessConfig.qrCode||"",url:g,isRemote:y}),p.jsxs("div",{className:"mobile-access-option",children:[p.jsxs("div",{className:"mobile-access-option-info",children:[p.jsxs("div",{className:"mobile-access-option-row",children:[p.jsx(ile,{size:18}),p.jsx("h4",{children:"Access from Anywhere"})]}),p.jsx("p",{children:"Enable to access your music outside your home network. Uses a secure tunnel connection."})]}),p.jsxs("label",{className:"mobile-access-toggle small",children:[p.jsx("input",{type:"checkbox",checked:n.enableRemoteAccess,onChange:d,disabled:n.isLoading}),p.jsx("span",{className:"mobile-access-toggle-slider"})]})]}),p.jsxs("div",{className:"mobile-access-section",children:[p.jsxs("div",{className:"mobile-access-section-header",children:[p.jsx("h4",{children:"Connected Devices"}),p.jsx("span",{className:"mobile-access-count",children:n.sessions.length})]}),p.jsx(Kae,{sessions:n.sessions,onDisconnect:m})]}),p.jsxs("div",{className:"mobile-access-actions",children:[p.jsxs("button",{className:"mobile-access-action-btn",onClick:f,disabled:n.isLoading,children:[p.jsx(ale,{size:16}),p.jsx("span",{children:"New Access Code"})]}),p.jsx("p",{className:"mobile-access-action-hint",children:"Generating a new code will disconnect all devices"})]})]}),!n.isEnabled&&p.jsx("div",{className:"mobile-access-disabled-hint",children:p.jsx("p",{children:"Turn on to create a personal streaming portal. Scan the QR code with your phone to listen anywhere."})})]})},yD=({size:n})=>p.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:p.jsx("path",{d:"M17 1.01L7 1c-1.1 0-2 .9-2 2v18c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2V3c0-1.1-.9-1.99-2-1.99zM17 19H7V5h10v14z"})}),Qae=({size:n})=>p.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:p.jsx("path",{d:"M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z"})}),Yae=({size:n})=>p.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:p.jsx("path",{d:"M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm0 10.99h7c-.53 4.12-3.28 7.79-7 8.94V12H5V6.3l7-3.11v8.8z"})}),Jae=({size:n})=>p.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:p.jsx("path",{d:"M3 17v2h6v-2H3zM3 5v2h10V5H3zm10 16v-2h8v-2h-8v-2h-2v6h2zM7 9v2H3v2h4v2h2V9H7zm14 4v-2H11v2h10zm-6-4h2V7h4V5h-4V3h-2v6z"})}),Zae=({size:n})=>p.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:p.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"})}),ele=({size:n})=>p.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:p.jsx("path",{d:"M3 11h8V3H3v8zm2-6h4v4H5V5zM3 21h8v-8H3v8zm2-6h4v4H5v-4zM13 3v8h8V3h-8zm6 6h-4V5h4v4zM13 13h2v2h-2zM15 15h2v2h-2zM13 17h2v2h-2zM17 13h2v2h-2zM19 15h2v2h-2zM17 17h2v2h-2zM15 19h2v2h-2zM19 19h2v2h-2z"})}),tle=({size:n})=>p.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:p.jsx("path",{d:"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"})}),nle=({size:n})=>p.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:p.jsx("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"})}),sle=({size:n})=>p.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:p.jsx("path",{d:"M4 6h18V4H4c-1.1 0-2 .9-2 2v11H0v3h14v-3H4V6zm19 2h-6c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h6c.55 0 1-.45 1-1V9c0-.55-.45-1-1-1zm-1 9h-4v-7h4v7z"})}),rle=({size:n})=>p.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:p.jsx("path",{d:"M16 1H8C6.34 1 5 2.34 5 4v16c0 1.66 1.34 3 3 3h8c1.66 0 3-1.34 3-3V4c0-1.66-1.34-3-3-3zm-2 20h-4v-1h4v1zm3.25-3H6.75V4h10.5v14z"})}),ole=({size:n})=>p.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:p.jsx("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})}),ile=({size:n})=>p.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:p.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"})}),ale=({size:n})=>p.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:p.jsx("path",{d:"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"})});function lle(n){let e=n.trim();if(/^[a-zA-Z0-9_-]+\/[a-zA-Z0-9_.-]+$/.test(e)){const t=e.split("/"),s=t[0]??"",r=t[1]??"";return{owner:s,repo:r}}try{e.startsWith("http")||(e="https://"+e);const t=new URL(e);if(!t.hostname.includes("github.com"))return null;const s=t.pathname.split("/").filter(Boolean);if(s.length<2)return null;const r=s[0]??"",o=s[1]??"";let i;return s.length>3&&s[2]==="tree"&&(i=s[3]),{owner:r,repo:o.replace(/\.git$/,""),branch:i}}catch{return null}}function cle(n,e="audiio-theme.json"){const t=n.branch||"main";return`https://raw.githubusercontent.com/${n.owner}/${n.repo}/${t}/${e}`}const ule=["name","colors"],dle=["bgPrimary","bgSecondary","textPrimary","textSecondary","accent"];function hle(n){const e=[];if(!n||typeof n!="object")return{valid:!1,errors:["Theme must be an object"]};const t=n;for(const s of ule)t[s]||e.push(`Missing required field: ${s}`);if(t.name&&typeof t.name!="string"&&e.push("Theme name must be a string"),t.colors)if(typeof t.colors!="object")e.push("Colors must be an object");else{const s=t.colors;for(const r of dle)s[r]?fle(s[r])||e.push(`Invalid color value for ${r}: ${s[r]}`):e.push(`Missing required color: ${r}`)}return t.mode&&!["light","dark"].includes(t.mode)&&e.push('Mode must be "light" or "dark"'),t.customCSS&&typeof t.customCSS=="string"&&t.customCSS.length>5e4&&e.push("Custom CSS must be less than 50KB"),{valid:e.length===0,errors:e}}function fle(n){return!n||typeof n!="string"?!1:!!(/^#([0-9A-Fa-f]{3}){1,2}$/.test(n)||/^#([0-9A-Fa-f]{4}){1,2}$/.test(n)||/^rgba?\s*\(\s*\d+\s*,\s*\d+\s*,\s*\d+\s*(,\s*[\d.]+)?\s*\)$/i.test(n)||/^hsla?\s*\(\s*\d+\s*,\s*[\d.]+%?\s*,\s*[\d.]+%?\s*(,\s*[\d.]+)?\s*\)$/i.test(n)||["transparent","currentColor","inherit","black","white","red","green","blue","yellow","orange","purple","gray","grey","pink","cyan","magenta"].includes(n.toLowerCase()))}const ple=[/expression\s*\(/gi,/javascript\s*:/gi,/vbscript\s*:/gi,/behavior\s*:/gi,/@import/gi,/url\s*\(\s*["']?data:/gi,/-moz-binding/gi,/binding\s*:/gi];function mle(n){if(!n||typeof n!="string")return"";let e=n;for(const t of ple)e=e.replace(t,"/* blocked */");return e=gle(e,".audiio-app"),e}function gle(n,e){const t=n.split(`
`),s=[];let r=!1,o="",i="";for(const a of t){const l=a.trim();if(l.startsWith("@")){s.push(a);continue}if(l.includes("{")){const u=l.split("{");i=(u[0]??"").trim(),!i.startsWith(e)&&!i.startsWith(":root")&&(i=i.split(",").map(d=>{const f=d.trim();return f.startsWith("body")||f.startsWith("html")?`${e} ${f}`:`${e} ${f}`}).join(", ")),s.push(`${i} {`),r=!0,o=u.slice(1).join("{"),o.includes("}")&&(s.push(o),r=!1,o="")}else r&&l.includes("}")?(s.push(a),r=!1,o=""):s.push(a)}return s.join(`
`)}async function xle(n){const e=lle(n);if(!e)throw new Error("Invalid GitHub URL format");const t=["audiio-theme.json","theme.json",".audiio-theme.json"];for(const s of t)try{const r=cle(e,s),o=await fetch(r);if(o.ok){const i=await o.json(),a=hle(i);if(!a.valid)throw new Error(`Invalid theme: ${a.errors.join(", ")}`);return i.customCSS&&(i.customCSS=mle(i.customCSS)),i}}catch{continue}throw new Error("Could not find a valid theme manifest in the repository")}const $0=({theme:n,isActive:e,onSelect:t,onDelete:s,onEdit:r})=>p.jsxs("button",{className:`theme-preview-card ${e?"active":""}`,onClick:t,title:n.description,children:[p.jsxs("div",{className:"theme-preview",style:{background:n.colors.bgPrimary,borderColor:n.colors.borderColor},children:[p.jsxs("div",{className:"theme-preview-sidebar",style:{background:n.colors.bgSecondary},children:[p.jsx("div",{className:"theme-preview-sidebar-item",style:{background:n.colors.accent}}),p.jsx("div",{className:"theme-preview-sidebar-item",style:{background:n.colors.bgTertiary}})]}),p.jsxs("div",{className:"theme-preview-content",children:[p.jsx("div",{className:"theme-preview-header",style:{background:n.colors.textPrimary}}),p.jsxs("div",{className:"theme-preview-cards",children:[p.jsx("div",{className:"theme-preview-card-item",style:{background:n.colors.bgSecondary}}),p.jsx("div",{className:"theme-preview-card-item",style:{background:n.colors.bgSecondary}})]})]}),p.jsx("div",{className:"theme-preview-player",style:{background:n.colors.bgSecondary},children:p.jsx("div",{className:"theme-preview-player-accent",style:{background:n.colors.accent}})})]}),p.jsxs("div",{className:"theme-preview-info",children:[p.jsx("span",{className:"theme-preview-name",children:n.name}),p.jsx("span",{className:"theme-preview-mode",children:n.mode})]}),e&&p.jsx("div",{className:"theme-preview-check",children:p.jsx(wp,{size:14})}),(r||s)&&p.jsxs("div",{className:"theme-preview-actions",children:[r&&p.jsx("button",{className:"theme-preview-action edit",onClick:o=>{o.stopPropagation(),r()},title:"Edit theme",children:p.jsx(B4,{size:14})}),s&&p.jsx("button",{className:"theme-preview-action delete",onClick:o=>{o.stopPropagation(),s()},title:"Remove theme",children:p.jsx(Q4,{size:14})})]})]}),yle=({currentMode:n,onChange:e})=>{const t=[{id:"auto",label:"Auto",icon:p.jsx(q4,{size:16})},{id:"light",label:"Light",icon:p.jsx(HS,{size:16})},{id:"dark",label:"Dark",icon:p.jsx(qS,{size:16})}];return p.jsx("div",{className:"mode-toggle",children:t.map(s=>p.jsxs("button",{className:`mode-toggle-btn ${n===s.id?"active":""}`,onClick:()=>e(s.id),children:[s.icon,p.jsx("span",{children:s.label})]},s.id))})},vle=()=>{const{activeThemeId:n,systemMode:e,themes:t,communityThemes:s,setTheme:r,setSystemMode:o,installTheme:i,uninstallTheme:a,importTheme:l,exportTheme:u,getActiveTheme:d}=ml(),[f,m]=L.useState(!1),[g,y]=L.useState(""),[w,b]=L.useState(""),[k,v]=L.useState(!1),[N,S]=L.useState(void 0),[$,R]=L.useState(!1),[M,A]=L.useState(""),[P,D]=L.useState(""),[E,j]=L.useState(!1),V=d(),W=t.filter(B=>B.source==="builtin"),U=W.filter(B=>B.mode==="dark"),X=W.filter(B=>B.mode==="light"),ee=()=>{if(!g.trim()){b("Please paste theme JSON");return}const B=l(g);B?(m(!1),y(""),b(""),r(B.id)):b("Invalid theme format. Please check the JSON.")},G=()=>{const B=u(n);B&&navigator.clipboard.writeText(B)},z=()=>{S(void 0),v(!0)},H=B=>{S(B),v(!0)},O=async()=>{if(!M.trim()){D("Please enter a GitHub repository URL");return}j(!0),D("");try{const B=await xle(M);if(B){const Y={...B,id:`community-${Date.now()}`,source:"community"};i(Y),r(Y.id),R(!1),A("")}}catch(B){D(B instanceof Error?B.message:"Failed to import theme")}finally{j(!1)}};return p.jsxs("div",{className:"settings-view",children:[p.jsxs("header",{className:"settings-header",children:[p.jsx("div",{className:"settings-header-icon",children:p.jsx(Sy,{size:64})}),p.jsxs("div",{className:"settings-header-info",children:[p.jsx("span",{className:"settings-header-type",children:"Preferences"}),p.jsx("h1",{className:"settings-header-title",children:"Appearance"}),p.jsx("span",{className:"settings-header-subtitle",children:"Customize your Audiio experience"})]})]}),p.jsxs("div",{className:"settings-content",children:[p.jsxs("section",{className:"settings-section",children:[p.jsxs("div",{className:"settings-section-header",children:[p.jsx(K4,{size:20}),p.jsx("h2",{children:"Appearance"})]}),p.jsxs("div",{className:"settings-option",children:[p.jsxs("div",{className:"settings-option-info",children:[p.jsx("h3",{children:"Mode"}),p.jsx("p",{children:"Choose between light, dark, or auto (follows system)"})]}),p.jsx(yle,{currentMode:e,onChange:o})]}),p.jsxs("div",{className:"settings-current-theme",children:[p.jsx("div",{className:"settings-current-theme-label",children:"Current Theme"}),p.jsxs("div",{className:"settings-current-theme-preview",style:{background:V.colors.bgSecondary,borderColor:V.colors.borderLight},children:[p.jsx("div",{className:"settings-current-accent",style:{background:V.colors.accent}}),p.jsxs("div",{className:"settings-current-info",children:[p.jsx("span",{className:"settings-current-name",children:V.name}),p.jsxs("span",{className:"settings-current-author",children:["by ",V.author]})]})]})]}),p.jsxs("div",{className:"settings-theme-group",children:[p.jsx("h3",{children:"Dark Themes"}),p.jsx("div",{className:"settings-theme-grid",children:U.map(B=>p.jsx($0,{theme:B,isActive:n===B.id,onSelect:()=>r(B.id)},B.id))})]}),p.jsxs("div",{className:"settings-theme-group",children:[p.jsx("h3",{children:"Light Themes"}),p.jsx("div",{className:"settings-theme-grid",children:X.map(B=>p.jsx($0,{theme:B,isActive:n===B.id,onSelect:()=>r(B.id)},B.id))})]}),s.length>0&&p.jsxs("div",{className:"settings-theme-group",children:[p.jsx("h3",{children:"Community Themes"}),p.jsx("div",{className:"settings-theme-grid",children:s.map(B=>p.jsx($0,{theme:B,isActive:n===B.id,onSelect:()=>r(B.id),onEdit:()=>H(B),onDelete:()=>a(B.id)},B.id))})]}),p.jsxs("div",{className:"settings-theme-actions",children:[p.jsxs("button",{className:"settings-action-btn primary",onClick:z,children:[p.jsx(X4,{size:16}),p.jsx("span",{children:"Create Theme"})]}),p.jsxs("button",{className:"settings-action-btn",onClick:()=>R(!0),children:[p.jsx(Xx,{size:16}),p.jsx("span",{children:"From GitHub"})]}),p.jsxs("button",{className:"settings-action-btn",onClick:()=>m(!0),children:[p.jsx(Y4,{size:16}),p.jsx("span",{children:"Import JSON"})]}),p.jsxs("button",{className:"settings-action-btn",onClick:G,children:[p.jsx(gl,{size:16}),p.jsx("span",{children:"Export Current"})]})]})]}),p.jsxs("section",{className:"settings-section",children:[p.jsxs("div",{className:"settings-section-header",children:[p.jsx(ble,{size:20}),p.jsx("h2",{children:"Mobile Access"})]}),p.jsx(Xae,{})]})]}),f&&p.jsx("div",{className:"modal-overlay",onClick:()=>m(!1),children:p.jsxs("div",{className:"modal",onClick:B=>B.stopPropagation(),children:[p.jsxs("div",{className:"modal-header",children:[p.jsx("h2",{children:"Import Theme"}),p.jsx("button",{className:"modal-close",onClick:()=>m(!1),children:""})]}),p.jsxs("div",{className:"modal-body",children:[p.jsx("p",{className:"settings-import-hint",children:"Paste the theme JSON below to import a custom theme."}),p.jsx("textarea",{className:"settings-import-textarea",placeholder:'{"name": "My Theme", "colors": {...}}',value:g,onChange:B=>{y(B.target.value),b("")},rows:10}),w&&p.jsx("div",{className:"settings-import-error",children:w})]}),p.jsxs("div",{className:"modal-footer",children:[p.jsx("button",{className:"modal-btn secondary",onClick:()=>m(!1),children:"Cancel"}),p.jsx("button",{className:"modal-btn primary",onClick:ee,children:"Import"})]})]})}),$&&p.jsx("div",{className:"modal-overlay",onClick:()=>R(!1),children:p.jsxs("div",{className:"modal",onClick:B=>B.stopPropagation(),children:[p.jsxs("div",{className:"modal-header",children:[p.jsxs("h2",{children:[p.jsx(Xx,{size:20}),"Import from GitHub"]}),p.jsx("button",{className:"modal-close",onClick:()=>R(!1),children:""})]}),p.jsxs("div",{className:"modal-body",children:[p.jsxs("p",{className:"settings-import-hint",children:["Enter a GitHub repository URL to import a theme. The repository should contain an"," ",p.jsx("code",{children:"audiio-theme.json"})," file in its root."]}),p.jsxs("div",{className:"settings-github-input-wrapper",children:[p.jsx(Xx,{size:18}),p.jsx("input",{type:"text",className:"settings-github-input",placeholder:"github.com/user/my-theme or user/my-theme",value:M,onChange:B=>{A(B.target.value),D("")},onKeyDown:B=>{B.key==="Enter"&&!E&&O()}})]}),P&&p.jsx("div",{className:"settings-import-error",children:P}),p.jsxs("div",{className:"settings-github-examples",children:[p.jsx("span",{className:"settings-github-examples-label",children:"Examples:"}),p.jsx("code",{children:"github.com/username/theme-repo"}),p.jsx("code",{children:"username/audiio-dark-theme"})]})]}),p.jsxs("div",{className:"modal-footer",children:[p.jsx("button",{className:"modal-btn secondary",onClick:()=>R(!1),children:"Cancel"}),p.jsx("button",{className:"modal-btn primary",onClick:O,disabled:E,children:E?p.jsxs(p.Fragment,{children:[p.jsx(J4,{size:16}),"Importing..."]}):"Import"})]})]})}),p.jsx(Gae,{isOpen:k,onClose:()=>{v(!1),S(void 0)},editingTheme:N})]})},ble=({size:n})=>p.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:p.jsx("path",{d:"M17 1.01L7 1c-1.1 0-2 .9-2 2v18c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2V3c0-1.1-.9-1.99-2-1.99zM17 19H7V5h10v14z"})});function nl(n,e,t){var s,r,o,i;return{id:n.id,title:n.title,artist:((r=(s=n.artists)==null?void 0:s[0])==null?void 0:r.name)||e,artwork:((o=n.artwork)==null?void 0:o.medium)||((i=n.artwork)==null?void 0:i.small),year:n.releaseDate?parseInt(n.releaseDate.substring(0,4)):void 0,trackCount:n.trackCount,albumType:n.albumType,source:t}}const wle=Ps((n,e)=>({artistCache:new Map,loadingArtistId:null,error:null,fetchArtist:async(t,s,r)=>{var i,a,l,u;const o=e().artistCache.get(t);if(o&&o.topTracks.length>0)return o;n({loadingArtistId:t,error:null});try{if(!window.api)throw new Error("API not available");if(window.api.getArtist)try{const v=await window.api.getArtist(t,r==null?void 0:r.source);if(v){const N={albums:(v.albums||[]).map(V=>nl(V,s,(r==null?void 0:r.source)||"addon")),singles:(v.singles||[]).map(V=>nl(V,s,(r==null?void 0:r.source)||"addon")),eps:(v.eps||[]).map(V=>nl(V,s,(r==null?void 0:r.source)||"addon")),compilations:(v.compilations||[]).map(V=>nl(V,s,(r==null?void 0:r.source)||"addon"))},S=(v.similarArtists||[]).map(V=>{var W,U;return{id:V.id,name:V.name,image:((W=V.artwork)==null?void 0:W.medium)||((U=V.artwork)==null?void 0:U.small),source:(r==null?void 0:r.source)||"addon"}}),$=(v.appearsOn||[]).map(V=>nl(V,s,(r==null?void 0:r.source)||"addon")),R=(v.topTracks||[]).map(V=>({...V,streamSources:[],_meta:{metadataProvider:(r==null?void 0:r.source)||"addon",matchConfidence:1,externalIds:{},lastUpdated:new Date}})),M=Date.now()-365*24*60*60*1e3,D=[...N.albums,...N.singles,...N.eps].filter(V=>V.year?new Date(`${V.year}-01-01`).getTime()>M:!1).sort((V,W)=>(W.year||0)-(V.year||0))[0],E={id:t,name:v.name||s,image:((i=v.artwork)==null?void 0:i.large)||((a=v.artwork)==null?void 0:a.medium)||(r==null?void 0:r.image),followers:v.followers||(r==null?void 0:r.followers),genres:v.genres||(r==null?void 0:r.genres),bio:v.bio,verified:v.verified,externalUrls:v.externalUrls,source:(r==null?void 0:r.source)||"addon",topTracks:R.slice(0,10),albums:N.albums.slice(0,10),singles:N.singles.slice(0,10),eps:N.eps.slice(0,10),compilations:N.compilations.slice(0,10),appearsOn:$.slice(0,10),similarArtists:S.slice(0,10),latestRelease:D},j=new Map(e().artistCache);return j.set(t,E),n({artistCache:j,loadingArtistId:null}),E}}catch(v){console.warn("getArtist API failed, falling back to search:",v)}const f=(await window.api.search({query:s,type:"track"})||[]).filter(v=>v.artists.some(N=>N.name.toLowerCase()===s.toLowerCase()||N.id===t)),g=(await window.api.search({query:s,type:"album"}).catch(()=>[])||[]).filter(v=>{var S;const N=(S=v.artists)==null?void 0:S[0];return N&&(N.name.toLowerCase()===s.toLowerCase()||N.id===t)}).map(v=>nl(v,s,"addon")),y=new Map;for(const v of f)v.album&&!y.has(v.album.id)&&y.set(v.album.id,{id:v.album.id,title:v.album.title,artist:s,artwork:(l=v.album.artwork)==null?void 0:l.medium,year:v.album.releaseDate?parseInt(v.album.releaseDate.substring(0,4)):void 0,trackCount:v.album.trackCount,source:((u=v._meta)==null?void 0:u.metadataProvider)||"unknown"});const w=g.length>0?g:Array.from(y.values()),b={id:t,name:s,image:r==null?void 0:r.image,followers:r==null?void 0:r.followers,genres:r==null?void 0:r.genres,bio:void 0,verified:void 0,externalUrls:void 0,source:(r==null?void 0:r.source)||"addon",topTracks:f.slice(0,10),albums:w.slice(0,10),singles:[],eps:[],compilations:[],appearsOn:[],similarArtists:[]},k=new Map(e().artistCache);return k.set(t,b),n({artistCache:k,loadingArtistId:null}),b}catch(d){return n({error:d instanceof Error?d.message:"Failed to fetch artist",loadingArtistId:null}),null}},getArtist:t=>e().artistCache.get(t)||null,clearCache:()=>{n({artistCache:new Map})}})),Hc=new Map;function qi(){return{dominant:"#1db954",vibrant:"#1ed760",muted:"#2d2d2d",darkVibrant:"#0d5c2a",lightVibrant:"#5eff8f"}}function qc(n,e,t){return"#"+[n,e,t].map(s=>{const r=Math.round(Math.max(0,Math.min(255,s))).toString(16);return r.length===1?"0"+r:r}).join("")}function T0(n,e,t){return(.299*n+.587*e+.114*t)/255}function DS(n,e,t){const s=Math.max(n,e,t),r=Math.min(n,e,t);return s===0?0:(s-r)/s}function MS(n,e,t,s){return{r:Math.round(n*s),g:Math.round(e*s),b:Math.round(t*s)}}function kle(n,e=5){const t=new Map;for(let s=0;s<n.length;s+=4){const r=n[s]??0,o=n[s+1]??0,i=n[s+2]??0;if((n[s+3]??0)<128)continue;const l=Math.round(r/16)*16,u=Math.round(o/16)*16,d=Math.round(i/16)*16,f=`${l},${u},${d}`,m=t.get(f);m?(m.count++,m.r=Math.round(((m.r??0)*(m.count-1)+r)/m.count),m.g=Math.round(((m.g??0)*(m.count-1)+o)/m.count),m.b=Math.round(((m.b??0)*(m.count-1)+i)/m.count)):t.set(f,{r,g:o,b:i,count:1})}return Array.from(t.values()).sort((s,r)=>r.count-s.count).slice(0,e*3)}function Cle(n){if(n.length===0)return qi();let e=n[0];for(const l of n){const u=T0(l.r,l.g,l.b);if(u>.1&&u<.9){e=l;break}}let t=e,s=0;for(const l of n){const u=DS(l.r,l.g,l.b),d=T0(l.r,l.g,l.b);u>s&&d>.2&&d<.8&&(s=u,t=l)}let r=e,o=1;for(const l of n){const u=DS(l.r,l.g,l.b),d=T0(l.r,l.g,l.b);u<o&&u>.05&&d>.15&&d<.85&&(o=u,r=l)}const i=MS(t.r??0,t.g??0,t.b??0,.4),a=MS(t.r??0,t.g??0,t.b??0,1.4);return{dominant:qc(e.r??0,e.g??0,e.b??0),vibrant:qc(t.r??0,t.g??0,t.b??0),muted:qc(r.r??0,r.g??0,r.b??0),darkVibrant:qc(i.r??0,i.g??0,i.b??0),lightVibrant:qc(a.r??0,a.g??0,a.b??0)}}async function Sle(n){return new Promise(e=>{const t=new Image;t.crossOrigin="anonymous";const s=setTimeout(()=>{e(qi())},5e3);t.onload=()=>{clearTimeout(s);try{const r=document.createElement("canvas"),o=50;r.width=o,r.height=o;const i=r.getContext("2d");if(!i){e(qi());return}i.drawImage(t,0,0,o,o);const a=i.getImageData(0,0,o,o).data,l=kle(a),u=Cle(l);e(u)}catch(r){console.warn("Color extraction failed:",r),e(qi())}},t.onerror=()=>{clearTimeout(s),e(qi())},t.src=n})}async function vD(n){const e=Hc.get(n);if(e)return e;const t=await Sle(n);if(Hc.set(n,t),Hc.size>100){const s=Hc.keys().next().value;s&&Hc.delete(s)}return t}const E0=({label:n,isActive:e,onClick:t,count:s})=>p.jsxs("button",{className:`discography-pill-tab ${e?"active":""}`,onClick:t,role:"tab","aria-selected":e,children:[n,s!==void 0&&s>0&&p.jsx("span",{className:"pill-tab-count",children:s})]}),PS=({album:n,onClick:e,onContextMenu:t})=>p.jsxs("div",{className:"album-card-minimal",onClick:e,onContextMenu:t,role:"button",tabIndex:0,onKeyDown:s=>s.key==="Enter"&&e(),children:[p.jsxs("div",{className:"album-card-minimal-artwork",children:[n.artwork?p.jsx("img",{src:n.artwork,alt:n.title,loading:"lazy"}):p.jsx("div",{className:"album-card-minimal-placeholder",children:p.jsx(Ye,{size:32})}),p.jsx("div",{className:"album-card-minimal-play",children:p.jsx(At,{size:20})})]}),p.jsx("span",{className:"album-card-minimal-title",children:n.title}),n.year&&p.jsx("span",{className:"album-card-minimal-year",children:n.year})]}),Nle=({artist:n,onClick:e})=>p.jsxs("div",{className:"similar-artist-card-circular",onClick:e,role:"button",tabIndex:0,onKeyDown:t=>t.key==="Enter"&&(e==null?void 0:e()),children:[p.jsx("div",{className:"similar-artist-image-circular",children:n.image?p.jsx("img",{src:n.image,alt:n.name,loading:"lazy"}):p.jsx("div",{className:"similar-artist-placeholder-circular",children:p.jsx(Ye,{size:32})})}),p.jsx("span",{className:"similar-artist-name",children:n.name})]}),Ile=()=>{var H,O,B,Y,oe;const{selectedArtistId:n,selectedArtistData:e,goBack:t,openAlbum:s,openArtist:r}=on(),{play:o,setQueue:i,currentTrack:a}=yt(),{fetchArtist:l,getArtist:u,loadingArtistId:d,error:f}=wle(),{showContextMenu:m}=Pn(),{showContextMenu:g}=Gd(),[y,w]=L.useState(qi()),[b,k]=L.useState("albums"),v=L.useRef(null),N=L.useRef(null),S=u(n||""),$=S||e,R=d===n;if(L.useEffect(()=>{$!=null&&$.image&&vD($.image).then(w)},[$==null?void 0:$.image]),L.useEffect(()=>{n&&(e!=null&&e.name)&&l(n,e.name,{image:e.image,followers:e.followers,source:e.source})},[n,e==null?void 0:e.name]),L.useEffect(()=>{k("albums")},[n]),!n)return p.jsx("div",{className:"artist-detail-view-spotify",children:p.jsxs("div",{className:"artist-not-found",children:[p.jsx("p",{children:"Artist not found"}),p.jsx("button",{onClick:t,children:"Go Back"})]})});const M=()=>{if(S!=null&&S.topTracks&&S.topTracks.length>0){const Q=S.topTracks[0];i(S.topTracks,0),Q&&o(Q)}},A=()=>{if(S!=null&&S.topTracks&&S.topTracks.length>0){const Q=[...S.topTracks].sort(()=>Math.random()-.5),ce=Q[0];i(Q,0),ce&&o(ce)}},P=(Q,ce)=>{S!=null&&S.topTracks&&(i(S.topTracks,ce),o(Q))},D=Q=>{s(Q.id,Q)},E=Q=>{r(Q.id,{id:Q.id,name:Q.name,image:Q.image,source:(S==null?void 0:S.source)||"spotify"})},j=Q=>{if(!Q)return"--:--";const ce=Math.floor(Q/60),me=Math.floor(Q%60);return`${ce}:${me.toString().padStart(2,"0")}`},V=Q=>Q?Q>=1e6?`${(Q/1e6).toFixed(1)}M followers`:Q>=1e3?`${Math.floor(Q/1e3)}K followers`:`${Q} followers`:"",U=(()=>{switch(b){case"albums":return(S==null?void 0:S.albums)||[];case"singles":return(S==null?void 0:S.singles)||[];case"eps":return(S==null?void 0:S.eps)||[];default:return[]}})(),X=((H=S==null?void 0:S.albums)==null?void 0:H.length)||0,ee=((O=S==null?void 0:S.singles)==null?void 0:O.length)||0,G=((B=S==null?void 0:S.eps)==null?void 0:B.length)||0,z=X>0||ee>0||G>0;return p.jsxs("div",{className:"artist-detail-view-spotify",style:{"--ambient-color":y.dominant,"--ambient-muted":y.muted,"--ambient-vibrant":y.vibrant},children:[p.jsxs("div",{className:"artist-header-magazine",children:[p.jsx("div",{className:"artist-header-ambient"}),p.jsx("button",{className:"back-btn-round artist-back-btn-pos",onClick:t,"aria-label":"Go back",children:p.jsx(H4,{size:20})}),p.jsxs("div",{className:"artist-header-split",children:[p.jsx("div",{className:"artist-header-image-container",children:$!=null&&$.image?p.jsx("img",{className:"artist-header-image",src:$.image,alt:($==null?void 0:$.name)||"Artist"}):p.jsx("div",{className:"artist-header-image-placeholder",children:p.jsx(Ye,{size:80})})}),p.jsxs("div",{className:"artist-header-info",children:[p.jsxs("div",{className:"artist-header-meta",children:[(S==null?void 0:S.verified)&&p.jsxs("span",{className:"artist-verified-pill",children:[p.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"currentColor",children:p.jsx("path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10 10-4.5 10-10S17.5 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"})}),"Verified"]}),p.jsx("span",{className:"artist-type-label",children:"Artist"})]}),p.jsx("h1",{className:"artist-name-magazine",children:($==null?void 0:$.name)||"Unknown Artist"}),(S==null?void 0:S.genres)&&S.genres.length>0&&p.jsx("div",{className:"artist-genres-magazine",children:S.genres.slice(0,3).map(Q=>p.jsx("span",{className:"artist-genre-tag",children:Q},Q))}),(S==null?void 0:S.bio)&&p.jsx("p",{className:"artist-bio-excerpt",children:S.bio.length>150?`${S.bio.substring(0,150)}...`:S.bio}),p.jsxs("div",{className:"artist-stats-row",children:[(S==null?void 0:S.followers)&&S.followers>0&&p.jsxs("div",{className:"artist-stat",children:[p.jsx("span",{className:"artist-stat-value",children:V(S.followers).replace(" followers","")}),p.jsx("span",{className:"artist-stat-label",children:"Followers"})]}),(S==null?void 0:S.topTracks)&&S.topTracks.length>0&&p.jsxs("div",{className:"artist-stat",children:[p.jsx("span",{className:"artist-stat-value",children:S.topTracks.length}),p.jsx("span",{className:"artist-stat-label",children:"Top Tracks"})]}),X>0&&p.jsxs("div",{className:"artist-stat",children:[p.jsx("span",{className:"artist-stat-value",children:X}),p.jsx("span",{className:"artist-stat-label",children:"Albums"})]}),ee>0&&p.jsxs("div",{className:"artist-stat",children:[p.jsx("span",{className:"artist-stat-value",children:ee}),p.jsx("span",{className:"artist-stat-label",children:"Singles"})]})]}),p.jsxs("div",{className:"artist-actions-magazine",children:[p.jsxs("button",{className:"artist-play-btn-magazine",onClick:M,disabled:!((Y=S==null?void 0:S.topTracks)!=null&&Y.length),"aria-label":"Play all tracks",children:[p.jsx(At,{size:18}),p.jsx("span",{children:"Play"})]}),p.jsxs("button",{className:"artist-shuffle-btn-magazine",onClick:A,disabled:!((oe=S==null?void 0:S.topTracks)!=null&&oe.length),"aria-label":"Shuffle play",children:[p.jsx(Dl,{size:16}),p.jsx("span",{children:"Shuffle"})]})]})]})]})]}),p.jsxs("div",{className:"artist-content-spotify",children:[(S==null?void 0:S.latestRelease)&&p.jsxs("section",{className:"artist-section-latest-release",children:[p.jsx("h2",{className:"section-title-spotify",children:"Latest Release"}),p.jsxs("div",{className:"latest-release-card",onClick:()=>D(S.latestRelease),onContextMenu:Q=>g(Q,S.latestRelease),role:"button",tabIndex:0,onKeyDown:Q=>Q.key==="Enter"&&D(S.latestRelease),children:[p.jsxs("div",{className:"latest-release-artwork",children:[S.latestRelease.artwork?p.jsx("img",{src:S.latestRelease.artwork,alt:S.latestRelease.title}):p.jsx("div",{className:"latest-release-artwork-placeholder",children:p.jsx(Ye,{size:48})}),p.jsx("span",{className:"latest-release-badge",children:"NEW"}),p.jsx("div",{className:"latest-release-play",children:p.jsx(At,{size:28})})]}),p.jsxs("div",{className:"latest-release-info",children:[p.jsx("span",{className:"latest-release-title",children:S.latestRelease.title}),p.jsxs("span",{className:"latest-release-meta",children:[S.latestRelease.year,S.latestRelease.trackCount&&`  ${S.latestRelease.trackCount} songs`]})]})]})]}),p.jsxs("section",{className:"artist-section-popular",children:[p.jsx("h2",{className:"section-title-spotify",children:"Popular"}),p.jsx("div",{className:"popular-tracks-list",children:R?p.jsx("div",{className:"popular-tracks-loading",children:Array.from({length:5}).map((Q,ce)=>p.jsx("div",{className:"track-row-skeleton skeleton"},ce))}):f?p.jsx("p",{className:"section-error",children:f}):S!=null&&S.topTracks&&S.topTracks.length>0?S.topTracks.slice(0,5).map((Q,ce)=>{var me;return p.jsxs("div",{className:`track-row-clean ${(a==null?void 0:a.id)===Q.id?"playing":""}`,onClick:()=>P(Q,ce),onContextMenu:ge=>m(ge,Q),role:"button",tabIndex:0,onKeyDown:ge=>ge.key==="Enter"&&P(Q,ce),children:[p.jsxs("div",{className:"track-number-cell",children:[p.jsx("span",{className:"track-number",children:ce+1}),p.jsx("span",{className:"track-play-icon",children:p.jsx(At,{size:16})})]}),p.jsx("div",{className:"track-artwork-cell",children:(me=Q.artwork)!=null&&me.small?p.jsx("img",{src:Q.artwork.small,alt:Q.title}):p.jsx("div",{className:"track-artwork-placeholder",children:p.jsx(Ye,{size:16})})}),p.jsxs("div",{className:"track-info-cell",children:[p.jsx("span",{className:"track-title-clean",children:Q.title}),Q.album&&p.jsx("span",{className:"track-album-clean",children:Q.album.title})]}),Q.explicit&&p.jsx("span",{className:"explicit-badge-small",children:"E"}),p.jsx("span",{className:"track-duration-cell",children:j(Q.duration)})]},Q.id)}):p.jsx("p",{className:"section-placeholder",children:"No tracks available"})})]}),z&&p.jsxs("section",{className:"artist-section-discography",children:[p.jsx("h2",{className:"section-title-spotify",children:"Discography"}),p.jsxs("div",{className:"discography-tabs-pills",role:"tablist",children:[X>0&&p.jsx(E0,{label:"Albums",isActive:b==="albums",onClick:()=>k("albums"),count:X}),ee>0&&p.jsx(E0,{label:"Singles",isActive:b==="singles",onClick:()=>k("singles"),count:ee}),G>0&&p.jsx(E0,{label:"EPs",isActive:b==="eps",onClick:()=>k("eps"),count:G})]}),p.jsx("div",{className:"discography-scroll-container",ref:v,children:R?p.jsx("div",{className:"discography-scroll-loading",children:Array.from({length:6}).map((Q,ce)=>p.jsx("div",{className:"album-card-skeleton skeleton"},ce))}):U.length>0?p.jsx("div",{className:"discography-scroll",children:U.map(Q=>p.jsx(PS,{album:Q,onClick:()=>D(Q),onContextMenu:ce=>g(ce,Q)},Q.id))}):p.jsxs("p",{className:"section-placeholder",children:["No ",b," found"]})})]}),(S==null?void 0:S.appearsOn)&&S.appearsOn.length>0&&p.jsxs("section",{className:"artist-section-appears-on",children:[p.jsx("h2",{className:"section-title-spotify",children:"Appears On"}),p.jsx("div",{className:"discography-scroll-container",children:p.jsx("div",{className:"discography-scroll",children:S.appearsOn.map(Q=>p.jsx(PS,{album:Q,onClick:()=>D(Q),onContextMenu:ce=>g(ce,Q)},Q.id))})})]}),(S==null?void 0:S.similarArtists)&&S.similarArtists.length>0&&p.jsxs("section",{className:"artist-section-similar",children:[p.jsx("h2",{className:"section-title-spotify",children:"Fans Also Like"}),p.jsx("div",{className:"similar-artists-scroll-container",ref:N,children:p.jsx("div",{className:"similar-artists-scroll",children:S.similarArtists.map(Q=>p.jsx(Nle,{artist:Q,onClick:()=>E(Q)},Q.id))})})]}),(S==null?void 0:S.bio)&&p.jsxs("section",{className:"artist-section-about",children:[p.jsx("h2",{className:"section-title-spotify",children:"About"}),p.jsxs("div",{className:"artist-about-card",children:[($==null?void 0:$.image)&&p.jsx("div",{className:"artist-about-image",children:p.jsx("img",{src:$.image,alt:$.name})}),p.jsxs("div",{className:"artist-about-content",children:[p.jsx("p",{className:"artist-bio-text",children:S.bio}),S.externalUrls&&Object.keys(S.externalUrls).length>0&&p.jsxs("div",{className:"artist-external-links",children:[S.externalUrls.spotify&&p.jsx("a",{href:S.externalUrls.spotify,target:"_blank",rel:"noopener noreferrer",className:"artist-external-link",children:"Spotify"}),S.externalUrls.instagram&&p.jsx("a",{href:S.externalUrls.instagram,target:"_blank",rel:"noopener noreferrer",className:"artist-external-link",children:"Instagram"}),S.externalUrls.twitter&&p.jsx("a",{href:S.externalUrls.twitter,target:"_blank",rel:"noopener noreferrer",className:"artist-external-link",children:"Twitter"}),S.externalUrls.website&&p.jsx("a",{href:S.externalUrls.website,target:"_blank",rel:"noopener noreferrer",className:"artist-external-link",children:"Website"})]})]})]})]})]})]})},$le=Ps((n,e)=>({albumCache:new Map,loadingAlbumId:null,error:null,fetchAlbum:async(t,s)=>{var o,i,a,l,u,d,f,m,g,y,w,b,k;const r=e().albumCache.get(t);if(r&&r.tracks.length>0)return r;n({loadingAlbumId:t,error:null});try{if(!window.api)throw new Error("API not available");if(window.api.getAlbum)try{const D=await window.api.getAlbum(t,s.source);if(D){const E=(D.tracks||[]).map(z=>({...z,streamSources:[],_meta:{metadataProvider:s.source||"addon",matchConfidence:1,externalIds:{},lastUpdated:new Date}})),j=(D.moreByArtist||[]).map(z=>{var H,O,B,Y;return{id:z.id,title:z.title,artist:((O=(H=z.artists)==null?void 0:H[0])==null?void 0:O.name)||s.artist,artwork:((B=z.artwork)==null?void 0:B.medium)||((Y=z.artwork)==null?void 0:Y.small),year:z.releaseDate?parseInt(z.releaseDate.substring(0,4)):void 0,trackCount:z.trackCount,source:s.source}}),V=E.reduce((z,H)=>z+(H.duration||0),0);let W=[];if((o=window.api)!=null&&o.getSimilarAlbums)try{W=(await window.api.getSimilarAlbums(t,s.source)||[]).filter(H=>H.id!==t).slice(0,8).map(H=>{var O,B,Y,oe;return{id:H.id,title:H.title,artist:((B=(O=H.artists)==null?void 0:O[0])==null?void 0:B.name)||"",artwork:((Y=H.artwork)==null?void 0:Y.medium)||((oe=H.artwork)==null?void 0:oe.small),year:H.releaseDate?parseInt(H.releaseDate.substring(0,4)):void 0,trackCount:H.trackCount,source:s.source}})}catch(z){console.warn("Failed to fetch similar albums:",z)}let U;const X=(i=D.artists)==null?void 0:i[0];if(X!=null&&X.id&&((a=window.api)!=null&&a.getArtist))try{const z=await window.api.getArtist(X.id,s.source);z&&(U={id:z.id,name:z.name,image:((l=z.artwork)==null?void 0:l.large)||((u=z.artwork)==null?void 0:u.medium),followers:z.followers,verified:z.verified,genres:z.genres,bio:z.bio})}catch(z){console.warn("Failed to fetch artist info:",z)}const ee={id:t,title:D.title||s.title,artist:((f=(d=D.artists)==null?void 0:d[0])==null?void 0:f.name)||s.artist,artistId:(g=(m=D.artists)==null?void 0:m[0])==null?void 0:g.id,artwork:((y=D.artwork)==null?void 0:y.large)||((w=D.artwork)==null?void 0:w.medium)||s.artwork,year:D.releaseDate?parseInt(D.releaseDate.substring(0,4)):s.year,releaseDate:D.releaseDate,trackCount:E.length||D.trackCount||s.trackCount,albumType:D.albumType,label:D.label,copyright:D.copyright,credits:D.credits,explicit:D.explicit,genres:D.genres,totalDuration:D.totalDuration||V,description:D.description,source:s.source,tracks:E,moreByArtist:j,similarAlbums:W,artistInfo:U},G=new Map(e().albumCache);return G.set(t,ee),n({albumCache:G,loadingAlbumId:null}),ee}}catch(D){console.warn("getAlbum API failed, falling back to search:",D)}const v=`${s.title} ${s.artist}`,N=await window.api.search({query:v,type:"track"}),S=(N||[]).filter(D=>D.album?D.album.id===t||D.album.title.toLowerCase()===s.title.toLowerCase():!1);S.sort((D,E)=>{const j=D.trackNumber||999,V=E.trackNumber||999;return j-V});const R=(await window.api.search({query:s.artist,type:"album"}).catch(()=>[])||[]).filter(D=>{var j,V;if(D.id===t)return!1;const E=(V=(j=D.artists)==null?void 0:j[0])==null?void 0:V.name;return E&&E.toLowerCase()===s.artist.toLowerCase()}).slice(0,8).map(D=>{var E,j,V;return{id:D.id,title:D.title,artist:((j=(E=D.artists)==null?void 0:E[0])==null?void 0:j.name)||s.artist,artwork:(V=D.artwork)==null?void 0:V.medium,year:D.releaseDate?parseInt(D.releaseDate.substring(0,4)):void 0,trackCount:D.trackCount,source:"addon"}});if(R.length<4){const D=new Map;for(const j of N||[])j.album&&j.album.id!==t&&j.artists.some(W=>W.name.toLowerCase()===s.artist.toLowerCase())&&!D.has(j.album.id)&&D.set(j.album.id,{id:j.album.id,title:j.album.title,artist:s.artist,artwork:(b=j.album.artwork)==null?void 0:b.medium,year:j.album.releaseDate?parseInt(j.album.releaseDate.substring(0,4)):void 0,trackCount:j.album.trackCount,source:((k=j._meta)==null?void 0:k.metadataProvider)||"unknown"});const E=new Set(R.map(j=>j.id));for(const j of D.values())!E.has(j.id)&&R.length<8&&R.push(j)}const M=S.reduce((D,E)=>D+(E.duration||0),0),A={id:t,title:s.title,artist:s.artist,artwork:s.artwork,year:s.year,releaseDate:void 0,trackCount:S.length||s.trackCount,albumType:void 0,label:void 0,copyright:void 0,credits:void 0,explicit:void 0,genres:void 0,totalDuration:M,description:void 0,source:s.source,tracks:S,moreByArtist:R,similarAlbums:[],artistInfo:void 0},P=new Map(e().albumCache);return P.set(t,A),n({albumCache:P,loadingAlbumId:null}),A}catch(v){return n({error:v instanceof Error?v.message:"Failed to fetch album",loadingAlbumId:null}),null}},getAlbum:t=>e().albumCache.get(t)||null,clearCache:()=>{n({albumCache:new Map})}})),Tle=({credits:n,albumTitle:e,onClose:t})=>{const s=o=>{o.target===o.currentTarget&&t()};Xt.useEffect(()=>{const o=i=>{i.key==="Escape"&&t()};return document.addEventListener("keydown",o),()=>document.removeEventListener("keydown",o)},[t]);const r=[];return n.producers&&n.producers.length>0&&r.push({role:"Producers",names:n.producers}),n.writers&&n.writers.length>0&&r.push({role:"Writers",names:n.writers}),n.engineers&&n.engineers.length>0&&r.push({role:"Engineers",names:n.engineers}),n.label&&r.push({role:"Label",names:[n.label]}),n.copyright&&r.push({role:"Copyright",names:[n.copyright]}),p.jsx("div",{className:"modal-overlay",onClick:s,children:p.jsxs("div",{className:"modal credits-modal",children:[p.jsxs("div",{className:"modal-header",children:[p.jsx("h2",{children:"Credits"}),p.jsx("p",{className:"modal-subtitle",children:e}),p.jsx("button",{className:"modal-close",onClick:t,"aria-label":"Close",children:p.jsx(ar,{size:20})})]}),p.jsxs("div",{className:"modal-content",children:[r.map(({role:o,names:i})=>p.jsxs("div",{className:"credit-group",children:[p.jsx("h3",{className:"credit-role",children:o}),p.jsx("ul",{className:"credit-names",children:i.map((a,l)=>p.jsx("li",{className:"credit-name",children:a},`${o}-${l}`))})]},o)),r.length===0&&p.jsx("p",{className:"credits-empty",children:"No credits available"})]}),p.jsx("div",{className:"modal-footer",children:p.jsx("button",{className:"modal-button secondary",onClick:t,children:"Close"})})]})})};function Ele(n){return!!(n.producers&&n.producers.length>0||n.writers&&n.writers.length>0||n.engineers&&n.engineers.length>0||n.label||n.copyright)}const Rle=()=>{var X,ee,G;const{selectedAlbumId:n,selectedAlbumData:e,goBack:t,openArtist:s,openAlbum:r}=on(),{play:o,setQueue:i,currentTrack:a}=yt(),{fetchAlbum:l,getAlbum:u,loadingAlbumId:d,error:f}=$le(),{showContextMenu:m}=Pn(),{showContextMenu:g}=Gd(),[y,w]=L.useState(qi()),[b,k]=L.useState(!1),v=u(n||""),N=v||e,S=d===n;if(L.useEffect(()=>{N!=null&&N.artwork&&vD(N.artwork).then(w)},[N==null?void 0:N.artwork]),L.useEffect(()=>{n&&e&&l(n,e)},[n,e==null?void 0:e.title]),!n)return p.jsx("div",{className:"album-detail-view",children:p.jsxs("div",{className:"album-not-found",children:[p.jsx("p",{children:"Album not found"}),p.jsx("button",{onClick:t,children:"Go Back"})]})});const $=()=>{if(v!=null&&v.tracks&&v.tracks.length>0){const z=v.tracks[0];i(v.tracks,0),z&&o(z)}},R=()=>{if(v!=null&&v.tracks&&v.tracks.length>0){const z=[...v.tracks].sort(()=>Math.random()-.5),H=z[0];i(z,0),H&&o(H)}},M=(z,H)=>{v!=null&&v.tracks&&(i(v.tracks,H),o(z))},A=()=>{N!=null&&N.artist&&s(`artist-${N.artist}`,{id:`artist-${N.artist}`,name:N.artist,image:N.artwork,source:N.source||"unknown"})},P=z=>{r(z.id,z)},D=z=>{if(!z)return"--:--";const H=Math.floor(z/60),O=Math.floor(z%60);return`${H}:${O.toString().padStart(2,"0")}`},E=z=>{if(!z)return"";try{return new Date(z).getFullYear().toString()}catch{return z.substring(0,4)}},j=z=>{if(!z)return"";try{return new Date(z).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}catch{return z.substring(0,4)}},V=z=>{switch(z){case"album":return"ALBUM";case"single":return"SINGLE";case"ep":return"EP";case"compilation":return"COMPILATION";default:return"ALBUM"}},W=v!=null&&v.releaseDate?E(v.releaseDate):N==null?void 0:N.year,U=(v==null?void 0:v.trackCount)||((X=v==null?void 0:v.tracks)==null?void 0:X.length);return p.jsxs("div",{className:"album-detail-view album-detail-centered",style:{"--ambient-color":y.dominant},children:[(N==null?void 0:N.artwork)&&p.jsx("div",{className:"album-ambient-bg-centered",style:{backgroundImage:`url(${N.artwork})`}}),p.jsx("button",{className:"back-btn-round album-back-btn",onClick:t,"aria-label":"Go back",children:p.jsx(ky,{size:20})}),p.jsxs("div",{className:"album-hero-centered",children:[p.jsxs("div",{className:"album-artwork-centered",children:[N!=null&&N.artwork?p.jsx("img",{className:"album-artwork-img-centered",src:N.artwork,alt:N.title}):p.jsx("div",{className:"album-artwork-placeholder-centered",children:p.jsx(Ye,{size:80})}),p.jsx("div",{className:"album-artwork-glow",style:{background:`radial-gradient(ellipse at center, ${y.dominant}40 0%, transparent 70%)`}})]}),p.jsxs("div",{className:"album-info-centered",children:[p.jsx("span",{className:"album-type-badge-centered",children:V(v==null?void 0:v.albumType)}),p.jsx("h1",{className:"album-title-centered",children:(N==null?void 0:N.title)||"Unknown Album"}),p.jsxs("div",{className:"album-meta-centered",children:[p.jsx("span",{className:"album-artist-link-centered",onClick:A,children:(N==null?void 0:N.artist)||"Unknown Artist"}),W&&p.jsxs(p.Fragment,{children:[p.jsx("span",{className:"album-meta-dot",children:""}),p.jsx("span",{children:W})]}),U&&p.jsxs(p.Fragment,{children:[p.jsx("span",{className:"album-meta-dot",children:""}),p.jsxs("span",{children:[U," ",U===1?"song":"songs"]})]})]}),p.jsxs("div",{className:"album-actions-centered",children:[p.jsxs("button",{className:"album-play-btn-pill",onClick:$,disabled:!((ee=v==null?void 0:v.tracks)!=null&&ee.length),children:[p.jsx(At,{size:20}),p.jsx("span",{children:"Play"})]}),p.jsxs("button",{className:"album-shuffle-btn-pill",onClick:R,disabled:!((G=v==null?void 0:v.tracks)!=null&&G.length),children:[p.jsx(Dl,{size:18}),p.jsx("span",{children:"Shuffle"})]}),p.jsx("button",{className:"album-more-btn-pill",onClick:z=>N&&g(z,N),children:p.jsx(_4,{size:20})})]})]})]}),p.jsxs("section",{className:"album-tracks-clean",children:[p.jsxs("div",{className:"album-tracks-header-clean",children:[p.jsx("span",{className:"track-col-num",children:"#"}),p.jsx("span",{className:"track-col-title",children:"Title"}),p.jsx("span",{className:"track-col-dur",children:"Duration"})]}),S?p.jsxs("div",{className:"album-loading",children:[p.jsx("div",{className:"album-loading-spinner"}),p.jsx("span",{children:"Loading tracks..."})]}):f?p.jsx("div",{className:"album-section-placeholder",children:f}):v!=null&&v.tracks&&v.tracks.length>0?p.jsx("div",{className:"album-tracks-list-clean",children:v.tracks.map((z,H)=>{const O=(a==null?void 0:a.id)===z.id;return p.jsxs("div",{className:`album-track-row-clean ${O?"playing":""}`,onClick:()=>M(z,H),onContextMenu:B=>m(B,z),children:[O&&p.jsx("div",{className:"track-playing-bar"}),p.jsx("span",{className:"album-track-num-clean",children:O?p.jsxs("span",{className:"track-playing-indicator",children:[p.jsx("span",{className:"bar"}),p.jsx("span",{className:"bar"}),p.jsx("span",{className:"bar"})]}):z.trackNumber||H+1}),p.jsxs("div",{className:"album-track-info-clean",children:[p.jsx("span",{className:"album-track-title-clean",children:z.title}),(z.artists.length>1||z.explicit)&&p.jsxs("div",{className:"album-track-subtitle-clean",children:[z.explicit&&p.jsx("span",{className:"explicit-badge-small",children:"E"}),z.artists.length>1&&p.jsx("span",{className:"album-track-artists-clean",children:z.artists.map(B=>B.name).join(", ")})]})]}),p.jsx("span",{className:"album-track-dur-clean",children:D(z.duration)})]},z.id)})}):p.jsx("div",{className:"album-section-placeholder",children:"No tracks found for this album"})]}),(v==null?void 0:v.artistInfo)&&p.jsxs("section",{className:"album-artist-section",children:[p.jsx("h2",{className:"album-section-title",children:"About the Artist"}),p.jsxs("div",{className:"album-artist-card",onClick:()=>s(v.artistInfo.id,{id:v.artistInfo.id,name:v.artistInfo.name,image:v.artistInfo.image,source:(N==null?void 0:N.source)||"addon"}),children:[p.jsx("div",{className:"album-artist-card-image",children:v.artistInfo.image?p.jsx("img",{src:v.artistInfo.image,alt:v.artistInfo.name}):p.jsx("div",{className:"album-artist-card-placeholder",children:p.jsx(Ye,{size:48})})}),p.jsxs("div",{className:"album-artist-card-info",children:[p.jsx("h3",{className:"album-artist-card-name",children:v.artistInfo.name}),v.artistInfo.followers&&p.jsxs("span",{className:"album-artist-card-followers",children:[v.artistInfo.followers.toLocaleString()," followers"]}),v.artistInfo.genres&&v.artistInfo.genres.length>0&&p.jsx("span",{className:"album-artist-card-genres",children:v.artistInfo.genres.slice(0,3).join("  ")}),v.artistInfo.bio&&p.jsx("p",{className:"album-artist-card-bio",children:v.artistInfo.bio.length>200?`${v.artistInfo.bio.substring(0,200)}...`:v.artistInfo.bio}),p.jsx("button",{className:"album-artist-card-btn",children:"View Artist"})]})]})]}),(v==null?void 0:v.moreByArtist)&&v.moreByArtist.length>0&&p.jsxs("section",{className:"album-more-section-clean",children:[p.jsxs("h2",{className:"album-more-title",children:["More by ",(N==null?void 0:N.artist)||"Artist"]}),p.jsx("div",{className:"album-more-scroll-clean",children:v.moreByArtist.map(z=>p.jsxs("div",{className:"album-card-clean",onClick:()=>P(z),onContextMenu:H=>g(H,z),children:[p.jsxs("div",{className:"album-card-image-clean",children:[z.artwork?p.jsx("img",{src:z.artwork,alt:z.title,loading:"lazy"}):p.jsx("div",{className:"album-card-placeholder-clean",children:p.jsx(Ye,{size:32})}),p.jsx("div",{className:"album-card-play-clean",children:p.jsx(At,{size:24})})]}),p.jsxs("div",{className:"album-card-info-clean",children:[p.jsx("span",{className:"album-card-title-clean",children:z.title}),z.year&&p.jsx("span",{className:"album-card-year-clean",children:z.year})]})]},z.id))})]}),(v==null?void 0:v.similarAlbums)&&v.similarAlbums.length>0&&p.jsxs("section",{className:"album-more-section-clean album-similar-section",children:[p.jsx("h2",{className:"album-more-title",children:"You Might Also Like"}),p.jsx("div",{className:"album-more-scroll-clean",children:v.similarAlbums.map(z=>p.jsxs("div",{className:"album-card-clean",onClick:()=>P(z),onContextMenu:H=>g(H,z),children:[p.jsxs("div",{className:"album-card-image-clean",children:[z.artwork?p.jsx("img",{src:z.artwork,alt:z.title,loading:"lazy"}):p.jsx("div",{className:"album-card-placeholder-clean",children:p.jsx(Ye,{size:32})}),p.jsx("div",{className:"album-card-play-clean",children:p.jsx(At,{size:24})})]}),p.jsxs("div",{className:"album-card-info-clean",children:[p.jsx("span",{className:"album-card-title-clean",children:z.title}),p.jsx("span",{className:"album-card-artist-clean",children:z.artist})]})]},z.id))})]}),p.jsxs("footer",{className:"album-footer-clean",children:[p.jsx("div",{className:"album-footer-divider"}),p.jsxs("div",{className:"album-footer-content",children:[(v==null?void 0:v.releaseDate)&&p.jsx("p",{className:"album-footer-text",children:j(v.releaseDate)}),(v==null?void 0:v.label)&&p.jsx("p",{className:"album-footer-text",children:v.label}),(v==null?void 0:v.copyright)&&p.jsx("p",{className:"album-footer-text album-footer-copyright",children:v.copyright}),(v==null?void 0:v.credits)&&Ele(v.credits)&&p.jsx("button",{className:"album-credits-link",onClick:()=>k(!0),children:"Show Credits"})]})]}),b&&(v==null?void 0:v.credits)&&p.jsx(Tle,{credits:v.credits,albumTitle:(N==null?void 0:N.title)||"",onClose:()=>k(!1)})]})},lg=Ps((n,e)=>({playerMode:"mini",isQueueOpen:!1,isLyricsVisible:!1,isLyricsPanelOpen:!1,queueAnchorRect:null,expandPlayer:()=>{n({playerMode:"full",isQueueOpen:!1,isLyricsPanelOpen:!1})},collapsePlayer:()=>{n({playerMode:"mini"})},togglePlayer:()=>{const{playerMode:t}=e();n(t==="mini"?{playerMode:"full",isQueueOpen:!1,isLyricsPanelOpen:!1}:{playerMode:"mini"})},openQueue:t=>{n({isQueueOpen:!0,queueAnchorRect:t,isLyricsPanelOpen:!1})},closeQueue:()=>{n({isQueueOpen:!1,queueAnchorRect:null})},toggleQueue:t=>{const{isQueueOpen:s}=e();s?n({isQueueOpen:!1,queueAnchorRect:null}):t&&n({isQueueOpen:!0,queueAnchorRect:t,isLyricsPanelOpen:!1})},toggleLyrics:()=>{n(t=>({isLyricsVisible:!t.isLyricsVisible}))},setLyricsVisible:t=>{n({isLyricsVisible:t})},toggleLyricsPanel:()=>{const{isLyricsPanelOpen:t}=e();n({isLyricsPanelOpen:!t,isQueueOpen:!1})},openLyricsPanel:()=>{n({isLyricsPanelOpen:!0,isQueueOpen:!1})},closeLyricsPanel:()=>{n({isLyricsPanelOpen:!1})}})),Ale=({id:n,track:e,index:t,onPlay:s,onRemove:r,onContextMenu:o})=>{const{attributes:i,listeners:a,setNodeRef:l,transform:u,transition:d,isDragging:f}=mD({id:n}),m={transform:Al.Transform.toString(u),transition:d,opacity:f?.5:1,zIndex:f?1e3:"auto"};return p.jsxs("div",{ref:l,style:m,className:`queue-popover-item ${f?"dragging":""}`,children:[p.jsx("button",{className:"queue-popover-item-drag",...i,...a,title:"Drag to reorder",children:p.jsx(KS,{size:14})}),p.jsx(tg,{track:e,index:t+1,isPlaying:!1,onClick:s,onContextMenu:o,compact:!0}),p.jsx("button",{className:"queue-popover-item-remove",onClick:r,title:"Remove from queue",children:p.jsx(ar,{size:14})})]})},Dle=()=>{var H,O,B;const n=L.useRef(null),e=L.useRef(null),[t,s]=L.useState(15),{currentTrack:r,queue:o,queueIndex:i,play:a,setQueue:l,reorderQueue:u}=yt(),{recordReorder:d}=On(),{isQueueOpen:f,queueAnchorRect:m,closeQueue:g}=lg(),{showContextMenu:y}=Pn(),{rankTracks:w,isMLReady:b}=Yl(),{isRadioMode:k,seed:v}=jA(),{isEnabled:N,isFetching:S}=wre(),{stopRadio:$,toggleAutoQueue:R}=Ud(),M=k||N,[A,P]=L.useState(!1),D=o.slice(i+1),E=L.useCallback(async()=>{if(!(D.length<2||A)){P(!0);try{const Y=await w(D,{enabled:!0,explorationMode:"balanced",shuffle:!0,shuffleIntensity:.15}),oe=o.slice(0,i+1),Q=Y.map(me=>me.track),ce=[...oe,...Q];l(ce,i),console.log("[QueuePopover] Re-ranked queue using ML preferences")}catch(Y){console.error("[QueuePopover] Re-ranking failed:",Y)}finally{P(!1)}}},[D,o,i,w,l,A]),j=GA(xp(og,{activationConstraint:{distance:8}}),xp(rg,{coordinateGetter:gD})),V=L.useCallback(Y=>{const{active:oe,over:Q}=Y;if(Q&&oe.id!==Q.id){const ce=D.slice(0,t),me=ce.findIndex(ve=>`queue-${ve.id}`===oe.id),ge=ce.findIndex(ve=>`queue-${ve.id}`===Q.id);if(me!==-1&&ge!==-1){const ve=ce[me];u(me,ge),ve&&d(ve,me,ge)}}},[D,t,u,d]);L.useEffect(()=>{if(!f)return;const Y=Q=>{n.current&&!n.current.contains(Q.target)&&g()},oe=Q=>{Q.key==="Escape"&&g()};return setTimeout(()=>{document.addEventListener("mousedown",Y),document.addEventListener("keydown",oe)},0),()=>{document.removeEventListener("mousedown",Y),document.removeEventListener("keydown",oe)}},[f,g]);const W=L.useCallback(()=>{const Y=e.current;if(!Y)return;Y.scrollHeight-Y.scrollTop-Y.clientHeight<100&&t<D.length&&s(Q=>Math.min(Q+10,D.length))},[t,D.length]);if(L.useEffect(()=>{f||s(15)},[f]),!f||!m)return null;const U=(Y,oe)=>{Y.stopPropagation();const Q=i+1+oe,ce=[...o];ce.splice(Q,1),l(ce,i)},X=Y=>{const oe=i+1+Y,Q=o[oe];Q&&a(Q)},ee=()=>{const Y=o.slice(0,i+1);l(Y,i)},G={position:"fixed",bottom:`calc(100vh - ${m.top}px + 8px)`,right:`calc(100vw - ${m.right}px)`},z=((H=r==null?void 0:r.artwork)==null?void 0:H.medium)??((B=(O=r==null?void 0:r.album)==null?void 0:O.artwork)==null?void 0:B.medium);return p.jsxs("div",{className:"queue-popover",ref:n,style:G,children:[p.jsxs("header",{className:"queue-popover-header",children:[p.jsxs("div",{className:"queue-popover-title",children:[p.jsx(Mf,{size:20}),p.jsx("h3",{children:"Queue"})]}),p.jsxs("div",{className:"queue-popover-actions",children:[p.jsx("button",{className:`queue-smart-toggle ${M?"active":""}`,onClick:k?$:R,title:k?`Radio: ${(v==null?void 0:v.name)||"Active"} (click to stop)`:M?"Disable Smart Queue":"Enable Smart Queue",children:k?p.jsx(A0,{size:18}):p.jsx(nM,{size:18})}),p.jsx("button",{className:"queue-popover-close",onClick:g,children:p.jsx(ar,{size:18})})]})]}),p.jsxs("div",{className:"queue-popover-content",ref:e,onScroll:W,children:[k&&v&&p.jsx("div",{className:"queue-radio-banner",children:p.jsxs("div",{className:"queue-radio-info",children:[p.jsx("span",{className:"queue-radio-label",children:"Playing from"}),p.jsx("span",{className:"queue-radio-seed",children:v.name})]})}),!k&&N&&p.jsx("div",{className:"queue-auto-banner",children:p.jsx("span",{className:"queue-auto-label",children:"Automatically adding tracks when queue runs low"})}),r&&p.jsxs("section",{className:"queue-popover-section",children:[p.jsx("h4",{className:"queue-popover-section-title",children:"Now Playing"}),p.jsxs("div",{className:"queue-popover-now-playing",children:[p.jsxs("div",{className:"queue-popover-artwork",children:[z?p.jsx("img",{src:z,alt:r.title}):p.jsx("div",{className:"queue-popover-artwork-placeholder",children:p.jsx(Ye,{size:20})}),p.jsxs("span",{className:"queue-popover-playing-indicator",children:[p.jsx("span",{}),p.jsx("span",{}),p.jsx("span",{})]})]}),p.jsxs("div",{className:"queue-popover-track-info",children:[p.jsx("div",{className:"queue-popover-track-title",children:r.title}),p.jsx("div",{className:"queue-popover-track-artist",children:r.artists.map(Y=>Y.name).join(", ")})]})]})]}),p.jsxs("section",{className:"queue-popover-section",children:[p.jsxs("div",{className:"queue-popover-section-header",children:[p.jsx("h4",{className:"queue-popover-section-title",children:"Up Next"}),p.jsxs("div",{className:"queue-popover-section-actions",children:[D.length>=2&&p.jsxs("button",{className:`queue-popover-rerank ${A?"loading":""}`,onClick:E,disabled:A,title:b?"Re-order based on your preferences":"Learning your preferences...",children:[A?p.jsx(d2,{size:14}):p.jsx(Dl,{size:14}),p.jsx("span",{children:"Optimize"})]}),D.length>0&&p.jsx("button",{className:"queue-popover-clear",onClick:ee,children:"Clear"})]})]}),D.length===0?p.jsx("div",{className:"queue-popover-empty",children:p.jsx("p",{children:"No tracks in queue"})}):p.jsx(lD,{sensors:j,collisionDetection:XA,onDragEnd:V,children:p.jsx(fD,{items:D.slice(0,t).map(Y=>`queue-${Y.id}`),strategy:uD,children:p.jsxs("div",{className:"queue-popover-list",children:[D.slice(0,t).map((Y,oe)=>p.jsx(Ale,{id:`queue-${Y.id}`,track:Y,index:oe,onPlay:()=>X(oe),onRemove:Q=>U(Q,oe),onContextMenu:y},`queue-${Y.id}`)),D.length>t&&p.jsxs("div",{className:"queue-popover-more",children:["Scroll for ",D.length-t," more tracks"]})]})})}),S&&p.jsxs("div",{className:"queue-loading",children:[p.jsx(d2,{size:16}),p.jsx("span",{children:"Finding more music..."})]})]})]})]})},bD=({track:n,onClose:e})=>{var d,f,m;const[t,s]=L.useState([]),{recordDislike:r}=On(),o=g=>{s(y=>y.includes(g)?y.filter(w=>w!==g):[...y,g])},i=()=>{t.length>0&&(r(n,t),e())},a=()=>{r(n,["not_my_taste"]),e()},l=((d=n.artwork)==null?void 0:d.medium)??((m=(f=n.album)==null?void 0:f.artwork)==null?void 0:m.medium),u=n.artists.map(g=>g.name).join(", ");return p.jsx("div",{className:"modal-overlay",onClick:e,children:p.jsxs("div",{className:"dislike-modal",onClick:g=>g.stopPropagation(),children:[p.jsxs("header",{className:"dislike-modal-header",children:[p.jsx("h2",{children:"Not for you?"}),p.jsx("button",{className:"dislike-modal-close",onClick:e,children:p.jsx(ar,{size:20})})]}),p.jsxs("div",{className:"dislike-modal-track",children:[l?p.jsx("img",{className:"dislike-modal-artwork",src:l,alt:""}):p.jsx("div",{className:"dislike-modal-artwork dislike-modal-artwork-placeholder",children:p.jsx(Ye,{size:24})}),p.jsxs("div",{className:"dislike-modal-track-info",children:[p.jsx("span",{className:"dislike-modal-title",children:n.title}),p.jsx("span",{className:"dislike-modal-artist",children:u})]})]}),p.jsxs("div",{className:"dislike-modal-content",children:[p.jsx("p",{className:"dislike-modal-prompt",children:"Help us understand why so we can improve your recommendations:"}),p.jsx("div",{className:"dislike-reasons-grid",children:rM.map(({value:g,label:y})=>p.jsx("button",{className:`dislike-reason-button ${t.includes(g)?"selected":""}`,onClick:()=>o(g),children:y},g))})]}),p.jsxs("footer",{className:"dislike-modal-footer",children:[p.jsx("button",{className:"dislike-modal-skip",onClick:a,children:"Just hide it"}),p.jsx("button",{className:"dislike-modal-submit",onClick:i,disabled:t.length===0,children:"Submit Feedback"})]})]})})},Mle=()=>{var ln,Fn,Gn,qt;const n=L.useRef(null),e=L.useRef(null),{currentTrack:t,isPlaying:s,position:r,duration:o,volume:i,isMuted:a,isLoading:l,shuffle:u,repeat:d,pause:f,resume:m,seek:g,next:y,previous:w,setVolume:b,toggleMute:k,setPosition:v,setIsPlaying:N,toggleShuffle:S,cycleRepeat:$}=yt(),{isQueueOpen:R,toggleQueue:M,expandPlayer:A,isLyricsPanelOpen:P,toggleLyricsPanel:D}=lg(),{recordListen:E}=On(),{openAlbum:j,openArtist:V}=on(),W=L.useRef(0),U=L.useRef(null),X=L.useCallback(async Le=>{if(e.current)try{await e.current}catch{}e.current=Le.play();try{await e.current}catch(et){et.name!=="AbortError"&&console.error("Audio playback error:",et)}e.current=null},[]),ee=L.useCallback(async Le=>{if(e.current){try{await e.current}catch{}e.current=null}Le.pause()},[]);L.useEffect(()=>{const Le=n.current;Le&&(s&&(t!=null&&t.streamInfo)?X(Le):ee(Le))},[s,t==null?void 0:t.streamInfo,X,ee]),L.useEffect(()=>{const Le=n.current;Le&&(Le.volume=a?0:i)},[i,a]),L.useEffect(()=>{const Le=n.current;!Le||!(t!=null&&t.streamInfo)||Le.src!==t.streamInfo.url&&(Le.src=t.streamInfo.url,s&&X(Le))},[(ln=t==null?void 0:t.streamInfo)==null?void 0:ln.url,X]),L.useEffect(()=>{t&&(U.current&&U.current!==t.id&&(Date.now()-W.current,U.current),W.current=Date.now(),U.current=t.id)},[t==null?void 0:t.id]);const G=L.useCallback(()=>{n.current&&v(n.current.currentTime*1e3)},[v]),z=L.useRef(0);L.useEffect(()=>{const Le=n.current;if(!Le)return;const et=Le.currentTime*1e3;Math.abs(r-et)>500&&Math.abs(r-z.current)>100&&(Le.currentTime=r/1e3,z.current=r)},[r]);const H=L.useCallback(()=>{if(t){const Le=Date.now()-W.current;E(t,Le,!0,!1)}y()},[y,t,E]),O=L.useCallback(()=>{N(!1),console.error("Audio playback error")},[N]),B=L.useRef(null),Y=L.useRef(!1),oe=L.useCallback(Le=>{if(!B.current)return;const et=B.current.getBoundingClientRect(),Nt=Math.max(0,Math.min(1,(Le-et.left)/et.width))*o;g(Nt),n.current&&(n.current.currentTime=Nt/1e3)},[o,g]),Q=L.useCallback(Le=>{Y.current=!0,oe(Le.clientX);const et=Nt=>{Y.current&&oe(Nt.clientX)},vt=()=>{Y.current=!1,document.removeEventListener("mousemove",et),document.removeEventListener("mouseup",vt)};document.addEventListener("mousemove",et),document.addEventListener("mouseup",vt)},[oe]),ce=L.useRef(null),me=L.useRef(!1),ge=L.useCallback(Le=>{if(!ce.current)return;const et=ce.current.getBoundingClientRect(),vt=Math.max(0,Math.min(1,(Le-et.left)/et.width));b(vt)},[b]),ve=L.useCallback(Le=>{me.current=!0,ge(Le.clientX);const et=Nt=>{me.current&&ge(Nt.clientX)},vt=()=>{me.current=!1,document.removeEventListener("mousemove",et),document.removeEventListener("mouseup",vt)};document.addEventListener("mousemove",et),document.addEventListener("mouseup",vt)},[ge]),Ne=Le=>{const et=Math.floor(Le/1e3),vt=Math.floor(et/60),Nt=et%60;return`${vt}:${Nt.toString().padStart(2,"0")}`},Me=o>0?r/o*100:0,{isLiked:Ue,toggleLike:Qe}=gs(),ye=t?Ue(t.id):!1,[Ce,be]=L.useState(!1),xe=L.useCallback(()=>{t&&be(!0)},[t]),Be=L.useCallback(()=>{be(!1),y()},[y]),Dt=L.useCallback(Le=>{var et,vt;Le.stopPropagation(),t!=null&&t.album&&j(t.album.id,{id:t.album.id,title:t.album.title,artist:((et=t.artists[0])==null?void 0:et.name)||"Unknown Artist",artwork:(vt=t.album.artwork)==null?void 0:vt.medium,source:t.source})},[t,j]),at=L.useCallback(Le=>{var vt;Le.stopPropagation();const et=t==null?void 0:t.artists[0];et&&V(et.id,{id:et.id,name:et.name,image:(vt=t==null?void 0:t.artwork)==null?void 0:vt.medium,source:(t==null?void 0:t.source)||"unknown"})},[t,V]),Ht=a||i===0?F4:i<.5?L4:P4;if(!t)return p.jsx("div",{className:"player",children:p.jsxs("div",{className:"player-empty",children:[p.jsx(Ye,{size:20}),p.jsx("span",{children:"Select a track to play"})]})});const Mt=((Fn=t.artwork)==null?void 0:Fn.medium)??((qt=(Gn=t.album)==null?void 0:Gn.artwork)==null?void 0:qt.medium),is=t.artists.map(Le=>Le.name).join(", ");return p.jsxs("div",{className:"player",children:[p.jsx("audio",{ref:n,onTimeUpdate:G,onEnded:H,onError:O}),p.jsxs("div",{className:"player-track",onClick:A,role:"button",tabIndex:0,children:[Mt?p.jsx("img",{className:"player-artwork",src:Mt,alt:t.title}):p.jsx("div",{className:"player-artwork player-artwork-placeholder",children:p.jsx(Ye,{size:24})}),p.jsxs("div",{className:"player-track-info",children:[p.jsx("div",{className:`player-track-title ${t.album?"clickable":""}`,onClick:t.album?Dt:void 0,title:t.album?`Go to ${t.album.title}`:void 0,children:t.title}),p.jsx("div",{className:`player-track-artist ${t.artists.length>0?"clickable":""}`,onClick:t.artists.length>0?at:void 0,title:t.artists.length>0?`Go to ${t.artists[0].name}`:void 0,children:is})]}),p.jsx("button",{className:`player-like-button ${ye?"liked":""}`,onClick:Le=>{Le.stopPropagation(),Qe(t)},title:ye?"Remove from Liked Songs":"Add to Liked Songs",children:ye?p.jsx(Ml,{size:18}):p.jsx(Su,{size:18})}),p.jsx("button",{className:"player-dislike-button",onClick:Le=>{Le.stopPropagation(),xe()},title:"Not for me",children:p.jsx(GS,{size:18})})]}),p.jsxs("div",{className:"player-controls",children:[p.jsxs("div",{className:"player-buttons",children:[p.jsx("button",{className:`player-button small ${u?"active":""}`,onClick:S,title:u?"Disable shuffle":"Enable shuffle",children:p.jsx(Dl,{size:18})}),p.jsx("button",{className:"player-button",onClick:w,title:"Previous",children:p.jsx(_S,{size:20})}),p.jsx("button",{className:"player-button play",onClick:s?f:m,disabled:l,title:s?"Pause":"Play",children:l?p.jsx("span",{className:"player-loading"}):s?p.jsx(bp,{size:24}):p.jsx(At,{size:24})}),p.jsx("button",{className:"player-button",onClick:y,title:"Next",children:p.jsx(OS,{size:20})}),p.jsx("button",{className:`player-button small ${d!=="off"?"active":""}`,onClick:$,title:d==="off"?"Enable repeat":d==="all"?"Repeat one":"Disable repeat",children:d==="one"?p.jsx(BS,{size:18}):p.jsx(zS,{size:18})})]}),p.jsxs("div",{className:"progress-container",children:[p.jsx("span",{className:"progress-time",children:Ne(r)}),p.jsx("div",{className:"progress-bar",ref:B,onMouseDown:Q,children:p.jsx("div",{className:"progress-bar-fill",style:{width:`${Me}%`}})}),p.jsx("span",{className:"progress-time",children:Ne(o)})]})]}),p.jsxs("div",{className:"player-extra",children:[p.jsx("button",{className:`player-button small ${P?"active":""}`,onClick:D,title:"Lyrics",children:p.jsx(WS,{size:18})}),p.jsx("button",{className:`player-button small ${R?"active":""}`,onClick:Le=>M(Le.currentTarget.getBoundingClientRect()),title:"Queue",children:p.jsx(Mf,{size:18})}),p.jsxs("div",{className:"player-volume",children:[p.jsx("button",{className:"player-button small",onClick:k,title:a?"Unmute":"Mute",children:p.jsx(Ht,{size:18})}),p.jsx("div",{className:"volume-slider",ref:ce,onMouseDown:ve,children:p.jsx("div",{className:"volume-slider-fill",style:{width:`${(a?0:i)*100}%`}})})]})]}),Ce&&t&&il.createPortal(p.jsx(bD,{track:t,onClose:Be}),document.body)]})};function Ple(n){var s;const e=[],t=/\[(\d{2}):(\d{2})\.(\d{2,3})\](.*)$/;for(const r of n.split(`
`)){const o=t.exec(r.trim());if(o&&o[1]&&o[2]&&o[3]){const i=parseInt(o[1],10),a=parseInt(o[2],10);let l=parseInt(o[3],10);o[3].length===2&&(l*=10);const u=((s=o[4])==null?void 0:s.trim())??"",d=(i*60+a)*1e3+l;e.push({time:d,text:u})}}return e.sort((r,o)=>r.time-o.time),e}function Fle(n,e){if(n.length===0)return-1;let t=0,s=n.length-1,r=-1;for(;t<=s;){const o=Math.floor((t+s)/2),i=n[o];i&&i.time<=e?(r=o,t=o+1):s=o-1}return r}const vb=Ps((n,e)=>({lyrics:null,plainLyrics:null,currentLineIndex:-1,nextLineIndex:-1,isLoading:!1,error:null,currentTrackId:null,offset:0,fetchLyrics:async(t,s,r)=>{if(!(e().currentTrackId===r&&e().lyrics)){n({isLoading:!0,error:null,lyrics:null,plainLyrics:null,currentTrackId:r});try{const o=new URLSearchParams({artist_name:t,track_name:s}),i=await fetch(`https://lrclib.net/api/get?${o.toString()}`);if(!i.ok){if(i.status===404){n({isLoading:!1,error:"Lyrics not found"});return}throw new Error(`HTTP ${i.status}`)}const a=await i.json();if(a.syncedLyrics){const l=Ple(a.syncedLyrics);n({lyrics:l,plainLyrics:a.plainLyrics||null,isLoading:!1,currentLineIndex:-1})}else a.plainLyrics?n({lyrics:null,plainLyrics:a.plainLyrics,isLoading:!1}):n({isLoading:!1,error:"No lyrics available"})}catch(o){n({isLoading:!1,error:o instanceof Error?o.message:"Failed to fetch lyrics"})}}},updateCurrentLine:t=>{const{lyrics:s,offset:r}=e();if(!s)return;const o=t+r,i=Fle(s,o),{currentLineIndex:a}=e(),l=i<s.length-1?i+1:-1;i!==a&&n({currentLineIndex:i,nextLineIndex:l})},clearLyrics:()=>{n({lyrics:null,plainLyrics:null,currentLineIndex:-1,nextLineIndex:-1,error:null,currentTrackId:null})},seekToLine:t=>{const{lyrics:s,offset:r}=e();if(!s||t<0||t>=s.length)return 0;const o=s[t];return o?Math.max(0,o.time-r):0},setOffset:t=>{n({offset:t})},adjustOffset:t=>{n(s=>({offset:s.offset+t}))},resetOffset:()=>{n({offset:0})}})),Lle=({onSeek:n,compact:e=!1})=>{const t=L.useRef(null),s=L.useRef(null),[r,o]=L.useState(!1),i=L.useRef(),{lyrics:a,plainLyrics:l,currentLineIndex:u,nextLineIndex:d,isLoading:f,error:m,offset:g,seekToLine:y,adjustOffset:w,resetOffset:b}=vb(),k=pa($=>$.plugins.find(R=>R.id==="lrclib-lyrics")),v=(k==null?void 0:k.enabled)??!0,N=L.useCallback(()=>{o(!0),i.current&&clearTimeout(i.current),i.current=setTimeout(()=>{o(!1)},3e3)},[]);L.useEffect(()=>{if(!r&&s.current&&t.current){const $=t.current,R=s.current,M=$.getBoundingClientRect(),A=R.getBoundingClientRect(),D=A.top-M.top+$.scrollTop-M.height*.4+A.height/2;$.scrollTo({top:Math.max(0,D),behavior:"smooth"})}},[u,r]),L.useEffect(()=>()=>{i.current&&clearTimeout(i.current)},[]);const S=L.useCallback($=>{const R=y($);R>=0&&n(R)},[y,n]);return v?f?p.jsxs("div",{className:"lyrics-display lyrics-loading",children:[p.jsx("div",{className:"lyrics-loading-spinner"}),p.jsx("span",{children:"Loading lyrics..."})]}):m?p.jsx("div",{className:"lyrics-display lyrics-error",children:p.jsx("span",{children:m})}):a&&a.length>0?p.jsxs("div",{className:`lyrics-display lyrics-synced ${e?"compact":""}`,children:[!e&&p.jsxs("div",{className:"lyrics-offset-controls",children:[p.jsx("button",{className:"lyrics-offset-btn",onClick:()=>w(-200),title:"Lyrics earlier",children:p.jsx(VS,{size:16})}),p.jsx("span",{className:"lyrics-offset-label",onClick:b,title:"Click to reset",children:g===0?"Synced":`${g>0?"+":""}${g}ms`}),p.jsx("button",{className:"lyrics-offset-btn",onClick:()=>w(200),title:"Lyrics later",children:p.jsx(kp,{size:16})})]}),p.jsx("div",{className:"lyrics-scroll-container",ref:t,onScroll:N,children:p.jsx("div",{className:"lyrics-content",children:a.map(($,R)=>p.jsx("div",{ref:R===u?s:null,className:`lyrics-line ${R===u?"active":""} ${R<u?"past":""} ${R===d?"upcoming":""}`,onClick:()=>S(R),children:$.text||""},R))})})]}):l?p.jsx("div",{className:`lyrics-display lyrics-plain ${e?"compact":""}`,ref:t,children:p.jsx("div",{className:"lyrics-content",children:l.split(`
`).map(($,R)=>p.jsx("div",{className:"lyrics-line plain",children:$||""},R))})}):p.jsx("div",{className:"lyrics-display lyrics-empty",children:p.jsx("span",{children:"No lyrics available"})}):p.jsxs("div",{className:"lyrics-display lyrics-disabled",children:[p.jsx(Cy,{size:32}),p.jsx("span",{children:"Lyrics Disabled"})]})},jle=()=>{var ce,me,ge,ve,Ne,Me,Ue,Qe,ye,Ce;const n=L.useRef(null),e=L.useRef(null),t=L.useRef(null),{currentTrack:s,isPlaying:r,position:o,duration:i,isLoading:a,shuffle:l,repeat:u,pause:d,resume:f,seek:m,next:g,previous:y,toggleShuffle:w,cycleRepeat:b}=yt(),{playerMode:k,collapsePlayer:v,isLyricsVisible:N,toggleLyrics:S}=lg(),{isLiked:$,toggleLike:R}=gs(),{fetchLyrics:M,updateCurrentLine:A,clearLyrics:P}=vb(),{openAlbum:D,openArtist:E}=on(),j=s?$(s.id):!1,V=L.useCallback(()=>{var be,xe;s!=null&&s.album&&(v(),D(s.album.id,{id:s.album.id,title:s.album.title,artist:((be=s.artists[0])==null?void 0:be.name)||"Unknown Artist",artwork:(xe=s.album.artwork)==null?void 0:xe.medium,source:s.source}))},[s,D,v]),W=L.useCallback(()=>{var xe;const be=s==null?void 0:s.artists[0];be&&(v(),E(be.id,{id:be.id,name:be.name,image:(xe=s==null?void 0:s.artwork)==null?void 0:xe.medium,source:(s==null?void 0:s.source)||"unknown"}))},[s,E,v]);L.useEffect(()=>{var be;if(s&&k==="full"){const xe=((be=s.artists[0])==null?void 0:be.name)||"";M(xe,s.title,s.id)}},[s==null?void 0:s.id,k,M]),L.useEffect(()=>{k==="mini"&&P()},[k,P]),L.useEffect(()=>{N&&A(o)},[o,N,A]),L.useEffect(()=>{if(k!=="full")return;const be=xe=>{var Be;xe.key==="Escape"?v():xe.key===" "&&!((Be=xe.target)!=null&&Be.toString().includes("input"))&&(xe.preventDefault(),r?d():f())};return document.addEventListener("keydown",be),()=>document.removeEventListener("keydown",be)},[k,v,r,d,f]);const U=((ce=s==null?void 0:s.artwork)==null?void 0:ce.animated)??((ge=(me=s==null?void 0:s.album)==null?void 0:me.artwork)==null?void 0:ge.animated),X=U==null?void 0:U.videoUrl;L.useEffect(()=>{const be=e.current;if(!be||!X||k!=="full")return;const xe=async()=>{if(t.current)try{await t.current}catch{}t.current=be.play();try{await t.current}catch(Be){Be.name!=="AbortError"&&console.error("Video playback failed:",Be)}t.current=null};return be.readyState>=2?xe():be.addEventListener("canplay",xe,{once:!0}),()=>{be.removeEventListener("canplay",xe)}},[X,k]);const ee=L.useRef(null),G=L.useRef(!1),z=L.useCallback(be=>{if(!ee.current)return;const xe=ee.current.getBoundingClientRect(),Dt=Math.max(0,Math.min(1,(be-xe.left)/xe.width))*i;m(Dt)},[i,m]),H=L.useCallback(be=>{G.current=!0,z(be.clientX);const xe=Dt=>{G.current&&z(Dt.clientX)},Be=()=>{G.current=!1,document.removeEventListener("mousemove",xe),document.removeEventListener("mouseup",Be)};document.addEventListener("mousemove",xe),document.addEventListener("mouseup",Be)},[z]),O=be=>{const xe=Math.floor(be/1e3),Be=Math.floor(xe/60),Dt=xe%60;return`${Be}:${Dt.toString().padStart(2,"0")}`};if(k!=="full"||!s)return null;const B=i>0?o/i*100:0,Y=((ve=s.artwork)==null?void 0:ve.large)??((Ne=s.artwork)==null?void 0:Ne.medium)??((Ue=(Me=s.album)==null?void 0:Me.artwork)==null?void 0:Ue.large)??((ye=(Qe=s.album)==null?void 0:Qe.artwork)==null?void 0:ye.medium),oe=s.artists.map(be=>be.name).join(", "),Q=!!X;return p.jsxs("div",{className:"full-player",ref:n,children:[Y&&p.jsx("div",{className:"full-player-bg",style:{backgroundImage:`url(${Y})`}}),p.jsxs("header",{className:"full-player-header",children:[p.jsx("button",{className:"full-player-collapse",onClick:v,title:"Collapse (Esc)",children:p.jsx(kp,{size:28})}),p.jsxs("div",{className:"full-player-header-info",children:[p.jsx("span",{className:"full-player-from",children:"Playing from"}),p.jsx("span",{className:`full-player-source ${s.album?"clickable":""}`,onClick:s.album?V:void 0,title:s.album?`Go to ${s.album.title}`:void 0,children:((Ce=s.album)==null?void 0:Ce.title)||"Unknown Album"})]}),p.jsx("button",{className:`full-player-lyrics-toggle ${N?"active":""}`,onClick:S,title:N?"Hide lyrics":"Show lyrics",children:p.jsx(WS,{size:22})})]}),p.jsxs("div",{className:`full-player-content ${N?"with-lyrics":""}`,children:[p.jsx("div",{className:"full-player-artwork-container",children:Q&&U?p.jsx("video",{ref:e,className:"full-player-artwork full-player-video",src:U.videoUrl,poster:U.previewFrame||Y,loop:!0,muted:!U.hasAudio,playsInline:!0}):Y?p.jsx("img",{className:"full-player-artwork",src:Y,alt:s.title}):p.jsx("div",{className:"full-player-artwork full-player-artwork-placeholder",children:p.jsx(Ye,{size:80})})}),N&&p.jsx("div",{className:"full-player-lyrics-container",children:p.jsx(Lle,{onSeek:m})})]}),p.jsxs("footer",{className:"full-player-footer",children:[p.jsxs("div",{className:"full-player-track-info",children:[p.jsx("h2",{className:`full-player-title ${s.album?"clickable":""}`,onClick:s.album?V:void 0,title:s.album?`Go to ${s.album.title}`:void 0,children:s.title}),p.jsx("p",{className:`full-player-artist ${s.artists.length>0?"clickable":""}`,onClick:s.artists.length>0?W:void 0,title:s.artists.length>0?`Go to ${s.artists[0].name}`:void 0,children:oe})]}),p.jsxs("div",{className:"full-player-progress",children:[p.jsx("span",{className:"full-player-time",children:O(o)}),p.jsx("div",{className:"full-player-progress-bar",ref:ee,onMouseDown:H,children:p.jsx("div",{className:"full-player-progress-fill",style:{width:`${B}%`}})}),p.jsx("span",{className:"full-player-time",children:O(i)})]}),p.jsxs("div",{className:"full-player-controls",children:[p.jsx("button",{className:`full-player-btn secondary ${l?"active":""}`,onClick:w,title:l?"Disable shuffle":"Enable shuffle",children:p.jsx(Dl,{size:24})}),p.jsx("button",{className:"full-player-btn",onClick:y,title:"Previous",children:p.jsx(_S,{size:32})}),p.jsx("button",{className:"full-player-btn primary",onClick:r?d:f,disabled:a,title:r?"Pause":"Play",children:a?p.jsx("span",{className:"full-player-loading"}):r?p.jsx(bp,{size:36}):p.jsx(At,{size:36})}),p.jsx("button",{className:"full-player-btn",onClick:g,title:"Next",children:p.jsx(OS,{size:32})}),p.jsx("button",{className:`full-player-btn secondary ${u!=="off"?"active":""}`,onClick:b,title:u==="off"?"Enable repeat":u==="all"?"Repeat one":"Disable repeat",children:u==="one"?p.jsx(BS,{size:24}):p.jsx(zS,{size:24})})]}),p.jsx("div",{className:"full-player-actions",children:p.jsx("button",{className:`full-player-action ${j?"active":""}`,onClick:()=>R(s),title:j?"Remove from Liked Songs":"Add to Liked Songs",children:j?p.jsx(Ml,{size:24}):p.jsx(Su,{size:24})})})]})]})},Ole=()=>{var P,D,E,j,V;const n=L.useRef(null),e=L.useRef(null),{isLyricsPanelOpen:t,closeLyricsPanel:s}=lg(),{currentTrack:r,position:o,seek:i}=yt(),{lyrics:a,plainLyrics:l,currentLineIndex:u,nextLineIndex:d,isLoading:f,error:m,offset:g,fetchLyrics:y,updateCurrentLine:w,seekToLine:b,adjustOffset:k,resetOffset:v,clearLyrics:N}=vb(),S=pa(W=>W.plugins.find(U=>U.id==="lrclib-lyrics")),$=(S==null?void 0:S.enabled)??!0;L.useEffect(()=>{var W;if(t&&r&&$){const U=((W=r.artists[0])==null?void 0:W.name)||"";y(U,r.title,r.id)}else $||N()},[t,r==null?void 0:r.id,$,y,N]),L.useEffect(()=>{t&&w(o)},[o,t,w]),L.useEffect(()=>{if(e.current&&n.current){const W=n.current,U=e.current,X=W.clientHeight,ee=U.offsetTop,G=U.clientHeight,z=ee-X*.4+G/2;W.scrollTo({top:z,behavior:"smooth"})}},[u]),L.useEffect(()=>{if(!t)return;const W=U=>{U.key==="Escape"?s():U.key==="ArrowUp"&&U.altKey?k(-200):U.key==="ArrowDown"&&U.altKey?k(200):U.key==="0"&&U.altKey&&v()};return document.addEventListener("keydown",W),()=>document.removeEventListener("keydown",W)},[t,s,k,v]);const R=L.useCallback(W=>{const U=b(W);U>=0&&i(U)},[b,i]),M=L.useCallback(W=>{k(W)},[k]);if(!t)return null;const A=((P=r==null?void 0:r.artwork)==null?void 0:P.medium)??((E=(D=r==null?void 0:r.album)==null?void 0:D.artwork)==null?void 0:E.medium);return p.jsxs("div",{className:"lyrics-panel",children:[p.jsxs("header",{className:"lyrics-panel-header",children:[p.jsxs("div",{className:"lyrics-panel-header-info",children:[A?p.jsx("img",{className:"lyrics-panel-artwork",src:A,alt:""}):p.jsx("div",{className:"lyrics-panel-artwork lyrics-panel-artwork-placeholder",children:p.jsx(Ye,{size:20})}),p.jsxs("div",{className:"lyrics-panel-track-info",children:[p.jsx("span",{className:"lyrics-panel-title",children:(r==null?void 0:r.title)||"No track"}),p.jsx("span",{className:"lyrics-panel-artist",children:(r==null?void 0:r.artists.map(W=>W.name).join(", "))||"Unknown artist"})]})]}),p.jsx("button",{className:"lyrics-panel-close",onClick:s,title:"Close (Esc)",children:p.jsx(ar,{size:20})})]}),a&&a.length>0&&p.jsxs("div",{className:"lyrics-panel-offset",children:[p.jsx("button",{className:"lyrics-offset-button",onClick:()=>M(-200),title:"Lyrics earlier (Alt+Up)",children:p.jsx(VS,{size:16})}),p.jsx("span",{className:"lyrics-offset-value",onClick:v,title:"Click to reset",children:g===0?"Synced":`${g>0?"+":""}${g}ms`}),p.jsx("button",{className:"lyrics-offset-button",onClick:()=>M(200),title:"Lyrics later (Alt+Down)",children:p.jsx(kp,{size:16})})]}),p.jsxs("div",{className:"lyrics-panel-content",ref:n,children:[!$&&p.jsxs("div",{className:"lyrics-panel-state",children:[p.jsx(Cy,{size:48}),p.jsx("span",{children:"Lyrics Disabled"}),p.jsx("span",{className:"lyrics-panel-hint",children:"Enable the LRCLIB Lyrics plugin in Settings  Plugins to see lyrics"})]}),$&&f&&p.jsxs("div",{className:"lyrics-panel-state",children:[p.jsx("div",{className:"lyrics-panel-spinner"}),p.jsx("span",{children:"Loading lyrics..."})]}),$&&m&&p.jsx("div",{className:"lyrics-panel-state",children:p.jsx("span",{className:"lyrics-panel-error",children:m})}),$&&!f&&!m&&a&&a.length>0&&p.jsx("div",{className:"lyrics-panel-synced",children:a.map((W,U)=>p.jsx("div",{ref:U===u?e:null,className:`lyrics-panel-line ${U===u?"active":""} ${U<u?"past":""} ${U===d?"upcoming":""}`,onClick:()=>R(U),children:W.text||""},U))}),$&&!f&&!m&&!a&&l&&p.jsx("div",{className:"lyrics-panel-plain",children:l.split(`
`).map((W,U)=>p.jsx("div",{className:"lyrics-panel-line plain",children:W||""},U))}),$&&!f&&!m&&!a&&!l&&p.jsxs("div",{className:"lyrics-panel-state",children:[p.jsx(Ye,{size:48}),p.jsx("span",{children:"No lyrics available"}),p.jsx("span",{className:"lyrics-panel-hint",children:r?"Lyrics not found for this track":"Play a track to see lyrics"})]})]}),$&&a&&u>=0&&a[u]&&p.jsxs("div",{className:"lyrics-panel-current",children:[p.jsx("div",{className:"lyrics-panel-current-line",children:((j=a[u])==null?void 0:j.text)||"..."}),d>=0&&a[d]&&p.jsx("div",{className:"lyrics-panel-next-line",children:(V=a[d])==null?void 0:V.text})]})]})},_le=({track:n,onClose:e})=>{var b,k,v;const[t,s]=L.useState(!1),[r,o]=L.useState(""),[i,a]=L.useState(new Set),l=L.useRef(null),u=L.useRef(null),{playlists:d,createPlaylist:f,addToPlaylist:m}=gs();L.useEffect(()=>{const N=$=>{$.key==="Escape"&&e()},S=$=>{u.current&&!u.current.contains($.target)&&e()};return document.addEventListener("keydown",N),document.addEventListener("mousedown",S),()=>{document.removeEventListener("keydown",N),document.removeEventListener("mousedown",S)}},[e]),L.useEffect(()=>{t&&l.current&&l.current.focus()},[t]),L.useEffect(()=>{const N=new Set;d.forEach(S=>{S.tracks.some($=>$.id===n.id)&&N.add(S.id)}),a(N)},[d,n.id]);const g=()=>{if(r.trim()){const N=f(r.trim());m(N.id,n),a(S=>new Set(S).add(N.id)),o(""),s(!1)}},y=N=>{i.has(N)||(m(N,n),a(S=>new Set(S).add(N)))},w=((b=n.artwork)==null?void 0:b.medium)??((v=(k=n.album)==null?void 0:k.artwork)==null?void 0:v.medium);return p.jsx("div",{className:"modal-overlay",children:p.jsxs("div",{className:"modal",ref:u,children:[p.jsxs("header",{className:"modal-header",children:[p.jsx("h2",{children:"Add to Playlist"}),p.jsx("button",{className:"modal-close",onClick:e,children:p.jsx(ar,{size:20})})]}),p.jsxs("div",{className:"modal-track-preview",children:[w?p.jsx("img",{src:w,alt:n.title}):p.jsx("div",{className:"modal-track-placeholder",children:p.jsx(Yi,{size:24})}),p.jsxs("div",{className:"modal-track-info",children:[p.jsx("div",{className:"modal-track-title",children:n.title}),p.jsx("div",{className:"modal-track-artist",children:n.artists.map(N=>N.name).join(", ")})]})]}),p.jsxs("div",{className:"modal-content",children:[t?p.jsxs("div",{className:"modal-create-form",children:[p.jsx("input",{ref:l,type:"text",placeholder:"Playlist name",value:r,onChange:N=>o(N.target.value),onKeyDown:N=>{N.key==="Enter"&&g(),N.key==="Escape"&&s(!1)}}),p.jsxs("div",{className:"modal-create-buttons",children:[p.jsx("button",{className:"modal-button secondary",onClick:()=>s(!1),children:"Cancel"}),p.jsx("button",{className:"modal-button primary",onClick:g,disabled:!r.trim(),children:"Create"})]})]}):p.jsxs("button",{className:"modal-create-playlist",onClick:()=>s(!0),children:[p.jsx(xl,{size:20}),p.jsx("span",{children:"New Playlist"})]}),p.jsx("div",{className:"modal-playlist-list",children:d.length===0?p.jsx("div",{className:"modal-empty",children:"No playlists yet. Create one above!"}):d.map(N=>{const S=i.has(N.id);return p.jsxs("button",{className:`modal-playlist-item ${S?"added":""}`,onClick:()=>y(N.id),disabled:S,children:[p.jsx(Yi,{size:20}),p.jsx("span",{className:"modal-playlist-name",children:N.name}),p.jsxs("span",{className:"modal-playlist-count",children:[N.tracks.length," songs"]}),S&&p.jsx(wp,{size:18})]},N.id)})})]})]})})},zle=n=>{const e=document.documentElement;Object.entries({bgPrimary:"--bg-primary",bgSecondary:"--bg-secondary",bgTertiary:"--bg-tertiary",bgHover:"--bg-hover",bgElevated:"--bg-elevated",bgSurface:"--bg-surface",bgOverlay:"--bg-overlay",textPrimary:"--text-primary",textSecondary:"--text-secondary",textMuted:"--text-muted",textInverse:"--text-inverse",accent:"--accent",accentHover:"--accent-hover",accentGlow:"--accent-glow",accentSoft:"--accent-soft",accentMuted:"--accent-muted",borderColor:"--border-color",borderLight:"--border-light",borderStrong:"--border-strong",colorSuccess:"--color-success",colorWarning:"--color-warning",colorError:"--color-error",colorInfo:"--color-info"}).forEach(([s,r])=>{const o=n[s];o&&e.style.setProperty(r,o)})},Ble=n=>{if(!n)return;const e=document.documentElement;Object.entries({accent:"--gradient-accent",surface:"--gradient-surface",purple:"--gradient-purple",pink:"--gradient-pink",blue:"--gradient-blue",orange:"--gradient-orange",red:"--gradient-red",teal:"--gradient-teal"}).forEach(([s,r])=>{const o=n[s];o&&e.style.setProperty(r,o)})},Vle=n=>{if(!n)return;const e=document.documentElement;Object.entries({xs:"--shadow-xs",sm:"--shadow-sm",md:"--shadow-md",lg:"--shadow-lg",xl:"--shadow-xl",glow:"--shadow-glow",module:"--shadow-module",card:"--shadow-card",elevated:"--shadow-elevated"}).forEach(([s,r])=>{const o=n[s];o&&e.style.setProperty(r,o)})},Wle=n=>{if(!n)return;const e=document.documentElement;Object.entries({bg:"--glass-bg",bgLight:"--glass-bg-light",border:"--glass-border",borderStrong:"--glass-border-strong",blur:"--glass-blur",blurStrong:"--glass-blur-strong"}).forEach(([s,r])=>{const o=n[s];o&&e.style.setProperty(r,o)})},Ule=n=>{if(!n)return;const e=document.documentElement;Object.entries({xs:"--radius-xs",sm:"--radius-sm",md:"--radius-md",lg:"--radius-lg",xl:"--radius-xl","2xl":"--radius-2xl",full:"--radius-full",module:"--radius-module",card:"--radius-card",button:"--radius-button"}).forEach(([s,r])=>{const o=n[s];o&&e.style.setProperty(r,o)})},Gle=n=>{if(!n)return;const e=document.documentElement;n.sans&&e.style.setProperty("--font-sans",n.sans),n.mono&&e.style.setProperty("--font-mono",n.mono)},FS="audiio-theme-custom-css",Hle=(n,e)=>{const t=document.getElementById(FS);if(t&&t.remove(),!e)return;const s=qle(e);if(s){const r=document.createElement("style");r.id=FS,r.setAttribute("data-theme-id",n),r.textContent=s,document.head.appendChild(r)}},qle=n=>{const e=[/expression\s*\(/gi,/javascript\s*:/gi,/behavior\s*:/gi,/@import/gi,/url\s*\(\s*["']?data:/gi,/-moz-binding/gi,/vbscript\s*:/gi];let t=n;e.forEach(s=>{t=t.replace(s,"/* blocked */")}),t.length>5e4&&(console.warn("Custom CSS exceeds 50KB limit, truncating"),t=t.substring(0,5e4));try{return t.replace(/([^\r\n,{}]+)(\s*\{)/g,(r,o,i)=>o.trim().startsWith(".app")||o.trim().startsWith("@")||o.trim().startsWith(":root")||o.trim().startsWith("from")||o.trim().startsWith("to")||/^\d+%$/.test(o.trim())?r:`.app ${o.trim()}${i}`)}catch{return t}},Kle=()=>{const n=document.documentElement;["--bg-primary","--bg-secondary","--bg-tertiary","--bg-hover","--bg-elevated","--bg-surface","--bg-overlay","--text-primary","--text-secondary","--text-muted","--text-inverse","--accent","--accent-hover","--accent-glow","--accent-soft","--accent-muted","--border-color","--border-light","--border-strong","--color-success","--color-warning","--color-error","--color-info","--gradient-accent","--gradient-surface","--gradient-purple","--gradient-pink","--gradient-blue","--gradient-orange","--gradient-red","--gradient-teal","--shadow-xs","--shadow-sm","--shadow-md","--shadow-lg","--shadow-xl","--shadow-glow","--shadow-module","--shadow-card","--shadow-elevated","--glass-bg","--glass-bg-light","--glass-border","--glass-border-strong","--glass-blur","--glass-blur-strong","--radius-xs","--radius-sm","--radius-md","--radius-lg","--radius-xl","--radius-2xl","--radius-full","--radius-module","--radius-card","--radius-button","--font-sans","--font-mono","--color-mode"].forEach(t=>{n.style.removeProperty(t)})},Xle=n=>{const e=document.documentElement;Kle(),e.setAttribute("data-theme",n.mode),e.style.setProperty("--color-mode",n.mode),zle(n.colors),Ble(n.gradients),Vle(n.shadows),Wle(n.glass),Ule(n.radius),Gle(n.fonts),Hle(n.id,n.customCSS)},Qle=({children:n})=>{const e=ml(i=>i.getActiveTheme),t=ml(i=>i.activeThemeId),s=ml(i=>i.systemMode),r=L.useRef(null),o=L.useCallback((i=!1)=>{const a=e(),l=`${a.id}-${a.mode}`;(i||r.current!==l)&&(Xle(a),r.current=l)},[e]);return L.useEffect(()=>{o(!0)},[]),L.useEffect(()=>{o(!0)},[t,s]),L.useEffect(()=>{if(s!=="auto")return;const i=window.matchMedia("(prefers-color-scheme: dark)"),a=()=>{o(!0)};return i.addEventListener("change",a),()=>{i.removeEventListener("change",a)}},[s,o]),p.jsx(p.Fragment,{children:n})},Yle=()=>{const{likedTracks:n,playlists:e}=gs(),t=Xt.useMemo(()=>{const s=[...n];for(const o of e)s.push(...o.tracks);const r=new Set;return s.filter(o=>r.has(o.id)?!1:(r.add(o.id),!0))},[n,e]);return Sre({availableTracks:t,enabled:!0}),null},Jle=()=>(Rre(),null),Zle=()=>(Are(),null),ece=()=>{const{currentView:n,isSearchActive:e,searchQuery:t,setSearchQuery:s,clearSearch:r}=on(),{search:o,clear:i}=ma(),a=()=>{r(),i()};if(n==="home"){const l=e&&t;return p.jsxs("div",{className:`home-view ${l?"searching":""}`,children:[p.jsx(joe,{onSearch:u=>{s(u),u&&o(u)},onClose:a,isSearchActive:!!l}),p.jsx("div",{className:"home-content",children:l?p.jsx(Ooe,{}):p.jsx(fS,{})})]})}switch(n){case"likes":return p.jsx(zoe,{});case"playlists":return p.jsx(Boe,{});case"playlist-detail":return p.jsx(Voe,{});case"downloads":return p.jsx(Woe,{});case"plugins":return p.jsx(Iae,{});case"plugin-detail":return p.jsx(Dae,{});case"settings":return p.jsx(vle,{});case"artist-detail":return p.jsx(Ile,{});case"album-detail":return p.jsx(Rle,{});default:return p.jsx(fS,{})}},tce=()=>{const[n,e]=L.useState(null),[t,s]=L.useState(null);return p.jsx(Qle,{children:p.jsxs(Cre,{onAddToPlaylist:e,onDislike:s,children:[p.jsxs("div",{className:"app",children:[p.jsx(Yle,{}),p.jsx(Jle,{}),p.jsx(Zle,{}),p.jsx(sM,{}),p.jsx("main",{className:"main-content",children:p.jsx(ece,{})}),p.jsx(Mle,{}),p.jsx(Dle,{}),p.jsx(Ole,{}),p.jsx(jle,{})]}),n&&p.jsx(_le,{track:n,onClose:()=>e(null)}),t&&p.jsx(bD,{track:t,onClose:()=>s(null)})]})})};N4.createRoot(document.getElementById("root")).render(p.jsx(Xt.StrictMode,{children:p.jsx(tce,{})}));
//# sourceMappingURL=index-CZ3exJDp.js.map
